<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="216">
  <HTTPTask id="218" hostname="aa-pt6245.dev.accela.com:5443" path="/portlets/framework/includes/javascript/ext-2.0.2/adapter/jquery/jquery.js" url="https://aa-pt6245.dev.accela.com:5443/portlets/framework/includes/javascript/ext-2.0.2/adapter/jquery/jquery.js" ip="13.93.163.237" port="5443" client_ip="10.1.61.63" client_port="11584" connectionId="2032" origin="Primary" startDateTime="2017-08-28T11:38:10.576-07:00" startTime="9696" endTime="9720" sendTime="15" waitTime="0" receiveTime="8">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Referer" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9jYXAvY2FwU2VhcmNoLmRvP3NlYXJjaEJ5PUJ5Q29uZGl0aW9uJmhlaWdodD0yNzAmbW9kZT1pbml0Jm1vZHVsZT1CdWlsZGluZyZjbGVhbkNhcElkPVkmaXNHZW5lcmFsQ0FQPVkmc3VwcG9ydE11bEFnZW5jeVNlYXJjaD1Z</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SlNFU1NJT05JRD12WmtsdWRxZ2o4WmpHTTJvb2pPTkVrT0o7IEpTRVNTSU9OSUQ9KioqKioqKioqKioqKioqKioqKioqKioqKioqOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ1NDg4MTUxOyBob3N0U2lnbk9uPXRydWU7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM7IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBMQVRFU1RfU0VTU0lPTl9JRD12WmtsdWRxZ2o4WmpHTTJvb2pPTkVrT0o7IEFDQXV0aD03NzM2MjAxNDkzMTM2NjIyNTcyODg2NTM3NDA1MDg5NjkxODQ2NjMzNjY3Mjk5NTA0OTExNDkxODQyNTA1OTgyNjUyODk1OTAxNjQyMTUyNjM4NjkxNzE2NDgzNTExNzc1MzY1MTQ2NjI3NDczOTk4MzMzMTI2NDU1ODMzODM2MDsgQUNTaWduT25Nb2R1bGU9U1NPU3RhbmRhcmQ7IEFBUGVyc2lzdExvZ2luU2VydlByb3ZDb2RlPUZMQUdTVEFGRjsgTG9naW5TZXJ2UHJvdkNvZGU0TXVsdGlBZ2VuY3k9RkxBR1NUQUZGOyBMb2dpblVzZXJuYW1lNE11bHRpQWdlbmN5PTE3OUREMTNBMTg2MDI4RjQ7IEFDU2lnbm9mZj0iaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zZWN1cml0eS9zaWdub3V0LmRvIjsgQUNTd2l0Y2hBZ2VuY3k9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9wb3J0bGV0cy9mcmFtZXdvcmsvaW5jbHVkZXMvamF2YXNjcmlwdC9leHQtMi4wLjIvYWRhcHRlci9qcXVlcnkvanF1ZXJ5LmpzIEhUVFAvMS4xDQpSZWZlcmVyOiBodHRwczovL2FhLXB0NjI0NS5kZXYuYWNjZWxhLmNvbTo1NDQzL3BvcnRsZXRzL2NhcC9jYXBTZWFyY2guZG8/c2VhcmNoQnk9QnlDb25kaXRpb24maGVpZ2h0PTI3MCZtb2RlPWluaXQmbW9kdWxlPUJ1aWxkaW5nJmNsZWFuQ2FwSWQ9WSZpc0dlbmVyYWxDQVA9WSZzdXBwb3J0TXVsQWdlbmN5U2VhcmNoPVkNClVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdPVzY0OyBUcmlkZW50LzcuMDsgcnY6MTEuMCkgbGlrZSBHZWNrbw0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlDQpBY2NlcHQtTGFuZ3VhZ2U6IGVuLVVTDQpBY2NlcHQ6ICovKg0KQ29ubmVjdGlvbjogS2VlcC1BbGl2ZQ0KSG9zdDogYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMNCkNvb2tpZTogSlNFU1NJT05JRD12WmtsdWRxZ2o4WmpHTTJvb2pPTkVrT0o7IEpTRVNTSU9OSUQ9KioqKioqKioqKioqKioqKioqKioqKioqKioqOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ1NDg4MTUxOyBob3N0U2lnbk9uPXRydWU7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM7IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBMQVRFU1RfU0VTU0lPTl9JRD12WmtsdWRxZ2o4WmpHTTJvb2pPTkVrT0o7IEFDQXV0aD03NzM2MjAxNDkzMTM2NjIyNTcyODg2NTM3NDA1MDg5NjkxODQ2NjMzNjY3Mjk5NTA0OTExNDkxODQyNTA1OTgyNjUyODk1OTAxNjQyMTUyNjM4NjkxNzE2NDgzNTExNzc1MzY1MTQ2NjI3NDczOTk4MzMzMTI2NDU1ODMzODM2MDsgQUNTaWduT25Nb2R1bGU9U1NPU3RhbmRhcmQ7IEFBUGVyc2lzdExvZ2luU2VydlByb3ZDb2RlPUZMQUdTVEFGRjsgTG9naW5TZXJ2UHJvdkNvZGU0TXVsdGlBZ2VuY3k9RkxBR1NUQUZGOyBMb2dpblVzZXJuYW1lNE11bHRpQWdlbmN5PTE3OUREMTNBMTg2MDI4RjQ7IEFDU2lnbm9mZj0iaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zZWN1cml0eS9zaWdub3V0LmRvIjsgQUNTd2l0Y2hBZ2VuY3k9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="JSESSIONID" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dlprbHVkcWdqOFpqR00yb29qT05Fa09K</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="JSESSIONID" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>KioqKioqKioqKioqKioqKioqKioqKioqKioq</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LASTEST_REQUEST_TIME" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTUwMzk0NTQ4ODE1MQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="hostSignOn" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="g_current_language_ext" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW5fVVM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_WEB_SERVER" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTAuMS4wLjY=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_SESSION_ID" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dlprbHVkcWdqOFpqR00yb29qT05Fa09K</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACAuth" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NzczNjIwMTQ5MzEzNjYyMjU3Mjg4NjUzNzQwNTA4OTY5MTg0NjYzMzY2NzI5OTUwNDkxMTQ5MTg0MjUwNTk4MjY1Mjg5NTkwMTY0MjE1MjYzODY5MTcxNjQ4MzUxMTc3NTM2NTE0NjYyNzQ3Mzk5ODMzMzEyNjQ1NTgzMzgzNjA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignOnModule" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U1NPU3RhbmRhcmQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="AAPersistLoginServProvCode" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginServProvCode4MultiAgency" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginUsername4MultiAgency" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTc5REQxM0ExODYwMjhGNA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignoff" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvc2VjdXJpdHkvc2lnbm91dC5kbyI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSwitchAgency" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLUNveW90ZS8xLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHJpdmF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Expires" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBVVEM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-XSS-Protection" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NTQ4ODE2NjsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFURVNUX1dFQl9TRVJWRVI9MTAuMS4wLjY7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFURVNUX1NFU1NJT05fSUQ9dlprbHVkcWdqOFpqR00yb29qT05Fa09KOyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJl</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Vy8iMTAwMTcxLTE0OTg3NDcxNDAwMDAi</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAyOSBKdW4gMjAxNyAxNDozOTowMCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Transfer-Encoding" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y2h1bmtlZA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="13">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="14">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyOCBBdWcgMjAxNyAxODozODowNyBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IEFwYWNoZS1Db3lvdGUvMS4xDQpDYWNoZS1Db250cm9sOiBwcml2YXRlDQpFeHBpcmVzOiBUaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIFVUQw0KWC1YU1MtUHJvdGVjdGlvbjogMA0KU2V0LUNvb2tpZTogTEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NTQ4ODE2NjsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ0KU2V0LUNvb2tpZTogTEFURVNUX1dFQl9TRVJWRVI9MTAuMS4wLjY7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmUNClNldC1Db29raWU6IExBVEVTVF9TRVNTSU9OX0lEPXZaa2x1ZHFnajhaakdNMm9vak9ORWtPSjsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkVUYWc6IFcvIjEwMDE3MS0xNDk4NzQ3MTQwMDAwIg0KTGFzdC1Nb2RpZmllZDogVGh1LCAyOSBKdW4gMjAxNyAxNDozOTowMCBHTVQNCkNvbnRlbnQtVHlwZTogdGV4dC9qYXZhc2NyaXB0DQpUcmFuc2Zlci1FbmNvZGluZzogY2h1bmtlZA0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KVmFyeTogQWNjZXB0LUVuY29kaW5nDQpEYXRlOiBNb24sIDI4IEF1ZyAyMDE3IDE4OjM4OjA3IEdNVA0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>KGZ1bmN0aW9uKCl7DQovKg0KICogalF1ZXJ5IDEuMi4zIC0gTmV3IFdhdmUgSmF2YXNjcmlwdA0KICoNCiAqIENvcHlyaWdodCAoYykgMjAwOCBKb2huIFJlc2lnIChqcXVlcnkuY29tKQ0KICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIChNSVQtTElDRU5TRS50eHQpDQogKiBhbmQgR1BMIChHUEwtTElDRU5TRS50eHQpIGxpY2Vuc2VzLg0KICoNCiAqICREYXRlOiAyMDA4LTAyLTA2IDAwOjIxOjI1IC0wNTAwIChXZWQsIDA2IEZlYiAyMDA4KSAkDQogKiAkUmV2OiA0NjYzICQNCiAqLw0KDQovLyBNYXAgb3ZlciBqUXVlcnkgaW4gY2FzZSBvZiBvdmVyd3JpdGUNCmlmICggd2luZG93LmpRdWVyeSApDQoJdmFyIF9qUXVlcnkgPSB3aW5kb3cualF1ZXJ5Ow0KDQp2YXIgalF1ZXJ5ID0gd2luZG93LmpRdWVyeSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsNCgkvLyBUaGUgalF1ZXJ5IG9iamVjdCBpcyBhY3R1YWxseSBqdXN0IHRoZSBpbml0IGNvbnN0cnVjdG9yICdlbmhhbmNlZCcNCglyZXR1cm4gbmV3IGpRdWVyeS5wcm90b3R5cGUuaW5pdCggc2VsZWN0b3IsIGNvbnRleHQgKTsNCn07DQoNCi8vIE1hcCBvdmVyIHRoZSAkIGluIGNhc2Ugb2Ygb3ZlcndyaXRlDQppZiAoIHdpbmRvdy4kICkNCgl2YXIgXyQgPSB3aW5kb3cuJDsNCgkNCi8vIE1hcCB0aGUgalF1ZXJ5IG5hbWVzcGFjZSB0byB0aGUgJyQnIG9uZQ0Kd2luZG93LiQgPSBqUXVlcnk7DQoNCi8vIEEgc2ltcGxlIHdheSB0byBjaGVjayBmb3IgSFRNTCBzdHJpbmdzIG9yIElEIHN0cmluZ3MNCi8vIChib3RoIG9mIHdoaWNoIHdlIG9wdGltaXplIGZvcikNCnZhciBxdWlja0V4cHIgPSAvXltePF0qKDwoLnxccykrPilbXj5dKiR8XiMoXHcrKSQvOw0KDQovLyBJcyBpdCBhIHNpbXBsZSBzZWxlY3Rvcg0KdmFyIGlzU2ltcGxlID0gL14uW146I1xbXC5dKiQvOw0KDQpqUXVlcnkuZm4gPSBqUXVlcnkucHJvdG90eXBlID0gew0KCWluaXQ6IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsNCgkJLy8gTWFrZSBzdXJlIHRoYXQgYSBzZWxlY3Rpb24gd2FzIHByb3ZpZGVkDQoJCXNlbGVjdG9yID0gc2VsZWN0b3IgfHwgZG9jdW1lbnQ7DQoNCgkJLy8gSGFuZGxlICQoRE9NRWxlbWVudCkNCgkJaWYgKCBzZWxlY3Rvci5ub2RlVHlwZSApIHsNCgkJCXRoaXNbMF0gPSBzZWxlY3RvcjsNCgkJCXRoaXMubGVuZ3RoID0gMTsNCgkJCXJldHVybiB0aGlzOw0KDQoJCS8vIEhhbmRsZSBIVE1MIHN0cmluZ3MNCgkJfSBlbHNlIGlmICggdHlwZW9mIHNlbGVjdG9yID09ICJzdHJpbmciICkgew0KCQkJLy8gQXJlIHdlIGRlYWxpbmcgd2l0aCBIVE1MIHN0cmluZyBvciBhbiBJRD8NCgkJCXZhciBtYXRjaCA9IHF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApOw0KDQoJCQkvLyBWZXJpZnkgYSBtYXRjaCwgYW5kIHRoYXQgbm8gY29udGV4dCB3YXMgc3BlY2lmaWVkIGZvciAjaWQNCgkJCWlmICggbWF0Y2ggJiYgKG1hdGNoWzFdIHx8ICFjb250ZXh0KSApIHsNCg0KCQkJCS8vIEhBTkRMRTogJChodG1sKSAtPiAkKGFycmF5KQ0KCQkJCWlmICggbWF0Y2hbMV0gKQ0KCQkJCQlzZWxlY3RvciA9IGpRdWVyeS5jbGVhbiggWyBtYXRjaFsxXSBdLCBjb250ZXh0ICk7DQoNCgkJCQkvLyBIQU5ETEU6ICQoIiNpZCIpDQoJCQkJZWxzZSB7DQoJCQkJCXZhciBlbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIG1hdGNoWzNdICk7DQoNCgkJCQkJLy8gTWFrZSBzdXJlIGFuIGVsZW1lbnQgd2FzIGxvY2F0ZWQNCgkJCQkJaWYgKCBlbGVtICkNCgkJCQkJCS8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBJRSBhbmQgT3BlcmEgcmV0dXJuIGl0ZW1zDQoJCQkJCQkvLyBieSBuYW1lIGluc3RlYWQgb2YgSUQNCgkJCQkJCWlmICggZWxlbS5pZCAhPSBtYXRjaFszXSApDQoJCQkJCQkJcmV0dXJuIGpRdWVyeSgpLmZpbmQoIHNlbGVjdG9yICk7DQoNCgkJCQkJCS8vIE90aGVyd2lzZSwgd2UgaW5qZWN0IHRoZSBlbGVtZW50IGRpcmVjdGx5IGludG8gdGhlIGpRdWVyeSBvYmplY3QNCgkJCQkJCWVsc2Ugew0KCQkJCQkJCXRoaXNbMF0gPSBlbGVtOw0KCQkJCQkJCXRoaXMubGVuZ3RoID0gMTsNCgkJCQkJCQlyZXR1cm4gdGhpczsNCgkJCQkJCX0NCg0KCQkJCQllbHNlDQoJCQkJCQlzZWxlY3RvciA9IFtdOw0KCQkJCX0NCg0KCQkJLy8gSEFORExFOiAkKGV4cHIsIFtjb250ZXh0XSkNCgkJCS8vICh3aGljaCBpcyBqdXN0IGVxdWl2YWxlbnQgdG86ICQoY29udGVudCkuZmluZChleHByKQ0KCQkJfSBlbHNlDQoJCQkJcmV0dXJuIG5ldyBqUXVlcnkoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApOw0KDQoJCS8vIEhBTkRMRTogJChmdW5jdGlvbikNCgkJLy8gU2hvcnRjdXQgZm9yIGRvY3VtZW50IHJlYWR5DQoJCX0gZWxzZSBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBzZWxlY3RvciApICkNCgkJCXJldHVybiBuZXcgalF1ZXJ5KCBkb2N1bWVudCApWyBqUXVlcnkuZm4ucmVhZHkgPyAicmVhZHkiIDogImxvYWQiIF0oIHNlbGVjdG9yICk7DQoNCgkJcmV0dXJuIHRoaXMuc2V0QXJyYXkoDQoJCQkvLyBIQU5ETEU6ICQoYXJyYXkpDQoJCQlzZWxlY3Rvci5jb25zdHJ1Y3RvciA9PSBBcnJheSAmJiBzZWxlY3RvciB8fA0KDQoJCQkvLyBIQU5ETEU6ICQoYXJyYXlsaWtlKQ0KCQkJLy8gV2F0Y2ggZm9yIHdoZW4gYW4gYXJyYXktbGlrZSBvYmplY3QsIGNvbnRhaW5zIERPTSBub2RlcywgaXMgcGFzc2VkIGluIGFzIHRoZSBzZWxlY3Rvcg0KCQkJKHNlbGVjdG9yLmpxdWVyeSB8fCBzZWxlY3Rvci5sZW5ndGggJiYgc2VsZWN0b3IgIT0gd2luZG93ICYmICFzZWxlY3Rvci5ub2RlVHlwZSAmJiBzZWxlY3RvclswXSAhPSB1bmRlZmluZWQgJiYgc2VsZWN0b3JbMF0ubm9kZVR5cGUpICYmIGpRdWVyeS5tYWtlQXJyYXkoIHNlbGVjdG9yICkgfHwNCg0KCQkJLy8gSEFORExFOiAkKCopDQoJCQlbIHNlbGVjdG9yIF0gKTsNCgl9LA0KCQ0KCS8vIFRoZSBjdXJyZW50IHZlcnNpb24gb2YgalF1ZXJ5IGJlaW5nIHVzZWQNCglqcXVlcnk6ICIxLjIuMyIsDQoNCgkvLyBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIGNvbnRhaW5lZCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldA0KCXNpemU6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gdGhpcy5sZW5ndGg7DQoJfSwNCgkNCgkvLyBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIGNvbnRhaW5lZCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldA0KCWxlbmd0aDogMCwNCg0KCS8vIEdldCB0aGUgTnRoIGVsZW1lbnQgaW4gdGhlIG1hdGNoZWQgZWxlbWVudCBzZXQgT1INCgkvLyBHZXQgdGhlIHdob2xlIG1hdGNoZWQgZWxlbWVudCBzZXQgYXMgYSBjbGVhbiBhcnJheQ0KCWdldDogZnVuY3Rpb24oIG51bSApIHsNCgkJcmV0dXJuIG51bSA9PSB1bmRlZmluZWQgPw0KDQoJCQkvLyBSZXR1cm4gYSAnY2xlYW4nIGFycmF5DQoJCQlqUXVlcnkubWFrZUFycmF5KCB0aGlzICkgOg0KDQoJCQkvLyBSZXR1cm4ganVzdCB0aGUgb2JqZWN0DQoJCQl0aGlzWyBudW0gXTsNCgl9LA0KCQ0KCS8vIFRha2UgYW4gYXJyYXkgb2YgZWxlbWVudHMgYW5kIHB1c2ggaXQgb250byB0aGUgc3RhY2sNCgkvLyAocmV0dXJuaW5nIHRoZSBuZXcgbWF0Y2hlZCBlbGVtZW50IHNldCkNCglwdXNoU3RhY2s6IGZ1bmN0aW9uKCBlbGVtcyApIHsNCgkJLy8gQnVpbGQgYSBuZXcgalF1ZXJ5IG1hdGNoZWQgZWxlbWVudCBzZXQNCgkJdmFyIHJldCA9IGpRdWVyeSggZWxlbXMgKTsNCg0KCQkvLyBBZGQgdGhlIG9sZCBvYmplY3Qgb250byB0aGUgc3RhY2sgKGFzIGEgcmVmZXJlbmNlKQ0KCQlyZXQucHJldk9iamVjdCA9IHRoaXM7DQoNCgkJLy8gUmV0dXJuIHRoZSBuZXdseS1mb3JtZWQgZWxlbWVudCBzZXQNCgkJcmV0dXJuIHJldDsNCgl9LA0KCQ0KCS8vIEZvcmNlIHRoZSBjdXJyZW50IG1hdGNoZWQgc2V0IG9mIGVsZW1lbnRzIHRvIGJlY29tZQ0KCS8vIHRoZSBzcGVjaWZpZWQgYXJyYXkgb2YgZWxlbWVudHMgKGRlc3Ryb3lpbmcgdGhlIHN0YWNrIGluIHRoZSBwcm9jZXNzKQ0KCS8vIFlvdSBzaG91bGQgdXNlIHB1c2hTdGFjaygpIGluIG9yZGVyIHRvIGRvIHRoaXMsIGJ1dCBtYWludGFpbiB0aGUgc3RhY2sNCglzZXRBcnJheTogZnVuY3Rpb24oIGVsZW1zICkgew0KCQkvLyBSZXNldHRpbmcgdGhlIGxlbmd0aCB0byAwLCB0aGVuIHVzaW5nIHRoZSBuYXRpdmUgQXJyYXkgcHVzaA0KCQkvLyBpcyBhIHN1cGVyLWZhc3Qgd2F5IHRvIHBvcHVsYXRlIGFuIG9iamVjdCB3aXRoIGFycmF5LWxpa2UgcHJvcGVydGllcw0KCQl0aGlzLmxlbmd0aCA9IDA7DQoJCUFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KCB0aGlzLCBlbGVtcyApOw0KCQkNCgkJcmV0dXJuIHRoaXM7DQoJfSwNCg0KCS8vIEV4ZWN1dGUgYSBjYWxsYmFjayBmb3IgZXZlcnkgZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBzZXQuDQoJLy8gKFlvdSBjYW4gc2VlZCB0aGUgYXJndW1lbnRzIHdpdGggYW4gYXJyYXkgb2YgYXJncywgYnV0IHRoaXMgaXMNCgkvLyBvbmx5IHVzZWQgaW50ZXJuYWxseS4pDQoJZWFjaDogZnVuY3Rpb24oIGNhbGxiYWNrLCBhcmdzICkgew0KCQlyZXR1cm4galF1ZXJ5LmVhY2goIHRoaXMsIGNhbGxiYWNrLCBhcmdzICk7DQoJfSwNCg0KCS8vIERldGVybWluZSB0aGUgcG9zaXRpb24gb2YgYW4gZWxlbWVudCB3aXRoaW4gDQoJLy8gdGhlIG1hdGNoZWQgc2V0IG9mIGVsZW1lbnRzDQoJaW5kZXg6IGZ1bmN0aW9uKCBlbGVtICkgew0KCQl2YXIgcmV0ID0gLTE7DQoNCgkJLy8gTG9jYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZGVzaXJlZCBlbGVtZW50DQoJCXRoaXMuZWFjaChmdW5jdGlvbihpKXsNCgkJCWlmICggdGhpcyA9PSBlbGVtICkNCgkJCQlyZXQgPSBpOw0KCQl9KTsNCg0KCQlyZXR1cm4gcmV0Ow0KCX0sDQoNCglhdHRyOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUsIHR5cGUgKSB7DQoJCXZhciBvcHRpb25zID0gbmFtZTsNCgkJDQoJCS8vIExvb2sgZm9yIHRoZSBjYXNlIHdoZXJlIHdlJ3JlIGFjY2Vzc2luZyBhIHN0eWxlIHZhbHVlDQoJCWlmICggbmFtZS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcgKQ0KCQkJaWYgKCB2YWx1ZSA9PSB1bmRlZmluZWQgKQ0KCQkJCXJldHVybiB0aGlzLmxlbmd0aCAmJiBqUXVlcnlbIHR5cGUgfHwgImF0dHIiIF0oIHRoaXNbMF0sIG5hbWUgKSB8fCB1bmRlZmluZWQ7DQoNCgkJCWVsc2Ugew0KCQkJCW9wdGlvbnMgPSB7fTsNCgkJCQlvcHRpb25zWyBuYW1lIF0gPSB2YWx1ZTsNCgkJCX0NCgkJDQoJCS8vIENoZWNrIHRvIHNlZSBpZiB3ZSdyZSBzZXR0aW5nIHN0eWxlIHZhbHVlcw0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpew0KCQkJLy8gU2V0IGFsbCB0aGUgc3R5bGVzDQoJCQlmb3IgKCBuYW1lIGluIG9wdGlvbnMgKQ0KCQkJCWpRdWVyeS5hdHRyKA0KCQkJCQl0eXBlID8NCgkJCQkJCXRoaXMuc3R5bGUgOg0KCQkJCQkJdGhpcywNCgkJCQkJbmFtZSwgalF1ZXJ5LnByb3AoIHRoaXMsIG9wdGlvbnNbIG5hbWUgXSwgdHlwZSwgaSwgbmFtZSApDQoJCQkJKTsNCgkJfSk7DQoJfSwNCg0KCWNzczogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7DQoJCS8vIGlnbm9yZSBuZWdhdGl2ZSB3aWR0aCBhbmQgaGVpZ2h0IHZhbHVlcw0KCQlpZiAoIChrZXkgPT0gJ3dpZHRoJyB8fCBrZXkgPT0gJ2hlaWdodCcpICYmIHBhcnNlRmxvYXQodmFsdWUpIDwgMCApDQoJCQl2YWx1ZSA9IHVuZGVmaW5lZDsNCgkJcmV0dXJuIHRoaXMuYXR0cigga2V5LCB2YWx1ZSwgImN1ckNTUyIgKTsNCgl9LA0KDQoJdGV4dDogZnVuY3Rpb24oIHRleHQgKSB7DQoJCWlmICggdHlwZW9mIHRleHQgIT0gIm9iamVjdCIgJiYgdGV4dCAhPSBudWxsICkNCgkJCXJldHVybiB0aGlzLmVtcHR5KCkuYXBwZW5kKCAodGhpc1swXSAmJiB0aGlzWzBdLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpLmNyZWF0ZVRleHROb2RlKCB0ZXh0ICkgKTsNCg0KCQl2YXIgcmV0ID0gIiI7DQoNCgkJalF1ZXJ5LmVhY2goIHRleHQgfHwgdGhpcywgZnVuY3Rpb24oKXsNCgkJCWpRdWVyeS5lYWNoKCB0aGlzLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKCl7DQoJCQkJaWYgKCB0aGlzLm5vZGVUeXBlICE9IDggKQ0KCQkJCQlyZXQgKz0gdGhpcy5ub2RlVHlwZSAhPSAxID8NCgkJCQkJCXRoaXMubm9kZVZhbHVlIDoNCgkJCQkJCWpRdWVyeS5mbi50ZXh0KCBbIHRoaXMgXSApOw0KCQkJfSk7DQoJCX0pOw0KDQoJCXJldHVybiByZXQ7DQoJfSwNCg0KCXdyYXBBbGw6IGZ1bmN0aW9uKCBodG1sICkgew0KCQlpZiAoIHRoaXNbMF0gKQ0KCQkJLy8gVGhlIGVsZW1lbnRzIHRvIHdyYXAgdGhlIHRhcmdldCBhcm91bmQNCgkJCWpRdWVyeSggaHRtbCwgdGhpc1swXS5vd25lckRvY3VtZW50ICkNCgkJCQkuY2xvbmUoKQ0KCQkJCS5pbnNlcnRCZWZvcmUoIHRoaXNbMF0gKQ0KCQkJCS5tYXAoZnVuY3Rpb24oKXsNCgkJCQkJdmFyIGVsZW0gPSB0aGlzOw0KDQoJCQkJCXdoaWxlICggZWxlbS5maXJzdENoaWxkICkNCgkJCQkJCWVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7DQoNCgkJCQkJcmV0dXJuIGVsZW07DQoJCQkJfSkNCgkJCQkuYXBwZW5kKHRoaXMpOw0KDQoJCXJldHVybiB0aGlzOw0KCX0sDQoNCgl3cmFwSW5uZXI6IGZ1bmN0aW9uKCBodG1sICkgew0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7DQoJCQlqUXVlcnkoIHRoaXMgKS5jb250ZW50cygpLndyYXBBbGwoIGh0bWwgKTsNCgkJfSk7DQoJfSwNCg0KCXdyYXA6IGZ1bmN0aW9uKCBodG1sICkgew0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7DQoJCQlqUXVlcnkoIHRoaXMgKS53cmFwQWxsKCBodG1sICk7DQoJCX0pOw0KCX0sDQoNCglhcHBlbmQ6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsIHRydWUsIGZhbHNlLCBmdW5jdGlvbihlbGVtKXsNCgkJCWlmICh0aGlzLm5vZGVUeXBlID09IDEpDQoJCQkJdGhpcy5hcHBlbmRDaGlsZCggZWxlbSApOw0KCQl9KTsNCgl9LA0KDQoJcHJlcGVuZDogZnVuY3Rpb24oKSB7DQoJCXJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgdHJ1ZSwgdHJ1ZSwgZnVuY3Rpb24oZWxlbSl7DQoJCQlpZiAodGhpcy5ub2RlVHlwZSA9PSAxKQ0KCQkJCXRoaXMuaW5zZXJ0QmVmb3JlKCBlbGVtLCB0aGlzLmZpcnN0Q2hpbGQgKTsNCgkJfSk7DQoJfSwNCgkNCgliZWZvcmU6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsIGZhbHNlLCBmYWxzZSwgZnVuY3Rpb24oZWxlbSl7DQoJCQl0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBlbGVtLCB0aGlzICk7DQoJCX0pOw0KCX0sDQoNCglhZnRlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgZmFsc2UsIHRydWUsIGZ1bmN0aW9uKGVsZW0pew0KCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5uZXh0U2libGluZyApOw0KCQl9KTsNCgl9LA0KDQoJZW5kOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIHRoaXMucHJldk9iamVjdCB8fCBqUXVlcnkoIFtdICk7DQoJfSwNCg0KCWZpbmQ6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsNCgkJdmFyIGVsZW1zID0galF1ZXJ5Lm1hcCh0aGlzLCBmdW5jdGlvbihlbGVtKXsNCgkJCXJldHVybiBqUXVlcnkuZmluZCggc2VsZWN0b3IsIGVsZW0gKTsNCgkJfSk7DQoNCgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCAvW14rPl0gW14rPl0vLnRlc3QoIHNlbGVjdG9yICkgfHwgc2VsZWN0b3IuaW5kZXhPZigiLi4iKSA+IC0xID8NCgkJCWpRdWVyeS51bmlxdWUoIGVsZW1zICkgOg0KCQkJZWxlbXMgKTsNCgl9LA0KDQoJY2xvbmU6IGZ1bmN0aW9uKCBldmVudHMgKSB7DQoJCS8vIERvIHRoZSBjbG9uZQ0KCQl2YXIgcmV0ID0gdGhpcy5tYXAoZnVuY3Rpb24oKXsNCgkJCWlmICggalF1ZXJ5LmJyb3dzZXIubXNpZSAmJiAhalF1ZXJ5LmlzWE1MRG9jKHRoaXMpICkgew0KCQkJCS8vIElFIGNvcGllcyBldmVudHMgYm91bmQgdmlhIGF0dGFjaEV2ZW50IHdoZW4NCgkJCQkvLyB1c2luZyBjbG9uZU5vZGUuIENhbGxpbmcgZGV0YWNoRXZlbnQgb24gdGhlDQoJCQkJLy8gY2xvbmUgd2lsbCBhbHNvIHJlbW92ZSB0aGUgZXZlbnRzIGZyb20gdGhlIG9yaWduYWwNCgkJCQkvLyBJbiBvcmRlciB0byBnZXQgYXJvdW5kIHRoaXMsIHdlIHVzZSBpbm5lckhUTUwuDQoJCQkJLy8gVW5mb3J0dW5hdGVseSwgdGhpcyBtZWFucyBzb21lIG1vZGlmaWNhdGlvbnMgdG8gDQoJCQkJLy8gYXR0cmlidXRlcyBpbiBJRSB0aGF0IGFyZSBhY3R1YWxseSBvbmx5IHN0b3JlZCANCgkJCQkvLyBhcyBwcm9wZXJ0aWVzIHdpbGwgbm90IGJlIGNvcGllZCAoc3VjaCBhcyB0aGUNCgkJCQkvLyB0aGUgbmFtZSBhdHRyaWJ1dGUgb24gYW4gaW5wdXQpLg0KCQkJCXZhciBjbG9uZSA9IHRoaXMuY2xvbmVOb2RlKHRydWUpLA0KCQkJCQljb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJCQljb250YWluZXIuYXBwZW5kQ2hpbGQoY2xvbmUpOw0KCQkJCXJldHVybiBqUXVlcnkuY2xlYW4oW2NvbnRhaW5lci5pbm5lckhUTUxdKVswXTsNCgkJCX0gZWxzZQ0KCQkJCXJldHVybiB0aGlzLmNsb25lTm9kZSh0cnVlKTsNCgkJfSk7DQoNCgkJLy8gTmVlZCB0byBzZXQgdGhlIGV4cGFuZG8gdG8gbnVsbCBvbiB0aGUgY2xvbmVkIHNldCBpZiBpdCBleGlzdHMNCgkJLy8gcmVtb3ZlRGF0YSBkb2Vzbid0IHdvcmsgaGVyZSwgSUUgcmVtb3ZlcyBpdCBmcm9tIHRoZSBvcmlnaW5hbCBhcyB3ZWxsDQoJCS8vIHRoaXMgaXMgcHJpbWFyaWx5IGZvciBJRSBidXQgdGhlIGRhdGEgZXhwYW5kbyBzaG91bGRuJ3QgYmUgY29waWVkIG92ZXIgaW4gYW55IGJyb3dzZXINCgkJdmFyIGNsb25lID0gcmV0LmZpbmQoIioiKS5hbmRTZWxmKCkuZWFjaChmdW5jdGlvbigpew0KCQkJaWYgKCB0aGlzWyBleHBhbmRvIF0gIT0gdW5kZWZpbmVkICkNCgkJCQl0aGlzWyBleHBhbmRvIF0gPSBudWxsOw0KCQl9KTsNCgkJDQoJCS8vIENvcHkgdGhlIGV2ZW50cyBmcm9tIHRoZSBvcmlnaW5hbCB0byB0aGUgY2xvbmUNCgkJaWYgKCBldmVudHMgPT09IHRydWUgKQ0KCQkJdGhpcy5maW5kKCIqIikuYW5kU2VsZigpLmVhY2goZnVuY3Rpb24oaSl7DQoJCQkJaWYgKHRoaXMubm9kZVR5cGUgPT0gMykNCgkJCQkJcmV0dXJuOw0KCQkJCXZhciBldmVudHMgPSBqUXVlcnkuZGF0YSggdGhpcywgImV2ZW50cyIgKTsNCg0KCQkJCWZvciAoIHZhciB0eXBlIGluIGV2ZW50cyApDQoJCQkJCWZvciAoIHZhciBoYW5kbGVyIGluIGV2ZW50c1sgdHlwZSBdICkNCgkJCQkJCWpRdWVyeS5ldmVudC5hZGQoIGNsb25lWyBpIF0sIHR5cGUsIGV2ZW50c1sgdHlwZSBdWyBoYW5kbGVyIF0sIGV2ZW50c1sgdHlwZSBdWyBoYW5kbGVyIF0uZGF0YSApOw0KCQkJfSk7DQoNCgkJLy8gUmV0dXJuIHRoZSBjbG9uZWQgc2V0DQoJCXJldHVybiByZXQ7DQoJfSwNCg0KCWZpbHRlcjogZnVuY3Rpb24oIHNlbGVjdG9yICkgew0KCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soDQoJCQlqUXVlcnkuaXNGdW5jdGlvbiggc2VsZWN0b3IgKSAmJg0KCQkJalF1ZXJ5LmdyZXAodGhpcywgZnVuY3Rpb24oZWxlbSwgaSl7DQoJCQkJcmV0dXJuIHNlbGVjdG9yLmNhbGwoIGVsZW0sIGkgKTsNCgkJCX0pIHx8DQoNCgkJCWpRdWVyeS5tdWx0aUZpbHRlciggc2VsZWN0b3IsIHRoaXMgKSApOw0KCX0sDQoNCglub3Q6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsNCgkJaWYgKCBzZWxlY3Rvci5jb25zdHJ1Y3RvciA9PSBTdHJpbmcgKQ0KCQkJLy8gdGVzdCBzcGVjaWFsIGNhc2Ugd2hlcmUganVzdCBvbmUgc2VsZWN0b3IgaXMgcGFzc2VkIGluDQoJCQlpZiAoIGlzU2ltcGxlLnRlc3QoIHNlbGVjdG9yICkgKQ0KCQkJCXJldHVybiB0aGlzLnB1c2hTdGFjayggalF1ZXJ5Lm11bHRpRmlsdGVyKCBzZWxlY3RvciwgdGhpcywgdHJ1ZSApICk7DQoJCQllbHNlDQoJCQkJc2VsZWN0b3IgPSBqUXVlcnkubXVsdGlGaWx0ZXIoIHNlbGVjdG9yLCB0aGlzICk7DQoNCgkJdmFyIGlzQXJyYXlMaWtlID0gc2VsZWN0b3IubGVuZ3RoICYmIHNlbGVjdG9yW3NlbGVjdG9yLmxlbmd0aCAtIDFdICE9PSB1bmRlZmluZWQgJiYgIXNlbGVjdG9yLm5vZGVUeXBlOw0KCQlyZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24oKSB7DQoJCQlyZXR1cm4gaXNBcnJheUxpa2UgPyBqUXVlcnkuaW5BcnJheSggdGhpcywgc2VsZWN0b3IgKSA8IDAgOiB0aGlzICE9IHNlbGVjdG9yOw0KCQl9KTsNCgl9LA0KDQoJYWRkOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7DQoJCXJldHVybiAhc2VsZWN0b3IgPyB0aGlzIDogdGhpcy5wdXNoU3RhY2soIGpRdWVyeS5tZXJnZSggDQoJCQl0aGlzLmdldCgpLA0KCQkJc2VsZWN0b3IuY29uc3RydWN0b3IgPT0gU3RyaW5nID8gDQoJCQkJalF1ZXJ5KCBzZWxlY3RvciApLmdldCgpIDoNCgkJCQlzZWxlY3Rvci5sZW5ndGggIT0gdW5kZWZpbmVkICYmICghc2VsZWN0b3Iubm9kZU5hbWUgfHwgalF1ZXJ5Lm5vZGVOYW1lKHNlbGVjdG9yLCAiZm9ybSIpKSA/DQoJCQkJCXNlbGVjdG9yIDogW3NlbGVjdG9yXSApICk7DQoJfSwNCg0KCWlzOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7DQoJCXJldHVybiBzZWxlY3RvciA/DQoJCQlqUXVlcnkubXVsdGlGaWx0ZXIoIHNlbGVjdG9yLCB0aGlzICkubGVuZ3RoID4gMCA6DQoJCQlmYWxzZTsNCgl9LA0KDQoJaGFzQ2xhc3M6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsNCgkJcmV0dXJuIHRoaXMuaXMoICIuIiArIHNlbGVjdG9yICk7DQoJfSwNCgkNCgl2YWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsNCgkJaWYgKCB2YWx1ZSA9PSB1bmRlZmluZWQgKSB7DQoNCgkJCWlmICggdGhpcy5sZW5ndGggKSB7DQoJCQkJdmFyIGVsZW0gPSB0aGlzWzBdOw0KDQoJCQkJLy8gV2UgbmVlZCB0byBoYW5kbGUgc2VsZWN0IGJveGVzIHNwZWNpYWwNCgkJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgInNlbGVjdCIgKSApIHsNCgkJCQkJdmFyIGluZGV4ID0gZWxlbS5zZWxlY3RlZEluZGV4LA0KCQkJCQkJdmFsdWVzID0gW10sDQoJCQkJCQlvcHRpb25zID0gZWxlbS5vcHRpb25zLA0KCQkJCQkJb25lID0gZWxlbS50eXBlID09ICJzZWxlY3Qtb25lIjsNCgkJCQkJDQoJCQkJCS8vIE5vdGhpbmcgd2FzIHNlbGVjdGVkDQoJCQkJCWlmICggaW5kZXggPCAwICkNCgkJCQkJCXJldHVybiBudWxsOw0KDQoJCQkJCS8vIExvb3AgdGhyb3VnaCBhbGwgdGhlIHNlbGVjdGVkIG9wdGlvbnMNCgkJCQkJZm9yICggdmFyIGkgPSBvbmUgPyBpbmRleCA6IDAsIG1heCA9IG9uZSA/IGluZGV4ICsgMSA6IG9wdGlvbnMubGVuZ3RoOyBpIDwgbWF4OyBpKysgKSB7DQoJCQkJCQl2YXIgb3B0aW9uID0gb3B0aW9uc1sgaSBdOw0KDQoJCQkJCQlpZiAoIG9wdGlvbi5zZWxlY3RlZCApIHsNCgkJCQkJCQkvLyBHZXQgdGhlIHNwZWNpZmMgdmFsdWUgZm9yIHRoZSBvcHRpb24NCgkJCQkJCQl2YWx1ZSA9IGpRdWVyeS5icm93c2VyLm1zaWUgJiYgIW9wdGlvbi5hdHRyaWJ1dGVzLnZhbHVlLnNwZWNpZmllZCA/IG9wdGlvbi50ZXh0IDogb3B0aW9uLnZhbHVlOw0KCQkJCQkJCQ0KCQkJCQkJCS8vIFdlIGRvbid0IG5lZWQgYW4gYXJyYXkgZm9yIG9uZSBzZWxlY3RzDQoJCQkJCQkJaWYgKCBvbmUgKQ0KCQkJCQkJCQlyZXR1cm4gdmFsdWU7DQoJCQkJCQkJDQoJCQkJCQkJLy8gTXVsdGktU2VsZWN0cyByZXR1cm4gYW4gYXJyYXkNCgkJCQkJCQl2YWx1ZXMucHVzaCggdmFsdWUgKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQkNCgkJCQkJcmV0dXJuIHZhbHVlczsNCgkJCQkJDQoJCQkJLy8gRXZlcnl0aGluZyBlbHNlLCB3ZSBqdXN0IGdyYWIgdGhlIHZhbHVlDQoJCQkJfSBlbHNlDQoJCQkJCXJldHVybiAodGhpc1swXS52YWx1ZSB8fCAiIikucmVwbGFjZSgvXHIvZywgIiIpOw0KDQoJCQl9DQoNCgkJCXJldHVybiB1bmRlZmluZWQ7DQoJCX0NCg0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7DQoJCQlpZiAoIHRoaXMubm9kZVR5cGUgIT0gMSApDQoJCQkJcmV0dXJuOw0KDQoJCQlpZiAoIHZhbHVlLmNvbnN0cnVjdG9yID09IEFycmF5ICYmIC9yYWRpb3xjaGVja2JveC8udGVzdCggdGhpcy50eXBlICkgKQ0KCQkJCXRoaXMuY2hlY2tlZCA9IChqUXVlcnkuaW5BcnJheSh0aGlzLnZhbHVlLCB2YWx1ZSkgPj0gMCB8fA0KCQkJCQlqUXVlcnkuaW5BcnJheSh0aGlzLm5hbWUsIHZhbHVlKSA+PSAwKTsNCg0KCQkJZWxzZSBpZiAoIGpRdWVyeS5ub2RlTmFtZSggdGhpcywgInNlbGVjdCIgKSApIHsNCgkJCQl2YXIgdmFsdWVzID0gdmFsdWUuY29uc3RydWN0b3IgPT0gQXJyYXkgPw0KCQkJCQl2YWx1ZSA6DQoJCQkJCVsgdmFsdWUgXTsNCg0KCQkJCWpRdWVyeSggIm9wdGlvbiIsIHRoaXMgKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJCXRoaXMuc2VsZWN0ZWQgPSAoalF1ZXJ5LmluQXJyYXkoIHRoaXMudmFsdWUsIHZhbHVlcyApID49IDAgfHwNCgkJCQkJCWpRdWVyeS5pbkFycmF5KCB0aGlzLnRleHQsIHZhbHVlcyApID49IDApOw0KCQkJCX0pOw0KDQoJCQkJaWYgKCAhdmFsdWVzLmxlbmd0aCApDQoJCQkJCXRoaXMuc2VsZWN0ZWRJbmRleCA9IC0xOw0KDQoJCQl9IGVsc2UNCgkJCQl0aGlzLnZhbHVlID0gdmFsdWU7DQoJCX0pOw0KCX0sDQoJDQoJaHRtbDogZnVuY3Rpb24oIHZhbHVlICkgew0KCQlyZXR1cm4gdmFsdWUgPT0gdW5kZWZpbmVkID8NCgkJCSh0aGlzLmxlbmd0aCA/DQoJCQkJdGhpc1swXS5pbm5lckhUTUwgOg0KCQkJCW51bGwpIDoNCgkJCXRoaXMuZW1wdHkoKS5hcHBlbmQoIHZhbHVlICk7DQoJfSwNCg0KCXJlcGxhY2VXaXRoOiBmdW5jdGlvbiggdmFsdWUgKSB7DQoJCXJldHVybiB0aGlzLmFmdGVyKCB2YWx1ZSApLnJlbW92ZSgpOw0KCX0sDQoNCgllcTogZnVuY3Rpb24oIGkgKSB7DQoJCXJldHVybiB0aGlzLnNsaWNlKCBpLCBpICsgMSApOw0KCX0sDQoNCglzbGljZTogZnVuY3Rpb24oKSB7DQoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggQXJyYXkucHJvdG90eXBlLnNsaWNlLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSApOw0KCX0sDQoNCgltYXA6IGZ1bmN0aW9uKCBjYWxsYmFjayApIHsNCgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkubWFwKHRoaXMsIGZ1bmN0aW9uKGVsZW0sIGkpew0KCQkJcmV0dXJuIGNhbGxiYWNrLmNhbGwoIGVsZW0sIGksIGVsZW0gKTsNCgkJfSkpOw0KCX0sDQoNCglhbmRTZWxmOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIHRoaXMuYWRkKCB0aGlzLnByZXZPYmplY3QgKTsNCgl9LA0KDQoJZGF0YTogZnVuY3Rpb24oIGtleSwgdmFsdWUgKXsNCgkJdmFyIHBhcnRzID0ga2V5LnNwbGl0KCIuIik7DQoJCXBhcnRzWzFdID0gcGFydHNbMV0gPyAiLiIgKyBwYXJ0c1sxXSA6ICIiOw0KDQoJCWlmICggdmFsdWUgPT0gbnVsbCApIHsNCgkJCXZhciBkYXRhID0gdGhpcy50cmlnZ2VySGFuZGxlcigiZ2V0RGF0YSIgKyBwYXJ0c1sxXSArICIhIiwgW3BhcnRzWzBdXSk7DQoJCQkNCgkJCWlmICggZGF0YSA9PSB1bmRlZmluZWQgJiYgdGhpcy5sZW5ndGggKQ0KCQkJCWRhdGEgPSBqUXVlcnkuZGF0YSggdGhpc1swXSwga2V5ICk7DQoNCgkJCXJldHVybiBkYXRhID09IG51bGwgJiYgcGFydHNbMV0gPw0KCQkJCXRoaXMuZGF0YSggcGFydHNbMF0gKSA6DQoJCQkJZGF0YTsNCgkJfSBlbHNlDQoJCQlyZXR1cm4gdGhpcy50cmlnZ2VyKCJzZXREYXRhIiArIHBhcnRzWzFdICsgIiEiLCBbcGFydHNbMF0sIHZhbHVlXSkuZWFjaChmdW5jdGlvbigpew0KCQkJCWpRdWVyeS5kYXRhKCB0aGlzLCBrZXksIHZhbHVlICk7DQoJCQl9KTsNCgl9LA0KDQoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApew0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7DQoJCQlqUXVlcnkucmVtb3ZlRGF0YSggdGhpcywga2V5ICk7DQoJCX0pOw0KCX0sDQoJDQoJZG9tTWFuaXA6IGZ1bmN0aW9uKCBhcmdzLCB0YWJsZSwgcmV2ZXJzZSwgY2FsbGJhY2sgKSB7DQoJCXZhciBjbG9uZSA9IHRoaXMubGVuZ3RoID4gMSwgZWxlbXM7IA0KDQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsNCgkJCWlmICggIWVsZW1zICkgew0KCQkJCWVsZW1zID0galF1ZXJ5LmNsZWFuKCBhcmdzLCB0aGlzLm93bmVyRG9jdW1lbnQgKTsNCg0KCQkJCWlmICggcmV2ZXJzZSApDQoJCQkJCWVsZW1zLnJldmVyc2UoKTsNCgkJCX0NCg0KCQkJdmFyIG9iaiA9IHRoaXM7DQoNCgkJCWlmICggdGFibGUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAidGFibGUiICkgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtc1swXSwgInRyIiApICkNCgkJCQlvYmogPSB0aGlzLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0Ym9keSIpWzBdIHx8IHRoaXMuYXBwZW5kQ2hpbGQoIHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpICk7DQoNCgkJCXZhciBzY3JpcHRzID0galF1ZXJ5KCBbXSApOw0KDQoJCQlqUXVlcnkuZWFjaChlbGVtcywgZnVuY3Rpb24oKXsNCgkJCQl2YXIgZWxlbSA9IGNsb25lID8NCgkJCQkJalF1ZXJ5KCB0aGlzICkuY2xvbmUoIHRydWUgKVswXSA6DQoJCQkJCXRoaXM7DQoNCgkJCQkvLyBleGVjdXRlIGFsbCBzY3JpcHRzIGFmdGVyIHRoZSBlbGVtZW50cyBoYXZlIGJlZW4gaW5qZWN0ZWQNCgkJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgInNjcmlwdCIgKSApIHsNCgkJCQkJc2NyaXB0cyA9IHNjcmlwdHMuYWRkKCBlbGVtICk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJLy8gUmVtb3ZlIGFueSBpbm5lciBzY3JpcHRzIGZvciBsYXRlciBldmFsdWF0aW9uDQoJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PSAxICkNCgkJCQkJCXNjcmlwdHMgPSBzY3JpcHRzLmFkZCggalF1ZXJ5KCAic2NyaXB0IiwgZWxlbSApLnJlbW92ZSgpICk7DQoNCgkJCQkJLy8gSW5qZWN0IHRoZSBlbGVtZW50cyBpbnRvIHRoZSBkb2N1bWVudA0KCQkJCQljYWxsYmFjay5jYWxsKCBvYmosIGVsZW0gKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJc2NyaXB0cy5lYWNoKCBldmFsU2NyaXB0ICk7DQoJCX0pOw0KCX0NCn07DQoNCi8vIEdpdmUgdGhlIGluaXQgZnVuY3Rpb24gdGhlIGpRdWVyeSBwcm90b3R5cGUgZm9yIGxhdGVyIGluc3RhbnRpYXRpb24NCmpRdWVyeS5wcm90b3R5cGUuaW5pdC5wcm90b3R5cGUgPSBqUXVlcnkucHJvdG90eXBlOw0KDQpmdW5jdGlvbiBldmFsU2NyaXB0KCBpLCBlbGVtICkgew0KCWlmICggZWxlbS5zcmMgKQ0KCQlqUXVlcnkuYWpheCh7DQoJCQl1cmw6IGVsZW0uc3JjLA0KCQkJYXN5bmM6IGZhbHNlLA0KCQkJZGF0YVR5cGU6ICJzY3JpcHQiDQoJCX0pOw0KDQoJZWxzZQ0KCQlqUXVlcnkuZ2xvYmFsRXZhbCggZWxlbS50ZXh0IHx8IGVsZW0udGV4dENvbnRlbnQgfHwgZWxlbS5pbm5lckhUTUwgfHwgIiIgKTsNCg0KCWlmICggZWxlbS5wYXJlbnROb2RlICkNCgkJZWxlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBlbGVtICk7DQp9DQoNCmpRdWVyeS5leHRlbmQgPSBqUXVlcnkuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKSB7DQoJLy8gY29weSByZWZlcmVuY2UgdG8gdGFyZ2V0IG9iamVjdA0KCXZhciB0YXJnZXQgPSBhcmd1bWVudHNbMF0gfHwge30sIGkgPSAxLCBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLCBkZWVwID0gZmFsc2UsIG9wdGlvbnM7DQoNCgkvLyBIYW5kbGUgYSBkZWVwIGNvcHkgc2l0dWF0aW9uDQoJaWYgKCB0YXJnZXQuY29uc3RydWN0b3IgPT0gQm9vbGVhbiApIHsNCgkJZGVlcCA9IHRhcmdldDsNCgkJdGFyZ2V0ID0gYXJndW1lbnRzWzFdIHx8IHt9Ow0KCQkvLyBza2lwIHRoZSBib29sZWFuIGFuZCB0aGUgdGFyZ2V0DQoJCWkgPSAyOw0KCX0NCg0KCS8vIEhhbmRsZSBjYXNlIHdoZW4gdGFyZ2V0IGlzIGEgc3RyaW5nIG9yIHNvbWV0aGluZyAocG9zc2libGUgaW4gZGVlcCBjb3B5KQ0KCWlmICggdHlwZW9mIHRhcmdldCAhPSAib2JqZWN0IiAmJiB0eXBlb2YgdGFyZ2V0ICE9ICJmdW5jdGlvbiIgKQ0KCQl0YXJnZXQgPSB7fTsNCg0KCS8vIGV4dGVuZCBqUXVlcnkgaXRzZWxmIGlmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHBhc3NlZA0KCWlmICggbGVuZ3RoID09IDEgKSB7DQoJCXRhcmdldCA9IHRoaXM7DQoJCWkgPSAwOw0KCX0NCg0KCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkNCgkJLy8gT25seSBkZWFsIHdpdGggbm9uLW51bGwvdW5kZWZpbmVkIHZhbHVlcw0KCQlpZiAoIChvcHRpb25zID0gYXJndW1lbnRzWyBpIF0pICE9IG51bGwgKQ0KCQkJLy8gRXh0ZW5kIHRoZSBiYXNlIG9iamVjdA0KCQkJZm9yICggdmFyIG5hbWUgaW4gb3B0aW9ucyApIHsNCgkJCQkvLyBQcmV2ZW50IG5ldmVyLWVuZGluZyBsb29wDQoJCQkJaWYgKCB0YXJnZXQgPT09IG9wdGlvbnNbIG5hbWUgXSApDQoJCQkJCWNvbnRpbnVlOw0KDQoJCQkJLy8gUmVjdXJzZSBpZiB3ZSdyZSBtZXJnaW5nIG9iamVjdCB2YWx1ZXMNCgkJCQlpZiAoIGRlZXAgJiYgb3B0aW9uc1sgbmFtZSBdICYmIHR5cGVvZiBvcHRpb25zWyBuYW1lIF0gPT0gIm9iamVjdCIgJiYgdGFyZ2V0WyBuYW1lIF0gJiYgIW9wdGlvbnNbIG5hbWUgXS5ub2RlVHlwZSApDQoJCQkJCXRhcmdldFsgbmFtZSBdID0galF1ZXJ5LmV4dGVuZCggdGFyZ2V0WyBuYW1lIF0sIG9wdGlvbnNbIG5hbWUgXSApOw0KDQoJCQkJLy8gRG9uJ3QgYnJpbmcgaW4gdW5kZWZpbmVkIHZhbHVlcw0KCQkJCWVsc2UgaWYgKCBvcHRpb25zWyBuYW1lIF0gIT0gdW5kZWZpbmVkICkNCgkJCQkJdGFyZ2V0WyBuYW1lIF0gPSBvcHRpb25zWyBuYW1lIF07DQoNCgkJCX0NCg0KCS8vIFJldHVybiB0aGUgbW9kaWZpZWQgb2JqZWN0DQoJcmV0dXJuIHRhcmdldDsNCn07DQoNCnZhciBleHBhbmRvID0gImpRdWVyeSIgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpLCB1dWlkID0gMCwgd2luZG93RGF0YSA9IHt9Ow0KDQovLyBleGNsdWRlIHRoZSBmb2xsb3dpbmcgY3NzIHByb3BlcnRpZXMgdG8gYWRkIHB4DQp2YXIgZXhjbHVkZSA9IC96LT9pbmRleHxmb250LT93ZWlnaHR8b3BhY2l0eXx6b29tfGxpbmUtP2hlaWdodC9pOw0KDQpqUXVlcnkuZXh0ZW5kKHsNCglub0NvbmZsaWN0OiBmdW5jdGlvbiggZGVlcCApIHsNCgkJd2luZG93LiQgPSBfJDsNCg0KCQlpZiAoIGRlZXAgKQ0KCQkJd2luZG93LmpRdWVyeSA9IF9qUXVlcnk7DQoNCgkJcmV0dXJuIGpRdWVyeTsNCgl9LA0KDQoJLy8gU2VlIHRlc3QvdW5pdC9jb3JlLmpzIGZvciBkZXRhaWxzIGNvbmNlcm5pbmcgdGhpcyBmdW5jdGlvbi4NCglpc0Z1bmN0aW9uOiBmdW5jdGlvbiggZm4gKSB7DQoJCXJldHVybiAhIWZuICYmIHR5cGVvZiBmbiAhPSAic3RyaW5nIiAmJiAhZm4ubm9kZU5hbWUgJiYgDQoJCQlmbi5jb25zdHJ1Y3RvciAhPSBBcnJheSAmJiAvZnVuY3Rpb24vaS50ZXN0KCBmbiArICIiICk7DQoJfSwNCgkNCgkvLyBjaGVjayBpZiBhbiBlbGVtZW50IGlzIGluIGEgKG9yIGlzIGFuKSBYTUwgZG9jdW1lbnQNCglpc1hNTERvYzogZnVuY3Rpb24oIGVsZW0gKSB7DQoJCXJldHVybiBlbGVtLmRvY3VtZW50RWxlbWVudCAmJiAhZWxlbS5ib2R5IHx8DQoJCQllbGVtLnRhZ05hbWUgJiYgZWxlbS5vd25lckRvY3VtZW50ICYmICFlbGVtLm93bmVyRG9jdW1lbnQuYm9keTsNCgl9LA0KDQoJLy8gRXZhbHVsYXRlcyBhIHNjcmlwdCBpbiBhIGdsb2JhbCBjb250ZXh0DQoJZ2xvYmFsRXZhbDogZnVuY3Rpb24oIGRhdGEgKSB7DQoJCWRhdGEgPSBqUXVlcnkudHJpbSggZGF0YSApOw0KDQoJCWlmICggZGF0YSApIHsNCgkJCS8vIEluc3BpcmVkIGJ5IGNvZGUgYnkgQW5kcmVhIEdpYW1tYXJjaGkNCgkJCS8vIGh0dHA6Ly93ZWJyZWZsZWN0aW9uLmJsb2dzcG90LmNvbS8yMDA3LzA4L2dsb2JhbC1zY29wZS1ldmFsdWF0aW9uLWFuZC1kb20uaHRtbA0KCQkJdmFyIGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwNCgkJCQlzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCg0KCQkJc2NyaXB0LnR5cGUgPSAidGV4dC9qYXZhc2NyaXB0IjsNCgkJCWlmICggalF1ZXJ5LmJyb3dzZXIubXNpZSApDQoJCQkJc2NyaXB0LnRleHQgPSBkYXRhOw0KCQkJZWxzZQ0KCQkJCXNjcmlwdC5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIGRhdGEgKSApOw0KDQoJCQloZWFkLmFwcGVuZENoaWxkKCBzY3JpcHQgKTsNCgkJCWhlYWQucmVtb3ZlQ2hpbGQoIHNjcmlwdCApOw0KCQl9DQoJfSwNCg0KCW5vZGVOYW1lOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsNCgkJcmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09IG5hbWUudG9VcHBlckNhc2UoKTsNCgl9LA0KCQ0KCWNhY2hlOiB7fSwNCgkNCglkYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgZGF0YSApIHsNCgkJZWxlbSA9IGVsZW0gPT0gd2luZG93ID8NCgkJCXdpbmRvd0RhdGEgOg0KCQkJZWxlbTsNCg0KCQl2YXIgaWQgPSBlbGVtWyBleHBhbmRvIF07DQoNCgkJLy8gQ29tcHV0ZSBhIHVuaXF1ZSBJRCBmb3IgdGhlIGVsZW1lbnQNCgkJaWYgKCAhaWQgKSANCgkJCWlkID0gZWxlbVsgZXhwYW5kbyBdID0gKyt1dWlkOw0KDQoJCS8vIE9ubHkgZ2VuZXJhdGUgdGhlIGRhdGEgY2FjaGUgaWYgd2UncmUNCgkJLy8gdHJ5aW5nIHRvIGFjY2VzcyBvciBtYW5pcHVsYXRlIGl0DQoJCWlmICggbmFtZSAmJiAhalF1ZXJ5LmNhY2hlWyBpZCBdICkNCgkJCWpRdWVyeS5jYWNoZVsgaWQgXSA9IHt9Ow0KCQkNCgkJLy8gUHJldmVudCBvdmVycmlkaW5nIHRoZSBuYW1lZCBjYWNoZSB3aXRoIHVuZGVmaW5lZCB2YWx1ZXMNCgkJaWYgKCBkYXRhICE9IHVuZGVmaW5lZCApDQoJCQlqUXVlcnkuY2FjaGVbIGlkIF1bIG5hbWUgXSA9IGRhdGE7DQoJCQ0KCQkvLyBSZXR1cm4gdGhlIG5hbWVkIGNhY2hlIGRhdGEsIG9yIHRoZSBJRCBmb3IgdGhlIGVsZW1lbnQJDQoJCXJldHVybiBuYW1lID8NCgkJCWpRdWVyeS5jYWNoZVsgaWQgXVsgbmFtZSBdIDoNCgkJCWlkOw0KCX0sDQoJDQoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7DQoJCWVsZW0gPSBlbGVtID09IHdpbmRvdyA/DQoJCQl3aW5kb3dEYXRhIDoNCgkJCWVsZW07DQoNCgkJdmFyIGlkID0gZWxlbVsgZXhwYW5kbyBdOw0KDQoJCS8vIElmIHdlIHdhbnQgdG8gcmVtb3ZlIGEgc3BlY2lmaWMgc2VjdGlvbiBvZiB0aGUgZWxlbWVudCdzIGRhdGENCgkJaWYgKCBuYW1lICkgew0KCQkJaWYgKCBqUXVlcnkuY2FjaGVbIGlkIF0gKSB7DQoJCQkJLy8gUmVtb3ZlIHRoZSBzZWN0aW9uIG9mIGNhY2hlIGRhdGENCgkJCQlkZWxldGUgalF1ZXJ5LmNhY2hlWyBpZCBdWyBuYW1lIF07DQoNCgkJCQkvLyBJZiB3ZSd2ZSByZW1vdmVkIGFsbCB0aGUgZGF0YSwgcmVtb3ZlIHRoZSBlbGVtZW50J3MgY2FjaGUNCgkJCQluYW1lID0gIiI7DQoNCgkJCQlmb3IgKCBuYW1lIGluIGpRdWVyeS5jYWNoZVsgaWQgXSApDQoJCQkJCWJyZWFrOw0KDQoJCQkJaWYgKCAhbmFtZSApDQoJCQkJCWpRdWVyeS5yZW1vdmVEYXRhKCBlbGVtICk7DQoJCQl9DQoNCgkJLy8gT3RoZXJ3aXNlLCB3ZSB3YW50IHRvIHJlbW92ZSBhbGwgb2YgdGhlIGVsZW1lbnQncyBkYXRhDQoJCX0gZWxzZSB7DQoJCQkvLyBDbGVhbiB1cCB0aGUgZWxlbWVudCBleHBhbmRvDQoJCQl0cnkgew0KCQkJCWRlbGV0ZSBlbGVtWyBleHBhbmRvIF07DQoJCQl9IGNhdGNoKGUpew0KCQkJCS8vIElFIGhhcyB0cm91YmxlIGRpcmVjdGx5IHJlbW92aW5nIHRoZSBleHBhbmRvDQoJCQkJLy8gYnV0IGl0J3Mgb2sgd2l0aCB1c2luZyByZW1vdmVBdHRyaWJ1dGUNCgkJCQlpZiAoIGVsZW0ucmVtb3ZlQXR0cmlidXRlICkNCgkJCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGV4cGFuZG8gKTsNCgkJCX0NCg0KCQkJLy8gQ29tcGxldGVseSByZW1vdmUgdGhlIGRhdGEgY2FjaGUNCgkJCWRlbGV0ZSBqUXVlcnkuY2FjaGVbIGlkIF07DQoJCX0NCgl9LA0KDQoJLy8gYXJncyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQ0KCWVhY2g6IGZ1bmN0aW9uKCBvYmplY3QsIGNhbGxiYWNrLCBhcmdzICkgew0KCQlpZiAoIGFyZ3MgKSB7DQoJCQlpZiAoIG9iamVjdC5sZW5ndGggPT0gdW5kZWZpbmVkICkgew0KCQkJCWZvciAoIHZhciBuYW1lIGluIG9iamVjdCApDQoJCQkJCWlmICggY2FsbGJhY2suYXBwbHkoIG9iamVjdFsgbmFtZSBdLCBhcmdzICkgPT09IGZhbHNlICkNCgkJCQkJCWJyZWFrOw0KCQkJfSBlbHNlDQoJCQkJZm9yICggdmFyIGkgPSAwLCBsZW5ndGggPSBvYmplY3QubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKysgKQ0KCQkJCQlpZiAoIGNhbGxiYWNrLmFwcGx5KCBvYmplY3RbIGkgXSwgYXJncyApID09PSBmYWxzZSApDQoJCQkJCQlicmVhazsNCg0KCQkvLyBBIHNwZWNpYWwsIGZhc3QsIGNhc2UgZm9yIHRoZSBtb3N0IGNvbW1vbiB1c2Ugb2YgZWFjaA0KCQl9IGVsc2Ugew0KCQkJaWYgKCBvYmplY3QubGVuZ3RoID09IHVuZGVmaW5lZCApIHsNCgkJCQlmb3IgKCB2YXIgbmFtZSBpbiBvYmplY3QgKQ0KCQkJCQlpZiAoIGNhbGxiYWNrLmNhbGwoIG9iamVjdFsgbmFtZSBdLCBuYW1lLCBvYmplY3RbIG5hbWUgXSApID09PSBmYWxzZSApDQoJCQkJCQlicmVhazsNCgkJCX0gZWxzZQ0KCQkJCWZvciAoIHZhciBpID0gMCwgbGVuZ3RoID0gb2JqZWN0Lmxlbmd0aCwgdmFsdWUgPSBvYmplY3RbMF07IA0KCQkJCQlpIDwgbGVuZ3RoICYmIGNhbGxiYWNrLmNhbGwoIHZhbHVlLCBpLCB2YWx1ZSApICE9PSBmYWxzZTsgdmFsdWUgPSBvYmplY3RbKytpXSApe30NCgkJfQ0KDQoJCXJldHVybiBvYmplY3Q7DQoJfSwNCgkNCglwcm9wOiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIHR5cGUsIGksIG5hbWUgKSB7DQoJCQkvLyBIYW5kbGUgZXhlY3V0YWJsZSBmdW5jdGlvbnMNCgkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKQ0KCQkJCXZhbHVlID0gdmFsdWUuY2FsbCggZWxlbSwgaSApOw0KCQkJCQ0KCQkJLy8gSGFuZGxlIHBhc3NpbmcgaW4gYSBudW1iZXIgdG8gYSBDU1MgcHJvcGVydHkNCgkJCXJldHVybiB2YWx1ZSAmJiB2YWx1ZS5jb25zdHJ1Y3RvciA9PSBOdW1iZXIgJiYgdHlwZSA9PSAiY3VyQ1NTIiAmJiAhZXhjbHVkZS50ZXN0KCBuYW1lICkgPw0KCQkJCXZhbHVlICsgInB4IiA6DQoJCQkJdmFsdWU7DQoJfSwNCg0KCWNsYXNzTmFtZTogew0KCQkvLyBpbnRlcm5hbCBvbmx5LCB1c2UgYWRkQ2xhc3MoImNsYXNzIikNCgkJYWRkOiBmdW5jdGlvbiggZWxlbSwgY2xhc3NOYW1lcyApIHsNCgkJCWpRdWVyeS5lYWNoKChjbGFzc05hbWVzIHx8ICIiKS5zcGxpdCgvXHMrLyksIGZ1bmN0aW9uKGksIGNsYXNzTmFtZSl7DQoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09IDEgJiYgIWpRdWVyeS5jbGFzc05hbWUuaGFzKCBlbGVtLmNsYXNzTmFtZSwgY2xhc3NOYW1lICkgKQ0KCQkJCQllbGVtLmNsYXNzTmFtZSArPSAoZWxlbS5jbGFzc05hbWUgPyAiICIgOiAiIikgKyBjbGFzc05hbWU7DQoJCQl9KTsNCgkJfSwNCg0KCQkvLyBpbnRlcm5hbCBvbmx5LCB1c2UgcmVtb3ZlQ2xhc3MoImNsYXNzIikNCgkJcmVtb3ZlOiBmdW5jdGlvbiggZWxlbSwgY2xhc3NOYW1lcyApIHsNCgkJCWlmIChlbGVtLm5vZGVUeXBlID09IDEpDQoJCQkJZWxlbS5jbGFzc05hbWUgPSBjbGFzc05hbWVzICE9IHVuZGVmaW5lZCA/DQoJCQkJCWpRdWVyeS5ncmVwKGVsZW0uY2xhc3NOYW1lLnNwbGl0KC9ccysvKSwgZnVuY3Rpb24oY2xhc3NOYW1lKXsNCgkJCQkJCXJldHVybiAhalF1ZXJ5LmNsYXNzTmFtZS5oYXMoIGNsYXNzTmFtZXMsIGNsYXNzTmFtZSApOwkNCgkJCQkJfSkuam9pbigiICIpIDoNCgkJCQkJIiI7DQoJCX0sDQoNCgkJLy8gaW50ZXJuYWwgb25seSwgdXNlIGlzKCIuY2xhc3MiKQ0KCQloYXM6IGZ1bmN0aW9uKCBlbGVtLCBjbGFzc05hbWUgKSB7DQoJCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoIGNsYXNzTmFtZSwgKGVsZW0uY2xhc3NOYW1lIHx8IGVsZW0pLnRvU3RyaW5nKCkuc3BsaXQoL1xzKy8pICkgPiAtMTsNCgkJfQ0KCX0sDQoNCgkvLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zDQoJc3dhcDogZnVuY3Rpb24oIGVsZW0sIG9wdGlvbnMsIGNhbGxiYWNrICkgew0KCQl2YXIgb2xkID0ge307DQoJCS8vIFJlbWVtYmVyIHRoZSBvbGQgdmFsdWVzLCBhbmQgaW5zZXJ0IHRoZSBuZXcgb25lcw0KCQlmb3IgKCB2YXIgbmFtZSBpbiBvcHRpb25zICkgew0KCQkJb2xkWyBuYW1lIF0gPSBlbGVtLnN0eWxlWyBuYW1lIF07DQoJCQllbGVtLnN0eWxlWyBuYW1lIF0gPSBvcHRpb25zWyBuYW1lIF07DQoJCX0NCg0KCQljYWxsYmFjay5jYWxsKCBlbGVtICk7DQoNCgkJLy8gUmV2ZXJ0IHRoZSBvbGQgdmFsdWVzDQoJCWZvciAoIHZhciBuYW1lIGluIG9wdGlvbnMgKQ0KCQkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb2xkWyBuYW1lIF07DQoJfSwNCg0KCWNzczogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGZvcmNlICkgew0KCQlpZiAoIG5hbWUgPT0gIndpZHRoIiB8fCBuYW1lID09ICJoZWlnaHQiICkgew0KCQkJdmFyIHZhbCwgcHJvcHMgPSB7IHBvc2l0aW9uOiAiYWJzb2x1dGUiLCB2aXNpYmlsaXR5OiAiaGlkZGVuIiwgZGlzcGxheToiYmxvY2siIH0sIHdoaWNoID0gbmFtZSA9PSAid2lkdGgiID8gWyAiTGVmdCIsICJSaWdodCIgXSA6IFsgIlRvcCIsICJCb3R0b20iIF07DQoJCQ0KCQkJZnVuY3Rpb24gZ2V0V0goKSB7DQoJCQkJdmFsID0gbmFtZSA9PSAid2lkdGgiID8gZWxlbS5vZmZzZXRXaWR0aCA6IGVsZW0ub2Zmc2V0SGVpZ2h0Ow0KCQkJCXZhciBwYWRkaW5nID0gMCwgYm9yZGVyID0gMDsNCgkJCQlqUXVlcnkuZWFjaCggd2hpY2gsIGZ1bmN0aW9uKCkgew0KCQkJCQlwYWRkaW5nICs9IHBhcnNlRmxvYXQoalF1ZXJ5LmN1ckNTUyggZWxlbSwgInBhZGRpbmciICsgdGhpcywgdHJ1ZSkpIHx8IDA7DQoJCQkJCWJvcmRlciArPSBwYXJzZUZsb2F0KGpRdWVyeS5jdXJDU1MoIGVsZW0sICJib3JkZXIiICsgdGhpcyArICJXaWR0aCIsIHRydWUpKSB8fCAwOw0KCQkJCX0pOw0KCQkJCXZhbCAtPSBNYXRoLnJvdW5kKHBhZGRpbmcgKyBib3JkZXIpOw0KCQkJfQ0KCQkNCgkJCWlmICggalF1ZXJ5KGVsZW0pLmlzKCI6dmlzaWJsZSIpICkNCgkJCQlnZXRXSCgpOw0KCQkJZWxzZQ0KCQkJCWpRdWVyeS5zd2FwKCBlbGVtLCBwcm9wcywgZ2V0V0ggKTsNCgkJCQ0KCQkJcmV0dXJuIE1hdGgubWF4KDAsIHZhbCk7DQoJCX0NCgkJDQoJCXJldHVybiBqUXVlcnkuY3VyQ1NTKCBlbGVtLCBuYW1lLCBmb3JjZSApOw0KCX0sDQoNCgljdXJDU1M6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBmb3JjZSApIHsNCgkJdmFyIHJldDsNCg0KCQkvLyBBIGhlbHBlciBtZXRob2QgZm9yIGRldGVybWluaW5nIGlmIGFuIGVsZW1lbnQncyB2YWx1ZXMgYXJlIGJyb2tlbg0KCQlmdW5jdGlvbiBjb2xvciggZWxlbSApIHsNCgkJCWlmICggIWpRdWVyeS5icm93c2VyLnNhZmFyaSApDQoJCQkJcmV0dXJuIGZhbHNlOw0KDQoJCQl2YXIgcmV0ID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSggZWxlbSwgbnVsbCApOw0KCQkJcmV0dXJuICFyZXQgfHwgcmV0LmdldFByb3BlcnR5VmFsdWUoImNvbG9yIikgPT0gIiI7DQoJCX0NCg0KCQkvLyBXZSBuZWVkIHRvIGhhbmRsZSBvcGFjaXR5IHNwZWNpYWwgaW4gSUUNCgkJaWYgKCBuYW1lID09ICJvcGFjaXR5IiAmJiBqUXVlcnkuYnJvd3Nlci5tc2llICkgew0KCQkJcmV0ID0galF1ZXJ5LmF0dHIoIGVsZW0uc3R5bGUsICJvcGFjaXR5IiApOw0KDQoJCQlyZXR1cm4gcmV0ID09ICIiID8NCgkJCQkiMSIgOg0KCQkJCXJldDsNCgkJfQ0KCQkvLyBPcGVyYSBzb21ldGltZXMgd2lsbCBnaXZlIHRoZSB3cm9uZyBkaXNwbGF5IGFuc3dlciwgdGhpcyBmaXhlcyBpdCwgc2VlICMyMDM3DQoJCWlmICggalF1ZXJ5LmJyb3dzZXIub3BlcmEgJiYgbmFtZSA9PSAiZGlzcGxheSIgKSB7DQoJCQl2YXIgc2F2ZSA9IGVsZW0uc3R5bGUub3V0bGluZTsNCgkJCWVsZW0uc3R5bGUub3V0bGluZSA9ICIwIHNvbGlkIGJsYWNrIjsNCgkJCWVsZW0uc3R5bGUub3V0bGluZSA9IHNhdmU7DQoJCX0NCgkJDQoJCS8vIE1ha2Ugc3VyZSB3ZSdyZSB1c2luZyB0aGUgcmlnaHQgbmFtZSBmb3IgZ2V0dGluZyB0aGUgZmxvYXQgdmFsdWUNCgkJaWYgKCBuYW1lLm1hdGNoKCAvZmxvYXQvaSApICkNCgkJCW5hbWUgPSBzdHlsZUZsb2F0Ow0KDQoJCWlmICggIWZvcmNlICYmIGVsZW0uc3R5bGUgJiYgZWxlbS5zdHlsZVsgbmFtZSBdICkNCgkJCXJldCA9IGVsZW0uc3R5bGVbIG5hbWUgXTsNCg0KCQllbHNlIGlmICggZG9jdW1lbnQuZGVmYXVsdFZpZXcgJiYgZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSApIHsNCg0KCQkJLy8gT25seSAiZmxvYXQiIGlzIG5lZWRlZCBoZXJlDQoJCQlpZiAoIG5hbWUubWF0Y2goIC9mbG9hdC9pICkgKQ0KCQkJCW5hbWUgPSAiZmxvYXQiOw0KDQoJCQluYW1lID0gbmFtZS5yZXBsYWNlKCAvKFtBLVpdKS9nLCAiLSQxIiApLnRvTG93ZXJDYXNlKCk7DQoNCgkJCXZhciBnZXRDb21wdXRlZFN0eWxlID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSggZWxlbSwgbnVsbCApOw0KDQoJCQlpZiAoIGdldENvbXB1dGVkU3R5bGUgJiYgIWNvbG9yKCBlbGVtICkgKQ0KCQkJCXJldCA9IGdldENvbXB1dGVkU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSggbmFtZSApOw0KDQoJCQkvLyBJZiB0aGUgZWxlbWVudCBpc24ndCByZXBvcnRpbmcgaXRzIHZhbHVlcyBwcm9wZXJseSBpbiBTYWZhcmkNCgkJCS8vIHRoZW4gc29tZSBkaXNwbGF5OiBub25lIGVsZW1lbnRzIGFyZSBpbnZvbHZlZA0KCQkJZWxzZSB7DQoJCQkJdmFyIHN3YXAgPSBbXSwgc3RhY2sgPSBbXTsNCg0KCQkJCS8vIExvY2F0ZSBhbGwgb2YgdGhlIHBhcmVudCBkaXNwbGF5OiBub25lIGVsZW1lbnRzDQoJCQkJZm9yICggdmFyIGEgPSBlbGVtOyBhICYmIGNvbG9yKGEpOyBhID0gYS5wYXJlbnROb2RlICkNCgkJCQkJc3RhY2sudW5zaGlmdChhKTsNCg0KCQkJCS8vIEdvIHRocm91Z2ggYW5kIG1ha2UgdGhlbSB2aXNpYmxlLCBidXQgaW4gcmV2ZXJzZQ0KCQkJCS8vIChJdCB3b3VsZCBiZSBiZXR0ZXIgaWYgd2Uga25ldyB0aGUgZXhhY3QgZGlzcGxheSB0eXBlIHRoYXQgdGhleSBoYWQpDQoJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgc3RhY2subGVuZ3RoOyBpKysgKQ0KCQkJCQlpZiAoIGNvbG9yKCBzdGFja1sgaSBdICkgKSB7DQoJCQkJCQlzd2FwWyBpIF0gPSBzdGFja1sgaSBdLnN0eWxlLmRpc3BsYXk7DQoJCQkJCQlzdGFja1sgaSBdLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KCQkJCQl9DQoNCgkJCQkvLyBTaW5jZSB3ZSBmbGlwIHRoZSBkaXNwbGF5IHN0eWxlLCB3ZSBoYXZlIHRvIGhhbmRsZSB0aGF0DQoJCQkJLy8gb25lIHNwZWNpYWwsIG90aGVyd2lzZSBnZXQgdGhlIHZhbHVlDQoJCQkJcmV0ID0gbmFtZSA9PSAiZGlzcGxheSIgJiYgc3dhcFsgc3RhY2subGVuZ3RoIC0gMSBdICE9IG51bGwgPw0KCQkJCQkibm9uZSIgOg0KCQkJCQkoIGdldENvbXB1dGVkU3R5bGUgJiYgZ2V0Q29tcHV0ZWRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCBuYW1lICkgKSB8fCAiIjsNCg0KCQkJCS8vIEZpbmFsbHksIHJldmVydCB0aGUgZGlzcGxheSBzdHlsZXMgYmFjaw0KCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IHN3YXAubGVuZ3RoOyBpKysgKQ0KCQkJCQlpZiAoIHN3YXBbIGkgXSAhPSBudWxsICkNCgkJCQkJCXN0YWNrWyBpIF0uc3R5bGUuZGlzcGxheSA9IHN3YXBbIGkgXTsNCgkJCX0NCg0KCQkJLy8gV2Ugc2hvdWxkIGFsd2F5cyBnZXQgYSBudW1iZXIgYmFjayBmcm9tIG9wYWNpdHkNCgkJCWlmICggbmFtZSA9PSAib3BhY2l0eSIgJiYgcmV0ID09ICIiICkNCgkJCQlyZXQgPSAiMSI7DQoNCgkJfSBlbHNlIGlmICggZWxlbS5jdXJyZW50U3R5bGUgKSB7DQoJCQl2YXIgY2FtZWxDYXNlID0gbmFtZS5yZXBsYWNlKC9cLShcdykvZywgZnVuY3Rpb24oYWxsLCBsZXR0ZXIpew0KCQkJCXJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTsNCgkJCX0pOw0KDQoJCQlyZXQgPSBlbGVtLmN1cnJlbnRTdHlsZVsgbmFtZSBdIHx8IGVsZW0uY3VycmVudFN0eWxlWyBjYW1lbENhc2UgXTsNCg0KCQkJLy8gRnJvbSB0aGUgYXdlc29tZSBoYWNrIGJ5IERlYW4gRWR3YXJkcw0KCQkJLy8gaHR0cDovL2VyaWsuZWFlLm5ldC9hcmNoaXZlcy8yMDA3LzA3LzI3LzE4LjU0LjE1LyNjb21tZW50LTEwMjI5MQ0KDQoJCQkvLyBJZiB3ZSdyZSBub3QgZGVhbGluZyB3aXRoIGEgcmVndWxhciBwaXhlbCBudW1iZXINCgkJCS8vIGJ1dCBhIG51bWJlciB0aGF0IGhhcyBhIHdlaXJkIGVuZGluZywgd2UgbmVlZCB0byBjb252ZXJ0IGl0IHRvIHBpeGVscw0KCQkJaWYgKCAhL15cZCsocHgpPyQvaS50ZXN0KCByZXQgKSAmJiAvXlxkLy50ZXN0KCByZXQgKSApIHsNCgkJCQkvLyBSZW1lbWJlciB0aGUgb3JpZ2luYWwgdmFsdWVzDQoJCQkJdmFyIHN0eWxlID0gZWxlbS5zdHlsZS5sZWZ0LCBydW50aW1lU3R5bGUgPSBlbGVtLnJ1bnRpbWVTdHlsZS5sZWZ0Ow0KDQoJCQkJLy8gUHV0IGluIHRoZSBuZXcgdmFsdWVzIHRvIGdldCBhIGNvbXB1dGVkIHZhbHVlIG91dA0KCQkJCWVsZW0ucnVudGltZVN0eWxlLmxlZnQgPSBlbGVtLmN1cnJlbnRTdHlsZS5sZWZ0Ow0KCQkJCWVsZW0uc3R5bGUubGVmdCA9IHJldCB8fCAwOw0KCQkJCXJldCA9IGVsZW0uc3R5bGUucGl4ZWxMZWZ0ICsgInB4IjsNCg0KCQkJCS8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMNCgkJCQllbGVtLnN0eWxlLmxlZnQgPSBzdHlsZTsNCgkJCQllbGVtLnJ1bnRpbWVTdHlsZS5sZWZ0ID0gcnVudGltZVN0eWxlOw0KCQkJfQ0KCQl9DQoNCgkJcmV0dXJuIHJldDsNCgl9LA0KCQ0KCWNsZWFuOiBmdW5jdGlvbiggZWxlbXMsIGNvbnRleHQgKSB7DQoJCXZhciByZXQgPSBbXTsNCgkJY29udGV4dCA9IGNvbnRleHQgfHwgZG9jdW1lbnQ7DQoJCS8vICFjb250ZXh0LmNyZWF0ZUVsZW1lbnQgZmFpbHMgaW4gSUUgd2l0aCBhbiBlcnJvciBidXQgcmV0dXJucyB0eXBlb2YgJ29iamVjdCcNCgkJaWYgKHR5cGVvZiBjb250ZXh0LmNyZWF0ZUVsZW1lbnQgPT0gJ3VuZGVmaW5lZCcpIA0KCQkJY29udGV4dCA9IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0WzBdICYmIGNvbnRleHRbMF0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudDsNCg0KCQlqUXVlcnkuZWFjaChlbGVtcywgZnVuY3Rpb24oaSwgZWxlbSl7DQoJCQlpZiAoICFlbGVtICkNCgkJCQlyZXR1cm47DQoNCgkJCWlmICggZWxlbS5jb25zdHJ1Y3RvciA9PSBOdW1iZXIgKQ0KCQkJCWVsZW0gPSBlbGVtLnRvU3RyaW5nKCk7DQoJCQkNCgkJCS8vIENvbnZlcnQgaHRtbCBzdHJpbmcgaW50byBET00gbm9kZXMNCgkJCWlmICggdHlwZW9mIGVsZW0gPT0gInN0cmluZyIgKSB7DQoJCQkJLy8gRml4ICJYSFRNTCItc3R5bGUgdGFncyBpbiBhbGwgYnJvd3NlcnMNCgkJCQllbGVtID0gZWxlbS5yZXBsYWNlKC8oPChcdyspW14+XSo/KVwvPi9nLCBmdW5jdGlvbihhbGwsIGZyb250LCB0YWcpew0KCQkJCQlyZXR1cm4gdGFnLm1hdGNoKC9eKGFiYnJ8YnJ8Y29sfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW18aHJ8YXJlYXxlbWJlZCkkL2kpID8NCgkJCQkJCWFsbCA6DQoJCQkJCQlmcm9udCArICI+PC8iICsgdGFnICsgIj4iOw0KCQkJCX0pOw0KDQoJCQkJLy8gVHJpbSB3aGl0ZXNwYWNlLCBvdGhlcndpc2UgaW5kZXhPZiB3b24ndCB3b3JrIGFzIGV4cGVjdGVkDQoJCQkJdmFyIHRhZ3MgPSBqUXVlcnkudHJpbSggZWxlbSApLnRvTG93ZXJDYXNlKCksIGRpdiA9IGNvbnRleHQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoNCgkJCQl2YXIgd3JhcCA9DQoJCQkJCS8vIG9wdGlvbiBvciBvcHRncm91cA0KCQkJCQkhdGFncy5pbmRleE9mKCI8b3B0IikgJiYNCgkJCQkJWyAxLCAiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPiIsICI8L3NlbGVjdD4iIF0gfHwNCgkJCQkJDQoJCQkJCSF0YWdzLmluZGV4T2YoIjxsZWciKSAmJg0KCQkJCQlbIDEsICI8ZmllbGRzZXQ+IiwgIjwvZmllbGRzZXQ+IiBdIHx8DQoJCQkJCQ0KCQkJCQl0YWdzLm1hdGNoKC9ePCh0aGVhZHx0Ym9keXx0Zm9vdHxjb2xnfGNhcCkvKSAmJg0KCQkJCQlbIDEsICI8dGFibGU+IiwgIjwvdGFibGU+IiBdIHx8DQoJCQkJCQ0KCQkJCQkhdGFncy5pbmRleE9mKCI8dHIiKSAmJg0KCQkJCQlbIDIsICI8dGFibGU+PHRib2R5PiIsICI8L3Rib2R5PjwvdGFibGU+IiBdIHx8DQoJCQkJCQ0KCQkJCSAJLy8gPHRoZWFkPiBtYXRjaGVkIGFib3ZlDQoJCQkJCSghdGFncy5pbmRleE9mKCI8dGQiKSB8fCAhdGFncy5pbmRleE9mKCI8dGgiKSkgJiYNCgkJCQkJWyAzLCAiPHRhYmxlPjx0Ym9keT48dHI+IiwgIjwvdHI+PC90Ym9keT48L3RhYmxlPiIgXSB8fA0KCQkJCQkNCgkJCQkJIXRhZ3MuaW5kZXhPZigiPGNvbCIpICYmDQoJCQkJCVsgMiwgIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iIF0gfHwNCg0KCQkJCQkvLyBJRSBjYW4ndCBzZXJpYWxpemUgPGxpbms+IGFuZCA8c2NyaXB0PiB0YWdzIG5vcm1hbGx5DQoJCQkJCWpRdWVyeS5icm93c2VyLm1zaWUgJiYNCgkJCQkJWyAxLCAiZGl2PGRpdj4iLCAiPC9kaXY+IiBdIHx8DQoJCQkJCQ0KCQkJCQlbIDAsICIiLCAiIiBdOw0KDQoJCQkJLy8gR28gdG8gaHRtbCBhbmQgYmFjaywgdGhlbiBwZWVsIG9mZiBleHRyYSB3cmFwcGVycw0KCQkJCWRpdi5pbm5lckhUTUwgPSB3cmFwWzFdICsgZWxlbSArIHdyYXBbMl07DQoJCQkJDQoJCQkJLy8gTW92ZSB0byB0aGUgcmlnaHQgZGVwdGgNCgkJCQl3aGlsZSAoIHdyYXBbMF0tLSApDQoJCQkJCWRpdiA9IGRpdi5sYXN0Q2hpbGQ7DQoJCQkJDQoJCQkJLy8gUmVtb3ZlIElFJ3MgYXV0b2luc2VydGVkIDx0Ym9keT4gZnJvbSB0YWJsZSBmcmFnbWVudHMNCgkJCQlpZiAoIGpRdWVyeS5icm93c2VyLm1zaWUgKSB7DQoJCQkJCQ0KCQkJCQkvLyBTdHJpbmcgd2FzIGEgPHRhYmxlPiwgKm1heSogaGF2ZSBzcHVyaW91cyA8dGJvZHk+DQoJCQkJCXZhciB0Ym9keSA9ICF0YWdzLmluZGV4T2YoIjx0YWJsZSIpICYmIHRhZ3MuaW5kZXhPZigiPHRib2R5IikgPCAwID8NCgkJCQkJCWRpdi5maXJzdENoaWxkICYmIGRpdi5maXJzdENoaWxkLmNoaWxkTm9kZXMgOg0KCQkJCQkJDQoJCQkJCQkvLyBTdHJpbmcgd2FzIGEgYmFyZSA8dGhlYWQ+IG9yIDx0Zm9vdD4NCgkJCQkJCXdyYXBbMV0gPT0gIjx0YWJsZT4iICYmIHRhZ3MuaW5kZXhPZigiPHRib2R5IikgPCAwID8NCgkJCQkJCQlkaXYuY2hpbGROb2RlcyA6DQoJCQkJCQkJW107DQoJCQkJDQoJCQkJCWZvciAoIHZhciBqID0gdGJvZHkubGVuZ3RoIC0gMTsgaiA+PSAwIDsgLS1qICkNCgkJCQkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0Ym9keVsgaiBdLCAidGJvZHkiICkgJiYgIXRib2R5WyBqIF0uY2hpbGROb2Rlcy5sZW5ndGggKQ0KCQkJCQkJCXRib2R5WyBqIF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggdGJvZHlbIGogXSApOw0KCQkJCQkNCgkJCQkJLy8gSUUgY29tcGxldGVseSBraWxscyBsZWFkaW5nIHdoaXRlc3BhY2Ugd2hlbiBpbm5lckhUTUwgaXMgdXNlZAkNCgkJCQkJaWYgKCAvXlxzLy50ZXN0KCBlbGVtICkgKQkNCgkJCQkJCWRpdi5pbnNlcnRCZWZvcmUoIGNvbnRleHQuY3JlYXRlVGV4dE5vZGUoIGVsZW0ubWF0Y2goL15ccyovKVswXSApLCBkaXYuZmlyc3RDaGlsZCApOw0KCQkJCQ0KCQkJCX0NCgkJCQkNCgkJCQllbGVtID0galF1ZXJ5Lm1ha2VBcnJheSggZGl2LmNoaWxkTm9kZXMgKTsNCgkJCX0NCg0KCQkJaWYgKCBlbGVtLmxlbmd0aCA9PT0gMCAmJiAoIWpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImZvcm0iICkgJiYgIWpRdWVyeS5ub2RlTmFtZSggZWxlbSwgInNlbGVjdCIgKSkgKQ0KCQkJCXJldHVybjsNCg0KCQkJaWYgKCBlbGVtWzBdID09IHVuZGVmaW5lZCB8fCBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJmb3JtIiApIHx8IGVsZW0ub3B0aW9ucyApDQoJCQkJcmV0LnB1c2goIGVsZW0gKTsNCg0KCQkJZWxzZQ0KCQkJCXJldCA9IGpRdWVyeS5tZXJnZSggcmV0LCBlbGVtICk7DQoNCgkJfSk7DQoNCgkJcmV0dXJuIHJldDsNCgl9LA0KCQ0KCWF0dHI6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSApIHsNCgkJLy8gZG9uJ3Qgc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCBhbmQgY29tbWVudCBub2Rlcw0KCQlpZiAoIWVsZW0gfHwgZWxlbS5ub2RlVHlwZSA9PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT0gOCkNCgkJCXJldHVybiB1bmRlZmluZWQ7DQoNCgkJdmFyIGZpeCA9IGpRdWVyeS5pc1hNTERvYyggZWxlbSApID8NCgkJCXt9IDoNCgkJCWpRdWVyeS5wcm9wczsNCg0KCQkvLyBTYWZhcmkgbWlzLXJlcG9ydHMgdGhlIGRlZmF1bHQgc2VsZWN0ZWQgcHJvcGVydHkgb2YgYSBoaWRkZW4gb3B0aW9uDQoJCS8vIEFjY2Vzc2luZyB0aGUgcGFyZW50J3Mgc2VsZWN0ZWRJbmRleCBwcm9wZXJ0eSBmaXhlcyBpdA0KCQlpZiAoIG5hbWUgPT0gInNlbGVjdGVkIiAmJiBqUXVlcnkuYnJvd3Nlci5zYWZhcmkgKQ0KCQkJZWxlbS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7DQoJCQ0KCQkvLyBDZXJ0YWluIGF0dHJpYnV0ZXMgb25seSB3b3JrIHdoZW4gYWNjZXNzZWQgdmlhIHRoZSBvbGQgRE9NIDAgd2F5DQoJCWlmICggZml4WyBuYW1lIF0gKSB7DQoJCQlpZiAoIHZhbHVlICE9IHVuZGVmaW5lZCApDQoJCQkJZWxlbVsgZml4WyBuYW1lIF0gXSA9IHZhbHVlOw0KDQoJCQlyZXR1cm4gZWxlbVsgZml4WyBuYW1lIF0gXTsNCg0KCQl9IGVsc2UgaWYgKCBqUXVlcnkuYnJvd3Nlci5tc2llICYmIG5hbWUgPT0gInN0eWxlIiApDQoJCQlyZXR1cm4galF1ZXJ5LmF0dHIoIGVsZW0uc3R5bGUsICJjc3NUZXh0IiwgdmFsdWUgKTsNCg0KCQllbHNlIGlmICggdmFsdWUgPT0gdW5kZWZpbmVkICYmIGpRdWVyeS5icm93c2VyLm1zaWUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiZm9ybSIgKSAmJiAobmFtZSA9PSAiYWN0aW9uIiB8fCBuYW1lID09ICJtZXRob2QiKSApDQoJCQlyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICkubm9kZVZhbHVlOw0KDQoJCS8vIElFIGVsZW0uZ2V0QXR0cmlidXRlIHBhc3NlcyBldmVuIGZvciBzdHlsZQ0KCQllbHNlIGlmICggZWxlbS50YWdOYW1lICkgew0KDQoJCQlpZiAoIHZhbHVlICE9IHVuZGVmaW5lZCApIHsNCgkJCQkvLyBXZSBjYW4ndCBhbGxvdyB0aGUgdHlwZSBwcm9wZXJ0eSB0byBiZSBjaGFuZ2VkIChzaW5jZSBpdCBjYXVzZXMgcHJvYmxlbXMgaW4gSUUpDQoJCQkJaWYgKCBuYW1lID09ICJ0eXBlIiAmJiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSAmJiBlbGVtLnBhcmVudE5vZGUgKQ0KCQkJCQl0aHJvdyAidHlwZSBwcm9wZXJ0eSBjYW4ndCBiZSBjaGFuZ2VkIjsNCg0KCQkJCS8vIGNvbnZlcnQgdGhlIHZhbHVlIHRvIGEgc3RyaW5nIChhbGwgYnJvd3NlcnMgZG8gdGhpcyBidXQgSUUpIHNlZSAjMTA3MA0KCQkJCWVsZW0uc2V0QXR0cmlidXRlKCBuYW1lLCAiIiArIHZhbHVlICk7DQoJCQl9DQoNCgkJCWlmICggalF1ZXJ5LmJyb3dzZXIubXNpZSAmJiAvaHJlZnxzcmMvLnRlc3QoIG5hbWUgKSAmJiAhalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICkgKSANCgkJCQlyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUsIDIgKTsNCg0KCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7DQoNCgkJLy8gZWxlbSBpcyBhY3R1YWxseSBlbGVtLnN0eWxlIC4uLiBzZXQgdGhlIHN0eWxlDQoJCX0gZWxzZSB7DQoJCQkvLyBJRSBhY3R1YWxseSB1c2VzIGZpbHRlcnMgZm9yIG9wYWNpdHkNCgkJCWlmICggbmFtZSA9PSAib3BhY2l0eSIgJiYgalF1ZXJ5LmJyb3dzZXIubXNpZSApIHsNCgkJCQlpZiAoIHZhbHVlICE9IHVuZGVmaW5lZCApIHsNCgkJCQkJLy8gSUUgaGFzIHRyb3VibGUgd2l0aCBvcGFjaXR5IGlmIGl0IGRvZXMgbm90IGhhdmUgbGF5b3V0DQoJCQkJCS8vIEZvcmNlIGl0IGJ5IHNldHRpbmcgdGhlIHpvb20gbGV2ZWwNCgkJCQkJZWxlbS56b29tID0gMTsgDQoJDQoJCQkJCS8vIFNldCB0aGUgYWxwaGEgZmlsdGVyIHRvIHNldCB0aGUgb3BhY2l0eQ0KCQkJCQllbGVtLmZpbHRlciA9IChlbGVtLmZpbHRlciB8fCAiIikucmVwbGFjZSggL2FscGhhXChbXildKlwpLywgIiIgKSArDQoJCQkJCQkocGFyc2VGbG9hdCggdmFsdWUgKS50b1N0cmluZygpID09ICJOYU4iID8gIiIgOiAiYWxwaGEob3BhY2l0eT0iICsgdmFsdWUgKiAxMDAgKyAiKSIpOw0KCQkJCX0NCgkNCgkJCQlyZXR1cm4gZWxlbS5maWx0ZXIgJiYgZWxlbS5maWx0ZXIuaW5kZXhPZigib3BhY2l0eT0iKSA+PSAwID8NCgkJCQkJKHBhcnNlRmxvYXQoIGVsZW0uZmlsdGVyLm1hdGNoKC9vcGFjaXR5PShbXildKikvKVsxXSApIC8gMTAwKS50b1N0cmluZygpIDoNCgkJCQkJIiI7DQoJCQl9DQoNCgkJCW5hbWUgPSBuYW1lLnJlcGxhY2UoLy0oW2Etel0pL2lnLCBmdW5jdGlvbihhbGwsIGxldHRlcil7DQoJCQkJcmV0dXJuIGxldHRlci50b1VwcGVyQ2FzZSgpOw0KCQkJfSk7DQoNCgkJCWlmICggdmFsdWUgIT0gdW5kZWZpbmVkICkNCgkJCQllbGVtWyBuYW1lIF0gPSB2YWx1ZTsNCg0KCQkJcmV0dXJuIGVsZW1bIG5hbWUgXTsNCgkJfQ0KCX0sDQoJDQoJdHJpbTogZnVuY3Rpb24oIHRleHQgKSB7DQoJCXJldHVybiAodGV4dCB8fCAiIikucmVwbGFjZSggL15ccyt8XHMrJC9nLCAiIiApOw0KCX0sDQoNCgltYWtlQXJyYXk6IGZ1bmN0aW9uKCBhcnJheSApIHsNCgkJdmFyIHJldCA9IFtdOw0KDQoJCS8vIE5lZWQgdG8gdXNlIHR5cGVvZiB0byBmaWdodCBTYWZhcmkgY2hpbGROb2RlcyBjcmFzaGVzDQoJCWlmICggdHlwZW9mIGFycmF5ICE9ICJhcnJheSIgKQ0KCQkJZm9yICggdmFyIGkgPSAwLCBsZW5ndGggPSBhcnJheS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKyApDQoJCQkJcmV0LnB1c2goIGFycmF5WyBpIF0gKTsNCgkJZWxzZQ0KCQkJcmV0ID0gYXJyYXkuc2xpY2UoIDAgKTsNCg0KCQlyZXR1cm4gcmV0Ow0KCX0sDQoNCglpbkFycmF5OiBmdW5jdGlvbiggZWxlbSwgYXJyYXkgKSB7DQoJCWZvciAoIHZhciBpID0gMCwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKysgKQ0KCQkJaWYgKCBhcnJheVsgaSBdID09IGVsZW0gKQ0KCQkJCXJldHVybiBpOw0KDQoJCXJldHVybiAtMTsNCgl9LA0KDQoJbWVyZ2U6IGZ1bmN0aW9uKCBmaXJzdCwgc2Vjb25kICkgew0KCQkvLyBXZSBoYXZlIHRvIGxvb3AgdGhpcyB3YXkgYmVjYXVzZSBJRSAmIE9wZXJhIG92ZXJ3cml0ZSB0aGUgbGVuZ3RoDQoJCS8vIGV4cGFuZG8gb2YgZ2V0RWxlbWVudHNCeVRhZ05hbWUNCg0KCQkvLyBBbHNvLCB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBjb3JyZWN0IGVsZW1lbnRzIGFyZSBiZWluZyByZXR1cm5lZA0KCQkvLyAoSUUgcmV0dXJucyBjb21tZW50IG5vZGVzIGluIGEgJyonIHF1ZXJ5KQ0KCQlpZiAoIGpRdWVyeS5icm93c2VyLm1zaWUgKSB7DQoJCQlmb3IgKCB2YXIgaSA9IDA7IHNlY29uZFsgaSBdOyBpKysgKQ0KCQkJCWlmICggc2Vjb25kWyBpIF0ubm9kZVR5cGUgIT0gOCApDQoJCQkJCWZpcnN0LnB1c2goIHNlY29uZFsgaSBdICk7DQoNCgkJfSBlbHNlDQoJCQlmb3IgKCB2YXIgaSA9IDA7IHNlY29uZFsgaSBdOyBpKysgKQ0KCQkJCWZpcnN0LnB1c2goIHNlY29uZFsgaSBdICk7DQoNCgkJcmV0dXJuIGZpcnN0Ow0KCX0sDQoNCgl1bmlxdWU6IGZ1bmN0aW9uKCBhcnJheSApIHsNCgkJdmFyIHJldCA9IFtdLCBkb25lID0ge307DQoNCgkJdHJ5IHsNCg0KCQkJZm9yICggdmFyIGkgPSAwLCBsZW5ndGggPSBhcnJheS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKyApIHsNCgkJCQl2YXIgaWQgPSBqUXVlcnkuZGF0YSggYXJyYXlbIGkgXSApOw0KDQoJCQkJaWYgKCAhZG9uZVsgaWQgXSApIHsNCgkJCQkJZG9uZVsgaWQgXSA9IHRydWU7DQoJCQkJCXJldC5wdXNoKCBhcnJheVsgaSBdICk7DQoJCQkJfQ0KCQkJfQ0KDQoJCX0gY2F0Y2goIGUgKSB7DQoJCQlyZXQgPSBhcnJheTsNCgkJfQ0KDQoJCXJldHVybiByZXQ7DQoJfSwNCg0KCWdyZXA6IGZ1bmN0aW9uKCBlbGVtcywgY2FsbGJhY2ssIGludiApIHsNCgkJdmFyIHJldCA9IFtdOw0KDQoJCS8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCBvbmx5IHNhdmluZyB0aGUgaXRlbXMNCgkJLy8gdGhhdCBwYXNzIHRoZSB2YWxpZGF0b3IgZnVuY3Rpb24NCgkJZm9yICggdmFyIGkgPSAwLCBsZW5ndGggPSBlbGVtcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKyApDQoJCQlpZiAoICFpbnYgJiYgY2FsbGJhY2soIGVsZW1zWyBpIF0sIGkgKSB8fCBpbnYgJiYgIWNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpICkgKQ0KCQkJCXJldC5wdXNoKCBlbGVtc1sgaSBdICk7DQoNCgkJcmV0dXJuIHJldDsNCgl9LA0KDQoJbWFwOiBmdW5jdGlvbiggZWxlbXMsIGNhbGxiYWNrICkgew0KCQl2YXIgcmV0ID0gW107DQoNCgkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIHRyYW5zbGF0aW5nIGVhY2ggb2YgdGhlIGl0ZW1zIHRvIHRoZWlyDQoJCS8vIG5ldyB2YWx1ZSAob3IgdmFsdWVzKS4NCgkJZm9yICggdmFyIGkgPSAwLCBsZW5ndGggPSBlbGVtcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKyApIHsNCgkJCXZhciB2YWx1ZSA9IGNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpICk7DQoNCgkJCWlmICggdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT0gdW5kZWZpbmVkICkgew0KCQkJCWlmICggdmFsdWUuY29uc3RydWN0b3IgIT0gQXJyYXkgKQ0KCQkJCQl2YWx1ZSA9IFsgdmFsdWUgXTsNCg0KCQkJCXJldCA9IHJldC5jb25jYXQoIHZhbHVlICk7DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gcmV0Ow0KCX0NCn0pOw0KDQp2YXIgdXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpOw0KDQovLyBGaWd1cmUgb3V0IHdoYXQgYnJvd3NlciBpcyBiZWluZyB1c2VkDQpqUXVlcnkuYnJvd3NlciA9IHsNCgl2ZXJzaW9uOiAodXNlckFnZW50Lm1hdGNoKCAvLisoPzpydnxpdHxyYXxpZSlbXC86IF0oW1xkLl0rKS8gKSB8fCBbXSlbMV0sDQoJc2FmYXJpOiAvd2Via2l0Ly50ZXN0KCB1c2VyQWdlbnQgKSwNCglvcGVyYTogL29wZXJhLy50ZXN0KCB1c2VyQWdlbnQgKSwNCgltc2llOiAvbXNpZS8udGVzdCggdXNlckFnZW50ICkgJiYgIS9vcGVyYS8udGVzdCggdXNlckFnZW50ICksDQoJbW96aWxsYTogL21vemlsbGEvLnRlc3QoIHVzZXJBZ2VudCApICYmICEvKGNvbXBhdGlibGV8d2Via2l0KS8udGVzdCggdXNlckFnZW50ICkNCn07DQoNCnZhciBzdHlsZUZsb2F0ID0galF1ZXJ5LmJyb3dzZXIubXNpZSA/DQoJInN0eWxlRmxvYXQiIDoNCgkiY3NzRmxvYXQiOw0KCQ0KalF1ZXJ5LmV4dGVuZCh7DQoJLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZSBXM0MgYm94IG1vZGVsIGlzIGJlaW5nIHVzZWQNCglib3hNb2RlbDogIWpRdWVyeS5icm93c2VyLm1zaWUgfHwgZG9jdW1lbnQuY29tcGF0TW9kZSA9PSAiQ1NTMUNvbXBhdCIsDQoJDQoJcHJvcHM6IHsNCgkJImZvciI6ICJodG1sRm9yIiwNCgkJImNsYXNzIjogImNsYXNzTmFtZSIsDQoJCSJmbG9hdCI6IHN0eWxlRmxvYXQsDQoJCWNzc0Zsb2F0OiBzdHlsZUZsb2F0LA0KCQlzdHlsZUZsb2F0OiBzdHlsZUZsb2F0LA0KCQlpbm5lckhUTUw6ICJpbm5lckhUTUwiLA0KCQljbGFzc05hbWU6ICJjbGFzc05hbWUiLA0KCQl2YWx1ZTogInZhbHVlIiwNCgkJZGlzYWJsZWQ6ICJkaXNhYmxlZCIsDQoJCWNoZWNrZWQ6ICJjaGVja2VkIiwNCgkJcmVhZG9ubHk6ICJyZWFkT25seSIsDQoJCXNlbGVjdGVkOiAic2VsZWN0ZWQiLA0KCQltYXhsZW5ndGg6ICJtYXhMZW5ndGgiLA0KCQlzZWxlY3RlZEluZGV4OiAic2VsZWN0ZWRJbmRleCIsDQoJCWRlZmF1bHRWYWx1ZTogImRlZmF1bHRWYWx1ZSIsDQoJCXRhZ05hbWU6ICJ0YWdOYW1lIiwNCgkJbm9kZU5hbWU6ICJub2RlTmFtZSINCgl9DQp9KTsNCg0KalF1ZXJ5LmVhY2goew0KCXBhcmVudDogZnVuY3Rpb24oZWxlbSl7cmV0dXJuIGVsZW0ucGFyZW50Tm9kZTt9LA0KCXBhcmVudHM6IGZ1bmN0aW9uKGVsZW0pe3JldHVybiBqUXVlcnkuZGlyKGVsZW0sInBhcmVudE5vZGUiKTt9LA0KCW5leHQ6IGZ1bmN0aW9uKGVsZW0pe3JldHVybiBqUXVlcnkubnRoKGVsZW0sMiwibmV4dFNpYmxpbmciKTt9LA0KCXByZXY6IGZ1bmN0aW9uKGVsZW0pe3JldHVybiBqUXVlcnkubnRoKGVsZW0sMiwicHJldmlvdXNTaWJsaW5nIik7fSwNCgluZXh0QWxsOiBmdW5jdGlvbihlbGVtKXtyZXR1cm4galF1ZXJ5LmRpcihlbGVtLCJuZXh0U2libGluZyIpO30sDQoJcHJldkFsbDogZnVuY3Rpb24oZWxlbSl7cmV0dXJuIGpRdWVyeS5kaXIoZWxlbSwicHJldmlvdXNTaWJsaW5nIik7fSwNCglzaWJsaW5nczogZnVuY3Rpb24oZWxlbSl7cmV0dXJuIGpRdWVyeS5zaWJsaW5nKGVsZW0ucGFyZW50Tm9kZS5maXJzdENoaWxkLGVsZW0pO30sDQoJY2hpbGRyZW46IGZ1bmN0aW9uKGVsZW0pe3JldHVybiBqUXVlcnkuc2libGluZyhlbGVtLmZpcnN0Q2hpbGQpO30sDQoJY29udGVudHM6IGZ1bmN0aW9uKGVsZW0pe3JldHVybiBqUXVlcnkubm9kZU5hbWUoZWxlbSwiaWZyYW1lIik/ZWxlbS5jb250ZW50RG9jdW1lbnR8fGVsZW0uY29udGVudFdpbmRvdy5kb2N1bWVudDpqUXVlcnkubWFrZUFycmF5KGVsZW0uY2hpbGROb2Rlcyk7fQ0KfSwgZnVuY3Rpb24obmFtZSwgZm4pew0KCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHNlbGVjdG9yICkgew0KCQl2YXIgcmV0ID0galF1ZXJ5Lm1hcCggdGhpcywgZm4gKTsNCg0KCQlpZiAoIHNlbGVjdG9yICYmIHR5cGVvZiBzZWxlY3RvciA9PSAic3RyaW5nIiApDQoJCQlyZXQgPSBqUXVlcnkubXVsdGlGaWx0ZXIoIHNlbGVjdG9yLCByZXQgKTsNCg0KCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeS51bmlxdWUoIHJldCApICk7DQoJfTsNCn0pOw0KDQpqUXVlcnkuZWFjaCh7DQoJYXBwZW5kVG86ICJhcHBlbmQiLA0KCXByZXBlbmRUbzogInByZXBlbmQiLA0KCWluc2VydEJlZm9yZTogImJlZm9yZSIsDQoJaW5zZXJ0QWZ0ZXI6ICJhZnRlciIsDQoJcmVwbGFjZUFsbDogInJlcGxhY2VXaXRoIg0KfSwgZnVuY3Rpb24obmFtZSwgb3JpZ2luYWwpew0KCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oKSB7DQoJCXZhciBhcmdzID0gYXJndW1lbnRzOw0KDQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsNCgkJCWZvciAoIHZhciBpID0gMCwgbGVuZ3RoID0gYXJncy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKyApDQoJCQkJalF1ZXJ5KCBhcmdzWyBpIF0gKVsgb3JpZ2luYWwgXSggdGhpcyApOw0KCQl9KTsNCgl9Ow0KfSk7DQoNCmpRdWVyeS5lYWNoKHsNCglyZW1vdmVBdHRyOiBmdW5jdGlvbiggbmFtZSApIHsNCgkJalF1ZXJ5LmF0dHIoIHRoaXMsIG5hbWUsICIiICk7DQoJCWlmICh0aGlzLm5vZGVUeXBlID09IDEpIA0KCQkJdGhpcy5yZW1vdmVBdHRyaWJ1dGUoIG5hbWUgKTsNCgl9LA0KDQoJYWRkQ2xhc3M6IGZ1bmN0aW9uKCBjbGFzc05hbWVzICkgew0KCQlqUXVlcnkuY2xhc3NOYW1lLmFkZCggdGhpcywgY2xhc3NOYW1lcyApOw0KCX0sDQoNCglyZW1vdmVDbGFzczogZnVuY3Rpb24oIGNsYXNzTmFtZXMgKSB7DQoJCWpRdWVyeS5jbGFzc05hbWUucmVtb3ZlKCB0aGlzLCBjbGFzc05hbWVzICk7DQoJfSwNCg0KCXRvZ2dsZUNsYXNzOiBmdW5jdGlvbiggY2xhc3NOYW1lcyApIHsNCgkJalF1ZXJ5LmNsYXNzTmFtZVsgalF1ZXJ5LmNsYXNzTmFtZS5oYXMoIHRoaXMsIGNsYXNzTmFtZXMgKSA/ICJyZW1vdmUiIDogImFkZCIgXSggdGhpcywgY2xhc3NOYW1lcyApOw0KCX0sDQoNCglyZW1vdmU6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsNCgkJaWYgKCAhc2VsZWN0b3IgfHwgalF1ZXJ5LmZpbHRlciggc2VsZWN0b3IsIFsgdGhpcyBdICkuci5sZW5ndGggKSB7DQoJCQkvLyBQcmV2ZW50IG1lbW9yeSBsZWFrcw0KCQkJalF1ZXJ5KCAiKiIsIHRoaXMgKS5hZGQodGhpcykuZWFjaChmdW5jdGlvbigpew0KCQkJCWpRdWVyeS5ldmVudC5yZW1vdmUodGhpcyk7DQoJCQkJalF1ZXJ5LnJlbW92ZURhdGEodGhpcyk7DQoJCQl9KTsNCgkJCWlmICh0aGlzLnBhcmVudE5vZGUpDQoJCQkJdGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCB0aGlzICk7DQoJCX0NCgl9LA0KDQoJZW1wdHk6IGZ1bmN0aW9uKCkgew0KCQkvLyBSZW1vdmUgZWxlbWVudCBub2RlcyBhbmQgcHJldmVudCBtZW1vcnkgbGVha3MNCgkJalF1ZXJ5KCAiPioiLCB0aGlzICkucmVtb3ZlKCk7DQoJCQ0KCQkvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2Rlcw0KCQl3aGlsZSAoIHRoaXMuZmlyc3RDaGlsZCApDQoJCQl0aGlzLnJlbW92ZUNoaWxkKCB0aGlzLmZpcnN0Q2hpbGQgKTsNCgl9DQp9LCBmdW5jdGlvbihuYW1lLCBmbil7DQoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbigpew0KCQlyZXR1cm4gdGhpcy5lYWNoKCBmbiwgYXJndW1lbnRzICk7DQoJfTsNCn0pOw0KDQpqUXVlcnkuZWFjaChbICJIZWlnaHQiLCAiV2lkdGgiIF0sIGZ1bmN0aW9uKGksIG5hbWUpew0KCXZhciB0eXBlID0gbmFtZS50b0xvd2VyQ2FzZSgpOw0KCQ0KCWpRdWVyeS5mblsgdHlwZSBdID0gZnVuY3Rpb24oIHNpemUgKSB7DQoJCS8vIEdldCB3aW5kb3cgd2lkdGggb3IgaGVpZ2h0DQoJCXJldHVybiB0aGlzWzBdID09IHdpbmRvdyA/DQoJCQkvLyBPcGVyYSByZXBvcnRzIGRvY3VtZW50LmJvZHkuY2xpZW50W1dpZHRoL0hlaWdodF0gcHJvcGVybHkgaW4gYm90aCBxdWlya3MgYW5kIHN0YW5kYXJkcw0KCQkJalF1ZXJ5LmJyb3dzZXIub3BlcmEgJiYgZG9jdW1lbnQuYm9keVsgImNsaWVudCIgKyBuYW1lIF0gfHwgDQoJCQkNCgkJCS8vIFNhZmFyaSByZXBvcnRzIGlubmVyW1dpZHRoL0hlaWdodF0ganVzdCBmaW5lIChNb3ppbGxhIGFuZCBPcGVyYSBpbmNsdWRlIHNjcm9sbCBiYXIgd2lkdGhzKQ0KCQkJalF1ZXJ5LmJyb3dzZXIuc2FmYXJpICYmIHdpbmRvd1sgImlubmVyIiArIG5hbWUgXSB8fA0KCQkJDQoJCQkvLyBFdmVyeW9uZSBlbHNlIHVzZSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgb3IgZG9jdW1lbnQuYm9keSBkZXBlbmRpbmcgb24gUXVpcmtzIHZzIFN0YW5kYXJkcyBtb2RlDQoJCQlkb2N1bWVudC5jb21wYXRNb2RlID09ICJDU1MxQ29tcGF0IiAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbICJjbGllbnQiICsgbmFtZSBdIHx8IGRvY3VtZW50LmJvZHlbICJjbGllbnQiICsgbmFtZSBdIDoNCgkJDQoJCQkvLyBHZXQgZG9jdW1lbnQgd2lkdGggb3IgaGVpZ2h0DQoJCQl0aGlzWzBdID09IGRvY3VtZW50ID8NCgkJCQkvLyBFaXRoZXIgc2Nyb2xsW1dpZHRoL0hlaWdodF0gb3Igb2Zmc2V0W1dpZHRoL0hlaWdodF0sIHdoaWNoZXZlciBpcyBncmVhdGVyDQoJCQkJTWF0aC5tYXgoIA0KCQkJCQlNYXRoLm1heChkb2N1bWVudC5ib2R5WyJzY3JvbGwiICsgbmFtZV0sIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsic2Nyb2xsIiArIG5hbWVdKSwgDQoJCQkJCU1hdGgubWF4KGRvY3VtZW50LmJvZHlbIm9mZnNldCIgKyBuYW1lXSwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyJvZmZzZXQiICsgbmFtZV0pIA0KCQkJCSkgOg0KDQoJCQkJLy8gR2V0IG9yIHNldCB3aWR0aCBvciBoZWlnaHQgb24gdGhlIGVsZW1lbnQNCgkJCQlzaXplID09IHVuZGVmaW5lZCA/DQoJCQkJCS8vIEdldCB3aWR0aCBvciBoZWlnaHQgb24gdGhlIGVsZW1lbnQNCgkJCQkJKHRoaXMubGVuZ3RoID8galF1ZXJ5LmNzcyggdGhpc1swXSwgdHlwZSApIDogbnVsbCkgOg0KDQoJCQkJCS8vIFNldCB0aGUgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50IChkZWZhdWx0IHRvIHBpeGVscyBpZiB2YWx1ZSBpcyB1bml0bGVzcykNCgkJCQkJdGhpcy5jc3MoIHR5cGUsIHNpemUuY29uc3RydWN0b3IgPT0gU3RyaW5nID8gc2l6ZSA6IHNpemUgKyAicHgiICk7DQoJfTsNCn0pOw0KDQp2YXIgY2hhcnMgPSBqUXVlcnkuYnJvd3Nlci5zYWZhcmkgJiYgcGFyc2VJbnQoalF1ZXJ5LmJyb3dzZXIudmVyc2lvbikgPCA0MTcgPw0KCQkiKD86W1xcdypfLV18XFxcXC4pIiA6DQoJCSIoPzpbXFx3XHUwMTI4LVx1RkZGRipfLV18XFxcXC4pIiwNCglxdWlja0NoaWxkID0gbmV3IFJlZ0V4cCgiXj5cXHMqKCIgKyBjaGFycyArICIrKSIpLA0KCXF1aWNrSUQgPSBuZXcgUmVnRXhwKCJeKCIgKyBjaGFycyArICIrKSgjKSgiICsgY2hhcnMgKyAiKykiKSwNCglxdWlja0NsYXNzID0gbmV3IFJlZ0V4cCgiXihbIy5dPykoIiArIGNoYXJzICsgIiopIik7DQoNCmpRdWVyeS5leHRlbmQoew0KCWV4cHI6IHsNCgkJIiI6IGZ1bmN0aW9uKGEsaSxtKXtyZXR1cm4gbVsyXT09IioifHxqUXVlcnkubm9kZU5hbWUoYSxtWzJdKTt9LA0KCQkiIyI6IGZ1bmN0aW9uKGEsaSxtKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoImlkIik9PW1bMl07fSwNCgkJIjoiOiB7DQoJCQkvLyBQb3NpdGlvbiBDaGVja3MNCgkJCWx0OiBmdW5jdGlvbihhLGksbSl7cmV0dXJuIGk8bVszXS0wO30sDQoJCQlndDogZnVuY3Rpb24oYSxpLG0pe3JldHVybiBpPm1bM10tMDt9LA0KCQkJbnRoOiBmdW5jdGlvbihhLGksbSl7cmV0dXJuIG1bM10tMD09aTt9LA0KCQkJZXE6IGZ1bmN0aW9uKGEsaSxtKXtyZXR1cm4gbVszXS0wPT1pO30sDQoJCQlmaXJzdDogZnVuY3Rpb24oYSxpKXtyZXR1cm4gaT09MDt9LA0KCQkJbGFzdDogZnVuY3Rpb24oYSxpLG0scil7cmV0dXJuIGk9PXIubGVuZ3RoLTE7fSwNCgkJCWV2ZW46IGZ1bmN0aW9uKGEsaSl7cmV0dXJuIGklMj09MDt9LA0KCQkJb2RkOiBmdW5jdGlvbihhLGkpe3JldHVybiBpJTI7fSwNCg0KCQkJLy8gQ2hpbGQgQ2hlY2tzDQoJCQkiZmlyc3QtY2hpbGQiOiBmdW5jdGlvbihhKXtyZXR1cm4gYS5wYXJlbnROb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIilbMF09PWE7fSwNCgkJCSJsYXN0LWNoaWxkIjogZnVuY3Rpb24oYSl7cmV0dXJuIGpRdWVyeS5udGgoYS5wYXJlbnROb2RlLmxhc3RDaGlsZCwxLCJwcmV2aW91c1NpYmxpbmciKT09YTt9LA0KCQkJIm9ubHktY2hpbGQiOiBmdW5jdGlvbihhKXtyZXR1cm4gIWpRdWVyeS5udGgoYS5wYXJlbnROb2RlLmxhc3RDaGlsZCwyLCJwcmV2aW91c1NpYmxpbmciKTt9LA0KDQoJCQkvLyBQYXJlbnQgQ2hlY2tzDQoJCQlwYXJlbnQ6IGZ1bmN0aW9uKGEpe3JldHVybiBhLmZpcnN0Q2hpbGQ7fSwNCgkJCWVtcHR5OiBmdW5jdGlvbihhKXtyZXR1cm4gIWEuZmlyc3RDaGlsZDt9LA0KDQoJCQkvLyBUZXh0IENoZWNrDQoJCQljb250YWluczogZnVuY3Rpb24oYSxpLG0pe3JldHVybiAoYS50ZXh0Q29udGVudHx8YS5pbm5lclRleHR8fGpRdWVyeShhKS50ZXh0KCl8fCIiKS5pbmRleE9mKG1bM10pPj0wO30sDQoNCgkJCS8vIFZpc2liaWxpdHkNCgkJCXZpc2libGU6IGZ1bmN0aW9uKGEpe3JldHVybiAiaGlkZGVuIiE9YS50eXBlJiZqUXVlcnkuY3NzKGEsImRpc3BsYXkiKSE9Im5vbmUiJiZqUXVlcnkuY3NzKGEsInZpc2liaWxpdHkiKSE9ImhpZGRlbiI7fSwNCgkJCWhpZGRlbjogZnVuY3Rpb24oYSl7cmV0dXJuICJoaWRkZW4iPT1hLnR5cGV8fGpRdWVyeS5jc3MoYSwiZGlzcGxheSIpPT0ibm9uZSJ8fGpRdWVyeS5jc3MoYSwidmlzaWJpbGl0eSIpPT0iaGlkZGVuIjt9LA0KDQoJCQkvLyBGb3JtIGF0dHJpYnV0ZXMNCgkJCWVuYWJsZWQ6IGZ1bmN0aW9uKGEpe3JldHVybiAhYS5kaXNhYmxlZDt9LA0KCQkJZGlzYWJsZWQ6IGZ1bmN0aW9uKGEpe3JldHVybiBhLmRpc2FibGVkO30sDQoJCQljaGVja2VkOiBmdW5jdGlvbihhKXtyZXR1cm4gYS5jaGVja2VkO30sDQoJCQlzZWxlY3RlZDogZnVuY3Rpb24oYSl7cmV0dXJuIGEuc2VsZWN0ZWR8fGpRdWVyeS5hdHRyKGEsInNlbGVjdGVkIik7fSwNCg0KCQkJLy8gRm9ybSBlbGVtZW50cw0KCQkJdGV4dDogZnVuY3Rpb24oYSl7cmV0dXJuICJ0ZXh0Ij09YS50eXBlO30sDQoJCQlyYWRpbzogZnVuY3Rpb24oYSl7cmV0dXJuICJyYWRpbyI9PWEudHlwZTt9LA0KCQkJY2hlY2tib3g6IGZ1bmN0aW9uKGEpe3JldHVybiAiY2hlY2tib3giPT1hLnR5cGU7fSwNCgkJCWZpbGU6IGZ1bmN0aW9uKGEpe3JldHVybiAiZmlsZSI9PWEudHlwZTt9LA0KCQkJcGFzc3dvcmQ6IGZ1bmN0aW9uKGEpe3JldHVybiAicGFzc3dvcmQiPT1hLnR5cGU7fSwNCgkJCXN1Ym1pdDogZnVuY3Rpb24oYSl7cmV0dXJuICJzdWJtaXQiPT1hLnR5cGU7fSwNCgkJCWltYWdlOiBmdW5jdGlvbihhKXtyZXR1cm4gImltYWdlIj09YS50eXBlO30sDQoJCQlyZXNldDogZnVuY3Rpb24oYSl7cmV0dXJuICJyZXNldCI9PWEudHlwZTt9LA0KCQkJYnV0dG9uOiBmdW5jdGlvbihhKXtyZXR1cm4gImJ1dHRvbiI9PWEudHlwZXx8alF1ZXJ5Lm5vZGVOYW1lKGEsImJ1dHRvbiIpO30sDQoJCQlpbnB1dDogZnVuY3Rpb24oYSl7cmV0dXJuIC9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uL2kudGVzdChhLm5vZGVOYW1lKTt9LA0KDQoJCQkvLyA6aGFzKCkNCgkJCWhhczogZnVuY3Rpb24oYSxpLG0pe3JldHVybiBqUXVlcnkuZmluZChtWzNdLGEpLmxlbmd0aDt9LA0KDQoJCQkvLyA6aGVhZGVyDQoJCQloZWFkZXI6IGZ1bmN0aW9uKGEpe3JldHVybiAvaFxkL2kudGVzdChhLm5vZGVOYW1lKTt9LA0KDQoJCQkvLyA6YW5pbWF0ZWQNCgkJCWFuaW1hdGVkOiBmdW5jdGlvbihhKXtyZXR1cm4galF1ZXJ5LmdyZXAoalF1ZXJ5LnRpbWVycyxmdW5jdGlvbihmbil7cmV0dXJuIGE9PWZuLmVsZW07fSkubGVuZ3RoO30NCgkJfQ0KCX0sDQoJDQoJLy8gVGhlIHJlZ3VsYXIgZXhwcmVzc2lvbnMgdGhhdCBwb3dlciB0aGUgcGFyc2luZyBlbmdpbmUNCglwYXJzZTogWw0KCQkvLyBNYXRjaDogW0B2YWx1ZT0ndGVzdCddLCBbQGZvb10NCgkJL14oXFspICpAPyhbXHctXSspICooWyEqJF5+PV0qKSAqKCc/Ij8pKC4qPylcNCAqXF0vLA0KDQoJCS8vIE1hdGNoOiA6Y29udGFpbnMoJ2ZvbycpDQoJCS9eKDopKFtcdy1dKylcKCI/Jz8oLio/KFwoLio/XCkpP1teKF0qPykiPyc/XCkvLA0KDQoJCS8vIE1hdGNoOiA6ZXZlbiwgOmxhc3QtY2hsaWQsICNpZCwgLmNsYXNzDQoJCW5ldyBSZWdFeHAoIl4oWzouI10qKSgiICsgY2hhcnMgKyAiKykiKQ0KCV0sDQoNCgltdWx0aUZpbHRlcjogZnVuY3Rpb24oIGV4cHIsIGVsZW1zLCBub3QgKSB7DQoJCXZhciBvbGQsIGN1ciA9IFtdOw0KDQoJCXdoaWxlICggZXhwciAmJiBleHByICE9IG9sZCApIHsNCgkJCW9sZCA9IGV4cHI7DQoJCQl2YXIgZiA9IGpRdWVyeS5maWx0ZXIoIGV4cHIsIGVsZW1zLCBub3QgKTsNCgkJCWV4cHIgPSBmLnQucmVwbGFjZSgvXlxzKixccyovLCAiIiApOw0KCQkJY3VyID0gbm90ID8gZWxlbXMgPSBmLnIgOiBqUXVlcnkubWVyZ2UoIGN1ciwgZi5yICk7DQoJCX0NCg0KCQlyZXR1cm4gY3VyOw0KCX0sDQoNCglmaW5kOiBmdW5jdGlvbiggdCwgY29udGV4dCApIHsNCgkJLy8gUXVpY2tseSBoYW5kbGUgbm9uLXN0cmluZyBleHByZXNzaW9ucw0KCQlpZiAoIHR5cGVvZiB0ICE9ICJzdHJpbmciICkNCgkJCXJldHVybiBbIHQgXTsNCg0KCQkvLyBjaGVjayB0byBtYWtlIHN1cmUgY29udGV4dCBpcyBhIERPTSBlbGVtZW50IG9yIGEgZG9jdW1lbnQNCgkJaWYgKCBjb250ZXh0ICYmIGNvbnRleHQubm9kZVR5cGUgIT0gMSAmJiBjb250ZXh0Lm5vZGVUeXBlICE9IDkpDQoJCQlyZXR1cm4gWyBdOw0KDQoJCS8vIFNldCB0aGUgY29ycmVjdCBjb250ZXh0IChpZiBub25lIGlzIHByb3ZpZGVkKQ0KCQljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsNCg0KCQkvLyBJbml0aWFsaXplIHRoZSBzZWFyY2gNCgkJdmFyIHJldCA9IFtjb250ZXh0XSwgZG9uZSA9IFtdLCBsYXN0LCBub2RlTmFtZTsNCg0KCQkvLyBDb250aW51ZSB3aGlsZSBhIHNlbGVjdG9yIGV4cHJlc3Npb24gZXhpc3RzLCBhbmQgd2hpbGUNCgkJLy8gd2UncmUgbm8gbG9uZ2VyIGxvb3BpbmcgdXBvbiBvdXJzZWx2ZXMNCgkJd2hpbGUgKCB0ICYmIGxhc3QgIT0gdCApIHsNCgkJCXZhciByID0gW107DQoJCQlsYXN0ID0gdDsNCg0KCQkJdCA9IGpRdWVyeS50cmltKHQpOw0KDQoJCQl2YXIgZm91bmRUb2tlbiA9IGZhbHNlOw0KDQoJCQkvLyBBbiBhdHRlbXB0IGF0IHNwZWVkaW5nIHVwIGNoaWxkIHNlbGVjdG9ycyB0aGF0DQoJCQkvLyBwb2ludCB0byBhIHNwZWNpZmljIGVsZW1lbnQgdGFnDQoJCQl2YXIgcmUgPSBxdWlja0NoaWxkOw0KCQkJdmFyIG0gPSByZS5leGVjKHQpOw0KDQoJCQlpZiAoIG0gKSB7DQoJCQkJbm9kZU5hbWUgPSBtWzFdLnRvVXBwZXJDYXNlKCk7DQoNCgkJCQkvLyBQZXJmb3JtIG91ciBvd24gaXRlcmF0aW9uIGFuZCBmaWx0ZXINCgkJCQlmb3IgKCB2YXIgaSA9IDA7IHJldFtpXTsgaSsrICkNCgkJCQkJZm9yICggdmFyIGMgPSByZXRbaV0uZmlyc3RDaGlsZDsgYzsgYyA9IGMubmV4dFNpYmxpbmcgKQ0KCQkJCQkJaWYgKCBjLm5vZGVUeXBlID09IDEgJiYgKG5vZGVOYW1lID09ICIqIiB8fCBjLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT0gbm9kZU5hbWUpICkNCgkJCQkJCQlyLnB1c2goIGMgKTsNCg0KCQkJCXJldCA9IHI7DQoJCQkJdCA9IHQucmVwbGFjZSggcmUsICIiICk7DQoJCQkJaWYgKCB0LmluZGV4T2YoIiAiKSA9PSAwICkgY29udGludWU7DQoJCQkJZm91bmRUb2tlbiA9IHRydWU7DQoJCQl9IGVsc2Ugew0KCQkJCXJlID0gL14oWz4rfl0pXHMqKFx3KikvaTsNCg0KCQkJCWlmICggKG0gPSByZS5leGVjKHQpKSAhPSBudWxsICkgew0KCQkJCQlyID0gW107DQoNCgkJCQkJdmFyIG1lcmdlID0ge307DQoJCQkJCW5vZGVOYW1lID0gbVsyXS50b1VwcGVyQ2FzZSgpOw0KCQkJCQltID0gbVsxXTsNCg0KCQkJCQlmb3IgKCB2YXIgaiA9IDAsIHJsID0gcmV0Lmxlbmd0aDsgaiA8IHJsOyBqKysgKSB7DQoJCQkJCQl2YXIgbiA9IG0gPT0gIn4iIHx8IG0gPT0gIisiID8gcmV0W2pdLm5leHRTaWJsaW5nIDogcmV0W2pdLmZpcnN0Q2hpbGQ7DQoJCQkJCQlmb3IgKCA7IG47IG4gPSBuLm5leHRTaWJsaW5nICkNCgkJCQkJCQlpZiAoIG4ubm9kZVR5cGUgPT0gMSApIHsNCgkJCQkJCQkJdmFyIGlkID0galF1ZXJ5LmRhdGEobik7DQoNCgkJCQkJCQkJaWYgKCBtID09ICJ+IiAmJiBtZXJnZVtpZF0gKSBicmVhazsNCgkJCQkJCQkJDQoJCQkJCQkJCWlmICghbm9kZU5hbWUgfHwgbi5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09IG5vZGVOYW1lICkgew0KCQkJCQkJCQkJaWYgKCBtID09ICJ+IiApIG1lcmdlW2lkXSA9IHRydWU7DQoJCQkJCQkJCQlyLnB1c2goIG4gKTsNCgkJCQkJCQkJfQ0KCQkJCQkJCQkNCgkJCQkJCQkJaWYgKCBtID09ICIrIiApIGJyZWFrOw0KCQkJCQkJCX0NCgkJCQkJfQ0KDQoJCQkJCXJldCA9IHI7DQoNCgkJCQkJLy8gQW5kIHJlbW92ZSB0aGUgdG9rZW4NCgkJCQkJdCA9IGpRdWVyeS50cmltKCB0LnJlcGxhY2UoIHJlLCAiIiApICk7DQoJCQkJCWZvdW5kVG9rZW4gPSB0cnVlOw0KCQkJCX0NCgkJCX0NCg0KCQkJLy8gU2VlIGlmIHRoZXJlJ3Mgc3RpbGwgYW4gZXhwcmVzc2lvbiwgYW5kIHRoYXQgd2UgaGF2ZW4ndCBhbHJlYWR5DQoJCQkvLyBtYXRjaGVkIGEgdG9rZW4NCgkJCWlmICggdCAmJiAhZm91bmRUb2tlbiApIHsNCgkJCQkvLyBIYW5kbGUgbXVsdGlwbGUgZXhwcmVzc2lvbnMNCgkJCQlpZiAoICF0LmluZGV4T2YoIiwiKSApIHsNCgkJCQkJLy8gQ2xlYW4gdGhlIHJlc3VsdCBzZXQNCgkJCQkJaWYgKCBjb250ZXh0ID09IHJldFswXSApIHJldC5zaGlmdCgpOw0KDQoJCQkJCS8vIE1lcmdlIHRoZSByZXN1bHQgc2V0cw0KCQkJCQlkb25lID0galF1ZXJ5Lm1lcmdlKCBkb25lLCByZXQgKTsNCg0KCQkJCQkvLyBSZXNldCB0aGUgY29udGV4dA0KCQkJCQlyID0gcmV0ID0gW2NvbnRleHRdOw0KDQoJCQkJCS8vIFRvdWNoIHVwIHRoZSBzZWxlY3RvciBzdHJpbmcNCgkJCQkJdCA9ICIgIiArIHQuc3Vic3RyKDEsdC5sZW5ndGgpOw0KDQoJCQkJfSBlbHNlIHsNCgkJCQkJLy8gT3B0aW1pemUgZm9yIHRoZSBjYXNlIG5vZGVOYW1lI2lkTmFtZQ0KCQkJCQl2YXIgcmUyID0gcXVpY2tJRDsNCgkJCQkJdmFyIG0gPSByZTIuZXhlYyh0KTsNCgkJCQkJDQoJCQkJCS8vIFJlLW9yZ2FuaXplIHRoZSByZXN1bHRzLCBzbyB0aGF0IHRoZXkncmUgY29uc2lzdGVudA0KCQkJCQlpZiAoIG0gKSB7DQoJCQkJCQltID0gWyAwLCBtWzJdLCBtWzNdLCBtWzFdIF07DQoNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCS8vIE90aGVyd2lzZSwgZG8gYSB0cmFkaXRpb25hbCBmaWx0ZXIgY2hlY2sgZm9yDQoJCQkJCQkvLyBJRCwgY2xhc3MsIGFuZCBlbGVtZW50IHNlbGVjdG9ycw0KCQkJCQkJcmUyID0gcXVpY2tDbGFzczsNCgkJCQkJCW0gPSByZTIuZXhlYyh0KTsNCgkJCQkJfQ0KDQoJCQkJCW1bMl0gPSBtWzJdLnJlcGxhY2UoL1xcL2csICIiKTsNCg0KCQkJCQl2YXIgZWxlbSA9IHJldFtyZXQubGVuZ3RoLTFdOw0KDQoJCQkJCS8vIFRyeSB0byBkbyBhIGdsb2JhbCBzZWFyY2ggYnkgSUQsIHdoZXJlIHdlIGNhbg0KCQkJCQlpZiAoIG1bMV0gPT0gIiMiICYmIGVsZW0gJiYgZWxlbS5nZXRFbGVtZW50QnlJZCAmJiAhalF1ZXJ5LmlzWE1MRG9jKGVsZW0pICkgew0KCQkJCQkJLy8gT3B0aW1pemF0aW9uIGZvciBIVE1MIGRvY3VtZW50IGNhc2UNCgkJCQkJCXZhciBvaWQgPSBlbGVtLmdldEVsZW1lbnRCeUlkKG1bMl0pOw0KCQkJCQkJDQoJCQkJCQkvLyBEbyBhIHF1aWNrIGNoZWNrIGZvciB0aGUgZXhpc3RlbmNlIG9mIHRoZSBhY3R1YWwgSUQgYXR0cmlidXRlDQoJCQkJCQkvLyB0byBhdm9pZCBzZWxlY3RpbmcgYnkgdGhlIG5hbWUgYXR0cmlidXRlIGluIElFDQoJCQkJCQkvLyBhbHNvIGNoZWNrIHRvIGluc3VyZSBpZCBpcyBhIHN0cmluZyB0byBhdm9pZCBzZWxlY3RpbmcgYW4gZWxlbWVudCB3aXRoIHRoZSBuYW1lIG9mICdpZCcgaW5zaWRlIGEgZm9ybQ0KCQkJCQkJaWYgKCAoalF1ZXJ5LmJyb3dzZXIubXNpZXx8alF1ZXJ5LmJyb3dzZXIub3BlcmEpICYmIG9pZCAmJiB0eXBlb2Ygb2lkLmlkID09ICJzdHJpbmciICYmIG9pZC5pZCAhPSBtWzJdICkNCgkJCQkJCQlvaWQgPSBqUXVlcnkoJ1tAaWQ9IicrbVsyXSsnIl0nLCBlbGVtKVswXTsNCg0KCQkJCQkJLy8gRG8gYSBxdWljayBjaGVjayBmb3Igbm9kZSBuYW1lICh3aGVyZSBhcHBsaWNhYmxlKSBzbw0KCQkJCQkJLy8gdGhhdCBkaXYjZm9vIHNlYXJjaGVzIHdpbGwgYmUgcmVhbGx5IGZhc3QNCgkJCQkJCXJldCA9IHIgPSBvaWQgJiYgKCFtWzNdIHx8IGpRdWVyeS5ub2RlTmFtZShvaWQsIG1bM10pKSA/IFtvaWRdIDogW107DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQkvLyBXZSBuZWVkIHRvIGZpbmQgYWxsIGRlc2NlbmRhbnQgZWxlbWVudHMNCgkJCQkJCWZvciAoIHZhciBpID0gMDsgcmV0W2ldOyBpKysgKSB7DQoJCQkJCQkJLy8gR3JhYiB0aGUgdGFnIG5hbWUgYmVpbmcgc2VhcmNoZWQgZm9yDQoJCQkJCQkJdmFyIHRhZyA9IG1bMV0gPT0gIiMiICYmIG1bM10gPyBtWzNdIDogbVsxXSAhPSAiIiB8fCBtWzBdID09ICIiID8gIioiIDogbVsyXTsNCg0KCQkJCQkJCS8vIEhhbmRsZSBJRTcgYmVpbmcgcmVhbGx5IGR1bWIgYWJvdXQgPG9iamVjdD5zDQoJCQkJCQkJaWYgKCB0YWcgPT0gIioiICYmIHJldFtpXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09ICJvYmplY3QiICkNCgkJCQkJCQkJdGFnID0gInBhcmFtIjsNCg0KCQkJCQkJCXIgPSBqUXVlcnkubWVyZ2UoIHIsIHJldFtpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICkpOw0KCQkJCQkJfQ0KDQoJCQkJCQkvLyBJdCdzIGZhc3RlciB0byBmaWx0ZXIgYnkgY2xhc3MgYW5kIGJlIGRvbmUgd2l0aCBpdA0KCQkJCQkJaWYgKCBtWzFdID09ICIuIiApDQoJCQkJCQkJciA9IGpRdWVyeS5jbGFzc0ZpbHRlciggciwgbVsyXSApOw0KDQoJCQkJCQkvLyBTYW1lIHdpdGggSUQgZmlsdGVyaW5nDQoJCQkJCQlpZiAoIG1bMV0gPT0gIiMiICkgew0KCQkJCQkJCXZhciB0bXAgPSBbXTsNCg0KCQkJCQkJCS8vIFRyeSB0byBmaW5kIHRoZSBlbGVtZW50IHdpdGggdGhlIElEDQoJCQkJCQkJZm9yICggdmFyIGkgPSAwOyByW2ldOyBpKysgKQ0KCQkJCQkJCQlpZiAoIHJbaV0uZ2V0QXR0cmlidXRlKCJpZCIpID09IG1bMl0gKSB7DQoJCQkJCQkJCQl0bXAgPSBbIHJbaV0gXTsNCgkJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCQl9DQoNCgkJCQkJCQlyID0gdG1wOw0KCQkJCQkJfQ0KDQoJCQkJCQlyZXQgPSByOw0KCQkJCQl9DQoNCgkJCQkJdCA9IHQucmVwbGFjZSggcmUyLCAiIiApOw0KCQkJCX0NCg0KCQkJfQ0KDQoJCQkvLyBJZiBhIHNlbGVjdG9yIHN0cmluZyBzdGlsbCBleGlzdHMNCgkJCWlmICggdCApIHsNCgkJCQkvLyBBdHRlbXB0IHRvIGZpbHRlciBpdA0KCQkJCXZhciB2YWwgPSBqUXVlcnkuZmlsdGVyKHQscik7DQoJCQkJcmV0ID0gciA9IHZhbC5yOw0KCQkJCXQgPSBqUXVlcnkudHJpbSh2YWwudCk7DQoJCQl9DQoJCX0NCg0KCQkvLyBBbiBlcnJvciBvY2N1cnJlZCB3aXRoIHRoZSBzZWxlY3RvcjsNCgkJLy8ganVzdCByZXR1cm4gYW4gZW1wdHkgc2V0IGluc3RlYWQNCgkJaWYgKCB0ICkNCgkJCXJldCA9IFtdOw0KDQoJCS8vIFJlbW92ZSB0aGUgcm9vdCBjb250ZXh0DQoJCWlmICggcmV0ICYmIGNvbnRleHQgPT0gcmV0WzBdICkNCgkJCXJldC5zaGlmdCgpOw0KDQoJCS8vIEFuZCBjb21iaW5lIHRoZSByZXN1bHRzDQoJCWRvbmUgPSBqUXVlcnkubWVyZ2UoIGRvbmUsIHJldCApOw0KDQoJCXJldHVybiBkb25lOw0KCX0sDQoNCgljbGFzc0ZpbHRlcjogZnVuY3Rpb24ocixtLG5vdCl7DQoJCW0gPSAiICIgKyBtICsgIiAiOw0KCQl2YXIgdG1wID0gW107DQoJCWZvciAoIHZhciBpID0gMDsgcltpXTsgaSsrICkgew0KCQkJdmFyIHBhc3MgPSAoIiAiICsgcltpXS5jbGFzc05hbWUgKyAiICIpLmluZGV4T2YoIG0gKSA+PSAwOw0KCQkJaWYgKCAhbm90ICYmIHBhc3MgfHwgbm90ICYmICFwYXNzICkNCgkJCQl0bXAucHVzaCggcltpXSApOw0KCQl9DQoJCXJldHVybiB0bXA7DQoJfSwNCg0KCWZpbHRlcjogZnVuY3Rpb24odCxyLG5vdCkgew0KCQl2YXIgbGFzdDsNCg0KCQkvLyBMb29rIGZvciBjb21tb24gZmlsdGVyIGV4cHJlc3Npb25zDQoJCXdoaWxlICggdCAmJiB0ICE9IGxhc3QgKSB7DQoJCQlsYXN0ID0gdDsNCg0KCQkJdmFyIHAgPSBqUXVlcnkucGFyc2UsIG07DQoNCgkJCWZvciAoIHZhciBpID0gMDsgcFtpXTsgaSsrICkgew0KCQkJCW0gPSBwW2ldLmV4ZWMoIHQgKTsNCg0KCQkJCWlmICggbSApIHsNCgkJCQkJLy8gUmVtb3ZlIHdoYXQgd2UganVzdCBtYXRjaGVkDQoJCQkJCXQgPSB0LnN1YnN0cmluZyggbVswXS5sZW5ndGggKTsNCg0KCQkJCQltWzJdID0gbVsyXS5yZXBsYWNlKC9cXC9nLCAiIik7DQoJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCX0NCg0KCQkJaWYgKCAhbSApDQoJCQkJYnJlYWs7DQoNCgkJCS8vIDpub3QoKSBpcyBhIHNwZWNpYWwgY2FzZSB0aGF0IGNhbiBiZSBvcHRpbWl6ZWQgYnkNCgkJCS8vIGtlZXBpbmcgaXQgb3V0IG9mIHRoZSBleHByZXNzaW9uIGxpc3QNCgkJCWlmICggbVsxXSA9PSAiOiIgJiYgbVsyXSA9PSAibm90IiApDQoJCQkJLy8gb3B0aW1pemUgaWYgb25seSBvbmUgc2VsZWN0b3IgZm91bmQgKG1vc3QgY29tbW9uIGNhc2UpDQoJCQkJciA9IGlzU2ltcGxlLnRlc3QoIG1bM10gKSA/DQoJCQkJCWpRdWVyeS5maWx0ZXIobVszXSwgciwgdHJ1ZSkuciA6DQoJCQkJCWpRdWVyeSggciApLm5vdCggbVszXSApOw0KDQoJCQkvLyBXZSBjYW4gZ2V0IGEgYmlnIHNwZWVkIGJvb3N0IGJ5IGZpbHRlcmluZyBieSBjbGFzcyBoZXJlDQoJCQllbHNlIGlmICggbVsxXSA9PSAiLiIgKQ0KCQkJCXIgPSBqUXVlcnkuY2xhc3NGaWx0ZXIociwgbVsyXSwgbm90KTsNCg0KCQkJZWxzZSBpZiAoIG1bMV0gPT0gIlsiICkgew0KCQkJCXZhciB0bXAgPSBbXSwgdHlwZSA9IG1bM107DQoJCQkJDQoJCQkJZm9yICggdmFyIGkgPSAwLCBybCA9IHIubGVuZ3RoOyBpIDwgcmw7IGkrKyApIHsNCgkJCQkJdmFyIGEgPSByW2ldLCB6ID0gYVsgalF1ZXJ5LnByb3BzW21bMl1dIHx8IG1bMl0gXTsNCgkJCQkJDQoJCQkJCWlmICggeiA9PSBudWxsIHx8IC9ocmVmfHNyY3xzZWxlY3RlZC8udGVzdChtWzJdKSApDQoJCQkJCQl6ID0galF1ZXJ5LmF0dHIoYSxtWzJdKSB8fCAnJzsNCg0KCQkJCQlpZiAoICh0eXBlID09ICIiICYmICEheiB8fA0KCQkJCQkJIHR5cGUgPT0gIj0iICYmIHogPT0gbVs1XSB8fA0KCQkJCQkJIHR5cGUgPT0gIiE9IiAmJiB6ICE9IG1bNV0gfHwNCgkJCQkJCSB0eXBlID09ICJePSIgJiYgeiAmJiAhei5pbmRleE9mKG1bNV0pIHx8DQoJCQkJCQkgdHlwZSA9PSAiJD0iICYmIHouc3Vic3RyKHoubGVuZ3RoIC0gbVs1XS5sZW5ndGgpID09IG1bNV0gfHwNCgkJCQkJCSAodHlwZSA9PSAiKj0iIHx8IHR5cGUgPT0gIn49IikgJiYgei5pbmRleE9mKG1bNV0pID49IDApIF4gbm90ICkNCgkJCQkJCQl0bXAucHVzaCggYSApOw0KCQkJCX0NCgkJCQkNCgkJCQlyID0gdG1wOw0KDQoJCQkvLyBXZSBjYW4gZ2V0IGEgc3BlZWQgYm9vc3QgYnkgaGFuZGxpbmcgbnRoLWNoaWxkIGhlcmUNCgkJCX0gZWxzZSBpZiAoIG1bMV0gPT0gIjoiICYmIG1bMl0gPT0gIm50aC1jaGlsZCIgKSB7DQoJCQkJdmFyIG1lcmdlID0ge30sIHRtcCA9IFtdLA0KCQkJCQkvLyBwYXJzZSBlcXVhdGlvbnMgbGlrZSAnZXZlbicsICdvZGQnLCAnNScsICcybicsICczbisyJywgJzRuLTEnLCAnLW4rNicNCgkJCQkJdGVzdCA9IC8oLT8pKFxkKiluKCg/OlwrfC0pP1xkKikvLmV4ZWMoDQoJCQkJCQltWzNdID09ICJldmVuIiAmJiAiMm4iIHx8IG1bM10gPT0gIm9kZCIgJiYgIjJuKzEiIHx8DQoJCQkJCQkhL1xELy50ZXN0KG1bM10pICYmICIwbisiICsgbVszXSB8fCBtWzNdKSwNCgkJCQkJLy8gY2FsY3VsYXRlIHRoZSBudW1iZXJzIChmaXJzdCluKyhsYXN0KSBpbmNsdWRpbmcgaWYgdGhleSBhcmUgbmVnYXRpdmUNCgkJCQkJZmlyc3QgPSAodGVzdFsxXSArICh0ZXN0WzJdIHx8IDEpKSAtIDAsIGxhc3QgPSB0ZXN0WzNdIC0gMDsNCiANCgkJCQkvLyBsb29wIHRocm91Z2ggYWxsIHRoZSBlbGVtZW50cyBsZWZ0IGluIHRoZSBqUXVlcnkgb2JqZWN0DQoJCQkJZm9yICggdmFyIGkgPSAwLCBybCA9IHIubGVuZ3RoOyBpIDwgcmw7IGkrKyApIHsNCgkJCQkJdmFyIG5vZGUgPSByW2ldLCBwYXJlbnROb2RlID0gbm9kZS5wYXJlbnROb2RlLCBpZCA9IGpRdWVyeS5kYXRhKHBhcmVudE5vZGUpOw0KDQoJCQkJCWlmICggIW1lcmdlW2lkXSApIHsNCgkJCQkJCXZhciBjID0gMTsNCg0KCQkJCQkJZm9yICggdmFyIG4gPSBwYXJlbnROb2RlLmZpcnN0Q2hpbGQ7IG47IG4gPSBuLm5leHRTaWJsaW5nICkNCgkJCQkJCQlpZiAoIG4ubm9kZVR5cGUgPT0gMSApDQoJCQkJCQkJCW4ubm9kZUluZGV4ID0gYysrOw0KDQoJCQkJCQltZXJnZVtpZF0gPSB0cnVlOw0KCQkJCQl9DQoNCgkJCQkJdmFyIGFkZCA9IGZhbHNlOw0KDQoJCQkJCWlmICggZmlyc3QgPT0gMCApIHsNCgkJCQkJCWlmICggbm9kZS5ub2RlSW5kZXggPT0gbGFzdCApDQoJCQkJCQkJYWRkID0gdHJ1ZTsNCgkJCQkJfSBlbHNlIGlmICggKG5vZGUubm9kZUluZGV4IC0gbGFzdCkgJSBmaXJzdCA9PSAwICYmIChub2RlLm5vZGVJbmRleCAtIGxhc3QpIC8gZmlyc3QgPj0gMCApDQoJCQkJCQlhZGQgPSB0cnVlOw0KDQoJCQkJCWlmICggYWRkIF4gbm90ICkNCgkJCQkJCXRtcC5wdXNoKCBub2RlICk7DQoJCQkJfQ0KDQoJCQkJciA9IHRtcDsNCg0KCQkJLy8gT3RoZXJ3aXNlLCBmaW5kIHRoZSBleHByZXNzaW9uIHRvIGV4ZWN1dGUNCgkJCX0gZWxzZSB7DQoJCQkJdmFyIGZuID0galF1ZXJ5LmV4cHJbIG1bMV0gXTsNCgkJCQlpZiAoIHR5cGVvZiBmbiA9PSAib2JqZWN0IiApDQoJCQkJCWZuID0gZm5bIG1bMl0gXTsNCg0KCQkJCWlmICggdHlwZW9mIGZuID09ICJzdHJpbmciICkNCgkJCQkJZm4gPSBldmFsKCJmYWxzZXx8ZnVuY3Rpb24oYSxpKXtyZXR1cm4gIiArIGZuICsgIjt9Iik7DQoNCgkJCQkvLyBFeGVjdXRlIGl0IGFnYWluc3QgdGhlIGN1cnJlbnQgZmlsdGVyDQoJCQkJciA9IGpRdWVyeS5ncmVwKCByLCBmdW5jdGlvbihlbGVtLCBpKXsNCgkJCQkJcmV0dXJuIGZuKGVsZW0sIGksIG0sIHIpOw0KCQkJCX0sIG5vdCApOw0KCQkJfQ0KCQl9DQoNCgkJLy8gUmV0dXJuIGFuIGFycmF5IG9mIGZpbHRlcmVkIGVsZW1lbnRzIChyKQ0KCQkvLyBhbmQgdGhlIG1vZGlmaWVkIGV4cHJlc3Npb24gc3RyaW5nICh0KQ0KCQlyZXR1cm4geyByOiByLCB0OiB0IH07DQoJfSwNCg0KCWRpcjogZnVuY3Rpb24oIGVsZW0sIGRpciApew0KCQl2YXIgbWF0Y2hlZCA9IFtdOw0KCQl2YXIgY3VyID0gZWxlbVtkaXJdOw0KCQl3aGlsZSAoIGN1ciAmJiBjdXIgIT0gZG9jdW1lbnQgKSB7DQoJCQlpZiAoIGN1ci5ub2RlVHlwZSA9PSAxICkNCgkJCQltYXRjaGVkLnB1c2goIGN1ciApOw0KCQkJY3VyID0gY3VyW2Rpcl07DQoJCX0NCgkJcmV0dXJuIG1hdGNoZWQ7DQoJfSwNCgkNCgludGg6IGZ1bmN0aW9uKGN1cixyZXN1bHQsZGlyLGVsZW0pew0KCQlyZXN1bHQgPSByZXN1bHQgfHwgMTsNCgkJdmFyIG51bSA9IDA7DQoNCgkJZm9yICggOyBjdXI7IGN1ciA9IGN1cltkaXJdICkNCgkJCWlmICggY3VyLm5vZGVUeXBlID09IDEgJiYgKytudW0gPT0gcmVzdWx0ICkNCgkJCQlicmVhazsNCg0KCQlyZXR1cm4gY3VyOw0KCX0sDQoJDQoJc2libGluZzogZnVuY3Rpb24oIG4sIGVsZW0gKSB7DQoJCXZhciByID0gW107DQoNCgkJZm9yICggOyBuOyBuID0gbi5uZXh0U2libGluZyApIHsNCgkJCWlmICggbi5ub2RlVHlwZSA9PSAxICYmICghZWxlbSB8fCBuICE9IGVsZW0pICkNCgkJCQlyLnB1c2goIG4gKTsNCgkJfQ0KDQoJCXJldHVybiByOw0KCX0NCn0pOw0KDQovKg0KICogQSBudW1iZXIgb2YgaGVscGVyIGZ1bmN0aW9ucyB1c2VkIGZvciBtYW5hZ2luZyBldmVudHMuDQogKiBNYW55IG9mIHRoZSBpZGVhcyBiZWhpbmQgdGhpcyBjb2RlIG9yaWduYXRlZCBmcm9tIA0KICogRGVhbiBFZHdhcmRzJyBhZGRFdmVudCBsaWJyYXJ5Lg0KICovDQpqUXVlcnkuZXZlbnQgPSB7DQoNCgkvLyBCaW5kIGFuIGV2ZW50IHRvIGFuIGVsZW1lbnQNCgkvLyBPcmlnaW5hbCBieSBEZWFuIEVkd2FyZHMNCglhZGQ6IGZ1bmN0aW9uKGVsZW0sIHR5cGVzLCBoYW5kbGVyLCBkYXRhKSB7DQoJCWlmICggZWxlbS5ub2RlVHlwZSA9PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT0gOCApDQoJCQlyZXR1cm47DQoNCgkJLy8gRm9yIHdoYXRldmVyIHJlYXNvbiwgSUUgaGFzIHRyb3VibGUgcGFzc2luZyB0aGUgd2luZG93IG9iamVjdA0KCQkvLyBhcm91bmQsIGNhdXNpbmcgaXQgdG8gYmUgY2xvbmVkIGluIHRoZSBwcm9jZXNzDQoJCWlmICggalF1ZXJ5LmJyb3dzZXIubXNpZSAmJiBlbGVtLnNldEludGVydmFsICE9IHVuZGVmaW5lZCApDQoJCQllbGVtID0gd2luZG93Ow0KDQoJCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBmdW5jdGlvbiBiZWluZyBleGVjdXRlZCBoYXMgYSB1bmlxdWUgSUQNCgkJaWYgKCAhaGFuZGxlci5ndWlkICkNCgkJCWhhbmRsZXIuZ3VpZCA9IHRoaXMuZ3VpZCsrOw0KCQkJDQoJCS8vIGlmIGRhdGEgaXMgcGFzc2VkLCBiaW5kIHRvIGhhbmRsZXIgDQoJCWlmKCBkYXRhICE9IHVuZGVmaW5lZCApIHsgDQoJCQkvLyBDcmVhdGUgdGVtcG9yYXJ5IGZ1bmN0aW9uIHBvaW50ZXIgdG8gb3JpZ2luYWwgaGFuZGxlciANCgkJCXZhciBmbiA9IGhhbmRsZXI7IA0KDQoJCQkvLyBDcmVhdGUgdW5pcXVlIGhhbmRsZXIgZnVuY3Rpb24sIHdyYXBwZWQgYXJvdW5kIG9yaWdpbmFsIGhhbmRsZXIgDQoJCQloYW5kbGVyID0gZnVuY3Rpb24oKSB7IA0KCQkJCS8vIFBhc3MgYXJndW1lbnRzIGFuZCBjb250ZXh0IHRvIG9yaWdpbmFsIGhhbmRsZXIgDQoJCQkJcmV0dXJuIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IA0KCQkJfTsNCg0KCQkJLy8gU3RvcmUgZGF0YSBpbiB1bmlxdWUgaGFuZGxlciANCgkJCWhhbmRsZXIuZGF0YSA9IGRhdGE7DQoNCgkJCS8vIFNldCB0aGUgZ3VpZCBvZiB1bmlxdWUgaGFuZGxlciB0byB0aGUgc2FtZSBvZiBvcmlnaW5hbCBoYW5kbGVyLCBzbyBpdCBjYW4gYmUgcmVtb3ZlZCANCgkJCWhhbmRsZXIuZ3VpZCA9IGZuLmd1aWQ7DQoJCX0NCg0KCQkvLyBJbml0IHRoZSBlbGVtZW50J3MgZXZlbnQgc3RydWN0dXJlDQoJCXZhciBldmVudHMgPSBqUXVlcnkuZGF0YShlbGVtLCAiZXZlbnRzIikgfHwgalF1ZXJ5LmRhdGEoZWxlbSwgImV2ZW50cyIsIHt9KSwNCgkJCWhhbmRsZSA9IGpRdWVyeS5kYXRhKGVsZW0sICJoYW5kbGUiKSB8fCBqUXVlcnkuZGF0YShlbGVtLCAiaGFuZGxlIiwgZnVuY3Rpb24oKXsNCgkJCQkvLyByZXR1cm5lZCB1bmRlZmluZWQgb3IgZmFsc2UNCgkJCQl2YXIgdmFsOw0KDQoJCQkJLy8gSGFuZGxlIHRoZSBzZWNvbmQgZXZlbnQgb2YgYSB0cmlnZ2VyIGFuZCB3aGVuDQoJCQkJLy8gYW4gZXZlbnQgaXMgY2FsbGVkIGFmdGVyIGEgcGFnZSBoYXMgdW5sb2FkZWQNCgkJCQlpZiAoIHR5cGVvZiBqUXVlcnkgPT0gInVuZGVmaW5lZCIgfHwgalF1ZXJ5LmV2ZW50LnRyaWdnZXJlZCApDQoJCQkJCXJldHVybiB2YWw7DQoJCQ0KCQkJCXZhbCA9IGpRdWVyeS5ldmVudC5oYW5kbGUuYXBwbHkoYXJndW1lbnRzLmNhbGxlZS5lbGVtLCBhcmd1bWVudHMpOw0KCQkNCgkJCQlyZXR1cm4gdmFsOw0KCQkJfSk7DQoJCS8vIEFkZCBlbGVtIGFzIGEgcHJvcGVydHkgb2YgdGhlIGhhbmRsZSBmdW5jdGlvbg0KCQkvLyBUaGlzIGlzIHRvIHByZXZlbnQgYSBtZW1vcnkgbGVhayB3aXRoIG5vbi1uYXRpdmUNCgkJLy8gZXZlbnQgaW4gSUUuDQoJCWhhbmRsZS5lbGVtID0gZWxlbTsNCgkJCQ0KCQkJLy8gSGFuZGxlIG11bHRpcGxlIGV2ZW50cyBzZXBlcmF0ZWQgYnkgYSBzcGFjZQ0KCQkJLy8galF1ZXJ5KC4uLikuYmluZCgibW91c2VvdmVyIG1vdXNlb3V0IiwgZm4pOw0KCQkJalF1ZXJ5LmVhY2godHlwZXMuc3BsaXQoL1xzKy8pLCBmdW5jdGlvbihpbmRleCwgdHlwZSkgew0KCQkJCS8vIE5hbWVzcGFjZWQgZXZlbnQgaGFuZGxlcnMNCgkJCQl2YXIgcGFydHMgPSB0eXBlLnNwbGl0KCIuIik7DQoJCQkJdHlwZSA9IHBhcnRzWzBdOw0KCQkJCWhhbmRsZXIudHlwZSA9IHBhcnRzWzFdOw0KDQoJCQkJLy8gR2V0IHRoZSBjdXJyZW50IGxpc3Qgb2YgZnVuY3Rpb25zIGJvdW5kIHRvIHRoaXMgZXZlbnQNCgkJCQl2YXIgaGFuZGxlcnMgPSBldmVudHNbdHlwZV07DQoNCgkJCQkvLyBJbml0IHRoZSBldmVudCBoYW5kbGVyIHF1ZXVlDQoJCQkJaWYgKCFoYW5kbGVycykgew0KCQkJCQloYW5kbGVycyA9IGV2ZW50c1t0eXBlXSA9IHt9Ow0KCQkNCgkJCQkJLy8gQ2hlY2sgZm9yIGEgc3BlY2lhbCBldmVudCBoYW5kbGVyDQoJCQkJCS8vIE9ubHkgdXNlIGFkZEV2ZW50TGlzdGVuZXIvYXR0YWNoRXZlbnQgaWYgdGhlIHNwZWNpYWwNCgkJCQkJLy8gZXZlbnRzIGhhbmRsZXIgcmV0dXJucyBmYWxzZQ0KCQkJCQlpZiAoICFqUXVlcnkuZXZlbnQuc3BlY2lhbFt0eXBlXSB8fCBqUXVlcnkuZXZlbnQuc3BlY2lhbFt0eXBlXS5zZXR1cC5jYWxsKGVsZW0pID09PSBmYWxzZSApIHsNCgkJCQkJCS8vIEJpbmQgdGhlIGdsb2JhbCBldmVudCBoYW5kbGVyIHRvIHRoZSBlbGVtZW50DQoJCQkJCQlpZiAoZWxlbS5hZGRFdmVudExpc3RlbmVyKQ0KCQkJCQkJCWVsZW0uYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBoYW5kbGUsIGZhbHNlKTsNCgkJCQkJCWVsc2UgaWYgKGVsZW0uYXR0YWNoRXZlbnQpDQoJCQkJCQkJZWxlbS5hdHRhY2hFdmVudCgib24iICsgdHlwZSwgaGFuZGxlKTsNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCS8vIEFkZCB0aGUgZnVuY3Rpb24gdG8gdGhlIGVsZW1lbnQncyBoYW5kbGVyIGxpc3QNCgkJCQloYW5kbGVyc1toYW5kbGVyLmd1aWRdID0gaGFuZGxlcjsNCg0KCQkJCS8vIEtlZXAgdHJhY2sgb2Ygd2hpY2ggZXZlbnRzIGhhdmUgYmVlbiB1c2VkLCBmb3IgZ2xvYmFsIHRyaWdnZXJpbmcNCgkJCQlqUXVlcnkuZXZlbnQuZ2xvYmFsW3R5cGVdID0gdHJ1ZTsNCgkJCX0pOw0KCQkNCgkJLy8gTnVsbGlmeSBlbGVtIHRvIHByZXZlbnQgbWVtb3J5IGxlYWtzIGluIElFDQoJCWVsZW0gPSBudWxsOw0KCX0sDQoNCglndWlkOiAxLA0KCWdsb2JhbDoge30sDQoNCgkvLyBEZXRhY2ggYW4gZXZlbnQgb3Igc2V0IG9mIGV2ZW50cyBmcm9tIGFuIGVsZW1lbnQNCglyZW1vdmU6IGZ1bmN0aW9uKGVsZW0sIHR5cGVzLCBoYW5kbGVyKSB7DQoJCS8vIGRvbid0IGRvIGV2ZW50cyBvbiB0ZXh0IGFuZCBjb21tZW50IG5vZGVzDQoJCWlmICggZWxlbS5ub2RlVHlwZSA9PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT0gOCApDQoJCQlyZXR1cm47DQoNCgkJdmFyIGV2ZW50cyA9IGpRdWVyeS5kYXRhKGVsZW0sICJldmVudHMiKSwgcmV0LCBpbmRleDsNCg0KCQlpZiAoIGV2ZW50cyApIHsNCgkJCS8vIFVuYmluZCBhbGwgZXZlbnRzIGZvciB0aGUgZWxlbWVudA0KCQkJaWYgKCB0eXBlcyA9PSB1bmRlZmluZWQgfHwgKHR5cGVvZiB0eXBlcyA9PSAic3RyaW5nIiAmJiB0eXBlcy5jaGFyQXQoMCkgPT0gIi4iKSApDQoJCQkJZm9yICggdmFyIHR5cGUgaW4gZXZlbnRzICkNCgkJCQkJdGhpcy5yZW1vdmUoIGVsZW0sIHR5cGUgKyAodHlwZXMgfHwgIiIpICk7DQoJCQllbHNlIHsNCgkJCQkvLyB0eXBlcyBpcyBhY3R1YWxseSBhbiBldmVudCBvYmplY3QgaGVyZQ0KCQkJCWlmICggdHlwZXMudHlwZSApIHsNCgkJCQkJaGFuZGxlciA9IHR5cGVzLmhhbmRsZXI7DQoJCQkJCXR5cGVzID0gdHlwZXMudHlwZTsNCgkJCQl9DQoJCQkJDQoJCQkJLy8gSGFuZGxlIG11bHRpcGxlIGV2ZW50cyBzZXBlcmF0ZWQgYnkgYSBzcGFjZQ0KCQkJCS8vIGpRdWVyeSguLi4pLnVuYmluZCgibW91c2VvdmVyIG1vdXNlb3V0IiwgZm4pOw0KCQkJCWpRdWVyeS5lYWNoKHR5cGVzLnNwbGl0KC9ccysvKSwgZnVuY3Rpb24oaW5kZXgsIHR5cGUpew0KCQkJCQkvLyBOYW1lc3BhY2VkIGV2ZW50IGhhbmRsZXJzDQoJCQkJCXZhciBwYXJ0cyA9IHR5cGUuc3BsaXQoIi4iKTsNCgkJCQkJdHlwZSA9IHBhcnRzWzBdOw0KCQkJCQkNCgkJCQkJaWYgKCBldmVudHNbdHlwZV0gKSB7DQoJCQkJCQkvLyByZW1vdmUgdGhlIGdpdmVuIGhhbmRsZXIgZm9yIHRoZSBnaXZlbiB0eXBlDQoJCQkJCQlpZiAoIGhhbmRsZXIgKQ0KCQkJCQkJCWRlbGV0ZSBldmVudHNbdHlwZV1baGFuZGxlci5ndWlkXTsNCgkJCQ0KCQkJCQkJLy8gcmVtb3ZlIGFsbCBoYW5kbGVycyBmb3IgdGhlIGdpdmVuIHR5cGUNCgkJCQkJCWVsc2UNCgkJCQkJCQlmb3IgKCBoYW5kbGVyIGluIGV2ZW50c1t0eXBlXSApDQoJCQkJCQkJCS8vIEhhbmRsZSB0aGUgcmVtb3ZhbCBvZiBuYW1lc3BhY2VkIGV2ZW50cw0KCQkJCQkJCQlpZiAoICFwYXJ0c1sxXSB8fCBldmVudHNbdHlwZV1baGFuZGxlcl0udHlwZSA9PSBwYXJ0c1sxXSApDQoJCQkJCQkJCQlkZWxldGUgZXZlbnRzW3R5cGVdW2hhbmRsZXJdOw0KDQoJCQkJCQkvLyByZW1vdmUgZ2VuZXJpYyBldmVudCBoYW5kbGVyIGlmIG5vIG1vcmUgaGFuZGxlcnMgZXhpc3QNCgkJCQkJCWZvciAoIHJldCBpbiBldmVudHNbdHlwZV0gKSBicmVhazsNCgkJCQkJCWlmICggIXJldCApIHsNCgkJCQkJCQlpZiAoICFqUXVlcnkuZXZlbnQuc3BlY2lhbFt0eXBlXSB8fCBqUXVlcnkuZXZlbnQuc3BlY2lhbFt0eXBlXS50ZWFyZG93bi5jYWxsKGVsZW0pID09PSBmYWxzZSApIHsNCgkJCQkJCQkJaWYgKGVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lcikNCgkJCQkJCQkJCWVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBqUXVlcnkuZGF0YShlbGVtLCAiaGFuZGxlIiksIGZhbHNlKTsNCgkJCQkJCQkJZWxzZSBpZiAoZWxlbS5kZXRhY2hFdmVudCkNCgkJCQkJCQkJCWVsZW0uZGV0YWNoRXZlbnQoIm9uIiArIHR5cGUsIGpRdWVyeS5kYXRhKGVsZW0sICJoYW5kbGUiKSk7DQoJCQkJCQkJfQ0KCQkJCQkJCXJldCA9IG51bGw7DQoJCQkJCQkJZGVsZXRlIGV2ZW50c1t0eXBlXTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfQ0KDQoJCQkvLyBSZW1vdmUgdGhlIGV4cGFuZG8gaWYgaXQncyBubyBsb25nZXIgdXNlZA0KCQkJZm9yICggcmV0IGluIGV2ZW50cyApIGJyZWFrOw0KCQkJaWYgKCAhcmV0ICkgew0KCQkJCXZhciBoYW5kbGUgPSBqUXVlcnkuZGF0YSggZWxlbSwgImhhbmRsZSIgKTsNCgkJCQlpZiAoIGhhbmRsZSApIGhhbmRsZS5lbGVtID0gbnVsbDsNCgkJCQlqUXVlcnkucmVtb3ZlRGF0YSggZWxlbSwgImV2ZW50cyIgKTsNCgkJCQlqUXVlcnkucmVtb3ZlRGF0YSggZWxlbSwgImhhbmRsZSIgKTsNCgkJCX0NCgkJfQ0KCX0sDQoNCgl0cmlnZ2VyOiBmdW5jdGlvbih0eXBlLCBkYXRhLCBlbGVtLCBkb25hdGl2ZSwgZXh0cmEpIHsNCgkJLy8gQ2xvbmUgdGhlIGluY29taW5nIGRhdGEsIGlmIGFueQ0KCQlkYXRhID0galF1ZXJ5Lm1ha2VBcnJheShkYXRhIHx8IFtdKTsNCg0KCQlpZiAoIHR5cGUuaW5kZXhPZigiISIpID49IDAgKSB7DQoJCQl0eXBlID0gdHlwZS5zbGljZSgwLCAtMSk7DQoJCQl2YXIgZXhjbHVzaXZlID0gdHJ1ZTsNCgkJfQ0KDQoJCS8vIEhhbmRsZSBhIGdsb2JhbCB0cmlnZ2VyDQoJCWlmICggIWVsZW0gKSB7DQoJCQkvLyBPbmx5IHRyaWdnZXIgaWYgd2UndmUgZXZlciBib3VuZCBhbiBldmVudCBmb3IgaXQNCgkJCWlmICggdGhpcy5nbG9iYWxbdHlwZV0gKQ0KCQkJCWpRdWVyeSgiKiIpLmFkZChbd2luZG93LCBkb2N1bWVudF0pLnRyaWdnZXIodHlwZSwgZGF0YSk7DQoNCgkJLy8gSGFuZGxlIHRyaWdnZXJpbmcgYSBzaW5nbGUgZWxlbWVudA0KCQl9IGVsc2Ugew0KCQkJLy8gZG9uJ3QgZG8gZXZlbnRzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMNCgkJCWlmICggZWxlbS5ub2RlVHlwZSA9PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT0gOCApDQoJCQkJcmV0dXJuIHVuZGVmaW5lZDsNCg0KCQkJdmFyIHZhbCwgcmV0LCBmbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCBlbGVtWyB0eXBlIF0gfHwgbnVsbCApLA0KCQkJCS8vIENoZWNrIHRvIHNlZSBpZiB3ZSBuZWVkIHRvIHByb3ZpZGUgYSBmYWtlIGV2ZW50LCBvciBub3QNCgkJCQlldmVudCA9ICFkYXRhWzBdIHx8ICFkYXRhWzBdLnByZXZlbnREZWZhdWx0Ow0KCQkJDQoJCQkvLyBQYXNzIGFsb25nIGEgZmFrZSBldmVudA0KCQkJaWYgKCBldmVudCApDQoJCQkJZGF0YS51bnNoaWZ0KCB0aGlzLmZpeCh7IHR5cGU6IHR5cGUsIHRhcmdldDogZWxlbSB9KSApOw0KDQoJCQkvLyBFbmZvcmNlIHRoZSByaWdodCB0cmlnZ2VyIHR5cGUNCgkJCWRhdGFbMF0udHlwZSA9IHR5cGU7DQoJCQlpZiAoIGV4Y2x1c2l2ZSApDQoJCQkJZGF0YVswXS5leGNsdXNpdmUgPSB0cnVlOw0KDQoJCQkvLyBUcmlnZ2VyIHRoZSBldmVudA0KCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggalF1ZXJ5LmRhdGEoZWxlbSwgImhhbmRsZSIpICkgKQ0KCQkJCXZhbCA9IGpRdWVyeS5kYXRhKGVsZW0sICJoYW5kbGUiKS5hcHBseSggZWxlbSwgZGF0YSApOw0KDQoJCQkvLyBIYW5kbGUgdHJpZ2dlcmluZyBuYXRpdmUgLm9uZm9vIGhhbmRsZXJzDQoJCQlpZiAoICFmbiAmJiBlbGVtWyJvbiIrdHlwZV0gJiYgZWxlbVsib24iK3R5cGVdLmFwcGx5KCBlbGVtLCBkYXRhICkgPT09IGZhbHNlICkNCgkJCQl2YWwgPSBmYWxzZTsNCg0KCQkJLy8gRXh0cmEgZnVuY3Rpb25zIGRvbid0IGdldCB0aGUgY3VzdG9tIGV2ZW50IG9iamVjdA0KCQkJaWYgKCBldmVudCApDQoJCQkJZGF0YS5zaGlmdCgpOw0KDQoJCQkvLyBIYW5kbGUgdHJpZ2dlcmluZyBvZiBleHRyYSBmdW5jdGlvbg0KCQkJaWYgKCBleHRyYSAmJiBqUXVlcnkuaXNGdW5jdGlvbiggZXh0cmEgKSApIHsNCgkJCQkvLyBjYWxsIHRoZSBleHRyYSBmdW5jdGlvbiBhbmQgdGFjayB0aGUgY3VycmVudCByZXR1cm4gdmFsdWUgb24gdGhlIGVuZCBmb3IgcG9zc2libGUgaW5zcGVjdGlvbg0KCQkJCXJldCA9IGV4dHJhLmFwcGx5KCBlbGVtLCB2YWwgPT0gbnVsbCA/IGRhdGEgOiBkYXRhLmNvbmNhdCggdmFsICkgKTsNCgkJCQkvLyBpZiBhbnl0aGluZyBpcyByZXR1cm5lZCwgZ2l2ZSBpdCBwcmVjZWRlbmNlIGFuZCBoYXZlIGl0IG92ZXJ3cml0ZSB0aGUgcHJldmlvdXMgdmFsdWUNCgkJCQlpZiAocmV0ICE9PSB1bmRlZmluZWQpDQoJCQkJCXZhbCA9IHJldDsNCgkJCX0NCg0KCQkJLy8gVHJpZ2dlciB0aGUgbmF0aXZlIGV2ZW50cyAoZXhjZXB0IGZvciBjbGlja3Mgb24gbGlua3MpDQoJCQlpZiAoIGZuICYmIGRvbmF0aXZlICE9PSBmYWxzZSAmJiB2YWwgIT09IGZhbHNlICYmICEoalF1ZXJ5Lm5vZGVOYW1lKGVsZW0sICdhJykgJiYgdHlwZSA9PSAiY2xpY2siKSApIHsNCgkJCQl0aGlzLnRyaWdnZXJlZCA9IHRydWU7DQoJCQkJdHJ5IHsNCgkJCQkJZWxlbVsgdHlwZSBdKCk7DQoJCQkJLy8gcHJldmVudCBJRSBmcm9tIHRocm93aW5nIGFuIGVycm9yIGZvciBzb21lIGhpZGRlbiBlbGVtZW50cw0KCQkJCX0gY2F0Y2ggKGUpIHt9DQoJCQl9DQoNCgkJCXRoaXMudHJpZ2dlcmVkID0gZmFsc2U7DQoJCX0NCg0KCQlyZXR1cm4gdmFsOw0KCX0sDQoNCgloYW5kbGU6IGZ1bmN0aW9uKGV2ZW50KSB7DQoJCS8vIHJldHVybmVkIHVuZGVmaW5lZCBvciBmYWxzZQ0KCQl2YXIgdmFsOw0KDQoJCS8vIEVtcHR5IG9iamVjdCBpcyBmb3IgdHJpZ2dlcmVkIGV2ZW50cyB3aXRoIG5vIGRhdGENCgkJZXZlbnQgPSBqUXVlcnkuZXZlbnQuZml4KCBldmVudCB8fCB3aW5kb3cuZXZlbnQgfHwge30gKTsgDQoNCgkJLy8gTmFtZXNwYWNlZCBldmVudCBoYW5kbGVycw0KCQl2YXIgcGFydHMgPSBldmVudC50eXBlLnNwbGl0KCIuIik7DQoJCWV2ZW50LnR5cGUgPSBwYXJ0c1swXTsNCg0KCQl2YXIgaGFuZGxlcnMgPSBqUXVlcnkuZGF0YSh0aGlzLCAiZXZlbnRzIikgJiYgalF1ZXJ5LmRhdGEodGhpcywgImV2ZW50cyIpW2V2ZW50LnR5cGVdLCBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApOw0KCQlhcmdzLnVuc2hpZnQoIGV2ZW50ICk7DQoNCgkJZm9yICggdmFyIGogaW4gaGFuZGxlcnMgKSB7DQoJCQl2YXIgaGFuZGxlciA9IGhhbmRsZXJzW2pdOw0KCQkJLy8gUGFzcyBpbiBhIHJlZmVyZW5jZSB0byB0aGUgaGFuZGxlciBmdW5jdGlvbiBpdHNlbGYNCgkJCS8vIFNvIHRoYXQgd2UgY2FuIGxhdGVyIHJlbW92ZSBpdA0KCQkJYXJnc1swXS5oYW5kbGVyID0gaGFuZGxlcjsNCgkJCWFyZ3NbMF0uZGF0YSA9IGhhbmRsZXIuZGF0YTsNCg0KCQkJLy8gRmlsdGVyIHRoZSBmdW5jdGlvbnMgYnkgY2xhc3MNCgkJCWlmICggIXBhcnRzWzFdICYmICFldmVudC5leGNsdXNpdmUgfHwgaGFuZGxlci50eXBlID09IHBhcnRzWzFdICkgew0KCQkJCXZhciByZXQgPSBoYW5kbGVyLmFwcGx5KCB0aGlzLCBhcmdzICk7DQoNCgkJCQlpZiAoIHZhbCAhPT0gZmFsc2UgKQ0KCQkJCQl2YWwgPSByZXQ7DQoNCgkJCQlpZiAoIHJldCA9PT0gZmFsc2UgKSB7DQoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCS8vIENsZWFuIHVwIGFkZGVkIHByb3BlcnRpZXMgaW4gSUUgdG8gcHJldmVudCBtZW1vcnkgbGVhaw0KCQlpZiAoalF1ZXJ5LmJyb3dzZXIubXNpZSkNCgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LnByZXZlbnREZWZhdWx0ID0gZXZlbnQuc3RvcFByb3BhZ2F0aW9uID0NCgkJCQlldmVudC5oYW5kbGVyID0gZXZlbnQuZGF0YSA9IG51bGw7DQoNCgkJcmV0dXJuIHZhbDsNCgl9LA0KDQoJZml4OiBmdW5jdGlvbihldmVudCkgew0KCQkvLyBzdG9yZSBhIGNvcHkgb2YgdGhlIG9yaWdpbmFsIGV2ZW50IG9iamVjdCANCgkJLy8gYW5kIGNsb25lIHRvIHNldCByZWFkLW9ubHkgcHJvcGVydGllcw0KCQl2YXIgb3JpZ2luYWxFdmVudCA9IGV2ZW50Ow0KCQlldmVudCA9IGpRdWVyeS5leHRlbmQoe30sIG9yaWdpbmFsRXZlbnQpOw0KCQkNCgkJLy8gYWRkIHByZXZlbnREZWZhdWx0IGFuZCBzdG9wUHJvcGFnYXRpb24gc2luY2UgDQoJCS8vIHRoZXkgd2lsbCBub3Qgd29yayBvbiB0aGUgY2xvbmUNCgkJZXZlbnQucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbigpIHsNCgkJCS8vIGlmIHByZXZlbnREZWZhdWx0IGV4aXN0cyBydW4gaXQgb24gdGhlIG9yaWdpbmFsIGV2ZW50DQoJCQlpZiAob3JpZ2luYWxFdmVudC5wcmV2ZW50RGVmYXVsdCkNCgkJCQlvcmlnaW5hbEV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkvLyBvdGhlcndpc2Ugc2V0IHRoZSByZXR1cm5WYWx1ZSBwcm9wZXJ0eSBvZiB0aGUgb3JpZ2luYWwgZXZlbnQgdG8gZmFsc2UgKElFKQ0KCQkJb3JpZ2luYWxFdmVudC5yZXR1cm5WYWx1ZSA9IGZhbHNlOw0KCQl9Ow0KCQlldmVudC5zdG9wUHJvcGFnYXRpb24gPSBmdW5jdGlvbigpIHsNCgkJCS8vIGlmIHN0b3BQcm9wYWdhdGlvbiBleGlzdHMgcnVuIGl0IG9uIHRoZSBvcmlnaW5hbCBldmVudA0KCQkJaWYgKG9yaWdpbmFsRXZlbnQuc3RvcFByb3BhZ2F0aW9uKQ0KCQkJCW9yaWdpbmFsRXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7DQoJCQkvLyBvdGhlcndpc2Ugc2V0IHRoZSBjYW5jZWxCdWJibGUgcHJvcGVydHkgb2YgdGhlIG9yaWdpbmFsIGV2ZW50IHRvIHRydWUgKElFKQ0KCQkJb3JpZ2luYWxFdmVudC5jYW5jZWxCdWJibGUgPSB0cnVlOw0KCQl9Ow0KCQkNCgkJLy8gRml4IHRhcmdldCBwcm9wZXJ0eSwgaWYgbmVjZXNzYXJ5DQoJCWlmICggIWV2ZW50LnRhcmdldCApDQoJCQlldmVudC50YXJnZXQgPSBldmVudC5zcmNFbGVtZW50IHx8IGRvY3VtZW50OyAvLyBGaXhlcyAjMTkyNSB3aGVyZSBzcmNFbGVtZW50IG1pZ2h0IG5vdCBiZSBkZWZpbmVkIGVpdGhlcg0KCQkJCQ0KCQkvLyBjaGVjayBpZiB0YXJnZXQgaXMgYSB0ZXh0bm9kZSAoc2FmYXJpKQ0KCQlpZiAoIGV2ZW50LnRhcmdldC5ub2RlVHlwZSA9PSAzICkNCgkJCWV2ZW50LnRhcmdldCA9IG9yaWdpbmFsRXZlbnQudGFyZ2V0LnBhcmVudE5vZGU7DQoNCgkJLy8gQWRkIHJlbGF0ZWRUYXJnZXQsIGlmIG5lY2Vzc2FyeQ0KCQlpZiAoICFldmVudC5yZWxhdGVkVGFyZ2V0ICYmIGV2ZW50LmZyb21FbGVtZW50ICkNCgkJCWV2ZW50LnJlbGF0ZWRUYXJnZXQgPSBldmVudC5mcm9tRWxlbWVudCA9PSBldmVudC50YXJnZXQgPyBldmVudC50b0VsZW1lbnQgOiBldmVudC5mcm9tRWxlbWVudDsNCg0KCQkvLyBDYWxjdWxhdGUgcGFnZVgvWSBpZiBtaXNzaW5nIGFuZCBjbGllbnRYL1kgYXZhaWxhYmxlDQoJCWlmICggZXZlbnQucGFnZVggPT0gbnVsbCAmJiBldmVudC5jbGllbnRYICE9IG51bGwgKSB7DQoJCQl2YXIgZG9jID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBib2R5ID0gZG9jdW1lbnQuYm9keTsNCgkJCWV2ZW50LnBhZ2VYID0gZXZlbnQuY2xpZW50WCArIChkb2MgJiYgZG9jLnNjcm9sbExlZnQgfHwgYm9keSAmJiBib2R5LnNjcm9sbExlZnQgfHwgMCkgLSAoZG9jLmNsaWVudExlZnQgfHwgMCk7DQoJCQlldmVudC5wYWdlWSA9IGV2ZW50LmNsaWVudFkgKyAoZG9jICYmIGRvYy5zY3JvbGxUb3AgfHwgYm9keSAmJiBib2R5LnNjcm9sbFRvcCB8fCAwKSAtIChkb2MuY2xpZW50VG9wIHx8IDApOw0KCQl9DQoJCQkNCgkJLy8gQWRkIHdoaWNoIGZvciBrZXkgZXZlbnRzDQoJCWlmICggIWV2ZW50LndoaWNoICYmICgoZXZlbnQuY2hhckNvZGUgfHwgZXZlbnQuY2hhckNvZGUgPT09IDApID8gZXZlbnQuY2hhckNvZGUgOiBldmVudC5rZXlDb2RlKSApDQoJCQlldmVudC53aGljaCA9IGV2ZW50LmNoYXJDb2RlIHx8IGV2ZW50LmtleUNvZGU7DQoJCQ0KCQkvLyBBZGQgbWV0YUtleSB0byBub24tTWFjIGJyb3dzZXJzICh1c2UgY3RybCBmb3IgUEMncyBhbmQgTWV0YSBmb3IgTWFjcykNCgkJaWYgKCAhZXZlbnQubWV0YUtleSAmJiBldmVudC5jdHJsS2V5ICkNCgkJCWV2ZW50Lm1ldGFLZXkgPSBldmVudC5jdHJsS2V5Ow0KDQoJCS8vIEFkZCB3aGljaCBmb3IgY2xpY2s6IDEgPT0gbGVmdDsgMiA9PSBtaWRkbGU7IDMgPT0gcmlnaHQNCgkJLy8gTm90ZTogYnV0dG9uIGlzIG5vdCBub3JtYWxpemVkLCBzbyBkb24ndCB1c2UgaXQNCgkJaWYgKCAhZXZlbnQud2hpY2ggJiYgZXZlbnQuYnV0dG9uICkNCgkJCWV2ZW50LndoaWNoID0gKGV2ZW50LmJ1dHRvbiAmIDEgPyAxIDogKCBldmVudC5idXR0b24gJiAyID8gMyA6ICggZXZlbnQuYnV0dG9uICYgNCA/IDIgOiAwICkgKSk7DQoJCQkNCgkJcmV0dXJuIGV2ZW50Ow0KCX0sDQoJDQoJc3BlY2lhbDogew0KCQlyZWFkeTogew0KCQkJc2V0dXA6IGZ1bmN0aW9uKCkgew0KCQkJCS8vIE1ha2Ugc3VyZSB0aGUgcmVhZHkgZXZlbnQgaXMgc2V0dXANCgkJCQliaW5kUmVhZHkoKTsNCgkJCQlyZXR1cm47DQoJCQl9LA0KCQkJDQoJCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7IHJldHVybjsgfQ0KCQl9LA0KCQkNCgkJbW91c2VlbnRlcjogew0KCQkJc2V0dXA6IGZ1bmN0aW9uKCkgew0KCQkJCWlmICggalF1ZXJ5LmJyb3dzZXIubXNpZSApIHJldHVybiBmYWxzZTsNCgkJCQlqUXVlcnkodGhpcykuYmluZCgibW91c2VvdmVyIiwgalF1ZXJ5LmV2ZW50LnNwZWNpYWwubW91c2VlbnRlci5oYW5kbGVyKTsNCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0sDQoJCQ0KCQkJdGVhcmRvd246IGZ1bmN0aW9uKCkgew0KCQkJCWlmICggalF1ZXJ5LmJyb3dzZXIubXNpZSApIHJldHVybiBmYWxzZTsNCgkJCQlqUXVlcnkodGhpcykudW5iaW5kKCJtb3VzZW92ZXIiLCBqUXVlcnkuZXZlbnQuc3BlY2lhbC5tb3VzZWVudGVyLmhhbmRsZXIpOw0KCQkJCXJldHVybiB0cnVlOw0KCQkJfSwNCgkJCQ0KCQkJaGFuZGxlcjogZnVuY3Rpb24oZXZlbnQpIHsNCgkJCQkvLyBJZiB3ZSBhY3R1YWxseSBqdXN0IG1vdXNlZCBvbiB0byBhIHN1Yi1lbGVtZW50LCBpZ25vcmUgaXQNCgkJCQlpZiAoIHdpdGhpbkVsZW1lbnQoZXZlbnQsIHRoaXMpICkgcmV0dXJuIHRydWU7DQoJCQkJLy8gRXhlY3V0ZSB0aGUgcmlnaHQgaGFuZGxlcnMgYnkgc2V0dGluZyB0aGUgZXZlbnQgdHlwZSB0byBtb3VzZWVudGVyDQoJCQkJYXJndW1lbnRzWzBdLnR5cGUgPSAibW91c2VlbnRlciI7DQoJCQkJcmV0dXJuIGpRdWVyeS5ldmVudC5oYW5kbGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgkJCX0NCgkJfSwNCgkNCgkJbW91c2VsZWF2ZTogew0KCQkJc2V0dXA6IGZ1bmN0aW9uKCkgew0KCQkJCWlmICggalF1ZXJ5LmJyb3dzZXIubXNpZSApIHJldHVybiBmYWxzZTsNCgkJCQlqUXVlcnkodGhpcykuYmluZCgibW91c2VvdXQiLCBqUXVlcnkuZXZlbnQuc3BlY2lhbC5tb3VzZWxlYXZlLmhhbmRsZXIpOw0KCQkJCXJldHVybiB0cnVlOw0KCQkJfSwNCgkJDQoJCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7DQoJCQkJaWYgKCBqUXVlcnkuYnJvd3Nlci5tc2llICkgcmV0dXJuIGZhbHNlOw0KCQkJCWpRdWVyeSh0aGlzKS51bmJpbmQoIm1vdXNlb3V0IiwgalF1ZXJ5LmV2ZW50LnNwZWNpYWwubW91c2VsZWF2ZS5oYW5kbGVyKTsNCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0sDQoJCQkNCgkJCWhhbmRsZXI6IGZ1bmN0aW9uKGV2ZW50KSB7DQoJCQkJLy8gSWYgd2UgYWN0dWFsbHkganVzdCBtb3VzZWQgb24gdG8gYSBzdWItZWxlbWVudCwgaWdub3JlIGl0DQoJCQkJaWYgKCB3aXRoaW5FbGVtZW50KGV2ZW50LCB0aGlzKSApIHJldHVybiB0cnVlOw0KCQkJCS8vIEV4ZWN1dGUgdGhlIHJpZ2h0IGhhbmRsZXJzIGJ5IHNldHRpbmcgdGhlIGV2ZW50IHR5cGUgdG8gbW91c2VsZWF2ZQ0KCQkJCWFyZ3VtZW50c1swXS50eXBlID0gIm1vdXNlbGVhdmUiOw0KCQkJCXJldHVybiBqUXVlcnkuZXZlbnQuaGFuZGxlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQoJCQl9DQoJCX0NCgl9DQp9Ow0KDQpqUXVlcnkuZm4uZXh0ZW5kKHsNCgliaW5kOiBmdW5jdGlvbiggdHlwZSwgZGF0YSwgZm4gKSB7DQoJCXJldHVybiB0eXBlID09ICJ1bmxvYWQiID8gdGhpcy5vbmUodHlwZSwgZGF0YSwgZm4pIDogdGhpcy5lYWNoKGZ1bmN0aW9uKCl7DQoJCQlqUXVlcnkuZXZlbnQuYWRkKCB0aGlzLCB0eXBlLCBmbiB8fCBkYXRhLCBmbiAmJiBkYXRhICk7DQoJCX0pOw0KCX0sDQoJDQoJb25lOiBmdW5jdGlvbiggdHlwZSwgZGF0YSwgZm4gKSB7DQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsNCgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsIHR5cGUsIGZ1bmN0aW9uKGV2ZW50KSB7DQoJCQkJalF1ZXJ5KHRoaXMpLnVuYmluZChldmVudCk7DQoJCQkJcmV0dXJuIChmbiB8fCBkYXRhKS5hcHBseSggdGhpcywgYXJndW1lbnRzKTsNCgkJCX0sIGZuICYmIGRhdGEpOw0KCQl9KTsNCgl9LA0KDQoJdW5iaW5kOiBmdW5jdGlvbiggdHlwZSwgZm4gKSB7DQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsNCgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsIHR5cGUsIGZuICk7DQoJCX0pOw0KCX0sDQoNCgl0cmlnZ2VyOiBmdW5jdGlvbiggdHlwZSwgZGF0YSwgZm4gKSB7DQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsNCgkJCWpRdWVyeS5ldmVudC50cmlnZ2VyKCB0eXBlLCBkYXRhLCB0aGlzLCB0cnVlLCBmbiApOw0KCQl9KTsNCgl9LA0KDQoJdHJpZ2dlckhhbmRsZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhLCBmbiApIHsNCgkJaWYgKCB0aGlzWzBdICkNCgkJCXJldHVybiBqUXVlcnkuZXZlbnQudHJpZ2dlciggdHlwZSwgZGF0YSwgdGhpc1swXSwgZmFsc2UsIGZuICk7DQoJCXJldHVybiB1bmRlZmluZWQ7DQoJfSwNCg0KCXRvZ2dsZTogZnVuY3Rpb24oKSB7DQoJCS8vIFNhdmUgcmVmZXJlbmNlIHRvIGFyZ3VtZW50cyBmb3IgYWNjZXNzIGluIGNsb3N1cmUNCgkJdmFyIGFyZ3MgPSBhcmd1bWVudHM7DQoNCgkJcmV0dXJuIHRoaXMuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsNCgkJCS8vIEZpZ3VyZSBvdXQgd2hpY2ggZnVuY3Rpb24gdG8gZXhlY3V0ZQ0KCQkJdGhpcy5sYXN0VG9nZ2xlID0gMCA9PSB0aGlzLmxhc3RUb2dnbGUgPyAxIDogMDsNCgkJCQ0KCQkJLy8gTWFrZSBzdXJlIHRoYXQgY2xpY2tzIHN0b3ANCgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkNCgkJCS8vIGFuZCBleGVjdXRlIHRoZSBmdW5jdGlvbg0KCQkJcmV0dXJuIGFyZ3NbdGhpcy5sYXN0VG9nZ2xlXS5hcHBseSggdGhpcywgYXJndW1lbnRzICkgfHwgZmFsc2U7DQoJCX0pOw0KCX0sDQoNCglob3ZlcjogZnVuY3Rpb24oZm5PdmVyLCBmbk91dCkgew0KCQlyZXR1cm4gdGhpcy5iaW5kKCdtb3VzZWVudGVyJywgZm5PdmVyKS5iaW5kKCdtb3VzZWxlYXZlJywgZm5PdXQpOw0KCX0sDQoJDQoJcmVhZHk6IGZ1bmN0aW9uKGZuKSB7DQoJCS8vIEF0dGFjaCB0aGUgbGlzdGVuZXJzDQoJCWJpbmRSZWFkeSgpOw0KDQoJCS8vIElmIHRoZSBET00gaXMgYWxyZWFkeSByZWFkeQ0KCQlpZiAoIGpRdWVyeS5pc1JlYWR5ICkNCgkJCS8vIEV4ZWN1dGUgdGhlIGZ1bmN0aW9uIGltbWVkaWF0ZWx5DQoJCQlmbi5jYWxsKCBkb2N1bWVudCwgalF1ZXJ5ICk7DQoJCQkNCgkJLy8gT3RoZXJ3aXNlLCByZW1lbWJlciB0aGUgZnVuY3Rpb24gZm9yIGxhdGVyDQoJCWVsc2UNCgkJCS8vIEFkZCB0aGUgZnVuY3Rpb24gdG8gdGhlIHdhaXQgbGlzdA0KCQkJalF1ZXJ5LnJlYWR5TGlzdC5wdXNoKCBmdW5jdGlvbigpIHsgcmV0dXJuIGZuLmNhbGwodGhpcywgalF1ZXJ5KTsgfSApOw0KCQ0KCQlyZXR1cm4gdGhpczsNCgl9DQp9KTsNCg0KalF1ZXJ5LmV4dGVuZCh7DQoJaXNSZWFkeTogZmFsc2UsDQoJcmVhZHlMaXN0OiBbXSwNCgkvLyBIYW5kbGUgd2hlbiB0aGUgRE9NIGlzIHJlYWR5DQoJcmVhZHk6IGZ1bmN0aW9uKCkgew0KCQkvLyBNYWtlIHN1cmUgdGhhdCB0aGUgRE9NIGlzIG5vdCBhbHJlYWR5IGxvYWRlZA0KCQlpZiAoICFqUXVlcnkuaXNSZWFkeSApIHsNCgkJCS8vIFJlbWVtYmVyIHRoYXQgdGhlIERPTSBpcyByZWFkeQ0KCQkJalF1ZXJ5LmlzUmVhZHkgPSB0cnVlOw0KCQkJDQoJCQkvLyBJZiB0aGVyZSBhcmUgZnVuY3Rpb25zIGJvdW5kLCB0byBleGVjdXRlDQoJCQlpZiAoIGpRdWVyeS5yZWFkeUxpc3QgKSB7DQoJCQkJLy8gRXhlY3V0ZSBhbGwgb2YgdGhlbQ0KCQkJCWpRdWVyeS5lYWNoKCBqUXVlcnkucmVhZHlMaXN0LCBmdW5jdGlvbigpew0KCQkJCQl0aGlzLmFwcGx5KCBkb2N1bWVudCApOw0KCQkJCX0pOw0KCQkJCQ0KCQkJCS8vIFJlc2V0IHRoZSBsaXN0IG9mIGZ1bmN0aW9ucw0KCQkJCWpRdWVyeS5yZWFkeUxpc3QgPSBudWxsOw0KCQkJfQ0KCQkNCgkJCS8vIFRyaWdnZXIgYW55IGJvdW5kIHJlYWR5IGV2ZW50cw0KCQkJalF1ZXJ5KGRvY3VtZW50KS50cmlnZ2VySGFuZGxlcigicmVhZHkiKTsNCgkJfQ0KCX0NCn0pOw0KDQp2YXIgcmVhZHlCb3VuZCA9IGZhbHNlOw0KDQpmdW5jdGlvbiBiaW5kUmVhZHkoKXsNCglpZiAoIHJlYWR5Qm91bmQgKSByZXR1cm47DQoJcmVhZHlCb3VuZCA9IHRydWU7DQoNCgkvLyBNb3ppbGxhLCBPcGVyYSAoc2VlIGZ1cnRoZXIgYmVsb3cgZm9yIGl0KSBhbmQgd2Via2l0IG5pZ2h0bGllcyBjdXJyZW50bHkgc3VwcG9ydCB0aGlzIGV2ZW50DQoJaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICYmICFqUXVlcnkuYnJvd3Nlci5vcGVyYSkNCgkJLy8gVXNlIHRoZSBoYW5keSBldmVudCBjYWxsYmFjaw0KCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAiRE9NQ29udGVudExvYWRlZCIsIGpRdWVyeS5yZWFkeSwgZmFsc2UgKTsNCgkNCgkvLyBJZiBJRSBpcyB1c2VkIGFuZCBpcyBub3QgaW4gYSBmcmFtZQ0KCS8vIENvbnRpbnVhbGx5IGNoZWNrIHRvIHNlZSBpZiB0aGUgZG9jdW1lbnQgaXMgcmVhZHkNCglpZiAoIGpRdWVyeS5icm93c2VyLm1zaWUgJiYgd2luZG93ID09IHRvcCApIChmdW5jdGlvbigpew0KCQlpZiAoalF1ZXJ5LmlzUmVhZHkpIHJldHVybjsNCgkJdHJ5IHsNCgkJCS8vIElmIElFIGlzIHVzZWQsIHVzZSB0aGUgdHJpY2sgYnkgRGllZ28gUGVyaW5pDQoJCQkvLyBodHRwOi8vamF2YXNjcmlwdC5ud2JveC5jb20vSUVDb250ZW50TG9hZGVkLw0KCQkJZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKCJsZWZ0Iik7DQoJCX0gY2F0Y2goIGVycm9yICkgew0KCQkJc2V0VGltZW91dCggYXJndW1lbnRzLmNhbGxlZSwgMCApOw0KCQkJcmV0dXJuOw0KCQl9DQoJCS8vIGFuZCBleGVjdXRlIGFueSB3YWl0aW5nIGZ1bmN0aW9ucw0KCQlqUXVlcnkucmVhZHkoKTsNCgl9KSgpOw0KDQoJaWYgKCBqUXVlcnkuYnJvd3Nlci5vcGVyYSApDQoJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICJET01Db250ZW50TG9hZGVkIiwgZnVuY3Rpb24gKCkgew0KCQkJaWYgKGpRdWVyeS5pc1JlYWR5KSByZXR1cm47DQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGRvY3VtZW50LnN0eWxlU2hlZXRzLmxlbmd0aDsgaSsrKQ0KCQkJCWlmIChkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5kaXNhYmxlZCkgew0KCQkJCQlzZXRUaW1lb3V0KCBhcmd1bWVudHMuY2FsbGVlLCAwICk7DQoJCQkJCXJldHVybjsNCgkJCQl9DQoJCQkvLyBhbmQgZXhlY3V0ZSBhbnkgd2FpdGluZyBmdW5jdGlvbnMNCgkJCWpRdWVyeS5yZWFkeSgpOw0KCQl9LCBmYWxzZSk7DQoNCglpZiAoIGpRdWVyeS5icm93c2VyLnNhZmFyaSApIHsNCgkJdmFyIG51bVN0eWxlczsNCgkJKGZ1bmN0aW9uKCl7DQoJCQlpZiAoalF1ZXJ5LmlzUmVhZHkpIHJldHVybjsNCgkJCWlmICggZG9jdW1lbnQucmVhZHlTdGF0ZSAhPSAibG9hZGVkIiAmJiBkb2N1bWVudC5yZWFkeVN0YXRlICE9ICJjb21wbGV0ZSIgKSB7DQoJCQkJc2V0VGltZW91dCggYXJndW1lbnRzLmNhbGxlZSwgMCApOw0KCQkJCXJldHVybjsNCgkJCX0NCgkJCWlmICggbnVtU3R5bGVzID09PSB1bmRlZmluZWQgKQ0KCQkJCW51bVN0eWxlcyA9IGpRdWVyeSgic3R5bGUsIGxpbmtbcmVsPXN0eWxlc2hlZXRdIikubGVuZ3RoOw0KCQkJaWYgKCBkb2N1bWVudC5zdHlsZVNoZWV0cy5sZW5ndGggIT0gbnVtU3R5bGVzICkgew0KCQkJCXNldFRpbWVvdXQoIGFyZ3VtZW50cy5jYWxsZWUsIDAgKTsNCgkJCQlyZXR1cm47DQoJCQl9DQoJCQkvLyBhbmQgZXhlY3V0ZSBhbnkgd2FpdGluZyBmdW5jdGlvbnMNCgkJCWpRdWVyeS5yZWFkeSgpOw0KCQl9KSgpOw0KCX0NCg0KCS8vIEEgZmFsbGJhY2sgdG8gd2luZG93Lm9ubG9hZCwgdGhhdCB3aWxsIGFsd2F5cyB3b3JrDQoJalF1ZXJ5LmV2ZW50LmFkZCggd2luZG93LCAibG9hZCIsIGpRdWVyeS5yZWFkeSApOw0KfQ0KDQpqUXVlcnkuZWFjaCggKCJibHVyLGZvY3VzLGxvYWQscmVzaXplLHNjcm9sbCx1bmxvYWQsY2xpY2ssZGJsY2xpY2ssIiArDQoJIm1vdXNlZG93bixtb3VzZXVwLG1vdXNlbW92ZSxtb3VzZW92ZXIsbW91c2VvdXQsY2hhbmdlLHNlbGVjdCwiICsgDQoJInN1Ym1pdCxrZXlkb3duLGtleXByZXNzLGtleXVwLGVycm9yIikuc3BsaXQoIiwiKSwgZnVuY3Rpb24oaSwgbmFtZSl7DQoJDQoJLy8gSGFuZGxlIGV2ZW50IGJpbmRpbmcNCglqUXVlcnkuZm5bbmFtZV0gPSBmdW5jdGlvbihmbil7DQoJCXJldHVybiBmbiA/IHRoaXMuYmluZChuYW1lLCBmbikgOiB0aGlzLnRyaWdnZXIobmFtZSk7DQoJfTsNCn0pOw0KDQovLyBDaGVja3MgaWYgYW4gZXZlbnQgaGFwcGVuZWQgb24gYW4gZWxlbWVudCB3aXRoaW4gYW5vdGhlciBlbGVtZW50DQovLyBVc2VkIGluIGpRdWVyeS5ldmVudC5zcGVjaWFsLm1vdXNlZW50ZXIgYW5kIG1vdXNlbGVhdmUgaGFuZGxlcnMNCnZhciB3aXRoaW5FbGVtZW50ID0gZnVuY3Rpb24oZXZlbnQsIGVsZW0pIHsNCgkvLyBDaGVjayBpZiBtb3VzZShvdmVyfG91dCkgYXJlIHN0aWxsIHdpdGhpbiB0aGUgc2FtZSBwYXJlbnQgZWxlbWVudA0KCXZhciBwYXJlbnQgPSBldmVudC5yZWxhdGVkVGFyZ2V0Ow0KCS8vIFRyYXZlcnNlIHVwIHRoZSB0cmVlDQoJd2hpbGUgKCBwYXJlbnQgJiYgcGFyZW50ICE9IGVsZW0gKSB0cnkgeyBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTsgfSBjYXRjaChlcnJvcikgeyBwYXJlbnQgPSBlbGVtOyB9DQoJLy8gUmV0dXJuIHRydWUgaWYgd2UgYWN0dWFsbHkganVzdCBtb3VzZWQgb24gdG8gYSBzdWItZWxlbWVudA0KCXJldHVybiBwYXJlbnQgPT0gZWxlbTsNCn07DQoNCi8vIFByZXZlbnQgbWVtb3J5IGxlYWtzIGluIElFDQovLyBBbmQgcHJldmVudCBlcnJvcnMgb24gcmVmcmVzaCB3aXRoIGV2ZW50cyBsaWtlIG1vdXNlb3ZlciBpbiBvdGhlciBicm93c2Vycw0KLy8gV2luZG93IGlzbid0IGluY2x1ZGVkIHNvIGFzIG5vdCB0byB1bmJpbmQgZXhpc3RpbmcgdW5sb2FkIGV2ZW50cw0KalF1ZXJ5KHdpbmRvdykuYmluZCgidW5sb2FkIiwgZnVuY3Rpb24oKSB7DQoJalF1ZXJ5KCIqIikuYWRkKGRvY3VtZW50KS51bmJpbmQoKTsNCn0pOw0KalF1ZXJ5LmZuLmV4dGVuZCh7DQoJbG9hZDogZnVuY3Rpb24oIHVybCwgcGFyYW1zLCBjYWxsYmFjayApIHsNCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdXJsICkgKQ0KCQkJcmV0dXJuIHRoaXMuYmluZCgibG9hZCIsIHVybCk7DQoNCgkJdmFyIG9mZiA9IHVybC5pbmRleE9mKCIgIik7DQoJCWlmICggb2ZmID49IDAgKSB7DQoJCQl2YXIgc2VsZWN0b3IgPSB1cmwuc2xpY2Uob2ZmLCB1cmwubGVuZ3RoKTsNCgkJCXVybCA9IHVybC5zbGljZSgwLCBvZmYpOw0KCQl9DQoNCgkJY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBmdW5jdGlvbigpe307DQoNCgkJLy8gRGVmYXVsdCB0byBhIEdFVCByZXF1ZXN0DQoJCXZhciB0eXBlID0gIkdFVCI7DQoNCgkJLy8gSWYgdGhlIHNlY29uZCBwYXJhbWV0ZXIgd2FzIHByb3ZpZGVkDQoJCWlmICggcGFyYW1zICkNCgkJCS8vIElmIGl0J3MgYSBmdW5jdGlvbg0KCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcGFyYW1zICkgKSB7DQoJCQkJLy8gV2UgYXNzdW1lIHRoYXQgaXQncyB0aGUgY2FsbGJhY2sNCgkJCQljYWxsYmFjayA9IHBhcmFtczsNCgkJCQlwYXJhbXMgPSBudWxsOw0KDQoJCQkvLyBPdGhlcndpc2UsIGJ1aWxkIGEgcGFyYW0gc3RyaW5nDQoJCQl9IGVsc2Ugew0KCQkJCXBhcmFtcyA9IGpRdWVyeS5wYXJhbSggcGFyYW1zICk7DQoJCQkJdHlwZSA9ICJQT1NUIjsNCgkJCX0NCg0KCQl2YXIgc2VsZiA9IHRoaXM7DQoNCgkJLy8gUmVxdWVzdCB0aGUgcmVtb3RlIGRvY3VtZW50DQoJCWpRdWVyeS5hamF4KHsNCgkJCXVybDogdXJsLA0KCQkJdHlwZTogdHlwZSwNCgkJCWRhdGFUeXBlOiAiaHRtbCIsDQoJCQlkYXRhOiBwYXJhbXMsDQoJCQljb21wbGV0ZTogZnVuY3Rpb24ocmVzLCBzdGF0dXMpew0KCQkJCS8vIElmIHN1Y2Nlc3NmdWwsIGluamVjdCB0aGUgSFRNTCBpbnRvIGFsbCB0aGUgbWF0Y2hlZCBlbGVtZW50cw0KCQkJCWlmICggc3RhdHVzID09ICJzdWNjZXNzIiB8fCBzdGF0dXMgPT0gIm5vdG1vZGlmaWVkIiApDQoJCQkJCS8vIFNlZSBpZiBhIHNlbGVjdG9yIHdhcyBzcGVjaWZpZWQNCgkJCQkJc2VsZi5odG1sKCBzZWxlY3RvciA/DQoJCQkJCQkvLyBDcmVhdGUgYSBkdW1teSBkaXYgdG8gaG9sZCB0aGUgcmVzdWx0cw0KCQkJCQkJalF1ZXJ5KCI8ZGl2Lz4iKQ0KCQkJCQkJCS8vIGluamVjdCB0aGUgY29udGVudHMgb2YgdGhlIGRvY3VtZW50IGluLCByZW1vdmluZyB0aGUgc2NyaXB0cw0KCQkJCQkJCS8vIHRvIGF2b2lkIGFueSAnUGVybWlzc2lvbiBEZW5pZWQnIGVycm9ycyBpbiBJRQ0KCQkJCQkJCS5hcHBlbmQocmVzLnJlc3BvbnNlVGV4dC5yZXBsYWNlKC88c2NyaXB0KC58XHMpKj9cL3NjcmlwdD4vZywgIiIpKQ0KDQoJCQkJCQkJLy8gTG9jYXRlIHRoZSBzcGVjaWZpZWQgZWxlbWVudHMNCgkJCQkJCQkuZmluZChzZWxlY3RvcikgOg0KDQoJCQkJCQkvLyBJZiBub3QsIGp1c3QgaW5qZWN0IHRoZSBmdWxsIHJlc3VsdA0KCQkJCQkJcmVzLnJlc3BvbnNlVGV4dCApOw0KDQoJCQkJc2VsZi5lYWNoKCBjYWxsYmFjaywgW3Jlcy5yZXNwb25zZVRleHQsIHN0YXR1cywgcmVzXSApOw0KCQkJfQ0KCQl9KTsNCgkJcmV0dXJuIHRoaXM7DQoJfSwNCg0KCXNlcmlhbGl6ZTogZnVuY3Rpb24oKSB7DQoJCXJldHVybiBqUXVlcnkucGFyYW0odGhpcy5zZXJpYWxpemVBcnJheSgpKTsNCgl9LA0KCXNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7DQoJCQlyZXR1cm4galF1ZXJ5Lm5vZGVOYW1lKHRoaXMsICJmb3JtIikgPw0KCQkJCWpRdWVyeS5tYWtlQXJyYXkodGhpcy5lbGVtZW50cykgOiB0aGlzOw0KCQl9KQ0KCQkuZmlsdGVyKGZ1bmN0aW9uKCl7DQoJCQlyZXR1cm4gdGhpcy5uYW1lICYmICF0aGlzLmRpc2FibGVkICYmIA0KCQkJCSh0aGlzLmNoZWNrZWQgfHwgL3NlbGVjdHx0ZXh0YXJlYS9pLnRlc3QodGhpcy5ub2RlTmFtZSkgfHwgDQoJCQkJCS90ZXh0fGhpZGRlbnxwYXNzd29yZC9pLnRlc3QodGhpcy50eXBlKSk7DQoJCX0pDQoJCS5tYXAoZnVuY3Rpb24oaSwgZWxlbSl7DQoJCQl2YXIgdmFsID0galF1ZXJ5KHRoaXMpLnZhbCgpOw0KCQkJcmV0dXJuIHZhbCA9PSBudWxsID8gbnVsbCA6DQoJCQkJdmFsLmNvbnN0cnVjdG9yID09IEFycmF5ID8NCgkJCQkJalF1ZXJ5Lm1hcCggdmFsLCBmdW5jdGlvbih2YWwsIGkpew0KCQkJCQkJcmV0dXJuIHtuYW1lOiBlbGVtLm5hbWUsIHZhbHVlOiB2YWx9Ow0KCQkJCQl9KSA6DQoJCQkJCXtuYW1lOiBlbGVtLm5hbWUsIHZhbHVlOiB2YWx9Ow0KCQl9KS5nZXQoKTsNCgl9DQp9KTsNCg0KLy8gQXR0YWNoIGEgYnVuY2ggb2YgZnVuY3Rpb25zIGZvciBoYW5kbGluZyBjb21tb24gQUpBWCBldmVudHMNCmpRdWVyeS5lYWNoKCAiYWpheFN0YXJ0LGFqYXhTdG9wLGFqYXhDb21wbGV0ZSxhamF4RXJyb3IsYWpheFN1Y2Nlc3MsYWpheFNlbmQiLnNwbGl0KCIsIiksIGZ1bmN0aW9uKGksbyl7DQoJalF1ZXJ5LmZuW29dID0gZnVuY3Rpb24oZil7DQoJCXJldHVybiB0aGlzLmJpbmQobywgZik7DQoJfTsNCn0pOw0KDQp2YXIganNjID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7DQoNCmpRdWVyeS5leHRlbmQoew0KCWdldDogZnVuY3Rpb24oIHVybCwgZGF0YSwgY2FsbGJhY2ssIHR5cGUgKSB7DQoJCS8vIHNoaWZ0IGFyZ3VtZW50cyBpZiBkYXRhIGFyZ3VtZW50IHdhcyBvbW1pdGVkDQoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGRhdGEgKSApIHsNCgkJCWNhbGxiYWNrID0gZGF0YTsNCgkJCWRhdGEgPSBudWxsOw0KCQl9DQoJCQ0KCQlyZXR1cm4galF1ZXJ5LmFqYXgoew0KCQkJdHlwZTogIkdFVCIsDQoJCQl1cmw6IHVybCwNCgkJCWRhdGE6IGRhdGEsDQoJCQlzdWNjZXNzOiBjYWxsYmFjaywNCgkJCWRhdGFUeXBlOiB0eXBlDQoJCX0pOw0KCX0sDQoNCglnZXRTY3JpcHQ6IGZ1bmN0aW9uKCB1cmwsIGNhbGxiYWNrICkgew0KCQlyZXR1cm4galF1ZXJ5LmdldCh1cmwsIG51bGwsIGNhbGxiYWNrLCAic2NyaXB0Iik7DQoJfSwNCg0KCWdldEpTT046IGZ1bmN0aW9uKCB1cmwsIGRhdGEsIGNhbGxiYWNrICkgew0KCQlyZXR1cm4galF1ZXJ5LmdldCh1cmwsIGRhdGEsIGNhbGxiYWNrLCAianNvbiIpOw0KCX0sDQoNCglwb3N0OiBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjaywgdHlwZSApIHsNCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZGF0YSApICkgew0KCQkJY2FsbGJhY2sgPSBkYXRhOw0KCQkJZGF0YSA9IHt9Ow0KCQl9DQoNCgkJcmV0dXJuIGpRdWVyeS5hamF4KHsNCgkJCXR5cGU6ICJQT1NUIiwNCgkJCXVybDogdXJsLA0KCQkJZGF0YTogZGF0YSwNCgkJCXN1Y2Nlc3M6IGNhbGxiYWNrLA0KCQkJZGF0YVR5cGU6IHR5cGUNCgkJfSk7DQoJfSwNCg0KCWFqYXhTZXR1cDogZnVuY3Rpb24oIHNldHRpbmdzICkgew0KCQlqUXVlcnkuZXh0ZW5kKCBqUXVlcnkuYWpheFNldHRpbmdzLCBzZXR0aW5ncyApOw0KCX0sDQoNCglhamF4U2V0dGluZ3M6IHsNCgkJZ2xvYmFsOiB0cnVlLA0KCQl0eXBlOiAiR0VUIiwNCgkJdGltZW91dDogMCwNCgkJY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLA0KCQlwcm9jZXNzRGF0YTogdHJ1ZSwNCgkJYXN5bmM6IHRydWUsDQoJCWRhdGE6IG51bGwsDQoJCXVzZXJuYW1lOiBudWxsLA0KCQlwYXNzd29yZDogbnVsbCwNCgkJYWNjZXB0czogew0KCQkJeG1sOiAiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsDQoJCQlodG1sOiAidGV4dC9odG1sIiwNCgkJCXNjcmlwdDogInRleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCIsDQoJCQlqc29uOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0IiwNCgkJCXRleHQ6ICJ0ZXh0L3BsYWluIiwNCgkJCV9kZWZhdWx0OiAiKi8qIg0KCQl9DQoJfSwNCgkNCgkvLyBMYXN0LU1vZGlmaWVkIGhlYWRlciBjYWNoZSBmb3IgbmV4dCByZXF1ZXN0DQoJbGFzdE1vZGlmaWVkOiB7fSwNCg0KCWFqYXg6IGZ1bmN0aW9uKCBzICkgew0KCQl2YXIganNvbnAsIGpzcmUgPSAvPVw/KCZ8JCkvZywgc3RhdHVzLCBkYXRhOw0KDQoJCS8vIEV4dGVuZCB0aGUgc2V0dGluZ3MsIGJ1dCByZS1leHRlbmQgJ3MnIHNvIHRoYXQgaXQgY2FuIGJlDQoJCS8vIGNoZWNrZWQgYWdhaW4gbGF0ZXIgKGluIHRoZSB0ZXN0IHN1aXRlLCBzcGVjaWZpY2FsbHkpDQoJCXMgPSBqUXVlcnkuZXh0ZW5kKHRydWUsIHMsIGpRdWVyeS5leHRlbmQodHJ1ZSwge30sIGpRdWVyeS5hamF4U2V0dGluZ3MsIHMpKTsNCg0KCQkvLyBjb252ZXJ0IGRhdGEgaWYgbm90IGFscmVhZHkgYSBzdHJpbmcNCgkJaWYgKCBzLmRhdGEgJiYgcy5wcm9jZXNzRGF0YSAmJiB0eXBlb2Ygcy5kYXRhICE9ICJzdHJpbmciICkNCgkJCXMuZGF0YSA9IGpRdWVyeS5wYXJhbShzLmRhdGEpOw0KDQoJCS8vIEhhbmRsZSBKU09OUCBQYXJhbWV0ZXIgQ2FsbGJhY2tzDQoJCWlmICggcy5kYXRhVHlwZSA9PSAianNvbnAiICkgew0KCQkJaWYgKCBzLnR5cGUudG9Mb3dlckNhc2UoKSA9PSAiZ2V0IiApIHsNCgkJCQlpZiAoICFzLnVybC5tYXRjaChqc3JlKSApDQoJCQkJCXMudXJsICs9IChzLnVybC5tYXRjaCgvXD8vKSA/ICImIiA6ICI/IikgKyAocy5qc29ucCB8fCAiY2FsbGJhY2siKSArICI9PyI7DQoJCQl9IGVsc2UgaWYgKCAhcy5kYXRhIHx8ICFzLmRhdGEubWF0Y2goanNyZSkgKQ0KCQkJCXMuZGF0YSA9IChzLmRhdGEgPyBzLmRhdGEgKyAiJiIgOiAiIikgKyAocy5qc29ucCB8fCAiY2FsbGJhY2siKSArICI9PyI7DQoJCQlzLmRhdGFUeXBlID0gImpzb24iOw0KCQl9DQoNCgkJLy8gQnVpbGQgdGVtcG9yYXJ5IEpTT05QIGZ1bmN0aW9uDQoJCWlmICggcy5kYXRhVHlwZSA9PSAianNvbiIgJiYgKHMuZGF0YSAmJiBzLmRhdGEubWF0Y2goanNyZSkgfHwgcy51cmwubWF0Y2goanNyZSkpICkgew0KCQkJanNvbnAgPSAianNvbnAiICsganNjKys7DQoNCgkJCS8vIFJlcGxhY2UgdGhlID0/IHNlcXVlbmNlIGJvdGggaW4gdGhlIHF1ZXJ5IHN0cmluZyBhbmQgdGhlIGRhdGENCgkJCWlmICggcy5kYXRhICkNCgkJCQlzLmRhdGEgPSAocy5kYXRhICsgIiIpLnJlcGxhY2UoanNyZSwgIj0iICsganNvbnAgKyAiJDEiKTsNCgkJCXMudXJsID0gcy51cmwucmVwbGFjZShqc3JlLCAiPSIgKyBqc29ucCArICIkMSIpOw0KDQoJCQkvLyBXZSBuZWVkIHRvIG1ha2Ugc3VyZQ0KCQkJLy8gdGhhdCBhIEpTT05QIHN0eWxlIHJlc3BvbnNlIGlzIGV4ZWN1dGVkIHByb3Blcmx5DQoJCQlzLmRhdGFUeXBlID0gInNjcmlwdCI7DQoNCgkJCS8vIEhhbmRsZSBKU09OUC1zdHlsZSBsb2FkaW5nDQoJCQl3aW5kb3dbIGpzb25wIF0gPSBmdW5jdGlvbih0bXApew0KCQkJCWRhdGEgPSB0bXA7DQoJCQkJc3VjY2VzcygpOw0KCQkJCWNvbXBsZXRlKCk7DQoJCQkJLy8gR2FyYmFnZSBjb2xsZWN0DQoJCQkJd2luZG93WyBqc29ucCBdID0gdW5kZWZpbmVkOw0KCQkJCXRyeXsgZGVsZXRlIHdpbmRvd1sganNvbnAgXTsgfSBjYXRjaChlKXt9DQoJCQkJaWYgKCBoZWFkICkNCgkJCQkJaGVhZC5yZW1vdmVDaGlsZCggc2NyaXB0ICk7DQoJCQl9Ow0KCQl9DQoNCgkJaWYgKCBzLmRhdGFUeXBlID09ICJzY3JpcHQiICYmIHMuY2FjaGUgPT0gbnVsbCApDQoJCQlzLmNhY2hlID0gZmFsc2U7DQoNCgkJaWYgKCBzLmNhY2hlID09PSBmYWxzZSAmJiBzLnR5cGUudG9Mb3dlckNhc2UoKSA9PSAiZ2V0IiApIHsNCgkJCXZhciB0cyA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7DQoJCQkvLyB0cnkgcmVwbGFjaW5nIF89IGlmIGl0IGlzIHRoZXJlDQoJCQl2YXIgcmV0ID0gcy51cmwucmVwbGFjZSgvKFw/fCYpXz0uKj8oJnwkKS8sICIkMV89IiArIHRzICsgIiQyIik7DQoJCQkvLyBpZiBub3RoaW5nIHdhcyByZXBsYWNlZCwgYWRkIHRpbWVzdGFtcCB0byB0aGUgZW5kDQoJCQlzLnVybCA9IHJldCArICgocmV0ID09IHMudXJsKSA/IChzLnVybC5tYXRjaCgvXD8vKSA/ICImIiA6ICI/IikgKyAiXz0iICsgdHMgOiAiIik7DQoJCX0NCg0KCQkvLyBJZiBkYXRhIGlzIGF2YWlsYWJsZSwgYXBwZW5kIGRhdGEgdG8gdXJsIGZvciBnZXQgcmVxdWVzdHMNCgkJaWYgKCBzLmRhdGEgJiYgcy50eXBlLnRvTG93ZXJDYXNlKCkgPT0gImdldCIgKSB7DQoJCQlzLnVybCArPSAocy51cmwubWF0Y2goL1w/LykgPyAiJiIgOiAiPyIpICsgcy5kYXRhOw0KDQoJCQkvLyBJRSBsaWtlcyB0byBzZW5kIGJvdGggZ2V0IGFuZCBwb3N0IGRhdGEsIHByZXZlbnQgdGhpcw0KCQkJcy5kYXRhID0gbnVsbDsNCgkJfQ0KDQoJCS8vIFdhdGNoIGZvciBhIG5ldyBzZXQgb2YgcmVxdWVzdHMNCgkJaWYgKCBzLmdsb2JhbCAmJiAhIGpRdWVyeS5hY3RpdmUrKyApDQoJCQlqUXVlcnkuZXZlbnQudHJpZ2dlciggImFqYXhTdGFydCIgKTsNCg0KCQkvLyBJZiB3ZSdyZSByZXF1ZXN0aW5nIGEgcmVtb3RlIGRvY3VtZW50DQoJCS8vIGFuZCB0cnlpbmcgdG8gbG9hZCBKU09OIG9yIFNjcmlwdCB3aXRoIGEgR0VUDQoJCWlmICggKCFzLnVybC5pbmRleE9mKCJodHRwIikgfHwgIXMudXJsLmluZGV4T2YoIi8vIikpICYmIHMuZGF0YVR5cGUgPT0gInNjcmlwdCIgJiYgcy50eXBlLnRvTG93ZXJDYXNlKCkgPT0gImdldCIgKSB7DQoJCQl2YXIgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF07DQoJCQl2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQoJCQlzY3JpcHQuc3JjID0gcy51cmw7DQoJCQlpZiAocy5zY3JpcHRDaGFyc2V0KQ0KCQkJCXNjcmlwdC5jaGFyc2V0ID0gcy5zY3JpcHRDaGFyc2V0Ow0KDQoJCQkvLyBIYW5kbGUgU2NyaXB0IGxvYWRpbmcNCgkJCWlmICggIWpzb25wICkgew0KCQkJCXZhciBkb25lID0gZmFsc2U7DQoNCgkJCQkvLyBBdHRhY2ggaGFuZGxlcnMgZm9yIGFsbCBicm93c2Vycw0KCQkJCXNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKXsNCgkJCQkJaWYgKCAhZG9uZSAmJiAoIXRoaXMucmVhZHlTdGF0ZSB8fCANCgkJCQkJCQl0aGlzLnJlYWR5U3RhdGUgPT0gImxvYWRlZCIgfHwgdGhpcy5yZWFkeVN0YXRlID09ICJjb21wbGV0ZSIpICkgew0KCQkJCQkJZG9uZSA9IHRydWU7DQoJCQkJCQlzdWNjZXNzKCk7DQoJCQkJCQljb21wbGV0ZSgpOw0KCQkJCQkJaGVhZC5yZW1vdmVDaGlsZCggc2NyaXB0ICk7DQoJCQkJCX0NCgkJCQl9Ow0KCQkJfQ0KDQoJCQloZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7DQoNCgkJCS8vIFdlIGhhbmRsZSBldmVyeXRoaW5nIHVzaW5nIHRoZSBzY3JpcHQgZWxlbWVudCBpbmplY3Rpb24NCgkJCXJldHVybiB1bmRlZmluZWQ7DQoJCX0NCg0KCQl2YXIgcmVxdWVzdERvbmUgPSBmYWxzZTsNCg0KCQkvLyBDcmVhdGUgdGhlIHJlcXVlc3Qgb2JqZWN0OyBNaWNyb3NvZnQgZmFpbGVkIHRvIHByb3Blcmx5DQoJCS8vIGltcGxlbWVudCB0aGUgWE1MSHR0cFJlcXVlc3QgaW4gSUU3LCBzbyB3ZSB1c2UgdGhlIEFjdGl2ZVhPYmplY3Qgd2hlbiBpdCBpcyBhdmFpbGFibGUNCgkJdmFyIHhtbCA9IHdpbmRvdy5BY3RpdmVYT2JqZWN0ID8gbmV3IEFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIikgOiBuZXcgWE1MSHR0cFJlcXVlc3QoKTsNCg0KCQkvLyBPcGVuIHRoZSBzb2NrZXQNCgkJeG1sLm9wZW4ocy50eXBlLCBzLnVybCwgcy5hc3luYywgcy51c2VybmFtZSwgcy5wYXNzd29yZCk7DQoNCgkJLy8gTmVlZCBhbiBleHRyYSB0cnkvY2F0Y2ggZm9yIGNyb3NzIGRvbWFpbiByZXF1ZXN0cyBpbiBGaXJlZm94IDMNCgkJdHJ5IHsNCgkJCS8vIFNldCB0aGUgY29ycmVjdCBoZWFkZXIsIGlmIGRhdGEgaXMgYmVpbmcgc2VudA0KCQkJaWYgKCBzLmRhdGEgKQ0KCQkJCXhtbC5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCBzLmNvbnRlbnRUeXBlKTsNCg0KCQkJLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBoZWFkZXIsIGlmIGlmTW9kaWZpZWQgbW9kZS4NCgkJCWlmICggcy5pZk1vZGlmaWVkICkNCgkJCQl4bWwuc2V0UmVxdWVzdEhlYWRlcigiSWYtTW9kaWZpZWQtU2luY2UiLA0KCQkJCQlqUXVlcnkubGFzdE1vZGlmaWVkW3MudXJsXSB8fCAiVGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBHTVQiICk7DQoNCgkJCS8vIFNldCBoZWFkZXIgc28gdGhlIGNhbGxlZCBzY3JpcHQga25vd3MgdGhhdCBpdCdzIGFuIFhNTEh0dHBSZXF1ZXN0DQoJCQl4bWwuc2V0UmVxdWVzdEhlYWRlcigiWC1SZXF1ZXN0ZWQtV2l0aCIsICJYTUxIdHRwUmVxdWVzdCIpOw0KDQoJCQkvLyBTZXQgdGhlIEFjY2VwdHMgaGVhZGVyIGZvciB0aGUgc2VydmVyLCBkZXBlbmRpbmcgb24gdGhlIGRhdGFUeXBlDQoJCQl4bWwuc2V0UmVxdWVzdEhlYWRlcigiQWNjZXB0Iiwgcy5kYXRhVHlwZSAmJiBzLmFjY2VwdHNbIHMuZGF0YVR5cGUgXSA/DQoJCQkJcy5hY2NlcHRzWyBzLmRhdGFUeXBlIF0gKyAiLCAqLyoiIDoNCgkJCQlzLmFjY2VwdHMuX2RlZmF1bHQgKTsNCgkJfSBjYXRjaChlKXt9DQoNCgkJLy8gQWxsb3cgY3VzdG9tIGhlYWRlcnMvbWltZXR5cGVzDQoJCWlmICggcy5iZWZvcmVTZW5kICkNCgkJCXMuYmVmb3JlU2VuZCh4bWwpOw0KCQkJDQoJCWlmICggcy5nbG9iYWwgKQ0KCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTZW5kIiwgW3htbCwgc10pOw0KDQoJCS8vIFdhaXQgZm9yIGEgcmVzcG9uc2UgdG8gY29tZSBiYWNrDQoJCXZhciBvbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbihpc1RpbWVvdXQpew0KCQkJLy8gVGhlIHRyYW5zZmVyIGlzIGNvbXBsZXRlIGFuZCB0aGUgZGF0YSBpcyBhdmFpbGFibGUsIG9yIHRoZSByZXF1ZXN0IHRpbWVkIG91dA0KCQkJaWYgKCAhcmVxdWVzdERvbmUgJiYgeG1sICYmICh4bWwucmVhZHlTdGF0ZSA9PSA0IHx8IGlzVGltZW91dCA9PSAidGltZW91dCIpICkgew0KCQkJCXJlcXVlc3REb25lID0gdHJ1ZTsNCgkJCQkNCgkJCQkvLyBjbGVhciBwb2xsIGludGVydmFsDQoJCQkJaWYgKGl2YWwpIHsNCgkJCQkJY2xlYXJJbnRlcnZhbChpdmFsKTsNCgkJCQkJaXZhbCA9IG51bGw7DQoJCQkJfQ0KCQkJCQ0KCQkJCXN0YXR1cyA9IGlzVGltZW91dCA9PSAidGltZW91dCIgJiYgInRpbWVvdXQiIHx8DQoJCQkJCSFqUXVlcnkuaHR0cFN1Y2Nlc3MoIHhtbCApICYmICJlcnJvciIgfHwNCgkJCQkJcy5pZk1vZGlmaWVkICYmIGpRdWVyeS5odHRwTm90TW9kaWZpZWQoIHhtbCwgcy51cmwgKSAmJiAibm90bW9kaWZpZWQiIHx8DQoJCQkJCSJzdWNjZXNzIjsNCg0KCQkJCWlmICggc3RhdHVzID09ICJzdWNjZXNzIiApIHsNCgkJCQkJLy8gV2F0Y2ggZm9yLCBhbmQgY2F0Y2gsIFhNTCBkb2N1bWVudCBwYXJzZSBlcnJvcnMNCgkJCQkJdHJ5IHsNCgkJCQkJCS8vIHByb2Nlc3MgdGhlIGRhdGEgKHJ1bnMgdGhlIHhtbCB0aHJvdWdoIGh0dHBEYXRhIHJlZ2FyZGxlc3Mgb2YgY2FsbGJhY2spDQoJCQkJCQlkYXRhID0galF1ZXJ5Lmh0dHBEYXRhKCB4bWwsIHMuZGF0YVR5cGUgKTsNCgkJCQkJfSBjYXRjaChlKSB7DQoJCQkJCQlzdGF0dXMgPSAicGFyc2VyZXJyb3IiOw0KCQkJCQl9DQoJCQkJfQ0KDQoJCQkJLy8gTWFrZSBzdXJlIHRoYXQgdGhlIHJlcXVlc3Qgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90bW9kaWZpZWQNCgkJCQlpZiAoIHN0YXR1cyA9PSAic3VjY2VzcyIgKSB7DQoJCQkJCS8vIENhY2hlIExhc3QtTW9kaWZpZWQgaGVhZGVyLCBpZiBpZk1vZGlmaWVkIG1vZGUuDQoJCQkJCXZhciBtb2RSZXM7DQoJCQkJCXRyeSB7DQoJCQkJCQltb2RSZXMgPSB4bWwuZ2V0UmVzcG9uc2VIZWFkZXIoIkxhc3QtTW9kaWZpZWQiKTsNCgkJCQkJfSBjYXRjaChlKSB7fSAvLyBzd2FsbG93IGV4Y2VwdGlvbiB0aHJvd24gYnkgRkYgaWYgaGVhZGVyIGlzIG5vdCBhdmFpbGFibGUNCgkNCgkJCQkJaWYgKCBzLmlmTW9kaWZpZWQgJiYgbW9kUmVzICkNCgkJCQkJCWpRdWVyeS5sYXN0TW9kaWZpZWRbcy51cmxdID0gbW9kUmVzOw0KDQoJCQkJCS8vIEpTT05QIGhhbmRsZXMgaXRzIG93biBzdWNjZXNzIGNhbGxiYWNrDQoJCQkJCWlmICggIWpzb25wICkNCgkJCQkJCXN1Y2Nlc3MoKTsJDQoJCQkJfSBlbHNlDQoJCQkJCWpRdWVyeS5oYW5kbGVFcnJvcihzLCB4bWwsIHN0YXR1cyk7DQoNCgkJCQkvLyBGaXJlIHRoZSBjb21wbGV0ZSBoYW5kbGVycw0KCQkJCWNvbXBsZXRlKCk7DQoNCgkJCQkvLyBTdG9wIG1lbW9yeSBsZWFrcw0KCQkJCWlmICggcy5hc3luYyApDQoJCQkJCXhtbCA9IG51bGw7DQoJCQl9DQoJCX07DQoJCQ0KCQlpZiAoIHMuYXN5bmMgKSB7DQoJCQkvLyBkb24ndCBhdHRhY2ggdGhlIGhhbmRsZXIgdG8gdGhlIHJlcXVlc3QsIGp1c3QgcG9sbCBpdCBpbnN0ZWFkDQoJCQl2YXIgaXZhbCA9IHNldEludGVydmFsKG9ucmVhZHlzdGF0ZWNoYW5nZSwgMTMpOyANCg0KCQkJLy8gVGltZW91dCBjaGVja2VyDQoJCQlpZiAoIHMudGltZW91dCA+IDAgKQ0KCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkJCQkJLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZSByZXF1ZXN0IGlzIHN0aWxsIGhhcHBlbmluZw0KCQkJCQlpZiAoIHhtbCApIHsNCgkJCQkJCS8vIENhbmNlbCB0aGUgcmVxdWVzdA0KCQkJCQkJeG1sLmFib3J0KCk7DQoJDQoJCQkJCQlpZiggIXJlcXVlc3REb25lICkNCgkJCQkJCQlvbnJlYWR5c3RhdGVjaGFuZ2UoICJ0aW1lb3V0IiApOw0KCQkJCQl9DQoJCQkJfSwgcy50aW1lb3V0KTsNCgkJfQ0KCQkJDQoJCS8vIFNlbmQgdGhlIGRhdGENCgkJdHJ5IHsNCgkJCXhtbC5zZW5kKHMuZGF0YSk7DQoJCX0gY2F0Y2goZSkgew0KCQkJalF1ZXJ5LmhhbmRsZUVycm9yKHMsIHhtbCwgbnVsbCwgZSk7DQoJCX0NCgkJDQoJCS8vIGZpcmVmb3ggMS41IGRvZXNuJ3QgZmlyZSBzdGF0ZWNoYW5nZSBmb3Igc3luYyByZXF1ZXN0cw0KCQlpZiAoICFzLmFzeW5jICkNCgkJCW9ucmVhZHlzdGF0ZWNoYW5nZSgpOw0KDQoJCWZ1bmN0aW9uIHN1Y2Nlc3MoKXsNCgkJCS8vIElmIGEgbG9jYWwgY2FsbGJhY2sgd2FzIHNwZWNpZmllZCwgZmlyZSBpdCBhbmQgcGFzcyBpdCB0aGUgZGF0YQ0KCQkJaWYgKCBzLnN1Y2Nlc3MgKQ0KCQkJCXMuc3VjY2VzcyggZGF0YSwgc3RhdHVzICk7DQoNCgkJCS8vIEZpcmUgdGhlIGdsb2JhbCBjYWxsYmFjaw0KCQkJaWYgKCBzLmdsb2JhbCApDQoJCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoICJhamF4U3VjY2VzcyIsIFt4bWwsIHNdICk7DQoJCX0NCg0KCQlmdW5jdGlvbiBjb21wbGV0ZSgpew0KCQkJLy8gUHJvY2VzcyByZXN1bHQNCgkJCWlmICggcy5jb21wbGV0ZSApDQoJCQkJcy5jb21wbGV0ZSh4bWwsIHN0YXR1cyk7DQoNCgkJCS8vIFRoZSByZXF1ZXN0IHdhcyBjb21wbGV0ZWQNCgkJCWlmICggcy5nbG9iYWwgKQ0KCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyKCAiYWpheENvbXBsZXRlIiwgW3htbCwgc10gKTsNCg0KCQkJLy8gSGFuZGxlIHRoZSBnbG9iYWwgQUpBWCBjb3VudGVyDQoJCQlpZiAoIHMuZ2xvYmFsICYmICEgLS1qUXVlcnkuYWN0aXZlICkNCgkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlciggImFqYXhTdG9wIiApOw0KCQl9DQoJCQ0KCQkvLyByZXR1cm4gWE1MSHR0cFJlcXVlc3QgdG8gYWxsb3cgYWJvcnRpbmcgdGhlIHJlcXVlc3QgZXRjLg0KCQlyZXR1cm4geG1sOw0KCX0sDQoNCgloYW5kbGVFcnJvcjogZnVuY3Rpb24oIHMsIHhtbCwgc3RhdHVzLCBlICkgew0KCQkvLyBJZiBhIGxvY2FsIGNhbGxiYWNrIHdhcyBzcGVjaWZpZWQsIGZpcmUgaXQNCgkJaWYgKCBzLmVycm9yICkgcy5lcnJvciggeG1sLCBzdGF0dXMsIGUgKTsNCg0KCQkvLyBGaXJlIHRoZSBnbG9iYWwgY2FsbGJhY2sNCgkJaWYgKCBzLmdsb2JhbCApDQoJCQlqUXVlcnkuZXZlbnQudHJpZ2dlciggImFqYXhFcnJvciIsIFt4bWwsIHMsIGVdICk7DQoJfSwNCg0KCS8vIENvdW50ZXIgZm9yIGhvbGRpbmcgdGhlIG51bWJlciBvZiBhY3RpdmUgcXVlcmllcw0KCWFjdGl2ZTogMCwNCg0KCS8vIERldGVybWluZXMgaWYgYW4gWE1MSHR0cFJlcXVlc3Qgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQoJaHR0cFN1Y2Nlc3M6IGZ1bmN0aW9uKCByICkgew0KCQl0cnkgew0KCQkJLy8gSUUgZXJyb3Igc29tZXRpbWVzIHJldHVybnMgMTIyMyB3aGVuIGl0IHNob3VsZCBiZSAyMDQgc28gdHJlYXQgaXQgYXMgc3VjY2Vzcywgc2VlICMxNDUwDQoJCQlyZXR1cm4gIXIuc3RhdHVzICYmIGxvY2F0aW9uLnByb3RvY29sID09ICJmaWxlOiIgfHwNCgkJCQkoIHIuc3RhdHVzID49IDIwMCAmJiByLnN0YXR1cyA8IDMwMCApIHx8IHIuc3RhdHVzID09IDMwNCB8fCByLnN0YXR1cyA9PSAxMjIzIHx8DQoJCQkJalF1ZXJ5LmJyb3dzZXIuc2FmYXJpICYmIHIuc3RhdHVzID09IHVuZGVmaW5lZDsNCgkJfSBjYXRjaChlKXt9DQoJCXJldHVybiBmYWxzZTsNCgl9LA0KDQoJLy8gRGV0ZXJtaW5lcyBpZiBhbiBYTUxIdHRwUmVxdWVzdCByZXR1cm5zIE5vdE1vZGlmaWVkDQoJaHR0cE5vdE1vZGlmaWVkOiBmdW5jdGlvbiggeG1sLCB1cmwgKSB7DQoJCXRyeSB7DQoJCQl2YXIgeG1sUmVzID0geG1sLmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIik7DQoNCgkJCS8vIEZpcmVmb3ggYWx3YXlzIHJldHVybnMgMjAwLiBjaGVjayBMYXN0LU1vZGlmaWVkIGRhdGUNCgkJCXJldHVybiB4bWwuc3RhdHVzID09IDMwNCB8fCB4bWxSZXMgPT0galF1ZXJ5Lmxhc3RNb2RpZmllZFt1cmxdIHx8DQoJCQkJalF1ZXJ5LmJyb3dzZXIuc2FmYXJpICYmIHhtbC5zdGF0dXMgPT0gdW5kZWZpbmVkOw0KCQl9IGNhdGNoKGUpe30NCgkJcmV0dXJuIGZhbHNlOw0KCX0sDQoNCglodHRwRGF0YTogZnVuY3Rpb24oIHIsIHR5cGUgKSB7DQoJCXZhciBjdCA9IHIuZ2V0UmVzcG9uc2VIZWFkZXIoImNvbnRlbnQtdHlwZSIpOw0KCQl2YXIgeG1sID0gdHlwZSA9PSAieG1sIiB8fCAhdHlwZSAmJiBjdCAmJiBjdC5pbmRleE9mKCJ4bWwiKSA+PSAwOw0KCQl2YXIgZGF0YSA9IHhtbCA/IHIucmVzcG9uc2VYTUwgOiByLnJlc3BvbnNlVGV4dDsNCg0KCQlpZiAoIHhtbCAmJiBkYXRhLmRvY3VtZW50RWxlbWVudC50YWdOYW1lID09ICJwYXJzZXJlcnJvciIgKQ0KCQkJdGhyb3cgInBhcnNlcmVycm9yIjsNCg0KCQkvLyBJZiB0aGUgdHlwZSBpcyAic2NyaXB0IiwgZXZhbCBpdCBpbiBnbG9iYWwgY29udGV4dA0KCQlpZiAoIHR5cGUgPT0gInNjcmlwdCIgKQ0KCQkJalF1ZXJ5Lmdsb2JhbEV2YWwoIGRhdGEgKTsNCg0KCQkvLyBHZXQgdGhlIEphdmFTY3JpcHQgb2JqZWN0LCBpZiBKU09OIGlzIHVzZWQuDQoJCWlmICggdHlwZSA9PSAianNvbiIgKQ0KCQkJZGF0YSA9IGV2YWwoIigiICsgZGF0YSArICIpIik7DQoNCgkJcmV0dXJuIGRhdGE7DQoJfSwNCg0KCS8vIFNlcmlhbGl6ZSBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzIG9yIGEgc2V0IG9mDQoJLy8ga2V5L3ZhbHVlcyBpbnRvIGEgcXVlcnkgc3RyaW5nDQoJcGFyYW06IGZ1bmN0aW9uKCBhICkgew0KCQl2YXIgcyA9IFtdOw0KDQoJCS8vIElmIGFuIGFycmF5IHdhcyBwYXNzZWQgaW4sIGFzc3VtZSB0aGF0IGl0IGlzIGFuIGFycmF5DQoJCS8vIG9mIGZvcm0gZWxlbWVudHMNCgkJaWYgKCBhLmNvbnN0cnVjdG9yID09IEFycmF5IHx8IGEuanF1ZXJ5ICkNCgkJCS8vIFNlcmlhbGl6ZSB0aGUgZm9ybSBlbGVtZW50cw0KCQkJalF1ZXJ5LmVhY2goIGEsIGZ1bmN0aW9uKCl7DQoJCQkJcy5wdXNoKCBlbmNvZGVVUklDb21wb25lbnQodGhpcy5uYW1lKSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCggdGhpcy52YWx1ZSApICk7DQoJCQl9KTsNCg0KCQkvLyBPdGhlcndpc2UsIGFzc3VtZSB0aGF0IGl0J3MgYW4gb2JqZWN0IG9mIGtleS92YWx1ZSBwYWlycw0KCQllbHNlDQoJCQkvLyBTZXJpYWxpemUgdGhlIGtleS92YWx1ZXMNCgkJCWZvciAoIHZhciBqIGluIGEgKQ0KCQkJCS8vIElmIHRoZSB2YWx1ZSBpcyBhbiBhcnJheSB0aGVuIHRoZSBrZXkgbmFtZXMgbmVlZCB0byBiZSByZXBlYXRlZA0KCQkJCWlmICggYVtqXSAmJiBhW2pdLmNvbnN0cnVjdG9yID09IEFycmF5ICkNCgkJCQkJalF1ZXJ5LmVhY2goIGFbal0sIGZ1bmN0aW9uKCl7DQoJCQkJCQlzLnB1c2goIGVuY29kZVVSSUNvbXBvbmVudChqKSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCggdGhpcyApICk7DQoJCQkJCX0pOw0KCQkJCWVsc2UNCgkJCQkJcy5wdXNoKCBlbmNvZGVVUklDb21wb25lbnQoaikgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQoIGFbal0gKSApOw0KDQoJCS8vIFJldHVybiB0aGUgcmVzdWx0aW5nIHNlcmlhbGl6YXRpb24NCgkJcmV0dXJuIHMuam9pbigiJiIpLnJlcGxhY2UoLyUyMC9nLCAiKyIpOw0KCX0NCg0KfSk7DQpqUXVlcnkuZm4uZXh0ZW5kKHsNCglzaG93OiBmdW5jdGlvbihzcGVlZCxjYWxsYmFjayl7DQoJCXJldHVybiBzcGVlZCA/DQoJCQl0aGlzLmFuaW1hdGUoew0KCQkJCWhlaWdodDogInNob3ciLCB3aWR0aDogInNob3ciLCBvcGFjaXR5OiAic2hvdyINCgkJCX0sIHNwZWVkLCBjYWxsYmFjaykgOg0KCQkJDQoJCQl0aGlzLmZpbHRlcigiOmhpZGRlbiIpLmVhY2goZnVuY3Rpb24oKXsNCgkJCQl0aGlzLnN0eWxlLmRpc3BsYXkgPSB0aGlzLm9sZGJsb2NrIHx8ICIiOw0KCQkJCWlmICggalF1ZXJ5LmNzcyh0aGlzLCJkaXNwbGF5IikgPT0gIm5vbmUiICkgew0KCQkJCQl2YXIgZWxlbSA9IGpRdWVyeSgiPCIgKyB0aGlzLnRhZ05hbWUgKyAiIC8+IikuYXBwZW5kVG8oImJvZHkiKTsNCgkJCQkJdGhpcy5zdHlsZS5kaXNwbGF5ID0gZWxlbS5jc3MoImRpc3BsYXkiKTsNCgkJCQkJLy8gaGFuZGxlIGFuIGVkZ2UgY29uZGl0aW9uIHdoZXJlIGNzcyBpcyAtIGRpdiB7IGRpc3BsYXk6bm9uZTsgfSBvciBzaW1pbGFyDQoJCQkJCWlmICh0aGlzLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKQ0KCQkJCQkJdGhpcy5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCgkJCQkJZWxlbS5yZW1vdmUoKTsNCgkJCQl9DQoJCQl9KS5lbmQoKTsNCgl9LA0KCQ0KCWhpZGU6IGZ1bmN0aW9uKHNwZWVkLGNhbGxiYWNrKXsNCgkJcmV0dXJuIHNwZWVkID8NCgkJCXRoaXMuYW5pbWF0ZSh7DQoJCQkJaGVpZ2h0OiAiaGlkZSIsIHdpZHRoOiAiaGlkZSIsIG9wYWNpdHk6ICJoaWRlIg0KCQkJfSwgc3BlZWQsIGNhbGxiYWNrKSA6DQoJCQkNCgkJCXRoaXMuZmlsdGVyKCI6dmlzaWJsZSIpLmVhY2goZnVuY3Rpb24oKXsNCgkJCQl0aGlzLm9sZGJsb2NrID0gdGhpcy5vbGRibG9jayB8fCBqUXVlcnkuY3NzKHRoaXMsImRpc3BsYXkiKTsNCgkJCQl0aGlzLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQl9KS5lbmQoKTsNCgl9LA0KDQoJLy8gU2F2ZSB0aGUgb2xkIHRvZ2dsZSBmdW5jdGlvbg0KCV90b2dnbGU6IGpRdWVyeS5mbi50b2dnbGUsDQoJDQoJdG9nZ2xlOiBmdW5jdGlvbiggZm4sIGZuMiApew0KCQlyZXR1cm4galF1ZXJ5LmlzRnVuY3Rpb24oZm4pICYmIGpRdWVyeS5pc0Z1bmN0aW9uKGZuMikgPw0KCQkJdGhpcy5fdG9nZ2xlKCBmbiwgZm4yICkgOg0KCQkJZm4gPw0KCQkJCXRoaXMuYW5pbWF0ZSh7DQoJCQkJCWhlaWdodDogInRvZ2dsZSIsIHdpZHRoOiAidG9nZ2xlIiwgb3BhY2l0eTogInRvZ2dsZSINCgkJCQl9LCBmbiwgZm4yKSA6DQoJCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJCWpRdWVyeSh0aGlzKVsgalF1ZXJ5KHRoaXMpLmlzKCI6aGlkZGVuIikgPyAic2hvdyIgOiAiaGlkZSIgXSgpOw0KCQkJCX0pOw0KCX0sDQoJDQoJc2xpZGVEb3duOiBmdW5jdGlvbihzcGVlZCxjYWxsYmFjayl7DQoJCXJldHVybiB0aGlzLmFuaW1hdGUoe2hlaWdodDogInNob3cifSwgc3BlZWQsIGNhbGxiYWNrKTsNCgl9LA0KCQ0KCXNsaWRlVXA6IGZ1bmN0aW9uKHNwZWVkLGNhbGxiYWNrKXsNCgkJcmV0dXJuIHRoaXMuYW5pbWF0ZSh7aGVpZ2h0OiAiaGlkZSJ9LCBzcGVlZCwgY2FsbGJhY2spOw0KCX0sDQoNCglzbGlkZVRvZ2dsZTogZnVuY3Rpb24oc3BlZWQsIGNhbGxiYWNrKXsNCgkJcmV0dXJuIHRoaXMuYW5pbWF0ZSh7aGVpZ2h0OiAidG9nZ2xlIn0sIHNwZWVkLCBjYWxsYmFjayk7DQoJfSwNCgkNCglmYWRlSW46IGZ1bmN0aW9uKHNwZWVkLCBjYWxsYmFjayl7DQoJCXJldHVybiB0aGlzLmFuaW1hdGUoe29wYWNpdHk6ICJzaG93In0sIHNwZWVkLCBjYWxsYmFjayk7DQoJfSwNCgkNCglmYWRlT3V0OiBmdW5jdGlvbihzcGVlZCwgY2FsbGJhY2spew0KCQlyZXR1cm4gdGhpcy5hbmltYXRlKHtvcGFjaXR5OiAiaGlkZSJ9LCBzcGVlZCwgY2FsbGJhY2spOw0KCX0sDQoJDQoJZmFkZVRvOiBmdW5jdGlvbihzcGVlZCx0byxjYWxsYmFjayl7DQoJCXJldHVybiB0aGlzLmFuaW1hdGUoe29wYWNpdHk6IHRvfSwgc3BlZWQsIGNhbGxiYWNrKTsNCgl9LA0KCQ0KCWFuaW1hdGU6IGZ1bmN0aW9uKCBwcm9wLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsNCgkJdmFyIG9wdGFsbCA9IGpRdWVyeS5zcGVlZChzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayk7DQoNCgkJcmV0dXJuIHRoaXNbIG9wdGFsbC5xdWV1ZSA9PT0gZmFsc2UgPyAiZWFjaCIgOiAicXVldWUiIF0oZnVuY3Rpb24oKXsNCgkJCWlmICggdGhpcy5ub2RlVHlwZSAhPSAxKQ0KCQkJCXJldHVybiBmYWxzZTsNCg0KCQkJdmFyIG9wdCA9IGpRdWVyeS5leHRlbmQoe30sIG9wdGFsbCk7DQoJCQl2YXIgaGlkZGVuID0galF1ZXJ5KHRoaXMpLmlzKCI6aGlkZGVuIiksIHNlbGYgPSB0aGlzOw0KCQkJDQoJCQlmb3IgKCB2YXIgcCBpbiBwcm9wICkgew0KCQkJCWlmICggcHJvcFtwXSA9PSAiaGlkZSIgJiYgaGlkZGVuIHx8IHByb3BbcF0gPT0gInNob3ciICYmICFoaWRkZW4gKQ0KCQkJCQlyZXR1cm4galF1ZXJ5LmlzRnVuY3Rpb24ob3B0LmNvbXBsZXRlKSAmJiBvcHQuY29tcGxldGUuYXBwbHkodGhpcyk7DQoNCgkJCQlpZiAoIHAgPT0gImhlaWdodCIgfHwgcCA9PSAid2lkdGgiICkgew0KCQkJCQkvLyBTdG9yZSBkaXNwbGF5IHByb3BlcnR5DQoJCQkJCW9wdC5kaXNwbGF5ID0galF1ZXJ5LmNzcyh0aGlzLCAiZGlzcGxheSIpOw0KDQoJCQkJCS8vIE1ha2Ugc3VyZSB0aGF0IG5vdGhpbmcgc25lYWtzIG91dA0KCQkJCQlvcHQub3ZlcmZsb3cgPSB0aGlzLnN0eWxlLm92ZXJmbG93Ow0KCQkJCX0NCgkJCX0NCg0KCQkJaWYgKCBvcHQub3ZlcmZsb3cgIT0gbnVsbCApDQoJCQkJdGhpcy5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOw0KDQoJCQlvcHQuY3VyQW5pbSA9IGpRdWVyeS5leHRlbmQoe30sIHByb3ApOw0KCQkJDQoJCQlqUXVlcnkuZWFjaCggcHJvcCwgZnVuY3Rpb24obmFtZSwgdmFsKXsNCgkJCQl2YXIgZSA9IG5ldyBqUXVlcnkuZngoIHNlbGYsIG9wdCwgbmFtZSApOw0KDQoJCQkJaWYgKCAvdG9nZ2xlfHNob3d8aGlkZS8udGVzdCh2YWwpICkNCgkJCQkJZVsgdmFsID09ICJ0b2dnbGUiID8gaGlkZGVuID8gInNob3ciIDogImhpZGUiIDogdmFsIF0oIHByb3AgKTsNCgkJCQllbHNlIHsNCgkJCQkJdmFyIHBhcnRzID0gdmFsLnRvU3RyaW5nKCkubWF0Y2goL14oWystXT0pPyhbXGQrLS5dKykoLiopJC8pLA0KCQkJCQkJc3RhcnQgPSBlLmN1cih0cnVlKSB8fCAwOw0KDQoJCQkJCWlmICggcGFydHMgKSB7DQoJCQkJCQl2YXIgZW5kID0gcGFyc2VGbG9hdChwYXJ0c1syXSksDQoJCQkJCQkJdW5pdCA9IHBhcnRzWzNdIHx8ICJweCI7DQoNCgkJCQkJCS8vIFdlIG5lZWQgdG8gY29tcHV0ZSBzdGFydGluZyB2YWx1ZQ0KCQkJCQkJaWYgKCB1bml0ICE9ICJweCIgKSB7DQoJCQkJCQkJc2VsZi5zdHlsZVsgbmFtZSBdID0gKGVuZCB8fCAxKSArIHVuaXQ7DQoJCQkJCQkJc3RhcnQgPSAoKGVuZCB8fCAxKSAvIGUuY3VyKHRydWUpKSAqIHN0YXJ0Ow0KCQkJCQkJCXNlbGYuc3R5bGVbIG5hbWUgXSA9IHN0YXJ0ICsgdW5pdDsNCgkJCQkJCX0NCg0KCQkJCQkJLy8gSWYgYSArPS8tPSB0b2tlbiB3YXMgcHJvdmlkZWQsIHdlJ3JlIGRvaW5nIGEgcmVsYXRpdmUgYW5pbWF0aW9uDQoJCQkJCQlpZiAoIHBhcnRzWzFdICkNCgkJCQkJCQllbmQgPSAoKHBhcnRzWzFdID09ICItPSIgPyAtMSA6IDEpICogZW5kKSArIHN0YXJ0Ow0KDQoJCQkJCQllLmN1c3RvbSggc3RhcnQsIGVuZCwgdW5pdCApOw0KCQkJCQl9IGVsc2UNCgkJCQkJCWUuY3VzdG9tKCBzdGFydCwgdmFsLCAiIiApOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQkvLyBGb3IgSlMgc3RyaWN0IGNvbXBsaWFuY2UNCgkJCXJldHVybiB0cnVlOw0KCQl9KTsNCgl9LA0KCQ0KCXF1ZXVlOiBmdW5jdGlvbih0eXBlLCBmbil7DQoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24odHlwZSkgfHwgKCB0eXBlICYmIHR5cGUuY29uc3RydWN0b3IgPT0gQXJyYXkgKSkgew0KCQkJZm4gPSB0eXBlOw0KCQkJdHlwZSA9ICJmeCI7DQoJCX0NCg0KCQlpZiAoICF0eXBlIHx8ICh0eXBlb2YgdHlwZSA9PSAic3RyaW5nIiAmJiAhZm4pICkNCgkJCXJldHVybiBxdWV1ZSggdGhpc1swXSwgdHlwZSApOw0KDQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsNCgkJCWlmICggZm4uY29uc3RydWN0b3IgPT0gQXJyYXkgKQ0KCQkJCXF1ZXVlKHRoaXMsIHR5cGUsIGZuKTsNCgkJCWVsc2Ugew0KCQkJCXF1ZXVlKHRoaXMsIHR5cGUpLnB1c2goIGZuICk7DQoJCQkNCgkJCQlpZiAoIHF1ZXVlKHRoaXMsIHR5cGUpLmxlbmd0aCA9PSAxICkNCgkJCQkJZm4uYXBwbHkodGhpcyk7DQoJCQl9DQoJCX0pOw0KCX0sDQoNCglzdG9wOiBmdW5jdGlvbihjbGVhclF1ZXVlLCBnb3RvRW5kKXsNCgkJdmFyIHRpbWVycyA9IGpRdWVyeS50aW1lcnM7DQoNCgkJaWYgKGNsZWFyUXVldWUpDQoJCQl0aGlzLnF1ZXVlKFtdKTsNCg0KCQl0aGlzLmVhY2goZnVuY3Rpb24oKXsNCgkJCS8vIGdvIGluIHJldmVyc2Ugb3JkZXIgc28gYW55dGhpbmcgYWRkZWQgdG8gdGhlIHF1ZXVlIGR1cmluZyB0aGUgbG9vcCBpcyBpZ25vcmVkDQoJCQlmb3IgKCB2YXIgaSA9IHRpbWVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSApDQoJCQkJaWYgKCB0aW1lcnNbaV0uZWxlbSA9PSB0aGlzICkgew0KCQkJCQlpZiAoZ290b0VuZCkNCgkJCQkJCS8vIGZvcmNlIHRoZSBuZXh0IHN0ZXAgdG8gYmUgdGhlIGxhc3QNCgkJCQkJCXRpbWVyc1tpXSh0cnVlKTsNCgkJCQkJdGltZXJzLnNwbGljZShpLCAxKTsNCgkJCQl9DQoJCX0pOw0KDQoJCS8vIHN0YXJ0IHRoZSBuZXh0IGluIHRoZSBxdWV1ZSBpZiB0aGUgbGFzdCBzdGVwIHdhc24ndCBmb3JjZWQNCgkJaWYgKCFnb3RvRW5kKQ0KCQkJdGhpcy5kZXF1ZXVlKCk7DQoNCgkJcmV0dXJuIHRoaXM7DQoJfQ0KDQp9KTsNCg0KdmFyIHF1ZXVlID0gZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGFycmF5ICkgew0KCWlmICggIWVsZW0gKQ0KCQlyZXR1cm4gdW5kZWZpbmVkOw0KDQoJdHlwZSA9IHR5cGUgfHwgImZ4IjsNCg0KCXZhciBxID0galF1ZXJ5LmRhdGEoIGVsZW0sIHR5cGUgKyAicXVldWUiICk7DQoNCglpZiAoICFxIHx8IGFycmF5ICkNCgkJcSA9IGpRdWVyeS5kYXRhKCBlbGVtLCB0eXBlICsgInF1ZXVlIiwgDQoJCQlhcnJheSA/IGpRdWVyeS5tYWtlQXJyYXkoYXJyYXkpIDogW10gKTsNCg0KCXJldHVybiBxOw0KfTsNCg0KalF1ZXJ5LmZuLmRlcXVldWUgPSBmdW5jdGlvbih0eXBlKXsNCgl0eXBlID0gdHlwZSB8fCAiZngiOw0KDQoJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpew0KCQl2YXIgcSA9IHF1ZXVlKHRoaXMsIHR5cGUpOw0KDQoJCXEuc2hpZnQoKTsNCg0KCQlpZiAoIHEubGVuZ3RoICkNCgkJCXFbMF0uYXBwbHkoIHRoaXMgKTsNCgl9KTsNCn07DQoNCmpRdWVyeS5leHRlbmQoew0KCQ0KCXNwZWVkOiBmdW5jdGlvbihzcGVlZCwgZWFzaW5nLCBmbikgew0KCQl2YXIgb3B0ID0gc3BlZWQgJiYgc3BlZWQuY29uc3RydWN0b3IgPT0gT2JqZWN0ID8gc3BlZWQgOiB7DQoJCQljb21wbGV0ZTogZm4gfHwgIWZuICYmIGVhc2luZyB8fCANCgkJCQlqUXVlcnkuaXNGdW5jdGlvbiggc3BlZWQgKSAmJiBzcGVlZCwNCgkJCWR1cmF0aW9uOiBzcGVlZCwNCgkJCWVhc2luZzogZm4gJiYgZWFzaW5nIHx8IGVhc2luZyAmJiBlYXNpbmcuY29uc3RydWN0b3IgIT0gRnVuY3Rpb24gJiYgZWFzaW5nDQoJCX07DQoNCgkJb3B0LmR1cmF0aW9uID0gKG9wdC5kdXJhdGlvbiAmJiBvcHQuZHVyYXRpb24uY29uc3RydWN0b3IgPT0gTnVtYmVyID8gDQoJCQlvcHQuZHVyYXRpb24gOiANCgkJCXsgc2xvdzogNjAwLCBmYXN0OiAyMDAgfVtvcHQuZHVyYXRpb25dKSB8fCA0MDA7DQoJDQoJCS8vIFF1ZXVlaW5nDQoJCW9wdC5vbGQgPSBvcHQuY29tcGxldGU7DQoJCW9wdC5jb21wbGV0ZSA9IGZ1bmN0aW9uKCl7DQoJCQlpZiAoIG9wdC5xdWV1ZSAhPT0gZmFsc2UgKQ0KCQkJCWpRdWVyeSh0aGlzKS5kZXF1ZXVlKCk7DQoJCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHQub2xkICkgKQ0KCQkJCW9wdC5vbGQuYXBwbHkoIHRoaXMgKTsNCgkJfTsNCgkNCgkJcmV0dXJuIG9wdDsNCgl9LA0KCQ0KCWVhc2luZzogew0KCQlsaW5lYXI6IGZ1bmN0aW9uKCBwLCBuLCBmaXJzdE51bSwgZGlmZiApIHsNCgkJCXJldHVybiBmaXJzdE51bSArIGRpZmYgKiBwOw0KCQl9LA0KCQlzd2luZzogZnVuY3Rpb24oIHAsIG4sIGZpcnN0TnVtLCBkaWZmICkgew0KCQkJcmV0dXJuICgoLU1hdGguY29zKHAqTWF0aC5QSSkvMikgKyAwLjUpICogZGlmZiArIGZpcnN0TnVtOw0KCQl9DQoJfSwNCgkNCgl0aW1lcnM6IFtdLA0KCXRpbWVySWQ6IG51bGwsDQoNCglmeDogZnVuY3Rpb24oIGVsZW0sIG9wdGlvbnMsIHByb3AgKXsNCgkJdGhpcy5vcHRpb25zID0gb3B0aW9uczsNCgkJdGhpcy5lbGVtID0gZWxlbTsNCgkJdGhpcy5wcm9wID0gcHJvcDsNCg0KCQlpZiAoICFvcHRpb25zLm9yaWcgKQ0KCQkJb3B0aW9ucy5vcmlnID0ge307DQoJfQ0KDQp9KTsNCg0KalF1ZXJ5LmZ4LnByb3RvdHlwZSA9IHsNCg0KCS8vIFNpbXBsZSBmdW5jdGlvbiBmb3Igc2V0dGluZyBhIHN0eWxlIHZhbHVlDQoJdXBkYXRlOiBmdW5jdGlvbigpew0KCQlpZiAoIHRoaXMub3B0aW9ucy5zdGVwICkNCgkJCXRoaXMub3B0aW9ucy5zdGVwLmFwcGx5KCB0aGlzLmVsZW0sIFsgdGhpcy5ub3csIHRoaXMgXSApOw0KDQoJCShqUXVlcnkuZnguc3RlcFt0aGlzLnByb3BdIHx8IGpRdWVyeS5meC5zdGVwLl9kZWZhdWx0KSggdGhpcyApOw0KDQoJCS8vIFNldCBkaXNwbGF5IHByb3BlcnR5IHRvIGJsb2NrIGZvciBoZWlnaHQvd2lkdGggYW5pbWF0aW9ucw0KCQlpZiAoIHRoaXMucHJvcCA9PSAiaGVpZ2h0IiB8fCB0aGlzLnByb3AgPT0gIndpZHRoIiApDQoJCQl0aGlzLmVsZW0uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJfSwNCg0KCS8vIEdldCB0aGUgY3VycmVudCBzaXplDQoJY3VyOiBmdW5jdGlvbihmb3JjZSl7DQoJCWlmICggdGhpcy5lbGVtW3RoaXMucHJvcF0gIT0gbnVsbCAmJiB0aGlzLmVsZW0uc3R5bGVbdGhpcy5wcm9wXSA9PSBudWxsICkNCgkJCXJldHVybiB0aGlzLmVsZW1bIHRoaXMucHJvcCBdOw0KDQoJCXZhciByID0gcGFyc2VGbG9hdChqUXVlcnkuY3NzKHRoaXMuZWxlbSwgdGhpcy5wcm9wLCBmb3JjZSkpOw0KCQlyZXR1cm4gciAmJiByID4gLTEwMDAwID8gciA6IHBhcnNlRmxvYXQoalF1ZXJ5LmN1ckNTUyh0aGlzLmVsZW0sIHRoaXMucHJvcCkpIHx8IDA7DQoJfSwNCg0KCS8vIFN0YXJ0IGFuIGFuaW1hdGlvbiBmcm9tIG9uZSBudW1iZXIgdG8gYW5vdGhlcg0KCWN1c3RvbTogZnVuY3Rpb24oZnJvbSwgdG8sIHVuaXQpew0KCQl0aGlzLnN0YXJ0VGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7DQoJCXRoaXMuc3RhcnQgPSBmcm9tOw0KCQl0aGlzLmVuZCA9IHRvOw0KCQl0aGlzLnVuaXQgPSB1bml0IHx8IHRoaXMudW5pdCB8fCAicHgiOw0KCQl0aGlzLm5vdyA9IHRoaXMuc3RhcnQ7DQoJCXRoaXMucG9zID0gdGhpcy5zdGF0ZSA9IDA7DQoJCXRoaXMudXBkYXRlKCk7DQoNCgkJdmFyIHNlbGYgPSB0aGlzOw0KCQlmdW5jdGlvbiB0KGdvdG9FbmQpew0KCQkJcmV0dXJuIHNlbGYuc3RlcChnb3RvRW5kKTsNCgkJfQ0KDQoJCXQuZWxlbSA9IHRoaXMuZWxlbTsNCg0KCQlqUXVlcnkudGltZXJzLnB1c2godCk7DQoNCgkJaWYgKCBqUXVlcnkudGltZXJJZCA9PSBudWxsICkgew0KCQkJalF1ZXJ5LnRpbWVySWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpew0KCQkJCXZhciB0aW1lcnMgPSBqUXVlcnkudGltZXJzOw0KCQkJCQ0KCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IHRpbWVycy5sZW5ndGg7IGkrKyApDQoJCQkJCWlmICggIXRpbWVyc1tpXSgpICkNCgkJCQkJCXRpbWVycy5zcGxpY2UoaS0tLCAxKTsNCg0KCQkJCWlmICggIXRpbWVycy5sZW5ndGggKSB7DQoJCQkJCWNsZWFySW50ZXJ2YWwoIGpRdWVyeS50aW1lcklkICk7DQoJCQkJCWpRdWVyeS50aW1lcklkID0gbnVsbDsNCgkJCQl9DQoJCQl9LCAxMyk7DQoJCX0NCgl9LA0KDQoJLy8gU2ltcGxlICdzaG93JyBmdW5jdGlvbg0KCXNob3c6IGZ1bmN0aW9uKCl7DQoJCS8vIFJlbWVtYmVyIHdoZXJlIHdlIHN0YXJ0ZWQsIHNvIHRoYXQgd2UgY2FuIGdvIGJhY2sgdG8gaXQgbGF0ZXINCgkJdGhpcy5vcHRpb25zLm9yaWdbdGhpcy5wcm9wXSA9IGpRdWVyeS5hdHRyKCB0aGlzLmVsZW0uc3R5bGUsIHRoaXMucHJvcCApOw0KCQl0aGlzLm9wdGlvbnMuc2hvdyA9IHRydWU7DQoNCgkJLy8gQmVnaW4gdGhlIGFuaW1hdGlvbg0KCQl0aGlzLmN1c3RvbSgwLCB0aGlzLmN1cigpKTsNCg0KCQkvLyBNYWtlIHN1cmUgdGhhdCB3ZSBzdGFydCBhdCBhIHNtYWxsIHdpZHRoL2hlaWdodCB0byBhdm9pZCBhbnkNCgkJLy8gZmxhc2ggb2YgY29udGVudA0KCQlpZiAoIHRoaXMucHJvcCA9PSAid2lkdGgiIHx8IHRoaXMucHJvcCA9PSAiaGVpZ2h0IiApDQoJCQl0aGlzLmVsZW0uc3R5bGVbdGhpcy5wcm9wXSA9ICIxcHgiOw0KCQkNCgkJLy8gU3RhcnQgYnkgc2hvd2luZyB0aGUgZWxlbWVudA0KCQlqUXVlcnkodGhpcy5lbGVtKS5zaG93KCk7DQoJfSwNCg0KCS8vIFNpbXBsZSAnaGlkZScgZnVuY3Rpb24NCgloaWRlOiBmdW5jdGlvbigpew0KCQkvLyBSZW1lbWJlciB3aGVyZSB3ZSBzdGFydGVkLCBzbyB0aGF0IHdlIGNhbiBnbyBiYWNrIHRvIGl0IGxhdGVyDQoJCXRoaXMub3B0aW9ucy5vcmlnW3RoaXMucHJvcF0gPSBqUXVlcnkuYXR0ciggdGhpcy5lbGVtLnN0eWxlLCB0aGlzLnByb3AgKTsNCgkJdGhpcy5vcHRpb25zLmhpZGUgPSB0cnVlOw0KDQoJCS8vIEJlZ2luIHRoZSBhbmltYXRpb24NCgkJdGhpcy5jdXN0b20odGhpcy5jdXIoKSwgMCk7DQoJfSwNCg0KCS8vIEVhY2ggc3RlcCBvZiBhbiBhbmltYXRpb24NCglzdGVwOiBmdW5jdGlvbihnb3RvRW5kKXsNCgkJdmFyIHQgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOw0KDQoJCWlmICggZ290b0VuZCB8fCB0ID4gdGhpcy5vcHRpb25zLmR1cmF0aW9uICsgdGhpcy5zdGFydFRpbWUgKSB7DQoJCQl0aGlzLm5vdyA9IHRoaXMuZW5kOw0KCQkJdGhpcy5wb3MgPSB0aGlzLnN0YXRlID0gMTsNCgkJCXRoaXMudXBkYXRlKCk7DQoNCgkJCXRoaXMub3B0aW9ucy5jdXJBbmltWyB0aGlzLnByb3AgXSA9IHRydWU7DQoNCgkJCXZhciBkb25lID0gdHJ1ZTsNCgkJCWZvciAoIHZhciBpIGluIHRoaXMub3B0aW9ucy5jdXJBbmltICkNCgkJCQlpZiAoIHRoaXMub3B0aW9ucy5jdXJBbmltW2ldICE9PSB0cnVlICkNCgkJCQkJZG9uZSA9IGZhbHNlOw0KDQoJCQlpZiAoIGRvbmUgKSB7DQoJCQkJaWYgKCB0aGlzLm9wdGlvbnMuZGlzcGxheSAhPSBudWxsICkgew0KCQkJCQkvLyBSZXNldCB0aGUgb3ZlcmZsb3cNCgkJCQkJdGhpcy5lbGVtLnN0eWxlLm92ZXJmbG93ID0gdGhpcy5vcHRpb25zLm92ZXJmbG93Ow0KCQkJCQ0KCQkJCQkvLyBSZXNldCB0aGUgZGlzcGxheQ0KCQkJCQl0aGlzLmVsZW0uc3R5bGUuZGlzcGxheSA9IHRoaXMub3B0aW9ucy5kaXNwbGF5Ow0KCQkJCQlpZiAoIGpRdWVyeS5jc3ModGhpcy5lbGVtLCAiZGlzcGxheSIpID09ICJub25lIiApDQoJCQkJCQl0aGlzLmVsZW0uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJCQkJfQ0KDQoJCQkJLy8gSGlkZSB0aGUgZWxlbWVudCBpZiB0aGUgImhpZGUiIG9wZXJhdGlvbiB3YXMgZG9uZQ0KCQkJCWlmICggdGhpcy5vcHRpb25zLmhpZGUgKQ0KCQkJCQl0aGlzLmVsZW0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCg0KCQkJCS8vIFJlc2V0IHRoZSBwcm9wZXJ0aWVzLCBpZiB0aGUgaXRlbSBoYXMgYmVlbiBoaWRkZW4gb3Igc2hvd24NCgkJCQlpZiAoIHRoaXMub3B0aW9ucy5oaWRlIHx8IHRoaXMub3B0aW9ucy5zaG93ICkNCgkJCQkJZm9yICggdmFyIHAgaW4gdGhpcy5vcHRpb25zLmN1ckFuaW0gKQ0KCQkJCQkJalF1ZXJ5LmF0dHIodGhpcy5lbGVtLnN0eWxlLCBwLCB0aGlzLm9wdGlvbnMub3JpZ1twXSk7DQoJCQl9DQoNCgkJCS8vIElmIGEgY2FsbGJhY2sgd2FzIHByb3ZpZGVkLCBleGVjdXRlIGl0DQoJCQlpZiAoIGRvbmUgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIHRoaXMub3B0aW9ucy5jb21wbGV0ZSApICkNCgkJCQkvLyBFeGVjdXRlIHRoZSBjb21wbGV0ZSBmdW5jdGlvbg0KCQkJCXRoaXMub3B0aW9ucy5jb21wbGV0ZS5hcHBseSggdGhpcy5lbGVtICk7DQoNCgkJCXJldHVybiBmYWxzZTsNCgkJfSBlbHNlIHsNCgkJCXZhciBuID0gdCAtIHRoaXMuc3RhcnRUaW1lOw0KCQkJdGhpcy5zdGF0ZSA9IG4gLyB0aGlzLm9wdGlvbnMuZHVyYXRpb247DQoNCgkJCS8vIFBlcmZvcm0gdGhlIGVhc2luZyBmdW5jdGlvbiwgZGVmYXVsdHMgdG8gc3dpbmcNCgkJCXRoaXMucG9zID0galF1ZXJ5LmVhc2luZ1t0aGlzLm9wdGlvbnMuZWFzaW5nIHx8IChqUXVlcnkuZWFzaW5nLnN3aW5nID8gInN3aW5nIiA6ICJsaW5lYXIiKV0odGhpcy5zdGF0ZSwgbiwgMCwgMSwgdGhpcy5vcHRpb25zLmR1cmF0aW9uKTsNCgkJCXRoaXMubm93ID0gdGhpcy5zdGFydCArICgodGhpcy5lbmQgLSB0aGlzLnN0YXJ0KSAqIHRoaXMucG9zKTsNCg0KCQkJLy8gUGVyZm9ybSB0aGUgbmV4dCBzdGVwIG9mIHRoZSBhbmltYXRpb24NCgkJCXRoaXMudXBkYXRlKCk7DQoJCX0NCg0KCQlyZXR1cm4gdHJ1ZTsNCgl9DQoNCn07DQoNCmpRdWVyeS5meC5zdGVwID0gew0KCXNjcm9sbExlZnQ6IGZ1bmN0aW9uKGZ4KXsNCgkJZnguZWxlbS5zY3JvbGxMZWZ0ID0gZngubm93Ow0KCX0sDQoNCglzY3JvbGxUb3A6IGZ1bmN0aW9uKGZ4KXsNCgkJZnguZWxlbS5zY3JvbGxUb3AgPSBmeC5ub3c7DQoJfSwNCg0KCW9wYWNpdHk6IGZ1bmN0aW9uKGZ4KXsNCgkJalF1ZXJ5LmF0dHIoZnguZWxlbS5zdHlsZSwgIm9wYWNpdHkiLCBmeC5ub3cpOw0KCX0sDQoNCglfZGVmYXVsdDogZnVuY3Rpb24oZngpew0KCQlmeC5lbGVtLnN0eWxlWyBmeC5wcm9wIF0gPSBmeC5ub3cgKyBmeC51bml0Ow0KCX0NCn07DQovLyBUaGUgT2Zmc2V0IE1ldGhvZA0KLy8gT3JpZ2luYWxseSBCeSBCcmFuZG9uIEFhcm9uLCBwYXJ0IG9mIHRoZSBEaW1lbnNpb24gUGx1Z2luDQovLyBodHRwOi8vanF1ZXJ5LmNvbS9wbHVnaW5zL3Byb2plY3QvZGltZW5zaW9ucw0KalF1ZXJ5LmZuLm9mZnNldCA9IGZ1bmN0aW9uKCkgew0KCXZhciBsZWZ0ID0gMCwgdG9wID0gMCwgZWxlbSA9IHRoaXNbMF0sIHJlc3VsdHM7DQoJDQoJaWYgKCBlbGVtICkgd2l0aCAoIGpRdWVyeS5icm93c2VyICkgew0KCQl2YXIgcGFyZW50ICAgICAgID0gZWxlbS5wYXJlbnROb2RlLCANCgkJICAgIG9mZnNldENoaWxkICA9IGVsZW0sDQoJCSAgICBvZmZzZXRQYXJlbnQgPSBlbGVtLm9mZnNldFBhcmVudCwgDQoJCSAgICBkb2MgICAgICAgICAgPSBlbGVtLm93bmVyRG9jdW1lbnQsDQoJCSAgICBzYWZhcmkyICAgICAgPSBzYWZhcmkgJiYgcGFyc2VJbnQodmVyc2lvbikgPCA1MjIgJiYgIS9hZG9iZWFpci9pLnRlc3QodXNlckFnZW50KSwNCgkJICAgIGZpeGVkICAgICAgICA9IGpRdWVyeS5jc3MoZWxlbSwgInBvc2l0aW9uIikgPT0gImZpeGVkIjsNCgkNCgkJLy8gVXNlIGdldEJvdW5kaW5nQ2xpZW50UmVjdCBpZiBhdmFpbGFibGUNCgkJaWYgKCBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCApIHsNCgkJCXZhciBib3ggPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KCQkNCgkJCS8vIEFkZCB0aGUgZG9jdW1lbnQgc2Nyb2xsIG9mZnNldHMNCgkJCWFkZChib3gubGVmdCArIE1hdGgubWF4KGRvYy5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCwgZG9jLmJvZHkuc2Nyb2xsTGVmdCksDQoJCQkJYm94LnRvcCAgKyBNYXRoLm1heChkb2MuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCwgIGRvYy5ib2R5LnNjcm9sbFRvcCkpOw0KCQkNCgkJCS8vIElFIGFkZHMgdGhlIEhUTUwgZWxlbWVudCdzIGJvcmRlciwgYnkgZGVmYXVsdCBpdCBpcyBtZWRpdW0gd2hpY2ggaXMgMnB4DQoJCQkvLyBJRSA2IGFuZCA3IHF1aXJrcyBtb2RlIHRoZSBib3JkZXIgd2lkdGggaXMgb3ZlcndyaXRhYmxlIGJ5IHRoZSBmb2xsb3dpbmcgY3NzIGh0bWwgeyBib3JkZXI6IDA7IH0NCgkJCS8vIElFIDcgc3RhbmRhcmRzIG1vZGUsIHRoZSBib3JkZXIgaXMgYWx3YXlzIDJweA0KCQkJLy8gVGhpcyBib3JkZXIvb2Zmc2V0IGlzIHR5cGljYWxseSByZXByZXNlbnRlZCBieSB0aGUgY2xpZW50TGVmdCBhbmQgY2xpZW50VG9wIHByb3BlcnRpZXMNCgkJCS8vIEhvd2V2ZXIsIGluIElFNiBhbmQgNyBxdWlya3MgbW9kZSB0aGUgY2xpZW50TGVmdCBhbmQgY2xpZW50VG9wIHByb3BlcnRpZXMgYXJlIG5vdCB1cGRhdGVkIHdoZW4gb3ZlcndyaXRpbmcgaXQgdmlhIENTUw0KCQkJLy8gVGhlcmVmb3JlIHRoaXMgbWV0aG9kIHdpbGwgYmUgb2ZmIGJ5IDJweCBpbiBJRSB3aGlsZSBpbiBxdWlya3Ntb2RlDQoJCQlhZGQoIC1kb2MuZG9jdW1lbnRFbGVtZW50LmNsaWVudExlZnQsIC1kb2MuZG9jdW1lbnRFbGVtZW50LmNsaWVudFRvcCApOw0KCQ0KCQkvLyBPdGhlcndpc2UgbG9vcCB0aHJvdWdoIHRoZSBvZmZzZXRQYXJlbnRzIGFuZCBwYXJlbnROb2Rlcw0KCQl9IGVsc2Ugew0KCQkNCgkJCS8vIEluaXRpYWwgZWxlbWVudCBvZmZzZXRzDQoJCQlhZGQoIGVsZW0ub2Zmc2V0TGVmdCwgZWxlbS5vZmZzZXRUb3AgKTsNCgkJCQ0KCQkJLy8gR2V0IHBhcmVudCBvZmZzZXRzDQoJCQl3aGlsZSAoIG9mZnNldFBhcmVudCApIHsNCgkJCQkvLyBBZGQgb2Zmc2V0UGFyZW50IG9mZnNldHMNCgkJCQlhZGQoIG9mZnNldFBhcmVudC5vZmZzZXRMZWZ0LCBvZmZzZXRQYXJlbnQub2Zmc2V0VG9wICk7DQoJCQkNCgkJCQkvLyBNb3ppbGxhIGFuZCBTYWZhcmkgPiAyIGRvZXMgbm90IGluY2x1ZGUgdGhlIGJvcmRlciBvbiBvZmZzZXQgcGFyZW50cw0KCQkJCS8vIEhvd2V2ZXIgTW96aWxsYSBhZGRzIHRoZSBib3JkZXIgZm9yIHRhYmxlIG9yIHRhYmxlIGNlbGxzDQoJCQkJaWYgKCBtb3ppbGxhICYmICEvXnQoYWJsZXxkfGgpJC9pLnRlc3Qob2Zmc2V0UGFyZW50LnRhZ05hbWUpIHx8IHNhZmFyaSAmJiAhc2FmYXJpMiApDQoJCQkJCWJvcmRlciggb2Zmc2V0UGFyZW50ICk7DQoJCQkJCQ0KCQkJCS8vIEFkZCB0aGUgZG9jdW1lbnQgc2Nyb2xsIG9mZnNldHMgaWYgcG9zaXRpb24gaXMgZml4ZWQgb24gYW55IG9mZnNldFBhcmVudA0KCQkJCWlmICggIWZpeGVkICYmIGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50LCAicG9zaXRpb24iKSA9PSAiZml4ZWQiICkNCgkJCQkJZml4ZWQgPSB0cnVlOw0KCQkJDQoJCQkJLy8gU2V0IG9mZnNldENoaWxkIHRvIHByZXZpb3VzIG9mZnNldFBhcmVudCB1bmxlc3MgaXQgaXMgdGhlIGJvZHkgZWxlbWVudA0KCQkJCW9mZnNldENoaWxkICA9IC9eYm9keSQvaS50ZXN0KG9mZnNldFBhcmVudC50YWdOYW1lKSA/IG9mZnNldENoaWxkIDogb2Zmc2V0UGFyZW50Ow0KCQkJCS8vIEdldCBuZXh0IG9mZnNldFBhcmVudA0KCQkJCW9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5vZmZzZXRQYXJlbnQ7DQoJCQl9DQoJCQ0KCQkJLy8gR2V0IHBhcmVudCBzY3JvbGwgb2Zmc2V0cw0KCQkJd2hpbGUgKCBwYXJlbnQgJiYgcGFyZW50LnRhZ05hbWUgJiYgIS9eYm9keXxodG1sJC9pLnRlc3QocGFyZW50LnRhZ05hbWUpICkgew0KCQkJCS8vIFJlbW92ZSBwYXJlbnQgc2Nyb2xsIFVOTEVTUyB0aGF0IHBhcmVudCBpcyBpbmxpbmUgb3IgYSB0YWJsZSB0byB3b3JrIGFyb3VuZCBPcGVyYSBpbmxpbmUvdGFibGUgc2Nyb2xsTGVmdC9Ub3AgYnVnDQoJCQkJaWYgKCAhL15pbmxpbmV8dGFibGUuKiQvaS50ZXN0KGpRdWVyeS5jc3MocGFyZW50LCAiZGlzcGxheSIpKSApDQoJCQkJCS8vIFN1YnRyYWN0IHBhcmVudCBzY3JvbGwgb2Zmc2V0cw0KCQkJCQlhZGQoIC1wYXJlbnQuc2Nyb2xsTGVmdCwgLXBhcmVudC5zY3JvbGxUb3AgKTsNCgkJCQ0KCQkJCS8vIE1vemlsbGEgZG9lcyBub3QgYWRkIHRoZSBib3JkZXIgZm9yIGEgcGFyZW50IHRoYXQgaGFzIG92ZXJmbG93ICE9IHZpc2libGUNCgkJCQlpZiAoIG1vemlsbGEgJiYgalF1ZXJ5LmNzcyhwYXJlbnQsICJvdmVyZmxvdyIpICE9ICJ2aXNpYmxlIiApDQoJCQkJCWJvcmRlciggcGFyZW50ICk7DQoJCQkNCgkJCQkvLyBHZXQgbmV4dCBwYXJlbnQNCgkJCQlwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTsNCgkJCX0NCgkJDQoJCQkvLyBTYWZhcmkgPD0gMiBkb3VibGVzIGJvZHkgb2Zmc2V0cyB3aXRoIGEgZml4ZWQgcG9zaXRpb24gZWxlbWVudC9vZmZzZXRQYXJlbnQgb3IgYWJzb2x1dGVseSBwb3NpdGlvbmVkIG9mZnNldENoaWxkDQoJCQkvLyBNb3ppbGxhIGRvdWJsZXMgYm9keSBvZmZzZXRzIHdpdGggYSBub24tYWJzb2x1dGVseSBwb3NpdGlvbmVkIG9mZnNldENoaWxkDQoJCQlpZiAoIChzYWZhcmkyICYmIChmaXhlZCB8fCBqUXVlcnkuY3NzKG9mZnNldENoaWxkLCAicG9zaXRpb24iKSA9PSAiYWJzb2x1dGUiKSkgfHwgDQoJCQkJKG1vemlsbGEgJiYgalF1ZXJ5LmNzcyhvZmZzZXRDaGlsZCwgInBvc2l0aW9uIikgIT0gImFic29sdXRlIikgKQ0KCQkJCQlhZGQoIC1kb2MuYm9keS5vZmZzZXRMZWZ0LCAtZG9jLmJvZHkub2Zmc2V0VG9wICk7DQoJCQkNCgkJCS8vIEFkZCB0aGUgZG9jdW1lbnQgc2Nyb2xsIG9mZnNldHMgaWYgcG9zaXRpb24gaXMgZml4ZWQNCgkJCWlmICggZml4ZWQgKQ0KCQkJCWFkZChNYXRoLm1heChkb2MuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQsIGRvYy5ib2R5LnNjcm9sbExlZnQpLA0KCQkJCQlNYXRoLm1heChkb2MuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCwgIGRvYy5ib2R5LnNjcm9sbFRvcCkpOw0KCQl9DQoNCgkJLy8gUmV0dXJuIGFuIG9iamVjdCB3aXRoIHRvcCBhbmQgbGVmdCBwcm9wZXJ0aWVzDQoJCXJlc3VsdHMgPSB7IHRvcDogdG9wLCBsZWZ0OiBsZWZ0IH07DQoJfQ0KDQoJZnVuY3Rpb24gYm9yZGVyKGVsZW0pIHsNCgkJYWRkKCBqUXVlcnkuY3VyQ1NTKGVsZW0sICJib3JkZXJMZWZ0V2lkdGgiLCB0cnVlKSwgalF1ZXJ5LmN1ckNTUyhlbGVtLCAiYm9yZGVyVG9wV2lkdGgiLCB0cnVlKSApOw0KCX0NCg0KCWZ1bmN0aW9uIGFkZChsLCB0KSB7DQoJCWxlZnQgKz0gcGFyc2VJbnQobCkgfHwgMDsNCgkJdG9wICs9IHBhcnNlSW50KHQpIHx8IDA7DQoJfQ0KDQoJcmV0dXJuIHJlc3VsdHM7DQp9Ow0KfSkoKTsNCg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>