<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="104">
  <HTTPTask id="106" hostname="aa-pt6245.dev.accela.com:5443" path="/portlets/spa/js/automation/dashboard/task/controllers/task-dashboard-controller.js" url="https://aa-pt6245.dev.accela.com:5443/portlets/spa/js/automation/dashboard/task/controllers/task-dashboard-controller.js" ip="13.93.163.237" port="5443" client_ip="10.1.61.63" client_port="11580" connectionId="1716" origin="Primary" startDateTime="2017-08-28T11:38:05.968-07:00" startTime="5088" endTime="5098" sendTime="9" waitTime="1" receiveTime="1">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Referer" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zcGEvZGFzaGJvYXJkLmRv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SlNFU1NJT05JRD12WmtsdWRxZ2o4WmpHTTJvb2pPTkVrT0o7IEpTRVNTSU9OSUQ9KioqKioqKioqKioqKioqKioqKioqKioqKioqOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ1NDgzNTQwOyBob3N0U2lnbk9uPXRydWU7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM7IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBMQVRFU1RfU0VTU0lPTl9JRD12WmtsdWRxZ2o4WmpHTTJvb2pPTkVrT0o7IEFDQXV0aD03NzM2MjAxNDkzMTM2NjIyNTcyODg2NTM3NDA1MDg5NjkxODQ2NjMzNjY3Mjk5NTA0OTExNDkxODQyNTA1OTgyNjUyODk1OTAxNjQyMTUyNjM4NjkxNzE2NDgzNTExNzc1MzY1MTQ2NjI3NDczOTk4MzMzMTI2NDU1ODMzODM2MDsgQUNTaWduT25Nb2R1bGU9U1NPU3RhbmRhcmQ7IEFBUGVyc2lzdExvZ2luU2VydlByb3ZDb2RlPUZMQUdTVEFGRjsgTG9naW5TZXJ2UHJvdkNvZGU0TXVsdGlBZ2VuY3k9RkxBR1NUQUZGOyBMb2dpblVzZXJuYW1lNE11bHRpQWdlbmN5PTE3OUREMTNBMTg2MDI4RjQ7IEFDU2lnbm9mZj0iaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zZWN1cml0eS9zaWdub3V0LmRvIjsgQUNTd2l0Y2hBZ2VuY3k9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9wb3J0bGV0cy9zcGEvanMvYXV0b21hdGlvbi9kYXNoYm9hcmQvdGFzay9jb250cm9sbGVycy90YXNrLWRhc2hib2FyZC1jb250cm9sbGVyLmpzIEhUVFAvMS4xDQpSZWZlcmVyOiBodHRwczovL2FhLXB0NjI0NS5kZXYuYWNjZWxhLmNvbTo1NDQzL3BvcnRsZXRzL3NwYS9kYXNoYm9hcmQuZG8NClVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdPVzY0OyBUcmlkZW50LzcuMDsgcnY6MTEuMCkgbGlrZSBHZWNrbw0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlDQpBY2NlcHQtTGFuZ3VhZ2U6IGVuLVVTDQpBY2NlcHQ6ICovKg0KQ29ubmVjdGlvbjogS2VlcC1BbGl2ZQ0KSG9zdDogYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMNCkNvb2tpZTogSlNFU1NJT05JRD12WmtsdWRxZ2o4WmpHTTJvb2pPTkVrT0o7IEpTRVNTSU9OSUQ9KioqKioqKioqKioqKioqKioqKioqKioqKioqOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ1NDgzNTQwOyBob3N0U2lnbk9uPXRydWU7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM7IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBMQVRFU1RfU0VTU0lPTl9JRD12WmtsdWRxZ2o4WmpHTTJvb2pPTkVrT0o7IEFDQXV0aD03NzM2MjAxNDkzMTM2NjIyNTcyODg2NTM3NDA1MDg5NjkxODQ2NjMzNjY3Mjk5NTA0OTExNDkxODQyNTA1OTgyNjUyODk1OTAxNjQyMTUyNjM4NjkxNzE2NDgzNTExNzc1MzY1MTQ2NjI3NDczOTk4MzMzMTI2NDU1ODMzODM2MDsgQUNTaWduT25Nb2R1bGU9U1NPU3RhbmRhcmQ7IEFBUGVyc2lzdExvZ2luU2VydlByb3ZDb2RlPUZMQUdTVEFGRjsgTG9naW5TZXJ2UHJvdkNvZGU0TXVsdGlBZ2VuY3k9RkxBR1NUQUZGOyBMb2dpblVzZXJuYW1lNE11bHRpQWdlbmN5PTE3OUREMTNBMTg2MDI4RjQ7IEFDU2lnbm9mZj0iaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zZWN1cml0eS9zaWdub3V0LmRvIjsgQUNTd2l0Y2hBZ2VuY3k9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="JSESSIONID" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dlprbHVkcWdqOFpqR00yb29qT05Fa09K</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="JSESSIONID" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>KioqKioqKioqKioqKioqKioqKioqKioqKioq</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LASTEST_REQUEST_TIME" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTUwMzk0NTQ4MzU0MA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="hostSignOn" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="g_current_language_ext" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW5fVVM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_WEB_SERVER" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTAuMS4wLjY=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_SESSION_ID" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dlprbHVkcWdqOFpqR00yb29qT05Fa09K</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACAuth" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NzczNjIwMTQ5MzEzNjYyMjU3Mjg4NjUzNzQwNTA4OTY5MTg0NjYzMzY2NzI5OTUwNDkxMTQ5MTg0MjUwNTk4MjY1Mjg5NTkwMTY0MjE1MjYzODY5MTcxNjQ4MzUxMTc3NTM2NTE0NjYyNzQ3Mzk5ODMzMzEyNjQ1NTgzMzgzNjA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignOnModule" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U1NPU3RhbmRhcmQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="AAPersistLoginServProvCode" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginServProvCode4MultiAgency" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginUsername4MultiAgency" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTc5REQxM0ExODYwMjhGNA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignoff" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvc2VjdXJpdHkvc2lnbm91dC5kbyI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSwitchAgency" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLUNveW90ZS8xLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-XSS-Protection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NTQ4MzU1NjsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFURVNUX1dFQl9TRVJWRVI9MTAuMS4wLjY7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFURVNUX1NFU1NJT05fSUQ9dlprbHVkcWdqOFpqR00yb29qT05Fa09KOyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJl</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Vy8iMzY4NjQtMTQ5ODc0NzE1MDAwMCI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAyOSBKdW4gMjAxNyAxNDozOToxMCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Transfer-Encoding" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y2h1bmtlZA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyOCBBdWcgMjAxNyAxODozODowMiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IEFwYWNoZS1Db3lvdGUvMS4xDQpYLVhTUy1Qcm90ZWN0aW9uOiAwDQpTZXQtQ29va2llOiBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ1NDgzNTU2OyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJlDQpTZXQtQ29va2llOiBMQVRFU1RfV0VCX1NFUlZFUj0xMC4xLjAuNjsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ0KU2V0LUNvb2tpZTogTEFURVNUX1NFU1NJT05fSUQ9dlprbHVkcWdqOFpqR00yb29qT05Fa09KOyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJlDQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KRVRhZzogVy8iMzY4NjQtMTQ5ODc0NzE1MDAwMCINCkxhc3QtTW9kaWZpZWQ6IFRodSwgMjkgSnVuIDIwMTcgMTQ6Mzk6MTAgR01UDQpDb250ZW50LVR5cGU6IHRleHQvamF2YXNjcmlwdA0KVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWQNCkNvbnRlbnQtRW5jb2Rpbmc6IGd6aXANClZhcnk6IEFjY2VwdC1FbmNvZGluZw0KRGF0ZTogTW9uLCAyOCBBdWcgMjAxNyAxODozODowMiBHTVQNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>KGZ1bmN0aW9uICgpIHsNCiAgJ3VzZSBzdHJpY3QnOw0KDQogIGFuZ3VsYXINCiAgICAubW9kdWxlKCdhY2NlbGEuYXV0b21hdGlvbi5kYXNoYm9hcmQnKQ0KICAgIC5jb250cm9sbGVyKCdUYXNrRGFzaGJvYXJkQ29udHJvbGxlcicsIGNvbnRyb2xsZXIpOw0KDQogIC8qKg0KICAgKiBAbmdJbmplY3QNCiAgICovDQogIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJHJvb3RTY29wZSwgJHNjb3BlLCAkZG9jdW1lbnQsICRmaWx0ZXIsICRsb2csICRwb3NpdGlvbiwgJHN0YXRlLCAkdGltZW91dCwgJHdpbmRvdywgQWdlbmN5U2VydmljZSwgTW9kYWxEaWFsb2csIE92ZXJsYXlTZXJ2aWNlLCBTcGFjZUNvbmZpZ3VyYXRpb24sIFNlcnZlclNlc3Npb25TZXJ2aWNlLCBUYXNrTWFuYWdlciwgVXNlck1hbmFnZXIsIENPTkZJRywgQUdFTkNZX1RBQl9DT05GSUcpIHsNCg0KICAgIC8vIFBSSVZBVEUgZGF0YQ0KDQogICAgdmFyIGkxOG4gPSAkcm9vdFNjb3BlLmkxOG47DQogICAgdmFyIGFjdGl2aXRpZXNQYW5lbEVuYWJsZWQgPSBmYWxzZTsgLy8gZm9yIE1WUCBzcHJpbnQNCiAgICB2YXIgc2V0U2xpZGVyQmFyVmlzaWJpbGl0eSA9IGFuZ3VsYXIubm9vcDsgLy8gd2lsbCBiZSByZXBsYWNlIGJ5IGJvdW5kIHZlcnNpb24gaW4gbmdSZXBlYXRGaW5pc2hlZCBoYW5kbGVyDQoNCiAgICB2YXIgZGVmYXVsdFRhc2tPcHRpb25zID0gew0KICAgICAgc3RhcnQ6IDEsDQogICAgICByb3dzUGVyUGFnZTogNiwNCiAgICAgIGxvYWRpbmc6IGZhbHNlLA0KICAgICAgbW9yZUF2YWlsYWJsZTogZmFsc2UNCiAgICB9Ow0KDQogICAgLy8gUFVCTElDIGRhdGENCg0KICAgICRzY29wZS5jdXJyZW50UGFnZSA9IDE7DQogICAgJHNjb3BlLmNhcHRpb24gPSBpMThuLlRhc2suTG9hZGluZ1Rhc2tzOw0KICAgICRzY29wZS5sb2FkZWQgPSBmYWxzZTsNCiAgICAkc2NvcGUucmVhZHkgPSBmYWxzZTsNCiAgICAkc2NvcGUudGFza3MgPSBbXTsNCiAgICAkc2NvcGUudXNlclNwYWNlcyA9IFtdOw0KICAgICRzY29wZS5hbGxUYXNrcyA9IHtpc0NoZWNrZWQ6IGZhbHNlfTsNCiAgICAkc2NvcGUuYnVsa0FjdGlvbnMgPSBbXTsNCiAgICAkc2NvcGUuc2hvd1NsaWRlckJhciA9IGZhbHNlOw0KICAgICRzY29wZS5hY3Rpdml0aWVzUGFuZWxFeHBhbmRlZCA9IGFjdGl2aXRpZXNQYW5lbEVuYWJsZWQ7IC8vIGlmIHRydWUsIHN0YXJ0IGluIGV4cGFuZGVkIHN0YXRlDQogICAgJHNjb3BlLmFjdGl2aXRpZXNQYW5lbENvbGxhcHNlQ2xpY2tlZCA9IGZhbHNlOw0KICAgICRzY29wZS5xdWlja1F1ZXJpZXMgPSBbXTsNCg0KICAgICRzY29wZS5BZ2VuY3kgPSB7DQogICAgICBsaXN0OiBbXSwNCiAgICAgIGN1cnJlbnRBZ2VuY3k6IG51bGwsDQogICAgICBzZWxlY3RlZDogZnVuY3Rpb24odGFiKSB7DQogICAgICAgIGlmICh0YWIubmFtZSAhPT0gJHNjb3BlLkFnZW5jeS5jdXJyZW50QWdlbmN5Lm5hbWUpIHsNCiAgICAgICAgICB2YXIgYWdlbmN5ID0gXy5maW5kKCRzY29wZS5BZ2VuY3kubGlzdCwgeyAnbmFtZSc6IHRhYi5uYW1lIH0pOw0KDQogICAgICAgICAgJHNjb3BlLkFnZW5jeS5jdXJyZW50QWdlbmN5ID0gYWdlbmN5Ow0KDQogICAgICAgICAgaWYgKCRzdGF0ZS5pbmNsdWRlcygnc3BhY2VzLnRhc2stZGFzaGJvYXJkJykpIHsNCiAgICAgICAgICAgIEFnZW5jeVNlcnZpY2Uuc3dpdGNoQWdlbmN5KGFnZW5jeS5uYW1lKS50aGVuKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICBVc2VyTWFuYWdlci5zZXRDdXJyZW50QWdlbmN5KGFnZW5jeS5uYW1lKTsNCg0KICAgICAgICAgICAgICAvLyBDQUdBTU1BLTEwNDENCiAgICAgICAgICAgICAgVGFza01hbmFnZXIuZ2V0UXVpY2tRdWVyaWVzKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgew0KICAgICAgICAgICAgICAgICRzY29wZS5xdWlja1F1ZXJpZXMgPSByZXNwb25zZS5kYXRhLnJlc3VsdDsNCiAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgaWYgKGFnZW5jeS50YXNrcy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAkc2NvcGUudGFza3MgPSBhbmd1bGFyLmNvcHkoYWdlbmN5LnRhc2tzKTsNCiAgICAgICAgICAgICAgICAkc2NvcGUudGFza09wdGlvbnMgPSBhbmd1bGFyLmNvcHkoYWdlbmN5LnRhc2tPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBzZXRUYXNrQ2FwdGlvbigpOw0KICAgICAgICAgICAgICAgIHJlc2l6ZUNvbnRlbnQoKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBnZXRUYXNrcygpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9Ow0KDQogICAgJHNjb3BlLnRhc2tPcHRpb25zID0gYW5ndWxhci5jb3B5KGRlZmF1bHRUYXNrT3B0aW9ucyk7DQoNCiAgICAkc2NvcGUudGFza0ZpbHRlck9wdGlvbnMgPSB7IC8vIE5PVCBVU0VEIEZPUiBNVlAgU1BSSU5UDQogICAgICBpc0NvbGxhcHNlZDogdHJ1ZSwNCiAgICAgIHRyaWdnZXI6ICcuZGFzaGJvYXJkIC5idG4tZmlsdGVyJywNCiAgICAgIHNlbGVjdGVkQ291bnQ6IDAsDQogICAgICB0YWJzOiBbDQogICAgICAgIHtpZDogJ3NhdmVkJywgbGFiZWw6IGkxOG4uVGFzay5GaWx0ZXJUYWJTYXZlZCwgaXNBY3RpdmU6IGZhbHNlLCBjaGVja2VkSXRlbXM6IDB9LA0KICAgICAgICB7aWQ6ICd0eXBlJywgbGFiZWw6IGkxOG4uVGFzay5GaWx0ZXJUYWJUeXBlLCBpc0FjdGl2ZTogdHJ1ZSwgY2hlY2tlZEl0ZW1zOiAwfSwNCiAgICAgICAge2lkOiAnc3RhdHVzJywgbGFiZWw6IGkxOG4uVGFzay5GaWx0ZXJUYWJTdGF0dXMsIGlzQWN0aXZlOiBmYWxzZSwgY2hlY2tlZEl0ZW1zOiAwfSwNCiAgICAgICAge2lkOiAnZGF0ZS1yYW5nZScsIGxhYmVsOiBpMThuLlRhc2suRmlsdGVyVGFiRGF0ZVJhbmdlLCBpc0FjdGl2ZTogZmFsc2UsIGNoZWNrZWRJdGVtczogMH0sDQogICAgICAgIHtpZDogJ2Fzc2lnbmVkJywgbGFiZWw6IGkxOG4uVGFzay5GaWx0ZXJUYWJBc3NpZ25lZFRvLCBpc0FjdGl2ZTogZmFsc2UsIGNoZWNrZWRJdGVtczogMH0NCiAgICAgIF0sDQogICAgICB0YXNrVHlwZXM6IFtdLCAvLyBwb3B1bGF0ZWQgYnkgR0VUX1RBU0tfRklMVEVSX1NUQVRVU19MSVNUDQogICAgICBzdGF0dXNMaXN0OiBbIC8vIHVwZGF0ZWQgd2hlbiBzZWxlY3RpbmcgYSB0YXNrVHlwZSBvciBzdWJ0eXBlIGhhdmluZyBhIHN0YXR1c0xpc3QNCiAgICAgICAge2lkOiAnQ09NUExFVEVEJywgbGFiZWw6IGkxOG4uVGFzay5GaWx0ZXJTdGF0dXNDb21wbGV0ZWR9DQogICAgICBdLA0KICAgICAgZGF0ZVJhbmdlOiB7DQogICAgICAgIGFzc2lnbmVkOiB7bGFiZWw6IGkxOG4uVGFzay5GaWx0ZXJEYXRlUmFuZ2VBc3NpZ25lZCwgZnJvbTogJycsIHRvOiAnJ30sDQogICAgICAgIG9wZW46IHtsYWJlbDogaTE4bi5UYXNrLkZpbHRlckRhdGVSYW5nZU9wZW4sIGZyb206ICcnLCB0bzogJyd9LA0KICAgICAgICBkdWU6IHtsYWJlbDogaTE4bi5UYXNrLkZpbHRlckRhdGVSYW5nZUR1ZSwgZnJvbTogJycsIHRvOiAnJ30sDQogICAgICAgIHN0YXR1czoge2xhYmVsOiBpMThuLlRhc2suRmlsdGVyRGF0ZVJhbmdlU3RhdHVzLCBmcm9tOiAnJywgdG86ICcnfQ0KICAgICAgfSwNCiAgICAgIHNhdmVkOiBbDQogICAgICAgIHsNCiAgICAgICAgICB0YXNrVHlwZXM6IFtdLA0KICAgICAgICAgIHN1YlR5cGVzOiBbXSwNCiAgICAgICAgICBzdGF0dXNMaXN0OiBbXSwNCiAgICAgICAgICBkYXRlUmFuZ2U6IHsNCiAgICAgICAgICAgIGFzc2lnbmVkOiB7ZnJvbTogJycsIHRvOiAnJ30sDQogICAgICAgICAgICBvcGVuOiB7ZnJvbTogJycsIHRvOiAnJ30sDQogICAgICAgICAgICBkdWU6IHtmcm9tOiAnJywgdG86ICcnfSwNCiAgICAgICAgICAgIHN0YXR1czoge2Zyb206ICcnLCB0bzogJyd9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICBdDQogICAgfTsNCg0KICAgICRzY29wZS50YXNrU29ydE9wdGlvbnMgPSB7IC8vIE5PVCBVU0VEIEZPUiBNVlAgU1BSSU5UDQogICAgICBpc0NvbGxhcHNlZDogdHJ1ZSwNCiAgICAgIHRyaWdnZXI6ICcuZGFzaGJvYXJkIC5idG4tc29ydCcNCiAgICB9Ow0KDQogICAgLy8gRVZFTlQgaGFuZGxlcnMNCg0KICAgIC8vIHJlbW92ZSBmb3IgTVZQIHNwcmludA0KLy8gICAgJHNjb3BlLiR3YXRjaCgnYWN0aXZpdGllc1BhbmVsRXhwYW5kZWQnLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHsNCi8vICAgICAgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSAmJiAkc3RhdGUuaXMoJ3Rhc2stZGFzaGJvYXJkLmNhcmRzJykpIHsNCi8vICAgICAgICAkdGltZW91dChzZXRUYXNrQ2FyZHNXaWR0aCwgQWNjZWxhLmFuaW1hdGlvbkRlbGF5KTsNCi8vICAgICAgfQ0KLy8gICAgfSk7DQoNCiAgICAkc2NvcGUuJG9uKCd0YXNrcy5yZWZyZXNoJywgZnVuY3Rpb24oKSB7DQogICAgICAvLyAndGFza3MucmVmcmVzaCcgd2lsbCBiZSBzZW50IHdoZW4gc3dpdGNoaW5nIGZyb20gYSBwb3J0bGV0IHRvIHRoZSB0YXNrIGRhc2hib2FyZA0KICAgICAgLy8gYnV0IGlmIGN1cnJlbnRBZ2VuY3kgd2FzIG5ldmVyIGluaXRpYWxpemVkLCBpZ25vcmUgdGhlIHJlZnJlc2ggYW5kIGFsbG93IGluaXRpYWxpemUoKSB0byBiZSBjYWxsZWQuDQogICAgICBpZiAoJHNjb3BlLkFnZW5jeS5jdXJyZW50QWdlbmN5KSB7DQogICAgICAgIHJlZnJlc2hUYXNrcygpOw0KICAgICAgfQ0KICAgIH0pOw0KDQogICAgJHNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uIChldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcykgew0KICAgICAgdmFyIGFnZW5jeU5hbWUgPSAkc2NvcGUuQWdlbmN5LmN1cnJlbnRBZ2VuY3kgPyAkc2NvcGUuQWdlbmN5LmN1cnJlbnRBZ2VuY3kubmFtZSA6IEFHRU5DWV9UQUJfQ09ORklHLmN1cnJlbnRBZ2VuY3k7DQoNCiAgICAgIGlmICh0b1N0YXRlLm5hbWUgPT09ICdzcGFjZXMudGFzay1kYXNoYm9hcmQuY2FyZHMnIHx8IHRvU3RhdGUubmFtZSA9PT0gJ3NwYWNlcy50YXNrLWRhc2hib2FyZC5saXN0Jykgew0KICAgICAgICBpZiAoIShmcm9tU3RhdGUubmFtZSA9PT0gJ3NwYWNlcy50YXNrLWRhc2hib2FyZC5jYXJkcycgfHwgZnJvbVN0YXRlLm5hbWUgPT09ICdzcGFjZXMudGFzay1kYXNoYm9hcmQubGlzdCcpKSB7IC8vIG5vIG5lZWQgdG8gY2FsbCBpZiBzd2l0Y2ggZnJvbSBjYXJkIHRvIGxpc3Qgdmlldw0KICAgICAgICAgIGlmIChTcGFjZUNvbmZpZ3VyYXRpb24uc2Vzc2lvblN0YXRlU2VydmljZSA9PT0gJ1NlcnZlclNlc3Npb25TZXJ2aWNlJykgew0KICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdwb3J0bGV0LXNlc3Npb24tc3RhdGUtdXBkYXRlOnN0YXJ0ZWQnKTsNCiAgICAgICAgICAgIFNlcnZlclNlc3Npb25TZXJ2aWNlLmFjdGl2YXRlKENPTkZJRy5UQVNLX1NFU1NJT05fTkFNRSkudGhlbihmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncG9ydGxldC1zZXNzaW9uLXN0YXRlLXVwZGF0ZTpjb21wbGV0ZWQnKTsNCiAgICAgICAgICAgICAgLy8gQmVjYXVzZSBUYXNrRGFzaGJvYXJkQ29udHJvbGxlciBpcyBub3QgZGVzdHJveWVkIHdoZW4gb3BlbmluZyBhIHBvcnRsZXQsDQogICAgICAgICAgICAgIC8vIGFsbCBvZiB0aGUgcHJldmlvdXNseSBsb2FkZWQgdGFza3MgYW5kIGFnZW5jeSBpbmZvIHdpbGwgc3RpbGwgYmUgcHJlc2VudC4NCiAgICAgICAgICAgICAgQWdlbmN5U2VydmljZS5zd2l0Y2hBZ2VuY3koYWdlbmN5TmFtZSkudGhlbihmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgaWYgKCRzY29wZS5BZ2VuY3kuY3VycmVudEFnZW5jeSA9PT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgaW5pdGlhbGl6ZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIERldGVybWluZSB3aGV0aGVyIHdlIG5lZWQgdG8gc2hvdyB0aGUgY29sdW1uIHNsaWRlci4NCiAgICAgKiBDYWxsZWQgYWZ0ZXIgcmVuZGVyaW5nIHRoZSB0YXNrIGxpc3QuDQogICAgICovDQogICAgJHNjb3BlLiRvbignbmdSZXBlYXRGaW5pc2hlZCcsIGZ1bmN0aW9uIChuZ1JlcGVhdEZpbmlzaGVkRXZlbnQsIHRhcmdldE9iaikgew0KDQogICAgICBmdW5jdGlvbiBfc2V0U2xpZGVyQmFyVmlzaWJpbGl0eSh0YXJnZXRPYmopIHsNCiAgICAgICAgJHNjb3BlLnNob3dTbGlkZXJCYXIgPSAodGFyZ2V0T2JqICYmIHRhcmdldE9iai5zY3JvbGxXaWR0aCAtIHRhcmdldE9iai5vZmZzZXRXaWR0aCA+IDApOw0KICAgICAgfQ0KDQogICAgICBpZiAodGFyZ2V0T2JqKSB7DQogICAgICAgIHNldFNsaWRlckJhclZpc2liaWxpdHkgPSBfc2V0U2xpZGVyQmFyVmlzaWJpbGl0eS5iaW5kKG51bGwsIHRhcmdldE9iaik7DQoNCiAgICAgICAgJHNjb3BlLndpbmRvd1Jlc2l6ZUhhbmRsZXJzLnJlZ2lzdGVyKHNldFNsaWRlckJhclZpc2liaWxpdHkpOw0KDQogICAgICAgICR0aW1lb3V0KHNldFNsaWRlckJhclZpc2liaWxpdHksIEFjY2VsYS5hbmltYXRpb25EZWxheSk7DQogICAgICB9DQogICAgfSk7DQoNCiAgICAvLyBQVUJMSUMgbWV0aG9kcw0KDQogICAgJHNjb3BlLmFsbFRhc2tzQ2hlY2tlZCA9IGZ1bmN0aW9uIChtb2RlbCkgew0KICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7DQogICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUudGFza3MsIGZ1bmN0aW9uICh0YXNrKSB7DQogICAgICAgICAgdGFzay5pc0NoZWNrZWQgPSBtb2RlbC5pc0NoZWNrZWQ7DQogICAgICAgIH0pOw0KDQogICAgICAgIHVwZGF0ZUJ1bGtBY3Rpb25zKCk7DQogICAgICB9KTsNCiAgICB9Ow0KDQogICAgJHNjb3BlLmFwcGx5VGFza0ZpbHRlciA9IGZ1bmN0aW9uIChvcHRpb25zKSB7DQogICAgICAkbG9nLndhcm4oJ2FwcGx5VGFza0ZpbHRlcicgKyBKU09OLnN0cmluZ2lmeShvcHRpb25zKSk7DQogICAgfTsNCg0KICAgIGZ1bmN0aW9uIGNvbnRlbnRMb2FkZWQoKSB7DQogICAgICBPdmVybGF5U2VydmljZS5oaWRlKCk7DQoNCiAgICAgIGlmIChhY3Rpdml0aWVzUGFuZWxFbmFibGVkKSB7DQogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkgeyAvLyBmb3JjZSBkaWdlc3QgbG9vcA0KICAgICAgICAgIGlmICgkc3RhdGUuaXMoJ3NwYWNlcy50YXNrLWRhc2hib2FyZC5jYXJkcycpKSB7DQogICAgICAgICAgICAkc2NvcGUuc2hvd1NsaWRlckJhciA9IGZhbHNlOw0KICAgICAgICAgICAgaWYgKCRzY29wZS5hY3Rpdml0aWVzUGFuZWxDb2xsYXBzZUNsaWNrZWQpIHsgLy8gbGVhdmUgaXQgY29sbGFwc2VkDQogICAgICAgICAgICAgIHNldFRhc2tDYXJkc1dpZHRoKCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZpdGllc1BhbmVsRXhwYW5kZWQgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkc2NvcGUuYWN0aXZpdGllc1BhbmVsRXhwYW5kZWQgPSBmYWxzZTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsgLy8gYWRkZWQgZm9yIE1WUCBzcHJpbnQNCiAgICAgICAgJHNjb3BlLnNob3dTbGlkZXJCYXIgPSAkc3RhdGUuaXMoJ3Rhc2stZGFzaGJvYXJkLmxpc3QnKTsNCg0KICAgICAgICBpZiAoJHN0YXRlLmlzKCdzcGFjZXMudGFzay1kYXNoYm9hcmQuY2FyZHMnKSkgew0KICAgICAgICAgIHNldFRhc2tDYXJkc1dpZHRoKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgJHNjb3BlLnJlYWR5ID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCg0KICAgICRzY29wZS5kb0J1bGtUYXNrQWN0aW9uID0gZnVuY3Rpb24gKGFjdGlvbklkKSB7DQogICAgICBpZiAoYWN0aW9uSWQgPT09ICdQUklOVCcpIHsNCiAgICAgICAgdmFyIHNwZWNzID0gc3ByaW50ZigndG9wPTEwMCx3aWR0aD0lcyxoZWlnaHQ9NjAwLHNjcm9sbGJhcnM9eWVzJywgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIC0gNTApOw0KICAgICAgICB2YXIgcHJpbnRDb250ZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrcy1wcmludC12aWV3JykuaW5uZXJIVE1MOw0KICAgICAgICB2YXIgcG9wdXBXaW4gPSB3aW5kb3cub3BlbignJywgJ19ibGFuaycsIHNwZWNzKTsNCiAgICAgICAgcG9wdXBXaW4uZG9jdW1lbnQub3BlbigpOw0KICAgICAgICBwb3B1cFdpbi5kb2N1bWVudC53cml0ZSgnPGh0bWw+PGhlYWQ+PGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgaHJlZj0ic3R5bGVzL3Rhc2tzLXByaW50LXZpZXcubWluLmNzcyIgLz48L2hlYWQ+PGJvZHk+JyArIHByaW50Q29udGVudHMgKyAnPC9odG1sPicpOw0KICAgICAgICBwb3B1cFdpbi5kb2N1bWVudC5jbG9zZSgpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS50YXNrcywgZnVuY3Rpb24odGFzaykgew0KICAgICAgICAgIGlmICh0YXNrLmlzQ2hlY2tlZCkgew0KICAgICAgICAgICAgJHNjb3BlLmRvVGFza0FjdGlvbih0YXNrLCBhY3Rpb25JZCk7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgJHNjb3BlLmRvVGFza0FjdGlvbiA9IGZ1bmN0aW9uICh0YXNrLCBhY3Rpb25JZCkgew0KICAgICAgaWYgKHRhc2suaXNBY3Rpdml0eSkgew0KICAgICAgICBkb0FjdGl2aXR5VGFza0FjdGlvbih0YXNrLCBhY3Rpb25JZCk7DQogICAgICB9IGVsc2UgaWYgKHRhc2suaXNEb2N1bWVudCkgew0KICAgICAgICBkb0RvY3VtZW50VGFza0FjdGlvbih0YXNrLCBhY3Rpb25JZCk7DQogICAgICB9IGVsc2UgaWYgKHRhc2suaXNJbnNwZWN0aW9uKSB7DQogICAgICAgIGRvSW5zcGVjdGlvblRhc2tBY3Rpb24odGFzaywgYWN0aW9uSWQpOw0KICAgICAgfSBlbHNlIGlmICh0YXNrLmlzTWVldGluZykgew0KICAgICAgICBkb01lZXRpbmdUYXNrQWN0aW9uKHRhc2ssIGFjdGlvbklkKTsNCiAgICAgIH0gZWxzZSBpZiAodGFzay5pc1dvcmtmbG93KSB7DQogICAgICAgIGRvV29ya2Zsb3dUYXNrQWN0aW9uKHRhc2ssIGFjdGlvbklkKTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgJHNjb3BlLmV4ZWN1dGVRdWlja1F1ZXJ5ID0gZnVuY3Rpb24ocXVlcnkpIHsNCiAgICAgIGdldFRhc2tzKHsNCiAgICAgICAgc3RhcnQ6IDEsDQogICAgICAgIGxvYWRNb3JlOiBmYWxzZSwNCiAgICAgICAgcXVpY2tRdWVyeTogcXVlcnkudmFsdWUgPyBxdWVyeSA6IG51bGwNCiAgICAgIH0pOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBGb3JtYXQgIkR1ZSBEYXRlIiBjb2x1bW4gb24gVGFzayBMaXN0IHZpZXcgLS0gbXVzdCByZXR1cm4gdHdvIGxpbmVzLg0KICAgICAqLw0KICAgICRzY29wZS5mb3JtYXRUYXNrTGlzdER1ZURhdGUgPSBmdW5jdGlvbiAodGFzaykgew0KICAgICAgdmFyIGFyciA9IFtdOw0KDQogICAgICBpZiAodGFzay5pc0FjdGl2aXR5ICYmIHRhc2suZHVlRGF0ZSkgew0KICAgICAgICBhcnIucHVzaCgkZmlsdGVyKCdkYXRlJykodGFzay5kdWVEYXRlLCAnTU1NIGQnKSk7DQogICAgICB9IGVsc2UgaWYgKHRhc2suaXNEb2N1bWVudCkgew0KICAgICAgICAvLyBub3QgYXBwbGljYWJsZSB0byBkb2N1bWVudCByZXZpZXcgdGFza3MNCiAgICAgIH0gZWxzZSBpZiAodGFzay5pc0luc3BlY3Rpb24gJiYgdGFzay5zY2hlZHVsZURhdGUpIHsNCiAgICAgICAgYXJyLnB1c2goJGZpbHRlcignZGF0ZScpKHRhc2suc2NoZWR1bGVEYXRlLCAnaDptbSBhJykpOw0KICAgICAgICBhcnIucHVzaCgkZmlsdGVyKCdkYXRlJykodGFzay5zY2hlZHVsZURhdGUsICdNTU0gZCcpKTsNCiAgICAgIH0gZWxzZSBpZiAodGFzay5pc01lZXRpbmcgJiYgdGFzay5zY2hlZHVsZWRTdGFydERhdGUpIHsNCiAgICAgICAgYXJyLnB1c2goJGZpbHRlcignZGF0ZScpKHRhc2suc2NoZWR1bGVkU3RhcnREYXRlLCAnaDptbSBhJykpOw0KICAgICAgICBhcnIucHVzaCgkZmlsdGVyKCdkYXRlJykodGFzay5zY2hlZHVsZWRTdGFydERhdGUsICdNTU0gZCcpKTsNCiAgICAgIH0gZWxzZSBpZiAodGFzay5pc1dvcmtmbG93ICYmIHRhc2suZHVlRGF0ZSkgew0KICAgICAgICBhcnIucHVzaCgkZmlsdGVyKCdkYXRlJykodGFzay5kdWVEYXRlLCAnTU1NIGQnKSk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiBhcnIuam9pbignPGJyPiAnKTsNCiAgICB9Ow0KDQogICAgJHNjb3BlLmZvcm1hdFRhc2tMaXN0RGV0YWlscyA9IGZ1bmN0aW9uICh0YXNrKSB7DQogICAgICB2YXIgcmVzdWx0ID0gJyc7DQoNCiAgICAgIGlmICh0YXNrLmlzQWN0aXZpdHkgJiYgdGFzay5hY3Rpdml0eUlEKSB7DQogICAgICAgIHJlc3VsdCA9IHNwcmludGYoJzxkaXYgY2xhc3M9ImRldGFpbHMtY2FwdGlvbiI+JXM8L2Rpdj4gJXMnLCBpMThuLlRhc2suQWxsUGFnZXMsIHRhc2suYWN0aXZpdHlJRCk7DQogICAgICB9IGVsc2UgaWYgKHRhc2suaXNEb2N1bWVudCAmJiB0YXNrLmNhdGVnb3J5KSB7DQogICAgICAgIHJlc3VsdCA9IHNwcmludGYoJzxkaXYgY2xhc3M9ImRldGFpbHMtY2FwdGlvbiI+JXM8L2Rpdj4gJXMnLCBpMThuLlRhc2suQ2F0ZWdvcnksIHRhc2suY2F0ZWdvcnkpOw0KICAgICAgfSBlbHNlIGlmICh0YXNrLmlzSW5zcGVjdGlvbiAmJiB0YXNrLmFkZHJlc3MpIHsNCiAgICAgICAgcmVzdWx0ID0gc3ByaW50ZignPGRpdiBjbGFzcz0iZGV0YWlscy1jYXB0aW9uIj4lczwvZGl2PiAlcycsIGkxOG4uVGFzay5BZGRyZXNzLCB0YXNrLmFkZHJlc3MpOw0KICAgICAgfSBlbHNlIGlmICh0YXNrLmlzTWVldGluZyAmJiB0YXNrLmFkZHJlc3MpIHsNCiAgICAgICAgcmVzdWx0ID0gc3ByaW50ZignPGRpdiBjbGFzcz0iZGV0YWlscy1jYXB0aW9uIj4lczwvZGl2PiAlcycsIGkxOG4uVGFzay5Mb2NhdGlvbiwgdGFzay5hZGRyZXNzKTsNCiAgICAgIH0gZWxzZSBpZiAodGFzay5pc1dvcmtmbG93ICYmIHRhc2suYXNzaWduZWRTdGFmZikgew0KICAgICAgICByZXN1bHQgPSBzcHJpbnRmKCc8ZGl2IGNsYXNzPSJkZXRhaWxzLWNhcHRpb24iPiVzPC9kaXY+ICVzJywgaTE4bi5UYXNrLkFzc2lnbmVkVG8sIHRhc2suYXNzaWduZWRTdGFmZik7DQogICAgICB9DQoNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfTsNCg0KICAgICRzY29wZS5mb3JtYXRUYXNrTGlzdFN0YXR1cyA9IGZ1bmN0aW9uICh0YXNrKSB7DQogICAgICB2YXIgc3RhdHVzID0gW107DQoNCiAgICAgIGlmICh0YXNrLnN0YXR1cykgew0KICAgICAgICBzdGF0dXMucHVzaCh0YXNrLnN0YXR1cyk7IC8vICM2ZTZlNmUNCiAgICAgIH0NCg0KICAgICAgaWYgKHRhc2suaXNJbnNwZWN0aW9uIHx8IHRhc2suaXNNZWV0aW5nKSB7DQogICAgICAgIGlmICh0YXNrLmZvcm1hdHRlZER1cmF0aW9uKSB7DQogICAgICAgICAgc3RhdHVzLnB1c2goc3ByaW50ZignPHNwYW4gY2xhc3M9ImRldGFpbHMtY2FwdGlvbiI+JXM8L3NwYW4+ICVzJywgaTE4bi5UYXNrLkR1cmF0aW9uLCB0YXNrLmZvcm1hdHRlZER1cmF0aW9uKSk7IC8vIEFBVEhFVEEtOTI4DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGVsc2UgaWYgKHRhc2suaXNEb2N1bWVudCkgew0KICAgICAgICBpZiAodGFzay5zdGF0dXNEYXRlKSB7DQogICAgICAgICAgc3RhdHVzLnB1c2goJGZpbHRlcignZGF0ZScpKHRhc2suc3RhdHVzRGF0ZSwgJ01NTSBkJykpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHJldHVybiBzdGF0dXMuam9pbignPGJyPicpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBpZiBubyB0YXNrcyBjaGVja2VkLCBleHBvcnQgYWxsDQogICAgICogaWYgc29tZSB0YXNrcyBjaGVja2VkLCBleHBvcnQgY2hlY2tlZA0KICAgICAqLw0KICAgICRzY29wZS5nZXRFeHBvcnRhYmxlVGFza3MgPSBmdW5jdGlvbigpIHsNCiAgICAgIHZhciB0YXNrcyA9IFtdOw0KICAgICAgdmFyIHJlID0gLyg8KFtePl0rKT4pL2lnOw0KICAgICAgdmFyIGNoZWNrZWRUYXNrQ291bnQgPSAwOw0KDQogICAgICBmdW5jdGlvbiBFeHBvcnRhYmxlVGFzayh0YXNrKSB7DQogICAgICAgIHRoaXMudGFza25hbWUgPSB0YXNrLnRhc2tOYW1lOw0KICAgICAgICB0aGlzLnJlY29yZElkID0gdGFzay5jYXBJZC5pZDsNCiAgICAgICAgdGhpcy5hbHRlcm5hdGVJZCA9IHRhc2suY2FwSWQuY3VzdG9tSUQ7DQogICAgICAgIHRoaXMucmVjb3JkVHlwZSA9IHRhc2sucGVybWl0VHlwZTsNCiAgICAgICAgdGhpcy5kdWVEYXRlID0gJHNjb3BlLmZvcm1hdFRhc2tMaXN0RHVlRGF0ZSh0YXNrKS5yZXBsYWNlKCc8YnI+JywgJycpLnJlcGxhY2UocmUsICcnKTsNCg0KICAgICAgICBpZiAodGFzay5jb25kaXRpb25TZXZlcml0eSkgew0KICAgICAgICAgIHRoaXMuZmxhZ3MgPSBzcHJpbnRmKCclcyAoJXMpJywgdGFzay5jb25kaXRpb25TZXZlcml0eSwgdGFzay5jb25kaXRpb25Db3VudCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy5mbGFncyA9ICcnOw0KICAgICAgICB9DQoNCiAgICAgICAgdGhpcy5zdGF0dXMgPSAkc2NvcGUuZm9ybWF0VGFza0xpc3RTdGF0dXModGFzaykucmVwbGFjZSgnPGJyPicsICcgJykucmVwbGFjZShyZSwgJycpOw0KICAgICAgICB0aGlzLmFwcGxpY2F0aW9ubmFtZSA9IHRhc2suYXBwbGljYXRpb25OYW1lOw0KICAgICAgICB0aGlzLmRldGFpbHMgPSAkc2NvcGUuZm9ybWF0VGFza0xpc3REZXRhaWxzKHRhc2spLnJlcGxhY2UoJzxicj4nLCAnICcpLnJlcGxhY2UocmUsICcnKTsNCiAgICAgIH0NCg0KICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS50YXNrcywgZnVuY3Rpb24odGFzaykgew0KICAgICAgICBpZiAodGFzay5pc0NoZWNrZWQpIHsNCiAgICAgICAgICBjaGVja2VkVGFza0NvdW50Kys7DQogICAgICAgIH0NCiAgICAgIH0pOw0KDQogICAgICBhbmd1bGFyLmZvckVhY2goJHNjb3BlLnRhc2tzLCBmdW5jdGlvbih0YXNrKSB7DQogICAgICAgIGlmICh0YXNrLmlzQ2hlY2tlZCB8fCBjaGVja2VkVGFza0NvdW50ID09PSAwKSB7DQogICAgICAgICAgdGFza3MucHVzaChuZXcgRXhwb3J0YWJsZVRhc2sodGFzaykpOw0KICAgICAgICB9DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIHRhc2tzOw0KICAgIH07DQoNCiAgICAkc2NvcGUuZ2V0RXhwb3J0YWJsZVRhc2tzSGVhZGVyID0gZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gWw0KICAgICAgICBpMThuLlRhc2suVGFza05hbWUsDQogICAgICAgIGkxOG4uVGFzay5SZWNvcmRJRCwNCiAgICAgICAgaTE4bi5UYXNrLkFsdGVybmF0ZUlELA0KICAgICAgICBpMThuLlRhc2suUmVjb3JkVHlwZSwNCiAgICAgICAgaTE4bi5UYXNrLlRhc2tMaXN0RHVlRGF0ZUhlYWRlciwNCiAgICAgICAgaTE4bi5UYXNrLlRhc2tMaXN0RmxhZ3NIZWFkZXIsDQogICAgICAgIGkxOG4uVGFzay5UYXNrTGlzdFN0YXR1c0hlYWRlciwNCiAgICAgICAgaTE4bi5HbG9iYWxTZWFyY2guQXBwbGljYXRpb25OYW1lLA0KICAgICAgICBpMThuLlRhc2suVGFza0xpc3REZXRhaWxzSGVhZGVyDQogICAgICBdOw0KICAgIH07DQoNCiAgICAkc2NvcGUuZ2V0VGFza3MgPSBnZXRUYXNrczsNCg0KICAgICRzY29wZS5sb2FkTW9yZVRhc2tzID0gZnVuY3Rpb24oKSB7DQogICAgICBnZXRUYXNrcyh7DQogICAgICAgIGxvYWRNb3JlOiB0cnVlDQogICAgICB9KTsNCiAgICB9Ow0KDQogICAgJHNjb3BlLm9uZVRhc2tDaGVja2VkID0gZnVuY3Rpb24gKG1vZGVsKSB7DQogICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgJHNjb3BlLmFsbFRhc2tzLmlzQ2hlY2tlZCA9IGZhbHNlOw0KDQogICAgICAgIHVwZGF0ZUJ1bGtBY3Rpb25zKCk7DQogICAgICB9KTsNCiAgICB9Ow0KDQogICAgJHNjb3BlLm9wZW5UYXNrID0gZnVuY3Rpb24gKHRhc2spIHsNCiAgICAgIHZhciB1cmw7DQoNCiAgICAgIGlmICh0YXNrLmlzQWN0aXZpdHkpIHsNCiAgICAgICAgdXJsID0gVGFza01hbmFnZXIuZ2V0QWN0aXZpdHlVcmwodGFzayk7DQogICAgICAgICRzY29wZS5vcGVuRGVmYXVsdFNsaWRlb3V0KGkxOG4uVGFzay5DYXRlZ29yeUFDVElWSVRZLCB1cmwsIG51bGwpOyAvLyBkZWZpbmVkIGluIEF1dG9tYXRpb25Db250cm9sbGVyDQogICAgICAgIHJldHVybjsNCiAgICAgIH0gZWxzZSBpZiAodGFzay5pc0RvY3VtZW50KSB7DQogICAgICAgIGRvRG9jdW1lbnRUYXNrQWN0aW9uKHRhc2ssIFRhc2tNYW5hZ2VyLkFDVElPTi5WSUVXSU5GTyk7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0gZWxzZSBpZiAodGFzay5pc0luc3BlY3Rpb24gfHwgdGFzay5pc01lZXRpbmcgfHwgdGFzay5pc1dvcmtmbG93KSB7DQogICAgICAgIHVybCA9IFRhc2tNYW5hZ2VyLmdldE9wZW5TcGFjZVVybCh0YXNrKTsNCiAgICAgIH0NCg0KICAgICAgJHNjb3BlLiRlbWl0KCdkYXNoYm9hcmQub3BlblNwYWNlJywgeyAvLyBoYW5kbGVkIGluIGFhLXNwYWNlLWxpc3QgZGlyZWN0aXZlDQogICAgICAgIHNwYWNlSWNvblR5cGU6IHRhc2sudGFza0NhdGVnb3J5LA0KICAgICAgICBzcGFjZU5hbWU6IHRhc2suY2FwSWQuY3VzdG9tSUQgfHwgdGFzay50YXNrTmFtZSwNCiAgICAgICAgc3BhY2VVcmw6IHVybA0KICAgICAgfSk7DQogICAgfTsNCg0KICAgICRzY29wZS5nb3RvQ2FwRGV0YWlsID0gZnVuY3Rpb24gKHRhc2spIHsNCiAgICAgICRzY29wZS4kZW1pdCgnZGFzaGJvYXJkLm9wZW5TcGFjZScsIHsgLy8gaGFuZGxlZCBpbiBhYS1zcGFjZS1saXN0IGRpcmVjdGl2ZQ0KICAgICAgICBzcGFjZUljb25UeXBlOiB0YXNrLnRhc2tDYXRlZ29yeSwNCiAgICAgICAgc3BhY2VOYW1lOiB0YXNrLmNhcElkLmN1c3RvbUlEIHx8IHRhc2sudGFza05hbWUsDQogICAgICAgIHNwYWNlVXJsOiBUYXNrTWFuYWdlci5nZXRDYXBEZXRhaWxVcmwodGFzaykNCiAgICAgIH0pOw0KICAgIH07DQoNCiAgICAkc2NvcGUuZ290b0NvbnRhY3REZXRhaWwgPSBmdW5jdGlvbiAodGFzaykgew0KICAgICAgJHNjb3BlLiRlbWl0KCdkYXNoYm9hcmQub3BlblNwYWNlJywgeyAvLyBoYW5kbGVkIGluIGFhLXNwYWNlLWxpc3QgZGlyZWN0aXZlDQogICAgICAgIHNwYWNlTmFtZTogdGFzay5jYXBJZC5jdXN0b21JRCB8fCB0YXNrLnRhc2tOYW1lLA0KICAgICAgICBzcGFjZVVybDogVGFza01hbmFnZXIuZ2V0Q29udGFjdERldGFpbFVybCh0YXNrKQ0KICAgICAgfSk7DQogICAgfTsNCg0KICAgICRzY29wZS5yZWZyZXNoVGFza3MgPSByZWZyZXNoVGFza3M7DQoNCiAgICAkc2NvcGUudG9nZ2xlQWN0aXZpdGllc1BhbmVsID0gZnVuY3Rpb24oKSB7DQogICAgICBpZiAoYWN0aXZpdGllc1BhbmVsRW5hYmxlZCkgew0KICAgICAgICBpZiAoJHN0YXRlLmlzKCdzcGFjZXMudGFzay1kYXNoYm9hcmQuY2FyZHMnKSkgew0KICAgICAgICAgIGlmICgkc2NvcGUuYWN0aXZpdGllc1BhbmVsRXhwYW5kZWQpIHsNCiAgICAgICAgICAgICRzY29wZS5hY3Rpdml0aWVzUGFuZWxDb2xsYXBzZUNsaWNrZWQgPSB0cnVlOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkc2NvcGUuYWN0aXZpdGllc1BhbmVsQ29sbGFwc2VDbGlja2VkID0gZmFsc2U7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgJHNjb3BlLmFjdGl2aXRpZXNQYW5lbEV4cGFuZGVkID0gISRzY29wZS5hY3Rpdml0aWVzUGFuZWxFeHBhbmRlZDsNCg0KICAgICAgICBpZiAoJHN0YXRlLmlzKCdzcGFjZXMudGFzay1kYXNoYm9hcmQubGlzdCcpKSB7DQogICAgICAgICAgJHRpbWVvdXQoc2V0U2xpZGVyQmFyVmlzaWJpbGl0eSwgMTApOw0KICAgICAgICB9DQogICAgICB9DQogICAgfTsNCg0KICAgIC8vIFBSSVZBVEUgbWV0aG9kcw0KDQogICAgZnVuY3Rpb24gYXNzaWduV29ya2Zsb3dUYXNrKHRhc2spIHsNCiAgICAgICRzY29wZS5vcGVuRGVmYXVsdFNsaWRlb3V0KGkxOG4uVGFzay5Bc3NpZ24sIFRhc2tNYW5hZ2VyLmdldEFzc2lnbldvcmtmbG93VGFza1VybCh0YXNrKSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2FuY2VsSW5zcGVjdGlvbih0YXNrLCBhY3Rpb25JZCkgew0KICAgICAgdmFyIG5vdGlmeUVycm9yID0gbm90aWZ5VGFza0Vycm9yLmJpbmQobnVsbCwgdGFzaywgYWN0aW9uSWQpOw0KDQogICAgICBUYXNrTWFuYWdlci5jYW5jZWxJbnNwZWN0aW9uKHRhc2ssIGFjdGlvbklkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7DQogICAgICAgIGlmIChBY2NlbGEuU1RBVFVTLlNVQ0NFU1MgPT09IEFjY2VsYS5VdGlsLnRvVXBwZXJDYXNlKGRhdGEuZGF0YS5yZXN1bHQpKSB7DQogICAgICAgICAgbm90aWZ5VGFza1N1Y2Nlc3MoaTE4bi5UYXNrLkluc3BlY3Rpb25DYW5jZWxTdWNjZXNzKTsNCiAgICAgICAgICByZWZyZXNoVGFza3MoKTsNCiAgICAgICAgfQ0KICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICAgIG5vdGlmeUVycm9yKGVycm9yLmN1c3RvbUVycm9yTWVzc2FnZSk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjbGFpbVdvcmtmbG93VGFzayh0YXNrLCBhY3Rpb25JZCkgew0KICAgICAgdmFyIG5vdGlmeUVycm9yID0gbm90aWZ5VGFza0Vycm9yLmJpbmQobnVsbCwgdGFzaywgYWN0aW9uSWQpOw0KDQogICAgICBUYXNrTWFuYWdlci5jbGFpbVdvcmtmbG93VGFzayh0YXNrLCBhY3Rpb25JZCkudGhlbihmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICB2YXIgcmVzcG9uc2VNc2cgPSBkYXRhLmRhdGEubWVzc2FnZTsNCiAgICAgICAgaWYgKEFjY2VsYS5TVEFUVVMuU1VDQ0VTUyA9PT0gQWNjZWxhLlV0aWwudG9VcHBlckNhc2UocmVzcG9uc2VNc2cpKSB7DQogICAgICAgICAgcmVmcmVzaFRhc2tzKCk7DQogICAgICAgICAgbm90aWZ5VGFza1N1Y2Nlc3MoaTE4bi5UYXNrLldvcmtmbG93Q2xhaW1TdWNjZXNzKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICgnTm9SaWdodCcgPT09IHJlc3BvbnNlTXNnKSB7DQogICAgICAgICAgbm90aWZ5RXJyb3IoaTE4bi5UYXNrLldvcmtmbG93Q2xhaW1QZXJtaXNzaW9uRmFpbCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgbm90aWZ5RXJyb3IoaTE4bi5UYXNrLldvcmtmbG93Q2xhaW1GYWlsKTsNCiAgICAgICAgfQ0KICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICAgIG5vdGlmeUVycm9yKGVycm9yLmN1c3RvbUVycm9yTWVzc2FnZSk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICAvLw0KICAgIC8vIEFDVElWSVRZIHRhc2sgYWN0aW9ucw0KICAgIC8vDQogICAgZnVuY3Rpb24gZG9BY3Rpdml0eVRhc2tBY3Rpb24odGFzaywgYWN0aW9uSWQpIHsNCiAgICAgIHZhciBub3RpZnlFcnJvciA9IG5vdGlmeVRhc2tFcnJvci5iaW5kKG51bGwsIHRhc2ssIGFjdGlvbklkKTsNCg0KICAgICAgc3dpdGNoIChhY3Rpb25JZCkgew0KICAgICAgICBjYXNlIFRhc2tNYW5hZ2VyLkFDVElPTi5ERUxFVEU6DQogICAgICAgICAgVGFza01hbmFnZXIuZGVsZXRlQWN0aXZpdHkodGFzaykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsNCiAgICAgICAgICAgIGlmIChBY2NlbGEuU1RBVFVTLlNVQ0NFU1MgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZSkgew0KICAgICAgICAgICAgICByZWZyZXNoVGFza3MoKTsNCiAgICAgICAgICAgICAgbm90aWZ5VGFza1N1Y2Nlc3MoaTE4bi5UYXNrLkFjdGl2aXR5RGVsZXRlU3VjY2Vzcyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICAgICAgICBub3RpZnlFcnJvcihlcnJvci5jdXN0b21FcnJvck1lc3NhZ2UpOw0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIC8vDQogICAgLy8gRE9DVU1FTlQgdGFzayBhY3Rpb25zDQogICAgLy8NCiAgICBmdW5jdGlvbiBkb0RvY3VtZW50VGFza0FjdGlvbih0YXNrLCBhY3Rpb25JZCkgew0KICAgICAgdmFyIGFjdGlvbiA9IFRhc2tNYW5hZ2VyLmdldFRhc2tBY3Rpb25CeUlkKHRhc2ssIGFjdGlvbklkKTsNCg0KICAgICAgaWYgKGFjdGlvbiAmJiBhY3Rpb24udXJsKSB7DQogICAgICAgIHN3aXRjaCAoYWN0aW9uSWQpIHsNCiAgICAgICAgICBjYXNlIFRhc2tNYW5hZ2VyLkFDVElPTi5BU1NJR04gOg0KICAgICAgICAgICAgJHNjb3BlLm9wZW5EZWZhdWx0U2xpZGVvdXQoaTE4bi5UYXNrLkNhdGVnb3J5RE9DVU1FTlQsIGFjdGlvbi51cmwsIGFjdGlvbi5wYXJhbXMpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSBUYXNrTWFuYWdlci5BQ1RJT04uRE9XTkxPQUQgOg0KICAgICAgICAgICAgJHdpbmRvdy5vcGVuKGFjdGlvbi51cmwpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSBUYXNrTWFuYWdlci5BQ1RJT04uUFJFVklFVyA6DQogICAgICAgICAgICAkc2NvcGUub3BlbkRlZmF1bHRTbGlkZW91dChpMThuLlRhc2suUHJldmlldywgYWN0aW9uLnVybCk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlIFRhc2tNYW5hZ2VyLkFDVElPTi5SRVZJRVcgOg0KICAgICAgICAgICAgJHdpbmRvdy5vcGVuKGFjdGlvbi51cmwpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSBUYXNrTWFuYWdlci5BQ1RJT04uVklFV0lORk86DQogICAgICAgICAgICAkc2NvcGUub3BlbkRlZmF1bHRTbGlkZW91dChpMThuLlRhc2suQ2F0ZWdvcnlET0NVTUVOVCwgYWN0aW9uLnVybCwgYWN0aW9uLnBhcmFtcyk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKGFjdGlvbklkID09PSBUYXNrTWFuYWdlci5BQ1RJT04uUFJFVklFVykgeyAvLyBBQUVUQS02NDQNCiAgICAgICAgICBub3RpZnlUYXNrV2FybmluZyhpMThuLlRhc2suRG9jdW1lbnRQcmV2aWV3UGVybWlzc2lvbkZhaWwpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG5vdGlmeVRhc2tXYXJuaW5nKHNwcmludGYoaTE4bi5UYXNrLkRvY3VtZW50QWN0aW9uTm90RGVmaW5lZCwgYWN0aW9uSWQpKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIC8vDQogICAgLy8gSU5TUEVDVElPTiB0YXNrIGFjdGlvbnMNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGRvSW5zcGVjdGlvblRhc2tBY3Rpb24odGFzaywgYWN0aW9uSWQpIHsNCiAgICAgIHZhciBhY3Rpb24gPSBUYXNrTWFuYWdlci5nZXRUYXNrQWN0aW9uQnlJZCh0YXNrLCBhY3Rpb25JZCk7DQogICAgICB2YXIgbm90aWZ5RXJyb3IgPSBub3RpZnlUYXNrRXJyb3IuYmluZChudWxsLCB0YXNrLCBhY3Rpb25JZCk7DQoNCiAgICAgIGZ1bmN0aW9uIGhhbmRsZUFmdGVyRG9WYWxpZGF0aW9uKHRhc2ssIGFjdGlvbiwgcmVzcG9uc2UpIHsNCiAgICAgICAgaWYgKEFjY2VsYS5TVEFUVVMuU1VDQ0VTUyA9PT0gQWNjZWxhLlV0aWwudG9VcHBlckNhc2UocmVzcG9uc2UuZGF0YS5tc2cpKSB7DQogICAgICAgICAgJHNjb3BlLm9wZW5EZWZhdWx0U2xpZGVvdXQoaTE4bi5UYXNrLkNhdGVnb3J5SU5TUEVDVElPTiwgYWN0aW9uLnVybCwgYWN0aW9uLnBhcmFtcyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgbm90aWZ5RXJyb3IocmVzcG9uc2UuZGF0YS5tc2cpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHN3aXRjaCAoYWN0aW9uSWQpIHsNCiAgICAgICAgY2FzZSBUYXNrTWFuYWdlci5BQ1RJT04uU0NIRURVTEU6DQogICAgICAgICAgVGFza01hbmFnZXIudmFsaWRhdGVJbnNwZWN0aW9uQWN0aW9uKHRhc2ssIGFjdGlvbikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsNCiAgICAgICAgICAgIGhhbmRsZUFmdGVyRG9WYWxpZGF0aW9uKHRhc2ssIGFjdGlvbiwgcmVzcG9uc2UpOw0KICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgew0KICAgICAgICAgICAgbm90aWZ5RXJyb3IoZXJyb3IuY3VzdG9tRXJyb3JNZXNzYWdlKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBUYXNrTWFuYWdlci5BQ1RJT04uUkVTQ0hFRFVMRToNCiAgICAgICAgICBpZiAoVXNlck1hbmFnZXIuaGFzRklEKCc4NDAwJywgJ0YnLCB0YXNrLm1vZHVsZSkpIHsNCiAgICAgICAgICAgIFRhc2tNYW5hZ2VyLnZhbGlkYXRlSW5zcGVjdGlvbkFjdGlvbih0YXNrLCBhY3Rpb24pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7DQogICAgICAgICAgICAgIGhhbmRsZUFmdGVyRG9WYWxpZGF0aW9uKHRhc2ssIGFjdGlvbiwgcmVzcG9uc2UpOw0KICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICAgICAgICAgIG5vdGlmeUVycm9yKGVycm9yLmN1c3RvbUVycm9yTWVzc2FnZSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHNjb3BlLm9wZW5EZWZhdWx0U2xpZGVvdXQoaTE4bi5UYXNrLkNhdGVnb3J5SU5TUEVDVElPTiwgYWN0aW9uLnVybCwgYWN0aW9uLnBhcmFtcyk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIFRhc2tNYW5hZ2VyLkFDVElPTi5SRVNVTFQ6DQogICAgICAgICAgJHNjb3BlLm9wZW5EZWZhdWx0U2xpZGVvdXQoaTE4bi5UYXNrLkNhdGVnb3J5SU5TUEVDVElPTiwgYWN0aW9uLnVybCwgYWN0aW9uLnBhcmFtcyk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgVGFza01hbmFnZXIuQUNUSU9OLkNBTkNFTDoNCiAgICAgICAgICBpZiAoVXNlck1hbmFnZXIuaGFzRklEKCc4NDAwJywgJ0YnLCB0YXNrLm1vZHVsZSkpIHsNCiAgICAgICAgICAgIFRhc2tNYW5hZ2VyLnZhbGlkYXRlSW5zcGVjdGlvbkFjdGlvbih0YXNrLCBhY3Rpb24pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7DQogICAgICAgICAgICAgIGhhbmRsZUFmdGVyRG9WYWxpZGF0aW9uKHRhc2ssIGFjdGlvbiwgcmVzcG9uc2UpOw0KICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICAgICAgICAgIG5vdGlmeUVycm9yKGVycm9yLmN1c3RvbUVycm9yTWVzc2FnZSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgVGFza01hbmFnZXIudmFsaWRhdGVJbnNwZWN0aW9uQWN0aW9uKHRhc2ssIGFjdGlvbikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsNCiAgICAgICAgICAgICAgaWYgKEFjY2VsYS5TVEFUVVMuU1VDQ0VTUyA9PT0gQWNjZWxhLlV0aWwudG9VcHBlckNhc2UocmVzcG9uc2UuZGF0YS5tc2cpKSB7DQogICAgICAgICAgICAgICAgY2FuY2VsSW5zcGVjdGlvbih0YXNrKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLkNvbmZpcm1XaXRoSW5BZHYgIT09IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLkNvbmZpcm1XaXRoSW5BZHYgPT09ICdZJykgew0KICAgICAgICAgICAgICAgIC8vIFRPRE86IHNob3VsZCBiZSBhIG1vZGFsIGRpYWxvZw0KICAgICAgICAgICAgICAgIGlmICgkd2luZG93LmNvbmZpcm0ocmVzcG9uc2UuZGF0YS5tZXNzYWdlKSkgew0KICAgICAgICAgICAgICAgICAgY2FuY2VsSW5zcGVjdGlvbih0YXNrKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgew0KICAgICAgICAgICAgICBub3RpZnlFcnJvcihlcnJvci5jdXN0b21FcnJvck1lc3NhZ2UpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIFRhc2tNYW5hZ2VyLkFDVElPTi5ERUxFVEU6DQogICAgICAgICAgVGFza01hbmFnZXIuZGVsZXRlSW5zcGVjdGlvbih0YXNrKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgew0KICAgICAgICAgICAgdmFyIHJlc3BvbnNlTXNnID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlOw0KICAgICAgICAgICAgaWYgKEFjY2VsYS5TVEFUVVMuU1VDQ0VTUyA9PT0gQWNjZWxhLlV0aWwudG9VcHBlckNhc2UocmVzcG9uc2VNc2cpKSB7DQogICAgICAgICAgICAgIHJlZnJlc2hUYXNrcygpOw0KICAgICAgICAgICAgICBub3RpZnlUYXNrU3VjY2VzcyhpMThuLlRhc2suSW5zcGVjdGlvbkRlbGV0ZVN1Y2Nlc3MpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgbm90aWZ5RXJyb3IoaTE4bi5UYXNrLkluc3BlY3Rpb25EZWxldGVGYWlsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHsNCiAgICAgICAgICAgIG5vdGlmeUVycm9yKGVycm9yLmN1c3RvbUVycm9yTWVzc2FnZSk7DQogICAgICAgICAgfSk7DQogICAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgLy8NCiAgICAvLyBNRUVUSU5HIHRhc2sgYWN0aW9ucw0KICAgIC8vDQogICAgZnVuY3Rpb24gZG9NZWV0aW5nVGFza0FjdGlvbih0YXNrLCBhY3Rpb25JZCkgew0KICAgICAgdmFyIGFjdGlvbiA9IFRhc2tNYW5hZ2VyLmdldFRhc2tBY3Rpb25CeUlkKHRhc2ssIGFjdGlvbklkKTsNCiAgICAgIHZhciBub3RpZnlFcnJvciA9IG5vdGlmeVRhc2tFcnJvci5iaW5kKG51bGwsIHRhc2ssIGFjdGlvbklkKTsNCg0KICAgICAgc3dpdGNoIChhY3Rpb25JZCkgew0KICAgICAgICBjYXNlIFRhc2tNYW5hZ2VyLkFDVElPTi5SRUpFQ1Q6DQogICAgICAgICAgVGFza01hbmFnZXIudmFsaWRhdGVSZWplY3RNZWV0aW5nQWN0aW9uKHRhc2ssIGFjdGlvbikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsNCiAgICAgICAgICAgIGlmIChBY2NlbGEuU1RBVFVTLlNVQ0NFU1MgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZSkgew0KICAgICAgICAgICAgICBUYXNrTWFuYWdlci5yZWplY3RNZWV0aW5nKHRhc2spLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7DQogICAgICAgICAgICAgICAgaWYgKEFjY2VsYS5TVEFUVVMuU1VDQ0VTUyA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlKSB7DQogICAgICAgICAgICAgICAgICByZWZyZXNoVGFza3MoKTsNCiAgICAgICAgICAgICAgICAgIG5vdGlmeVRhc2tTdWNjZXNzKGkxOG4uVGFzay5NZWV0aW5nUmVqZWN0ZWRTdWNjZXNzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgew0KICAgICAgICAgICAgICAgIG5vdGlmeUVycm9yKGVycm9yLmN1c3RvbUVycm9yTWVzc2FnZSk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgIG5vdGlmeUVycm9yKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICAgICAgICBub3RpZnlFcnJvcihlcnJvci5jdXN0b21FcnJvck1lc3NhZ2UpOw0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIC8vDQogICAgLy8gUkVDT1JEIHRhc2sgYWN0aW9ucw0KICAgIC8vDQogICAgJHNjb3BlLmRvUmVjb3JkVGFza0FjdGlvbiA9IGZ1bmN0aW9uICh0YXNrLCBhY3Rpb25JZCkgew0KICAgICAgdmFyIG5vdGlmeUVycm9yID0gbm90aWZ5VGFza0Vycm9yLmJpbmQobnVsbCwgdGFzaywgYWN0aW9uSWQpOw0KDQogICAgICBzd2l0Y2ggKGFjdGlvbklkKSB7DQogICAgICAgIGNhc2UgVGFza01hbmFnZXIuQUNUSU9OLkFHRU5EQToNCiAgICAgICAgICBUYXNrTWFuYWdlci5zZXRUYXNrQWdlbmRhKHRhc2spLnRoZW4oZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgbm90aWZ5VGFza1N1Y2Nlc3MoaTE4bi5UYXNrLlJlY29yZEFnZW5kYVNldFN1Y2Nlc3MpOw0KICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgew0KICAgICAgICAgICAgbm90aWZ5RXJyb3IoZXJyb3IuY3VzdG9tRXJyb3JNZXNzYWdlKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBUYXNrTWFuYWdlci5BQ1RJT04uRE9XTkxPQUQ6DQogICAgICAgICAgbm90aWZ5VGFza1N1Y2Nlc3MoaTE4bi5UYXNrLlJlY29yZEFjdGlvbkRvd25sb2FkU3VjY2Vzcyk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgVGFza01hbmFnZXIuQUNUSU9OLkRVUExJQ0FURToNCiAgICAgICAgICBUYXNrTWFuYWdlci5kdXBsaWNhdGVUYXNrKHRhc2spLnRoZW4oZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgbm90aWZ5VGFza1N1Y2Nlc3MoaTE4bi5UYXNrLlJlY29yZER1cGxpY2F0ZVN1Y2Nlc3MpOw0KICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgew0KICAgICAgICAgICAgbm90aWZ5RXJyb3IoZXJyb3IuY3VzdG9tRXJyb3JNZXNzYWdlKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBUYXNrTWFuYWdlci5BQ1RJT04uUkVBU1NJR046DQogICAgICAgICAgVGFza01hbmFnZXIucmVhc3NpZ25UYXNrKHRhc2spLnRoZW4oZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgbm90aWZ5VGFza1N1Y2Nlc3MoaTE4bi5UYXNrLlJlY29yZFJlYXNzaWduU3VjY2Vzcyk7DQogICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICAgICAgICBub3RpZnlFcnJvcihlcnJvci5jdXN0b21FcnJvck1lc3NhZ2UpOw0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIFRhc2tNYW5hZ2VyLkFDVElPTi5SRU1PVkU6DQogICAgICAgICAgVGFza01hbmFnZXIucmVtb3ZlVGFzayh0YXNrKS50aGVuKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIG5vdGlmeVRhc2tTdWNjZXNzKGkxOG4uVGFzay5SZWNvcmRSZW1vdmVTdWNjZXNzKTsNCiAgICAgICAgICAgIFRhc2tNYW5hZ2VyLnJlbW92ZUJvdW5kVGFzayh0YXNrKTsNCiAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHsNCiAgICAgICAgICAgIG5vdGlmeUVycm9yKGVycm9yLmN1c3RvbUVycm9yTWVzc2FnZSk7DQogICAgICAgICAgfSk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgVGFza01hbmFnZXIuQUNUSU9OLlJFU0NIRURVTEU6DQogICAgICAgICAgVGFza01hbmFnZXIucmVzY2hlZHVsZVRhc2sodGFzaykudGhlbihmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBub3RpZnlUYXNrU3VjY2VzcyhpMThuLlRhc2suUmVjb3JkUmVzY2hlZHVsZVN1Y2Nlc3MpOw0KICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgew0KICAgICAgICAgICAgbm90aWZ5RXJyb3IoZXJyb3IuY3VzdG9tRXJyb3JNZXNzYWdlKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBUYXNrTWFuYWdlci5BQ1RJT04uUkVWSUVXOg0KICAgICAgICAgIG5vdGlmeVRhc2tTdWNjZXNzKGkxOG4uVGFzay5SZWNvcmRSZXZpZXdTdWNjZXNzKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgLy8NCiAgICAvLyBXT1JLRkxPVyB0YXNrIGFjdGlvbnMNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGRvV29ya2Zsb3dUYXNrQWN0aW9uKHRhc2ssIGFjdGlvbklkKSB7DQogICAgICBzd2l0Y2ggKGFjdGlvbklkKSB7DQogICAgICAgIGNhc2UgVGFza01hbmFnZXIuQUNUSU9OLkFTU0lHTjoNCiAgICAgICAgICBhc3NpZ25Xb3JrZmxvd1Rhc2sodGFzaywgYWN0aW9uSWQpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIFRhc2tNYW5hZ2VyLkFDVElPTi5DTEFJTToNCiAgICAgICAgICBjbGFpbVdvcmtmbG93VGFzayh0YXNrLCBhY3Rpb25JZCk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgVGFza01hbmFnZXIuQUNUSU9OLlJFTEVBU0U6DQogICAgICAgICAgcmVsZWFzZVdvcmtmbG93VGFzayh0YXNrLCBhY3Rpb25JZCk7DQogICAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZG9jdW1lbnRDbGlja0hhbmRsZXIoZXZ0KSB7DQogICAgICAvLyB0aGUgYWN0aXZlIGNsYXNzIGlzIHRvZ2dsZWQgYnkgdGhlIHRhc2stY2FyZC1jb25kaXRpb24gZGlyZWN0aXZlDQogICAgICB2YXIgYWN0aXZlUG9wb3ZlciA9ICQoJy5pY29uLXRhc2stY29uZGl0aW9uLmFjdGl2ZScpOw0KDQogICAgICBpZiAoYWN0aXZlUG9wb3Zlcikgew0KICAgICAgICBpZiAoZXZ0LnRhcmdldCAhPT0gYWN0aXZlUG9wb3ZlclswXSkgeyAvLyBsZXQgYm9vdHN0cmFwIGNsb3NlIHRoZSBvcGVuIHBvcG92ZXINCiAgICAgICAgICBhY3RpdmVQb3BvdmVyLnRyaWdnZXJIYW5kbGVyKCdjbGljaycpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0QWdlbmN5VGFza0NvdW50cygpIHsgLy8gQ0FHQU1NQS04MTQNCiAgICAgIHJldHVybiBUYXNrTWFuYWdlci5nZXRUYXNrQ291bnRzKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgew0KICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAnU1VDQ0VTUycpIHsNCiAgICAgICAgICB2YXIgaGFzVGFza3MgPSBbXTsNCiAgICAgICAgICB2YXIgaGFzTm9UYXNrcyA9IFtdOw0KDQogICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJlc3BvbnNlLmRhdGEucmVzdWx0LCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7DQogICAgICAgICAgICB2YXIgYWdlbmN5ID0gXy5maW5kKCRzY29wZS5BZ2VuY3kubGlzdCwgeyAnbmFtZSc6IGtleSB9KTsNCg0KICAgICAgICAgICAgaWYgKGFnZW5jeSkgew0KICAgICAgICAgICAgICBhZ2VuY3kudG90YWxOdW0gPSB2YWx1ZTsNCiAgICAgICAgICAgICAgYWdlbmN5LmRpc3BsYXlOYW1lID0gc3ByaW50ZignJXMgKCVzKScsIGFnZW5jeS5uYW1lLCB2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICAvLyBzb3J0IGFnZW5jaWVzIGFjY29yZGluZyB0byB0aGUgdGFzayBjb3VudHMgaW4gTUFYIHRvIE1JTiBvcmRlcg0KICAgICAgICAgIC8vIHNvcnQgYWdlbmNpZXMgaGF2aW5nIG5vIHRhc2tzIGluIGFscGhhIG9yZGVyDQoNCiAgICAgICAgICAkc2NvcGUuQWdlbmN5Lmxpc3QuZm9yRWFjaChmdW5jdGlvbihhZ2VuY3kpIHsNCiAgICAgICAgICAgIGlmIChhZ2VuY3kudG90YWxOdW0pIHsNCiAgICAgICAgICAgICAgaGFzVGFza3MucHVzaChhZ2VuY3kpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgaGFzTm9UYXNrcy5wdXNoKGFnZW5jeSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICBoYXNUYXNrcyA9IF8uc29ydEJ5KGhhc1Rhc2tzLCAndG90YWxOdW0nKS5yZXZlcnNlKCk7DQogICAgICAgICAgaGFzTm9UYXNrcyA9IF8uc29ydEJ5KGhhc05vVGFza3MsICduYW1lJyk7DQoNCiAgICAgICAgICAkc2NvcGUuQWdlbmN5Lmxpc3QgPSBoYXNUYXNrcy5jb25jYXQoaGFzTm9UYXNrcyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdkYXNoYm9hcmQuYWRkQWxlcnQnLCB7DQogICAgICAgICAgICB0eXBlOiAnZXJyb3InLA0KICAgICAgICAgICAgbXNnOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0VGFza3Mob3B0aW9ucykgew0KICAgICAgdmFyIHNhdmVkU3RhcnRQb2ludDsNCiAgICAgIHZhciBhZ2VuY3kgPSAkc2NvcGUuQWdlbmN5LmN1cnJlbnRBZ2VuY3k7DQoNCiAgICAgIC8vIHVzZSB0YXNrT3B0aW9ucyBmcm9tIGN1cnJlbnQgYWdlbmN5IGFuZCBleHRlbmQgd2l0aCBsb2FkTW9yZSBhbmQgcXVpY2tRdWVyeSBzZWxlY3Rpb25zDQogICAgICAkc2NvcGUudGFza09wdGlvbnMgPSBhbmd1bGFyLmNvcHkoYWdlbmN5LnRhc2tPcHRpb25zKTsNCiAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRzY29wZS50YXNrT3B0aW9ucywgb3B0aW9ucyB8fCB7fSk7DQoNCiAgICAgIGlmICgkc2NvcGUudGFza09wdGlvbnMucmVmcmVzaCkgew0KICAgICAgICBzYXZlZFN0YXJ0UG9pbnQgPSAkc2NvcGUudGFza09wdGlvbnMuc3RhcnQ7DQoNCiAgICAgICAgJHNjb3BlLnRhc2tPcHRpb25zLmxvYWRNb3JlID0gZmFsc2U7DQoNCiAgICAgICAgJHNjb3BlLnRhc2tPcHRpb25zLnN0YXJ0ID0gMTsNCiAgICAgICAgaWYgKCRzY29wZS50YXNrcy5sZW5ndGggPCAkc2NvcGUudGFza09wdGlvbnMucm93c1BlclBhZ2UpIHsNCiAgICAgICAgICAkc2NvcGUudGFza09wdGlvbnMuZW5kID0gJHNjb3BlLnRhc2tPcHRpb25zLnN0YXJ0ICsgJHNjb3BlLnRhc2tPcHRpb25zLnJvd3NQZXJQYWdlIC0gMTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAkc2NvcGUudGFza09wdGlvbnMuZW5kID0gJHNjb3BlLnRhc2tzLmxlbmd0aDsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKCRzY29wZS50YXNrT3B0aW9ucy5sb2FkTW9yZSkgew0KICAgICAgICAgICRzY29wZS50YXNrT3B0aW9ucy5zdGFydCArPSAkc2NvcGUudGFza09wdGlvbnMucm93c1BlclBhZ2U7DQogICAgICAgIH0NCiAgICAgICAgJHNjb3BlLnRhc2tPcHRpb25zLmVuZCA9ICRzY29wZS50YXNrT3B0aW9ucy5zdGFydCArICRzY29wZS50YXNrT3B0aW9ucy5yb3dzUGVyUGFnZSAtIDE7DQogICAgICB9DQoNCiAgICAgIFRhc2tNYW5hZ2VyLmdldFRhc2tzKCRzY29wZS50YXNrT3B0aW9ucywgYWdlbmN5KS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgew0KICAgICAgICAkc2NvcGUubG9hZGVkID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoJHNjb3BlLnRhc2tPcHRpb25zLmxvYWRNb3JlKSB7DQogICAgICAgICAgJHNjb3BlLnRhc2tzID0gJHNjb3BlLnRhc2tzLmNvbmNhdChyZXN1bHQudGFza3MpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICRzY29wZS50YXNrcyA9IHJlc3VsdC50YXNrczsNCiAgICAgICAgfQ0KDQogICAgICAgICRzY29wZS50YXNrT3B0aW9ucy5tb3JlQXZhaWxhYmxlID0gcmVzdWx0LnBhZ2UudG90YWxOdW0gPiAkc2NvcGUudGFza3MubGVuZ3RoOw0KDQogICAgICAgIGFnZW5jeS50YXNrcyA9IGFuZ3VsYXIuY29weSgkc2NvcGUudGFza3MpOw0KDQogICAgICAgIC8vIHVwZGF0ZSB0b3RhbCB0YXNrIGNvdW50DQogICAgICAgIGFnZW5jeS5kaXNwbGF5TmFtZSA9IHNwcmludGYoJyVzICglcyknLCBhZ2VuY3kubmFtZSwgcmVzdWx0LnBhZ2UudG90YWxOdW0pOw0KDQogICAgICAgIHNldFRhc2tDYXB0aW9uKCk7DQogICAgICAgIGNvbnRlbnRMb2FkZWQoKTsNCiAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgew0KLy8gICAgICAgIG5vdGlmeVRhc2tFcnJvcihudWxsLCBudWxsLCBlcnJvci5jdXN0b21FcnJvck1lc3NhZ2UpOw0KICAgICAgfSkuZmluYWxseShmdW5jdGlvbigpIHsNCiAgICAgICAgaWYgKCRzY29wZS50YXNrT3B0aW9ucy5yZWZyZXNoKSB7DQogICAgICAgICAgJHNjb3BlLnRhc2tPcHRpb25zLnN0YXJ0ID0gc2F2ZWRTdGFydFBvaW50Ow0KICAgICAgICB9DQoNCiAgICAgICAgJHNjb3BlLnRhc2tPcHRpb25zLnJlZnJlc2ggPSBmYWxzZTsNCiAgICAgICAgJHNjb3BlLnRhc2tPcHRpb25zLmxvYWRNb3JlID0gZmFsc2U7DQoNCiAgICAgICAgYWdlbmN5LnRhc2tPcHRpb25zID0gYW5ndWxhci5jb3B5KCRzY29wZS50YXNrT3B0aW9ucyk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRUYXNrU3RhdHVzRmlsdGVyVmFsdWVzKCkgew0KICAgICAgVGFza01hbmFnZXIuZ2V0VGFza0ZpbHRlclN0YXR1c0xpc3QoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7DQogICAgICAgICRzY29wZS50YXNrRmlsdGVyT3B0aW9ucy50YXNrVHlwZXMgPSBkYXRhLnRhc2tUeXBlczsNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGhpZGVGbHlvdXQoKSB7DQogICAgICB2YXIgYWN0aXZlT3ZlcmxheSA9IE92ZXJsYXlTZXJ2aWNlLmdldEFjdGl2ZSgpOw0KDQogICAgICBpZiAoYWN0aXZlT3ZlcmxheSAmJiBhY3RpdmVPdmVybGF5LmtpbmQgPT09ICd0YXNrLWNhcmQnKSB7DQogICAgICAgIE92ZXJsYXlTZXJ2aWNlLmhpZGUoKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBpbml0QWdlbmNpZXNBbmRHZXRUYXNrcygpIHsNCiAgICAgIHZhciBsaXN0ID0gW107DQogICAgICB2YXIgYWN0aXZlQWdlbmN5Ow0KDQogICAgICBBR0VOQ1lfVEFCX0NPTkZJRy5hZ2VuY2llcy5mb3JFYWNoKGZ1bmN0aW9uKGFnZW5jeU5hbWUpIHsNCiAgICAgICAgdmFyIGFnZW5jeSA9IHsNCiAgICAgICAgICBuYW1lOiBhZ2VuY3lOYW1lLA0KICAgICAgICAgIGRpc3BsYXlOYW1lOiBhZ2VuY3lOYW1lICsgJy4uLicsIC8vIHdpbGwgYmUgdXBkYXRlZCB3aXRoIHRvdGFsTnVtDQogICAgICAgICAgdGFza3M6IFtdLA0KICAgICAgICAgIHRvdGFsTnVtOiAwLA0KICAgICAgICAgIHRhc2tPcHRpb25zOiBhbmd1bGFyLmNvcHkoZGVmYXVsdFRhc2tPcHRpb25zKSwNCiAgICAgICAgICBpc0FjdGl2ZTogYWdlbmN5TmFtZSA9PT0gQUdFTkNZX1RBQl9DT05GSUcuY3VycmVudEFnZW5jeQ0KICAgICAgICB9Ow0KDQogICAgICAgIGlmIChhZ2VuY3kuaXNBY3RpdmUpIHsNCiAgICAgICAgICBhY3RpdmVBZ2VuY3kgPSBhZ2VuY3k7DQogICAgICAgIH0NCg0KICAgICAgICBsaXN0LnB1c2goYWdlbmN5KTsNCiAgICAgIH0pOw0KDQogICAgICBhbmd1bGFyLmV4dGVuZCgkc2NvcGUuQWdlbmN5Lmxpc3QsIGxpc3QpOw0KDQogICAgICBpZiAoYWN0aXZlQWdlbmN5KSB7DQogICAgICAgICRzY29wZS5BZ2VuY3kuY3VycmVudEFnZW5jeSA9IGFjdGl2ZUFnZW5jeTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgICRzY29wZS5BZ2VuY3kuY3VycmVudEFnZW5jeSA9IHsgbmFtZTogQUdFTkNZX1RBQl9DT05GSUcuY3VycmVudEFnZW5jeSB9Ow0KDQogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnZGFzaGJvYXJkLmFkZEFsZXJ0Jywgew0KICAgICAgICAgIHR5cGU6ICdlcnJvcicsDQogICAgICAgICAgbXNnOiAnTGlzdCBvZiBBZ2VuY2llcyBkb2VzIG5vdCBjb250YWluIHRoZSBkZWZhdWx0IEFnZW5jeS4nDQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBnZXRBZ2VuY3lUYXNrQ291bnRzKCkudGhlbihnZXRUYXNrcyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbm90aWZ5VGFza0Vycm9yKHRhc2ssIGFjdGlvbklkLCBtc2cpIHsNCiAgICAgIGhpZGVGbHlvdXQoKTsNCg0KICAgICAgaWYgKCFDT05GSUcuVVNFX01PQ0tfU0VSVklDRVMpIHsNCiAgICAgICAgTW9kYWxEaWFsb2cubWVzc2FnZSh7Y2xhc3NOYW1lOiAnZXJyb3InLCB0aXRsZTogaTE4bi5UYXNrLlRhc2tFcnJvckhlYWRpbmcsIG1zZzogbXNnfSk7DQogICAgICAgICRsb2cuZXJyb3Ioc3ByaW50ZigndGFzazogIiVzIiwgYWN0aW9uOiAiJXMiLCBtc2c6ICIlcyInLCB0YXNrID8gdGFzay50YXNrTmFtZSA6ICcnLCBhY3Rpb25JZCB8fCAnJywgbXNnIHx8ICcnKSk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbm90aWZ5VGFza1dhcm5pbmcobXNnKSB7DQogICAgICBoaWRlRmx5b3V0KCk7DQogICAgICBNb2RhbERpYWxvZy5tZXNzYWdlKHtjbGFzc05hbWU6ICd3YXJuaW5nJywgdGl0bGU6IGkxOG4uVGFzay5XYXJuaW5nLCBtc2c6IG1zZ30pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG5vdGlmeVRhc2tTdWNjZXNzKG1zZykgew0KICAgICAgaGlkZUZseW91dCgpOw0KICAgICAgTW9kYWxEaWFsb2cubWVzc2FnZSh7Y2xhc3NOYW1lOiAnc3VjY2VzcycsIHRpdGxlOiBpMThuLlRhc2suU3VjY2VzcywgbXNnOiBtc2d9KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiByZWZyZXNoVGFza3MoKSB7DQogICAgICBnZXRUYXNrcyh7DQogICAgICAgIHJlZnJlc2g6IHRydWUNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlbGVhc2VXb3JrZmxvd1Rhc2sodGFzaywgYWN0aW9uSWQpIHsNCiAgICAgIHZhciBub3RpZnlFcnJvciA9IG5vdGlmeVRhc2tFcnJvci5iaW5kKG51bGwsIHRhc2ssIGFjdGlvbklkKTsNCg0KICAgICAgVGFza01hbmFnZXIucmVsZWFzZVdvcmtmbG93VGFzayh0YXNrLCBhY3Rpb25JZCkudGhlbihmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICB2YXIgcmVzcG9uc2VNc2cgPSBkYXRhLmRhdGEubWVzc2FnZTsNCiAgICAgICAgaWYgKEFjY2VsYS5TVEFUVVMuU1VDQ0VTUyA9PT0gQWNjZWxhLlV0aWwudG9VcHBlckNhc2UocmVzcG9uc2VNc2cpKSB7DQogICAgICAgICAgcmVmcmVzaFRhc2tzKCk7DQogICAgICAgICAgbm90aWZ5VGFza1N1Y2Nlc3MoaTE4bi5UYXNrLldvcmtmbG93UmVsZWFzZVN1Y2Nlc3MpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKCdOb1JpZ2h0JyA9PT0gcmVzcG9uc2VNc2cpIHsNCiAgICAgICAgICBub3RpZnlFcnJvcihpMThuLlRhc2suV29ya2Zsb3dSZWxlYXNlUGVybWlzc2lvbkZhaWwpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIG5vdGlmeUVycm9yKGkxOG4uVGFzay5Xb3JrZmxvd1JlbGVhc2VGYWlsKTsNCiAgICAgICAgfQ0KICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICAgIG5vdGlmeUVycm9yKGVycm9yLmN1c3RvbUVycm9yTWVzc2FnZSk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiByZXNpemVDb250ZW50KCkgew0KICAgICAgaWYgKCRzdGF0ZS5pcygnc3BhY2VzLnRhc2stZGFzaGJvYXJkLmNhcmRzJykpIHsNCiAgICAgICAgc2V0VGFza0NhcmRzV2lkdGgoKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZXRUYXNrQ2FwdGlvbigpIHsNCiAgICAgIGlmICgkc2NvcGUudGFza3MubGVuZ3RoID09PSAwKSB7DQogICAgICAgIGlmICgkc2NvcGUudGFza09wdGlvbnMucXVpY2tRdWVyeSkgew0KICAgICAgICAgICRzY29wZS5jYXB0aW9uID0gc3ByaW50ZihpMThuLlRhc2suTm9GaWx0ZXJlZFRhc2tzRm91bmQsICRzY29wZS50YXNrT3B0aW9ucy5xdWlja1F1ZXJ5LmxhYmVsKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAkc2NvcGUuY2FwdGlvbiA9IGkxOG4uVGFzay5Ob1Rhc2tzRm91bmQ7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmICgkc2NvcGUudGFza09wdGlvbnMucXVpY2tRdWVyeSkgew0KICAgICAgICAgICRzY29wZS5jYXB0aW9uID0gc3ByaW50ZihpMThuLlRhc2suU2hvd2luZ05GaWx0ZXJlZFRhc2tzLCAkc2NvcGUudGFza3MubGVuZ3RoLCAkc2NvcGUudGFza09wdGlvbnMucXVpY2tRdWVyeS5sYWJlbCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgJHNjb3BlLmNhcHRpb24gPSBzcHJpbnRmKGkxOG4uVGFzay5TaG93aW5nTlRhc2tzLCAkc2NvcGUudGFza3MubGVuZ3RoKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldFRhc2tDYXJkc1dpZHRoKCkgew0KICAgICAgdmFyIG51bUNhcmRzOw0KICAgICAgdmFyIGNhcmRzLCBjb250YWluZXJXaWR0aDsNCg0KICAgICAgLy8gaGFyZGNvZGVkIGJlY2F1c2UgY2FyZHMgbWF5IG5vdCBiZSByZW5kZXJlZCB5ZXQNCiAgICAgIC8vIHNhbWUgYXMgQHRhc2stY2FyZC13cmFwcGVyLXdpZHRoIGluIHZhcmlhYmxlcy5sZXNzDQogICAgICB2YXIgb25lVGFza0NhcmRXaWR0aCA9IDI4NTsNCg0KICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgIGNhcmRzID0gJCgnLnRhc2stY2FyZHMnKTsNCiAgICAgICAgaWYgKCRzY29wZS50YXNrcy5sZW5ndGgpIHsNCiAgICAgICAgICBpZiAoY2FyZHMpIHsNCiAgICAgICAgICAgIGNvbnRhaW5lcldpZHRoID0gJHBvc2l0aW9uLm9mZnNldCgkKCcudGFza3MtY29udGFpbmVyJykpLndpZHRoOw0KDQogICAgICAgICAgICBjb250YWluZXJXaWR0aCAtPSAyMDsgLy8gbGVhdmUgcm9vbSBmb3Igc2Nyb2xsYmFyDQoNCiAgICAgICAgICAgIG51bUNhcmRzID0gTWF0aC5mbG9vcihjb250YWluZXJXaWR0aCAvIG9uZVRhc2tDYXJkV2lkdGgpOw0KDQogICAgICAgICAgICBpZiAobnVtQ2FyZHMgPiAkc2NvcGUudGFza3MubGVuZ3RoKSB7DQogICAgICAgICAgICAgIG51bUNhcmRzID0gJHNjb3BlLnRhc2tzLmxlbmd0aDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8kbG9nLmRlYnVnKHNwcmludGYoJ3NldFRhc2tDYXJkc1dpZHRoKCkgY29udGFpbmVyV2lkdGg6ICVzLCBudW1DYXJkczogJXMnLCBjb250YWluZXJXaWR0aCwgbnVtQ2FyZHMpKTsNCg0KICAgICAgICAgICAgY2FyZHMuY3NzKCd3aWR0aCcsIChudW1DYXJkcyAqIG9uZVRhc2tDYXJkV2lkdGgpICsgJ3B4Jyk7DQoNCiAgICAgICAgICAgIC8vIHdoZW4gdGhlIGRhc2hib2FyZCBpcyBmaXJzdCBsb2FkZWQsICIudGFza3MiIGlzIGhpZGRlbg0KICAgICAgICAgICAgLy8gYW5kIHdpbGwgYmUgc2hvd24gYWZ0ZXIgaW5pdGlhbCByZXNpemUNCiAgICAgICAgICAgICRzY29wZS5yZWFkeSA9IHRydWU7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aW1lb3V0KHNldFRhc2tDYXJkc1dpZHRoLCA1MDAsIGZhbHNlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgJHNjb3BlLnJlYWR5ID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfSwgMCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQnVsayBhY3Rpb25zIG11c3QgYmUgY29tbW9uIHRvIGFsbCBzZWxlY3RlZCB0YXNrcy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB1cGRhdGVCdWxrQWN0aW9ucygpIHsNCiAgICAgIHZhciBhY3Rpb25zOw0KLy8gICAgICB2YXIgYWN0aW9ucyA9IFtdOw0KICAgICAgdmFyIGNoZWNrZWRUYXNrQ291bnQgPSAwOw0KICAgICAgdmFyIHVuaXF1ZUFjdGlvbnMgPSBbXTsNCiAgICAgIHZhciB1bmlxdWVBY3Rpb25zSGFzaCA9IHt9Ow0KDQogICAgICAvLyBjb2xsZWN0IGFsbCBhY3Rpb25zDQogICAgICBhbmd1bGFyLmZvckVhY2goJHNjb3BlLnRhc2tzLCBmdW5jdGlvbiAodGFzaykgew0KICAgICAgICBpZiAodGFzay5pc0NoZWNrZWQpIHsNCiAgICAgICAgICBjaGVja2VkVGFza0NvdW50Kys7DQogICAgICAgICAgYWN0aW9ucyA9IHRhc2suYWN0aW9uczsNCi8vICAgICAgICAgIGFjdGlvbnMgPSBhY3Rpb25zLmNvbmNhdCh0YXNrLmFjdGlvbnMpOw0KICAgICAgICB9DQogICAgICB9KTsNCg0KICAgICAgaWYgKGNoZWNrZWRUYXNrQ291bnQgPT09IDEpIHsNCiAgICAgICAgJHNjb3BlLmJ1bGtBY3Rpb25zID0gYWN0aW9uczsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgICRzY29wZS5idWxrQWN0aW9ucyA9IFtdOw0KICAgICAgfQ0KDQovLyByZW1vdmVkIGZvciBBQUVUQS0yMjYNCi8vICAgICAgaWYgKGNoZWNrZWRUYXNrQ291bnQgPiAxKSB7IC8vIGdldCBjb21tb24gYWN0aW9ucw0KLy8gICAgICAgIGFuZ3VsYXIuZm9yRWFjaChhY3Rpb25zLCBmdW5jdGlvbiAoYWN0aW9uKSB7DQovLyAgICAgICAgICB2YXIgdW5pcXVlQWN0aW9uID0gdW5pcXVlQWN0aW9uc0hhc2hbYWN0aW9uLmlkXTsNCi8vDQovLyAgICAgICAgICBpZiAodW5pcXVlQWN0aW9uc0hhc2hbYWN0aW9uLmlkXSkgew0KLy8gICAgICAgICAgICB1bmlxdWVBY3Rpb25zSGFzaFthY3Rpb24uaWRdLnJlZkNvdW50Kys7DQovLyAgICAgICAgICB9IGVsc2Ugew0KLy8gICAgICAgICAgICB1bmlxdWVBY3Rpb25zSGFzaFthY3Rpb24uaWRdID0ge3JlZkNvdW50OiAxLCBhY3Rpb246IGFjdGlvbn07DQovLyAgICAgICAgICB9DQovLyAgICAgICAgfSk7DQovLw0KLy8gICAgICAgIC8vIGNvbGxlY3QgYWN0aW9ucyB0aGF0IGFyZSBjb21tb24gdG8gYWxsIHRhc2tzDQovLyAgICAgICAgYW5ndWxhci5mb3JFYWNoKHVuaXF1ZUFjdGlvbnNIYXNoLCBmdW5jdGlvbiAoaXRlbSwga2V5KSB7DQovLyAgICAgICAgICBpZiAoaXRlbS5yZWZDb3VudCA9PT0gY2hlY2tlZFRhc2tDb3VudCkgew0KLy8gICAgICAgICAgICB1bmlxdWVBY3Rpb25zLnB1c2goaXRlbS5hY3Rpb24pOw0KLy8gICAgICAgICAgfQ0KLy8gICAgICAgIH0pOw0KLy8NCi8vICAgICAgICAkc2NvcGUuYnVsa0FjdGlvbnMgPSB1bmlxdWVBY3Rpb25zOw0KLy8gICAgICB9IGVsc2Ugew0KLy8gICAgICAgICRzY29wZS5idWxrQWN0aW9ucyA9IGFjdGlvbnM7DQovLyAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBJTklUSUFMSVpFDQoNCiAgICAkbG9nID0gJGxvZy5nZXRJbnN0YW5jZSgnVEFTSy1EQVNIQk9BUkQtQ09OVFJPTExFUicpOw0KDQogICAgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHsNCiAgICAgICRzY29wZS4kZW1pdCgnZGFzaGJvYXJkLnJlc2V0QWN0aXZlU3BhY2UnKTsNCiAgICAgICRzY29wZS53aW5kb3dSZXNpemVIYW5kbGVycy5yZWdpc3RlcihyZXNpemVDb250ZW50KTsNCg0KICAgICAgJGRvY3VtZW50Lm9uKCdjbGljaycsIGRvY3VtZW50Q2xpY2tIYW5kbGVyKTsNCg0KICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICRsb2cuaW5mbygnZGVzdHJveWVkJyk7DQogICAgICAgICRkb2N1bWVudC5vZmYoJ2NsaWNrJywgZG9jdW1lbnRDbGlja0hhbmRsZXIpOw0KICAgICAgICAkc2NvcGUud2luZG93UmVzaXplSGFuZGxlcnMudW5yZWdpc3RlcihyZXNpemVDb250ZW50KTsNCg0KICAgICAgICBpZiAoc2V0U2xpZGVyQmFyVmlzaWJpbGl0eSAhPT0gYW5ndWxhci5ub29wKSB7DQogICAgICAgICAgJHNjb3BlLndpbmRvd1Jlc2l6ZUhhbmRsZXJzLnVucmVnaXN0ZXIoc2V0U2xpZGVyQmFyVmlzaWJpbGl0eSk7DQogICAgICAgIH0NCg0KICAgICAgICBTZXJ2ZXJTZXNzaW9uU2VydmljZS5lbmQoQ09ORklHLlRBU0tfU0VTU0lPTl9OQU1FKTsNCiAgICAgIH0pOw0KDQogICAgICBnZXRUYXNrU3RhdHVzRmlsdGVyVmFsdWVzKCk7DQoNCiAgICAgIFRhc2tNYW5hZ2VyLmdldFF1aWNrUXVlcmllcygpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsNCiAgICAgICAgJHNjb3BlLnF1aWNrUXVlcmllcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0Ow0KICAgICAgfSk7DQoNCiAgICAgIGlmIChBR0VOQ1lfVEFCX0NPTkZJRykgew0KICAgICAgICBpbml0QWdlbmNpZXNBbmRHZXRUYXNrcygpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZ2V0VGFza3MoKTsNCiAgICAgIH0NCiAgICB9DQogIH0NCn0pKCk7</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>