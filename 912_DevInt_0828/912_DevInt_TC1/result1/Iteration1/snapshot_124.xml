<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="124">
  <HTTPTask id="126" hostname="aa-pt6245.dev.accela.com:5443" path="/portlets/spa/js/lib/custom/ng-sortable.js" url="https://aa-pt6245.dev.accela.com:5443/portlets/spa/js/lib/custom/ng-sortable.js" ip="13.93.163.237" port="5443" client_ip="10.1.61.63" client_port="11580" connectionId="1716" origin="Primary" startDateTime="2017-08-28T11:38:06.309-07:00" startTime="5427" endTime="5439" sendTime="11" waitTime="0" receiveTime="1">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Referer" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zcGEvZGFzaGJvYXJkLmRv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SlNFU1NJT05JRD12WmtsdWRxZ2o4WmpHTTJvb2pPTkVrT0o7IEpTRVNTSU9OSUQ9KioqKioqKioqKioqKioqKioqKioqKioqKioqOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ1NDgzODY5OyBob3N0U2lnbk9uPXRydWU7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM7IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBMQVRFU1RfU0VTU0lPTl9JRD12WmtsdWRxZ2o4WmpHTTJvb2pPTkVrT0o7IEFDQXV0aD03NzM2MjAxNDkzMTM2NjIyNTcyODg2NTM3NDA1MDg5NjkxODQ2NjMzNjY3Mjk5NTA0OTExNDkxODQyNTA1OTgyNjUyODk1OTAxNjQyMTUyNjM4NjkxNzE2NDgzNTExNzc1MzY1MTQ2NjI3NDczOTk4MzMzMTI2NDU1ODMzODM2MDsgQUNTaWduT25Nb2R1bGU9U1NPU3RhbmRhcmQ7IEFBUGVyc2lzdExvZ2luU2VydlByb3ZDb2RlPUZMQUdTVEFGRjsgTG9naW5TZXJ2UHJvdkNvZGU0TXVsdGlBZ2VuY3k9RkxBR1NUQUZGOyBMb2dpblVzZXJuYW1lNE11bHRpQWdlbmN5PTE3OUREMTNBMTg2MDI4RjQ7IEFDU2lnbm9mZj0iaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zZWN1cml0eS9zaWdub3V0LmRvIjsgQUNTd2l0Y2hBZ2VuY3k9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9wb3J0bGV0cy9zcGEvanMvbGliL2N1c3RvbS9uZy1zb3J0YWJsZS5qcyBIVFRQLzEuMQ0KUmVmZXJlcjogaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zcGEvZGFzaGJvYXJkLmRvDQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXT1c2NDsgVHJpZGVudC83LjA7IHJ2OjExLjApIGxpa2UgR2Vja28NCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZQ0KQWNjZXB0LUxhbmd1YWdlOiBlbi1VUw0KQWNjZXB0OiAqLyoNCkNvbm5lY3Rpb246IEtlZXAtQWxpdmUNCkhvc3Q6IGFhLXB0NjI0NS5kZXYuYWNjZWxhLmNvbTo1NDQzDQpDb29raWU6IEpTRVNTSU9OSUQ9dlprbHVkcWdqOFpqR00yb29qT05Fa09KOyBKU0VTU0lPTklEPSoqKioqKioqKioqKioqKioqKioqKioqKioqKjsgTEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NTQ4Mzg2OTsgaG9zdFNpZ25Pbj10cnVlOyBnX2N1cnJlbnRfbGFuZ3VhZ2VfZXh0PWVuX1VTOyBMQVRFU1RfV0VCX1NFUlZFUj0xMC4xLjAuNjsgTEFURVNUX1NFU1NJT05fSUQ9dlprbHVkcWdqOFpqR00yb29qT05Fa09KOyBBQ0F1dGg9NzczNjIwMTQ5MzEzNjYyMjU3Mjg4NjUzNzQwNTA4OTY5MTg0NjYzMzY2NzI5OTUwNDkxMTQ5MTg0MjUwNTk4MjY1Mjg5NTkwMTY0MjE1MjYzODY5MTcxNjQ4MzUxMTc3NTM2NTE0NjYyNzQ3Mzk5ODMzMzEyNjQ1NTgzMzgzNjA7IEFDU2lnbk9uTW9kdWxlPVNTT1N0YW5kYXJkOyBBQVBlcnNpc3RMb2dpblNlcnZQcm92Q29kZT1GTEFHU1RBRkY7IExvZ2luU2VydlByb3ZDb2RlNE11bHRpQWdlbmN5PUZMQUdTVEFGRjsgTG9naW5Vc2VybmFtZTRNdWx0aUFnZW5jeT0xNzlERDEzQTE4NjAyOEY0OyBBQ1NpZ25vZmY9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvc2VjdXJpdHkvc2lnbm91dC5kbyI7IEFDU3dpdGNoQWdlbmN5PSJodHRwczovL2FhLXB0NjI0NS5kZXYuYWNjZWxhLmNvbTo1NDQzL3BvcnRsZXRzL2NvbW1vbnMvc3NvL2JsYW5rLmpzcCINCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="JSESSIONID" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dlprbHVkcWdqOFpqR00yb29qT05Fa09K</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="JSESSIONID" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>KioqKioqKioqKioqKioqKioqKioqKioqKioq</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LASTEST_REQUEST_TIME" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTUwMzk0NTQ4Mzg2OQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="hostSignOn" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="g_current_language_ext" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW5fVVM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_WEB_SERVER" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTAuMS4wLjY=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_SESSION_ID" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dlprbHVkcWdqOFpqR00yb29qT05Fa09K</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACAuth" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NzczNjIwMTQ5MzEzNjYyMjU3Mjg4NjUzNzQwNTA4OTY5MTg0NjYzMzY2NzI5OTUwNDkxMTQ5MTg0MjUwNTk4MjY1Mjg5NTkwMTY0MjE1MjYzODY5MTcxNjQ4MzUxMTc3NTM2NTE0NjYyNzQ3Mzk5ODMzMzEyNjQ1NTgzMzgzNjA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignOnModule" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U1NPU3RhbmRhcmQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="AAPersistLoginServProvCode" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginServProvCode4MultiAgency" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginUsername4MultiAgency" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTc5REQxM0ExODYwMjhGNA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignoff" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvc2VjdXJpdHkvc2lnbm91dC5kbyI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSwitchAgency" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLUNveW90ZS8xLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-XSS-Protection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NTQ4Mzg4NDsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFURVNUX1dFQl9TRVJWRVI9MTAuMS4wLjY7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFURVNUX1NFU1NJT05fSUQ9dlprbHVkcWdqOFpqR00yb29qT05Fa09KOyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJl</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Vy8iMzc0NDYtMTQ5ODc0NzE1MDAwMCI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAyOSBKdW4gMjAxNyAxNDozOToxMCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Transfer-Encoding" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y2h1bmtlZA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyOCBBdWcgMjAxNyAxODozODowMyBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IEFwYWNoZS1Db3lvdGUvMS4xDQpYLVhTUy1Qcm90ZWN0aW9uOiAwDQpTZXQtQ29va2llOiBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ1NDgzODg0OyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJlDQpTZXQtQ29va2llOiBMQVRFU1RfV0VCX1NFUlZFUj0xMC4xLjAuNjsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ0KU2V0LUNvb2tpZTogTEFURVNUX1NFU1NJT05fSUQ9dlprbHVkcWdqOFpqR00yb29qT05Fa09KOyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJlDQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KRVRhZzogVy8iMzc0NDYtMTQ5ODc0NzE1MDAwMCINCkxhc3QtTW9kaWZpZWQ6IFRodSwgMjkgSnVuIDIwMTcgMTQ6Mzk6MTAgR01UDQpDb250ZW50LVR5cGU6IHRleHQvamF2YXNjcmlwdA0KVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWQNCkNvbnRlbnQtRW5jb2Rpbmc6IGd6aXANClZhcnk6IEFjY2VwdC1FbmNvZGluZw0KRGF0ZTogTW9uLCAyOCBBdWcgMjAxNyAxODozODowMyBHTVQNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>LyoqDQogKiBkYmFsbWVyQGFjY2VsYS5jb20gYWRkZWQgbGluZXMgIzY2Mi02NjQgdG8gcHV0IHRleHQgaW4gdGhlIHBsYWNlaG9sZGVyLg0KICovDQoNCi8qDQogVGhlIE1JVCBMaWNlbnNlIChNSVQpDQoNCiBDb3B5cmlnaHQgKGMpIDIwMTQgTXVoYW1tZWQgQXNoaWsNCg0KIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbA0KIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMNCiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzDQogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoNCg0KIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbA0KIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuDQoNCiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUg0KIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLA0KIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLA0KIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogU09GVFdBUkUuDQogKi8NCg0KLypqc2hpbnQgaW5kZW50OiAyICovDQovKmdsb2JhbCBhbmd1bGFyOiBmYWxzZSAqLw0KDQooZnVuY3Rpb24gKCkgew0KICAndXNlIHN0cmljdCc7DQogIGFuZ3VsYXIubW9kdWxlKCd1aS5zb3J0YWJsZScsIFtdKQ0KICAgIC5jb25zdGFudCgnc29ydGFibGVDb25maWcnLCB7DQogICAgICBpdGVtQ2xhc3M6ICdhcy1zb3J0YWJsZS1pdGVtJywNCiAgICAgIGhhbmRsZUNsYXNzOiAnYXMtc29ydGFibGUtaXRlbS1oYW5kbGUnLA0KICAgICAgcGxhY2VIb2xkZXJDbGFzczogJ2FzLXNvcnRhYmxlLXBsYWNlaG9sZGVyJywNCiAgICAgIGRyYWdDbGFzczogJ2FzLXNvcnRhYmxlLWRyYWcnLA0KICAgICAgaGlkZGVuQ2xhc3M6ICdhcy1zb3J0YWJsZS1oaWRkZW4nDQogICAgfSk7DQp9KCkpOw0KDQovKmpzaGludCBpbmRlbnQ6IDIgKi8NCi8qZ2xvYmFsIGFuZ3VsYXI6IGZhbHNlICovDQoNCihmdW5jdGlvbiAoKSB7DQogICd1c2Ugc3RyaWN0JzsNCg0KICB2YXIgbWFpbk1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCd1aS5zb3J0YWJsZScpOw0KDQogIC8qKg0KICAgKiBIZWxwZXIgZmFjdG9yeSBmb3Igc29ydGFibGUuDQogICAqLw0KICBtYWluTW9kdWxlLmZhY3RvcnkoJyRoZWxwZXInLCBbJyRkb2N1bWVudCcsICckd2luZG93JywNCiAgICBmdW5jdGlvbiAoJGRvY3VtZW50LCAkd2luZG93KSB7DQogICAgICByZXR1cm4gew0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBHZXQgdGhlIGhlaWdodCBvZiBhbiBlbGVtZW50Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZWxlbWVudCBBbmd1bGFyIGVsZW1lbnQuDQogICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IEhlaWdodA0KICAgICAgICAgKi8NCiAgICAgICAgaGVpZ2h0OiBmdW5jdGlvbiAoZWxlbWVudCkgew0KICAgICAgICAgIHJldHVybiBlbGVtZW50LnByb3AoJ29mZnNldEhlaWdodCcpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBHZXQgdGhlIHdpZHRoIG9mIGFuIGVsZW1lbnQuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlbGVtZW50IEFuZ3VsYXIgZWxlbWVudC4NCiAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gV2lkdGgNCiAgICAgICAgICovDQogICAgICAgIHdpZHRoOiBmdW5jdGlvbiAoZWxlbWVudCkgew0KICAgICAgICAgIHJldHVybiBlbGVtZW50LnByb3AoJ29mZnNldFdpZHRoJyk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEdldCB0aGUgb2Zmc2V0IHZhbHVlcyBvZiBhbiBlbGVtZW50Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZWxlbWVudCBBbmd1bGFyIGVsZW1lbnQuDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbc2Nyb2xsYWJsZUNvbnRhaW5lcl0gU2Nyb2xsYWJsZSBjb250YWluZXIgb2JqZWN0IGZvciBjYWxjdWxhdGluZyByZWxhdGl2ZSB0b3AgJiBsZWZ0IChvcHRpb25hbCwgZGVmYXVsdHMgdG8gRG9jdW1lbnQpDQogICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IE9iamVjdCB3aXRoIHByb3BlcnRpZXMgd2lkdGgsIGhlaWdodCwgdG9wIGFuZCBsZWZ0DQogICAgICAgICAqLw0KICAgICAgICBvZmZzZXQ6IGZ1bmN0aW9uIChlbGVtZW50LCBzY3JvbGxhYmxlQ29udGFpbmVyKSB7DQogICAgICAgICAgdmFyIGJvdW5kaW5nQ2xpZW50UmVjdCA9IGVsZW1lbnRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgICAgaWYgKCFzY3JvbGxhYmxlQ29udGFpbmVyKSB7IHNjcm9sbGFibGVDb250YWluZXIgPSAkZG9jdW1lbnRbMF0uZG9jdW1lbnRFbGVtZW50OyB9DQoNCiAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgd2lkdGg6IGJvdW5kaW5nQ2xpZW50UmVjdC53aWR0aCB8fCBlbGVtZW50LnByb3AoJ29mZnNldFdpZHRoJyksDQogICAgICAgICAgICBoZWlnaHQ6IGJvdW5kaW5nQ2xpZW50UmVjdC5oZWlnaHQgfHwgZWxlbWVudC5wcm9wKCdvZmZzZXRIZWlnaHQnKSwNCiAgICAgICAgICAgIHRvcDogYm91bmRpbmdDbGllbnRSZWN0LnRvcCArICgkd2luZG93LnBhZ2VZT2Zmc2V0IHx8IHNjcm9sbGFibGVDb250YWluZXIuc2Nyb2xsVG9wIC0gc2Nyb2xsYWJsZUNvbnRhaW5lci5vZmZzZXRUb3ApLA0KICAgICAgICAgICAgbGVmdDogYm91bmRpbmdDbGllbnRSZWN0LmxlZnQgKyAoJHdpbmRvdy5wYWdlWE9mZnNldCB8fCBzY3JvbGxhYmxlQ29udGFpbmVyLnNjcm9sbExlZnQgLSBzY3JvbGxhYmxlQ29udGFpbmVyLm9mZnNldExlZnQpDQogICAgICAgICAgfTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogZ2V0IHRoZSBldmVudCBvYmplY3QgZm9yIHRvdWNoLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGV2ZW50IHRoZSB0b3VjaCBldmVudA0KICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoZSB0b3VjaCBldmVudCBvYmplY3QuDQogICAgICAgICAqLw0KICAgICAgICBldmVudE9iajogZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgdmFyIG9iaiA9IGV2ZW50Ow0KICAgICAgICAgIGlmIChldmVudC50YXJnZXRUb3VjaGVzICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIG9iaiA9IGV2ZW50LnRhcmdldFRvdWNoZXMuaXRlbSgwKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQgIT09IHVuZGVmaW5lZCAmJiBldmVudC5vcmlnaW5hbEV2ZW50LnRhcmdldFRvdWNoZXMgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgb2JqID0gZXZlbnQub3JpZ2luYWxFdmVudC50YXJnZXRUb3VjaGVzLml0ZW0oMCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENoZWNrcyB3aGV0aGVyIHRoZSB0b3VjaCBpcyB2YWxpZCBhbmQgbXVsdGlwbGUuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSBldmVudCB0aGUgZXZlbnQgb2JqZWN0Lg0KICAgICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0b3VjaCBpcyBtdWx0aXBsZS4NCiAgICAgICAgICovDQogICAgICAgIGlzVG91Y2hJbnZhbGlkOiBmdW5jdGlvbiAoZXZlbnQpIHsNCg0KICAgICAgICAgIHZhciB0b3VjaEludmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICBpZiAoZXZlbnQudG91Y2hlcyAhPT0gdW5kZWZpbmVkICYmIGV2ZW50LnRvdWNoZXMubGVuZ3RoID4gMSkgew0KICAgICAgICAgICAgdG91Y2hJbnZhbGlkID0gdHJ1ZTsNCiAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQgIT09IHVuZGVmaW5lZCAmJg0KICAgICAgICAgICAgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzICE9PSB1bmRlZmluZWQgJiYgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgIHRvdWNoSW52YWxpZCA9IHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiB0b3VjaEludmFsaWQ7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEdldCB0aGUgc3RhcnQgcG9zaXRpb24gb2YgdGhlIHRhcmdldCBlbGVtZW50IGFjY29yZGluZyB0byB0aGUgcHJvdmlkZWQgZXZlbnQgcHJvcGVydGllcy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50IEV2ZW50DQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQgVGFyZ2V0IGVsZW1lbnQNCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtzY3JvbGxhYmxlQ29udGFpbmVyXSAob3B0aW9uYWwpIFNjcm9sbGFibGUgY29udGFpbmVyIG9iamVjdA0KICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBPYmplY3Qgd2l0aCBwcm9wZXJ0aWVzIG9mZnNldFgsIG9mZnNldFkuDQogICAgICAgICAqLw0KICAgICAgICBwb3NpdGlvblN0YXJ0ZWQ6IGZ1bmN0aW9uIChldmVudCwgdGFyZ2V0LCBzY3JvbGxhYmxlQ29udGFpbmVyKSB7DQogICAgICAgICAgdmFyIHBvcyA9IHt9Ow0KICAgICAgICAgIHBvcy5vZmZzZXRYID0gZXZlbnQucGFnZVggLSB0aGlzLm9mZnNldCh0YXJnZXQsIHNjcm9sbGFibGVDb250YWluZXIpLmxlZnQ7DQogICAgICAgICAgcG9zLm9mZnNldFkgPSBldmVudC5wYWdlWSAtIHRoaXMub2Zmc2V0KHRhcmdldCwgc2Nyb2xsYWJsZUNvbnRhaW5lcikudG9wOw0KICAgICAgICAgIHBvcy5zdGFydFggPSBwb3MubGFzdFggPSBldmVudC5wYWdlWDsNCiAgICAgICAgICBwb3Muc3RhcnRZID0gcG9zLmxhc3RZID0gZXZlbnQucGFnZVk7DQogICAgICAgICAgcG9zLm5vd1ggPSBwb3Mubm93WSA9IHBvcy5kaXN0WCA9IHBvcy5kaXN0WSA9IHBvcy5kaXJBeCA9IDA7DQogICAgICAgICAgcG9zLmRpclggPSBwb3MuZGlyWSA9IHBvcy5sYXN0RGlyWCA9IHBvcy5sYXN0RGlyWSA9IHBvcy5kaXN0QXhYID0gcG9zLmRpc3RBeFkgPSAwOw0KICAgICAgICAgIHJldHVybiBwb3M7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENhbGN1bGF0ZXMgdGhlIGV2ZW50IHBvc2l0aW9uIGFuZCBzZXRzIHRoZSBkaXJlY3Rpb24NCiAgICAgICAgICogcHJvcGVydGllcy4NCiAgICAgICAgICogdGhpcyBtZXRob2QgY29kZSBpcyBmcm9tIC0gaHR0cHM6Ly9naXRodWIuY29tL0ppbUxpdS9hbmd1bGFyLXVpLXRyZWUNCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHBvcyB0aGUgY3VycmVudCBwb3NpdGlvbiBvZiB0aGUgZWxlbWVudC4NCiAgICAgICAgICogQHBhcmFtIGV2ZW50IHRoZSBtb3ZlIGV2ZW50Lg0KICAgICAgICAgKi8NCiAgICAgICAgY2FsY3VsYXRlUG9zaXRpb246IGZ1bmN0aW9uIChwb3MsIGV2ZW50KSB7DQogICAgICAgICAgLy8gbW91c2UgcG9zaXRpb24gbGFzdCBldmVudHMNCiAgICAgICAgICBwb3MubGFzdFggPSBwb3Mubm93WDsNCiAgICAgICAgICBwb3MubGFzdFkgPSBwb3Mubm93WTsNCg0KICAgICAgICAgIC8vIG1vdXNlIHBvc2l0aW9uIHRoaXMgZXZlbnRzDQogICAgICAgICAgcG9zLm5vd1ggPSBldmVudC5wYWdlWDsNCiAgICAgICAgICBwb3Mubm93WSA9IGV2ZW50LnBhZ2VZOw0KDQogICAgICAgICAgLy8gZGlzdGFuY2UgbW91c2UgbW92ZWQgYmV0d2VlbiBldmVudHMNCiAgICAgICAgICBwb3MuZGlzdFggPSBwb3Mubm93WCAtIHBvcy5sYXN0WDsNCiAgICAgICAgICBwb3MuZGlzdFkgPSBwb3Mubm93WSAtIHBvcy5sYXN0WTsNCg0KICAgICAgICAgIC8vIGRpcmVjdGlvbiBtb3VzZSB3YXMgbW92aW5nDQogICAgICAgICAgcG9zLmxhc3REaXJYID0gcG9zLmRpclg7DQogICAgICAgICAgcG9zLmxhc3REaXJZID0gcG9zLmRpclk7DQoNCiAgICAgICAgICAvLyBkaXJlY3Rpb24gbW91c2UgaXMgbm93IG1vdmluZyAob24gYm90aCBheGlzKQ0KICAgICAgICAgIHBvcy5kaXJYID0gcG9zLmRpc3RYID09PSAwID8gMCA6IHBvcy5kaXN0WCA+IDAgPyAxIDogLTE7DQogICAgICAgICAgcG9zLmRpclkgPSBwb3MuZGlzdFkgPT09IDAgPyAwIDogcG9zLmRpc3RZID4gMCA/IDEgOiAtMTsNCg0KICAgICAgICAgIC8vIGF4aXMgbW91c2UgaXMgbm93IG1vdmluZyBvbg0KICAgICAgICAgIHZhciBuZXdBeCA9IE1hdGguYWJzKHBvcy5kaXN0WCkgPiBNYXRoLmFicyhwb3MuZGlzdFkpID8gMSA6IDA7DQoNCiAgICAgICAgICAvLyBjYWxjIGRpc3RhbmNlIG1vdmVkIG9uIHRoaXMgYXhpcyAoYW5kIGRpcmVjdGlvbikNCiAgICAgICAgICBpZiAocG9zLmRpckF4ICE9PSBuZXdBeCkgew0KICAgICAgICAgICAgcG9zLmRpc3RBeFggPSAwOw0KICAgICAgICAgICAgcG9zLmRpc3RBeFkgPSAwOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBwb3MuZGlzdEF4WCArPSBNYXRoLmFicyhwb3MuZGlzdFgpOw0KICAgICAgICAgICAgaWYgKHBvcy5kaXJYICE9PSAwICYmIHBvcy5kaXJYICE9PSBwb3MubGFzdERpclgpIHsNCiAgICAgICAgICAgICAgcG9zLmRpc3RBeFggPSAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwb3MuZGlzdEF4WSArPSBNYXRoLmFicyhwb3MuZGlzdFkpOw0KICAgICAgICAgICAgaWYgKHBvcy5kaXJZICE9PSAwICYmIHBvcy5kaXJZICE9PSBwb3MubGFzdERpclkpIHsNCiAgICAgICAgICAgICAgcG9zLmRpc3RBeFkgPSAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBwb3MuZGlyQXggPSBuZXdBeDsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogTW92ZSB0aGUgcG9zaXRpb24gYnkgYXBwbHlpbmcgc3R5bGUuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSBldmVudCB0aGUgZXZlbnQgb2JqZWN0DQogICAgICAgICAqIEBwYXJhbSBlbGVtZW50IC0gdGhlIGRvbSBlbGVtZW50DQogICAgICAgICAqIEBwYXJhbSBwb3MgLSBjdXJyZW50IHBvc2l0aW9uDQogICAgICAgICAqIEBwYXJhbSBjb250YWluZXIgLSB0aGUgYm91bmRpbmcgY29udGFpbmVyLg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW3Njcm9sbGFibGVDb250YWluZXJdIChvcHRpb25hbCkgU2Nyb2xsYWJsZSBjb250YWluZXIgb2JqZWN0DQogICAgICAgICAqLw0KICAgICAgICBtb3ZlUG9zaXRpb246IGZ1bmN0aW9uIChldmVudCwgZWxlbWVudCwgcG9zLCBjb250YWluZXIsIHNjcm9sbGFibGVDb250YWluZXIpIHsNCiAgICAgICAgICB2YXIgYm91bmRzOw0KDQogICAgICAgICAgZWxlbWVudC54ID0gZXZlbnQucGFnZVggLSBwb3Mub2Zmc2V0WDsNCiAgICAgICAgICBlbGVtZW50LnkgPSBldmVudC5wYWdlWSAtIHBvcy5vZmZzZXRZOw0KDQogICAgICAgICAgaWYgKGNvbnRhaW5lcikgew0KICAgICAgICAgICAgYm91bmRzID0gdGhpcy5vZmZzZXQoY29udGFpbmVyLCBzY3JvbGxhYmxlQ29udGFpbmVyKTsNCiAgICAgICAgICAgIGlmIChlbGVtZW50LnggPCBib3VuZHMubGVmdCkgew0KICAgICAgICAgICAgICBlbGVtZW50LnggPSBib3VuZHMubGVmdDsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC54ID49IGJvdW5kcy53aWR0aCArIGJvdW5kcy5sZWZ0IC0gdGhpcy5vZmZzZXQoZWxlbWVudCkud2lkdGgpIHsNCiAgICAgICAgICAgICAgZWxlbWVudC54ID0gYm91bmRzLndpZHRoICsgYm91bmRzLmxlZnQgLSB0aGlzLm9mZnNldChlbGVtZW50KS53aWR0aDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChlbGVtZW50LnkgPCBib3VuZHMudG9wKSB7DQogICAgICAgICAgICAgIGVsZW1lbnQueSA9IGJvdW5kcy50b3A7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQueSA+PSBib3VuZHMuaGVpZ2h0ICsgYm91bmRzLnRvcCAtIHRoaXMub2Zmc2V0KGVsZW1lbnQpLmhlaWdodCkgew0KICAgICAgICAgICAgICBlbGVtZW50LnkgPSBib3VuZHMuaGVpZ2h0ICsgYm91bmRzLnRvcCAtIHRoaXMub2Zmc2V0KGVsZW1lbnQpLmhlaWdodDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBlbGVtZW50LmNzcyh7DQogICAgICAgICAgICAnbGVmdCc6IGVsZW1lbnQueCArICdweCcsDQogICAgICAgICAgICAndG9wJzogZWxlbWVudC55ICsgJ3B4Jw0KICAgICAgICAgIH0pOw0KDQogICAgICAgICAgdGhpcy5jYWxjdWxhdGVQb3NpdGlvbihwb3MsIGV2ZW50KTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogVGhlIGRyYWcgaXRlbSBpbmZvIGFuZCBmdW5jdGlvbnMuDQogICAgICAgICAqIHJldGFpbnMgdGhlIGl0ZW0gaW5mbyBiZWZvcmUgYW5kIGFmdGVyIG1vdmUuDQogICAgICAgICAqIGhvbGRzIHNvdXJjZSBpdGVtIGFuZCB0YXJnZXQgc2NvcGUuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSBpdGVtIC0gdGhlIGRyYWcgaXRlbQ0KICAgICAgICAgKiBAcmV0dXJucyB7e2luZGV4OiAqLCBwYXJlbnQ6ICosIHNvdXJjZTogKiwNCiAgICAgICAgICAgICAgICAgKiAgICAgICAgICBzb3VyY2VJbmZvOiB7aW5kZXg6ICosIGl0ZW1TY29wZTogKCp8LmRyYWdJdGVtLnNvdXJjZUluZm8uaXRlbVNjb3BlfCRzY29wZS5pdGVtU2NvcGV8aXRlbVNjb3BlKSwgc29ydGFibGVTY29wZTogKn0sDQogICAgICAgICAgICAgICAgICogICAgICAgICBtb3ZlVG86IG1vdmVUbywgaXNTYW1lUGFyZW50OiBpc1NhbWVQYXJlbnQsIGlzT3JkZXJDaGFuZ2VkOiBpc09yZGVyQ2hhbmdlZCwgZXZlbnRBcmdzOiBldmVudEFyZ3MsIGFwcGx5OiBhcHBseX19DQogICAgICAgICAqLw0KICAgICAgICBkcmFnSXRlbTogZnVuY3Rpb24gKGl0ZW0pIHsNCg0KICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICBpbmRleDogaXRlbS5pbmRleCgpLA0KICAgICAgICAgICAgcGFyZW50OiBpdGVtLnNvcnRhYmxlU2NvcGUsDQogICAgICAgICAgICBzb3VyY2U6IGl0ZW0sDQogICAgICAgICAgICBzb3VyY2VJbmZvOiB7DQogICAgICAgICAgICAgIGluZGV4OiBpdGVtLmluZGV4KCksDQogICAgICAgICAgICAgIGl0ZW1TY29wZTogaXRlbS5pdGVtU2NvcGUsDQogICAgICAgICAgICAgIHNvcnRhYmxlU2NvcGU6IGl0ZW0uc29ydGFibGVTY29wZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG1vdmVUbzogZnVuY3Rpb24gKHBhcmVudCwgaW5kZXgpIHsgLy8gTW92ZSB0aGUgaXRlbSB0byBhIG5ldyBwb3NpdGlvbg0KICAgICAgICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsNCiAgICAgICAgICAgICAgLy9JZiBzb3VyY2UgSXRlbSBpcyBpbiB0aGUgc2FtZSBQYXJlbnQuDQogICAgICAgICAgICAgIGlmICh0aGlzLmlzU2FtZVBhcmVudCgpICYmIHRoaXMuc291cmNlLmluZGV4KCkgPCBpbmRleCkgeyAvLyBhbmQgdGFyZ2V0IGFmdGVyDQogICAgICAgICAgICAgICAgaW5kZXggPSBpbmRleCAtIDE7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdGhpcy5pbmRleCA9IGluZGV4Ow0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGlzU2FtZVBhcmVudDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQuZWxlbWVudCA9PT0gdGhpcy5zb3VyY2VJbmZvLnNvcnRhYmxlU2NvcGUuZWxlbWVudDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBpc09yZGVyQ2hhbmdlZDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbmRleCAhPT0gdGhpcy5zb3VyY2VJbmZvLmluZGV4Ow0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGV2ZW50QXJnczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIHNvdXJjZTogdGhpcy5zb3VyY2VJbmZvLA0KICAgICAgICAgICAgICAgIGRlc3Q6IHsNCiAgICAgICAgICAgICAgICAgIGluZGV4OiB0aGlzLmluZGV4LA0KICAgICAgICAgICAgICAgICAgc29ydGFibGVTY29wZTogdGhpcy5wYXJlbnQNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYXBwbHk6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgdGhpcy5zb3VyY2VJbmZvLnNvcnRhYmxlU2NvcGUucmVtb3ZlSXRlbSh0aGlzLnNvdXJjZUluZm8uaW5kZXgpOyAvLyBSZW1vdmUgZnJvbSBzb3VyY2UuDQogICAgICAgICAgICAgIHRoaXMucGFyZW50Lmluc2VydEl0ZW0odGhpcy5pbmRleCwgdGhpcy5zb3VyY2UubW9kZWxWYWx1ZSk7IC8vIEluc2VydCBpbiB0byBkZXN0aW5hdGlvbi4NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9Ow0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDaGVjayB0aGUgZHJhZyBpcyBub3QgYWxsb3dlZCBmb3IgdGhlIGVsZW1lbnQuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSBlbGVtZW50IC0gdGhlIGVsZW1lbnQgdG8gY2hlY2sNCiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IC0gdHJ1ZSBpZiBkcmFnIGlzIG5vdCBhbGxvd2VkLg0KICAgICAgICAgKi8NCiAgICAgICAgbm9EcmFnOiBmdW5jdGlvbiAoZWxlbWVudCkgew0KICAgICAgICAgIHJldHVybiBlbGVtZW50LmF0dHIoJ25vLWRyYWcnKSAhPT0gdW5kZWZpbmVkIHx8IGVsZW1lbnQuYXR0cignZGF0YS1uby1kcmFnJykgIT09IHVuZGVmaW5lZDsNCiAgICAgICAgfQ0KICAgICAgfTsNCiAgICB9DQogIF0pOw0KDQp9KCkpOw0KICAvKmpzaGludCB1bmRlZjogZmFsc2UsIHVudXNlZDogZmFsc2UsIGluZGVudDogMiovDQovKmdsb2JhbCBhbmd1bGFyOiBmYWxzZSAqLw0KDQooZnVuY3Rpb24gKCkgew0KDQogICd1c2Ugc3RyaWN0JzsNCiAgdmFyIG1haW5Nb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgndWkuc29ydGFibGUnKTsNCg0KICAvKioNCiAgICogQ29udHJvbGxlciBmb3IgU29ydGFibGUuDQogICAqIEBwYXJhbSAkc2NvcGUgLSB0aGUgc29ydGFibGUgc2NvcGUuDQogICAqLw0KICBtYWluTW9kdWxlLmNvbnRyb2xsZXIoJ3VpLnNvcnRhYmxlLnNvcnRhYmxlQ29udHJvbGxlcicsIFsnJHNjb3BlJywgZnVuY3Rpb24gKCRzY29wZSkgew0KDQogICAgdGhpcy5zY29wZSA9ICRzY29wZTsNCg0KICAgICRzY29wZS5tb2RlbFZhbHVlID0gbnVsbDsgLy8gc29ydGFibGUgbGlzdC4NCiAgICAkc2NvcGUuY2FsbGJhY2tzID0gbnVsbDsNCiAgICAkc2NvcGUudHlwZSA9ICdzb3J0YWJsZSc7DQogICAgJHNjb3BlLm9wdGlvbnMgPSB7fTsNCg0KICAgIC8qKg0KICAgICAqIEluc2VydHMgdGhlIGl0ZW0gaW4gdG8gdGhlIHNvcnRhYmxlIGxpc3QuDQogICAgICoNCiAgICAgKiBAcGFyYW0gaW5kZXggLSB0aGUgaXRlbSBpbmRleC4NCiAgICAgKiBAcGFyYW0gaXRlbURhdGEgLSB0aGUgaXRlbSBtb2RlbCBkYXRhLg0KICAgICAqLw0KICAgICRzY29wZS5pbnNlcnRJdGVtID0gZnVuY3Rpb24gKGluZGV4LCBpdGVtRGF0YSkgew0KICAgICAgJHNjb3BlLnNhZmVBcHBseShmdW5jdGlvbiAoKSB7DQogICAgICAgICRzY29wZS5tb2RlbFZhbHVlLnNwbGljZShpbmRleCwgMCwgaXRlbURhdGEpOw0KICAgICAgfSk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFJlbW92ZXMgdGhlIGl0ZW0gZnJvbSB0aGUgc29ydGFibGUgbGlzdC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBpbmRleCAtIGluZGV4IHRvIGJlIHJlbW92ZWQuDQogICAgICogQHJldHVybnMgeyp9IC0gcmVtb3ZlZCBpdGVtLg0KICAgICAqLw0KICAgICRzY29wZS5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKGluZGV4KSB7DQogICAgICB2YXIgcmVtb3ZlZEl0ZW0gPSBudWxsOw0KICAgICAgaWYgKGluZGV4ID4gLTEpIHsNCiAgICAgICAgJHNjb3BlLnNhZmVBcHBseShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgcmVtb3ZlZEl0ZW0gPSAkc2NvcGUubW9kZWxWYWx1ZS5zcGxpY2UoaW5kZXgsIDEpWzBdOw0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICAgIHJldHVybiByZW1vdmVkSXRlbTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIHdoZXRoZXIgdGhlIHNvcnRhYmxlIGxpc3QgaXMgZW1wdHkuDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7bnVsbHwqfCRzY29wZS5tb2RlbFZhbHVlfGJvb2xlYW59DQogICAgICovDQogICAgJHNjb3BlLmlzRW1wdHkgPSBmdW5jdGlvbiAoKSB7DQogICAgICByZXR1cm4gKCRzY29wZS5tb2RlbFZhbHVlICYmICRzY29wZS5tb2RlbFZhbHVlLmxlbmd0aCA9PT0gMCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFdyYXBwZXIgZm9yIHRoZSBhY2NlcHQgY2FsbGJhY2sgZGVsZWdhdGVzIHRvIGNhbGxiYWNrLg0KICAgICAqDQogICAgICogQHBhcmFtIHNvdXJjZUl0ZW1IYW5kbGVTY29wZSAtIGRyYWcgaXRlbSBoYW5kbGUgc2NvcGUuDQogICAgICogQHBhcmFtIGRlc3RTY29wZSAtIHNvcnRhYmxlIHRhcmdldCBzY29wZS4NCiAgICAgKiBAcGFyYW0gZGVzdEl0ZW1TY29wZSAtIHNvcnRhYmxlIGRlc3RpbmF0aW9uIGl0ZW0gc2NvcGUuDQogICAgICogQHJldHVybnMgeyp8Ym9vbGVhbn0gLSB0cnVlIGlmIGRyb3AgaXMgYWxsb3dlZCBmb3IgdGhlIGRyYWcgaXRlbSBpbiBkcm9wIHRhcmdldC4NCiAgICAgKi8NCiAgICAkc2NvcGUuYWNjZXB0ID0gZnVuY3Rpb24gKHNvdXJjZUl0ZW1IYW5kbGVTY29wZSwgZGVzdFNjb3BlLCBkZXN0SXRlbVNjb3BlKSB7DQogICAgICByZXR1cm4gJHNjb3BlLmNhbGxiYWNrcy5hY2NlcHQoc291cmNlSXRlbUhhbmRsZVNjb3BlLCBkZXN0U2NvcGUsIGRlc3RJdGVtU2NvcGUpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgdGhlIGN1cnJlbnQgcGhhc2UgYmVmb3JlIGV4ZWN1dGluZyB0aGUgZnVuY3Rpb24uDQogICAgICoNCiAgICAgKiBAcGFyYW0gZm4gdGhlIGZ1bmN0aW9uIHRvIGV4ZWN1dGUuDQogICAgICovDQogICAgJHNjb3BlLnNhZmVBcHBseSA9IGZ1bmN0aW9uIChmbikgew0KICAgICAgdmFyIHBoYXNlID0gdGhpcy4kcm9vdC4kJHBoYXNlOw0KICAgICAgaWYgKHBoYXNlID09PSAnJGFwcGx5JyB8fCBwaGFzZSA9PT0gJyRkaWdlc3QnKSB7DQogICAgICAgIGlmIChmbiAmJiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSkgew0KICAgICAgICAgIGZuKCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuJGFwcGx5KGZuKTsNCiAgICAgIH0NCiAgICB9Ow0KDQogIH1dKTsNCg0KICAvKioNCiAgICogU29ydGFibGUgZGlyZWN0aXZlIC0gZGVmaW5lcyBjYWxsYmFja3MuDQogICAqIFBhcmVudCBkaXJlY3RpdmUgZm9yIGRyYWdnYWJsZSBhbmQgc29ydGFibGUgaXRlbXMuDQogICAqIFNldHMgbW9kZWxWYWx1ZSwgY2FsbGJhY2tzLCBlbGVtZW50IGluIHNjb3BlLg0KICAgKi8NCiAgbWFpbk1vZHVsZS5kaXJlY3RpdmUoJ2FzU29ydGFibGUnLA0KICAgIGZ1bmN0aW9uICgpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJywgLy8gZ2V0IGEgaG9sZCBvZiBOZ01vZGVsQ29udHJvbGxlcg0KICAgICAgICByZXN0cmljdDogJ0EnLA0KICAgICAgICBzY29wZTogdHJ1ZSwNCiAgICAgICAgY29udHJvbGxlcjogJ3VpLnNvcnRhYmxlLnNvcnRhYmxlQ29udHJvbGxlcicsDQogICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWxDb250cm9sbGVyKSB7DQoNCiAgICAgICAgICB2YXIgbmdNb2RlbCwgY2FsbGJhY2tzOw0KDQogICAgICAgICAgbmdNb2RlbCA9IG5nTW9kZWxDb250cm9sbGVyOw0KDQogICAgICAgICAgaWYgKCFuZ01vZGVsKSB7DQogICAgICAgICAgICByZXR1cm47IC8vIGRvIG5vdGhpbmcgaWYgbm8gbmctbW9kZWwNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBTZXQgdGhlIG1vZGVsIHZhbHVlIGluIHRvIHNjb3BlLg0KICAgICAgICAgIG5nTW9kZWwuJHJlbmRlciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vc2V0IGFuIGVtcHR5IGFycmF5LCBpbiBjYXNlIGlmIG5vbmUgaXMgcHJvdmlkZWQuDQogICAgICAgICAgICBpZiAoIW5nTW9kZWwuJG1vZGVsVmFsdWUgfHwgIWFuZ3VsYXIuaXNBcnJheShuZ01vZGVsLiRtb2RlbFZhbHVlKSkgew0KICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUoW10pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2NvcGUubW9kZWxWYWx1ZSA9IG5nTW9kZWwuJG1vZGVsVmFsdWU7DQogICAgICAgICAgfTsNCiAgICAgICAgICAvL3NldCB0aGUgZWxlbWVudCBpbiBzY29wZSB0byBiZSBhY2Nlc3NlZCBieSBpdHMgc3ViIHNjb3BlLg0KICAgICAgICAgIHNjb3BlLmVsZW1lbnQgPSBlbGVtZW50Ow0KDQogICAgICAgICAgY2FsbGJhY2tzID0ge2FjY2VwdDogbnVsbCwgb3JkZXJDaGFuZ2VkOiBudWxsLCBpdGVtTW92ZWQ6IG51bGwsIGRyYWdTdGFydDogbnVsbCwgZHJhZ0NhbmNlbDogbnVsbCwgZHJhZ0VuZDogbnVsbH07DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBJbnZva2VkIHRvIGRlY2lkZSB3aGV0aGVyIHRvIGFsbG93IGRyb3AuDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBAcGFyYW0gc291cmNlSXRlbUhhbmRsZVNjb3BlIC0gdGhlIGRyYWcgaXRlbSBoYW5kbGUgc2NvcGUuDQogICAgICAgICAgICogQHBhcmFtIGRlc3RTb3J0YWJsZVNjb3BlIC0gdGhlIGRyb3AgdGFyZ2V0IHNvcnRhYmxlIHNjb3BlLg0KICAgICAgICAgICAqIEBwYXJhbSBkZXN0SXRlbVNjb3BlIC0gdGhlIGRyb3AgdGFyZ2V0IGl0ZW0gc2NvcGUuDQogICAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IC0gdHJ1ZSBpZiBhbGxvd2VkIGZvciBkcm9wLg0KICAgICAgICAgICAqLw0KICAgICAgICAgIGNhbGxiYWNrcy5hY2NlcHQgPSBmdW5jdGlvbiAoc291cmNlSXRlbUhhbmRsZVNjb3BlLCBkZXN0U29ydGFibGVTY29wZSwgZGVzdEl0ZW1TY29wZSkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgfTsNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEludm9rZWQgd2hlbiBvcmRlciBvZiBhIGRyYWcgaXRlbSBpcyBjaGFuZ2VkLg0KICAgICAgICAgICAqDQogICAgICAgICAgICogQHBhcmFtIGV2ZW50IC0gdGhlIGV2ZW50IG9iamVjdC4NCiAgICAgICAgICAgKi8NCiAgICAgICAgICBjYWxsYmFja3Mub3JkZXJDaGFuZ2VkID0gZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgfTsNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEludm9rZWQgd2hlbiB0aGUgaXRlbSBpcyBtb3ZlZCB0byBvdGhlciBzb3J0YWJsZS4NCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIEBwYXJhbSBldmVudCAtIHRoZSBldmVudCBvYmplY3QuDQogICAgICAgICAgICovDQogICAgICAgICAgY2FsbGJhY2tzLml0ZW1Nb3ZlZCA9IGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgIH07DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBJbnZva2VkIHdoZW4gdGhlIGRyYWcgc3RhcnRlZCBzdWNjZXNzZnVsbHkuDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBAcGFyYW0gZXZlbnQgLSB0aGUgZXZlbnQgb2JqZWN0Lg0KICAgICAgICAgICAqLw0KICAgICAgICAgIGNhbGxiYWNrcy5kcmFnU3RhcnQgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogSW52b2tlZCB3aGVuIHRoZSBkcmFnIGNhbmNlbGxlZC4NCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIEBwYXJhbSBldmVudCAtIHRoZSBldmVudCBvYmplY3QuDQogICAgICAgICAgICovDQogICAgICAgICAgY2FsbGJhY2tzLmRyYWdDYW5jZWwgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogSW52b2tlZCB3aGVuIHRoZSBkcmFnIHN0b3BwZWQuDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBAcGFyYW0gZXZlbnQgLSB0aGUgZXZlbnQgb2JqZWN0Lg0KICAgICAgICAgICAqLw0KICAgICAgICAgIGNhbGxiYWNrcy5kcmFnRW5kID0gZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgfTsNCg0KICAgICAgICAgIC8vU2V0IHRoZSBzb3J0T3B0aW9ucyBjYWxsYmFja3MgZWxzZSBzZXQgaXQgdG8gZGVmYXVsdC4NCiAgICAgICAgICBzY29wZS4kd2F0Y2goYXR0cnMuYXNTb3J0YWJsZSwgZnVuY3Rpb24gKG5ld1ZhbCwgb2xkVmFsKSB7DQogICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gobmV3VmFsLCBmdW5jdGlvbiAodmFsdWUsIGtleSkgew0KICAgICAgICAgICAgICBpZiAoY2FsbGJhY2tzW2tleV0pIHsNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgICBjYWxsYmFja3Nba2V5XSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBzY29wZS5vcHRpb25zW2tleV0gPSB2YWx1ZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBzY29wZS5jYWxsYmFja3MgPSBjYWxsYmFja3M7DQogICAgICAgICAgfSwgdHJ1ZSk7DQoNCiAgICAgICAgICAvLyBTZXQgaXNFbmFibGVkIGlmIGF0dHIgaXMgc2V0LCBpZiB1bmRlZmluZWQgaXNFbmFibGVkID0gdHJ1ZQ0KICAgICAgICAgIHNjb3BlLiR3YXRjaChhdHRycy5pc0VuYWJsZWQsIGZ1bmN0aW9uIChuZXdWYWwsIG9sZFZhbCkgew0KICAgICAgICAgICAgc2NvcGUuaXNFbmFibGVkID0gbmV3VmFsICE9PSB1bmRlZmluZWQgPyBuZXdWYWwgOiB0cnVlOw0KICAgICAgICAgIH0sIHRydWUpOw0KICAgICAgICB9DQogICAgICB9Ow0KICAgIH0pOw0KDQp9KCkpOw0KDQovKmpzaGludCBpbmRlbnQ6IDIgKi8NCi8qZ2xvYmFsIGFuZ3VsYXI6IGZhbHNlICovDQoNCihmdW5jdGlvbiAoKSB7DQoNCiAgJ3VzZSBzdHJpY3QnOw0KICB2YXIgbWFpbk1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCd1aS5zb3J0YWJsZScpOw0KDQogIC8qKg0KICAgKiBDb250cm9sbGVyIGZvciBzb3J0YWJsZUl0ZW1IYW5kbGUNCiAgICoNCiAgICogQHBhcmFtICRzY29wZSAtIGl0ZW0gaGFuZGxlIHNjb3BlLg0KICAgKi8NCiAgbWFpbk1vZHVsZS5jb250cm9sbGVyKCd1aS5zb3J0YWJsZS5zb3J0YWJsZUl0ZW1IYW5kbGVDb250cm9sbGVyJywgWyckc2NvcGUnLCBmdW5jdGlvbiAoJHNjb3BlKSB7DQoNCiAgICB0aGlzLnNjb3BlID0gJHNjb3BlOw0KDQogICAgJHNjb3BlLml0ZW1TY29wZSA9IG51bGw7DQogICAgJHNjb3BlLnR5cGUgPSAnaGFuZGxlJzsNCiAgfV0pOw0KDQogIC8qKg0KICAgKiBEaXJlY3RpdmUgZm9yIHNvcnRhYmxlIGl0ZW0gaGFuZGxlLg0KICAgKi8NCiAgbWFpbk1vZHVsZS5kaXJlY3RpdmUoJ2FzU29ydGFibGVJdGVtSGFuZGxlJywgWydzb3J0YWJsZUNvbmZpZycsICckaGVscGVyJywgJyR3aW5kb3cnLCAnJGRvY3VtZW50JywNCiAgICBmdW5jdGlvbiAoc29ydGFibGVDb25maWcsICRoZWxwZXIsICR3aW5kb3csICRkb2N1bWVudCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgcmVxdWlyZTogJ15hc1NvcnRhYmxlSXRlbScsDQogICAgICAgIHNjb3BlOiB0cnVlLA0KICAgICAgICByZXN0cmljdDogJ0EnLA0KICAgICAgICBjb250cm9sbGVyOiAndWkuc29ydGFibGUuc29ydGFibGVJdGVtSGFuZGxlQ29udHJvbGxlcicsDQogICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGl0ZW1Db250cm9sbGVyKSB7DQoNCiAgICAgICAgICB2YXIgZHJhZ0VsZW1lbnQsIC8vZHJhZyBpdGVtIGVsZW1lbnQuDQogICAgICAgICAgICBwbGFjZUhvbGRlciwgLy9wbGFjZSBob2xkZXIgY2xhc3MgZWxlbWVudC4NCiAgICAgICAgICAgIHBsYWNlRWxlbWVudCwvL2hpZGRlbiBwbGFjZSBlbGVtZW50Lg0KICAgICAgICAgICAgaXRlbVBvc2l0aW9uLCAvL2RyYWcgaXRlbSBlbGVtZW50IHBvc2l0aW9uLg0KICAgICAgICAgICAgZHJhZ0l0ZW1JbmZvLCAvL2RyYWcgaXRlbSBkYXRhLg0KICAgICAgICAgICAgY29udGFpbm1lbnQsLy90aGUgZHJhZyBjb250YWluZXIuDQogICAgICAgICAgICBkcmFnTGlzdGVuLC8vIGRyYWcgbGlzdGVuIGV2ZW50Lg0KICAgICAgICAgICAgc2Nyb2xsYWJsZUNvbnRhaW5lciwgLy90aGUgc2Nyb2xsYWJsZSBjb250YWluZXINCiAgICAgICAgICAgIGRyYWdTdGFydCwvLyBkcmFnIHN0YXJ0IGV2ZW50Lg0KICAgICAgICAgICAgZHJhZ01vdmUsLy9kcmFnIG1vdmUgZXZlbnQuDQogICAgICAgICAgICBkcmFnRW5kLC8vZHJhZyBlbmQgZXZlbnQuDQogICAgICAgICAgICBkcmFnQ2FuY2VsLC8vZHJhZyBjYW5jZWwgZXZlbnQuDQogICAgICAgICAgICBpc0RyYWdnYWJsZSwvL2lzIGVsZW1lbnQgZHJhZ2dhYmxlLg0KICAgICAgICAgICAgaXNEcmFnQmVmb3JlLC8vaXMgZWxlbWVudCBtb3ZlZCB1cCBkaXJlY3Rpb24uDQogICAgICAgICAgICBpc1BsYWNlSG9sZGVyUHJlc2VudCwvL2lzIHBsYWNlaG9sZGVyIHByZXNlbnQuDQogICAgICAgICAgICBiaW5kRHJhZywvL2JpbmQgZHJhZyBldmVudHMuDQogICAgICAgICAgICB1bmJpbmREcmFnLC8vdW5iaW5kIGRyYWcgZXZlbnRzLg0KICAgICAgICAgICAgYmluZEV2ZW50cywvL2JpbmQgdGhlIGRyYWcgZXZlbnRzLg0KICAgICAgICAgICAgdW5CaW5kRXZlbnRzLC8vdW5iaW5kIHRoZSBkcmFnIGV2ZW50cy4NCiAgICAgICAgICAgIGhhc1RvdWNoLC8vIGhhcyB0b3VjaCBzdXBwb3J0Lg0KICAgICAgICAgICAgZHJhZ0hhbmRsZWQsIC8vZHJhZyBoYW5kbGVkLg0KICAgICAgICAgICAgaXNFbmFibGVkID0gdHJ1ZTsgLy9zb3J0YWJsZSBpcyBlbmFibGVkDQoNCiAgICAgICAgICBoYXNUb3VjaCA9ICR3aW5kb3cuaGFzT3duUHJvcGVydHkoJ29udG91Y2hzdGFydCcpOw0KDQogICAgICAgICAgaWYgKHNvcnRhYmxlQ29uZmlnLmhhbmRsZUNsYXNzKSB7DQogICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKHNvcnRhYmxlQ29uZmlnLmhhbmRsZUNsYXNzKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBzY29wZS5pdGVtU2NvcGUgPSBpdGVtQ29udHJvbGxlci5zY29wZTsNCg0KICAgICAgICAgIHNjb3BlLiR3YXRjaCgnc29ydGFibGVTY29wZS5pc0VuYWJsZWQnLCBmdW5jdGlvbihuZXdWYWwpIHsNCiAgICAgICAgICAgIGlmIChpc0VuYWJsZWQgIT09IG5ld1ZhbCkgew0KICAgICAgICAgICAgICBpc0VuYWJsZWQgPSBuZXdWYWw7DQoNCiAgICAgICAgICAgICAgaWYgKGlzRW5hYmxlZCkgew0KICAgICAgICAgICAgICAgIGJpbmREcmFnKCk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdW5iaW5kRHJhZygpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQoNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICogTGlzdGVucyBmb3IgYSAxMHB4IG1vdmVtZW50IGJlZm9yZQ0KICAgICAgICAgICogZHJhZ1N0YXJ0IGlzIGNhbGxlZCB0byBhbGxvdyBmb3INCiAgICAgICAgICAqIGEgY2xpY2sgZXZlbnQgb24gdGhlIGVsZW1lbnQuDQogICAgICAgICAgKg0KICAgICAgICAgICogQHBhcmFtIGV2ZW50IC0gdGhlIGV2ZW50IG9iamVjdC4NCiAgICAgICAgICAqLw0KICAgICAgICAgIGRyYWdMaXN0ZW4gPSBmdW5jdGlvbiAoZXZlbnQpIHsNCg0KICAgICAgICAgICAgdmFyIHVuYmluZE1vdmVMaXN0ZW4gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnQpLnVuYmluZCgnbW91c2Vtb3ZlJywgbW92ZUxpc3Rlbik7DQogICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnQpLnVuYmluZCgndG91Y2htb3ZlJywgbW92ZUxpc3Rlbik7DQogICAgICAgICAgICAgIGVsZW1lbnQudW5iaW5kKCdtb3VzZXVwJywgdW5iaW5kTW92ZUxpc3Rlbik7DQogICAgICAgICAgICAgIGVsZW1lbnQudW5iaW5kKCd0b3VjaGVuZCcsIHVuYmluZE1vdmVMaXN0ZW4pOw0KICAgICAgICAgICAgICBlbGVtZW50LnVuYmluZCgndG91Y2hjYW5jZWwnLCB1bmJpbmRNb3ZlTGlzdGVuKTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIHZhciBzdGFydFBvc2l0aW9uOw0KICAgICAgICAgICAgdmFyIG1vdmVMaXN0ZW4gPSBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgIHZhciBldmVudE9iaiA9ICRoZWxwZXIuZXZlbnRPYmooZSk7DQogICAgICAgICAgICAgIGlmICghc3RhcnRQb3NpdGlvbikgew0KICAgICAgICAgICAgICAgIHN0YXJ0UG9zaXRpb24gPSB7IGNsaWVudFg6IGV2ZW50T2JqLmNsaWVudFgsIGNsaWVudFk6IGV2ZW50T2JqLmNsaWVudFkgfTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoZXZlbnRPYmouY2xpZW50WCAtIHN0YXJ0UG9zaXRpb24uY2xpZW50WCkgKyBNYXRoLmFicyhldmVudE9iai5jbGllbnRZIC0gc3RhcnRQb3NpdGlvbi5jbGllbnRZKSA+IDEwKSB7DQogICAgICAgICAgICAgICAgdW5iaW5kTW92ZUxpc3RlbigpOw0KICAgICAgICAgICAgICAgIGRyYWdTdGFydChldmVudCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnQpLmJpbmQoJ21vdXNlbW92ZScsIG1vdmVMaXN0ZW4pOw0KICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudCkuYmluZCgndG91Y2htb3ZlJywgbW92ZUxpc3Rlbik7DQogICAgICAgICAgICBlbGVtZW50LmJpbmQoJ21vdXNldXAnLCB1bmJpbmRNb3ZlTGlzdGVuKTsNCiAgICAgICAgICAgIGVsZW1lbnQuYmluZCgndG91Y2hlbmQnLCB1bmJpbmRNb3ZlTGlzdGVuKTsNCiAgICAgICAgICAgIGVsZW1lbnQuYmluZCgndG91Y2hjYW5jZWwnLCB1bmJpbmRNb3ZlTGlzdGVuKTsNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogVHJpZ2dlcmVkIHdoZW4gZHJhZyBldmVudCBzdGFydHMuDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBAcGFyYW0gZXZlbnQgdGhlIGV2ZW50IG9iamVjdC4NCiAgICAgICAgICAgKi8NCiAgICAgICAgICBkcmFnU3RhcnQgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCg0KICAgICAgICAgICAgdmFyIGV2ZW50T2JqLCB0YWdOYW1lOw0KDQogICAgICAgICAgICBpZiAoIWhhc1RvdWNoICYmIChldmVudC5idXR0b24gPT09IDIgfHwgZXZlbnQud2hpY2ggPT09IDMpKSB7DQogICAgICAgICAgICAgIC8vIGRpc2FibGUgcmlnaHQgY2xpY2sNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGhhc1RvdWNoICYmICRoZWxwZXIuaXNUb3VjaEludmFsaWQoZXZlbnQpKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkcmFnSGFuZGxlZCB8fCAhaXNEcmFnZ2FibGUoZXZlbnQpKSB7DQogICAgICAgICAgICAgIC8vIGV2ZW50IGhhcyBhbHJlYWR5IGZpcmVkIGluIG90aGVyIHNjb3BlLg0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBTZXQgdGhlIGZsYWcgdG8gcHJldmVudCBvdGhlciBpdGVtcyBmcm9tIGluaGVyaXRpbmcgdGhlIGRyYWcgZXZlbnQNCiAgICAgICAgICAgIGRyYWdIYW5kbGVkID0gdHJ1ZTsNCiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBldmVudE9iaiA9ICRoZWxwZXIuZXZlbnRPYmooZXZlbnQpOw0KDQogICAgICAgICAgICAvLyAob3B0aW9uYWwpIFNjcm9sbGFibGUgY29udGFpbmVyIGFzIHJlZmVyZW5jZSBmb3IgdG9wICYgbGVmdCBvZmZzZXQgY2FsY3VsYXRpb25zLCBkZWZhdWx0cyB0byBEb2N1bWVudA0KICAgICAgICAgICAgc2Nyb2xsYWJsZUNvbnRhaW5lciA9IGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnRbMF0ucXVlcnlTZWxlY3RvcihzY29wZS5zb3J0YWJsZVNjb3BlLm9wdGlvbnMuc2Nyb2xsYWJsZUNvbnRhaW5lcikpLmxlbmd0aCA+IDAgPw0KICAgICAgICAgICAgICAkZG9jdW1lbnRbMF0ucXVlcnlTZWxlY3RvcihzY29wZS5zb3J0YWJsZVNjb3BlLm9wdGlvbnMuc2Nyb2xsYWJsZUNvbnRhaW5lcikgOiAkZG9jdW1lbnRbMF0uZG9jdW1lbnRFbGVtZW50Ow0KDQogICAgICAgICAgICBjb250YWlubWVudCA9IGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnRbMF0ucXVlcnlTZWxlY3RvcihzY29wZS5zb3J0YWJsZVNjb3BlLm9wdGlvbnMuY29udGFpbm1lbnQpKS5sZW5ndGggPiAwID8NCiAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudFswXS5xdWVyeVNlbGVjdG9yKHNjb3BlLnNvcnRhYmxlU2NvcGUub3B0aW9ucy5jb250YWlubWVudCkpIDogYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudFswXS5ib2R5KTsNCiAgICAgICAgICAgIC8vY2FwdHVyZSBtb3VzZSBtb3ZlIG9uIGNvbnRhaW5tZW50Lg0KICAgICAgICAgICAgY29udGFpbm1lbnQuY3NzKCdjdXJzb3InLCAnbW92ZScpOw0KDQogICAgICAgICAgICBkcmFnSXRlbUluZm8gPSAkaGVscGVyLmRyYWdJdGVtKHNjb3BlKTsNCiAgICAgICAgICAgIHRhZ05hbWUgPSBzY29wZS5pdGVtU2NvcGUuZWxlbWVudC5wcm9wKCd0YWdOYW1lJyk7DQoNCiAgICAgICAgICAgIGRyYWdFbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudFswXS5jcmVhdGVFbGVtZW50KHNjb3BlLnNvcnRhYmxlU2NvcGUuZWxlbWVudC5wcm9wKCd0YWdOYW1lJykpKQ0KICAgICAgICAgICAgICAuYWRkQ2xhc3Moc2NvcGUuc29ydGFibGVTY29wZS5lbGVtZW50LmF0dHIoJ2NsYXNzJykpLmFkZENsYXNzKHNvcnRhYmxlQ29uZmlnLmRyYWdDbGFzcyk7DQogICAgICAgICAgICBkcmFnRWxlbWVudC5jc3MoJ3dpZHRoJywgJGhlbHBlci53aWR0aChzY29wZS5pdGVtU2NvcGUuZWxlbWVudCkgKyAncHgnKTsNCiAgICAgICAgICAgIGRyYWdFbGVtZW50LmNzcygnaGVpZ2h0JywgJGhlbHBlci5oZWlnaHQoc2NvcGUuaXRlbVNjb3BlLmVsZW1lbnQpICsgJ3B4Jyk7DQoNCiAgICAgICAgICAgIHBsYWNlSG9sZGVyID0gYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudFswXS5jcmVhdGVFbGVtZW50KHRhZ05hbWUpKS5hZGRDbGFzcyhzb3J0YWJsZUNvbmZpZy5wbGFjZUhvbGRlckNsYXNzKTsNCiAgICAgICAgICAgIHBsYWNlSG9sZGVyLmNzcygnd2lkdGgnLCAkaGVscGVyLndpZHRoKHNjb3BlLml0ZW1TY29wZS5lbGVtZW50KSArICdweCcpOw0KICAgICAgICAgICAgcGxhY2VIb2xkZXIuY3NzKCdoZWlnaHQnLCAkaGVscGVyLmhlaWdodChzY29wZS5pdGVtU2NvcGUuZWxlbWVudCkgKyAncHgnKTsNCg0KICAgICAgICAgICAgaWYgKHNjb3BlLnNvcnRhYmxlU2NvcGUub3B0aW9ucy5nZXRQbGFjZWhvbGRlclRleHQpIHsgLy8gYWRkZWQgYnkgZGJhbG1lckBhY2NlbGEuY29tDQogICAgICAgICAgICAgIHBsYWNlSG9sZGVyLnRleHQoc2NvcGUuc29ydGFibGVTY29wZS5vcHRpb25zLmdldFBsYWNlaG9sZGVyVGV4dChzY29wZS5pdGVtU2NvcGUuZWxlbWVudCkpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwbGFjZUVsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoJGRvY3VtZW50WzBdLmNyZWF0ZUVsZW1lbnQodGFnTmFtZSkpOw0KICAgICAgICAgICAgaWYgKHNvcnRhYmxlQ29uZmlnLmhpZGRlbkNsYXNzKSB7DQogICAgICAgICAgICAgIHBsYWNlRWxlbWVudC5hZGRDbGFzcyhzb3J0YWJsZUNvbmZpZy5oaWRkZW5DbGFzcyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGl0ZW1Qb3NpdGlvbiA9ICRoZWxwZXIucG9zaXRpb25TdGFydGVkKGV2ZW50T2JqLCBzY29wZS5pdGVtU2NvcGUuZWxlbWVudCwgc2Nyb2xsYWJsZUNvbnRhaW5lcik7DQogICAgICAgICAgICAvL2ZpbGwgdGhlIGltbWVkaWF0ZSB2YWN1dW0uDQogICAgICAgICAgICBzY29wZS5pdGVtU2NvcGUuZWxlbWVudC5hZnRlcihwbGFjZUhvbGRlcik7DQogICAgICAgICAgICAvL2hpZGRlbiBwbGFjZSBlbGVtZW50IGluIG9yaWdpbmFsIHBvc2l0aW9uLg0KICAgICAgICAgICAgc2NvcGUuaXRlbVNjb3BlLmVsZW1lbnQuYWZ0ZXIocGxhY2VFbGVtZW50KTsNCiAgICAgICAgICAgIGRyYWdFbGVtZW50LmFwcGVuZChzY29wZS5pdGVtU2NvcGUuZWxlbWVudCk7DQoNCiAgICAgICAgICAgIGNvbnRhaW5tZW50LmFwcGVuZChkcmFnRWxlbWVudCk7DQogICAgICAgICAgICAkaGVscGVyLm1vdmVQb3NpdGlvbihldmVudE9iaiwgZHJhZ0VsZW1lbnQsIGl0ZW1Qb3NpdGlvbiwgY29udGFpbm1lbnQsIHNjcm9sbGFibGVDb250YWluZXIpOw0KDQogICAgICAgICAgICBzY29wZS5zb3J0YWJsZVNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIHNjb3BlLmNhbGxiYWNrcy5kcmFnU3RhcnQoZHJhZ0l0ZW1JbmZvLmV2ZW50QXJncygpKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgYmluZEV2ZW50cygpOw0KICAgICAgICAgIH07DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBBbGxvdyBEcmFnIGlmIGl0IGlzIGEgcHJvcGVyIGl0ZW0taGFuZGxlIGVsZW1lbnQuDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBAcGFyYW0gZXZlbnQgLSB0aGUgZXZlbnQgb2JqZWN0Lg0KICAgICAgICAgICAqIEByZXR1cm4gYm9vbGVhbiAtIHRydWUgaWYgZWxlbWVudCBpcyBkcmFnZ2FibGUuDQogICAgICAgICAgICovDQogICAgICAgICAgaXNEcmFnZ2FibGUgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCg0KICAgICAgICAgICAgdmFyIGVsZW1lbnRDbGlja2VkLCBzb3VyY2VTY29wZSwgaXNEcmFnZ2FibGU7DQoNCiAgICAgICAgICAgIGVsZW1lbnRDbGlja2VkID0gYW5ndWxhci5lbGVtZW50KGV2ZW50LnRhcmdldCk7DQogICAgICAgICAgICBzb3VyY2VTY29wZSA9IGVsZW1lbnRDbGlja2VkLnNjb3BlKCk7DQogICAgICAgICAgICBpc0RyYWdnYWJsZSA9IHRydWU7DQogICAgICAgICAgICBpZiAoIXNvdXJjZVNjb3BlIHx8ICFzb3VyY2VTY29wZS50eXBlIHx8IHNvdXJjZVNjb3BlLnR5cGUgIT09ICdoYW5kbGUnKSB7DQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vSWYgYSAnbm8tZHJhZycgZWxlbWVudCBpbnNpZGUgaXRlbS1oYW5kbGUgaWYgYW55Lg0KICAgICAgICAgICAgd2hpbGUgKGlzRHJhZ2dhYmxlICYmIGVsZW1lbnRDbGlja2VkWzBdICE9PSBlbGVtZW50WzBdKSB7DQogICAgICAgICAgICAgIGlmICgkaGVscGVyLm5vRHJhZyhlbGVtZW50Q2xpY2tlZCkpIHsNCiAgICAgICAgICAgICAgICBpc0RyYWdnYWJsZSA9IGZhbHNlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGVsZW1lbnRDbGlja2VkID0gZWxlbWVudENsaWNrZWQucGFyZW50KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gaXNEcmFnZ2FibGU7DQogICAgICAgICAgfTsNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEluc2VydHMgdGhlIHBsYWNlSG9sZGVyIGluIHRvIHRoZSB0YXJnZXRTY29wZS4NCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIEBwYXJhbSB0YXJnZXRFbGVtZW50IHRoZSB0YXJnZXQgZWxlbWVudA0KICAgICAgICAgICAqIEBwYXJhbSB0YXJnZXRTY29wZSB0aGUgdGFyZ2V0IHNjb3BlDQogICAgICAgICAgICovDQogICAgICAgICAgZnVuY3Rpb24gaW5zZXJ0QmVmb3JlKHRhcmdldEVsZW1lbnQsIHRhcmdldFNjb3BlKSB7DQogICAgICAgICAgICB0YXJnZXRFbGVtZW50WzBdLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHBsYWNlSG9sZGVyWzBdLCB0YXJnZXRFbGVtZW50WzBdKTsNCiAgICAgICAgICAgIGRyYWdJdGVtSW5mby5tb3ZlVG8odGFyZ2V0U2NvcGUuc29ydGFibGVTY29wZSwgdGFyZ2V0U2NvcGUuaW5kZXgoKSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogSW5zZXJ0cyB0aGUgcGxhY2VIb2xkZXIgbmV4dCB0byB0aGUgdGFyZ2V0U2NvcGUuDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBAcGFyYW0gdGFyZ2V0RWxlbWVudCB0aGUgdGFyZ2V0IGVsZW1lbnQNCiAgICAgICAgICAgKiBAcGFyYW0gdGFyZ2V0U2NvcGUgdGhlIHRhcmdldCBzY29wZQ0KICAgICAgICAgICAqLw0KICAgICAgICAgIGZ1bmN0aW9uIGluc2VydEFmdGVyKHRhcmdldEVsZW1lbnQsIHRhcmdldFNjb3BlKSB7DQogICAgICAgICAgICB0YXJnZXRFbGVtZW50LmFmdGVyKHBsYWNlSG9sZGVyKTsNCiAgICAgICAgICAgIGRyYWdJdGVtSW5mby5tb3ZlVG8odGFyZ2V0U2NvcGUuc29ydGFibGVTY29wZSwgdGFyZ2V0U2NvcGUuaW5kZXgoKSArIDEpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIFRyaWdnZXJlZCB3aGVuIGRyYWcgaXMgbW92aW5nLg0KICAgICAgICAgICAqDQogICAgICAgICAgICogQHBhcmFtIGV2ZW50IC0gdGhlIGV2ZW50IG9iamVjdC4NCiAgICAgICAgICAgKi8NCiAgICAgICAgICBkcmFnTW92ZSA9IGZ1bmN0aW9uIChldmVudCkgew0KDQogICAgICAgICAgICB2YXIgZXZlbnRPYmosIHRhcmdldFgsIHRhcmdldFksIHRhcmdldFNjb3BlLCB0YXJnZXRFbGVtZW50Ow0KDQogICAgICAgICAgICBpZiAoaGFzVG91Y2ggJiYgJGhlbHBlci5pc1RvdWNoSW52YWxpZChldmVudCkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gSWdub3JlIGV2ZW50IGlmIG5vdCBoYW5kbGVkDQogICAgICAgICAgICBpZiAoIWRyYWdIYW5kbGVkKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkcmFnRWxlbWVudCkgew0KDQogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoNCiAgICAgICAgICAgICAgZXZlbnRPYmogPSAkaGVscGVyLmV2ZW50T2JqKGV2ZW50KTsNCiAgICAgICAgICAgICAgJGhlbHBlci5tb3ZlUG9zaXRpb24oZXZlbnRPYmosIGRyYWdFbGVtZW50LCBpdGVtUG9zaXRpb24sIGNvbnRhaW5tZW50LCBzY3JvbGxhYmxlQ29udGFpbmVyKTsNCg0KICAgICAgICAgICAgICB0YXJnZXRYID0gZXZlbnRPYmoucGFnZVggLSAkZG9jdW1lbnRbMF0uZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQ7DQogICAgICAgICAgICAgIHRhcmdldFkgPSBldmVudE9iai5wYWdlWSAtICgkd2luZG93LnBhZ2VZT2Zmc2V0IHx8ICRkb2N1bWVudFswXS5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wKTsNCg0KICAgICAgICAgICAgICAvL0lFIGZpeGVzOiBoaWRlIHNob3cgZWxlbWVudCwgY2FsbCBlbGVtZW50IGZyb20gcG9pbnQgdHdpY2UgdG8gcmV0dXJuIHBpY2sgY29ycmVjdCBlbGVtZW50Lg0KICAgICAgICAgICAgICBkcmFnRWxlbWVudC5hZGRDbGFzcyhzb3J0YWJsZUNvbmZpZy5oaWRkZW5DbGFzcyk7DQogICAgICAgICAgICAgICRkb2N1bWVudFswXS5lbGVtZW50RnJvbVBvaW50KHRhcmdldFgsIHRhcmdldFkpOw0KICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudFswXS5lbGVtZW50RnJvbVBvaW50KHRhcmdldFgsIHRhcmdldFkpKTsNCiAgICAgICAgICAgICAgZHJhZ0VsZW1lbnQucmVtb3ZlQ2xhc3Moc29ydGFibGVDb25maWcuaGlkZGVuQ2xhc3MpOw0KDQogICAgICAgICAgICAgIHRhcmdldFNjb3BlID0gdGFyZ2V0RWxlbWVudC5zY29wZSgpOw0KDQogICAgICAgICAgICAgIGlmICghdGFyZ2V0U2NvcGUgfHwgIXRhcmdldFNjb3BlLnR5cGUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHRhcmdldFNjb3BlLnR5cGUgPT09ICdoYW5kbGUnKSB7DQogICAgICAgICAgICAgICAgdGFyZ2V0U2NvcGUgPSB0YXJnZXRTY29wZS5pdGVtU2NvcGU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHRhcmdldFNjb3BlLnR5cGUgIT09ICdpdGVtJyAmJiB0YXJnZXRTY29wZS50eXBlICE9PSAnc29ydGFibGUnKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgaWYgKHRhcmdldFNjb3BlLnR5cGUgPT09ICdpdGVtJykgew0KICAgICAgICAgICAgICAgIHRhcmdldEVsZW1lbnQgPSB0YXJnZXRTY29wZS5lbGVtZW50Ow0KICAgICAgICAgICAgICAgIGlmICh0YXJnZXRTY29wZS5zb3J0YWJsZVNjb3BlLmFjY2VwdChzY29wZSwgdGFyZ2V0U2NvcGUuc29ydGFibGVTY29wZSwgdGFyZ2V0U2NvcGUpKSB7DQogICAgICAgICAgICAgICAgICBpZiAoaXRlbVBvc2l0aW9uLmRpckF4ICYmIC8vbW92ZSBob3Jpem9udGFsDQogICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1TY29wZS5zb3J0YWJsZVNjb3BlLiRpZCA9PT0gdGFyZ2V0U2NvcGUuc29ydGFibGVTY29wZS4kaWQpIHsgLy9tb3ZlIHNhbWUgY29sdW1uDQogICAgICAgICAgICAgICAgICAgIGl0ZW1Qb3NpdGlvbi5kaXN0QXhYID0gMDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1Qb3NpdGlvbi5kaXN0WCA8IDApIHsvL21vdmUgbGVmdA0KICAgICAgICAgICAgICAgICAgICAgIGluc2VydEJlZm9yZSh0YXJnZXRFbGVtZW50LCB0YXJnZXRTY29wZSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbVBvc2l0aW9uLmRpc3RYID4gMCkgey8vbW92ZSByaWdodA0KICAgICAgICAgICAgICAgICAgICAgIGluc2VydEFmdGVyKHRhcmdldEVsZW1lbnQsIHRhcmdldFNjb3BlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy9tb3ZlIHZlcnRpY2FsDQogICAgICAgICAgICAgICAgICAgIGlmIChpc0RyYWdCZWZvcmUoZXZlbnRPYmosIHRhcmdldEVsZW1lbnQpKSB7Ly9tb3ZlIHVwDQogICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0QmVmb3JlKHRhcmdldEVsZW1lbnQsIHRhcmdldFNjb3BlKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsvL21vdmUgYm90dG9tDQogICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0QWZ0ZXIodGFyZ2V0RWxlbWVudCwgdGFyZ2V0U2NvcGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmICh0YXJnZXRTY29wZS50eXBlID09PSAnc29ydGFibGUnKSB7Ly9zb3J0YWJsZSBzY29wZS4NCiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0U2NvcGUuYWNjZXB0KHNjb3BlLCB0YXJnZXRTY29wZSkgJiYNCiAgICAgICAgICAgICAgICAgIHRhcmdldEVsZW1lbnRbMF0ucGFyZW50Tm9kZSAhPT0gdGFyZ2V0U2NvcGUuZWxlbWVudFswXSkgew0KICAgICAgICAgICAgICAgICAgLy9tb3Zpbmcgb3ZlciBzb3J0YWJsZSBidWNrZXQuIG5vdCBvdmVyIGl0ZW0uDQogICAgICAgICAgICAgICAgICBpZiAoIWlzUGxhY2VIb2xkZXJQcmVzZW50KHRhcmdldEVsZW1lbnQpKSB7DQogICAgICAgICAgICAgICAgICAgIC8vYXBwZW5kIHRvIGJvdHRvbS4NCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudFswXS5hcHBlbmRDaGlsZChwbGFjZUhvbGRlclswXSk7DQogICAgICAgICAgICAgICAgICAgIGRyYWdJdGVtSW5mby5tb3ZlVG8odGFyZ2V0U2NvcGUsIHRhcmdldFNjb3BlLm1vZGVsVmFsdWUubGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQ2hlY2sgdGhlcmUgaXMgbm8gcGxhY2UgaG9sZGVyIHBsYWNlZCBieSBpdGVtU2NvcGUuDQogICAgICAgICAgICogQHBhcmFtIHRhcmdldEVsZW1lbnQgdGhlIHRhcmdldCBlbGVtZW50IHRvIGNoZWNrIHdpdGguDQogICAgICAgICAgICogQHJldHVybnMgeyp9IHRydWUgaWYgcGxhY2UgaG9sZGVyIHByZXNlbnQuDQogICAgICAgICAgICovDQogICAgICAgICAgaXNQbGFjZUhvbGRlclByZXNlbnQgPSBmdW5jdGlvbiAodGFyZ2V0RWxlbWVudCkgew0KICAgICAgICAgICAgdmFyIGl0ZW1FbGVtZW50cywgaGFzUGxhY2VIb2xkZXIsIGk7DQoNCiAgICAgICAgICAgIGl0ZW1FbGVtZW50cyA9IHRhcmdldEVsZW1lbnQuY2hpbGRyZW4oKTsNCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpdGVtRWxlbWVudHMubGVuZ3RoOyBpICs9IDEpIHsNCiAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZWxlbWVudChpdGVtRWxlbWVudHNbaV0pLmhhc0NsYXNzKHNvcnRhYmxlQ29uZmlnLnBsYWNlSG9sZGVyQ2xhc3MpKSB7DQogICAgICAgICAgICAgICAgaGFzUGxhY2VIb2xkZXIgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gaGFzUGxhY2VIb2xkZXI7DQogICAgICAgICAgfTsNCg0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBpdGVtIGlzIGRyYWdnZWQgdXB3YXJkcy4NCiAgICAgICAgICAgKg0KICAgICAgICAgICAqIEBwYXJhbSBldmVudE9iaiAtIHRoZSBldmVudCBvYmplY3QuDQogICAgICAgICAgICogQHBhcmFtIHRhcmdldEVsZW1lbnQgLSB0aGUgdGFyZ2V0IGVsZW1lbnQuDQogICAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IC0gdHJ1ZSBpZiBtb3ZpbmcgdXB3YXJkcy4NCiAgICAgICAgICAgKi8NCiAgICAgICAgICBpc0RyYWdCZWZvcmUgPSBmdW5jdGlvbiAoZXZlbnRPYmosIHRhcmdldEVsZW1lbnQpIHsNCiAgICAgICAgICAgIHZhciBkcmFnQmVmb3JlLCB0YXJnZXRPZmZzZXQ7DQoNCiAgICAgICAgICAgIGRyYWdCZWZvcmUgPSBmYWxzZTsNCiAgICAgICAgICAgIC8vIGNoZWNrIGl0J3MgbmV3IHBvc2l0aW9uDQogICAgICAgICAgICB0YXJnZXRPZmZzZXQgPSAkaGVscGVyLm9mZnNldCh0YXJnZXRFbGVtZW50KTsNCiAgICAgICAgICAgIGlmICgkaGVscGVyLm9mZnNldChwbGFjZUhvbGRlcikudG9wID4gdGFyZ2V0T2Zmc2V0LnRvcCkgeyAvLyB0aGUgbW92ZSBkaXJlY3Rpb24gaXMgdXA/DQogICAgICAgICAgICAgIGRyYWdCZWZvcmUgPSAkaGVscGVyLm9mZnNldChkcmFnRWxlbWVudCkudG9wIDwgdGFyZ2V0T2Zmc2V0LnRvcCArICRoZWxwZXIuaGVpZ2h0KHRhcmdldEVsZW1lbnQpIC8gMjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGRyYWdCZWZvcmUgPSBldmVudE9iai5wYWdlWSA8IHRhcmdldE9mZnNldC50b3A7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZHJhZ0JlZm9yZTsNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogUm9sbGJhY2sgdGhlIGRyYWcgZGF0YSBjaGFuZ2VzLg0KICAgICAgICAgICAqLw0KDQogICAgICAgICAgZnVuY3Rpb24gcm9sbGJhY2tEcmFnQ2hhbmdlcygpIHsNCiAgICAgICAgICAgIHBsYWNlRWxlbWVudC5yZXBsYWNlV2l0aChzY29wZS5pdGVtU2NvcGUuZWxlbWVudCk7DQogICAgICAgICAgICBwbGFjZUhvbGRlci5yZW1vdmUoKTsNCiAgICAgICAgICAgIGRyYWdFbGVtZW50LnJlbW92ZSgpOw0KICAgICAgICAgICAgZHJhZ0VsZW1lbnQgPSBudWxsOw0KICAgICAgICAgICAgZHJhZ0hhbmRsZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIGNvbnRhaW5tZW50LmNzcygnY3Vyc29yJywgJycpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIHRyaWdnZXJlZCB3aGlsZSBkcmFnIGVuZHMuDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBAcGFyYW0gZXZlbnQgLSB0aGUgZXZlbnQgb2JqZWN0Lg0KICAgICAgICAgICAqLw0KICAgICAgICAgIGRyYWdFbmQgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgIC8vIElnbm9yZSBldmVudCBpZiBub3QgaGFuZGxlZA0KICAgICAgICAgICAgaWYgKCFkcmFnSGFuZGxlZCkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgaWYgKGRyYWdFbGVtZW50KSB7DQogICAgICAgICAgICAgIC8vcm9sbGJhY2sgYWxsIHRoZSBjaGFuZ2VzLg0KICAgICAgICAgICAgICByb2xsYmFja0RyYWdDaGFuZ2VzKCk7DQogICAgICAgICAgICAgIC8vIHVwZGF0ZSBtb2RlbCBkYXRhDQogICAgICAgICAgICAgIGRyYWdJdGVtSW5mby5hcHBseSgpOw0KICAgICAgICAgICAgICBzY29wZS5zb3J0YWJsZVNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgaWYgKGRyYWdJdGVtSW5mby5pc1NhbWVQYXJlbnQoKSkgew0KICAgICAgICAgICAgICAgICAgaWYgKGRyYWdJdGVtSW5mby5pc09yZGVyQ2hhbmdlZCgpKSB7DQogICAgICAgICAgICAgICAgICAgIHNjb3BlLmNhbGxiYWNrcy5vcmRlckNoYW5nZWQoZHJhZ0l0ZW1JbmZvLmV2ZW50QXJncygpKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgc2NvcGUuY2FsbGJhY2tzLml0ZW1Nb3ZlZChkcmFnSXRlbUluZm8uZXZlbnRBcmdzKCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIHNjb3BlLnNvcnRhYmxlU2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBzY29wZS5jYWxsYmFja3MuZHJhZ0VuZChkcmFnSXRlbUluZm8uZXZlbnRBcmdzKCkpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgZHJhZ0l0ZW1JbmZvID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVuQmluZEV2ZW50cygpOw0KICAgICAgICAgIH07DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiB0cmlnZ2VyZWQgd2hpbGUgZHJhZyBpcyBjYW5jZWxsZWQuDQogICAgICAgICAgICoNCiAgICAgICAgICAgKiBAcGFyYW0gZXZlbnQgLSB0aGUgZXZlbnQgb2JqZWN0Lg0KICAgICAgICAgICAqLw0KICAgICAgICAgIGRyYWdDYW5jZWwgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgIC8vIElnbm9yZSBldmVudCBpZiBub3QgaGFuZGxlZA0KICAgICAgICAgICAgaWYgKCFkcmFnSGFuZGxlZCkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KDQogICAgICAgICAgICBpZiAoZHJhZ0VsZW1lbnQpIHsNCiAgICAgICAgICAgICAgLy9yb2xsYmFjayBhbGwgdGhlIGNoYW5nZXMuDQogICAgICAgICAgICAgIHJvbGxiYWNrRHJhZ0NoYW5nZXMoKTsNCiAgICAgICAgICAgICAgc2NvcGUuc29ydGFibGVTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHNjb3BlLmNhbGxiYWNrcy5kcmFnQ2FuY2VsKGRyYWdJdGVtSW5mby5ldmVudEFyZ3MoKSk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBkcmFnSXRlbUluZm8gPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdW5CaW5kRXZlbnRzKCk7DQogICAgICAgICAgfTsNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEJpbmRzIHRoZSBkcmFnIHN0YXJ0IGV2ZW50cy4NCiAgICAgICAgICAgKi8NCiAgICAgICAgICBiaW5kRHJhZyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGVsZW1lbnQuYmluZCgndG91Y2hzdGFydCcsIGRyYWdMaXN0ZW4pOw0KICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdtb3VzZWRvd24nLCBkcmFnTGlzdGVuKTsNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogVW5iaW5kcyB0aGUgZHJhZyBzdGFydCBldmVudHMuDQogICAgICAgICAgICovDQogICAgICAgICAgdW5iaW5kRHJhZyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGVsZW1lbnQudW5iaW5kKCd0b3VjaHN0YXJ0JywgZHJhZ0xpc3Rlbik7DQogICAgICAgICAgICBlbGVtZW50LnVuYmluZCgnbW91c2Vkb3duJywgZHJhZ0xpc3Rlbik7DQogICAgICAgICAgfTsNCg0KICAgICAgICAgIC8vYmluZCBkcmFnIHN0YXJ0IGV2ZW50cy4NCiAgICAgICAgICBiaW5kRHJhZygpOw0KDQogICAgICAgICAgLy9DYW5jZWwgZHJhZyBvbiBlc2NhcGUgcHJlc3MuDQogICAgICAgICAgYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudFswXS5ib2R5KS5iaW5kKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMjcpIHsNCiAgICAgICAgICAgICAgZHJhZ0NhbmNlbChldmVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBCaW5kcyB0aGUgZXZlbnRzIGJhc2VkIG9uIHRoZSBhY3Rpb25zLg0KICAgICAgICAgICAqLw0KICAgICAgICAgIGJpbmRFdmVudHMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJGRvY3VtZW50KS5iaW5kKCd0b3VjaG1vdmUnLCBkcmFnTW92ZSk7DQogICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJGRvY3VtZW50KS5iaW5kKCd0b3VjaGVuZCcsIGRyYWdFbmQpOw0KICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudCkuYmluZCgndG91Y2hjYW5jZWwnLCBkcmFnQ2FuY2VsKTsNCiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnQpLmJpbmQoJ21vdXNlbW92ZScsIGRyYWdNb3ZlKTsNCiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnQpLmJpbmQoJ21vdXNldXAnLCBkcmFnRW5kKTsNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogVW4gYmluZHMgdGhlIGV2ZW50cyBmb3IgZHJhZyBzdXBwb3J0Lg0KICAgICAgICAgICAqLw0KICAgICAgICAgIHVuQmluZEV2ZW50cyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnQpLnVuYmluZCgndG91Y2hlbmQnLCBkcmFnRW5kKTsNCiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnQpLnVuYmluZCgndG91Y2hjYW5jZWwnLCBkcmFnQ2FuY2VsKTsNCiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZG9jdW1lbnQpLnVuYmluZCgndG91Y2htb3ZlJywgZHJhZ01vdmUpOw0KICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudCkudW5iaW5kKCdtb3VzZXVwJywgZHJhZ0VuZCk7DQogICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJGRvY3VtZW50KS51bmJpbmQoJ21vdXNlbW92ZScsIGRyYWdNb3ZlKTsNCiAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICB9Ow0KICAgIH1dKTsNCn0oKSk7DQoNCi8qanNoaW50IGluZGVudDogMiAqLw0KLypnbG9iYWwgYW5ndWxhcjogZmFsc2UgKi8NCg0KKGZ1bmN0aW9uICgpIHsNCg0KICAndXNlIHN0cmljdCc7DQogIHZhciBtYWluTW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ3VpLnNvcnRhYmxlJyk7DQoNCiAgLyoqDQogICAqIENvbnRyb2xsZXIgZm9yIHNvcnRhYmxlIGl0ZW0uDQogICAqDQogICAqIEBwYXJhbSAkc2NvcGUgLSBkcmFnIGl0ZW0gc2NvcGUNCiAgICovDQogIG1haW5Nb2R1bGUuY29udHJvbGxlcigndWkuc29ydGFibGUuc29ydGFibGVJdGVtQ29udHJvbGxlcicsIFsnJHNjb3BlJywgZnVuY3Rpb24gKCRzY29wZSkgew0KDQogICAgdGhpcy5zY29wZSA9ICRzY29wZTsNCg0KICAgICRzY29wZS5zb3J0YWJsZVNjb3BlID0gbnVsbDsNCiAgICAkc2NvcGUubW9kZWxWYWx1ZSA9IG51bGw7IC8vIHNvcnRhYmxlIGl0ZW0uDQogICAgJHNjb3BlLnR5cGUgPSAnaXRlbSc7DQoNCiAgICAvKioNCiAgICAgKiByZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZHJhZyBpdGVtIGZyb20gdGhlIHNvcnRhYmxlIGxpc3QuDQogICAgICoNCiAgICAgKiBAcmV0dXJucyB7Kn0gLSBpbmRleCB2YWx1ZS4NCiAgICAgKi8NCiAgICAkc2NvcGUuaW5kZXggPSBmdW5jdGlvbiAoKSB7DQogICAgICByZXR1cm4gJHNjb3BlLnNvcnRhYmxlU2NvcGUubW9kZWxWYWx1ZS5pbmRleE9mKCRzY29wZS5tb2RlbFZhbHVlKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogUmV0dXJucyB0aGUgaXRlbSBtb2RlbCBkYXRhLg0KICAgICAqDQogICAgICogQHJldHVybnMgeyp9IC0gaXRlbSBtb2RlbCB2YWx1ZS4NCiAgICAgKi8NCiAgICAkc2NvcGUuaXRlbURhdGEgPSBmdW5jdGlvbiAoKSB7DQogICAgICByZXR1cm4gJHNjb3BlLnNvcnRhYmxlU2NvcGUubW9kZWxWYWx1ZVskc2NvcGUuJGluZGV4XTsNCiAgICB9Ow0KDQogIH1dKTsNCg0KICAvKioNCiAgICogc29ydGFibGVJdGVtIGRpcmVjdGl2ZS4NCiAgICovDQogIG1haW5Nb2R1bGUuZGlyZWN0aXZlKCdhc1NvcnRhYmxlSXRlbScsIFsnc29ydGFibGVDb25maWcnLA0KICAgIGZ1bmN0aW9uIChzb3J0YWJsZUNvbmZpZykgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgcmVxdWlyZTogJ15hc1NvcnRhYmxlJywNCiAgICAgICAgcmVzdHJpY3Q6ICdBJywNCiAgICAgICAgY29udHJvbGxlcjogJ3VpLnNvcnRhYmxlLnNvcnRhYmxlSXRlbUNvbnRyb2xsZXInLA0KICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBzb3J0YWJsZUNvbnRyb2xsZXIpIHsNCg0KICAgICAgICAgIGlmIChzb3J0YWJsZUNvbmZpZy5pdGVtQ2xhc3MpIHsNCiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3Moc29ydGFibGVDb25maWcuaXRlbUNsYXNzKTsNCiAgICAgICAgICB9DQogICAgICAgICAgc2NvcGUuc29ydGFibGVTY29wZSA9IHNvcnRhYmxlQ29udHJvbGxlci5zY29wZTsNCiAgICAgICAgICBzY29wZS5tb2RlbFZhbHVlID0gc29ydGFibGVDb250cm9sbGVyLnNjb3BlLm1vZGVsVmFsdWVbc2NvcGUuJGluZGV4XTsNCiAgICAgICAgICBzY29wZS5lbGVtZW50ID0gZWxlbWVudDsNCiAgICAgICAgfQ0KICAgICAgfTsNCiAgICB9XSk7DQoNCn0oKSk7</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>