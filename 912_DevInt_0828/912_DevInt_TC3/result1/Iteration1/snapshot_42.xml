<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="42">
  <HTTPTask id="44" hostname="aa-pt6245.dev.accela.com:5443" path="/portlets/spa/bower_components/ui-router-extras/release/ct-ui-router-extras.js" url="https://aa-pt6245.dev.accela.com:5443/portlets/spa/bower_components/ui-router-extras/release/ct-ui-router-extras.js" ip="13.93.163.237" port="5443" client_ip="10.1.61.63" client_port="9074" connectionId="1988" origin="Primary" startDateTime="2017-08-28T11:27:23.819-07:00" startTime="4608" endTime="4626" sendTime="14" waitTime="1" receiveTime="2">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Referer" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zcGEvZGFzaGJvYXJkLmRv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SlNFU1NJT05JRD00MGtvRFN6KzRwMmQtb1pxeklzZEtQKzA7IEpTRVNTSU9OSUQ9KioqKioqKioqKioqKioqKioqKioqKioqKioqOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ0ODQxMzcyOyBob3N0U2lnbk9uPXRydWU7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM7IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBMQVRFU1RfU0VTU0lPTl9JRD00MGtvRFN6KzRwMmQtb1pxeklzZEtQKzA7IEFDQXV0aD01OTE0OTEyOTg2ODMwNjI5Nzk0NDY0NDQwMzgyMTU3NzkyMTI2MjUwNjc1ODQ1MzcyNTUxNDk2MjI0MzY1NTg1MDIwODAwMjcwNTUxNjQyMjQ2MTExMDI1MTI3NjAwODgxNTA5MzQwMTM4NzM2NTQzMzQ5MzA4OTgzNDE1MDYyMTsgQUNTaWduT25Nb2R1bGU9U1NPU3RhbmRhcmQ7IEFBUGVyc2lzdExvZ2luU2VydlByb3ZDb2RlPUZMQUdTVEFGRjsgTG9naW5TZXJ2UHJvdkNvZGU0TXVsdGlBZ2VuY3k9RkxBR1NUQUZGOyBMb2dpblVzZXJuYW1lNE11bHRpQWdlbmN5PTE3OUREMTNBMTg2MDI4RjQ7IEFDU2lnbm9mZj0iaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zZWN1cml0eS9zaWdub3V0LmRvIjsgQUNTd2l0Y2hBZ2VuY3k9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9wb3J0bGV0cy9zcGEvYm93ZXJfY29tcG9uZW50cy91aS1yb3V0ZXItZXh0cmFzL3JlbGVhc2UvY3QtdWktcm91dGVyLWV4dHJhcy5qcyBIVFRQLzEuMQ0KUmVmZXJlcjogaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zcGEvZGFzaGJvYXJkLmRvDQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXT1c2NDsgVHJpZGVudC83LjA7IHJ2OjExLjApIGxpa2UgR2Vja28NCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZQ0KQWNjZXB0LUxhbmd1YWdlOiBlbi1VUw0KQWNjZXB0OiAqLyoNCkNvbm5lY3Rpb246IEtlZXAtQWxpdmUNCkhvc3Q6IGFhLXB0NjI0NS5kZXYuYWNjZWxhLmNvbTo1NDQzDQpDb29raWU6IEpTRVNTSU9OSUQ9NDBrb0RTeis0cDJkLW9acXpJc2RLUCswOyBKU0VTU0lPTklEPSoqKioqKioqKioqKioqKioqKioqKioqKioqKjsgTEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NDg0MTM3MjsgaG9zdFNpZ25Pbj10cnVlOyBnX2N1cnJlbnRfbGFuZ3VhZ2VfZXh0PWVuX1VTOyBMQVRFU1RfV0VCX1NFUlZFUj0xMC4xLjAuNjsgTEFURVNUX1NFU1NJT05fSUQ9NDBrb0RTeis0cDJkLW9acXpJc2RLUCswOyBBQ0F1dGg9NTkxNDkxMjk4NjgzMDYyOTc5NDQ2NDQ0MDM4MjE1Nzc5MjEyNjI1MDY3NTg0NTM3MjU1MTQ5NjIyNDM2NTU4NTAyMDgwMDI3MDU1MTY0MjI0NjExMTAyNTEyNzYwMDg4MTUwOTM0MDEzODczNjU0MzM0OTMwODk4MzQxNTA2MjE7IEFDU2lnbk9uTW9kdWxlPVNTT1N0YW5kYXJkOyBBQVBlcnNpc3RMb2dpblNlcnZQcm92Q29kZT1GTEFHU1RBRkY7IExvZ2luU2VydlByb3ZDb2RlNE11bHRpQWdlbmN5PUZMQUdTVEFGRjsgTG9naW5Vc2VybmFtZTRNdWx0aUFnZW5jeT0xNzlERDEzQTE4NjAyOEY0OyBBQ1NpZ25vZmY9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvc2VjdXJpdHkvc2lnbm91dC5kbyI7IEFDU3dpdGNoQWdlbmN5PSJodHRwczovL2FhLXB0NjI0NS5kZXYuYWNjZWxhLmNvbTo1NDQzL3BvcnRsZXRzL2NvbW1vbnMvc3NvL2JsYW5rLmpzcCINCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="JSESSIONID" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NDBrb0RTeis0cDJkLW9acXpJc2RLUCsw</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="JSESSIONID" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>KioqKioqKioqKioqKioqKioqKioqKioqKioq</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LASTEST_REQUEST_TIME" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTUwMzk0NDg0MTM3Mg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="hostSignOn" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="g_current_language_ext" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW5fVVM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_WEB_SERVER" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTAuMS4wLjY=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_SESSION_ID" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NDBrb0RTeis0cDJkLW9acXpJc2RLUCsw</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACAuth" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NTkxNDkxMjk4NjgzMDYyOTc5NDQ2NDQ0MDM4MjE1Nzc5MjEyNjI1MDY3NTg0NTM3MjU1MTQ5NjIyNDM2NTU4NTAyMDgwMDI3MDU1MTY0MjI0NjExMTAyNTEyNzYwMDg4MTUwOTM0MDEzODczNjU0MzM0OTMwODk4MzQxNTA2MjE=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignOnModule" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U1NPU3RhbmRhcmQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="AAPersistLoginServProvCode" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginServProvCode4MultiAgency" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginUsername4MultiAgency" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTc5REQxM0ExODYwMjhGNA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignoff" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvc2VjdXJpdHkvc2lnbm91dC5kbyI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSwitchAgency" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLUNveW90ZS8xLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-XSS-Protection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NDg0MTQxOTsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFURVNUX1dFQl9TRVJWRVI9MTAuMS4wLjY7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFURVNUX1NFU1NJT05fSUQ9NDBrb0RTeis0cDJkLW9acXpJc2RLUCswOyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJl</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Vy8iODM4ODctMTUwMTYxNzQ4MDAwMCI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VHVlLCAwMSBBdWcgMjAxNyAxOTo1ODowMCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Transfer-Encoding" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y2h1bmtlZA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyOCBBdWcgMjAxNyAxODoyNzoyMSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IEFwYWNoZS1Db3lvdGUvMS4xDQpYLVhTUy1Qcm90ZWN0aW9uOiAwDQpTZXQtQ29va2llOiBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ0ODQxNDE5OyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJlDQpTZXQtQ29va2llOiBMQVRFU1RfV0VCX1NFUlZFUj0xMC4xLjAuNjsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ0KU2V0LUNvb2tpZTogTEFURVNUX1NFU1NJT05fSUQ9NDBrb0RTeis0cDJkLW9acXpJc2RLUCswOyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJlDQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KRVRhZzogVy8iODM4ODctMTUwMTYxNzQ4MDAwMCINCkxhc3QtTW9kaWZpZWQ6IFR1ZSwgMDEgQXVnIDIwMTcgMTk6NTg6MDAgR01UDQpDb250ZW50LVR5cGU6IHRleHQvamF2YXNjcmlwdA0KVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWQNCkNvbnRlbnQtRW5jb2Rpbmc6IGd6aXANClZhcnk6IEFjY2VwdC1FbmNvZGluZw0KRGF0ZTogTW9uLCAyOCBBdWcgMjAxNyAxODoyNzoyMSBHTVQNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>LyoqDQogKiBVSS1Sb3V0ZXIgRXh0cmFzOiBTdGlja3kgc3RhdGVzLCBGdXR1cmUgU3RhdGVzLCBEZWVwIFN0YXRlIFJlZGlyZWN0LCBUcmFuc2l0aW9uIHByb21pc2UNCiAqIE1vbm9saXRoaWMgYnVpbGQgKGFsbCBtb2R1bGVzKQ0KICogQHZlcnNpb24gMC4wLjEzDQogKiBAbGluayBodHRwOi8vY2hyaXN0b3BoZXJ0aGllbGVuLmdpdGh1Yi5pby91aS1yb3V0ZXItZXh0cmFzLw0KICogQGxpY2Vuc2UgTUlUIExpY2Vuc2UsIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUDQogKi8NCihmdW5jdGlvbihhbmd1bGFyLCB1bmRlZmluZWQpew0KInVzZSBzdHJpY3QiOw0KdmFyIG1vZF9jb3JlID0gYW5ndWxhci5tb2R1bGUoImN0LnVpLnJvdXRlci5leHRyYXMuY29yZSIsIFsgInVpLnJvdXRlciIgXSk7DQoNCnZhciBpbnRlcm5hbFN0YXRlcyA9IHt9LCBzdGF0ZVJlZ2lzdGVyZWRDYWxsYmFja3MgPSBbXTsNCm1vZF9jb3JlLmNvbmZpZyhbICckc3RhdGVQcm92aWRlcicsICckaW5qZWN0b3InLCBmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIsICRpbmplY3Rvcikgew0KICAvLyBEZWNvcmF0ZSBhbnkgc3RhdGUgYXR0cmlidXRlIGluIG9yZGVyIHRvIGdldCBhY2Nlc3MgdG8gdGhlIGludGVybmFsIHN0YXRlIHJlcHJlc2VudGF0aW9uLg0KICAkc3RhdGVQcm92aWRlci5kZWNvcmF0b3IoJ3BhcmVudCcsIGZ1bmN0aW9uIChzdGF0ZSwgcGFyZW50Rm4pIHsNCiAgICAvLyBDYXB0dXJlIGVhY2ggaW50ZXJuYWwgVUktUm91dGVyIHN0YXRlIHJlcHJlc2VudGF0aW9ucyBhcyBvcHBvc2VkIHRvIHRoZSB1c2VyLWRlZmluZWQgc3RhdGUgb2JqZWN0Lg0KICAgIC8vIFRoZSBpbnRlcm5hbCBzdGF0ZSBpcywgZS5nLiwgdGhlIHN0YXRlIHJldHVybmVkIGJ5ICRzdGF0ZS4kY3VycmVudCBhcyBvcHBvc2VkIHRvICRzdGF0ZS5jdXJyZW50DQogICAgaW50ZXJuYWxTdGF0ZXNbc3RhdGUuc2VsZi5uYW1lXSA9IHN0YXRlOw0KICAgIC8vIEFkZCBhbiBhY2Nlc3NvciBmb3IgdGhlIGludGVybmFsIHN0YXRlIGZyb20gdGhlIHVzZXIgZGVmaW5lZCBzdGF0ZQ0KICAgIHN0YXRlLnNlbGYuJCRzdGF0ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIHJldHVybiBpbnRlcm5hbFN0YXRlc1tzdGF0ZS5zZWxmLm5hbWVdOw0KICAgIH07DQoNCiAgICBhbmd1bGFyLmZvckVhY2goc3RhdGVSZWdpc3RlcmVkQ2FsbGJhY2tzLCBmdW5jdGlvbihjYWxsYmFjaykgeyBjYWxsYmFjayhzdGF0ZSk7IH0pOw0KICAgIHJldHVybiBwYXJlbnRGbihzdGF0ZSk7DQogIH0pOw0KfV0pOw0KDQp2YXIgREVCVUcgPSBmYWxzZTsNCg0KdmFyIGZvckVhY2ggPSBhbmd1bGFyLmZvckVhY2g7DQp2YXIgZXh0ZW5kID0gYW5ndWxhci5leHRlbmQ7DQp2YXIgaXNBcnJheSA9IGFuZ3VsYXIuaXNBcnJheTsNCg0KdmFyIG1hcCA9IGZ1bmN0aW9uIChjb2xsZWN0aW9uLCBjYWxsYmFjaykgew0KICAidXNlIHN0cmljdCI7DQogIHZhciByZXN1bHQgPSBbXTsNCiAgZm9yRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsNCiAgICByZXN1bHQucHVzaChjYWxsYmFjayhpdGVtLCBpbmRleCkpOw0KICB9KTsNCiAgcmV0dXJuIHJlc3VsdDsNCn07DQoNCnZhciBrZXlzID0gZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHsNCiAgInVzZSBzdHJpY3QiOw0KICByZXR1cm4gbWFwKGNvbGxlY3Rpb24sIGZ1bmN0aW9uIChjb2xsZWN0aW9uLCBrZXkpIHsNCiAgICByZXR1cm4ga2V5Ow0KICB9KTsNCn07DQoNCnZhciBmaWx0ZXIgPSBmdW5jdGlvbiAoY29sbGVjdGlvbiwgY2FsbGJhY2spIHsNCiAgInVzZSBzdHJpY3QiOw0KICB2YXIgcmVzdWx0ID0gW107DQogIGZvckVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7DQogICAgaWYgKGNhbGxiYWNrKGl0ZW0sIGluZGV4KSkgew0KICAgICAgcmVzdWx0LnB1c2goaXRlbSk7DQogICAgfQ0KICB9KTsNCiAgcmV0dXJuIHJlc3VsdDsNCn07DQoNCnZhciBmaWx0ZXJPYmogPSBmdW5jdGlvbiAoY29sbGVjdGlvbiwgY2FsbGJhY2spIHsNCiAgInVzZSBzdHJpY3QiOw0KICB2YXIgcmVzdWx0ID0ge307DQogIGZvckVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7DQogICAgaWYgKGNhbGxiYWNrKGl0ZW0sIGluZGV4KSkgew0KICAgICAgcmVzdWx0W2luZGV4XSA9IGl0ZW07DQogICAgfQ0KICB9KTsNCiAgcmV0dXJuIHJlc3VsdDsNCn07DQoNCi8vIER1cGxpY2F0ZXMgY29kZSBpbiBVSS1Sb3V0ZXIgY29tbW9uLmpzDQpmdW5jdGlvbiBhbmNlc3RvcnMoZmlyc3QsIHNlY29uZCkgew0KICB2YXIgcGF0aCA9IFtdOw0KDQogIGZvciAodmFyIG4gaW4gZmlyc3QucGF0aCkgew0KICAgIGlmIChmaXJzdC5wYXRoW25dICE9PSBzZWNvbmQucGF0aFtuXSkgYnJlYWs7DQogICAgcGF0aC5wdXNoKGZpcnN0LnBhdGhbbl0pOw0KICB9DQogIHJldHVybiBwYXRoOw0KfQ0KDQovLyBEdXBsaWNhdGVzIGNvZGUgaW4gVUktUm91dGVyIGNvbW1vbi5qcw0KZnVuY3Rpb24gb2JqZWN0S2V5cyhvYmplY3QpIHsNCiAgaWYgKE9iamVjdC5rZXlzKSB7DQogICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iamVjdCk7DQogIH0NCiAgdmFyIHJlc3VsdCA9IFtdOw0KDQogIGFuZ3VsYXIuZm9yRWFjaChvYmplY3QsIGZ1bmN0aW9uICh2YWwsIGtleSkgew0KICAgIHJlc3VsdC5wdXNoKGtleSk7DQogIH0pOw0KICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQovKioNCiAqIGxpa2Ugb2JqZWN0S2V5cywgYnV0IGluY2x1ZGVzIGtleXMgZnJvbSBwcm90b3R5cGUgY2hhaW4uDQogKiBAcGFyYW0gb2JqZWN0IHRoZSBvYmplY3Qgd2hvc2UgcHJvdG90eXBhbCBrZXlzIHdpbGwgYmUgcmV0dXJuZWQNCiAqIEBwYXJhbSBpZ25vcmVLZXlzIGFuIGFycmF5IG9mIGtleXMgdG8gaWdub3JlDQogKi8NCi8vIER1cGxpY2F0ZXMgY29kZSBpbiBVSS1Sb3V0ZXIgY29tbW9uLmpzDQpmdW5jdGlvbiBwcm90b0tleXMob2JqZWN0LCBpZ25vcmVLZXlzKSB7DQogIHZhciByZXN1bHQgPSBbXTsNCiAgZm9yICh2YXIga2V5IGluIG9iamVjdCkgew0KICAgIGlmICghaWdub3JlS2V5cyB8fCBpZ25vcmVLZXlzLmluZGV4T2Yoa2V5KSA9PT0gLTEpDQogICAgICByZXN1bHQucHVzaChrZXkpOw0KICB9DQogIHJldHVybiByZXN1bHQ7DQp9DQoNCi8vIER1cGxpY2F0ZXMgY29kZSBpbiBVSS1Sb3V0ZXIgY29tbW9uLmpzDQpmdW5jdGlvbiBhcnJheVNlYXJjaChhcnJheSwgdmFsdWUpIHsNCiAgaWYgKEFycmF5LnByb3RvdHlwZS5pbmRleE9mKSB7DQogICAgcmV0dXJuIGFycmF5LmluZGV4T2YodmFsdWUsIE51bWJlcihhcmd1bWVudHNbMl0pIHx8IDApOw0KICB9DQogIHZhciBsZW4gPSBhcnJheS5sZW5ndGggPj4+IDAsIGZyb20gPSBOdW1iZXIoYXJndW1lbnRzWzJdKSB8fCAwOw0KICBmcm9tID0gKGZyb20gPCAwKSA/IE1hdGguY2VpbChmcm9tKSA6IE1hdGguZmxvb3IoZnJvbSk7DQoNCiAgaWYgKGZyb20gPCAwKSBmcm9tICs9IGxlbjsNCg0KICBmb3IgKDsgZnJvbSA8IGxlbjsgZnJvbSsrKSB7DQogICAgaWYgKGZyb20gaW4gYXJyYXkgJiYgYXJyYXlbZnJvbV0gPT09IHZhbHVlKSByZXR1cm4gZnJvbTsNCiAgfQ0KICByZXR1cm4gLTE7DQp9DQoNCi8vIER1cGxpY2F0ZXMgY29kZSBpbiBVSS1Sb3V0ZXIgY29tbW9uLmpzDQovLyBBZGRlZCBjb21wYXRpYmlsaXR5IGNvZGUgIChpc0FycmF5IGNoZWNrKSB0byBzdXBwb3J0IGJvdGggMC4yLnggYW5kIDAuMy54IHNlcmllcyBvZiBVSS1Sb3V0ZXIuDQpmdW5jdGlvbiBpbmhlcml0UGFyYW1zKGN1cnJlbnRQYXJhbXMsIG5ld1BhcmFtcywgJGN1cnJlbnQsICR0bykgew0KICB2YXIgcGFyZW50cyA9IGFuY2VzdG9ycygkY3VycmVudCwgJHRvKSwgcGFyZW50UGFyYW1zLCBpbmhlcml0ZWQgPSB7fSwgaW5oZXJpdExpc3QgPSBbXTsNCg0KICBmb3IgKHZhciBpIGluIHBhcmVudHMpIHsNCiAgICBpZiAoIXBhcmVudHNbaV0ucGFyYW1zKSBjb250aW51ZTsNCiAgICAvLyBUaGlzIHRlc3QgYWxsb3dzIGNvbXBhdGliaWxpdHkgd2l0aCAwLjIueCBhbmQgMC4zLnggKG9wdGlvbmFsIGFuZCBvYmplY3QgcGFyYW1zKQ0KICAgIHBhcmVudFBhcmFtcyA9IGlzQXJyYXkocGFyZW50c1tpXS5wYXJhbXMpID8gcGFyZW50c1tpXS5wYXJhbXMgOiBvYmplY3RLZXlzKHBhcmVudHNbaV0ucGFyYW1zKTsNCiAgICBpZiAoIXBhcmVudFBhcmFtcy5sZW5ndGgpIGNvbnRpbnVlOw0KDQogICAgZm9yICh2YXIgaiBpbiBwYXJlbnRQYXJhbXMpIHsNCiAgICAgIGlmIChhcnJheVNlYXJjaChpbmhlcml0TGlzdCwgcGFyZW50UGFyYW1zW2pdKSA+PSAwKSBjb250aW51ZTsNCiAgICAgIGluaGVyaXRMaXN0LnB1c2gocGFyZW50UGFyYW1zW2pdKTsNCiAgICAgIGluaGVyaXRlZFtwYXJlbnRQYXJhbXNbal1dID0gY3VycmVudFBhcmFtc1twYXJlbnRQYXJhbXNbal1dOw0KICAgIH0NCiAgfQ0KICByZXR1cm4gZXh0ZW5kKHt9LCBpbmhlcml0ZWQsIG5ld1BhcmFtcyk7DQp9DQoNCmZ1bmN0aW9uIGluaGVyaXQocGFyZW50LCBleHRyYSkgew0KICByZXR1cm4gZXh0ZW5kKG5ldyAoZXh0ZW5kKGZ1bmN0aW9uICgpIHsgfSwge3Byb3RvdHlwZTogcGFyZW50fSkpKCksIGV4dHJhKTsNCn0NCg0KZnVuY3Rpb24gb25TdGF0ZVJlZ2lzdGVyZWQoY2FsbGJhY2spIHsgc3RhdGVSZWdpc3RlcmVkQ2FsbGJhY2tzLnB1c2goY2FsbGJhY2spOyB9DQoNCm1vZF9jb3JlLnByb3ZpZGVyKCJ1aXJleHRyYXNfY29yZSIsIGZ1bmN0aW9uKCkgew0KICB2YXIgY29yZSA9IHsNCiAgICBpbnRlcm5hbFN0YXRlczogaW50ZXJuYWxTdGF0ZXMsDQogICAgb25TdGF0ZVJlZ2lzdGVyZWQ6IG9uU3RhdGVSZWdpc3RlcmVkLA0KICAgIGZvckVhY2g6IGZvckVhY2gsDQogICAgZXh0ZW5kOiBleHRlbmQsDQogICAgaXNBcnJheTogaXNBcnJheSwNCiAgICBtYXA6IG1hcCwNCiAgICBrZXlzOiBrZXlzLA0KICAgIGZpbHRlcjogZmlsdGVyLA0KICAgIGZpbHRlck9iajogZmlsdGVyT2JqLA0KICAgIGFuY2VzdG9yczogYW5jZXN0b3JzLA0KICAgIG9iamVjdEtleXM6IG9iamVjdEtleXMsDQogICAgcHJvdG9LZXlzOiBwcm90b0tleXMsDQogICAgYXJyYXlTZWFyY2g6IGFycmF5U2VhcmNoLA0KICAgIGluaGVyaXRQYXJhbXM6IGluaGVyaXRQYXJhbXMsDQogICAgaW5oZXJpdDogaW5oZXJpdA0KICB9Ow0KDQogIGFuZ3VsYXIuZXh0ZW5kKHRoaXMsIGNvcmUpOw0KDQogIHRoaXMuJGdldCA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBjb3JlOw0KICB9Ow0KfSk7DQoNCg0KdmFyIGlnbm9yZURzcjsNCmZ1bmN0aW9uIHJlc2V0SWdub3JlRHNyKCkgew0KICBpZ25vcmVEc3IgPSB1bmRlZmluZWQ7DQp9DQoNCi8vIERlY29yYXRlICRzdGF0ZS50cmFuc2l0aW9uVG8gdG8gZ2FpbiBhY2Nlc3MgdG8gdGhlIGxhc3QgdHJhbnNpdGlvbi5vcHRpb25zIHZhcmlhYmxlLg0KLy8gVGhpcyBpcyB1c2VkIHRvIHByb2Nlc3MgdGhlIG9wdGlvbnMuaWdub3JlRHNyIG9wdGlvbg0KYW5ndWxhci5tb2R1bGUoJ2N0LnVpLnJvdXRlci5leHRyYXMuZHNyJywgWyAnY3QudWkucm91dGVyLmV4dHJhcy5jb3JlJyBdKS5jb25maWcoWyAiJHByb3ZpZGUiLCBmdW5jdGlvbiAoJHByb3ZpZGUpIHsNCiAgdmFyICRzdGF0ZV90cmFuc2l0aW9uVG87DQogICRwcm92aWRlLmRlY29yYXRvcigiJHN0YXRlIiwgWyckZGVsZWdhdGUnLCAnJHEnLCBmdW5jdGlvbiAoJHN0YXRlLCAkcSkgew0KICAgICRzdGF0ZV90cmFuc2l0aW9uVG8gPSAkc3RhdGUudHJhbnNpdGlvblRvOw0KICAgICRzdGF0ZS50cmFuc2l0aW9uVG8gPSBmdW5jdGlvbiAodG8sIHRvUGFyYW1zLCBvcHRpb25zKSB7DQogICAgICBpZiAob3B0aW9ucy5pZ25vcmVEc3IpIHsNCiAgICAgICAgaWdub3JlRHNyID0gb3B0aW9ucy5pZ25vcmVEc3I7DQogICAgICB9DQoNCiAgICAgIHJldHVybiAkc3RhdGVfdHJhbnNpdGlvblRvLmFwcGx5KCRzdGF0ZSwgYXJndW1lbnRzKS50aGVuKA0KICAgICAgICBmdW5jdGlvbiAocmVzdWx0KSB7DQogICAgICAgICAgcmVzZXRJZ25vcmVEc3IoKTsNCiAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICB9LA0KICAgICAgICBmdW5jdGlvbiAoZXJyKSB7DQogICAgICAgICAgcmVzZXRJZ25vcmVEc3IoKTsNCiAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KGVycik7DQogICAgICAgIH0NCiAgICAgICk7DQogICAgfTsNCiAgICByZXR1cm4gJHN0YXRlOw0KICB9XSk7DQp9XSk7DQoNCmFuZ3VsYXIubW9kdWxlKCdjdC51aS5yb3V0ZXIuZXh0cmFzLmRzcicpLnNlcnZpY2UoIiRkZWVwU3RhdGVSZWRpcmVjdCIsIFsgJyRyb290U2NvcGUnLCAnJHN0YXRlJywgJyRpbmplY3RvcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc3RhdGUsICRpbmplY3Rvcikgew0KICB2YXIgbGFzdFN1YnN0YXRlID0ge307DQogIHZhciBkZWVwU3RhdGVSZWRpcmVjdHNCeU5hbWUgPSB7fTsNCg0KICB2YXIgUkVESVJFQ1QgPSAiUmVkaXJlY3QiLCBBTkNFU1RPUl9SRURJUkVDVCA9ICJBbmNlc3RvclJlZGlyZWN0IjsNCg0KICBmdW5jdGlvbiBjb21wdXRlRGVlcFN0YXRlU3RhdHVzKHN0YXRlKSB7DQogICAgdmFyIG5hbWUgPSBzdGF0ZS5uYW1lOw0KICAgIGlmIChkZWVwU3RhdGVSZWRpcmVjdHNCeU5hbWUuaGFzT3duUHJvcGVydHkobmFtZSkpDQogICAgICByZXR1cm4gZGVlcFN0YXRlUmVkaXJlY3RzQnlOYW1lW25hbWVdOw0KICAgIHJlY29yZERlZXBTdGF0ZVJlZGlyZWN0U3RhdHVzKG5hbWUpOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0Q29uZmlnKHN0YXRlKSB7DQogICAgdmFyIGRlY2xhcmF0aW9uID0gc3RhdGUuZGVlcFN0YXRlUmVkaXJlY3QgfHwgc3RhdGUuZHNyOw0KICAgIGlmICghZGVjbGFyYXRpb24pIHJldHVybiB7IGRzcjogZmFsc2UgfTsNCiAgICB2YXIgZHNyQ2ZnID0geyBkc3I6IHRydWUgfTsNCg0KICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24oZGVjbGFyYXRpb24pKSB7DQogICAgICBkc3JDZmcuZm4gPSBkZWNsYXJhdGlvbjsNCiAgICB9IGVsc2UgaWYgKGFuZ3VsYXIuaXNPYmplY3QoZGVjbGFyYXRpb24pKSB7DQogICAgICBkc3JDZmcgPSBhbmd1bGFyLmV4dGVuZChkc3JDZmcsIGRlY2xhcmF0aW9uKTsNCiAgICB9DQoNCiAgICBpZiAoYW5ndWxhci5pc1N0cmluZyhkc3JDZmdbJ2RlZmF1bHQnXSkpIHsNCiAgICAgIGRzckNmZ1snZGVmYXVsdCddID0geyBzdGF0ZTogZHNyQ2ZnWydkZWZhdWx0J10gfTsNCiAgICB9DQoNCiAgICBpZiAoIWRzckNmZy5mbikgew0KICAgICAgZHNyQ2ZnLmZuID0gWyAnJGRzciQnLCBmdW5jdGlvbigkZHNyJCkgew0KICAgICAgICByZXR1cm4gJGRzciQucmVkaXJlY3Quc3RhdGUgIT0gJGRzciQudG8uc3RhdGU7DQogICAgICB9IF07DQogICAgfQ0KICAgIHJldHVybiBkc3JDZmc7DQogIH0NCg0KICBmdW5jdGlvbiByZWNvcmREZWVwU3RhdGVSZWRpcmVjdFN0YXR1cyhzdGF0ZU5hbWUpIHsNCiAgICB2YXIgc3RhdGUgPSAkc3RhdGUuZ2V0KHN0YXRlTmFtZSk7DQogICAgaWYgKCFzdGF0ZSkgcmV0dXJuIGZhbHNlOw0KICAgIHZhciBjZmcgPSBnZXRDb25maWcoc3RhdGUpOw0KICAgIGlmIChjZmcuZHNyKSB7DQogICAgICBkZWVwU3RhdGVSZWRpcmVjdHNCeU5hbWVbc3RhdGUubmFtZV0gPSBSRURJUkVDVDsNCiAgICAgIGlmIChsYXN0U3Vic3RhdGVbc3RhdGVOYW1lXSA9PT0gdW5kZWZpbmVkKQ0KICAgICAgICBsYXN0U3Vic3RhdGVbc3RhdGVOYW1lXSA9IHt9Ow0KICAgIH0NCg0KICAgIHZhciBwYXJlbnQgPSBzdGF0ZS4kJHN0YXRlICYmIHN0YXRlLiQkc3RhdGUoKS5wYXJlbnQ7DQogICAgaWYgKHBhcmVudCkgew0KICAgICAgdmFyIHBhcmVudFN0YXR1cyA9IHJlY29yZERlZXBTdGF0ZVJlZGlyZWN0U3RhdHVzKHBhcmVudC5zZWxmLm5hbWUpOw0KICAgICAgaWYgKHBhcmVudFN0YXR1cyAmJiBkZWVwU3RhdGVSZWRpcmVjdHNCeU5hbWVbc3RhdGUubmFtZV0gPT09IHVuZGVmaW5lZCkgew0KICAgICAgICBkZWVwU3RhdGVSZWRpcmVjdHNCeU5hbWVbc3RhdGUubmFtZV0gPSBBTkNFU1RPUl9SRURJUkVDVDsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGRlZXBTdGF0ZVJlZGlyZWN0c0J5TmFtZVtzdGF0ZS5uYW1lXSB8fCBmYWxzZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldE1hdGNoUGFyYW1zKHBhcmFtcywgZHNyUGFyYW1zKSB7DQogICAgaWYgKGRzclBhcmFtcyA9PT0gdHJ1ZSkgZHNyUGFyYW1zID0gT2JqZWN0LmtleXMocGFyYW1zKTsNCiAgICBpZiAoZHNyUGFyYW1zID09PSBudWxsIHx8IGRzclBhcmFtcyA9PT0gdW5kZWZpbmVkKSBkc3JQYXJhbXMgPSBbXTsNCg0KICAgIHZhciBtYXRjaFBhcmFtcyA9IHt9Ow0KICAgIGFuZ3VsYXIuZm9yRWFjaChkc3JQYXJhbXMuc29ydCgpLCBmdW5jdGlvbihuYW1lKSB7IG1hdGNoUGFyYW1zW25hbWVdID0gcGFyYW1zW25hbWVdOyB9KTsNCiAgICByZXR1cm4gbWF0Y2hQYXJhbXM7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRQYXJhbXNTdHJpbmcocGFyYW1zLCBkc3JQYXJhbXMpIHsNCiAgICB2YXIgbWF0Y2hQYXJhbXMgPSBnZXRNYXRjaFBhcmFtcyhwYXJhbXMsIGRzclBhcmFtcyk7DQogICAgZnVuY3Rpb24gc2FmZVN0cmluZyhpbnB1dCkgeyByZXR1cm4gIWlucHV0ID8gaW5wdXQgOiBpbnB1dC50b1N0cmluZygpOyB9DQogICAgdmFyIHBhcmFtc1RvU3RyaW5nID0ge307DQogICAgYW5ndWxhci5mb3JFYWNoKG1hdGNoUGFyYW1zLCBmdW5jdGlvbih2YWwsIG5hbWUpIHsgcGFyYW1zVG9TdHJpbmdbbmFtZV0gPSBzYWZlU3RyaW5nKHZhbCk7IH0pOw0KICAgIHJldHVybiBhbmd1bGFyLnRvSnNvbihwYXJhbXNUb1N0cmluZyk7DQogIH0NCg0KICAkcm9vdFNjb3BlLiRvbigiJHN0YXRlQ2hhbmdlU3RhcnQiLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpIHsNCiAgICB2YXIgY2ZnID0gZ2V0Q29uZmlnKHRvU3RhdGUpOw0KICAgIGlmIChpZ25vcmVEc3IgfHwgKGNvbXB1dGVEZWVwU3RhdGVTdGF0dXModG9TdGF0ZSkgIT09IFJFRElSRUNUKSAmJiAhY2ZnWydkZWZhdWx0J10pIHJldHVybjsNCiAgICAvLyBXZSdyZSBjaGFuZ2luZyBkaXJlY3RseSB0byBvbmUgb2YgdGhlIHJlZGlyZWN0ICh0YWIpIHN0YXRlcy4NCiAgICAvLyBHZXQgdGhlIERTUiBrZXkgZm9yIHRoaXMgc3RhdGUgYnkgY2FsY3VsYXRpbmcgdGhlIERTUlBhcmFtcyBvcHRpb24NCiAgICB2YXIga2V5ID0gZ2V0UGFyYW1zU3RyaW5nKHRvUGFyYW1zLCBjZmcucGFyYW1zKTsNCiAgICB2YXIgcmVkaXJlY3QgPSBsYXN0U3Vic3RhdGVbdG9TdGF0ZS5uYW1lXVtrZXldIHx8IGNmZ1snZGVmYXVsdCddOw0KICAgIGlmICghcmVkaXJlY3QpIHJldHVybjsNCg0KICAgIC8vIHdlIGhhdmUgYSBsYXN0IHN1YnN0YXRlIHJlY29yZGVkDQogICAgdmFyICRkc3IkID0geyByZWRpcmVjdDogeyBzdGF0ZTogcmVkaXJlY3Quc3RhdGUsIHBhcmFtczogcmVkaXJlY3QucGFyYW1zfSwgdG86IHsgc3RhdGU6IHRvU3RhdGUubmFtZSwgcGFyYW1zOiB0b1BhcmFtcyB9IH07DQogICAgdmFyIHJlc3VsdCA9ICRpbmplY3Rvci5pbnZva2UoY2ZnLmZuLCB0b1N0YXRlLCB7ICRkc3IkOiAkZHNyJCB9KTsNCiAgICBpZiAoIXJlc3VsdCkgcmV0dXJuOw0KICAgIGlmIChyZXN1bHQuc3RhdGUpIHJlZGlyZWN0ID0gcmVzdWx0Ow0KICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgdmFyIHJlZGlyZWN0UGFyYW1zID0gZ2V0TWF0Y2hQYXJhbXModG9QYXJhbXMsIGNmZy5wYXJhbXMpOw0KICAgICRzdGF0ZS5nbyhyZWRpcmVjdC5zdGF0ZSwgYW5ndWxhci5leHRlbmQocmVkaXJlY3RQYXJhbXMsIHJlZGlyZWN0LnBhcmFtcykpOw0KICB9KTsNCg0KICAkcm9vdFNjb3BlLiRvbigiJHN0YXRlQ2hhbmdlU3VjY2VzcyIsIGZ1bmN0aW9uIChldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcykgew0KICAgIHZhciBkZWVwU3RhdGVTdGF0dXMgPSBjb21wdXRlRGVlcFN0YXRlU3RhdHVzKHRvU3RhdGUpOw0KICAgIGlmIChkZWVwU3RhdGVTdGF0dXMpIHsNCiAgICAgIHZhciBuYW1lID0gdG9TdGF0ZS5uYW1lOw0KICAgICAgYW5ndWxhci5mb3JFYWNoKGxhc3RTdWJzdGF0ZSwgZnVuY3Rpb24gKHJlZGlyZWN0LCBkc3JTdGF0ZSkgew0KICAgICAgICAvLyB1cGRhdGUgTGFzdC1TdWJTdGF0ZSZwYXJhbXMgZm9yIGVhY2ggRFNSIHRoYXQgdGhpcyB0cmFuc2l0aW9uIG1hdGNoZXMuDQogICAgICAgIHZhciBjZmcgPSBnZXRDb25maWcoJHN0YXRlLmdldChkc3JTdGF0ZSkpOw0KICAgICAgICB2YXIga2V5ID0gZ2V0UGFyYW1zU3RyaW5nKHRvUGFyYW1zLCBjZmcucGFyYW1zKTsNCiAgICAgICAgaWYgKG5hbWUgPT0gZHNyU3RhdGUgfHwgbmFtZS5pbmRleE9mKGRzclN0YXRlICsgIi4iKSAhPSAtMSkgew0KICAgICAgICAgIGxhc3RTdWJzdGF0ZVtkc3JTdGF0ZV1ba2V5XSA9IHsgc3RhdGU6IG5hbWUsIHBhcmFtczogYW5ndWxhci5jb3B5KHRvUGFyYW1zKSB9Ow0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQogIH0pOw0KDQogIHJldHVybiB7DQogICAgcmVzZXQ6IGZ1bmN0aW9uKHN0YXRlT3JOYW1lLCBwYXJhbXMpIHsNCiAgICAgIGlmICghc3RhdGVPck5hbWUpIHsNCiAgICAgICAgYW5ndWxhci5mb3JFYWNoKGxhc3RTdWJzdGF0ZSwgZnVuY3Rpb24ocmVkaXJlY3QsIGRzclN0YXRlKSB7IGxhc3RTdWJzdGF0ZVtkc3JTdGF0ZV0gPSB7fTsgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgc3RhdGUgPSAkc3RhdGUuZ2V0KHN0YXRlT3JOYW1lKTsNCiAgICAgICAgaWYgKCFzdGF0ZSkgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIHN0YXRlOiAiICsgc3RhdGVPck5hbWUpOw0KICAgICAgICBpZiAobGFzdFN1YnN0YXRlW3N0YXRlLm5hbWVdKSB7DQogICAgICAgICAgaWYgKHBhcmFtcykgew0KICAgICAgICAgICAgdmFyIGtleSA9IGdldFBhcmFtc1N0cmluZyhwYXJhbXMsIGdldENvbmZpZyhzdGF0ZSkucGFyYW1zKTsNCiAgICAgICAgICAgIGRlbGV0ZSBsYXN0U3Vic3RhdGVbc3RhdGUubmFtZV1ba2V5XTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbGFzdFN1YnN0YXRlW3N0YXRlLm5hbWVdID0ge307DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9Ow0KfV0pOw0KDQphbmd1bGFyLm1vZHVsZSgnY3QudWkucm91dGVyLmV4dHJhcy5kc3InKS5ydW4oWyckZGVlcFN0YXRlUmVkaXJlY3QnLCBmdW5jdGlvbiAoJGRlZXBTdGF0ZVJlZGlyZWN0KSB7DQogIC8vIE1ha2Ugc3VyZSAkZGVlcFN0YXRlUmVkaXJlY3QgaXMgaW5zdGFudGlhdGVkDQp9XSk7DQoNCmFuZ3VsYXIubW9kdWxlKCJjdC51aS5yb3V0ZXIuZXh0cmFzLnN0aWNreSIsIFsgJ2N0LnVpLnJvdXRlci5leHRyYXMuY29yZScgXSk7DQoNCnZhciBtb2Rfc3RpY2t5ID0gYW5ndWxhci5tb2R1bGUoImN0LnVpLnJvdXRlci5leHRyYXMuc3RpY2t5Iik7DQoNCiRTdGlja3lTdGF0ZVByb3ZpZGVyLiRpbmplY3QgPSBbICckc3RhdGVQcm92aWRlcicsICd1aXJleHRyYXNfY29yZVByb3ZpZGVyJyBdOw0KZnVuY3Rpb24gJFN0aWNreVN0YXRlUHJvdmlkZXIoJHN0YXRlUHJvdmlkZXIsIHVpcmV4dHJhc19jb3JlUHJvdmlkZXIpIHsNCiAgdmFyIGNvcmUgPSB1aXJleHRyYXNfY29yZVByb3ZpZGVyOw0KICB2YXIgaW5oZXJpdFBhcmFtcyA9IGNvcmUuaW5oZXJpdFBhcmFtczsNCiAgdmFyIG9iamVjdEtleXMgPSBjb3JlLm9iamVjdEtleXM7DQogIHZhciBwcm90b0tleXMgPSBjb3JlLnByb3RvS2V5czsNCiAgdmFyIG1hcCA9IGNvcmUubWFwOw0KDQogIC8vIEhvbGRzIGFsbCB0aGUgc3RhdGVzIHdoaWNoIGFyZSBpbmFjdGl2YXRlZC4gIEluYWN0aXZhdGVkIHN0YXRlcyBjYW4gYmUgZWl0aGVyIHN0aWNreSBzdGF0ZXMsIG9yIGRlc2NlbmRhbnRzIG9mIHN0aWNreSBzdGF0ZXMuDQogIHZhciBpbmFjdGl2ZVN0YXRlcyA9IHt9OyAvLyBzdGF0ZS5uYW1lIC0+IChzdGF0ZSkNCiAgdmFyIHN0aWNreVN0YXRlcyA9IHt9OyAvLyBzdGF0ZS5uYW1lIC0+IHRydWUNCiAgdmFyICRzdGF0ZTsNCiAgdmFyIERFQlVHID0gZmFsc2U7DQoNCiAgLy8gQ2FsbGVkIGJ5ICRzdGF0ZVByb3ZpZGVyLnJlZ2lzdGVyU3RhdGUoKTsNCiAgLy8gcmVnaXN0ZXJzIGEgc3RpY2t5IHN0YXRlIHdpdGggJHN0aWNreVN0YXRlUHJvdmlkZXINCiAgdGhpcy5yZWdpc3RlclN0aWNreVN0YXRlID0gZnVuY3Rpb24gKHN0YXRlKSB7DQogICAgc3RpY2t5U3RhdGVzW3N0YXRlLm5hbWVdID0gc3RhdGU7DQogICAgLy8gY29uc29sZS5sb2coIlJlZ2lzdGVyZWQgc3RpY2t5IHN0YXRlOiAiLCBzdGF0ZSk7DQogIH07DQoNCiAgdGhpcy5lbmFibGVEZWJ1ZyA9IHRoaXMuZGVidWdNb2RlID0gZnVuY3Rpb24gKGVuYWJsZWQpIHsNCiAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoZW5hYmxlZCkpDQogICAgICBERUJVRyA9IGVuYWJsZWQ7DQogICAgcmV0dXJuIERFQlVHOw0KICB9Ow0KDQogIHRoaXMuJGdldCA9IFsgICckcm9vdFNjb3BlJywgJyRzdGF0ZScsICckc3RhdGVQYXJhbXMnLCAnJGluamVjdG9yJywgJyRsb2cnLA0KICAgIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgJGluamVjdG9yLCAkbG9nKSB7DQogICAgICAvLyBFYWNoIGluYWN0aXZlIHN0YXRlcyBpcyBlaXRoZXIgYSBzdGlja3kgc3RhdGUsIG9yIGEgY2hpbGQgb2YgYSBzdGlja3kgc3RhdGUuDQogICAgICAvLyBUaGlzIGZ1bmN0aW9uIGZpbmRzIHRoZSBjbG9zZXN0IGFuY2VzdG9yIHN0aWNreSBzdGF0ZSwgdGhlbiBmaW5kIHRoYXQgc3RhdGUncyBwYXJlbnQuDQogICAgICAvLyBNYXAgYWxsIGluYWN0aXZlIHN0YXRlcyB0byB0aGVpciBjbG9zZXN0IHBhcmVudC10by1zdGlja3kgc3RhdGUuDQogICAgICBmdW5jdGlvbiBtYXBJbmFjdGl2ZXMoKSB7DQogICAgICAgIHZhciBtYXBwZWRTdGF0ZXMgPSB7fTsNCiAgICAgICAgYW5ndWxhci5mb3JFYWNoKGluYWN0aXZlU3RhdGVzLCBmdW5jdGlvbiAoc3RhdGUsIG5hbWUpIHsNCiAgICAgICAgICB2YXIgc3RpY2t5QW5jZXN0b3JzID0gZ2V0U3RpY2t5U3RhdGVTdGFjayhzdGF0ZSk7DQogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGlja3lBbmNlc3RvcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBzdGlja3lBbmNlc3RvcnNbaV0ucGFyZW50Ow0KICAgICAgICAgICAgbWFwcGVkU3RhdGVzW3BhcmVudC5uYW1lXSA9IG1hcHBlZFN0YXRlc1twYXJlbnQubmFtZV0gfHwgW107DQogICAgICAgICAgICBtYXBwZWRTdGF0ZXNbcGFyZW50Lm5hbWVdLnB1c2goc3RhdGUpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAobWFwcGVkU3RhdGVzWycnXSkgew0KICAgICAgICAgICAgLy8gVGhpcyBpcyBuZWNlc3NhcnkgdG8gY29tcHV0ZSBUcmFuc2l0aW9uLmluYWN0aXZlcyB3aGVuIHRoZXJlIGFyZSBzdGlja3kgc3RhdGVzIGFyZSBjaGlsZHJlbiB0byByb290IHN0YXRlLg0KICAgICAgICAgICAgbWFwcGVkU3RhdGVzWydfX2luYWN0aXZlcyddID0gbWFwcGVkU3RhdGVzWycnXTsgIC8vIGpzaGludCBpZ25vcmU6bGluZQ0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBtYXBwZWRTdGF0ZXM7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG1hcEluYWN0aXZlc0J5SW1tZWRpYXRlUGFyZW50KCkgew0KICAgICAgICB2YXIgaW5hY3RpdmVzQnlBbGxQYXJlbnRzID17fTsNCiAgICAgICAgZm9yRWFjaChpbmFjdGl2ZVN0YXRlcywgZnVuY3Rpb24oc3RhdGUpIHsNCiAgICAgICAgICBmb3JFYWNoKHN0YXRlLnBhdGgsIGZ1bmN0aW9uKGFuY2VzdG9yKSB7DQogICAgICAgICAgICBpZiAoYW5jZXN0b3IgPT09IHN0YXRlKSByZXR1cm47DQogICAgICAgICAgICBpbmFjdGl2ZXNCeUFsbFBhcmVudHNbYW5jZXN0b3IubmFtZV0gPSBpbmFjdGl2ZXNCeUFsbFBhcmVudHNbYW5jZXN0b3IubmFtZV0gfHwgW107DQogICAgICAgICAgICBpbmFjdGl2ZXNCeUFsbFBhcmVudHNbYW5jZXN0b3IubmFtZV0ucHVzaChzdGF0ZSk7DQogICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gaW5hY3RpdmVzQnlBbGxQYXJlbnRzOw0KICAgICAgfQ0KDQogICAgICAvLyBHaXZlbiBhIHN0YXRlLCByZXR1cm5zIGFsbCBhbmNlc3RvciBzdGF0ZXMgd2hpY2ggYXJlIHN0aWNreS4NCiAgICAgIC8vIFdhbGtzIHVwIHRoZSB2aWV3J3Mgc3RhdGUncyBhbmNlc3RyeSB0cmVlIGFuZCBsb2NhdGVzIGVhY2ggYW5jZXN0b3Igc3RhdGUgd2hpY2ggaXMgbWFya2VkIGFzIHN0aWNreS4NCiAgICAgIC8vIFJldHVybnMgYW4gYXJyYXkgcG9wdWxhdGVkIHdpdGggb25seSB0aG9zZSBhbmNlc3RvciBzdGlja3kgc3RhdGVzLg0KICAgICAgZnVuY3Rpb24gZ2V0U3RpY2t5U3RhdGVTdGFjayhzdGF0ZSkgew0KICAgICAgICB2YXIgc3RhY2sgPSBbXTsNCiAgICAgICAgaWYgKCFzdGF0ZSkgcmV0dXJuIHN0YWNrOw0KICAgICAgICBkbyB7DQogICAgICAgICAgaWYgKHN0YXRlLnN0aWNreSkgc3RhY2sucHVzaChzdGF0ZSk7DQogICAgICAgICAgc3RhdGUgPSBzdGF0ZS5wYXJlbnQ7DQogICAgICAgIH0gd2hpbGUgKHN0YXRlKTsNCiAgICAgICAgc3RhY2sucmV2ZXJzZSgpOw0KICAgICAgICByZXR1cm4gc3RhY2s7DQogICAgICB9DQoNCiAgICAgIC8vIFVzZWQgYnkgcHJvY2Vzc1RyYW5zaXRpb24gdG8gZGV0ZXJtaW5lIGlmIHdoYXQga2luZCBvZiBzdGlja3kgc3RhdGUgdHJhbnNpdGlvbiB0aGlzIGlzLg0KICAgICAgLy8gcmV0dXJucyB7IGZyb206IChib29sKSwgdG86IChib29sKSB9DQogICAgICBmdW5jdGlvbiBnZXRTdGlja3lUcmFuc2l0aW9uVHlwZShmcm9tUGF0aCwgdG9QYXRoLCBrZWVwKSB7DQogICAgICAgIGlmIChmcm9tUGF0aFtrZWVwXSA9PT0gdG9QYXRoW2tlZXBdKSByZXR1cm4geyBmcm9tOiBmYWxzZSwgdG86IGZhbHNlIH07DQogICAgICAgIHZhciBzdGlja3lGcm9tU3RhdGUgPSBrZWVwIDwgZnJvbVBhdGgubGVuZ3RoICYmIGZyb21QYXRoW2tlZXBdLnNlbGYuc3RpY2t5Ow0KICAgICAgICB2YXIgc3RpY2t5VG9TdGF0ZSA9IGtlZXAgPCB0b1BhdGgubGVuZ3RoICYmIHRvUGF0aFtrZWVwXS5zZWxmLnN0aWNreTsNCiAgICAgICAgcmV0dXJuIHsgZnJvbTogc3RpY2t5RnJvbVN0YXRlLCB0bzogc3RpY2t5VG9TdGF0ZSB9Ow0KICAgICAgfQ0KDQogICAgICAvLyBSZXR1cm5zIGEgc3RpY2t5IHRyYW5zaXRpb24gdHlwZSBuZWNlc3NhcnkgdG8gZW50ZXIgdGhlIHN0YXRlLg0KICAgICAgLy8gVHJhbnNpdGlvbiBjYW4gYmU6IHJlYWN0aXZhdGUsIHVwZGF0ZVN0YXRlUGFyYW1zLCBvciBlbnRlcg0KDQogICAgICAvLyBOb3RlOiBpZiBhIHN0YXRlIGlzIGJlaW5nIHJlYWN0aXZhdGVkIGJ1dCBwYXJhbXMgZG9udCBtYXRjaCwgd2UgdHJlYXQNCiAgICAgIC8vIGl0IGFzIGEgRXhpdC9FbnRlciwgdGh1cyB0aGUgc3BlY2lhbCAidXBkYXRlU3RhdGVQYXJhbXMiIHRyYW5zaXRpb24uDQogICAgICAvLyBJZiBhIHBhcmVudCBpbmFjdGl2YXRlZCBzdGF0ZSBoYXMgInVwZGF0ZVN0YXRlUGFyYW1zIiB0cmFuc2l0aW9uIHR5cGUsIHRoZW4NCiAgICAgIC8vIGFsbCBkZXNjZW5kYW50IHN0YXRlcyBtdXN0IGFsc28gYmUgZXhpdC9lbnRlcmVkLCB0aHVzIHRoZSBmaXJzdCBsaW5lIG9mIHRoaXMgZnVuY3Rpb24uDQogICAgICBmdW5jdGlvbiBnZXRFbnRlclRyYW5zaXRpb24oc3RhdGUsIHN0YXRlUGFyYW1zLCByZWxvYWRTdGF0ZVRyZWUsIGFuY2VzdG9yUGFyYW1zQ2hhbmdlZCkgew0KICAgICAgICBpZiAoYW5jZXN0b3JQYXJhbXNDaGFuZ2VkKSByZXR1cm4gInVwZGF0ZVN0YXRlUGFyYW1zIjsNCiAgICAgICAgdmFyIGluYWN0aXZlU3RhdGUgPSBpbmFjdGl2ZVN0YXRlc1tzdGF0ZS5zZWxmLm5hbWVdOw0KICAgICAgICBpZiAoIWluYWN0aXZlU3RhdGUpIHJldHVybiAiZW50ZXIiOw0KICAgICAgICBpZiAoc3RhdGUuc2VsZiA9PT0gcmVsb2FkU3RhdGVUcmVlKSByZXR1cm4gInVwZGF0ZVN0YXRlUGFyYW1zIjsNCi8vICAgICAgaWYgKGluYWN0aXZlU3RhdGUubG9jYWxzID09IG51bGwgfHwgaW5hY3RpdmVTdGF0ZS5sb2NhbHMuZ2xvYmFscyA9PSBudWxsKSBkZWJ1Z2dlcjsNCiAgICAgICAgdmFyIHBhcmFtc01hdGNoID0gZXF1YWxGb3JLZXlzKHN0YXRlUGFyYW1zLCBpbmFjdGl2ZVN0YXRlLmxvY2Fscy5nbG9iYWxzLiRzdGF0ZVBhcmFtcywgc3RhdGUub3duUGFyYW1zKTsNCi8vICAgICAgaWYgKERFQlVHKSAkbG9nLmRlYnVnKCJnZXRFbnRlclRyYW5zaXRpb246ICIgKyBzdGF0ZS5uYW1lICsgKHBhcmFtc01hdGNoID8gIjogcmVhY3RpdmF0ZSIgOiAiOiB1cGRhdGVTdGF0ZVBhcmFtcyIpKTsNCiAgICAgICAgcmV0dXJuIHBhcmFtc01hdGNoID8gInJlYWN0aXZhdGUiIDogInVwZGF0ZVN0YXRlUGFyYW1zIjsNCiAgICAgIH0NCg0KICAgICAgLy8gR2l2ZW4gYSBzdGF0ZSBhbmQgKG9wdGlvbmFsKSBzdGF0ZVBhcmFtcywgcmV0dXJucyB0aGUgaW5hY3RpdmF0ZWQgc3RhdGUgZnJvbSB0aGUgaW5hY3RpdmUgc3RpY2t5IHN0YXRlIHJlZ2lzdHJ5Lg0KICAgICAgZnVuY3Rpb24gZ2V0SW5hY3RpdmF0ZWRTdGF0ZShzdGF0ZSwgc3RhdGVQYXJhbXMpIHsNCiAgICAgICAgaWYoIXN0YXRlKSByZXR1cm4gbnVsbDsNCiAgICAgICAgdmFyIGluYWN0aXZlU3RhdGUgPSBpbmFjdGl2ZVN0YXRlc1tzdGF0ZS5uYW1lXTsNCiAgICAgICAgaWYgKCFpbmFjdGl2ZVN0YXRlKSByZXR1cm4gbnVsbDsNCiAgICAgICAgaWYgKCFzdGF0ZVBhcmFtcykgcmV0dXJuIGluYWN0aXZlU3RhdGU7DQogICAgICAgIHZhciBwYXJhbXNNYXRjaCA9IGVxdWFsRm9yS2V5cyhzdGF0ZVBhcmFtcywgaW5hY3RpdmVTdGF0ZS5sb2NhbHMuZ2xvYmFscy4kc3RhdGVQYXJhbXMsIHN0YXRlLm93blBhcmFtcyk7DQogICAgICAgIHJldHVybiBwYXJhbXNNYXRjaCA/IGluYWN0aXZlU3RhdGUgOiBudWxsOw0KICAgICAgfQ0KDQogICAgICAvLyBEdXBsaWNhdGVzIGxvZ2ljIGluICRzdGF0ZS50cmFuc2l0aW9uVG8sIHByaW1hcmlseSB0byBmaW5kIHRoZSBwaXZvdCBzdGF0ZSAoaS5lLiwgdGhlICJrZWVwIiB2YWx1ZSkNCiAgICAgIGZ1bmN0aW9uIGVxdWFsRm9yS2V5cyhhLCBiLCBrZXlzKSB7DQogICAgICAgIGlmICghYW5ndWxhci5pc0FycmF5KGtleXMpICYmIGFuZ3VsYXIuaXNPYmplY3Qoa2V5cykpIHsNCiAgICAgICAgICBrZXlzID0gcHJvdG9LZXlzKGtleXMsIFsiJCRrZXlzIiwgIiQkdmFsdWVzIiwgIiQkZXF1YWxzIiwgIiQkdmFsaWRhdGVzIiwgIiQkbmV3IiwgIiQkcGFyZW50Il0pOw0KICAgICAgICB9DQogICAgICAgIGlmICgha2V5cykgew0KICAgICAgICAgIGtleXMgPSBbXTsNCiAgICAgICAgICBmb3IgKHZhciBuIGluIGEpIGtleXMucHVzaChuKTsgLy8gVXNlZCBpbnN0ZWFkIG9mIE9iamVjdC5rZXlzKCkgZm9yIElFOCBjb21wYXRpYmlsaXR5DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICB2YXIgayA9IGtleXNbaV07DQogICAgICAgICAgaWYgKGFba10gIT0gYltrXSkgcmV0dXJuIGZhbHNlOyAvLyBOb3QgJz09PScsIHZhbHVlcyBhcmVuJ3QgbmVjZXNzYXJpbHkgbm9ybWFsaXplZA0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KDQogICAgICB2YXIgc3RpY2t5U3VwcG9ydCA9IHsNCiAgICAgICAgZ2V0SW5hY3RpdmVTdGF0ZXM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB2YXIgc3RhdGVzID0gW107DQogICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGluYWN0aXZlU3RhdGVzLCBmdW5jdGlvbiAoc3RhdGUpIHsNCiAgICAgICAgICAgIHN0YXRlcy5wdXNoKHN0YXRlKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICByZXR1cm4gc3RhdGVzOw0KICAgICAgICB9LA0KICAgICAgICBnZXRJbmFjdGl2ZVN0YXRlc0J5UGFyZW50OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgcmV0dXJuIG1hcEluYWN0aXZlcygpOw0KICAgICAgICB9LA0KICAgICAgICAvLyBNYWluIEFQSSBmb3IgJHN0aWNreVN0YXRlLCB1c2VkIGJ5ICRzdGF0ZS4NCiAgICAgICAgLy8gUHJvY2Vzc2VzIGEgcG90ZW50aWFsIHRyYW5zaXRpb24sIHJldHVybnMgYW4gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBhdHRyaWJ1dGVzOg0KICAgICAgICAvLyB7DQogICAgICAgIC8vICAgIGtlZXA6IFRoZSBudW1iZXIgb2Ygc3RhdGVzIGJlaW5nICJrZXB0Ig0KICAgICAgICAvLyAgICBpbmFjdGl2ZXM6IEFycmF5IG9mIGFsbCBzdGF0ZXMgd2hpY2ggd2lsbCBiZSBpbmFjdGl2ZSBpZiB0aGUgdHJhbnNpdGlvbiBpcyBjb21wbGV0ZWQuDQogICAgICAgIC8vICAgIHJlYWN0aXZhdGluZ1N0YXRlczogQXJyYXkgb2YgYWxsIHN0YXRlcyB3aGljaCB3aWxsIGJlIHJlYWN0aXZhdGVkIGlmIHRoZSB0cmFuc2l0aW9uIGlzIGNvbXBsZXRlZC4NCiAgICAgICAgLy8gICAgZGVlcGVzdFJlYWN0aXZhdGVDaGlsZHJlbjogQXJyYXkgb2YgaW5hY3RpdmUgY2hpbGRyZW4gc3RhdGVzIG9mIHRoZSB0b1N0YXRlLCBpZiB0aGUgdG9TdGF0ZSBpcyBiZWluZyByZWFjdGl2YXRlZC4NCiAgICAgICAgLy8gICAgICAgIE5vdGU6IFRyYW5zaXRpb25pbmcgZGlyZWN0bHkgdG8gYW4gaW5hY3RpdmUgc3RhdGUgd2l0aCBpbmFjdGl2ZSBjaGlsZHJlbiB3aWxsIHJlYWN0aXZhdGUgdGhlIHN0YXRlLCBidXQgZXhpdCBhbGwgdGhlIGluYWN0aXZlIGNoaWxkcmVuLg0KICAgICAgICAvLyAgICBlbnRlcjogRW50ZXIgdHJhbnNpdGlvbiB0eXBlIGZvciBhbGwgYWRkZWQgc3RhdGVzLiAgVGhpcyBpcyBhIHN0aWNreSBhcnJheSB0byAidG9TdGF0ZXMiIGFycmF5IGluICRzdGF0ZS50cmFuc2l0aW9uVG8uDQogICAgICAgIC8vICAgIGV4aXQ6IEV4aXQgdHJhbnNpdGlvbiB0eXBlIGZvciBhbGwgcmVtb3ZlZCBzdGF0ZXMuICBUaGlzIGlzIGEgc3RpY2t5IGFycmF5IHRvICJmcm9tU3RhdGVzIiBhcnJheSBpbiAkc3RhdGUudHJhbnNpdGlvblRvLg0KICAgICAgICAvLyB9DQogICAgICAgIHByb2Nlc3NUcmFuc2l0aW9uOiBmdW5jdGlvbiAodHJhbnNpdGlvbikgew0KICAgICAgICAgIC8vIFRoaXMgb2JqZWN0IGlzIHJldHVybmVkDQogICAgICAgICAgdmFyIHJlc3VsdCA9IHsgaW5hY3RpdmVzOiBbXSwgZW50ZXI6IFtdLCBleGl0OiBbXSwga2VlcDogMCB9Ow0KICAgICAgICAgIHZhciBmcm9tUGF0aCA9IHRyYW5zaXRpb24uZnJvbVN0YXRlLnBhdGgsDQogICAgICAgICAgICBmcm9tUGFyYW1zID0gdHJhbnNpdGlvbi5mcm9tUGFyYW1zLA0KICAgICAgICAgICAgdG9QYXRoID0gdHJhbnNpdGlvbi50b1N0YXRlLnBhdGgsDQogICAgICAgICAgICB0b1BhcmFtcyA9IHRyYW5zaXRpb24udG9QYXJhbXMsDQogICAgICAgICAgICByZWxvYWRTdGF0ZVRyZWUgPSB0cmFuc2l0aW9uLnJlbG9hZFN0YXRlVHJlZSwNCiAgICAgICAgICAgIG9wdGlvbnMgPSB0cmFuc2l0aW9uLm9wdGlvbnM7DQogICAgICAgICAgdmFyIGtlZXAgPSAwLCBzdGF0ZSA9IHRvUGF0aFtrZWVwXTsNCg0KICAgICAgICAgIGlmIChvcHRpb25zLmluaGVyaXQpIHsNCiAgICAgICAgICAgIHRvUGFyYW1zID0gaW5oZXJpdFBhcmFtcygkc3RhdGVQYXJhbXMsIHRvUGFyYW1zIHx8IHt9LCAkc3RhdGUuJGN1cnJlbnQsIHRyYW5zaXRpb24udG9TdGF0ZSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgd2hpbGUgKHN0YXRlICYmIHN0YXRlID09PSBmcm9tUGF0aFtrZWVwXSAmJiBlcXVhbEZvcktleXModG9QYXJhbXMsIGZyb21QYXJhbXMsIHN0YXRlLm93blBhcmFtcykpIHsNCiAgICAgICAgICAgIC8vIFdlJ3JlICJrZWVwaW5nIiB0aGlzIHN0YXRlLiBidW1wIGtlZXAgdmFyIGFuZCBnZXQgdGhlIG5leHQgc3RhdGUgaW4gdG9QYXRoIGZvciB0aGUgbmV4dCBpdGVyYXRpb24uDQogICAgICAgICAgICBzdGF0ZSA9IHRvUGF0aFsrK2tlZXBdOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIHJlc3VsdC5rZWVwID0ga2VlcDsNCg0KICAgICAgICAgIHZhciBpZHgsIGRlZXBlc3RVcGRhdGVkUGFyYW1zLCBkZWVwZXN0UmVhY3RpdmF0ZSwgbm9Mb25nZXJJbmFjdGl2ZVN0YXRlcyA9IHt9LCBwVHlwZSA9IGdldFN0aWNreVRyYW5zaXRpb25UeXBlKGZyb21QYXRoLCB0b1BhdGgsIGtlZXApOw0KICAgICAgICAgIHZhciBhbmNlc3RvclVwZGF0ZWQgPSAhIW9wdGlvbnMucmVsb2FkOyAvLyBXaGVuIGFuY2VzdG9yIHBhcmFtcyBjaGFuZ2UsIHRyZWF0IHJlYWN0aXZhdGlvbiBhcyBleGl0L2VudGVyDQoNCiAgICAgICAgICB2YXIgaW5hY3RpdmVzID0gW10sIHJlYWN0aXZhdGluZ1N0YXRlcyA9IFtdLCBlbnRlcmluZ1N0YXRlcyA9IFtdLCBleGl0aW5nU3RhdGVzID0gW107DQoNCiAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlICJleGl0IiB0cmFuc2l0aW9uIGZvciBzdGF0ZXMgbm90ICJrZXB0IiwgaW4gZnJvbVBhdGguDQogICAgICAgICAgLy8gRXhpdCB0cmFuc2l0aW9uIGNhbiBiZSBvbmUgb2Y6DQogICAgICAgICAgLy8gICBleGl0OiBzdGFuZGFyZCBzdGF0ZSBleGl0IGxvZ2ljDQogICAgICAgICAgLy8gICBpbmFjdGl2YXRlOiByZWdpc3RlciBzdGF0ZSBhcyBhbiBpbmFjdGl2ZSBzdGF0ZQ0KICAgICAgICAgIGZvciAoaWR4ID0ga2VlcDsgaWR4IDwgZnJvbVBhdGgubGVuZ3RoOyBpZHgrKykgew0KICAgICAgICAgICAgaWYgKHBUeXBlLmZyb20pIHsNCiAgICAgICAgICAgICAgLy8gU3RhdGUgaXMgYmVpbmcgaW5hY3RpdmF0ZWQsIG5vdGUgdGhpcyBpbiByZXN1bHQuaW5hY3RpdmVzIGFycmF5DQogICAgICAgICAgICAgIHJlc3VsdC5pbmFjdGl2ZXMucHVzaChmcm9tUGF0aFtpZHhdKTsNCiAgICAgICAgICAgICAgaW5hY3RpdmVzLnB1c2goZnJvbVBhdGhbaWR4XSk7DQogICAgICAgICAgICAgIHJlc3VsdC5leGl0W2lkeF0gPSAiaW5hY3RpdmF0ZSI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBleGl0aW5nU3RhdGVzLnB1c2goZnJvbVBhdGhbaWR4XSk7DQogICAgICAgICAgICAgIHJlc3VsdC5leGl0W2lkeF0gPSAiZXhpdCI7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSAiZW50ZXIiIHRyYW5zaXRpb25zIGZvciBuZXcgc3RhdGVzIGluIHRvUGF0aA0KICAgICAgICAgIC8vIEVudGVyIHRyYW5zaXRpb25zIHdpbGwgYmUgZWl0aGVyICJlbnRlciIsICJyZWFjdGl2YXRlIiwgb3IgInVwZGF0ZVN0YXRlUGFyYW1zIiB3aGVyZQ0KICAgICAgICAgIC8vICAgZW50ZXI6IGZ1bGwgcmVzb2x2ZSwgbm8gc3BlY2lhbCBsb2dpYw0KICAgICAgICAgIC8vICAgcmVhY3RpdmF0ZTogdXNlIHByZXZpb3VzIGxvY2Fscw0KICAgICAgICAgIC8vICAgdXBkYXRlU3RhdGVQYXJhbXM6IGxpa2UgJ2VudGVyJywgZXhjZXB0IGV4aXQgdGhlIGluYWN0aXZlIHN0YXRlIGJlZm9yZSBlbnRlcmluZyBpdC4NCiAgICAgICAgICBmb3IgKGlkeCA9IGtlZXA7IGlkeCA8IHRvUGF0aC5sZW5ndGg7IGlkeCsrKSB7DQogICAgICAgICAgICB2YXIgZW50ZXJUcmFucyA9ICFwVHlwZS50byA/ICJlbnRlciIgOiBnZXRFbnRlclRyYW5zaXRpb24odG9QYXRoW2lkeF0sIHRvUGFyYW1zLCByZWxvYWRTdGF0ZVRyZWUsIGFuY2VzdG9yVXBkYXRlZCk7DQogICAgICAgICAgICBhbmNlc3RvclVwZGF0ZWQgPSAoYW5jZXN0b3JVcGRhdGVkIHx8IGVudGVyVHJhbnMgPT0gJ3VwZGF0ZVN0YXRlUGFyYW1zJyk7DQogICAgICAgICAgICByZXN1bHQuZW50ZXJbaWR4XSA9IGVudGVyVHJhbnM7DQogICAgICAgICAgICAvLyBJZiB3ZSdyZSByZWFjdGl2YXRpbmcgYSBzdGF0ZSwgbWFrZSBhIG5vdGUgb2YgaXQsIHNvIHdlIGNhbiByZW1vdmUgdGhhdCBzdGF0ZSBmcm9tIHRoZSAiaW5hY3RpdmUiIGxpc3QNCiAgICAgICAgICAgIGlmIChlbnRlclRyYW5zID09ICdyZWFjdGl2YXRlJykgew0KICAgICAgICAgICAgICByZWFjdGl2YXRpbmdTdGF0ZXMucHVzaCh0b1BhdGhbaWR4XSk7DQogICAgICAgICAgICAgIGRlZXBlc3RSZWFjdGl2YXRlID0gbm9Mb25nZXJJbmFjdGl2ZVN0YXRlc1t0b1BhdGhbaWR4XS5uYW1lXSA9IHRvUGF0aFtpZHhdOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChlbnRlclRyYW5zID09ICd1cGRhdGVTdGF0ZVBhcmFtcycpIHsNCiAgICAgICAgICAgICAgZGVlcGVzdFVwZGF0ZWRQYXJhbXMgPSBub0xvbmdlckluYWN0aXZlU3RhdGVzW3RvUGF0aFtpZHhdLm5hbWVdID0gdG9QYXRoW2lkeF07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbnRlcmluZ1N0YXRlcy5wdXNoKHRvUGF0aFtpZHhdKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBHZXQgdGhlIGN1cnJlbnRseSBpbmFjdGl2ZSBzdGF0ZXMgKGJlZm9yZSB0aGUgdHJhbnNpdGlvbiBpcyBwcm9jZXNzZWQpLCBtYXBwZWQgYnkgcGFyZW50IHN0YXRlDQogICAgICAgICAgdmFyIGluYWN0aXZlc0J5QWxsUGFyZW50cyA9IG1hcEluYWN0aXZlc0J5SW1tZWRpYXRlUGFyZW50KCk7DQogICAgICAgICAgDQogICAgICAgICAgLy8gSWYgd2UgYXJlIHRyYW5zaXRpb25pbmcgZGlyZWN0bHkgdG8gYW4gaW5hY3RpdmUgc3RhdGUsIGFuZCB0aGF0IHN0YXRlIGFsc28gaGFzIGluYWN0aXZlIGNoaWxkcmVuLA0KICAgICAgICAgIC8vIHRoZW4gZmluZCB0aG9zZSBjaGlsZHJlbiBzbyB0aGF0IHRoZXkgY2FuIGJlIGV4aXRlZC4NCiAgICAgICAgICB2YXIgZGVlcGVzdFJlYWN0aXZhdGVDaGlsZHJlbiA9IFtdOw0KICAgICAgICAgIGlmIChkZWVwZXN0UmVhY3RpdmF0ZSA9PT0gdHJhbnNpdGlvbi50b1N0YXRlKSB7DQogICAgICAgICAgICBkZWVwZXN0UmVhY3RpdmF0ZUNoaWxkcmVuID0gaW5hY3RpdmVzQnlBbGxQYXJlbnRzW2RlZXBlc3RSZWFjdGl2YXRlLm5hbWVdIHx8IFtdOw0KICAgICAgICAgIH0NCiAgICAgICAgICAvLyBBZGQgdGhlbSB0byB0aGUgbGlzdCBvZiBzdGF0ZXMgYmVpbmcgZXhpdGVkLg0KICAgICAgICAgIGV4aXRpbmdTdGF0ZXMgPSBleGl0aW5nU3RhdGVzLmNvbmNhdChkZWVwZXN0UmVhY3RpdmF0ZUNoaWxkcmVuKTsNCg0KICAgICAgICAgIC8vIEZpbmQgYW55IG90aGVyIGluYWN0aXZlIGNoaWxkcmVuIG9mIGFueSBvZiB0aGUgc3RhdGVzIGJlaW5nICJleGl0ZWQiDQogICAgICAgICAgdmFyIGV4aXRpbmdDaGlsZHJlbiA9IG1hcChleGl0aW5nU3RhdGVzLCBmdW5jdGlvbiAoc3RhdGUpIHsNCiAgICAgICAgICAgIHJldHVybiBpbmFjdGl2ZXNCeUFsbFBhcmVudHNbc3RhdGUubmFtZV0gfHwgW107DQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICAvLyBhcHBlbmQgZWFjaCBhcnJheSBvZiBjaGlsZHJlbi1vZi1leGl0aW5nIHN0YXRlcyB0byAiZXhpdGluZ1N0YXRlcyIgYmVjYXVzZSB0aGV5IHdpbGwgYmUgZXhpdGVkIHRvby4NCiAgICAgICAgICBmb3JFYWNoKGV4aXRpbmdDaGlsZHJlbiwgZnVuY3Rpb24oY2hpbGRyZW4pIHsNCiAgICAgICAgICAgIGV4aXRpbmdTdGF0ZXMgPSBleGl0aW5nU3RhdGVzLmNvbmNhdChjaGlsZHJlbik7DQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICAvLyBOb3cgY2FsY3VsYXRlIHRoZSBzdGF0ZXMgdGhhdCB3aWxsIGJlIGluYWN0aXZlIGlmIHRoaXMgdHJhbnNpdGlvbiBzdWNjZWVkcy4NCiAgICAgICAgICAvLyBXZSBoYXZlIGFscmVhZHkgcHVzaGVkIHRoZSB0cmFuc2l0aW9uVHlwZSA9PSAiaW5hY3RpdmF0ZSIgc3RhdGVzIHRvICdpbmFjdGl2ZXMnLg0KICAgICAgICAgIC8vIFNlY29uZCwgYWRkIGFsbCB0aGUgZXhpc3RpbmcgaW5hY3RpdmUgc3RhdGVzDQogICAgICAgICAgaW5hY3RpdmVzID0gaW5hY3RpdmVzLmNvbmNhdChtYXAoaW5hY3RpdmVTdGF0ZXMsIGFuZ3VsYXIuaWRlbnRpdHkpKTsNCiAgICAgICAgICAvLyBGaW5hbGx5LCByZW1vdmUgYW55IHN0YXRlcyB0aGF0IGFyZSBzY2hlZHVsZWQgZm9yICJleGl0IiBvciAiZW50ZXIiLCAicmVhY3RpdmF0ZSIsIG9yICJ1cGRhdGVTdGF0ZVBhcmFtcyINCiAgICAgICAgICBpbmFjdGl2ZXMgPSBpbmFjdGl2ZXMuZmlsdGVyKGZ1bmN0aW9uKHN0YXRlKSB7DQogICAgICAgICAgICByZXR1cm4gZXhpdGluZ1N0YXRlcy5pbmRleE9mKHN0YXRlKSA9PT0gLTEgJiYgZW50ZXJpbmdTdGF0ZXMuaW5kZXhPZihzdGF0ZSkgPT09IC0xOw0KICAgICAgICAgIH0pOw0KDQogICAgICAgICAgcmVzdWx0LmluYWN0aXZlcyA9IGluYWN0aXZlczsNCiAgICAgICAgICByZXN1bHQucmVhY3RpdmF0aW5nU3RhdGVzID0gcmVhY3RpdmF0aW5nU3RhdGVzOw0KICAgICAgICAgIHJlc3VsdC5kZWVwZXN0UmVhY3RpdmF0ZUNoaWxkcmVuID0gZGVlcGVzdFJlYWN0aXZhdGVDaGlsZHJlbjsNCg0KICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgIH0sDQoNCiAgICAgICAgLy8gQWRkcyBhIHN0YXRlIHRvIHRoZSBpbmFjdGl2YXRlZCBzdGlja3kgc3RhdGUgcmVnaXN0cnkuDQogICAgICAgIHN0YXRlSW5hY3RpdmF0ZWQ6IGZ1bmN0aW9uIChzdGF0ZSkgew0KICAgICAgICAgIC8vIEtlZXAgbG9jYWxzIGFyb3VuZC4NCiAgICAgICAgICBpbmFjdGl2ZVN0YXRlc1tzdGF0ZS5zZWxmLm5hbWVdID0gc3RhdGU7DQogICAgICAgICAgLy8gTm90aWZ5IHN0YXRlcyB0aGV5IGFyZSBiZWluZyBJbmFjdGl2YXRlZCAoaS5lLiwgYSBkaWZmZXJlbnQNCiAgICAgICAgICAvLyBzdGlja3kgc3RhdGUgdHJlZSBpcyBub3cgYWN0aXZlKS4NCiAgICAgICAgICBzdGF0ZS5zZWxmLnN0YXR1cyA9ICdpbmFjdGl2ZSc7DQogICAgICAgICAgaWYgKHN0YXRlLnNlbGYub25JbmFjdGl2YXRlKQ0KICAgICAgICAgICAgJGluamVjdG9yLmludm9rZShzdGF0ZS5zZWxmLm9uSW5hY3RpdmF0ZSwgc3RhdGUuc2VsZiwgc3RhdGUubG9jYWxzLmdsb2JhbHMpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8vIFJlbW92ZXMgYSBwcmV2aW91c2x5IGluYWN0aXZhdGVkIHN0YXRlIGZyb20gdGhlIGluYWN0aXZlIHN0aWNreSBzdGF0ZSByZWdpc3RyeQ0KICAgICAgICBzdGF0ZVJlYWN0aXZhdGVkOiBmdW5jdGlvbiAoc3RhdGUpIHsNCiAgICAgICAgICBpZiAoaW5hY3RpdmVTdGF0ZXNbc3RhdGUuc2VsZi5uYW1lXSkgew0KICAgICAgICAgICAgZGVsZXRlIGluYWN0aXZlU3RhdGVzW3N0YXRlLnNlbGYubmFtZV07DQogICAgICAgICAgfQ0KICAgICAgICAgIHN0YXRlLnNlbGYuc3RhdHVzID0gJ2VudGVyZWQnOw0KLy8gICAgICAgIGlmIChzdGF0ZS5sb2NhbHMgPT0gbnVsbCB8fCBzdGF0ZS5sb2NhbHMuZ2xvYmFscyA9PSBudWxsKSBkZWJ1Z2dlcjsNCiAgICAgICAgICBpZiAoc3RhdGUuc2VsZi5vblJlYWN0aXZhdGUpDQogICAgICAgICAgICAkaW5qZWN0b3IuaW52b2tlKHN0YXRlLnNlbGYub25SZWFjdGl2YXRlLCBzdGF0ZS5zZWxmLCBzdGF0ZS5sb2NhbHMuZ2xvYmFscyk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLy8gRXhpdHMgYWxsIGluYWN0aXZhdGVkIGRlc2NlbmRhbnQgc3Vic3RhdGVzIHdoZW4gdGhlIGFuY2VzdG9yIHN0YXRlIGlzIGV4aXRlZC4NCiAgICAgICAgLy8gV2hlbiB0cmFuc2l0aW9uVG8gaXMgZXhpdGluZyBhIHN0YXRlLCB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aXRoIHRoZSBzdGF0ZSBiZWluZyBleGl0ZWQuICBJdCBjaGVja3MgdGhlDQogICAgICAgIC8vIHJlZ2lzdHJ5IG9mIGluYWN0aXZhdGVkIHN0YXRlcyBmb3IgZGVzY2VuZGFudHMgb2YgdGhlIGV4aXRlZCBzdGF0ZSBhbmQgYWxzbyBleGl0cyB0aG9zZSBkZXNjZW5kYW50cy4gIEl0IHRoZW4NCiAgICAgICAgLy8gcmVtb3ZlcyB0aGUgbG9jYWxzIGFuZCBkZS1yZWdpc3RlcnMgdGhlIHN0YXRlIGZyb20gdGhlIGluYWN0aXZhdGVkIHJlZ2lzdHJ5Lg0KICAgICAgICBzdGF0ZUV4aXRpbmc6IGZ1bmN0aW9uIChleGl0aW5nLCBleGl0UXVldWUsIG9uRXhpdCkgew0KICAgICAgICAgIHZhciBleGl0aW5nTmFtZXMgPSB7fTsNCiAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZXhpdFF1ZXVlLCBmdW5jdGlvbiAoc3RhdGUpIHsNCiAgICAgICAgICAgIGV4aXRpbmdOYW1lc1tzdGF0ZS5zZWxmLm5hbWVdID0gdHJ1ZTsNCiAgICAgICAgICB9KTsNCg0KICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpbmFjdGl2ZVN0YXRlcywgZnVuY3Rpb24gKGluYWN0aXZlRXhpdGluZywgbmFtZSkgew0KICAgICAgICAgICAgLy8gVE9ETzogTWlnaHQgbmVlZCB0byBydW4gdGhlIGluYWN0aXZhdGlvbnMgaW4gdGhlIHByb3BlciBkZXB0aC1maXJzdCBvcmRlcj8NCiAgICAgICAgICAgIGlmICghZXhpdGluZ05hbWVzW25hbWVdICYmIGluYWN0aXZlRXhpdGluZy5pbmNsdWRlc1tleGl0aW5nLm5hbWVdKSB7DQogICAgICAgICAgICAgIGlmIChERUJVRykgJGxvZy5kZWJ1ZygiRXhpdGluZyAiICsgbmFtZSArICIgYmVjYXVzZSBpdCdzIGEgc3Vic3RhdGUgb2YgIiArIGV4aXRpbmcubmFtZSArICIgYW5kIHdhc24ndCBmb3VuZCBpbiAiLCBleGl0aW5nTmFtZXMpOw0KICAgICAgICAgICAgICBpZiAoaW5hY3RpdmVFeGl0aW5nLnNlbGYub25FeGl0KQ0KICAgICAgICAgICAgICAgICRpbmplY3Rvci5pbnZva2UoaW5hY3RpdmVFeGl0aW5nLnNlbGYub25FeGl0LCBpbmFjdGl2ZUV4aXRpbmcuc2VsZiwgaW5hY3RpdmVFeGl0aW5nLmxvY2Fscy5nbG9iYWxzKTsNCiAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGluYWN0aXZlRXhpdGluZy5sb2NhbHMsIGZ1bmN0aW9uKGxvY2FsdmFsLCBrZXkpIHsNCiAgICAgICAgICAgICAgICBkZWxldGUgaW5hY3RpdmVQc2V1ZG9TdGF0ZS5sb2NhbHNba2V5XTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIGluYWN0aXZlRXhpdGluZy5sb2NhbHMgPSBudWxsOw0KICAgICAgICAgICAgICBpbmFjdGl2ZUV4aXRpbmcuc2VsZi5zdGF0dXMgPSAnZXhpdGVkJzsNCiAgICAgICAgICAgICAgZGVsZXRlIGluYWN0aXZlU3RhdGVzW25hbWVdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KDQogICAgICAgICAgaWYgKG9uRXhpdCkNCiAgICAgICAgICAgICRpbmplY3Rvci5pbnZva2Uob25FeGl0LCBleGl0aW5nLnNlbGYsIGV4aXRpbmcubG9jYWxzLmdsb2JhbHMpOw0KICAgICAgICAgIGV4aXRpbmcubG9jYWxzID0gbnVsbDsNCiAgICAgICAgICBleGl0aW5nLnNlbGYuc3RhdHVzID0gJ2V4aXRlZCc7DQogICAgICAgICAgZGVsZXRlIGluYWN0aXZlU3RhdGVzW2V4aXRpbmcuc2VsZi5uYW1lXTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvLyBSZW1vdmVzIGEgcHJldmlvdXNseSBpbmFjdGl2YXRlZCBzdGF0ZSBmcm9tIHRoZSBpbmFjdGl2ZSBzdGlja3kgc3RhdGUgcmVnaXN0cnkNCiAgICAgICAgc3RhdGVFbnRlcmluZzogZnVuY3Rpb24gKGVudGVyaW5nLCBwYXJhbXMsIG9uRW50ZXIsIHVwZGF0ZVBhcmFtcykgew0KICAgICAgICAgIHZhciBpbmFjdGl2YXRlZFN0YXRlID0gZ2V0SW5hY3RpdmF0ZWRTdGF0ZShlbnRlcmluZyk7DQogICAgICAgICAgaWYgKGluYWN0aXZhdGVkU3RhdGUgJiYgKHVwZGF0ZVBhcmFtcyB8fCAhZ2V0SW5hY3RpdmF0ZWRTdGF0ZShlbnRlcmluZywgcGFyYW1zKSkpIHsNCiAgICAgICAgICAgIHZhciBzYXZlZExvY2FscyA9IGVudGVyaW5nLmxvY2FsczsNCiAgICAgICAgICAgIHRoaXMuc3RhdGVFeGl0aW5nKGluYWN0aXZhdGVkU3RhdGUpOw0KICAgICAgICAgICAgZW50ZXJpbmcubG9jYWxzID0gc2F2ZWRMb2NhbHM7DQogICAgICAgICAgfQ0KICAgICAgICAgIGVudGVyaW5nLnNlbGYuc3RhdHVzID0gJ2VudGVyZWQnOw0KDQogICAgICAgICAgaWYgKG9uRW50ZXIpDQogICAgICAgICAgICAkaW5qZWN0b3IuaW52b2tlKG9uRW50ZXIsIGVudGVyaW5nLnNlbGYsIGVudGVyaW5nLmxvY2Fscy5nbG9iYWxzKTsNCiAgICAgICAgfSwNCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KGluYWN0aXZlU3RhdGUsIHBhcmFtcykgew0KICAgICAgICAgIHZhciBzdGF0ZSA9ICRzdGF0ZS5nZXQoaW5hY3RpdmVTdGF0ZSk7DQogICAgICAgICAgaWYoIXN0YXRlKSByZXR1cm4gZmFsc2U7DQogICAgICAgICAgdmFyIGV4aXRpbmcgPSBnZXRJbmFjdGl2YXRlZFN0YXRlKHN0YXRlLCBwYXJhbXMpOw0KICAgICAgICAgIGlmICghZXhpdGluZykgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgIHN0aWNreVN1cHBvcnQuc3RhdGVFeGl0aW5nKGV4aXRpbmcpOw0KICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgiJHZpZXdDb250ZW50TG9hZGluZyIpOw0KICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICB9Ow0KDQogICAgICByZXR1cm4gc3RpY2t5U3VwcG9ydDsNCiAgICB9XTsNCn0NCg0KbW9kX3N0aWNreS5wcm92aWRlcigiJHN0aWNreVN0YXRlIiwgJFN0aWNreVN0YXRlUHJvdmlkZXIpOw0KDQovKioNCiAqIFN0aWNreSBTdGF0ZXMgbWFrZXMgZW50aXJlIHN0YXRlIHRyZWVzICJzdGlja3kiLiBTdGlja3kgc3RhdGUgdHJlZXMgYXJlIHJldGFpbmVkIHVudGlsIHRoZWlyIHBhcmVudCBzdGF0ZSBpcw0KICogZXhpdGVkLiBUaGlzIGNhbiBiZSB1c2VmdWwgdG8gYWxsb3cgbXVsdGlwbGUgbW9kdWxlcywgcGVlcnMgdG8gZWFjaCBvdGhlciwgZWFjaCBtb2R1bGUgaGF2aW5nIGl0cyBvd24gaW5kZXBlbmRlbnQNCiAqIHN0YXRlIHRyZWUuICBUaGUgcGVlciBtb2R1bGVzIGNhbiBiZSBhY3RpdmF0ZWQgYW5kIGluYWN0aXZhdGVkIHdpdGhvdXQgYW55IGxvc3Mgb2YgdGhlaXIgaW50ZXJuYWwgY29udGV4dCwgaW5jbHVkaW5nDQogKiBET00gY29udGVudCBzdWNoIGFzIHVudmFsaWRhdGVkL3BhcnRpYWxseSBmaWxsZWQgaW4gZm9ybXMsIGFuZCBldmVuIHNjcm9sbCBwb3NpdGlvbi4NCiAqDQogKiBET00gY29udGVudCBpcyByZXRhaW5lZCBieSBkZWNsYXJpbmcgYSBuYW1lZCB1aS12aWV3IGluIHRoZSBwYXJlbnQgc3RhdGUsIGFuZCBmaWxsaW5nIGl0IGluIHdpdGggYSBuYW1lZCB2aWV3IGZyb20gdGhlDQogKiBzdGlja3kgc3RhdGUuDQogKg0KICogVGVjaG5pY2FsIG92ZXJ2aWV3Og0KICoNCiAqIC0tLVBBVEhTLS0tDQogKiBVSS1Sb3V0ZXIgdXNlcyBzdGF0ZSBwYXRocyB0byBtYW5hZ2UgZW50ZXJpbmcgYW5kIGV4aXRpbmcgb2YgaW5kaXZpZHVhbCBzdGF0ZXMuICBFYWNoIHN0YXRlICJBLkIuQy5YIiBoYXMgaXRzIG93biBwYXRoLCBzdGFydGluZw0KICogZnJvbSB0aGUgcm9vdCBzdGF0ZSAoIiIpIGFuZCBlbmRpbmcgYXQgdGhlIHN0YXRlICJYIi4gIFRoZSBwYXRoIGlzIGNvbXBvc2VkIHRoZSBmaW5hbCBzdGF0ZSAiWCIncyBhbmNlc3RvcnMsIGUuZy4sDQogKiBbICIiLCAiQSIsICJCIiwgIkMiLCAiWCIgXS4NCiAqDQogKiBXaGVuIGEgdHJhbnNpdGlvbiBpcyBwcm9jZXNzZWQsIHRoZSBwcmV2aW91cyBwYXRoIChmcm9tU3RhdGUucGF0aCkgaXMgY29tcGFyZWQgd2l0aCB0aGUgcmVxdWVzdGVkIGRlc3RpbmF0aW9uIHBhdGgNCiAqICh0b1N0YXRlLnBhdGgpLiAgQWxsIHN0YXRlcyB0aGF0IHRoZSBmcm9tIGFuZCB0byBwYXRocyBoYXZlIGluIGNvbW1vbiBhcmUgImtlcHQiIGR1cmluZyB0aGUgdHJhbnNpdGlvbi4gIFRoZSBsYXN0DQogKiAia2VwdCIgZWxlbWVudCBpbiB0aGUgcGF0aCBpcyB0aGUgInBpdm90Ii4NCiAqDQogKiAtLS1WSUVXUy0tLQ0KICogQSBWaWV3IGluIFVJLVJvdXRlciBjb25zaXN0cyBvZiBhIGNvbnRyb2xsZXIgYW5kIGEgdGVtcGxhdGUuICBFYWNoIHZpZXcgYmVsb25ncyB0byBvbmUgc3RhdGUsIGFuZCBhIHN0YXRlIGNhbiBoYXZlIG1hbnkNCiAqIHZpZXdzLiAgRWFjaCB2aWV3IHBsdWdzIGludG8gYSB1aS12aWV3IGVsZW1lbnQgaW4gdGhlIERPTSBvZiBvbmUgb2YgdGhlIHBhcmVudCBzdGF0ZSdzIHZpZXcocykuDQogKg0KICogVmlldyBjb250ZXh0IGlzIG1hbmFnZWQgaW4gVUktUm91dGVyIHVzaW5nIGEgJ3N0YXRlIGxvY2FscycgY29uY2VwdC4gV2hlbiBhIHN0YXRlJ3Mgdmlld3MgYXJlIGZ1bGx5IGxvYWRlZCwgdGhvc2Ugdmlld3MNCiAqIGFyZSBwbGFjZWQgb24gdGhlIHN0YXRlcyAnbG9jYWxzJyBvYmplY3QuICBFYWNoIGxvY2FscyBvYmplY3QgcHJvdG90eXBhbGx5IGluaGVyaXRzIGZyb20gaXRzIHBhcmVudCBzdGF0ZSdzIGxvY2FscyBvYmplY3QuDQogKiBUaGlzIG1lYW5zIHRoYXQgc3RhdGUgIkEuQi5DLlgiJ3MgbG9jYWxzIG9iamVjdCBhbHNvIGhhcyBhbGwgb2Ygc3RhdGUgIkEuQi5DIidzIGxvY2FscyBhcyB3ZWxsIGFzIHRob3NlIGZyb20gIkEuQiIgYW5kICJBIi4NCiAqIFRoZSByb290IHN0YXRlICgiIikgZGVmaW5lcyBubyB2aWV3cywgYnV0IGl0IGlzIGluY2x1ZGVkIGluIHRoZSBwcm90eXBhbCBpbmhlcml0YW5jZSBjaGFpbi4NCiAqDQogKiBUaGUgbG9jYWxzIG9iamVjdCBpcyB1c2VkIGJ5IHRoZSB1aS12aWV3IGRpcmVjdGl2ZSB0byBsb2FkIHRoZSB0ZW1wbGF0ZSwgcmVuZGVyIHRoZSBjb250ZW50LCBjcmVhdGUgdGhlIGNoaWxkIHNjb3BlLA0KICogaW5pdGlhbGl6ZSB0aGUgY29udHJvbGxlciwgZXRjLiAgVGhlIHVpLXZpZXcgZGlyZWN0aXZlcyBjYWNoZXMgdGhlIGxvY2FscyBpbiBhIGNsb3N1cmUgdmFyaWFibGUuICBJZiB0aGUgbG9jYWxzIGFyZQ0KICogaWRlbnRpY2FsICg9PT0pLCB0aGVuIHRoZSB1aS12aWV3IGRpcmVjdGl2ZSBleGl0cyBlYXJseSwgYW5kIGRvZXMgbm8gcmVuZGVyaW5nLg0KICoNCiAqIEluIHN0b2NrIFVJLVJvdXRlciwgd2hlbiBhIHN0YXRlIGlzIGV4aXRlZCwgdGhhdCBzdGF0ZSdzIGxvY2FscyBvYmplY3QgaXMgZGVsZXRlZCBhbmQgdGhvc2Ugdmlld3MgYXJlIGNsZWFuZWQgdXAgYnkNCiAqIHRoZSB1aS12aWV3IGRpcmVjdGl2ZSBzaG9ydGx5Lg0KICoNCiAqIC0tLVN0aWNreSBTdGF0ZXMtLS0NCiAqIFVJLVJvdXRlciBFeHRyYXMga2VlcHMgdmlld3MgZm9yIGluYWN0aXZlIHN0YXRlcyBsaXZlLCBldmVuIHdoZW4gVUktUm91dGVyIHRoaW5rcyBpdCBoYXMgZXhpdGVkIHRoZW0uICBJdCBkb2VzIHRoaXMNCiAqIGJ5IGNyZWF0aW5nIGEgcHNldWRvIHN0YXRlIGNhbGxlZCAiX19pbmFjdGl2ZXMiIHRoYXQgaXMgdGhlIHBhcmVudCBvZiB0aGUgcm9vdCBzdGF0ZS4gIEl0IGFsc28gdGhlbiBkZWZpbmVzIGEgbG9jYWxzDQogKiBvYmplY3Qgb24gdGhlICJfX2luYWN0aXZlcyIgc3RhdGUsIHdoaWNoIHRoZSByb290IHN0YXRlIHByb3RveXBhbGx5IGluaGVyaXRzIGZyb20uICBCeSBkb2luZyB0aGlzLCB2aWV3cyBmb3IgaW5hY3RpdmUNCiAqIHN0YXRlcyBhcmUgYWNjZXNzaWJsZSB0aHJvdWdoIGxvY2FscyBvYmplY3QncyBwcm90b3lwYWwgaW5oZXJpdGFuY2UgY2hhaW4gZnJvbSBhbnkgc3RhdGUgaW4gdGhlIHN5c3RlbS4NCiAqDQogKiAtLS1UcmFuc2l0aW9ucy0tLQ0KICogVUktUm91dGVyIEV4dHJhcyBkZWNvcmF0ZXMgdGhlICRzdGF0ZS50cmFuc2l0aW9uVG8gZnVuY3Rpb24uICBXaGlsZSBhIHRyYW5zaXRpb24gaXMgaW4gcHJvZ3Jlc3MsIHRoZSB0b1N0YXRlIGFuZA0KICogZnJvbVN0YXRlIGludGVybmFsIHN0YXRlIHJlcHJlc2VudGF0aW9ucyBhcmUgbW9kaWZpZWQgaW4gb3JkZXIgdG8gY29lcmNlIHN0b2NrIFVJLVJvdXRlcidzIHRyYW5zaXRpb25UbygpIGludG8gcGVyZm9ybWluZw0KICogdGhlIGFwcHJvcHJpYXRlIG9wZXJhdGlvbnMuICBXaGVuIHRoZSB0cmFuc2l0aW9uIHByb21pc2UgaXMgY29tcGxldGVkLCB0aGUgb3JpZ2luYWwgdG9TdGF0ZSBhbmQgZnJvbVN0YXRlIHZhbHVlcyBhcmUNCiAqIHJlc3RvcmVkLg0KICoNCiAqIFN0b2NrIFVJLVJvdXRlcidzICRzdGF0ZS50cmFuc2l0aW9uVG8gZnVuY3Rpb24gdXNlcyB0b1N0YXRlLnBhdGggYW5kIGZyb21TdGF0ZS5wYXRoIHRvIG1hbmFnZSBlbnRlcmluZyBhbmQgZXhpdGluZw0KICogc3RhdGVzLiAgVUktUm91dGVyIEV4dHJhcyB0YWtlcyBhZHZhbnRhZ2Ugb2YgdGhvc2UgaW50ZXJuYWwgaW1wbGVtZW50YXRpb24gZGV0YWlscyBhbmQgcHJlcGFyZXMgYSB0b1N0YXRlLnBhdGggYW5kDQogKiBmcm9tU3RhdGUucGF0aCB3aGljaCBjb2VyY2VzIFVJLVJvdXRlciBpbnRvIGVudGVyaW5nIGFuZCBleGl0aW5nIHRoZSBjb3JyZWN0IHN0YXRlcywgb3IgbW9yZSBpbXBvcnRhbnRseSwgbm90IGVudGVyaW5nDQogKiBhbmQgbm90IGV4aXRpbmcgaW5hY3RpdmUgb3Igc3RpY2t5IHN0YXRlcy4gIEl0IGFsc28gcmVwbGFjZXMgc3RhdGUuc2VsZi5vbkVudGVyIGFuZCBzdGF0ZS5zZWxmLm9uRXhpdCBmb3IgZWxlbWVudHMgaW4NCiAqIHRoZSBwYXRocyB3aGVuIHRoZXkgYXJlIGJlaW5nIGluYWN0aXZhdGVkIG9yIHJlYWN0aXZhdGVkLg0KICovDQoNCg0KDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gU3RpY2t5IFN0YXRlIG1vZHVsZS1sZXZlbCB2YXJpYWJsZXMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCnZhciBfU3RpY2t5U3RhdGU7IC8vIGludGVybmFsIHJlZmVyZW5jZSB0byAkc3RpY2t5U3RhdGVQcm92aWRlcg0KdmFyIGludGVybmFsU3RhdGVzID0ge307IC8vIE1hcCB7IHN0YXRlbmFtZSAtPiBJbnRlcm5hbFN0YXRlT2JqIH0gaG9sZHMgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2YgYWxsIHN0YXRlcw0KdmFyIHJvb3QsIC8vIFJvb3Qgc3RhdGUsIGludGVybmFsIHJlcHJlc2VudGF0aW9uDQogIHBlbmRpbmdUcmFuc2l0aW9ucyA9IFtdLCAvLyBPbmUgdHJhbnNpdGlvbiBtYXkgc3VwZXJzZWRlIGFub3RoZXIuICBUaGlzIGhvbGRzIHJlZmVyZW5jZXMgdG8gYWxsIHBlbmRpbmcgdHJhbnNpdGlvbnMNCiAgcGVuZGluZ1Jlc3RvcmUsIC8vIFRoZSByZXN0b3JlIGZ1bmN0aW9uIGZyb20gdGhlIHN1cGVyc2VkZWQgdHJhbnNpdGlvbg0KICBpbmFjdGl2ZVBzZXVkb1N0YXRlLCAvLyBUaGlzIHBzZXVkbyBzdGF0ZSBob2xkcyBhbGwgdGhlIGluYWN0aXZlIHN0YXRlcycgbG9jYWxzIChyZXNvbHZlZCBzdGF0ZSBkYXRhLCBzdWNoIGFzIHZpZXdzIGV0YykNCiAgcmVhY3RpdmF0aW5nTG9jYWxzID0geyB9LCAvLyBUaGlzIGlzIGEgcHJlbnQgbG9jYWxzIHRvIHRoZSBpbmFjdGl2ZVBzZXVkb1N0YXRlIGxvY2FscywgdXNlZCB0byBob2xkIGxvY2FscyBmb3Igc3RhdGVzIGJlaW5nIHJlYWN0aXZhdGVkDQogIHZlcnNpb25IZXVyaXN0aWNzID0geyAvLyBIZXVyaXN0aWNzIHVzZWQgdG8gZ3Vlc3MgdGhlIGN1cnJlbnQgVUktUm91dGVyIFZlcnNpb24NCiAgICBoYXNQYXJhbVNldDogZmFsc2UNCiAgfTsNCg0KLy8gQ3JlYXRlcyBhIGJsYW5rIHN1cnJvZ2F0ZSBzdGF0ZQ0KZnVuY3Rpb24gU3Vycm9nYXRlU3RhdGUodHlwZSkgew0KICByZXR1cm4gew0KICAgIHJlc29sdmU6IHsgfSwNCiAgICBsb2NhbHM6IHsNCiAgICAgIGdsb2JhbHM6IHJvb3QgJiYgcm9vdC5sb2NhbHMgJiYgcm9vdC5sb2NhbHMuZ2xvYmFscw0KICAgIH0sDQogICAgdmlld3M6IHsgfSwNCiAgICBzZWxmOiB7IH0sDQogICAgcGFyYW1zOiB7IH0sDQogICAgb3duUGFyYW1zOiAoIHZlcnNpb25IZXVyaXN0aWNzLmhhc1BhcmFtU2V0ID8geyAkJGVxdWFsczogZnVuY3Rpb24oKSB7IHJldHVybiB0cnVlOyB9IH0gOiBbXSksDQogICAgc3Vycm9nYXRlVHlwZTogdHlwZQ0KICB9Ow0KfQ0KDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gU3RpY2t5IFN0YXRlIHJlZ2lzdHJhdGlvbiBhbmQgaW5pdGlhbGl6YXRpb24gY29kZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQovLyBHcmFiIGEgY29weSBvZiB0aGUgJHN0aWNreVN0YXRlIHNlcnZpY2UgZm9yIHVzZSBieSB0aGUgdHJhbnNpdGlvbiBtYW5hZ2VtZW50IGNvZGUNCmFuZ3VsYXIubW9kdWxlKCJjdC51aS5yb3V0ZXIuZXh0cmFzLnN0aWNreSIpLnJ1bihbIiRzdGlja3lTdGF0ZSIsIGZ1bmN0aW9uICgkc3RpY2t5U3RhdGUpIHsNCiAgX1N0aWNreVN0YXRlID0gJHN0aWNreVN0YXRlOw0KfV0pOw0KDQphbmd1bGFyLm1vZHVsZSgiY3QudWkucm91dGVyLmV4dHJhcy5zdGlja3kiKS5jb25maWcoDQogIFsgIiRwcm92aWRlIiwgIiRzdGF0ZVByb3ZpZGVyIiwgJyRzdGlja3lTdGF0ZVByb3ZpZGVyJywgJyR1cmxNYXRjaGVyRmFjdG9yeVByb3ZpZGVyJywgJ3VpcmV4dHJhc19jb3JlUHJvdmlkZXInLA0KICAgIGZ1bmN0aW9uICgkcHJvdmlkZSwgJHN0YXRlUHJvdmlkZXIsICRzdGlja3lTdGF0ZVByb3ZpZGVyLCAkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlciwgdWlyZXh0cmFzX2NvcmVQcm92aWRlcikgew0KICAgICAgdmFyIGNvcmUgPSB1aXJleHRyYXNfY29yZVByb3ZpZGVyOw0KICAgICAgdmFyIGludGVybmFsU3RhdGVzID0gY29yZS5pbnRlcm5hbFN0YXRlczsNCiAgICAgIHZhciBpbmhlcml0ID0gY29yZS5pbmhlcml0Ow0KICAgICAgdmFyIGluaGVyaXRQYXJhbXMgPSBjb3JlLmluaGVyaXRQYXJhbXM7DQogICAgICB2YXIgbWFwID0gY29yZS5tYXA7DQogICAgICB2YXIgZmlsdGVyT2JqID0gY29yZS5maWx0ZXJPYmo7DQoNCiAgICAgIHZlcnNpb25IZXVyaXN0aWNzLmhhc1BhcmFtU2V0ID0gISEkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlci5QYXJhbVNldDsNCiAgICAgIC8vIGluYWN0aXZlUHNldWRvU3RhdGUgKF9faW5hY3RpdmVzKSBob2xkcyBhbGwgdGhlIGluYWN0aXZlIGxvY2FscyB3aGljaCBpbmNsdWRlcyByZXNvbHZlZCBzdGF0ZXMgZGF0YSwgaS5lLiwgdmlld3MsIHNjb3BlLCBldGMNCiAgICAgIGluYWN0aXZlUHNldWRvU3RhdGUgPSBhbmd1bGFyLmV4dGVuZChuZXcgU3Vycm9nYXRlU3RhdGUoIl9faW5hY3RpdmVzIiksIHsgc2VsZjogeyAgbmFtZTogJ19faW5hY3RpdmVzJyAgfSB9KTsNCiAgICAgIC8vIFJlc2V0IG90aGVyIG1vZHVsZSBzY29wZWQgdmFyaWFibGVzLiAgVGhpcyBpcyB0byBwcmltYXJpbHkgdG8gZmx1c2ggYW55IHByZXZpb3VzIHN0YXRlIGR1cmluZyBrYXJtYSBydW5zLg0KICAgICAgcm9vdCA9IHBlbmRpbmdSZXN0b3JlID0gdW5kZWZpbmVkOw0KICAgICAgcGVuZGluZ1RyYW5zaXRpb25zID0gW107DQoNCiAgICAgIHVpcmV4dHJhc19jb3JlUHJvdmlkZXIub25TdGF0ZVJlZ2lzdGVyZWQoZnVuY3Rpb24oc3RhdGUpIHsNCiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIG9uZXMgbWFya2VkIGFzICJzdGlja3kiDQogICAgICAgIGlmIChzdGF0ZS5zZWxmLnN0aWNreSA9PT0gdHJ1ZSkgew0KICAgICAgICAgICRzdGlja3lTdGF0ZVByb3ZpZGVyLnJlZ2lzdGVyU3RpY2t5U3RhdGUoc3RhdGUuc2VsZik7DQogICAgICAgIH0NCiAgICAgIH0pOw0KDQogICAgICB2YXIgJHN0YXRlX3RyYW5zaXRpb25UbzsgLy8gaW50ZXJuYWwgcmVmZXJlbmNlIHRvIHRoZSByZWFsICRzdGF0ZS50cmFuc2l0aW9uVG8gZnVuY3Rpb24NCiAgICAgIC8vIERlY29yYXRlIHRoZSAkc3RhdGUgc2VydmljZSwgc28gd2UgY2FuIGRlY29yYXRlIHRoZSAkc3RhdGUudHJhbnNpdGlvblRvKCkgZnVuY3Rpb24gd2l0aCBzdGlja3kgc3RhdGUgc3R1ZmYuDQogICAgICAkcHJvdmlkZS5kZWNvcmF0b3IoIiRzdGF0ZSIsIFsnJGRlbGVnYXRlJywgJyRsb2cnLCAnJHEnLCBmdW5jdGlvbiAoJHN0YXRlLCAkbG9nLCAkcSkgew0KICAgICAgICAvLyBOb3RlOiB0aGlzIGNvZGUgZ2V0cyBydW4gb25seSBvbiB0aGUgZmlyc3Qgc3RhdGUgdGhhdCBpcyBkZWNvcmF0ZWQNCiAgICAgICAgcm9vdCA9ICRzdGF0ZS4kY3VycmVudDsNCiAgICAgICAgaW50ZXJuYWxTdGF0ZXNbIiJdID0gcm9vdDsNCiAgICAgICAgcm9vdC5wYXJlbnQgPSBpbmFjdGl2ZVBzZXVkb1N0YXRlOyAvLyBNYWtlIGluYWN0aXZlUHN1ZWRvU3RhdGUgdGhlIHBhcmVudCBvZiByb290LiAgIndhdCINCiAgICAgICAgaW5hY3RpdmVQc2V1ZG9TdGF0ZS5wYXJlbnQgPSB1bmRlZmluZWQ7IC8vIE1ha2UgaW5hY3RpdmVQc3VlZG9TdGF0ZSB0aGUgcmVhbCByb290Lg0KICAgICAgICAvLyBBZGQgYW5vdGhlciBsb2NhbHMgYnVja2V0LCBhcyBhIHBhcmVudCB0byBpbmFjdGl2YXRlUHNldWRvU3RhdGUgbG9jYWxzLg0KICAgICAgICAvLyBUaGlzIGlzIGZvciB0ZW1wb3Jhcnkgc3RvcmFnZSBvZiBsb2NhbHMgb2Ygc3RhdGVzIGJlaW5nIHJlYWN0aXZhdGVkIHdoaWxlIGEgdHJhbnNpdGlvbiBpcyBwZW5kaW5nDQogICAgICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IGluIHNvbWUgY2FzZXMgd2hlcmUgJHZpZXdDb250ZW50TG9hZGluZyBpcyB0cmlnZ2VyZWQgYmVmb3JlIHRoZSAkc3RhdGUuJGN1cnJlbnQgaXMgdXBkYXRlZCB0byB0aGUgdG9TdGF0ZS4NCiAgICAgICAgaW5hY3RpdmVQc2V1ZG9TdGF0ZS5sb2NhbHMgPSBpbmhlcml0KHJlYWN0aXZhdGluZ0xvY2FscywgaW5hY3RpdmVQc2V1ZG9TdGF0ZS5sb2NhbHMpOw0KICAgICAgICByb290LmxvY2FscyA9IGluaGVyaXQoaW5hY3RpdmVQc2V1ZG9TdGF0ZS5sb2NhbHMsIHJvb3QubG9jYWxzKTsgLy8gbWFrZSByb290IGxvY2FscyBleHRlbmQgdGhlIF9faW5hY3RpdmVzIGxvY2Fscy4NCiAgICAgICAgZGVsZXRlIGluYWN0aXZlUHNldWRvU3RhdGUubG9jYWxzLmdsb2JhbHM7DQoNCiAgICAgICAgLy8gSG9sZCBvbiB0byB0aGUgcmVhbCAkc3RhdGUudHJhbnNpdGlvblRvIGluIGEgbW9kdWxlLXNjb3BlIHZhcmlhYmxlLg0KICAgICAgICAkc3RhdGVfdHJhbnNpdGlvblRvID0gJHN0YXRlLnRyYW5zaXRpb25UbzsNCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gRGVjb3JhdGVkIHRyYW5zaXRpb25UbyBpbXBsZW1lbnRhdGlvbiBiZWdpbnMgaGVyZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbyA9IGZ1bmN0aW9uICh0bywgdG9QYXJhbXMsIG9wdGlvbnMpIHsNCiAgICAgICAgICB2YXIgREVCVUcgPSAkc3RpY2t5U3RhdGVQcm92aWRlci5kZWJ1Z01vZGUoKTsNCiAgICAgICAgICAvLyBUT0RPOiBNb3ZlIHRoaXMgdG8gbW9kdWxlLnJ1bj8NCiAgICAgICAgICAvLyBUT0RPOiBJJ2QgcmF0aGVyIGhhdmUgcm9vdC5sb2NhbHMgcHJvdG90eXBhbGx5IGluaGVyaXQgZnJvbSBpbmFjdGl2ZVBzZXVkb1N0YXRlLmxvY2Fscw0KICAgICAgICAgIC8vIExpbmsgcm9vdC5sb2NhbHMgYW5kIGluYWN0aXZlcy5sb2NhbHMuICBEbyB0aGlzIGF0IHJ1bnRpbWUsIGFmdGVyIHJvb3QubG9jYWxzIGhhcyBiZWVuIHNldC4NCiAgICAgICAgICBpZiAoIWluYWN0aXZlUHNldWRvU3RhdGUubG9jYWxzKQ0KICAgICAgICAgICAgaW5hY3RpdmVQc2V1ZG9TdGF0ZS5sb2NhbHMgPSByb290LmxvY2FsczsNCiAgICAgICAgICB2YXIgaWR4ID0gcGVuZGluZ1RyYW5zaXRpb25zLmxlbmd0aDsNCiAgICAgICAgICBpZiAocGVuZGluZ1Jlc3RvcmUpIHsNCiAgICAgICAgICAgIHBlbmRpbmdSZXN0b3JlKCk7DQogICAgICAgICAgICBpZiAoREVCVUcpIHsNCiAgICAgICAgICAgICAgJGxvZy5kZWJ1ZygiUmVzdG9yZWQgcGF0aHMgZnJvbSBwZW5kaW5nIHRyYW5zaXRpb24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICB2YXIgZnJvbVN0YXRlID0gJHN0YXRlLiRjdXJyZW50LCBmcm9tUGFyYW1zID0gJHN0YXRlLnBhcmFtczsNCiAgICAgICAgICB2YXIgcmVsID0gb3B0aW9ucyAmJiBvcHRpb25zLnJlbGF0aXZlIHx8ICRzdGF0ZS4kY3VycmVudDsgLy8gTm90IHN1cmUgaWYvd2hlbiAkc3RhdGUuJGN1cnJlbnQgaXMgYXBwcm9wcmlhdGUgaGVyZS4NCiAgICAgICAgICB2YXIgdG9TdGF0ZVNlbGYgPSAkc3RhdGUuZ2V0KHRvLCByZWwpOyAvLyBleHBvc2VzIGZpbmRTdGF0ZSByZWxhdGl2ZSBwYXRoIGZ1bmN0aW9uYWxpdHksIHJldHVybnMgc3RhdGUuc2VsZg0KICAgICAgICAgIHZhciBzYXZlZFRvU3RhdGVQYXRoLCBzYXZlZEZyb21TdGF0ZVBhdGgsIHN0aWNreVRyYW5zaXRpb25zOw0KICAgICAgICAgIHZhciByZWFjdGl2YXRlZCA9IFtdLCBleGl0ZWQgPSBbXSwgdGVybWluYWxSZWFjdGl2YXRlZFN0YXRlOw0KICAgICAgICAgIHRvUGFyYW1zID0gdG9QYXJhbXMgfHwge307DQogICAgICAgICAgYXJndW1lbnRzWzFdID0gdG9QYXJhbXM7DQoNCiAgICAgICAgICB2YXIgbm9vcCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB9Ow0KICAgICAgICAgIC8vIFN0aWNreSBzdGF0ZXMgd29ya3MgYnkgbW9kaWZ5aW5nIHRoZSBpbnRlcm5hbCBzdGF0ZSBvYmplY3RzIG9mIHRvU3RhdGUgYW5kIGZyb21TdGF0ZSwgZXNwZWNpYWxseSB0aGVpciAucGF0aChzKS4NCiAgICAgICAgICAvLyBUaGUgcmVzdG9yZSgpIGZ1bmN0aW9uIGlzIGEgY2xvc3VyZSBzY29wZWQgZnVuY3Rpb24gdGhhdCByZXN0b3JlcyB0aG9zZSBzdGF0ZXMnIGRlZmluaXRpb25zIHRvIHRoZWlyIG9yaWdpbmFsIHZhbHVlcy4NCiAgICAgICAgICB2YXIgcmVzdG9yZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmIChzYXZlZFRvU3RhdGVQYXRoKSB7DQogICAgICAgICAgICAgIHRvU3RhdGUucGF0aCA9IHNhdmVkVG9TdGF0ZVBhdGg7DQogICAgICAgICAgICAgIHNhdmVkVG9TdGF0ZVBhdGggPSBudWxsOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoc2F2ZWRGcm9tU3RhdGVQYXRoKSB7DQogICAgICAgICAgICAgIGZyb21TdGF0ZS5wYXRoID0gc2F2ZWRGcm9tU3RhdGVQYXRoOw0KICAgICAgICAgICAgICBzYXZlZEZyb21TdGF0ZVBhdGggPSBudWxsOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gocmVzdG9yZS5yZXN0b3JlRnVuY3Rpb25zLCBmdW5jdGlvbiAocmVzdG9yZUZ1bmN0aW9uKSB7DQogICAgICAgICAgICAgIHJlc3RvcmVGdW5jdGlvbigpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAvLyBSZXN0b3JlIGlzIGRvbmUsIG5vdyBzZXQgdGhlIHJlc3RvcmUgZnVuY3Rpb24gdG8gbm9vcCBpbiBjYXNlIGl0IGdldHMgY2FsbGVkIGFnYWluLg0KICAgICAgICAgICAgcmVzdG9yZSA9IG5vb3A7DQogICAgICAgICAgICAvLyBwZW5kaW5nUmVzdG9yZSBrZWVwcyB0cmFjayBvZiBhIHRyYW5zaXRpb24gdGhhdCBpcyBpbiBwcm9ncmVzcy4gIEl0IGFsbG93cyB0aGUgZGVjb3JhdGVkIHRyYW5zaXRpb25Ubw0KICAgICAgICAgICAgLy8gbWV0aG9kIHRvIGJlIHJlLWVudHJhbnQgKGZvciBleGFtcGxlLCB3aGVuIHN1cGVyY2VkaW5nIGEgdHJhbnNpdGlvbiwgaS5lLiwgcmVkaXJlY3QpLiAgVGhlIGRlY29yYXRlZA0KICAgICAgICAgICAgLy8gdHJhbnNpdGlvblRvIGNoZWNrcyByaWdodCBhd2F5IGlmIHRoZXJlIGlzIGEgcGVuZGluZyB0cmFuc2l0aW9uIGluIHByb2dyZXNzIGFuZCByZXN0b3JlcyB0aGUgcGF0aHMNCiAgICAgICAgICAgIC8vIGlmIHNvIHVzaW5nIHBlbmRpbmdSZXN0b3JlLg0KICAgICAgICAgICAgcGVuZGluZ1Jlc3RvcmUgPSBudWxsOw0KICAgICAgICAgICAgcGVuZGluZ1RyYW5zaXRpb25zLnNwbGljZShpZHgsIDEpOyAvLyBSZW1vdmUgdGhpcyB0cmFuc2l0aW9uIGZyb20gdGhlIGxpc3QNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgLy8gQWxsIGRlY29yYXRlZCB0cmFuc2l0aW9ucyBoYXZlIHRoZWlyIHRvU3RhdGUucGF0aCBhbmQgZnJvbVN0YXRlLnBhdGggcmVwbGFjZWQuICBTdXJyb2dhdGUgc3RhdGVzIGFsc28gbWFrZQ0KICAgICAgICAgIC8vIGFkZGl0aW9uYWwgY2hhbmdlcyB0byB0aGUgc3RhdGVzIGRlZmluaXRpb24gYmVmb3JlIGhhbmRpbmcgdGhlIHRyYW5zaXRpb24gb2ZmIHRvIFVJLVJvdXRlci4gSW4gcGFydGljdWxhciwNCiAgICAgICAgICAvLyBjZXJ0YWluIHR5cGVzIG9mIHN1cnJvZ2F0ZSBzdGF0ZXMgbW9kaWZ5IHRoZSBzdGF0ZS5zZWxmIG9iamVjdCdzIG9uRW50ZXIgb3Igb25FeGl0IGNhbGxiYWNrcy4NCiAgICAgICAgICAvLyBUaG9zZSBzdXJyb2dhdGUgc3RhdGVzIG11c3QgdGhlbiByZWdpc3RlciBhZGRpdGlvbmFsIHJlc3RvcmUgc3RlcHMgdXNpbmcgcmVzdG9yZS5hZGRSZXN0b3JlRnVuY3Rpb24oZm4pDQogICAgICAgICAgcmVzdG9yZS5yZXN0b3JlRnVuY3Rpb25zID0gW107DQogICAgICAgICAgcmVzdG9yZS5hZGRSZXN0b3JlRnVuY3Rpb24gPSBmdW5jdGlvbiBhZGRSZXN0b3JlRnVuY3Rpb24oZm4pIHsNCiAgICAgICAgICAgIHRoaXMucmVzdG9yZUZ1bmN0aW9ucy5wdXNoKGZuKTsNCiAgICAgICAgICB9Ow0KDQoNCiAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0gU3Vycm9nYXRlIFN0YXRlIEZ1bmN0aW9ucyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAvLyBEdXJpbmcgYSB0cmFuc2l0aW9uLCB0aGUgLnBhdGggYXJyYXlzIGluIHRvU3RhdGUgYW5kIGZyb21TdGF0ZSBhcmUgcmVwbGFjZWQuICBJbmRpdmlkdWFsIHBhdGggZWxlbWVudHMNCiAgICAgICAgICAvLyAoc3RhdGVzKSB3aGljaCBhcmVuJ3QgYmVpbmcgImtlcHQiIGFyZSByZXBsYWNlZCB3aXRoIHN1cnJvZ2F0ZSBlbGVtZW50cyAoc3RhdGVzKS4gIFRoaXMgc2VjdGlvbiBvZiB0aGUgY29kZQ0KICAgICAgICAgIC8vIGhhcyBmYWN0b3J5IGZ1bmN0aW9ucyBmb3IgYWxsIHRoZSBkaWZmZXJlbnQgdHlwZXMgb2Ygc3Vycm9nYXRlIHN0YXRlcy4NCg0KDQogICAgICAgICAgZnVuY3Rpb24gc3RhdGVSZWFjdGl2YXRlZFN1cnJvZ2F0ZVBoYXNlMShzdGF0ZSkgew0KICAgICAgICAgICAgdmFyIHN1cnJvZ2F0ZSA9IGFuZ3VsYXIuZXh0ZW5kKG5ldyBTdXJyb2dhdGVTdGF0ZSgicmVhY3RpdmF0ZV9waGFzZTEiKSwgeyBsb2NhbHM6IHN0YXRlLmxvY2FscyB9KTsNCiAgICAgICAgICAgIHN1cnJvZ2F0ZS5zZWxmID0gYW5ndWxhci5leHRlbmQoe30sIHN0YXRlLnNlbGYpOw0KICAgICAgICAgICAgcmV0dXJuIHN1cnJvZ2F0ZTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBzdGF0ZVJlYWN0aXZhdGVkU3Vycm9nYXRlUGhhc2UyKHN0YXRlKSB7DQogICAgICAgICAgICB2YXIgc3Vycm9nYXRlID0gYW5ndWxhci5leHRlbmQobmV3IFN1cnJvZ2F0ZVN0YXRlKCJyZWFjdGl2YXRlX3BoYXNlMiIpLCBzdGF0ZSk7DQogICAgICAgICAgICB2YXIgb2xkT25FbnRlciA9IHN1cnJvZ2F0ZS5zZWxmLm9uRW50ZXI7DQogICAgICAgICAgICBzdXJyb2dhdGUucmVzb2x2ZSA9IHt9OyAvLyBEb24ndCByZS1yZXNvbHZlIHdoZW4gcmVhY3RpdmF0aW5nIHN0YXRlcyAoZml4ZXMgaXNzdWUgIzIyKQ0KICAgICAgICAgICAgLy8gVE9ETzogTm90IDEwMCUgc3VyZSBpZiB0aGlzIGlzIG5lY2Vzc2FyeS4gIEkgdGhpbmsgcmVzb2x2ZVN0YXRlIHdpbGwgbG9hZCB0aGUgdmlld3MgaWYgSSBkb24ndCBkbyB0aGlzLg0KICAgICAgICAgICAgc3Vycm9nYXRlLnZpZXdzID0ge307IC8vIERvbid0IHJlLWFjdGl2YXRlIGNvbnRyb2xsZXJzIHdoZW4gcmVhY3RpdmF0aW5nIHN0YXRlcyAoZml4ZXMgaXNzdWUgIzIyKQ0KICAgICAgICAgICAgc3Vycm9nYXRlLnNlbGYub25FbnRlciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgLy8gdWktcm91dGVyIHNldHMgbG9jYWxzIG9uIHRoZSBzdXJyb2dhdGUgdG8gYSBibGFuayBsb2NhbHMgKGJlY2F1c2Ugd2UgZ2F2ZSBpdCBub3RoaW5nIHRvIHJlc29sdmUpDQogICAgICAgICAgICAgIC8vIFJlLXNldCBpdCBiYWNrIHRvIHRoZSBhbHJlYWR5IGxvYWRlZCBzdGF0ZS5sb2NhbHMgaGVyZS4NCiAgICAgICAgICAgICAgc3Vycm9nYXRlLmxvY2FscyA9IHN0YXRlLmxvY2FsczsNCiAgICAgICAgICAgICAgX1N0aWNreVN0YXRlLnN0YXRlUmVhY3RpdmF0ZWQoc3RhdGUpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHJlc3RvcmUuYWRkUmVzdG9yZUZ1bmN0aW9uKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgc3RhdGUuc2VsZi5vbkVudGVyID0gb2xkT25FbnRlcjsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcmV0dXJuIHN1cnJvZ2F0ZTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBzdGF0ZUluYWN0aXZhdGVkU3Vycm9nYXRlKHN0YXRlKSB7DQogICAgICAgICAgICB2YXIgc3Vycm9nYXRlID0gbmV3IFN1cnJvZ2F0ZVN0YXRlKCJpbmFjdGl2YXRlIik7DQogICAgICAgICAgICBzdXJyb2dhdGUuc2VsZiA9IHN0YXRlLnNlbGY7DQogICAgICAgICAgICB2YXIgb2xkT25FeGl0ID0gc3RhdGUuc2VsZi5vbkV4aXQ7DQogICAgICAgICAgICBzdXJyb2dhdGUuc2VsZi5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIF9TdGlja3lTdGF0ZS5zdGF0ZUluYWN0aXZhdGVkKHN0YXRlKTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICByZXN0b3JlLmFkZFJlc3RvcmVGdW5jdGlvbihmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIHN0YXRlLnNlbGYub25FeGl0ID0gb2xkT25FeGl0Ow0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICByZXR1cm4gc3Vycm9nYXRlOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHN0YXRlRW50ZXJlZFN1cnJvZ2F0ZShzdGF0ZSwgdG9QYXJhbXMpIHsNCiAgICAgICAgICAgIHZhciBvbGRPbkVudGVyID0gc3RhdGUuc2VsZi5vbkVudGVyOw0KICAgICAgICAgICAgc3RhdGUuc2VsZi5vbkVudGVyID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICBfU3RpY2t5U3RhdGUuc3RhdGVFbnRlcmluZyhzdGF0ZSwgdG9QYXJhbXMsIG9sZE9uRW50ZXIpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHJlc3RvcmUuYWRkUmVzdG9yZUZ1bmN0aW9uKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgc3RhdGUuc2VsZi5vbkVudGVyID0gb2xkT25FbnRlcjsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICByZXR1cm4gc3RhdGU7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gVE9ETzogVGhpcyBtYXkgYmUgY29tcGxldGVseSB1bm5lY2Vzc2FyeSBub3cgdGhhdCB3ZSdyZSB1c2luZyAkJHVpcm91dGVyZXh0cmFzcmVsb2FkIHRlbXAgcGFyYW0NCiAgICAgICAgICBmdW5jdGlvbiBzdGF0ZVVwZGF0ZVBhcmFtc1N1cnJvZ2F0ZShzdGF0ZSwgdG9QYXJhbXMpIHsNCiAgICAgICAgICAgIHZhciBvbGRPbkVudGVyID0gc3RhdGUuc2VsZi5vbkVudGVyOw0KICAgICAgICAgICAgc3RhdGUuc2VsZi5vbkVudGVyID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICBfU3RpY2t5U3RhdGUuc3RhdGVFbnRlcmluZyhzdGF0ZSwgdG9QYXJhbXMsIG9sZE9uRW50ZXIsIHRydWUpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHJlc3RvcmUuYWRkUmVzdG9yZUZ1bmN0aW9uKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgc3RhdGUuc2VsZi5vbkVudGVyID0gb2xkT25FbnRlcjsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICByZXR1cm4gc3RhdGU7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gc3RhdGVFeGl0ZWRTdXJyb2dhdGUoc3RhdGUpIHsNCiAgICAgICAgICAgIHZhciBvbGRPbkV4aXQgPSBzdGF0ZS5zZWxmLm9uRXhpdDsNCiAgICAgICAgICAgIHN0YXRlLnNlbGYub25FeGl0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICBfU3RpY2t5U3RhdGUuc3RhdGVFeGl0aW5nKHN0YXRlLCBleGl0ZWQsIG9sZE9uRXhpdCk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgcmVzdG9yZS5hZGRSZXN0b3JlRnVuY3Rpb24oZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICBzdGF0ZS5zZWxmLm9uRXhpdCA9IG9sZE9uRXhpdDsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICByZXR1cm4gc3RhdGU7DQogICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0gZGVjb3JhdGVkIC50cmFuc2l0aW9uVG8oKSBsb2dpYyBzdGFydHMgaGVyZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICBpZiAodG9TdGF0ZVNlbGYpIHsNCiAgICAgICAgICAgIHZhciB0b1N0YXRlID0gaW50ZXJuYWxTdGF0ZXNbdG9TdGF0ZVNlbGYubmFtZV07IC8vIGhhdmUgdGhlIHN0YXRlLCBub3cgZ3JhYiB0aGUgaW50ZXJuYWwgc3RhdGUgcmVwcmVzZW50YXRpb24NCiAgICAgICAgICAgIGlmICh0b1N0YXRlKSB7DQogICAgICAgICAgICAgIC8vIFNhdmUgdGhlIHRvU3RhdGUgYW5kIGZyb21TdGF0ZSBwYXRocyB0byBiZSByZXN0b3JlZCB1c2luZyByZXN0b3JlKCkNCiAgICAgICAgICAgICAgc2F2ZWRUb1N0YXRlUGF0aCA9IHRvU3RhdGUucGF0aDsNCiAgICAgICAgICAgICAgc2F2ZWRGcm9tU3RhdGVQYXRoID0gZnJvbVN0YXRlLnBhdGg7DQoNCiAgICAgICAgICAgICAgLy8gVHJ5IHRvIHJlc29sdmUgb3B0aW9ucy5yZWxvYWQgdG8gYSBzdGF0ZS4gIElmIHNvLCB3ZSdsbCByZWxvYWQgb25seSB1cCB0byB0aGUgZ2l2ZW4gc3RhdGUuDQogICAgICAgICAgICAgIHZhciByZWxvYWQgPSBvcHRpb25zICYmIG9wdGlvbnMucmVsb2FkIHx8IGZhbHNlOw0KICAgICAgICAgICAgICB2YXIgcmVsb2FkU3RhdGVUcmVlID0gcmVsb2FkICYmIChyZWxvYWQgPT09IHRydWUgPyBzYXZlZFRvU3RhdGVQYXRoWzBdLnNlbGYgOiAkc3RhdGUuZ2V0KHJlbG9hZCwgcmVsKSk7DQogICAgICAgICAgICAgIC8vIElmIG9wdGlvbnMucmVsb2FkIGlzIGEgc3RyaW5nIG9yIGEgc3RhdGUsIHdlIHdhbnQgdG8gaGFuZGxlIHJlbG9hZCBvdXJzZWx2ZXMgYW5kIG5vdA0KICAgICAgICAgICAgICAvLyBsZXQgdWktcm91dGVyIHJlbG9hZCB0aGUgZW50aXJlIHRvUGF0aC4NCiAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgcmVsb2FkICYmIHJlbG9hZCAhPT0gdHJ1ZSkNCiAgICAgICAgICAgICAgICBkZWxldGUgb3B0aW9ucy5yZWxvYWQ7DQoNCiAgICAgICAgICAgICAgdmFyIGN1cnJlbnRUcmFuc2l0aW9uID0gew0KICAgICAgICAgICAgICAgIHRvU3RhdGU6IHRvU3RhdGUsDQogICAgICAgICAgICAgICAgdG9QYXJhbXM6IHRvUGFyYW1zIHx8IHt9LA0KICAgICAgICAgICAgICAgIGZyb21TdGF0ZTogZnJvbVN0YXRlLA0KICAgICAgICAgICAgICAgIGZyb21QYXJhbXM6IGZyb21QYXJhbXMgfHwge30sDQogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucywNCiAgICAgICAgICAgICAgICByZWxvYWRTdGF0ZVRyZWU6IHJlbG9hZFN0YXRlVHJlZQ0KICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgIHBlbmRpbmdUcmFuc2l0aW9ucy5wdXNoKGN1cnJlbnRUcmFuc2l0aW9uKTsgLy8gVE9ETzogU2VlIGlmIGEgbGlzdCBvZiBwZW5kaW5nIHRyYW5zaXRpb25zIGlzIG5lY2Vzc2FyeS4NCiAgICAgICAgICAgICAgcGVuZGluZ1Jlc3RvcmUgPSByZXN0b3JlOw0KDQogICAgICAgICAgICAgIC8vIElmIHdlJ3JlIHJlbG9hZGluZyBmcm9tIGEgc3RhdGUgYW5kIGJlbG93LCB0ZW1wb3JhcmlseSBhZGQgYSBwYXJhbSB0byB0aGUgdG9wIG9mIHRoZSBzdGF0ZSB0cmVlDQogICAgICAgICAgICAgIC8vIGJlaW5nIHJlbG9hZGVkLCBhbmQgYWRkIGEgcGFyYW0gdmFsdWUgdG8gdGhlIHRyYW5zaXRpb24uICBUaGlzIHdpbGwgY2F1c2UgdGhlICJoYXMgcGFyYW1zIGNoYW5nZWQNCiAgICAgICAgICAgICAgLy8gZm9yIHN0YXRlIiBjaGVjayB0byByZXR1cm4gdHJ1ZSwgYW5kIHRoZSBzdGF0ZXMgd2lsbCBiZSByZWxvYWRlZC4NCiAgICAgICAgICAgICAgaWYgKHJlbG9hZFN0YXRlVHJlZSkgew0KICAgICAgICAgICAgICAgIGN1cnJlbnRUcmFuc2l0aW9uLnRvUGFyYW1zLiQkdWlyb3V0ZXJleHRyYXNyZWxvYWQgPSBNYXRoLnJhbmRvbSgpOw0KICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSByZWxvYWRTdGF0ZVRyZWUuJCRzdGF0ZSgpLnBhcmFtczsNCiAgICAgICAgICAgICAgICB2YXIgb3duUGFyYW1zID0gcmVsb2FkU3RhdGVUcmVlLiQkc3RhdGUoKS5vd25QYXJhbXM7DQoNCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbkhldXJpc3RpY3MuaGFzUGFyYW1TZXQpIHsNCiAgICAgICAgICAgICAgICAgIHZhciB0ZW1wUGFyYW0gPSBuZXcgJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXIuUGFyYW0oJyQkdWlyb3V0ZXJleHRyYXNyZWxvYWQnKTsNCiAgICAgICAgICAgICAgICAgIHBhcmFtcy4kJHVpcm91dGVyZXh0cmFzcmVsb2FkID0gb3duUGFyYW1zLiQkdWlyb3V0ZXJleHRyYXNyZWxvYWQgPSB0ZW1wUGFyYW07DQogICAgICAgICAgICAgICAgICByZXN0b3JlLnJlc3RvcmVGdW5jdGlvbnMucHVzaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHBhcmFtcy4kJHVpcm91dGVyZXh0cmFzcmVsb2FkOw0KICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3duUGFyYW1zLiQkdWlyb3V0ZXJleHRyYXNyZWxvYWQ7DQogICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJyQkdWlyb3V0ZXJleHRyYXNyZWxvYWQnKTsNCiAgICAgICAgICAgICAgICAgIG93blBhcmFtcy5wdXNoKCckJHVpcm91dGVyZXh0cmFzcmVsb2FkJyk7DQogICAgICAgICAgICAgICAgICByZXN0b3JlLnJlc3RvcmVGdW5jdGlvbnMucHVzaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmxlbmd0aCA9IHBhcmFtcy5sZW5ndGggLTE7DQogICAgICAgICAgICAgICAgICAgIG93blBhcmFtcy5sZW5ndGggPSBvd25QYXJhbXMubGVuZ3RoIC0xOw0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgLy8gJFN0aWNreVN0YXRlUHJvdmlkZXIucHJvY2Vzc1RyYW5zaXRpb24gYW5hbHl6ZXMgdGhlIHN0YXRlcyBpbnZvbHZlZCBpbiB0aGUgcGVuZGluZyB0cmFuc2l0aW9uLiAgSXQNCiAgICAgICAgICAgICAgLy8gcmV0dXJucyBhbiBvYmplY3QgdGhhdCB0ZWxscyB1czoNCiAgICAgICAgICAgICAgLy8gMSkgaWYgd2UncmUgaW52b2x2ZWQgaW4gYSBzdGlja3ktdHlwZSB0cmFuc2l0aW9uDQogICAgICAgICAgICAgIC8vIDIpIHdoYXQgdHlwZXMgb2YgZXhpdCB0cmFuc2l0aW9ucyB3aWxsIG9jY3VyIGZvciBlYWNoICJleGl0ZWQiIHBhdGggZWxlbWVudA0KICAgICAgICAgICAgICAvLyAzKSB3aGF0IHR5cGVzIG9mIGVudGVyIHRyYW5zaXRpb25zIHdpbGwgb2NjdXIgZm9yIGVhY2ggImVudGVyZWQiIHBhdGggZWxlbWVudA0KICAgICAgICAgICAgICAvLyA0KSB3aGljaCBzdGF0ZXMgd2lsbCBiZSBpbmFjdGl2ZSBpZiB0aGUgdHJhbnNpdGlvbiBzdWNjZWVkcy4NCiAgICAgICAgICAgICAgc3RpY2t5VHJhbnNpdGlvbnMgPSBfU3RpY2t5U3RhdGUucHJvY2Vzc1RyYW5zaXRpb24oY3VycmVudFRyYW5zaXRpb24pOw0KDQogICAgICAgICAgICAgIGlmIChERUJVRykgZGVidWdUcmFuc2l0aW9uKCRsb2csIGN1cnJlbnRUcmFuc2l0aW9uLCBzdGlja3lUcmFuc2l0aW9ucyk7DQoNCiAgICAgICAgICAgICAgLy8gQmVnaW4gcHJvY2Vzc2luZyBvZiBzdXJyb2dhdGUgdG8gYW5kIGZyb20gcGF0aHMuDQogICAgICAgICAgICAgIHZhciBzdXJyb2dhdGVUb1BhdGggPSB0b1N0YXRlLnBhdGguc2xpY2UoMCwgc3RpY2t5VHJhbnNpdGlvbnMua2VlcCk7DQogICAgICAgICAgICAgIHZhciBzdXJyb2dhdGVGcm9tUGF0aCA9IGZyb21TdGF0ZS5wYXRoLnNsaWNlKDAsIHN0aWNreVRyYW5zaXRpb25zLmtlZXApOw0KDQogICAgICAgICAgICAgIC8vIENsZWFyIG91dCBhbmQgcmVsb2FkIGluYWN0aXZlUHNldWRvU3RhdGUubG9jYWxzIGVhY2ggdGltZSB0cmFuc2l0aW9uVG8gaXMgY2FsbGVkDQogICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpbmFjdGl2ZVBzZXVkb1N0YXRlLmxvY2FscywgZnVuY3Rpb24gKGxvY2FsLCBuYW1lKSB7DQogICAgICAgICAgICAgICAgaWYgKG5hbWUuaW5kZXhPZigiQCIpICE9IC0xKSBkZWxldGUgaW5hY3RpdmVQc2V1ZG9TdGF0ZS5sb2NhbHNbbmFtZV07DQogICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgIHZhciBzYXZlVmlld3NUb0xvY2FscyA9IGZ1bmN0aW9uICh0YXJnZXRPYmopIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odmlldywgbmFtZSkgew0KICAgICAgICAgICAgICAgICAgaWYgKG5hbWUuaW5kZXhPZigiQCIpICE9PSAtMSkgeyAvLyBPbmx5IGdyYWIgdGhpcyBzdGF0ZSdzICJ2aWV3IiBsb2NhbHMNCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0T2JqW25hbWVdID0gdmlldzsgLy8gQWRkIGFsbCBpbmFjdGl2ZSB2aWV3cyBub3QgYWxyZWFkeSBpbmNsdWRlZC4NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgLy8gRm9yIGVhY2ggc3RhdGUgdGhhdCB3aWxsIGJlIGluYWN0aXZlIHdoZW4gdGhlIHRyYW5zaXRpb24gaXMgY29tcGxldGUsIHBsYWNlIGl0cyB2aWV3LWxvY2FscyBvbiB0aGUNCiAgICAgICAgICAgICAgLy8gX19pbmFjdGl2ZXMgcHNldWRvc3RhdGUncyAubG9jYWxzLiAgVGhpcyBhbGxvd3MgdGhlIHVpLXZpZXcgZGlyZWN0aXZlIHRvIGFjY2VzcyB0aGVtIGFuZA0KICAgICAgICAgICAgICAvLyByZW5kZXIgdGhlIGluYWN0aXZlIHZpZXdzLg0KICAgICAgICAgICAgICBmb3JFYWNoKHN0aWNreVRyYW5zaXRpb25zLmluYWN0aXZlcywgZnVuY3Rpb24oc3RhdGUpIHsNCiAgICAgICAgICAgICAgICBmb3JFYWNoKHN0YXRlLmxvY2Fscywgc2F2ZVZpZXdzVG9Mb2NhbHMoaW5hY3RpdmVQc2V1ZG9TdGF0ZS5sb2NhbHMpKQ0KICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAvLyBGb3IgZWFjaCBzdGF0ZSB0aGF0IHdpbGwgYmUgcmVhY3RpdmF0ZWQgZHVyaW5nIHRoZSB0cmFuc2l0aW9uLCBwbGFjZSBpdHMgdmlldy1sb2NhbHMgb24gYSBzZXBhcmF0ZQ0KICAgICAgICAgICAgICAvLyBsb2NhbHMgb2JqZWN0IChwcm90b3R5cGFsIHBhcmVudCBvZiBfX2luYWN0aXZlcy5sb2NhbHMsIGFuZCByZW1vdmUgdGhlbSB3aGVuIHRoZSB0cmFuc2l0aW9uIGlzIGNvbXBsZXRlLg0KICAgICAgICAgICAgICAvLyBUaGlzIGlzIG5lY2Vzc2FyeSB3aGVuIHdlIGEgdHJhbnNpdGlvbiB3aWxsIHJlYWN0aXZhdGUgb25lIHN0YXRlLCBidXQgZW50ZXIgYSBzZWNvbmQuDQogICAgICAgICAgICAgIC8vIEdvcnkgZGV0YWlsczoNCiAgICAgICAgICAgICAgLy8gICAtIHRoZSBlbnRlcmluZyBvZiBhIG5ldyBzdGF0ZSBjYXVzZXMgJHZpZXcubG9hZCgpIHRvIGZpcmUgJHZpZXdDb250ZW50TG9hZGluZyB3aGlsZSB0aGUgdHJhbnNpdGlvbiBpcw0KICAgICAgICAgICAgICAvLyAgICAgc3RpbGwgaW4gcHJvY2Vzcw0KICAgICAgICAgICAgICAvLyAgIC0gYWxsIHVpLXZpZXcocykgY2hlY2sgaWYgdGhleSBzaG91bGQgcmUtcmVuZGVyIHRoZW1zZWx2ZXMgaW4gcmVzcG9uc2UgdG8gdGhpcyBldmVudC4NCiAgICAgICAgICAgICAgLy8gICAtIHVpLXZpZXcgY2hlY2tzIGlmIHByZXZpb3VzTG9jYWxzIGlzIGVxdWFsIHRvIGN1cnJlbnRMb2NhbHMNCiAgICAgICAgICAgICAgLy8gICAgIC0gaXQgdXNlcyAkc3RhdGUuJGN1cnJlbnQubG9jYWxzW215Vmlld05hbWVdIGZvciBwcmV2aW91c0xvY2Fscw0KICAgICAgICAgICAgICAvLyAgIC0gQmVjYXVzZSB0aGUgdHJhbnNpdGlvbiBpcyBub3QgY29tcGxldGVkLCAkc3RhdGUuJGN1cnJlbnQgaXMgc2V0IHRvIHRoZSBmcm9tIHN0YXRlLCBhbmQNCiAgICAgICAgICAgICAgLy8gICAgIHRoZSB1aS12aWV3IGZvciBhIHJlYWN0aXZhdGVkIHN0YXRlIGNhbm5vdCBmaW5kIGl0cyBwcmV2aW91cyBsb2NhbHMuDQogICAgICAgICAgICAgIGZvckVhY2goc3RpY2t5VHJhbnNpdGlvbnMucmVhY3RpdmF0aW5nU3RhdGVzLCBmdW5jdGlvbihzdGF0ZSkgew0KICAgICAgICAgICAgICAgIGZvckVhY2goc3RhdGUubG9jYWxzLCBzYXZlVmlld3NUb0xvY2FscyhyZWFjdGl2YXRpbmdMb2NhbHMpKTsNCiAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgLy8gV2hlbiB0aGUgdHJhbnNpdGlvbiBpcyBjb21wbGV0ZSwgcmVtb3ZlIHRoZSBjb3BpZXMgb2YgdGhlIHZpZXcgbG9jYWxzIGZyb20gcmVhY3RpdmF0aW5nTG9jYWxzLg0KICAgICAgICAgICAgICByZXN0b3JlLmFkZFJlc3RvcmVGdW5jdGlvbihmdW5jdGlvbiBjbGVhclJlYWN0aXZhdGluZ0xvY2FscygpIHsNCiAgICAgICAgICAgICAgICBmb3JFYWNoKHJlYWN0aXZhdGluZ0xvY2FscywgZnVuY3Rpb24gKHZhbCwgdmlld25hbWUpIHsNCiAgICAgICAgICAgICAgICAgIGRlbGV0ZSByZWFjdGl2YXRpbmdMb2NhbHNbdmlld25hbWVdOw0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgIC8vIEZpbmQgYWxsIHRoZSBzdGF0ZXMgdGhlIHRyYW5zaXRpb24gd2lsbCBiZSBlbnRlcmluZy4gIEZvciBlYWNoIGVudGVyZWQgc3RhdGUsIGNoZWNrIGVudGVyZWQtc3RhdGUtdHJhbnNpdGlvbi10eXBlDQogICAgICAgICAgICAgIC8vIERlcGVuZGluZyBvbiB0aGUgZW50ZXJlZC1zdGF0ZSB0cmFuc2l0aW9uIHR5cGUsIHBsYWNlIHRoZSBwcm9wZXIgc3Vycm9nYXRlIHN0YXRlIG9uIHRoZSBzdXJyb2dhdGUgdG9QYXRoLg0KICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goc3RpY2t5VHJhbnNpdGlvbnMuZW50ZXIsIGZ1bmN0aW9uICh2YWx1ZSwgaWR4KSB7DQogICAgICAgICAgICAgICAgdmFyIHN1cnJvZ2F0ZTsNCiAgICAgICAgICAgICAgICB2YXIgZW50ZXJpbmdTdGF0ZSA9IHRvU3RhdGUucGF0aFtpZHhdOw0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gInJlYWN0aXZhdGUiKSB7DQogICAgICAgICAgICAgICAgICAvLyBSZWFjdGl2YXRlZCBzdGF0ZXMgcmVxdWlyZSBUV08gc3Vycm9nYXRlcy4gIFRoZSAicGhhc2UgMSByZWFjdGl2YXRlZCBzdXJyb2dhdGVzIiBhcmUgYWRkZWQgdG8gYm90aA0KICAgICAgICAgICAgICAgICAgLy8gdG8ucGF0aCBhbmQgZnJvbS5wYXRoLCBhbmQgYXMgc3VjaCwgYXJlIGNvbnNpZGVyZWQgdG8gYmUgImtlcHQiIGJ5IFVJLVJvdXRlci4NCiAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgcmVxdWlyZWQgdG8gZ2V0IFVJLVJvdXRlciB0byBhZGQgdGhlIHN1cnJvZ2F0ZSBsb2NhbHMgdG8gdGhlIHByb3RveXBhbCBsb2NhbHMgb2JqZWN0DQogICAgICAgICAgICAgICAgICBzdXJyb2dhdGUgPSBzdGF0ZVJlYWN0aXZhdGVkU3Vycm9nYXRlUGhhc2UxKGVudGVyaW5nU3RhdGUpOw0KICAgICAgICAgICAgICAgICAgc3Vycm9nYXRlVG9QYXRoLnB1c2goc3Vycm9nYXRlKTsNCiAgICAgICAgICAgICAgICAgIHN1cnJvZ2F0ZUZyb21QYXRoLnB1c2goc3Vycm9nYXRlKTsgIC8vIHNvIHRvUGF0aFtpXSA9PT0gZnJvbVBhdGhbaV0NCg0KICAgICAgICAgICAgICAgICAgLy8gVGhlICJwaGFzZSAyIHJlYWN0aXZhdGVkIHN1cnJvZ2F0ZSIgaXMgYWRkZWQgdG8gdGhlIEVORCBvZiB0aGUgLnBhdGgsIGFmdGVyIGFsbCB0aGUgcGhhc2UgMQ0KICAgICAgICAgICAgICAgICAgLy8gc3Vycm9nYXRlcyBoYXZlIGJlZW4gYWRkZWQuDQogICAgICAgICAgICAgICAgICByZWFjdGl2YXRlZC5wdXNoKHN0YXRlUmVhY3RpdmF0ZWRTdXJyb2dhdGVQaGFzZTIoZW50ZXJpbmdTdGF0ZSkpOw0KICAgICAgICAgICAgICAgICAgdGVybWluYWxSZWFjdGl2YXRlZFN0YXRlID0gZW50ZXJpbmdTdGF0ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAidXBkYXRlU3RhdGVQYXJhbXMiKSB7DQogICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgc3RhdGUgcGFyYW1zIGhhdmUgYmVlbiBjaGFuZ2VkLCB3ZSBuZWVkIHRvIGV4aXQgYW55IGluYWN0aXZlIHN0YXRlcyBhbmQgcmUtZW50ZXIgdGhlbS4NCiAgICAgICAgICAgICAgICAgIHN1cnJvZ2F0ZVRvUGF0aC5wdXNoKHN0YXRlVXBkYXRlUGFyYW1zU3Vycm9nYXRlKGVudGVyaW5nU3RhdGUpKTsNCiAgICAgICAgICAgICAgICAgIHRlcm1pbmFsUmVhY3RpdmF0ZWRTdGF0ZSA9IGVudGVyaW5nU3RhdGU7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gImVudGVyIikgew0KICAgICAgICAgICAgICAgICAgLy8gU3RhbmRhcmQgZW50ZXIgdHJhbnNpdGlvbi4gIFdlIHN0aWxsIHdyYXAgaXQgaW4gYSBzdXJyb2dhdGUuDQogICAgICAgICAgICAgICAgICBzdXJyb2dhdGVUb1BhdGgucHVzaChzdGF0ZUVudGVyZWRTdXJyb2dhdGUoZW50ZXJpbmdTdGF0ZSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgLy8gRmluZCBhbGwgdGhlIHN0YXRlcyB0aGUgdHJhbnNpdGlvbiB3aWxsIGJlIGV4aXRpbmcuICBGb3IgZWFjaCBleGl0ZWQgc3RhdGUsIGNoZWNrIHRoZSBleGl0ZWQtc3RhdGUtdHJhbnNpdGlvbi10eXBlLg0KICAgICAgICAgICAgICAvLyBEZXBlbmRpbmcgb24gdGhlIGV4aXRlZC1zdGF0ZSB0cmFuc2l0aW9uIHR5cGUsIHBsYWNlIGEgc3Vycm9nYXRlIHN0YXRlIG9uIHRoZSBzdXJyb2dhdGUgZnJvbVBhdGguDQogICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChzdGlja3lUcmFuc2l0aW9ucy5leGl0LCBmdW5jdGlvbiAodmFsdWUsIGlkeCkgew0KICAgICAgICAgICAgICAgIHZhciBleGl0aW5nID0gZnJvbVN0YXRlLnBhdGhbaWR4XTsNCiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09ICJpbmFjdGl2YXRlIikgew0KICAgICAgICAgICAgICAgICAgc3Vycm9nYXRlRnJvbVBhdGgucHVzaChzdGF0ZUluYWN0aXZhdGVkU3Vycm9nYXRlKGV4aXRpbmcpKTsNCiAgICAgICAgICAgICAgICAgIGV4aXRlZC5wdXNoKGV4aXRpbmcpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJleGl0Iikgew0KICAgICAgICAgICAgICAgICAgc3Vycm9nYXRlRnJvbVBhdGgucHVzaChzdGF0ZUV4aXRlZFN1cnJvZ2F0ZShleGl0aW5nKSk7DQogICAgICAgICAgICAgICAgICBleGl0ZWQucHVzaChleGl0aW5nKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgIC8vIEFkZCBzdXJyb2dhdGUgc3RhdGVzIGZvciByZWFjdGl2YXRlZCB0byBUb1BhdGggYWdhaW4gKHBoYXNlIDIpLCB0aGlzIHRpbWUgd2l0aG91dCBhIG1hdGNoaW5nIEZyb21QYXRoIGVudHJ5DQogICAgICAgICAgICAgIC8vIFRoaXMgaXMgdG8gZ2V0IHVpLXJvdXRlciB0byBjYWxsIHRoZSBzdXJyb2dhdGUncyBvbkVudGVyIGNhbGxiYWNrLg0KICAgICAgICAgICAgICBpZiAocmVhY3RpdmF0ZWQubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJlYWN0aXZhdGVkLCBmdW5jdGlvbiAoc3Vycm9nYXRlKSB7DQogICAgICAgICAgICAgICAgICBzdXJyb2dhdGVUb1BhdGgucHVzaChzdXJyb2dhdGUpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgLy8gV2UgbWF5IHRyYW5zaXRpb24gZGlyZWN0bHkgdG8gYW4gaW5hY3RpdmF0ZWQgc3RhdGUsIHJlYWN0aXZhdGluZyBpdC4gIEluIHRoaXMgY2FzZSwgd2Ugc2hvdWxkDQogICAgICAgICAgICAgIC8vIGV4aXQgYWxsIG9mIHRoYXQgc3RhdGUncyBpbmFjdGl2YXRlZCBjaGlsZHJlbi4NCiAgICAgICAgICAgICAgdmFyIGluYWN0aXZlT3JwaGFucyA9IHN0aWNreVRyYW5zaXRpb25zLmRlZXBlc3RSZWFjdGl2YXRlQ2hpbGRyZW47DQogICAgICAgICAgICAgIC8vIEFkZCBzdXJyb2dhdGUgZXhpdGVkIHN0YXRlcyBmb3IgYWxsIG9ycGhhbmVkIGRlc2NlbmRhbnRzIG9mIHRoZSBEZWVwZXN0IFJlYWN0aXZhdGVkIFN0YXRlDQogICAgICAgICAgICAgIHN1cnJvZ2F0ZUZyb21QYXRoID0gc3Vycm9nYXRlRnJvbVBhdGguY29uY2F0KG1hcChzdGlja3lUcmFuc2l0aW9ucy5kZWVwZXN0UmVhY3RpdmF0ZUNoaWxkcmVuLCBmdW5jdGlvbiAoZXhpdGluZykgew0KICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZUV4aXRlZFN1cnJvZ2F0ZShleGl0aW5nKTsNCiAgICAgICAgICAgICAgfSkpOw0KICAgICAgICAgICAgICBleGl0ZWQgPSBleGl0ZWQuY29uY2F0KGluYWN0aXZlT3JwaGFucyk7DQoNCiAgICAgICAgICAgICAgLy8gUmVwbGFjZSB0aGUgLnBhdGggdmFyaWFibGVzLiAgdG9TdGF0ZS5wYXRoIGFuZCBmcm9tU3RhdGUucGF0aCBhcmUgbm93IHJlYWR5IGZvciBhIHN0aWNreSB0cmFuc2l0aW9uLg0KICAgICAgICAgICAgICBmcm9tU3RhdGUucGF0aCA9IHN1cnJvZ2F0ZUZyb21QYXRoOw0KICAgICAgICAgICAgICB0b1N0YXRlLnBhdGggPSBzdXJyb2dhdGVUb1BhdGg7DQoNCiAgICAgICAgICAgICAgdmFyIHBhdGhNZXNzYWdlID0gZnVuY3Rpb24gKHN0YXRlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIChzdGF0ZS5zdXJyb2dhdGVUeXBlID8gc3RhdGUuc3Vycm9nYXRlVHlwZSArICI6IiA6ICIiKSArIHN0YXRlLnNlbGYubmFtZTsNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgaWYgKERFQlVHKSAkbG9nLmRlYnVnKCJTdXJyb2dhdGVGcm9tUGF0aDogIiwgbWFwKHN1cnJvZ2F0ZUZyb21QYXRoLCBwYXRoTWVzc2FnZSkpOw0KICAgICAgICAgICAgICBpZiAoREVCVUcpICRsb2cuZGVidWcoIlN1cnJvZ2F0ZVRvUGF0aDogICAiLCBtYXAoc3Vycm9nYXRlVG9QYXRoLCBwYXRoTWVzc2FnZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIHRvU3RhdGUgYW5kIGZyb21TdGF0ZSBhcmUgYWxsIHNldCB1cDsgbm93IHJ1biBzdG9jayBVSS1Sb3V0ZXIncyAkc3RhdGUudHJhbnNpdGlvblRvKCkuDQogICAgICAgICAgdmFyIHRyYW5zaXRpb25Qcm9taXNlID0gJHN0YXRlX3RyYW5zaXRpb25Uby5hcHBseSgkc3RhdGUsIGFyZ3VtZW50cyk7DQoNCiAgICAgICAgICAvLyBBZGQgcG9zdC10cmFuc2l0aW9uIHByb21pc2UgaGFuZGxlcnMsIHRoZW4gcmV0dXJuIHRoZSBwcm9taXNlIHRvIHRoZSBvcmlnaW5hbCBjYWxsZXIuDQogICAgICAgICAgcmV0dXJuIHRyYW5zaXRpb25Qcm9taXNlLnRoZW4oZnVuY3Rpb24gdHJhbnNpdGlvblN1Y2Nlc3Moc3RhdGUpIHsNCiAgICAgICAgICAgIC8vIEZpcnN0LCByZXN0b3JlIHRvU3RhdGUgYW5kIGZyb21TdGF0ZSB0byB0aGVpciBvcmlnaW5hbCB2YWx1ZXMuDQogICAgICAgICAgICByZXN0b3JlKCk7DQogICAgICAgICAgICBpZiAoREVCVUcpICBkZWJ1Z1ZpZXdzQWZ0ZXJTdWNjZXNzKCRsb2csIGludGVybmFsU3RhdGVzW3N0YXRlLm5hbWVdLCAkc3RhdGUpOw0KDQogICAgICAgICAgICBzdGF0ZS5zdGF0dXMgPSAnYWN0aXZlJzsgIC8vIFRPRE86IFRoaXMgc3RhdHVzIGlzIHVzZWQgaW4gc3RhdGV2aXMuanMsIGFuZCBhbG1vc3QgY2VydGFpbmx5IGJlbG9uZ3MgZWxzZXdoZXJlLg0KDQogICAgICAgICAgICByZXR1cm4gc3RhdGU7DQogICAgICAgICAgfSwgZnVuY3Rpb24gdHJhbnNpdGlvbkZhaWxlZChlcnIpIHsNCiAgICAgICAgICAgIHJlc3RvcmUoKTsNCiAgICAgICAgICAgIGlmIChERUJVRyAmJg0KICAgICAgICAgICAgICBlcnIubWVzc2FnZSAhPT0gInRyYW5zaXRpb24gcHJldmVudGVkIiAmJg0KICAgICAgICAgICAgICBlcnIubWVzc2FnZSAhPT0gInRyYW5zaXRpb24gYWJvcnRlZCIgJiYNCiAgICAgICAgICAgICAgZXJyLm1lc3NhZ2UgIT09ICJ0cmFuc2l0aW9uIHN1cGVyc2VkZWQiKSB7DQogICAgICAgICAgICAgICRsb2cuZGVidWcoInRyYW5zaXRpb24gZmFpbGVkIiwgZXJyKTsNCiAgICAgICAgICAgICAgJGxvZy5kZWJ1ZyhlcnIuc3RhY2spOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChlcnIpOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9Ow0KICAgICAgICByZXR1cm4gJHN0YXRlOw0KICAgICAgfV0pOw0KDQoNCg0KICAgICAgZnVuY3Rpb24gZGVidWdUcmFuc2l0aW9uKCRsb2csIGN1cnJlbnRUcmFuc2l0aW9uLCBzdGlja3lUcmFuc2l0aW9uKSB7DQogICAgICAgIGZ1bmN0aW9uIG1lc3NhZ2UocGF0aCwgaW5kZXgsIHN0YXRlKSB7DQogICAgICAgICAgcmV0dXJuIChwYXRoW2luZGV4XSA/IHBhdGhbaW5kZXhdLnRvVXBwZXJDYXNlKCkgKyAiOiAiICsgc3RhdGUuc2VsZi5uYW1lIDogIigiICsgc3RhdGUuc2VsZi5uYW1lICsgIikiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBpbmFjdGl2ZUxvZ1ZhciA9IG1hcChzdGlja3lUcmFuc2l0aW9uLmluYWN0aXZlcywgZnVuY3Rpb24gKHN0YXRlKSB7DQogICAgICAgICAgcmV0dXJuIHN0YXRlLnNlbGYubmFtZTsNCiAgICAgICAgfSk7DQogICAgICAgIHZhciBlbnRlckxvZ1ZhciA9IG1hcChjdXJyZW50VHJhbnNpdGlvbi50b1N0YXRlLnBhdGgsIGZ1bmN0aW9uIChzdGF0ZSwgaW5kZXgpIHsNCiAgICAgICAgICByZXR1cm4gbWVzc2FnZShzdGlja3lUcmFuc2l0aW9uLmVudGVyLCBpbmRleCwgc3RhdGUpOw0KICAgICAgICB9KTsNCiAgICAgICAgdmFyIGV4aXRMb2dWYXIgPSBtYXAoY3VycmVudFRyYW5zaXRpb24uZnJvbVN0YXRlLnBhdGgsIGZ1bmN0aW9uIChzdGF0ZSwgaW5kZXgpIHsNCiAgICAgICAgICByZXR1cm4gbWVzc2FnZShzdGlja3lUcmFuc2l0aW9uLmV4aXQsIGluZGV4LCBzdGF0ZSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHZhciB0cmFuc2l0aW9uTWVzc2FnZSA9IGN1cnJlbnRUcmFuc2l0aW9uLmZyb21TdGF0ZS5zZWxmLm5hbWUgKyAiOiAiICsNCiAgICAgICAgICBhbmd1bGFyLnRvSnNvbihjdXJyZW50VHJhbnNpdGlvbi5mcm9tUGFyYW1zKSArICI6ICIgKw0KICAgICAgICAgICIgLT4gIiArDQogICAgICAgICAgY3VycmVudFRyYW5zaXRpb24udG9TdGF0ZS5zZWxmLm5hbWUgKyAiOiAiICsNCiAgICAgICAgICBhbmd1bGFyLnRvSnNvbihjdXJyZW50VHJhbnNpdGlvbi50b1BhcmFtcyk7DQoNCiAgICAgICAgJGxvZy5kZWJ1ZygiICAgQ3VycmVudCB0cmFuc2l0aW9uOiAiLCB0cmFuc2l0aW9uTWVzc2FnZSk7DQogICAgICAgICRsb2cuZGVidWcoIkJlZm9yZSB0cmFuc2l0aW9uLCBpbmFjdGl2ZXMgYXJlOiAgIDogIiwgbWFwKF9TdGlja3lTdGF0ZS5nZXRJbmFjdGl2ZVN0YXRlcygpLCBmdW5jdGlvbiAocykgew0KICAgICAgICAgIHJldHVybiBzLnNlbGYubmFtZTsNCiAgICAgICAgfSkpOw0KICAgICAgICAkbG9nLmRlYnVnKCJBZnRlciB0cmFuc2l0aW9uLCAgaW5hY3RpdmVzIHdpbGwgYmU6ICIsIGluYWN0aXZlTG9nVmFyKTsNCiAgICAgICAgJGxvZy5kZWJ1ZygiVHJhbnNpdGlvbiB3aWxsIGV4aXQ6ICAiLCBleGl0TG9nVmFyKTsNCiAgICAgICAgJGxvZy5kZWJ1ZygiVHJhbnNpdGlvbiB3aWxsIGVudGVyOiAiLCBlbnRlckxvZ1Zhcik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGRlYnVnVmlld3NBZnRlclN1Y2Nlc3MoJGxvZywgY3VycmVudFN0YXRlLCAkc3RhdGUpIHsNCiAgICAgICAgJGxvZy5kZWJ1ZygiQ3VycmVudCBzdGF0ZTogIiArIGN1cnJlbnRTdGF0ZS5zZWxmLm5hbWUgKyAiLCBpbmFjdGl2ZSBzdGF0ZXM6ICIsIG1hcChfU3RpY2t5U3RhdGUuZ2V0SW5hY3RpdmVTdGF0ZXMoKSwgZnVuY3Rpb24gKHMpIHsNCiAgICAgICAgICByZXR1cm4gcy5zZWxmLm5hbWU7DQogICAgICAgIH0pKTsNCg0KICAgICAgICB2YXIgdmlld01zZyA9IGZ1bmN0aW9uIChsb2NhbCwgbmFtZSkgew0KICAgICAgICAgIHJldHVybiAiJyIgKyBuYW1lICsgIicgKCIgKyBsb2NhbC4kJHN0YXRlLm5hbWUgKyAiKSI7DQogICAgICAgIH07DQogICAgICAgIHZhciBzdGF0ZXNPbmx5ID0gZnVuY3Rpb24gKGxvY2FsLCBuYW1lKSB7DQogICAgICAgICAgcmV0dXJuIG5hbWUgIT0gJ2dsb2JhbHMnICYmIG5hbWUgIT0gJ3Jlc29sdmUnOw0KICAgICAgICB9Ow0KICAgICAgICB2YXIgdmlld3NGb3JTdGF0ZSA9IGZ1bmN0aW9uIChzdGF0ZSkgew0KICAgICAgICAgIHZhciB2aWV3cyA9IG1hcChmaWx0ZXJPYmooc3RhdGUubG9jYWxzLCBzdGF0ZXNPbmx5KSwgdmlld01zZykuam9pbigiLCAiKTsNCiAgICAgICAgICByZXR1cm4gIigiICsgKHN0YXRlLnNlbGYubmFtZSA/IHN0YXRlLnNlbGYubmFtZSA6ICJyb290IikgKyAiLmxvY2FscyIgKyAodmlld3MubGVuZ3RoID8gIjogIiArIHZpZXdzIDogIiIpICsgIikiOw0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBtZXNzYWdlID0gdmlld3NGb3JTdGF0ZShjdXJyZW50U3RhdGUpOw0KICAgICAgICB2YXIgcGFyZW50ID0gY3VycmVudFN0YXRlLnBhcmVudDsNCiAgICAgICAgd2hpbGUgKHBhcmVudCAmJiBwYXJlbnQgIT09IGN1cnJlbnRTdGF0ZSkgew0KICAgICAgICAgIGlmIChwYXJlbnQuc2VsZi5uYW1lID09PSAiIikgew0KICAgICAgICAgICAgLy8gU2hvdyB0aGUgX19pbmFjdGl2ZXMgYmVmb3JlIHNob3dpbmcgcm9vdCBzdGF0ZS4NCiAgICAgICAgICAgIG1lc3NhZ2UgPSB2aWV3c0ZvclN0YXRlKCRzdGF0ZS4kY3VycmVudC5wYXRoWzBdKSArICIgLyAiICsgbWVzc2FnZTsNCiAgICAgICAgICB9DQogICAgICAgICAgbWVzc2FnZSA9IHZpZXdzRm9yU3RhdGUocGFyZW50KSArICIgLyAiICsgbWVzc2FnZTsNCiAgICAgICAgICBjdXJyZW50U3RhdGUgPSBwYXJlbnQ7DQogICAgICAgICAgcGFyZW50ID0gY3VycmVudFN0YXRlLnBhcmVudDsNCiAgICAgICAgfQ0KDQogICAgICAgICRsb2cuZGVidWcoIlZpZXdzOiAiICsgbWVzc2FnZSk7DQogICAgICB9DQogICAgfQ0KICBdDQopOw0KDQooZnVuY3Rpb24oYW5ndWxhciwgdW5kZWZpbmVkKSB7DQogIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY3QudWkucm91dGVyLmV4dHJhcy5mdXR1cmUnLCBbICdjdC51aS5yb3V0ZXIuZXh0cmFzLmNvcmUnIF0pOw0KDQogIF9mdXR1cmVTdGF0ZVByb3ZpZGVyLiRpbmplY3QgPSBbICckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLCAnJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXInLCAndWlyZXh0cmFzX2NvcmVQcm92aWRlcicgXTsNCiAgZnVuY3Rpb24gX2Z1dHVyZVN0YXRlUHJvdmlkZXIoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJHVybE1hdGNoZXJGYWN0b3J5LCB1aXJleHRyYXNfY29yZVByb3ZpZGVyKSB7DQogICAgdmFyIGNvcmUgPSB1aXJleHRyYXNfY29yZVByb3ZpZGVyOw0KICAgIHZhciBpbnRlcm5hbFN0YXRlcyA9IGNvcmUuaW50ZXJuYWxTdGF0ZXM7DQogICAgdmFyIHN0YXRlRmFjdG9yaWVzID0ge30sIGZ1dHVyZVN0YXRlcyA9IHt9Ow0KICAgIHZhciBsYXp5bG9hZEluUHJvZ3Jlc3MgPSBmYWxzZSwgcmVzb2x2ZUZ1bmN0aW9ucyA9IFtdLCBpbml0UHJvbWlzZSwgaW5pdERvbmUgPSBmYWxzZTsNCiAgICB2YXIgcHJvdmlkZXIgPSB0aGlzOw0KDQogICAgLy8gVGhpcyBmdW5jdGlvbiByZWdpc3RlcnMgYSBwcm9taXNlRm4sIHRvIGJlIHJlc29sdmVkIGJlZm9yZSB0aGUgdXJsL3N0YXRlIG1hdGNoaW5nIGNvZGUNCiAgICAvLyB3aWxsIHJlamVjdCBhIHJvdXRlLiAgVGhlIHByb21pc2VGbiBpcyBpbmplY3RlZC9leGVjdXRlZCB1c2luZyB0aGUgcnVudGltZSAkaW5qZWN0b3IuDQogICAgLy8gVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBwcm9taXNlLg0KICAgIC8vIFdoZW4gYWxsIHJlZ2lzdGVyZWQgcHJvbWlzZXMgYXJlIHJlc29sdmVkLCB0aGVuIHRoZSByb3V0ZSBpcyByZS1zeW5jJ2VkLg0KDQogICAgLy8gRXhhbXBsZTogZnVuY3Rpb24oJGh0dHApIHsNCiAgICAvLyAgcmV0dXJuICRodHRwLmdldCgnLy9zZXJ2ZXIuY29tL2FwaS9EeW5hbWljRnV0dXJlU3RhdGVzJykudGhlbihmdW5jdGlvbihkYXRhKSB7DQogICAgLy8gICAgYW5ndWxhci5mb3JFYWNoKGRhdGEuZnV0dXJlU3RhdGVzLCBmdW5jdGlvbihmc3RhdGUpIHsgJGZ1dHVyZVN0YXRlUHJvdmlkZXIuZnV0dXJlU3RhdGUoZnN0YXRlKTsgfSk7DQogICAgLy8gIH07DQogICAgLy8gfQ0KICAgIHRoaXMuYWRkUmVzb2x2ZSA9IGZ1bmN0aW9uIChwcm9taXNlRm4pIHsNCiAgICAgIHJlc29sdmVGdW5jdGlvbnMucHVzaChwcm9taXNlRm4pOw0KICAgIH07DQoNCiAgICAvLyBSZWdpc3RlciBhIHN0YXRlIGZhY3RvcnkgZnVuY3Rpb24gZm9yIGEgcGFydGljdWxhciBmdXR1cmUtc3RhdGUgdHlwZS4gIFRoaXMgZmFjdG9yeSwgZ2l2ZW4gYSBmdXR1cmUtc3RhdGUgb2JqZWN0LA0KICAgIC8vIHNob3VsZCBjcmVhdGUgYSB1aS1yb3V0ZXIgc3RhdGUuDQogICAgLy8gVGhlIGZhY3RvcnkgZnVuY3Rpb24gaXMgaW5qZWN0ZWQvZXhlY3V0ZWQgdXNpbmcgdGhlIHJ1bnRpbWUgJGluamVjdG9yLiAgVGhlIGZ1dHVyZS1zdGF0ZSBpcyBpbmplY3RlZCBhcyAnZnV0dXJlU3RhdGUnLg0KDQogICAgLy8gRXhhbXBsZToNCiAgICAvLyAgICAkZnV0dXJlU3RhdGVQcm92aWRlci5zdGF0ZUZhY3RvcnkoJ3Rlc3QnLCBmdW5jdGlvbihmdXR1cmVTdGF0ZSkgew0KICAgIC8vICAgICAgcmV0dXJuIHsNCiAgICAvLyAgICAgICAgbmFtZTogZnV0dXJlU3RhdGUuc3RhdGVOYW1lLA0KICAgIC8vICAgICAgICB1cmw6IGZ1dHVyZVN0YXRlLnVybEZyYWdtZW50LA0KICAgIC8vICAgICAgICB0ZW1wbGF0ZTogJzxoMz5GdXR1cmUgU3RhdGUgVGVtcGxhdGU8L2gzPicsDQogICAgLy8gICAgICAgIGNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkgew0KICAgIC8vICAgICAgICAgIGNvbnNvbGUubG9nKCJFbnRlcmVkIHN0YXRlICIgKyBmdXR1cmVTdGF0ZS5zdGF0ZU5hbWUpOw0KICAgIC8vICAgICAgICB9DQogICAgLy8gICAgICB9DQogICAgLy8gICAgfSk7DQogICAgdGhpcy5zdGF0ZUZhY3RvcnkgPSBmdW5jdGlvbiAoZnV0dXJlU3RhdGVUeXBlLCBmYWN0b3J5KSB7DQogICAgICBzdGF0ZUZhY3Rvcmllc1tmdXR1cmVTdGF0ZVR5cGVdID0gZmFjdG9yeTsNCiAgICB9Ow0KDQogICAgdGhpcy5mdXR1cmVTdGF0ZSA9IGZ1bmN0aW9uIChmdXR1cmVTdGF0ZSkgew0KICAgICAgaWYgKGZ1dHVyZVN0YXRlLnN0YXRlTmFtZSkgIC8vIGJhY2t3YXJkcyBjb21wYXQgZm9yIG5vdw0KICAgICAgICBmdXR1cmVTdGF0ZS5uYW1lID0gZnV0dXJlU3RhdGUuc3RhdGVOYW1lOw0KICAgICAgaWYgKGZ1dHVyZVN0YXRlLnVybFByZWZpeCkgIC8vIGJhY2t3YXJkcyBjb21wYXQgZm9yIG5vdw0KICAgICAgICBmdXR1cmVTdGF0ZS51cmwgPSAiXiIgKyBmdXR1cmVTdGF0ZS51cmxQcmVmaXg7DQoNCiAgICAgIGZ1dHVyZVN0YXRlc1tmdXR1cmVTdGF0ZS5uYW1lXSA9IGZ1dHVyZVN0YXRlOw0KICAgICAgdmFyIHBhcmVudE1hdGNoZXIsICBwYXJlbnROYW1lID0gZnV0dXJlU3RhdGUubmFtZS5zcGxpdCgvXC4vKS5zbGljZSgwLCAtMSkuam9pbigiLiIpLA0KICAgICAgICByZWFsUGFyZW50ID0gZmluZFN0YXRlKGZ1dHVyZVN0YXRlLnBhcmVudCB8fCBwYXJlbnROYW1lKTsNCiAgICAgIGlmIChyZWFsUGFyZW50KSB7DQogICAgICAgIHBhcmVudE1hdGNoZXIgPSByZWFsUGFyZW50LnVybCB8fCByZWFsUGFyZW50Lm5hdmlnYWJsZSAmJiByZWFsUGFyZW50Lm5hdmlnYWJsZS51cmw7DQogICAgICB9IGVsc2UgaWYgKHBhcmVudE5hbWUgPT09ICIiKSB7DQogICAgICAgIHBhcmVudE1hdGNoZXIgPSAkdXJsTWF0Y2hlckZhY3RvcnkuY29tcGlsZSgiIik7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgZnV0dXJlUGFyZW50ID0gZmluZFN0YXRlKChmdXR1cmVTdGF0ZS5wYXJlbnQgfHwgcGFyZW50TmFtZSksIHRydWUpOw0KICAgICAgICBpZiAoIWZ1dHVyZVBhcmVudCkgdGhyb3cgbmV3IEVycm9yKCJDb3VsZG4ndCBkZXRlcm1pbmUgcGFyZW50IHN0YXRlIG9mIGZ1dHVyZSBzdGF0ZS4gRnV0dXJlU3RhdGU6IiArIGFuZ3VsYXIudG9Kc29uKGZ1dHVyZVN0YXRlKSk7DQogICAgICAgIHZhciBwYXR0ZXJuID0gZnV0dXJlUGFyZW50LnVybE1hdGNoZXIuc291cmNlLnJlcGxhY2UoL1wqcmVzdCQvLCAiIik7DQogICAgICAgIHBhcmVudE1hdGNoZXIgPSAkdXJsTWF0Y2hlckZhY3RvcnkuY29tcGlsZShwYXR0ZXJuKTsNCiAgICAgICAgZnV0dXJlU3RhdGUucGFyZW50RnV0dXJlU3RhdGUgPSBmdXR1cmVQYXJlbnQ7DQogICAgICB9DQogICAgICBpZiAoZnV0dXJlU3RhdGUudXJsKSB7DQogICAgICAgIGZ1dHVyZVN0YXRlLnVybE1hdGNoZXIgPSBmdXR1cmVTdGF0ZS51cmwuY2hhckF0KDApID09PSAiXiIgPw0KICAgICAgICAgICR1cmxNYXRjaGVyRmFjdG9yeS5jb21waWxlKGZ1dHVyZVN0YXRlLnVybC5zdWJzdHJpbmcoMSkgKyAiKnJlc3QiKSA6DQogICAgICAgICAgcGFyZW50TWF0Y2hlci5jb25jYXQoZnV0dXJlU3RhdGUudXJsICsgIipyZXN0Iik7DQogICAgICB9DQogICAgfTsNCg0KICAgIHRoaXMuZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgcmV0dXJuIGFuZ3VsYXIuZXh0ZW5kKHt9LCBmdXR1cmVTdGF0ZXMpOw0KICAgIH07DQoNCiAgICBmdW5jdGlvbiBmaW5kU3RhdGUoc3RhdGVPck5hbWUsIGZpbmRGdXR1cmVTdGF0ZSkgew0KICAgICAgdmFyIHN0YXRlbmFtZSA9IGFuZ3VsYXIuaXNPYmplY3Qoc3RhdGVPck5hbWUpID8gc3RhdGVPck5hbWUubmFtZSA6IHN0YXRlT3JOYW1lOw0KICAgICAgcmV0dXJuICFmaW5kRnV0dXJlU3RhdGUgPyBpbnRlcm5hbFN0YXRlc1tzdGF0ZW5hbWVdIDogZnV0dXJlU3RhdGVzW3N0YXRlbmFtZV07DQogICAgfQ0KDQogICAgLyogb3B0aW9ucyBpcyBhbiBvYmplY3Qgd2l0aCBhdCBsZWFzdCBhIG5hbWUgb3IgdXJsIGF0dHJpYnV0ZSAqLw0KICAgIGZ1bmN0aW9uIGZpbmRGdXR1cmVTdGF0ZSgkc3RhdGUsIG9wdGlvbnMpIHsNCiAgICAgIGlmIChvcHRpb25zLm5hbWUpIHsNCiAgICAgICAgdmFyIG5hbWVDb21wb25lbnRzID0gb3B0aW9ucy5uYW1lLnNwbGl0KC9cLi8pOw0KICAgICAgICBpZiAob3B0aW9ucy5uYW1lLmNoYXJBdCgwKSA9PT0gJy4nKQ0KICAgICAgICAgIG5hbWVDb21wb25lbnRzWzBdID0gJHN0YXRlLmN1cnJlbnQubmFtZTsNCiAgICAgICAgd2hpbGUgKG5hbWVDb21wb25lbnRzLmxlbmd0aCkgew0KICAgICAgICAgIHZhciBzdGF0ZU5hbWUgPSBuYW1lQ29tcG9uZW50cy5qb2luKCIuIik7DQogICAgICAgICAgaWYgKCRzdGF0ZS5nZXQoc3RhdGVOYW1lLCB7IHJlbGF0aXZlOiAkc3RhdGUuY3VycmVudCB9KSkNCiAgICAgICAgICAgIHJldHVybiBudWxsOyAvLyBTdGF0ZSBpcyBhbHJlYWR5IGRlZmluZWQ7IG5vdGhpbmcgdG8gZG8NCiAgICAgICAgICBpZiAoZnV0dXJlU3RhdGVzW3N0YXRlTmFtZV0pDQogICAgICAgICAgICByZXR1cm4gZnV0dXJlU3RhdGVzW3N0YXRlTmFtZV07DQogICAgICAgICAgbmFtZUNvbXBvbmVudHMucG9wKCk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgaWYgKG9wdGlvbnMudXJsKSB7DQogICAgICAgIHZhciBtYXRjaGVzID0gW107DQogICAgICAgIGZvcih2YXIgZnV0dXJlIGluIGZ1dHVyZVN0YXRlcykgew0KICAgICAgICAgIHZhciBtYXRjaGVyID0gZnV0dXJlU3RhdGVzW2Z1dHVyZV0udXJsTWF0Y2hlcjsNCiAgICAgICAgICBpZiAobWF0Y2hlciAmJiBtYXRjaGVyLmV4ZWMob3B0aW9ucy51cmwpKSB7DQogICAgICAgICAgICBtYXRjaGVzLnB1c2goZnV0dXJlU3RhdGVzW2Z1dHVyZV0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBGaW5kIG1vc3Qgc3BlY2lmaWMgYnkgaWdub3JpbmcgbWF0Y2hpbmcgcGFyZW50cyBmcm9tIG1hdGNoZXMNCiAgICAgICAgdmFyIGNvcHkgPSBtYXRjaGVzLnNsaWNlKDApOw0KICAgICAgICBmb3IgKHZhciBpID0gbWF0Y2hlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgew0KICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY29weS5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgaWYgKG1hdGNoZXNbaV0gPT09IGNvcHlbal0ucGFyZW50RnV0dXJlU3RhdGUpIG1hdGNoZXMuc3BsaWNlKGksIDEpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbWF0Y2hlc1swXTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBsYXp5TG9hZFN0YXRlKCRpbmplY3RvciwgZnV0dXJlU3RhdGUpIHsNCiAgICAgIGxhenlsb2FkSW5Qcm9ncmVzcyA9IHRydWU7DQogICAgICB2YXIgJHEgPSAkaW5qZWN0b3IuZ2V0KCIkcSIpOw0KICAgICAgaWYgKCFmdXR1cmVTdGF0ZSkgew0KICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpOw0KICAgICAgICBkZWZlcnJlZC5yZWplY3QoIk5vIGxhenlTdGF0ZSBwYXNzZWQgaW4gIiArIGZ1dHVyZVN0YXRlKTsNCiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7DQogICAgICB9DQoNCiAgICAgIHZhciBwcm9taXNlID0gJHEud2hlbihbXSksIHBhcmVudEZ1dHVyZSA9IGZ1dHVyZVN0YXRlLnBhcmVudEZ1dHVyZVN0YXRlOw0KICAgICAgaWYgKHBhcmVudEZ1dHVyZSAmJiBmdXR1cmVTdGF0ZXNbcGFyZW50RnV0dXJlLm5hbWVdKSB7DQogICAgICAgIHByb21pc2UgPSBsYXp5TG9hZFN0YXRlKCRpbmplY3RvciwgZnV0dXJlU3RhdGVzW3BhcmVudEZ1dHVyZS5uYW1lXSk7DQogICAgICB9DQoNCiAgICAgIHZhciB0eXBlID0gZnV0dXJlU3RhdGUudHlwZTsNCiAgICAgIHZhciBmYWN0b3J5ID0gc3RhdGVGYWN0b3JpZXNbdHlwZV07DQogICAgICBpZiAoIWZhY3RvcnkpIHRocm93IEVycm9yKCJObyBzdGF0ZSBmYWN0b3J5IGZvciBmdXR1cmVTdGF0ZS50eXBlOiAiICsgKGZ1dHVyZVN0YXRlICYmIGZ1dHVyZVN0YXRlLnR5cGUpKTsNCiAgICAgIHJldHVybiBwcm9taXNlDQogICAgICAgIC50aGVuKGZ1bmN0aW9uKGFycmF5KSB7DQogICAgICAgICAgdmFyIGluamVjdG9yUHJvbWlzZSA9ICRpbmplY3Rvci5pbnZva2UoZmFjdG9yeSwgZmFjdG9yeSwgeyBmdXR1cmVTdGF0ZTogZnV0dXJlU3RhdGUgfSk7DQogICAgICAgICAgcmV0dXJuIGluamVjdG9yUHJvbWlzZS50aGVuKGZ1bmN0aW9uKGZ1bGxTdGF0ZSkgew0KICAgICAgICAgICAgaWYgKGZ1bGxTdGF0ZSkgeyBhcnJheS5wdXNoKGZ1bGxTdGF0ZSk7IH0gLy8gUGFzcyBhIGNoYWluIG9mIHJlYWxpemVkIHN0YXRlcyBiYWNrDQogICAgICAgICAgICByZXR1cm4gYXJyYXk7DQogICAgICAgICAgfSk7DQogICAgICAgIH0pDQogICAgICAgIFsiZmluYWxseSJdKGZ1bmN0aW9uKCkgeyAvLyBJRTggaGFjaw0KICAgICAgICBkZWxldGUoZnV0dXJlU3RhdGVzW2Z1dHVyZVN0YXRlLm5hbWVdKTsNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIHZhciBvdGhlcndpc2VGdW5jID0gWyAnJGxvZycsICckbG9jYXRpb24nLA0KICAgICAgZnVuY3Rpb24gb3RoZXJ3aXNlRnVuYygkbG9nLCAkbG9jYXRpb24pIHsNCiAgICAgICAgJGxvZy5kZWJ1ZygiVW5hYmxlIHRvIG1hcCAiICsgJGxvY2F0aW9uLnBhdGgoKSk7DQogICAgICB9XTsNCg0KICAgIGZ1bmN0aW9uIGZ1dHVyZVN0YXRlX290aGVyd2lzZSgkaW5qZWN0b3IsICRsb2NhdGlvbikgew0KICAgICAgdmFyIHJlc3luY2luZyA9IGZhbHNlOw0KDQogICAgICB2YXIgbGF6eUxvYWRNaXNzaW5nU3RhdGUgPQ0KICAgICAgICBbJyRyb290U2NvcGUnLCAnJHVybFJvdXRlcicsICckc3RhdGUnLA0KICAgICAgICAgIGZ1bmN0aW9uIGxhenlMb2FkTWlzc2luZ1N0YXRlKCRyb290U2NvcGUsICR1cmxSb3V0ZXIsICRzdGF0ZSkgew0KICAgICAgICAgICAgZnVuY3Rpb24gcmVzeW5jKCkgew0KICAgICAgICAgICAgICByZXN5bmNpbmcgPSB0cnVlOyAkdXJsUm91dGVyLnN5bmMoKTsgcmVzeW5jaW5nID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIWluaXREb25lKSB7DQogICAgICAgICAgICAgIC8vIEFzeW5jaHJvbm91c2x5IGxvYWQgc3RhdGUgZGVmaW5pdGlvbnMsIHRoZW4gcmVzeW5jIFVSTA0KICAgICAgICAgICAgICBpbml0UHJvbWlzZSgpLnRoZW4ocmVzeW5jKTsNCiAgICAgICAgICAgICAgaW5pdERvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBmdXR1cmVTdGF0ZSA9IGZpbmRGdXR1cmVTdGF0ZSgkc3RhdGUsIHsgdXJsOiAkbG9jYXRpb24ucGF0aCgpIH0pOw0KICAgICAgICAgICAgaWYgKCFmdXR1cmVTdGF0ZSkgew0KICAgICAgICAgICAgICByZXR1cm4gJGluamVjdG9yLmludm9rZShvdGhlcndpc2VGdW5jKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gQ29uZmlnIGxvYWRlZC4gIEFzeW5jaHJvbm91c2x5IGxhenktbG9hZCBzdGF0ZSBkZWZpbml0aW9uIGZyb20gVVJMIGZyYWdtZW50LCBpZiBtYXBwZWQuDQogICAgICAgICAgICBsYXp5TG9hZFN0YXRlKCRpbmplY3RvciwgZnV0dXJlU3RhdGUpLnRoZW4oZnVuY3Rpb24gbGF6eUxvYWRlZFN0YXRlQ2FsbGJhY2soc3RhdGVzKSB7DQogICAgICAgICAgICAgIHN0YXRlcy5mb3JFYWNoKGZ1bmN0aW9uIChzdGF0ZSkgew0KICAgICAgICAgICAgICAgIGlmIChzdGF0ZSAmJiAoISRzdGF0ZS5nZXQoc3RhdGUpIHx8IChzdGF0ZS5uYW1lICYmICEkc3RhdGUuZ2V0KHN0YXRlLm5hbWUpKSkpDQogICAgICAgICAgICAgICAgICAkc3RhdGVQcm92aWRlci5zdGF0ZShzdGF0ZSk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBsYXp5bG9hZEluUHJvZ3Jlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgcmVzeW5jKCk7DQogICAgICAgICAgICB9LCBmdW5jdGlvbiBsYXp5TG9hZFN0YXRlQWJvcnRlZCgpIHsNCiAgICAgICAgICAgICAgbGF6eWxvYWRJblByb2dyZXNzID0gZmFsc2U7DQogICAgICAgICAgICAgIHJlc3luYygpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfV07DQogICAgICBpZiAobGF6eWxvYWRJblByb2dyZXNzKSByZXR1cm47DQoNCiAgICAgIHZhciBuZXh0Rm4gPSByZXN5bmNpbmcgPyBvdGhlcndpc2VGdW5jIDogbGF6eUxvYWRNaXNzaW5nU3RhdGU7DQogICAgICByZXR1cm4gJGluamVjdG9yLmludm9rZShuZXh0Rm4pOw0KICAgIH0NCg0KICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoZnV0dXJlU3RhdGVfb3RoZXJ3aXNlKTsNCg0KICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UgPSBmdW5jdGlvbihydWxlKSB7DQogICAgICBpZiAoYW5ndWxhci5pc1N0cmluZyhydWxlKSkgew0KICAgICAgICB2YXIgcmVkaXJlY3QgPSBydWxlOw0KICAgICAgICBydWxlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVkaXJlY3Q7IH07DQogICAgICB9DQogICAgICBlbHNlIGlmICghYW5ndWxhci5pc0Z1bmN0aW9uKHJ1bGUpKSB0aHJvdyBuZXcgRXJyb3IoIidydWxlJyBtdXN0IGJlIGEgZnVuY3Rpb24iKTsNCiAgICAgIG90aGVyd2lzZUZ1bmMgPSBbJyRpbmplY3RvcicsICckbG9jYXRpb24nLCBydWxlXTsNCiAgICAgIHJldHVybiAkdXJsUm91dGVyUHJvdmlkZXI7DQogICAgfTsNCg0KICAgIHZhciBzZXJ2aWNlT2JqZWN0ID0gew0KICAgICAgZ2V0UmVzb2x2ZVByb21pc2U6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIGluaXRQcm9taXNlKCk7DQogICAgICB9DQogICAgfTsNCg0KICAgIC8vIFVzZWQgaW4gLnJ1bigpIGJsb2NrIHRvIGluaXQNCiAgICB0aGlzLiRnZXQgPSBbICckaW5qZWN0b3InLCAnJHN0YXRlJywgJyRxJywgJyRyb290U2NvcGUnLCAnJHVybFJvdXRlcicsICckdGltZW91dCcsICckbG9nJywNCiAgICAgIGZ1bmN0aW9uIGZ1dHVyZVN0YXRlUHJvdmlkZXJfZ2V0KCRpbmplY3RvciwgJHN0YXRlLCAkcSwgJHJvb3RTY29wZSwgJHVybFJvdXRlciwgJHRpbWVvdXQsICRsb2cpIHsNCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsNCiAgICAgICAgICAkcm9vdFNjb3BlLiRvbigiJHN0YXRlTm90Rm91bmQiLCBmdW5jdGlvbiBmdXR1cmVTdGF0ZV9ub3RGb3VuZChldmVudCwgdW5mb3VuZFN0YXRlLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpIHsNCiAgICAgICAgICAgIGlmIChsYXp5bG9hZEluUHJvZ3Jlc3MpIHJldHVybjsNCiAgICAgICAgICAgICRsb2cuZGVidWcoImV2ZW50LCB1bmZvdW5kU3RhdGUsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcyIsIGV2ZW50LCB1bmZvdW5kU3RhdGUsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcyk7DQoNCiAgICAgICAgICAgIHZhciBmdXR1cmVTdGF0ZSA9IGZpbmRGdXR1cmVTdGF0ZSgkc3RhdGUsIHsgbmFtZTogdW5mb3VuZFN0YXRlLnRvIH0pOw0KICAgICAgICAgICAgaWYgKCFmdXR1cmVTdGF0ZSkgcmV0dXJuOw0KDQogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgdmFyIHByb21pc2UgPSBsYXp5TG9hZFN0YXRlKCRpbmplY3RvciwgZnV0dXJlU3RhdGUpOw0KICAgICAgICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uIChzdGF0ZXMpIHsNCiAgICAgICAgICAgICAgc3RhdGVzLmZvckVhY2goZnVuY3Rpb24gKHN0YXRlKSB7DQogICAgICAgICAgICAgICAgaWYgKHN0YXRlICYmICghJHN0YXRlLmdldChzdGF0ZSkgfHwgKHN0YXRlLm5hbWUgJiYgISRzdGF0ZS5nZXQoc3RhdGUubmFtZSkpKSkNCiAgICAgICAgICAgICAgICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKHN0YXRlKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICRzdGF0ZS5nbyh1bmZvdW5kU3RhdGUudG8sIHVuZm91bmRTdGF0ZS50b1BhcmFtcyk7DQogICAgICAgICAgICAgIGxhenlsb2FkSW5Qcm9ncmVzcyA9IGZhbHNlOw0KICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJmYWlsZWQgdG8gbGF6eSBsb2FkIHN0YXRlICIsIGVycm9yKTsNCiAgICAgICAgICAgICAgJHN0YXRlLmdvKGZyb21TdGF0ZSwgZnJvbVBhcmFtcyk7DQogICAgICAgICAgICAgIGxhenlsb2FkSW5Qcm9ncmVzcyA9IGZhbHNlOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICAvLyBEbyB0aGlzIGJldHRlci4gIFdhbnQgdG8gbG9hZCByZW1vdGUgY29uZmlnIG9uY2UsIGJlZm9yZSBldmVyeXRoaW5nIGVsc2UNCiAgICAgICAgICBpZiAoIWluaXRQcm9taXNlKSB7DQogICAgICAgICAgICB2YXIgcHJvbWlzZXMgPSBbXTsNCiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChyZXNvbHZlRnVuY3Rpb25zLCBmdW5jdGlvbiAocHJvbWlzZUZuKSB7DQogICAgICAgICAgICAgIHByb21pc2VzLnB1c2goJGluamVjdG9yLmludm9rZShwcm9taXNlRm4pKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgaW5pdFByb21pc2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIHJldHVybiAkcS5hbGwocHJvbWlzZXMpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBUT0RPOiBhbmFseXplIHRoaXMuIEknbSBjYWxsaW5nICR1cmxSb3V0ZXIuc3luYygpIGluIHR3byBwbGFjZXMgZm9yIHJldHJ5LWluaXRpYWwtdHJhbnNpdGlvbi4NCiAgICAgICAgICAvLyBUT0RPOiBJIHNob3VsZCBvbmx5IG5lZWQgdG8gZG8gdGhpcyBvbmNlLiAgUGljayB0aGUgYmV0dGVyIHBsYWNlIGFuZCByZW1vdmUgdGhlIGV4dHJhIHJlc3luYy4NCiAgICAgICAgICBpbml0UHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gcmV0cnlJbml0aWFsU3RhdGUoKSB7DQogICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIGlmICgkc3RhdGUudHJhbnNpdGlvbikgew0KICAgICAgICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uLnRoZW4oJHVybFJvdXRlci5zeW5jLCAkdXJsUm91dGVyLnN5bmMpOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICR1cmxSb3V0ZXIuc3luYygpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGluaXQoKTsNCg0KICAgICAgICBzZXJ2aWNlT2JqZWN0LnN0YXRlID0gJHN0YXRlUHJvdmlkZXIuc3RhdGU7DQogICAgICAgIHNlcnZpY2VPYmplY3QuZnV0dXJlU3RhdGUgPSBwcm92aWRlci5mdXR1cmVTdGF0ZTsNCiAgICAgICAgc2VydmljZU9iamVjdC5nZXQgPSBwcm92aWRlci5nZXQ7DQoNCiAgICAgICAgcmV0dXJuIHNlcnZpY2VPYmplY3Q7DQogICAgICB9DQogICAgXTsNCiAgfQ0KDQogIGFwcC5wcm92aWRlcignJGZ1dHVyZVN0YXRlJywgX2Z1dHVyZVN0YXRlUHJvdmlkZXIpOw0KDQogIHZhciBzdGF0ZXNBZGRlZFF1ZXVlID0gew0KICAgIHN0YXRlOiBmdW5jdGlvbihzdGF0ZSkgew0KICAgICAgaWYgKHN0YXRlc0FkZGVkUXVldWUuJHJvb3RTY29wZSkNCiAgICAgICAgc3RhdGVzQWRkZWRRdWV1ZS4kcm9vdFNjb3BlLiRicm9hZGNhc3QoIiRzdGF0ZUFkZGVkIiwgc3RhdGUpOw0KICAgIH0sDQogICAgaXRzTm93UnVudGltZU9oV2hhdEFIYXBweURheTogZnVuY3Rpb24oJHJvb3RTY29wZSkgew0KICAgICAgc3RhdGVzQWRkZWRRdWV1ZS4kcm9vdFNjb3BlID0gJHJvb3RTY29wZTsNCiAgICB9LA0KICAgICRyb290U2NvcGU6IHVuZGVmaW5lZA0KICB9Ow0KDQogIGFwcC5jb25maWcoWyAnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcikgew0KICAgIC8vIGRlY29yYXRlICRzdGF0ZVByb3ZpZGVyLnN0YXRlIHNvIHdlIGNhbiBicm9hZGNhc3Qgd2hlbiBhIHJlYWwgc3RhdGUgd2FzIGFkZGVkDQogICAgdmFyIHJlYWxTdGF0ZUZuID0gJHN0YXRlUHJvdmlkZXIuc3RhdGU7DQogICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUgPSBmdW5jdGlvbiBzdGF0ZV9hbm5vdW5jZSgpIHsNCiAgICAgIHZhciB2YWwgPSByZWFsU3RhdGVGbi5hcHBseSgkc3RhdGVQcm92aWRlciwgYXJndW1lbnRzKTsNCg0KICAgICAgdmFyIHN0YXRlID0gYW5ndWxhci5pc09iamVjdChhcmd1bWVudHNbMF0pID8gYXJndW1lbnRzWzBdIDogYXJndW1lbnRzWzFdOw0KICAgICAgc3RhdGVzQWRkZWRRdWV1ZS5zdGF0ZShzdGF0ZSk7DQogICAgICByZXR1cm4gdmFsOw0KICAgIH07DQogIH1dKTsNCg0KICAvLyBpbmplY3QgJGZ1dHVyZVN0YXRlIHNvIHRoZSBzZXJ2aWNlIGdldHMgaW5pdGlhbGl6ZWQgdmlhICRnZXQoKTsNCiAgYXBwLnJ1bihbJyRmdXR1cmVTdGF0ZScsIGZ1bmN0aW9uICgkZnV0dXJlU3RhdGUsICRyb290U2NvcGUpIHsNCiAgICBzdGF0ZXNBZGRlZFF1ZXVlLml0c05vd1J1bnRpbWVPaFdoYXRBSGFwcHlEYXkoJHJvb3RTY29wZSk7DQogIH0gXSk7DQoNCn0pKGFuZ3VsYXIpOw0KDQphbmd1bGFyLm1vZHVsZSgnY3QudWkucm91dGVyLmV4dHJhcy5wcmV2aW91cycsIFsgJ2N0LnVpLnJvdXRlci5leHRyYXMuY29yZScsICdjdC51aS5yb3V0ZXIuZXh0cmFzLnRyYW5zaXRpb24nIF0pLnNlcnZpY2UoIiRwcmV2aW91c1N0YXRlIiwNCiAgWyAnJHJvb3RTY29wZScsICckc3RhdGUnLA0KICAgIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc3RhdGUpIHsNCiAgICAgIHZhciBwcmV2aW91cyA9IG51bGwsIGxhc3RQcmV2aW91cyA9IG51bGwsIG1lbW9zID0ge307DQoNCiAgICAgICRyb290U2NvcGUuJG9uKCIkdHJhbnNpdGlvblN0YXJ0IiwgZnVuY3Rpb24oZXZ0LCAkdHJhbnNpdGlvbiQpIHsNCiAgICAgICAgdmFyIGZyb20gPSAkdHJhbnNpdGlvbiQuZnJvbTsNCiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGZyb21TdGF0ZSBpcyBuYXZpZ2FibGUgYmVmb3JlIHRyYWNraW5nIGl0Lg0KICAgICAgICAvLyBSb290IHN0YXRlIGRvZXNuJ3QgZ2V0IGRlY29yYXRlZCB3aXRoICQkc3RhdGUoKS4gIERvaC4NCiAgICAgICAgdmFyIGZyb21TdGF0ZSA9IGZyb20uc3RhdGUgJiYgZnJvbS5zdGF0ZS4kJHN0YXRlICYmIGZyb20uc3RhdGUuJCRzdGF0ZSgpOw0KICAgICAgICBpZiAoZnJvbVN0YXRlICYmIGZyb21TdGF0ZS5uYXZpZ2FibGUpIHsNCiAgICAgICAgICBsYXN0UHJldmlvdXMgPSBwcmV2aW91czsNCiAgICAgICAgICBwcmV2aW91cyA9ICR0cmFuc2l0aW9uJC5mcm9tOw0KICAgICAgICB9DQoNCiAgICAgICAgJHRyYW5zaXRpb24kLnByb21pc2UudGhlbihjb21taXQpWydjYXRjaCddKHJldmVydCk7DQogICAgICAgIGZ1bmN0aW9uIGNvbW1pdCgpIHsgbGFzdFByZXZpb3VzID0gbnVsbDsgfQ0KICAgICAgICBmdW5jdGlvbiByZXZlcnQoKSB7IHByZXZpb3VzID0gbGFzdFByZXZpb3VzOyB9DQogICAgICB9KTsNCg0KICAgICAgdmFyICRwcmV2aW91c1N0YXRlID0gew0KICAgICAgICBnZXQ6IGZ1bmN0aW9uIChtZW1vTmFtZSkgew0KICAgICAgICAgIHJldHVybiBtZW1vTmFtZSA/IG1lbW9zW21lbW9OYW1lXSA6IHByZXZpb3VzOw0KICAgICAgICB9LA0KICAgICAgICBnbzogZnVuY3Rpb24gKG1lbW9OYW1lLCBvcHRpb25zKSB7DQogICAgICAgICAgdmFyIHRvID0gJHByZXZpb3VzU3RhdGUuZ2V0KG1lbW9OYW1lKTsNCiAgICAgICAgICByZXR1cm4gJHN0YXRlLmdvKHRvLnN0YXRlLCB0by5wYXJhbXMsIG9wdGlvbnMpOw0KICAgICAgICB9LA0KICAgICAgICBtZW1vOiBmdW5jdGlvbiAobWVtb05hbWUsIGRlZmF1bHRTdGF0ZU5hbWUsIGRlZmF1bHRTdGF0ZVBhcmFtcykgew0KICAgICAgICAgIG1lbW9zW21lbW9OYW1lXSA9IHByZXZpb3VzIHx8IHsgc3RhdGU6ICRzdGF0ZS5nZXQoZGVmYXVsdFN0YXRlTmFtZSksIHBhcmFtczogZGVmYXVsdFN0YXRlUGFyYW1zIH07DQogICAgICAgIH0sDQogICAgICAgIGZvcmdldDogZnVuY3Rpb24gKG1lbW9OYW1lKSB7DQogICAgICAgICAgaWYgKG1lbW9OYW1lKSB7DQogICAgICAgICAgICBkZWxldGUgbWVtb3NbbWVtb05hbWVdOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBwcmV2aW91cyA9IHVuZGVmaW5lZDsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH07DQoNCiAgICAgIHJldHVybiAkcHJldmlvdXNTdGF0ZTsNCiAgICB9DQogIF0NCik7DQoNCmFuZ3VsYXIubW9kdWxlKCdjdC51aS5yb3V0ZXIuZXh0cmFzLnByZXZpb3VzJykucnVuKFsnJHByZXZpb3VzU3RhdGUnLCBmdW5jdGlvbiAoJHByZXZpb3VzU3RhdGUpIHsNCiAgLy8gSW5qZWN0ICRwcmV2aW91c1N0YXRlIHNvIGl0IGNhbiByZWdpc3RlciAkcm9vdFNjb3BlIGV2ZW50cw0KfV0pOw0KDQoNCmFuZ3VsYXIubW9kdWxlKCJjdC51aS5yb3V0ZXIuZXh0cmFzLnRyYW5zaXRpb24iLCBbICdjdC51aS5yb3V0ZXIuZXh0cmFzLmNvcmUnIF0pLmNvbmZpZyggWyAiJHByb3ZpZGUiLCAgZnVuY3Rpb24gKCRwcm92aWRlKSB7DQogICAgICAvLyBEZWNvcmF0ZSB0aGUgJHN0YXRlIHNlcnZpY2UsIHNvIHdlIGNhbiByZXBsYWNlICRzdGF0ZS50cmFuc2l0aW9uVG8oKQ0KICAgICAgJHByb3ZpZGUuZGVjb3JhdG9yKCIkc3RhdGUiLCBbJyRkZWxlZ2F0ZScsICckcm9vdFNjb3BlJywgJyRxJywgJyRpbmplY3RvcicsDQogICAgICAgIGZ1bmN0aW9uICgkc3RhdGUsICRyb290U2NvcGUsICRxLCAkaW5qZWN0b3IpIHsNCiAgICAgICAgICAvLyBLZWVwIGFuIGludGVybmFsIHJlZmVyZW5jZSB0byB0aGUgcmVhbCAkc3RhdGUudHJhbnNpdGlvblRvIGZ1bmN0aW9uDQogICAgICAgICAgdmFyICRzdGF0ZV90cmFuc2l0aW9uVG8gPSAkc3RhdGUudHJhbnNpdGlvblRvOw0KICAgICAgICAgIC8vICRzdGF0ZS50cmFuc2l0aW9uVG8gY2FuIGJlIHJlLWVudGVyZWQuICBLZWVwIHRyYWNrIG9mIHJlLWVudHJhbnQgc3RhY2sNCiAgICAgICAgICB2YXIgdHJhbnNpdGlvbkRlcHRoID0gLTE7DQogICAgICAgICAgdmFyIHREYXRhU3RhY2sgPSBbXTsNCiAgICAgICAgICB2YXIgcmVzdG9yZUZuU3RhY2sgPSBbXTsNCg0KICAgICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gZGVjb3JhdGVzIHRoZSAkaW5qZWN0b3IsIGFkZGluZyB7ICR0cmFuc2l0aW9uJDogdERhdGEgfSB0byBpbnZva2UoKSBhbmQgaW5zdGFudGlhdGUoKSBsb2NhbHMuDQogICAgICAgICAgLy8gSXQgcmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgcmVzdG9yZXMgJGluamVjdG9yIHRvIGl0cyBwcmV2aW91cyBzdGF0ZS4NCiAgICAgICAgICBmdW5jdGlvbiBkZWNvcmF0ZUluamVjdG9yKHREYXRhKSB7DQogICAgICAgICAgICB2YXIgb2xkaW52b2tlID0gJGluamVjdG9yLmludm9rZTsNCiAgICAgICAgICAgIHZhciBvbGRpbnN0YW50aWF0ZSA9ICRpbmplY3Rvci5pbnN0YW50aWF0ZTsNCiAgICAgICAgICAgICRpbmplY3Rvci5pbnZva2UgPSBmdW5jdGlvbiAoZm4sIHNlbGYsIGxvY2Fscykgew0KICAgICAgICAgICAgICByZXR1cm4gb2xkaW52b2tlKGZuLCBzZWxmLCBhbmd1bGFyLmV4dGVuZCh7JHRyYW5zaXRpb24kOiB0RGF0YX0sIGxvY2FscykpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICRpbmplY3Rvci5pbnN0YW50aWF0ZSA9IGZ1bmN0aW9uIChmbiwgbG9jYWxzKSB7DQogICAgICAgICAgICAgIHJldHVybiBvbGRpbnN0YW50aWF0ZShmbiwgYW5ndWxhci5leHRlbmQoeyR0cmFuc2l0aW9uJDogdERhdGF9LCBsb2NhbHMpKTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiByZXN0b3JlSXRlbXMoKSB7DQogICAgICAgICAgICAgICRpbmplY3Rvci5pbnZva2UgPSBvbGRpbnZva2U7DQogICAgICAgICAgICAgICRpbmplY3Rvci5pbnN0YW50aWF0ZSA9IG9sZGluc3RhbnRpYXRlOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBwb3BTdGFjaygpIHsNCiAgICAgICAgICAgIHJlc3RvcmVGblN0YWNrLnBvcCgpKCk7DQogICAgICAgICAgICB0RGF0YVN0YWNrLnBvcCgpOw0KICAgICAgICAgICAgdHJhbnNpdGlvbkRlcHRoLS07DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gVGhpcyBwcm9taXNlIGNhbGxiYWNrIChmb3Igd2hlbiB0aGUgcmVhbCB0cmFuc2l0aW9uVG8gaXMgc3VjY2Vzc2Z1bCkgcnVucyB0aGUgcmVzdG9yZSBmdW5jdGlvbiBmb3IgdGhlDQogICAgICAgICAgLy8gY3VycmVudCBzdGFjayBsZXZlbCwgdGhlbiBicm9hZGNhc3RzIHRoZSAkdHJhbnNpdGlvblN1Y2Nlc3MgZXZlbnQuDQogICAgICAgICAgZnVuY3Rpb24gdHJhbnNpdGlvblN1Y2Nlc3MoZGVmZXJyZWQsIHRTdWNjZXNzKSB7DQogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gc3VjY2Vzc0ZuKGRhdGEpIHsNCiAgICAgICAgICAgICAgcG9wU3RhY2soKTsNCiAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCIkdHJhbnNpdGlvblN1Y2Nlc3MiLCB0U3VjY2Vzcyk7DQogICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7IC8vICR0cmFuc2l0aW9uJCBkZWZlcnJlZA0KICAgICAgICAgICAgICByZXR1cm4gZGF0YTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gVGhpcyBwcm9taXNlIGNhbGxiYWNrIChmb3Igd2hlbiB0aGUgcmVhbCB0cmFuc2l0aW9uVG8gZmFpbHMpIHJ1bnMgdGhlIHJlc3RvcmUgZnVuY3Rpb24gZm9yIHRoZQ0KICAgICAgICAgIC8vIGN1cnJlbnQgc3RhY2sgbGV2ZWwsIHRoZW4gYnJvYWRjYXN0cyB0aGUgJHRyYW5zaXRpb25FcnJvciBldmVudC4NCiAgICAgICAgICBmdW5jdGlvbiB0cmFuc2l0aW9uRmFpbHVyZShkZWZlcnJlZCwgdEZhaWwpIHsNCiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBmYWlsdXJlRm4oZXJyb3IpIHsNCiAgICAgICAgICAgICAgcG9wU3RhY2soKTsNCiAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCIkdHJhbnNpdGlvbkVycm9yIiwgdEZhaWwsIGVycm9yKTsNCiAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycm9yKTsgIC8vICR0cmFuc2l0aW9uJCBkZWZlcnJlZA0KICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gRGVjb3JhdGUgJHN0YXRlLnRyYW5zaXRpb25Uby4NCiAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvID0gZnVuY3Rpb24gKHRvLCB0b1BhcmFtcywgb3B0aW9ucykgew0KICAgICAgICAgICAgLy8gQ3JlYXRlIGEgZGVmZXJyZWQvcHJvbWlzZSB3aGljaCBjYW4gYmUgdXNlZCBlYXJsaWVyIHRoYW4gVUktUm91dGVyJ3MgdHJhbnNpdGlvbiBwcm9taXNlLg0KICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTsNCiAgICAgICAgICAgIC8vIFBsYWNlIHRoZSBwcm9taXNlIGluIGEgdHJhbnNpdGlvbiBkYXRhLCBhbmQgcGxhY2UgaXQgb24gdGhlIHN0YWNrIHRvIGJlIHVzZWQgaW4gJHN0YXRlQ2hhbmdlU3RhcnQNCiAgICAgICAgICAgIHZhciB0RGF0YSA9IHREYXRhU3RhY2tbKyt0cmFuc2l0aW9uRGVwdGhdID0gew0KICAgICAgICAgICAgICBwcm9taXNlOiBkZWZlcnJlZC5wcm9taXNlDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgLy8gcGxhY2Vob2xkZXIgcmVzdG9yZUZuIGluIGNhc2UgdHJhbnNpdGlvblRvIGRvZXNuJ3QgcmVhY2ggJHN0YXRlQ2hhbmdlU3RhcnQgKHN0YXRlIG5vdCBmb3VuZCwgZXRjKQ0KICAgICAgICAgICAgcmVzdG9yZUZuU3RhY2tbdHJhbnNpdGlvbkRlcHRoXSA9IGZ1bmN0aW9uKCkgeyB9Ow0KICAgICAgICAgICAgLy8gSW52b2tlIHRoZSByZWFsICRzdGF0ZS50cmFuc2l0aW9uVG8NCiAgICAgICAgICAgIHZhciB0UHJvbWlzZSA9ICRzdGF0ZV90cmFuc2l0aW9uVG8uYXBwbHkoJHN0YXRlLCBhcmd1bWVudHMpOw0KDQogICAgICAgICAgICAvLyBpbnNlcnQgb3VyIHByb21pc2UgY2FsbGJhY2tzIGludG8gdGhlIGNoYWluLg0KICAgICAgICAgICAgcmV0dXJuIHRQcm9taXNlLnRoZW4odHJhbnNpdGlvblN1Y2Nlc3MoZGVmZXJyZWQsIHREYXRhKSwgdHJhbnNpdGlvbkZhaWx1cmUoZGVmZXJyZWQsIHREYXRhKSk7DQogICAgICAgICAgfTsNCg0KICAgICAgICAgIC8vIFRoaXMgZXZlbnQgaXMgaGFuZGxlZCBzeW5jaHJvbm91c2x5IGluIHRyYW5zaXRpb25UbyBjYWxsIHN0YWNrDQogICAgICAgICAgJHJvb3RTY29wZS4kb24oIiRzdGF0ZUNoYW5nZVN0YXJ0IiwgZnVuY3Rpb24gKGV2dCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcykgew0KICAgICAgICAgICAgICB2YXIgZGVwdGggPSB0cmFuc2l0aW9uRGVwdGg7DQogICAgICAgICAgICAgIC8vIFRvL0Zyb20gaXMgbm93IG5vcm1hbGl6ZWQgYnkgdWktcm91dGVyLiAgQWRkIHRoaXMgaW5mb3JtYXRpb24gdG8gdGhlIHRyYW5zaXRpb24gZGF0YSBvYmplY3QuDQogICAgICAgICAgICAgIHZhciB0RGF0YSA9IGFuZ3VsYXIuZXh0ZW5kKHREYXRhU3RhY2tbZGVwdGhdLCB7DQogICAgICAgICAgICAgICAgdG86IHsgc3RhdGU6IHRvU3RhdGUsIHBhcmFtczogdG9QYXJhbXMgfSwNCiAgICAgICAgICAgICAgICBmcm9tOiB7IHN0YXRlOiBmcm9tU3RhdGUsIHBhcmFtczogZnJvbVBhcmFtcyB9DQogICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgIHZhciByZXN0b3JlRm4gPSBkZWNvcmF0ZUluamVjdG9yKHREYXRhKTsNCiAgICAgICAgICAgICAgcmVzdG9yZUZuU3RhY2tbZGVwdGhdID0gcmVzdG9yZUZuOw0KICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoIiR0cmFuc2l0aW9uU3RhcnQiLCB0RGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgKTsNCg0KICAgICAgICAgIHJldHVybiAkc3RhdGU7DQogICAgICAgIH1dKTsNCiAgICB9DQogIF0NCik7DQoNCi8vIHN0YXRldmlzIHJlcXVpcmVzIGQzLg0KKGZ1bmN0aW9uICgpIHsNCiAgInVzZSBzdHJpY3QiOw0KICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoImN0LnVpLnJvdXRlci5leHRyYXMuc3RhdGV2aXMiLCBbICdjdC51aS5yb3V0ZXIuZXh0cmFzLmNvcmUnLCAnY3QudWkucm91dGVyLmV4dHJhcy5zdGlja3knICBdKTsNCg0KICBhcHAuZGlyZWN0aXZlKCdzdGF0ZVZpcycsIFsgJyRzdGF0ZScsICckdGltZW91dCcsICckaW50ZXJ2YWwnLCBzdGF0ZVZpc0RpcmVjdGl2ZSBdKTsNCg0KICAvKioNCiAgICogVGhpcyBkaXJlY3RpdmUgZ2V0cyBhbGwgdGhlIGN1cnJlbnQgc3RhdGVzIHVzaW5nICRzdGF0ZS5nZXQoKSBhbmQgZGlzcGxheXMgdGhlbSBpbiBhIHRyZWUgdXNpbmcgRDMgbGliLg0KICAgKiBJdCB0aGVuIGxpc3RlbnMgZm9yIHN0YXRlIGV2ZW50cyBhbmQgdXBkYXRlcyB0aGUgdHJlZS4NCiAgICoNCiAgICogVXNhZ2U6DQogICAqIDxzdGF0ZS12aXMgaGVpZ2h0PSIxMDAwcHgiIHdpZHRoPSIxMDAwcHgiPjwvc3RhdGUtdmlzPg0KICAgKi8NCiAgZnVuY3Rpb24gc3RhdGVWaXNEaXJlY3RpdmUoJHN0YXRlLCAkdGltZW91dCwgJGludGVydmFsKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHNjb3BlOiB7DQogICAgICAgIHdpZHRoOiAnQCcsDQogICAgICAgIGhlaWdodDogJ0AnDQogICAgICB9LA0KICAgICAgcmVzdHJpY3Q6ICdBRScsDQogICAgICB0ZW1wbGF0ZTogJzxzdmc+PC9zdmc+JywNCiAgICAgIGxpbms6IGZ1bmN0aW9uIChfc2NvcGUsIF9lbGVtLCBfYXR0cnMpIHsNCiAgICAgICAgdmFyIHN0YXRlTWFwID0ge307DQogICAgICAgIHZhciB3aWR0aCA9IF9zY29wZS53aWR0aCB8fCA0MDAsDQogICAgICAgICAgaGVpZ2h0ID0gX3Njb3BlLmhlaWdodCB8fCA0MDA7DQoNCiAgICAgICAgdmFyIHRyZWUgPSBkMy5sYXlvdXQudHJlZSgpDQogICAgICAgICAgICAuc2l6ZShbd2lkdGggLSAyMCwgaGVpZ2h0IC0gMjBdKQ0KICAgICAgICAgICAgLnNlcGFyYXRpb24oZnVuY3Rpb24gKGEsIGIpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGEucGFyZW50ID09IGIucGFyZW50ID8gMTAgOiAyNTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgIHZhciByb290ID0gJHN0YXRlLmdldCgpLmZpbHRlcihmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLm5hbWUgPT09ICIiOyB9KVswXTsNCiAgICAgICAgdmFyIG5vZGVzID0gdHJlZShyb290KTsNCg0KICAgICAgICByb290LnBhcmVudCA9IHJvb3Q7DQogICAgICAgIHJvb3QucHggPSByb290LnggPSB3aWR0aCAvIDI7DQogICAgICAgIHJvb3QucHkgPSByb290LnkgPSBoZWlnaHQgLyAyOw0KDQogICAgICAgIHZhciBhY3RpdmVOb2RlID0geyB9Ow0KICAgICAgICBhY3RpdmVOb2RlLnB4ID0gYWN0aXZlTm9kZS54ID0gcm9vdC5weDsNCiAgICAgICAgYWN0aXZlTm9kZS5weSA9IGFjdGl2ZU5vZGUueSA9IHJvb3QucHk7DQoNCiAgICAgICAgdmFyIGRpYWdvbmFsID0gZDMuc3ZnLmRpYWdvbmFsKCk7DQoNCiAgICAgICAgdmFyIHN2ZyA9IGQzLnNlbGVjdChfZWxlbS5maW5kKCJzdmciKVswXSkNCiAgICAgICAgICAuYXR0cigid2lkdGgiLCB3aWR0aCkNCiAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgaGVpZ2h0KQ0KICAgICAgICAgIC5hcHBlbmQoImciKQ0KICAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKDEwLCAxMCkiKTsNCg0KICAgICAgICB2YXIgbm9kZSA9IHN2Zy5zZWxlY3RBbGwoIi5ub2RlIiksDQogICAgICAgICAgbGluayA9IHN2Zy5zZWxlY3RBbGwoIi5saW5rIiksDQogICAgICAgICAgYWN0aXZlID0gc3ZnLnNlbGVjdEFsbCgiLmFjdGl2ZSIpDQogICAgICAgICAgOw0KDQogICAgICAgIHZhciB1cGRhdGVJbnRlcnZhbCA9IDIwMCwNCiAgICAgICAgICB0cmFuc0xlbmd0aCA9IDIwMCwNCiAgICAgICAgICB0aW1lciA9IHNldEludGVydmFsKHVwZGF0ZSwgdXBkYXRlSW50ZXJ2YWwpOw0KDQogICAgICAgIGZ1bmN0aW9uIGFkZFN0YXRlcyhkYXRhKSB7DQogICAgICAgICAgLy8gKioqKioqKioqKiogQ29udmVydCBmbGF0IGRhdGEgaW50byBhIG5pY2UgdHJlZSAqKioqKioqKioqKioqKioNCiAgICAgICAgICBkYXRhID0gZGF0YS5tYXAoZnVuY3Rpb24gKG5vZGUpIHsNCiAgICAgICAgICAgIHJldHVybiBub2RlLm5hbWUgPT09ICIiID8gcm9vdCA6IGFuZ3VsYXIuY29weShub2RlKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBhbmd1bGFyLmV4dGVuZChzdGF0ZU1hcCwgZGF0YS5yZWR1Y2UoZnVuY3Rpb24gKG1hcCwgbm9kZSkgew0KICAgICAgICAgICAgbWFwW25vZGUubmFtZV0gPSBub2RlOw0KICAgICAgICAgICAgcmV0dXJuIG1hcDsNCiAgICAgICAgICB9LCB7fSkpOw0KDQogICAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7DQogICAgICAgICAgICAvLyBhZGQgdG8gcGFyZW50DQogICAgICAgICAgICB2YXIgcGFyZW50TmFtZSA9IG5vZGUubmFtZS5zcGxpdCgvXC4vKS5zbGljZSgwLCAtMSkuam9pbigiLiIpOw0KICAgICAgICAgICAgdmFyIHBhcmVudCA9IG5vZGUubmFtZSAhPSBwYXJlbnROYW1lICYmIHN0YXRlTWFwW3BhcmVudE5hbWVdOw0KICAgICAgICAgICAgaWYgKHBhcmVudCkgew0KICAgICAgICAgICAgICAocGFyZW50LmNoaWxkcmVuIHx8IChwYXJlbnQuY2hpbGRyZW4gPSBbXSkpLnB1c2gobm9kZSk7IC8vIGNyZWF0ZSBjaGlsZCBhcnJheSBpZiBpdCBkb2Vzbid0IGV4aXN0DQogICAgICAgICAgICAgIG5vZGUucHggPSBwYXJlbnQucHg7DQogICAgICAgICAgICAgIG5vZGUucHkgPSBwYXJlbnQucHk7DQogICAgICAgICAgICAgIG5vZGVzLnB1c2gobm9kZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkgew0KICAgICAgICAgIF9zY29wZS5zdGF0ZXMgPSAkc3RhdGUuZ2V0KCk7DQogICAgICAgICAgYW5ndWxhci5mb3JFYWNoKG5vZGVzLCBmdW5jdGlvbiAobikgew0KICAgICAgICAgICAgdmFyIHMgPSAkc3RhdGUuZ2V0KG4ubmFtZSk7DQogICAgICAgICAgICBpZiAocykgew0KICAgICAgICAgICAgICBuLnN0YXR1cyA9IHMuc3RhdHVzIHx8ICdleGl0ZWQnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KLy8gICAgICAgICAgX3Njb3BlLmZ1dHVyZVN0YXRlcyA9ICRmdXR1cmVTdGF0ZS5nZXQoKTsNCiAgICAgICAgfSwgMjUwKTsNCg0KICAgICAgICBfc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigic3RhdGVzIiwgZnVuY3Rpb24gKG5ld3ZhbCwgb2xkdmFsKSB7DQogICAgICAgICAgdmFyIG9sZHN0YXRlcyA9IChvbGR2YWwgfHwgW10pLm1hcChmdW5jdGlvbiAocykgeyByZXR1cm4gcy5uYW1lOyB9KTsNCiAgICAgICAgICBhZGRTdGF0ZXMoKG5ld3ZhbCB8fCBbXSkuZmlsdGVyKGZ1bmN0aW9uKHN0YXRlKSB7IHJldHVybiBvbGRzdGF0ZXMuaW5kZXhPZihzdGF0ZS5uYW1lKSA9PSAtMTsgfSApKTsNCi8vICAgICAgICAgIGFkZFN0YXRlcyhfLnJlamVjdChuZXd2YWwsIGZ1bmN0aW9uIChzdGF0ZSkgeyByZXR1cm4gXy5jb250YWlucyhvbGRzdGF0ZXMsIHN0YXRlLm5hbWUpOyB9KSk7DQogICAgICAgIH0pOw0KDQovLyAgICAgICAgYWRkU3RhdGVzKCRzdGF0ZS5nZXQoKSk7DQogICAgICAgIHVwZGF0ZSh1cGRhdGVJbnRlcnZhbCk7DQoNCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKCkgew0KICAgICAgICAgIC8vIFJlY29tcHV0ZSB0aGUgbGF5b3V0IGFuZCBkYXRhIGpvaW4uDQogICAgICAgICAgbm9kZSA9IG5vZGUuZGF0YSh0cmVlLm5vZGVzKHJvb3QpLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5uYW1lOyB9KTsNCiAgICAgICAgICBsaW5rID0gbGluay5kYXRhKHRyZWUubGlua3Mobm9kZXMpLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC50YXJnZXQubmFtZTsgfSk7DQogICAgICAgICAgYWN0aXZlID0gYWN0aXZlLmRhdGEoYWN0aXZlTm9kZSk7DQoNCiAgICAgICAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChkKSB7IGQueSA9IGQuZGVwdGggKiA3MDsgfSk7DQoNCiAgICAgICAgICAvLyBBZGQgZW50ZXJpbmcgbm9kZXMgaW4gdGhlIHBhcmVudOKAmXMgb2xkIHBvc2l0aW9uLg0KICAgICAgICAgIHZhciBub2RlRW50ZXIgPSBub2RlLmVudGVyKCk7DQoNCiAgICAgICAgICBmdW5jdGlvbiBzdGF0ZU5hbWUobm9kZSkgew0KICAgICAgICAgICAgdmFyIG5hbWUgPSBub2RlLm5hbWUuc3BsaXQoIi4iKS5wb3AoKTsNCiAgICAgICAgICAgIGlmIChub2RlLnN0aWNreSkgeyBuYW1lICs9ICIgKFNUSUNLWSkiOyB9DQogICAgICAgICAgICBpZiAobm9kZS5kZWVwU3RhdGVSZWRpcmVjdCkgeyBuYW1lICs9ICIgKERTUikiOyB9DQogICAgICAgICAgICByZXR1cm4gbmFtZTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBhY3RpdmUuZW50ZXIoKQ0KICAgICAgICAgICAgLmFwcGVuZCgiY2lyY2xlIikNCiAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsICJhY3RpdmUiKQ0KICAgICAgICAgICAgLmF0dHIoInIiLCAxMykNCiAgICAgICAgICAgIC5hdHRyKCJjeCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnBhcmVudC5weCB8fCAxMDA7IH0pDQogICAgICAgICAgICAuYXR0cigiY3kiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5wYXJlbnQucHkgfHwgMTAwOyB9KQ0KICAgICAgICAgIDsNCg0KICAgICAgICAgIG5vZGVFbnRlci5hcHBlbmQoImNpcmNsZSIpDQogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAibm9kZSIpDQogICAgICAgICAgICAuYXR0cigiciIsIDkpDQogICAgICAgICAgICAuYXR0cigiY3giLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5wYXJlbnQucHg7IH0pDQogICAgICAgICAgICAuYXR0cigiY3kiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5wYXJlbnQucHk7IH0pOw0KDQogICAgICAgICAgbm9kZUVudGVyLmFwcGVuZCgidGV4dCIpDQogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAibGFiZWwiKQ0KICAgICAgICAgICAgLmF0dHIoIngiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5wYXJlbnQucHg7IH0pDQogICAgICAgICAgICAuYXR0cigieSIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnBhcmVudC5weTsgfSkNCiAgICAgICAgICAgIC5hdHRyKCJ0ZXh0LWFuY2hvciIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiAibWlkZGxlIjsgfSkNCiAgICAgICAgICAgIC50ZXh0KHN0YXRlTmFtZSkNCiAgICAgICAgICAgIC5zdHlsZSgiZmlsbC1vcGFjaXR5IiwgMSk7DQoNCg0KICAgICAgICAgIC8vIEFkZCBlbnRlcmluZyBsaW5rcyBpbiB0aGUgcGFyZW504oCZcyBvbGQgcG9zaXRpb24uDQogICAgICAgICAgbGluay5lbnRlcigpLmluc2VydCgicGF0aCIsICIubm9kZSIpDQogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAibGluayIpDQogICAgICAgICAgICAuYXR0cigiZCIsIGZ1bmN0aW9uIChkKSB7DQogICAgICAgICAgICAgIHZhciBvID0ge3g6IGQuc291cmNlLnB4LCB5OiBkLnNvdXJjZS5weX07DQogICAgICAgICAgICAgIHJldHVybiBkaWFnb25hbCh7c291cmNlOiBvLCB0YXJnZXQ6IG99KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgLy8gVHJhbnNpdGlvbiBub2RlcyBhbmQgbGlua3MgdG8gdGhlaXIgbmV3IHBvc2l0aW9ucy4NCiAgICAgICAgICB2YXIgdCA9IHN2Zy50cmFuc2l0aW9uKCkNCiAgICAgICAgICAgIC5kdXJhdGlvbih0cmFuc0xlbmd0aCk7DQoNCiAgICAgICAgICB0LnNlbGVjdEFsbCgiLmxpbmsiKQ0KICAgICAgICAgICAgLmF0dHIoImQiLCBkaWFnb25hbCk7DQoNCiAgICAgICAgICAvKiBqc2hpbnQgLVcwOTMgKi8NCiAgICAgICAgICB2YXIgY2lyY2xlQ29sb3JzID0geyBlbnRlcmVkOiAnI0FGMCcsIGV4aXRlZDogJyM3NzcnLCBhY3RpdmU6ICcjMGYwJywgaW5hY3RpdmU6ICcjNTVGJywgZnV0dXJlOiAnIzAwOScgfTsNCiAgICAgICAgICB0LnNlbGVjdEFsbCgiLm5vZGUiKQ0KICAgICAgICAgICAgLmF0dHIoImN4IiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQucHggPSBkLng7IH0pDQogICAgICAgICAgICAuYXR0cigiY3kiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5weSA9IGQueTsgfSkNCiAgICAgICAgICAgIC5hdHRyKCJyIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuc3RhdHVzID09PSAnYWN0aXZlJyA/IDE1IDogMTA7IH0pDQogICAgICAgICAgICAuc3R5bGUoImZpbGwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gY2lyY2xlQ29sb3JzW2Quc3RhdHVzXSB8fCAiI0ZGRiI7IH0pOw0KDQogICAgICAgICAgdC5zZWxlY3RBbGwoIi5sYWJlbCIpDQogICAgICAgICAgICAuYXR0cigieCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnB4ID0gZC54OyB9KQ0KICAgICAgICAgICAgLmF0dHIoInkiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5weSA9IGQueSAtIDE1OyB9KQ0KICAgICAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiAicm90YXRlKC0yNSAiICsgZC54ICsgIiAiICsgZC55ICsgIikiOyB9KQ0KICAgICAgICAgIDsNCg0KICAgICAgICAgIHQuc2VsZWN0QWxsKCIuYWN0aXZlIikNCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQucHggPSBkLng7IH0pDQogICAgICAgICAgICAuYXR0cigieSIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnB5ID0gZC55IC0gMTU7IH0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgfTsNCiAgfQ0KfSkoKTsNCg0KDQphbmd1bGFyLm1vZHVsZSgiY3QudWkucm91dGVyLmV4dHJhcyIsDQogIFsNCiAgICAnY3QudWkucm91dGVyLmV4dHJhcy5jb3JlJywNCiAgICAnY3QudWkucm91dGVyLmV4dHJhcy5kc3InLA0KICAgICdjdC51aS5yb3V0ZXIuZXh0cmFzLmZ1dHVyZScsDQogICAgJ2N0LnVpLnJvdXRlci5leHRyYXMucHJldmlvdXMnLA0KICAgICdjdC51aS5yb3V0ZXIuZXh0cmFzLnN0YXRldmlzJywNCiAgICAnY3QudWkucm91dGVyLmV4dHJhcy5zdGlja3knLA0KICAgICdjdC51aS5yb3V0ZXIuZXh0cmFzLnRyYW5zaXRpb24nDQogIF0pOw0KDQoNCn0pKGFuZ3VsYXIpOw==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>