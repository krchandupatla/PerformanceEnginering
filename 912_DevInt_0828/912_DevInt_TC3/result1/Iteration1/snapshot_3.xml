<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="3">
  <HTTPTask id="5" hostname="aa-pt6245.dev.accela.com:5443" path="/portlets/framework/includes/javascript/ac360.js" url="https://aa-pt6245.dev.accela.com:5443/portlets/framework/includes/javascript/ac360.js" ip="13.93.163.237" port="5443" client_ip="10.1.61.63" client_port="9074" connectionId="1988" origin="Primary" startDateTime="2017-08-28T11:27:22.420-07:00" startTime="3210" endTime="3229" sendTime="13" waitTime="0" receiveTime="7">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Referer" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9zZWN1cml0eS9ob3N0U2lnbm9uLmRvP3N1Y2Nlc3NVcmw9aHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zcGEvZGFzaGJvYXJkLmRv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SlNFU1NJT05JRD0qKioqKioqKioqKioqKioqKioqKioqKioqKio7IExBU1RFU1RfUkVRVUVTVF9USU1FPTE1MDM5NDQ4Mzg2MjI7IGhvc3RTaWduT249IiI7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9wb3J0bGV0cy9mcmFtZXdvcmsvaW5jbHVkZXMvamF2YXNjcmlwdC9hYzM2MC5qcyBIVFRQLzEuMQ0KUmVmZXJlcjogaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9zZWN1cml0eS9ob3N0U2lnbm9uLmRvP3N1Y2Nlc3NVcmw9aHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zcGEvZGFzaGJvYXJkLmRvDQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXT1c2NDsgVHJpZGVudC83LjA7IHJ2OjExLjApIGxpa2UgR2Vja28NCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZQ0KQWNjZXB0LUxhbmd1YWdlOiBlbi1VUw0KQWNjZXB0OiAqLyoNCkNvbm5lY3Rpb246IEtlZXAtQWxpdmUNCkhvc3Q6IGFhLXB0NjI0NS5kZXYuYWNjZWxhLmNvbTo1NDQzDQpDb29raWU6IEpTRVNTSU9OSUQ9KioqKioqKioqKioqKioqKioqKioqKioqKioqOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ0ODM4NjIyOyBob3N0U2lnbk9uPSIiOyBnX2N1cnJlbnRfbGFuZ3VhZ2VfZXh0PWVuX1VTDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="JSESSIONID" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>KioqKioqKioqKioqKioqKioqKioqKioqKioq</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LASTEST_REQUEST_TIME" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTUwMzk0NDgzODYyMg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="hostSignOn" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>IiI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="g_current_language_ext" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW5fVVM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLUNveW90ZS8xLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHJpdmF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Expires" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBVVEM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-XSS-Protection" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SlNFU1NJT05JRD00MGtvRFN6KzRwMmQtb1pxeklzZEtQKzA7IFBhdGg9L3BvcnRsZXRzOyBTZWN1cmU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NDg0MDAyODsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFURVNUX1dFQl9TRVJWRVI9MTAuMS4wLjY7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFURVNUX1NFU1NJT05fSUQ9NDBrb0RTeis0cDJkLW9acXpJc2RLUCswOyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJl</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Vy8iODg0NjgtMTQ5ODc0NzEzNjAwMCI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAyOSBKdW4gMjAxNyAxNDozODo1NiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Transfer-Encoding" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y2h1bmtlZA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="13">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="14">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="15">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyOCBBdWcgMjAxNyAxODoyNzoxOSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IEFwYWNoZS1Db3lvdGUvMS4xDQpDYWNoZS1Db250cm9sOiBwcml2YXRlDQpFeHBpcmVzOiBUaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIFVUQw0KWC1YU1MtUHJvdGVjdGlvbjogMA0KU2V0LUNvb2tpZTogSlNFU1NJT05JRD00MGtvRFN6KzRwMmQtb1pxeklzZEtQKzA7IFBhdGg9L3BvcnRsZXRzOyBTZWN1cmUNClNldC1Db29raWU6IExBU1RFU1RfUkVRVUVTVF9USU1FPTE1MDM5NDQ4NDAwMjg7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmUNClNldC1Db29raWU6IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJlDQpTZXQtQ29va2llOiBMQVRFU1RfU0VTU0lPTl9JRD00MGtvRFN6KzRwMmQtb1pxeklzZEtQKzA7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpFVGFnOiBXLyI4ODQ2OC0xNDk4NzQ3MTM2MDAwIg0KTGFzdC1Nb2RpZmllZDogVGh1LCAyOSBKdW4gMjAxNyAxNDozODo1NiBHTVQNCkNvbnRlbnQtVHlwZTogdGV4dC9qYXZhc2NyaXB0DQpUcmFuc2Zlci1FbmNvZGluZzogY2h1bmtlZA0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KVmFyeTogQWNjZXB0LUVuY29kaW5nDQpEYXRlOiBNb24sIDI4IEF1ZyAyMDE3IDE4OjI3OjE5IEdNVA0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>Ly9BY2NlbGEgQXV0b21hdGlvbg0KLy9GaWxlOiBtZW51QmFyLmpzcA0KLy9BY2NlbGEsIEluYy4NCi8vQ29weXJpZ2h0IChDKTogMjAwMy0yMDE0DQovLw0KLy9EZXNjcmlwdGlvbjogVGhpcyBqYXZhc2NyaXB0IGltcGxlbWVudCB0aGUgZHluYW1pYyBtZW51IGJhciBmdW5jdGlvbi4NCi8vDQovL05vdGVzOiAgICAgDQovLyRJZDogYWMzNjAuanMgMjc4MjkwIDIwMTQtMDktMDEgMDg6MTY6MjhaIEFDSElFVk9cdmljdG9yLnRhbiAkDQovLw0KDQpkb2N1bWVudC53cml0ZSgiPHNjcmlwdCBzcmM9Jy9wb3J0bGV0cy9mcmFtZXdvcmsvaW5jbHVkZXMvamF2YXNjcmlwdC9JMThOLmpzJz48L3NjcmlwdD4iKTsNCmRvY3VtZW50LndyaXRlKCI8c2NyaXB0IHNyYz0nL3BvcnRsZXRzL2ZyYW1ld29yay9pbmNsdWRlcy9qYXZhc2NyaXB0L2NoZWNrVGV4dEFyZWFMZW5ndGguanMnPjwvc2NyaXB0PiIpOw0KLy8gYXZvaWQgZHVwbGljYXRlIGltcG9ydCBVdGlsLmpzLCBjYXVzZSBpbmNyZWFzZSBtZXRob2Qgb2YgdGhlIHZhbHVlIGlzIHJlc2V0DQppZiAodHlwZW9mKFV0aWwpID09ICJ1bmRlZmluZWQiKQ0Kew0KCWRvY3VtZW50LndyaXRlKCI8c2NyaXB0IHNyYz0nL3BvcnRsZXRzL2ZyYW1ld29yay9pbmNsdWRlcy9qYXZhc2NyaXB0L3dpZGdldC9VdGlsLmpzJz48L3NjcmlwdD4iKTsNCn0NCg0KdmFyIG5zNCA9IGRvY3VtZW50LmxheWVycz8gdHJ1ZSA6IGZhbHNlOw0KdmFyIGllID0gKCJBY3RpdmVYT2JqZWN0IiBpbiB3aW5kb3cpPyB0cnVlIDogZmFsc2U7DQp2YXIgZG9tID0gZmFsc2U7DQovL3N0b3JlcyBjdXJyZW50bHkgaGlnaGxpZ2h0ZWQgcm93IGlkDQp2YXIgaGlnaGxpZ2h0ZWRSb3cgPSAnJzsNCnZhciBpc1N1Ym1pdD1mYWxzZTsNCnZhciBibHVyZWQgPSBmYWxzZTsNCg0KdmFyIHByaW1hcnlPYmpJbmQgPSAnJzsNCg0KdmFyIGlzRm9jdXNFbGVtZW50ID0gZmFsc2U7DQp2YXIgZm9jdXNFbGVtZW50TmFtZSA9ICcnOw0KDQovL3NlY3Rpb24gNTA4DQp2YXIgZ0Vycm9yUGFubGVBY2Nlc3NLZXkgPSA5Ow0KdmFyIGN1cnJlbnRGb2N1c01lbnUgPSBudWxsOw0KDQovL3N0b3JlIHRoZSBmdW5jdGlvbnMgdG8gcnVuIGFmdGVyIGNsaWNrIHRoZSByZXNldCBidXR0b24uDQp2YXIgb25BZnRlclJlc2V0UXVldWU9W107DQoNCi8qIA0KICogVGhpcyBmbGFnIHNob3VsZCBhbHdheXMgYmUgZmFsc2Ugd2hlbiBzdWJtaXR0aW5nIHRvIFNWTi4NCiAqIEl0IHNob3dzIGlmIGRldmVsb3BlciBpcyB1c2luZyBjb25zb2xlIGRlYnVnIHRvb2wsIHN1Y2ggYXMgRmlyZUJ1ZywgQ29tcGFuaW9uLkpTLg0KICovDQp2YXIgaXNTdXBwb3J0Q29uc29sZSA9IGZhbHNlOw0KDQp2YXIgYWNjZWxhQ29uc29sZSA9IHsNCglsb2c6IGZ1bmN0aW9uKHBNc2cpDQoJew0KCQlpZiAoaXNTdXBwb3J0Q29uc29sZSkNCgkJew0KCQkJaWYgKHdpbmRvdy5jb25zb2xlICYmIHdpbmRvdy5jb25zb2xlLmxvZykNCgkJCXsNCgkJCQl3aW5kb3cuY29uc29sZS5sb2cocE1zZyk7DQoJCQl9DQoJCX0NCgl9CQ0KfTsNCg0KZnVuY3Rpb24gc2VuZEh0dHBSZXF1ZXN0KHVybCwgcGFyYW0sIHN5bmMpDQp7DQoJdmFyIHJldHVybkRhdGEgPSAiIjsNCgl2YXIgeG1sSHR0cCA9IGNyZWF0ZVhNTEh0dHBSZXF1ZXN0KCk7DQoJaWYgKCF4bWxIdHRwKSANCgl7DQoJCXRocm93IG5ldyBFcnJvcigiWE1MSHR0cCBvYmplY3QgY291bGQgYmUgY3JlYXRlZC4iKTsNCgl9DQoJeG1sSHR0cC5vcGVuKCJQT1NUIiwgdXJsLCBzeW5jKTsNCgl4bWxIdHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGNhbGxCYWNrOw0KCXhtbEh0dHAuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpOw0KCXhtbEh0dHAuc2VuZChwYXJhbSk7DQoJaWYoIXN5bmMpDQoJew0KCQljYWxsQmFjaygpOw0KCX0NCglyZXR1cm4gcmV0dXJuRGF0YTsNCgkNCglmdW5jdGlvbiBjYWxsQmFjaygpDQoJew0KCQlpZih4bWxIdHRwLnJlYWR5U3RhdGUgPT0gNCkNCgkJew0KCQkJaWYgKHhtbEh0dHAuc3RhdHVzID09IDIwMCkNCgkJCXsNCgkJCQlyZXR1cm5EYXRhID0geG1sSHR0cC5yZXNwb25zZVRleHQ7DQoJCQl9DQoJCX0NCgl9DQp9DQoNCmZ1bmN0aW9uIGludGVyY2VwdGVyU3VibWl0KGEpDQp7DQoJcmV0dXJuIHRydWU7DQp9DQoNCi8vVmFsaWRhdGUgbWFzayBmb3JtYXQgYmVmb3JlIHN1Ym1pdC4NCmZ1bmN0aW9uIHZhbGlkYXRlTWFzayhhKQ0Kew0KCXJldHVybiB0cnVlOw0KfQ0KDQovL0ZvciAxMEFDQy0wMzQ4MiBmZWF0dXJlLCBpbiBjb25kaXRpb24gZGV0YWlsIHBhZ2UgLT4gc3VibWl0IGZ1bmN0aW9uICAgDQovL2ludGVyY2VwdGVyU3VibWl0KCkgZnVuY3Rpb24gaGFzIGJlZW4gdXNlZCBieSB0ZW1wbGF0ZSwgYWRkIHRoZSBiZWxvdyBKUyBmdW5jdGlvbiBmb3IgSFRNTCBlZGl0b3IgdG8gdXNlLg0KZnVuY3Rpb24gaHRtbEVkaXRvckludGVyY2VwdGVyU3VibWl0KGEpDQp7DQoJcmV0dXJuIHRydWU7DQp9DQoNCmZ1bmN0aW9uIFNpbXVsYXRlQ2xpY2soKXsgLy92MS4wCQ0KCXZhciBmbGFnLHgsYT1TaW11bGF0ZUNsaWNrLmFyZ3VtZW50czsNCgkvLyBZYW4gWGlhbyAtIFN1cHBvcnQgTmV0c2NhcGUgYW5kIEZpcmVmb3ggKFNBTiMgMDZBQ1QtMDAwMDAtMDAyMzUpOg0KCS8vIE9yaWdpbmFsIGNvZGUgYXNzdW1lZCB0aGF0IHdpbmRvdy5ldmVudCBpcyB0aGUgY3VycmVudCBldmVudC4NCgkvLyBIb3dldmVyLCBGaXJlZm94IGRvZXMgbm90IGRlZmluZSB3aW5kb3cuZXZlbnQgYXQgYWxsLiBBcyByZXN1bHQsIHdlIG5lZWQgdG8gdXNlICJ0aGlzLmV2ZW4iIGluc3RlYWQgb2YgImV2ZW4iLg0KCXZhciBldmVudCA9ICh3aW5kb3cuZXZlbnQpID8gd2luZG93LmV2ZW50IDogdGhpcy5ldmVudDsNCglpZiAoZXZlbnQpDQoJew0KCQlldmVudC5jYW5jZWxCdWJibGUgPSB0cnVlOwkJDQoJfQ0KCXZhciBvcmlnRm9ybUFjdGlvbjsNCgl2YXIgb3JpZ0Zvcm1UYXJnZXQ7DQoJdmFyIHRva2VuX2J1dHRvbiA9ICIiOw0KCXZhciB0b2tlbl9vcmlnID0gIiI7DQoJaWYoIUFjMzYwLnZhbGlkYXRvci5pc0VtcHR5KGRvY3VtZW50LmZvcm1zWzBdLkNTUkZfUkVRX1BBUkFNKSkNCgl7DQoJCXRva2VuX29yaWcgPSBkb2N1bWVudC5mb3Jtc1swXS5DU1JGX1JFUV9QQVJBTS52YWx1ZTsNCgl9DQoJDQoJaWYgKCF2YWxpZGF0ZU1hc2soYSkgfHwgIWludGVyY2VwdGVyU3VibWl0KGEpIHx8ICFodG1sRWRpdG9ySW50ZXJjZXB0ZXJTdWJtaXQoYSkpDQoJew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCQ0KCQ0KCWlmKGEubGVuZ3RoPjIpDQoJew0KCQlmbGFnPWFbMF07DQoJCWZvciggdmFyIGk9MTsgaTxhLmxlbmd0aDsgaSs9MikNCgkJew0KCQkJaWYoYVtpXSA9PSAidGFyZ2V0IikNCgkJCXsNCgkJCQlpZihhW2krMV0gIT0gIiIpDQoJCQkJew0KCQkJCQlvcmlnRm9ybUFjdGlvbiA9IGRvY3VtZW50LmZvcm1zWzBdLmFjdGlvbjsNCgkJCQkJb3JpZ0Zvcm1UYXJnZXQgPSBkb2N1bWVudC5mb3Jtc1swXS50YXJnZXQ7DQoJCQkJCWRvY3VtZW50LmZvcm1zWzBdLnRhcmdldD1hW2krMV07DQoJCQkJfQ0KCQkJCWVsc2UNCgkJCQl7DQoJCQkJCWRvY3VtZW50LmZvcm1zWzBdLnRhcmdldD0nX3NlbGYnOw0KCQkJCX0NCgkJCX0NCgkJCWVsc2UgaWYoYVtpXSA9PSAiYWN0aW9uIiAmJiBhW2krMV0gIT0gIiIpDQoJCQl7DQoJCQkJZG9jdW1lbnQuZm9ybXNbMF0uYWN0aW9uPWFbaSsxXTsNCgkJCX0NCgkJCWVsc2UgaWYoYVtpXSA9PSAibWV0aG9kIiAmJiBhW2krMV0gIT0gIiIpDQoJCQl7DQoJCQkJZG9jdW1lbnQuZm9ybXNbMF0ubWV0aG9kPWFbaSsxXTsNCgkJCX0NCgkJCWVsc2UgaWYoYVtpXSA9PSAicHJlc3VibWl0IiAmJiBhW2krMV0gPT0idHJ1ZSIpDQoJCQl7DQoJCQkJcmVzZXJ2ZWRJID0gaTsNCgkJCQkvL0hlcmUgaGFzIGEgcG90ZW5pY2FsIGphdmFzY3JpcHQgZXJyb3IsIHByZXN1Ym1pdCBmdW5jdGlvbiBkb2VzIG5vdCBleGlzdC4NCgkJCQl0cnkNCgkJCQl7DQoJCQkJCWlmKCFwcmVzdWJtaXQoYVsyXSkpIA0KCQkJCQl7DQoJCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJCX0NCgkJCQl9DQoJCQkJY2F0Y2goZSkNCgkJCQl7DQoJCQkJCS8vaWdub3JlIGVycm9yDQoJCQkJfQ0KCQkJCWkgPSByZXNlcnZlZEk7DQoJCQl9DQoJCQllbHNlIGlmKGFbaSsxXSA9PSAiYWNjZWxhcmVzZXQiKQ0KCQkJew0KCQkJCWZvcm1SZXNldHRpbmcgPSB0cnVlOw0KCQkJCWRvY3VtZW50LmZvcm1zWzBdLnJlc2V0KCk7DQoJCQkJdHJ5DQoJCQkJew0KCQkJCQlpZihvbkFmdGVyUmVzZXQhPW51bGwpDQoJCQkJCXsNCgkJCQkJCW9uQWZ0ZXJSZXNldCgpOw0KCQkJCQl9DQoJCQkJCS8vcGVyZm9ybSB0aGUgY3VzdG9taXplZCBmdW5jdGlvbnMuDQoJCQkJCWZvcih2YXIgbj0wO248b25BZnRlclJlc2V0UXVldWUubGVuZ3RoO24rKykNCgkJCQkJew0KCQkJCQkJb25BZnRlclJlc2V0UXVldWVbbl0oKTsNCgkJCQkJfQ0KCQkJCQkNCgkJCQl9Y2F0Y2goRSl7fQ0KCQkJCWZvcm1SZXNldHRpbmcgPSBmYWxzZTsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoJCQllbHNlIGlmICgoeD1NTV9maW5kT2JqKGFbaV0pKSE9bnVsbCkNCgkJCXsNCgkJCQlpZihhW2ldID09ICJyZWZyZXNoX3RhcmdldCIgJiYgeC52YWx1ZSAhPSBudWxsICYmIHgudmFsdWUubGVuZ3RoID4gMCkNCgkJCQl7DQoJCQkJCS8vaWYgdGhlIHJlZnJlc2ggdGFyZ2V0IHZhbHVlIGlzIGFscmVhZHkgZXhpc3QsIGRvbid0IGNoYW5nZSB0aGUgdGFyZ2V0IGFnYWluLg0KCQkJCQkvLyBBbmQgc2V0IHRoZSBmbGFnIHRvIGRpc2FibGUgYmxhbmsgZnVuY3Rpb24NCgkJCQkJdmFyIGlzQmxhbmtPYmo9Z2V0UGFyZW50T2JqZWN0KCJpc0JsYW5rVGhpcmQiKTsNCgkJCQkJaWYoaXNCbGFua09iaiAhPW51bGwpDQoJCQkJCXsNCgkJCQkJCWlzQmxhbmtPYmoudmFsdWU9Ik5vIjsNCgkJCQkJfQkJCQkJDQoJCQkJfQ0KCQkJCWVsc2UNCgkJCQl7DQoJCQkJCXgudmFsdWU9YVtpKzFdOw0KCQkJCX0NCgkJCX0NCgkJCWVsc2UgaWYoYVtpXSA9PSAiZXJyb3JTaG93IiAmJiBhW2krMV0gPT0iWSIpDQoJCQkJZG9jdW1lbnQuZm9ybXNbMF0uZXJyb3JTaG93LnZhbHVlPSJZIjsNCgkJCWVsc2UgaWYoYVtpXSA9PSAibm9SaWdodCIgJiYgYVtpKzFdID09IlkiKQ0KCQkJCWRvY3VtZW50LmZvcm1zWzBdLm5vUmlnaHQudmFsdWU9IlkiOwkJCQkNCgkJCWVsc2UgaWYoYVtpXSA9PSAiYnV0dG9uVG9rZW4iKQ0KCQkJew0KCQkJCXRva2VuX2J1dHRvbiA9IGFbaSsxXTsNCgkJCX0NCgkJCWVsc2UgaWYgKGFbaV0gPT0gIm5vUmVmcmVzaCIpDQoJCQl7DQoJCQl9DQoJCX0NCgl9DQoJDQoJaWYoIWlzU3VibWl0KQ0KCXsNCgkJZW5hYmxlQWxsU2VsZWN0KCk7DQoJCWlmKGRvY3VtZW50LmZvcm1zWzBdKQ0KCQl7DQoJCQlpZiAoZG9jdW1lbnQuZm9ybXNbMF0udGFyZ2V0PT0nX3NlbGYnKSBpc1N1Ym1pdD10cnVlOw0KCQl9DQoJCWlmKGZsYWc9PTApDQoJCXsNCgkJCXJldHVybiB0cnVlOw0KCQl9CQkNCgkJaWYoZG9jdW1lbnQuZm9ybXNbMF0pDQoJCXsNCgkJCWRvY3VtZW50LmZvcm1zWzBdLnN1Ym1pdCgpOw0KCQkJaWYoZG9jdW1lbnQuZm9ybXNbMF0udGFyZ2V0IT0nX3NlbGYnKSANCgkJCXsNCgkJCQlkb2N1bWVudC5mb3Jtc1swXS5hY3Rpb24gPSBvcmlnRm9ybUFjdGlvbjsNCgkJCQlkb2N1bWVudC5mb3Jtc1swXS50YXJnZXQgPSBvcmlnRm9ybVRhcmdldDsNCgkJCQl0b2tlbi5zZXRUb2tlbkluRm9ybSh0b2tlbl9idXR0b24pOw0KCQkJCXRva2VuLm9idGFpblRva2VuKCk7DQoJCQl9DQoJCQllbHNlDQoJCQl7DQoJCQkJdHJ5ewkJDQoJCQkJCW5ldyBVSS5Qcm9jZXNzQmFyKCkucmVuZGVyKCk7DQoJCQkJfWNhdGNoKGUpe30NCgkJCX0NCgkJfQ0KCX0NCglyZXR1cm4gZmFsc2U7DQp9DQoNCmZ1bmN0aW9uIE1NX3N3YXBJbWdSZXN0b3JlKCkgeyAvL3YzLjANCgl2YXIgaSx4LGE9ZG9jdW1lbnQuTU1fc3I7DQoJZm9yKGk9MDthJiZpPGEubGVuZ3RoJiYoeD1hW2ldKSYmeC5vU3JjO2krKykNCgl7DQoJCXguc3JjPXgub1NyYzsNCgl9DQp9DQoNCmZ1bmN0aW9uIE1NX3ByZWxvYWRJbWFnZXMoKSB7IC8vdjMuMA0KCXZhciBkPWRvY3VtZW50Ow0KCWlmKGQuaW1hZ2VzKQ0KCXsNCgkJaWYoIWQuTU1fcCkNCgkJew0KCQkJZC5NTV9wPW5ldyBBcnJheSgpOw0KCQl9DQoJCXZhciBpLGo9ZC5NTV9wLmxlbmd0aCxhPU1NX3ByZWxvYWRJbWFnZXMuYXJndW1lbnRzOw0KCQlmb3IoaT0wOyBpPGEubGVuZ3RoOyBpKyspDQoJCXsNCgkJCWlmIChhW2ldLmluZGV4T2YoIiMiKSE9MCkNCgkJCXsNCgkJCQlkLk1NX3Bbal09bmV3IEltYWdlOw0KCQkJCWQuTU1fcFtqKytdLnNyYz1hW2ldOw0KCQkJfQ0KCQl9DQoJfQ0KfQ0KDQpmdW5jdGlvbiBNTV9maW5kT2JqKG4sIGQpIHsgLy92NC4wMQ0KCXZhciBwLGkseDsNCglpZighZCl7DQoJCWQ9ZG9jdW1lbnQ7DQoJfQ0KCWlmKChwPW4uaW5kZXhPZigiPyIpKT4wJiZwYXJlbnQuZnJhbWVzLmxlbmd0aCkNCgl7DQoJCWQ9cGFyZW50LmZyYW1lc1tuLnN1YnN0cmluZyhwKzEpXS5kb2N1bWVudDsNCgkJbj1uLnN1YnN0cmluZygwLHApOw0KCX0NCglpZighKHg9ZFtuXSkmJmQuYWxsKXsNCgkJeD1kLmFsbFtuXTsNCgl9DQoJZm9yIChpPTA7IXgmJmk8ZC5mb3Jtcy5sZW5ndGg7aSsrKQ0KCXsNCgkJLy94PWQuZm9ybXNbaV1bbl07DQoJCWlmIChkLmZvcm1zW2ldKQ0KCQl7DQoJCQl4PShkLmZvcm1zW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdmb3JtJykpW25dOw0KCQl9CQ0KCX0NCglmb3IoaT0wOyF4JiZkLmxheWVycyYmaTxkLmxheWVycy5sZW5ndGg7aSsrKQ0KCXsNCgkJeD1NTV9maW5kT2JqKG4sZC5sYXllcnNbaV0uZG9jdW1lbnQpOw0KCX0NCglpZigheCAmJiBkLmdldEVsZW1lbnRCeUlkKQ0KCXsNCgkJeD1kLmdldEVsZW1lbnRCeUlkKG4pOw0KCX0NCglyZXR1cm4geDsNCn0NCg0KZnVuY3Rpb24gTU1fc3dhcEltYWdlKCkgeyAvL3YzLjANCgl2YXIgaSxqPTAseCxhPU1NX3N3YXBJbWFnZS5hcmd1bWVudHM7DQoJZG9jdW1lbnQuTU1fc3I9bmV3IEFycmF5Ow0KCWZvcihpPTA7aTwoYS5sZW5ndGgtMik7aSs9MykNCgl7DQoJCXg9TU1fZmluZE9iaihhW2ldKTsNCgkJaWYgKHghPW51bGwgJiYgIXguZGlzYWJsZWQpDQoJCXsNCgkJCWRvY3VtZW50Lk1NX3NyW2orK109eDsNCgkJCWlmKCF4Lm9TcmMpDQoJCQl7DQoJCQkJeC5vU3JjPXguc3JjOw0KCQkJfQ0KCQkJeC5zcmM9YVtpKzJdOw0KCQl9DQoJfQ0KfQ0KDQpmdW5jdGlvbiBNTV9zaG93SGlkZUxheWVycygpIHsgLy92Ni4wDQogIHZhciBpLHAsdixvYmosYXJncz1NTV9zaG93SGlkZUxheWVycy5hcmd1bWVudHM7DQogIHZhciB0aGVNZW51T2JqOw0KICANCiAgLy9wdXQgdGhlIG1lbnUgb2JqIGFzIGxhc3QgYXJndW1lbnQsIGlmIGl0IGlzIG51bGwsIGl0IG1lYW5zIGl0IGlzICdkYXluYW1pY01lbnUnLg0KICBpZiAoYXJncy5sZW5ndGggJSAzICE9IDEpDQogIHsNCiAgCXRoZU1lbnVPYmogPSAnZGF5bmFtaWNNZW51JzsNCiAgfQ0KCWVsc2UNCgl7DQoJCXRoZU1lbnVPYmogPSBhcmdzW2FyZ3MubGVuZ3RoLTFdOw0KCX0NCgkNCgltZW51T2JqID0gZ2V0T2JqZWN0KHRoZU1lbnVPYmopOw0KCSAgDQogIGZvciAoaT0wOyBpPChhcmdzLmxlbmd0aC0yKTsgaSs9MykgaWYgKChvYmo9TU1fZmluZE9iaihhcmdzW2ldKSkhPW51bGwpDQogIHsNCiAgCXY9YXJnc1tpKzJdOw0KCWlmIChvYmouc3R5bGUpDQogICAgew0KCSAgICBvYmo9b2JqLnN0eWxlOw0KCSAgICB2PSh2PT0nc2hvdycpPyd2aXNpYmxlJzoodj09J2hpZGUnKT8naGlkZGVuJzp2Ow0KICAgIH0NCiAgICBpZiAoIG1lbnVPYmogIT0gbnVsbCkNCiAgICB7DQogICAgCW9iai50b3A9bWVudU9iai5zdHlsZS5ib3R0b207DQogIAl9DQogICAgb2JqLnZpc2liaWxpdHk9djsNCiAgfQ0KCXRyeXsNCgkJdmFyIGpldHNwZWVkVG9wID0gdGhpczsNCgkJdmFyIGkgPSAwOw0KCQl3aGlsZShpPDUpDQoJCXsNCgkJCWlmIChqZXRzcGVlZFRvcC5pZnJhbWVSZXNpemUpIA0KCQkJCWJyZWFrOw0KCQkJamV0c3BlZWRUb3AgPSBqZXRzcGVlZFRvcC5wYXJlbnQ7CQ0KCQkJaSsrOw0KCQl9DQoJCWlmKGpldHNwZWVkVG9wLmlmcmFtZVJlc2l6ZSkNCgkJew0KCQkJLy8gY2FsbCBpZnJhbWUgcmVzaXplIG9uIHRoZSBwYXJlbnQNCgkJCWpldHNwZWVkVG9wLmlmcmFtZVJlc2l6ZSgpOwkJCQ0KCQl9DQoJfSBjYXRjaCAoZXJyb3IpIHsgDQoJLy9tdXN0IGJlIHNlY3VyaXR5IHZpb2xhdGlvbi4uLiBqdXN0IGlnbm9yZS4NCgl9DQoNCn0NCg0KDQoNCmZ1bmN0aW9uIFByaW50UGFnZSgpIHsNCiAgIGRvY3VtZW50LmZvcm1zWzBdLnByaW50YnV0dG9uLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsNCiAgIHdpbmRvdy5wcmludCgpOw0KICAgcmV0dXJuIGZhbHNlOw0KfQ0KDQpmdW5jdGlvbiBpc051bWJlcihzKQ0Kew0KDQoJdmFyIGk7DQoJCWZvciAoaSA9IDA7IGkgPCBzLmxlbmd0aDsgaSsrKQ0KCQl7DQogICAgCQkvLyBDaGVjayB0aGF0IGN1cnJlbnQgY2hhcmFjdGVyIGlzIG51bWJlci4NCiAgICAJCXZhciBjID0gcy5jaGFyQXQoaSk7DQogICAgCQlpZiAoKChjIDwgIjAiKSB8fCAoYyA+ICI5IikpKSByZXR1cm4gZmFsc2U7DQoJCX0NCgkJLy8gQWxsIGNoYXJhY3RlcnMgYXJlIG51bWJlcnMuDQoJCXJldHVybiB0cnVlOw0KfQ0KDQpmdW5jdGlvbiBmaW5kSW5kZXhCeU5hbWUobmFtZSkNCnsNCglmb3IodmFyIGkgPSAwOyBpIDwgZG9jdW1lbnQuZm9ybXNbMF0uZWxlbWVudHMubGVuZ3RoOyBpKyspDQoJew0KCQlzdHIgPSBkb2N1bWVudC5mb3Jtc1swXS5lbGVtZW50c1tpXS5uYW1lOw0KCQlpZiAoc3RyID09IG5hbWUpDQoJCXsNCgkJCXJldHVybiBpOw0KCQl9DQoJfQ0KCXJldHVybiAtMTsNCn0NCg0KLyoqDQogKiBmdW5jdGlvbiB0byBnZXQgaW5zcGVjdGlvbiBjYWxlbmRhci4NCiAqDQogKiBpc011bHRpcGxlSW5zcFR5cGUgJ1knLCdOJw0KICovDQpmdW5jdGlvbiBzZWxlY3RJbnNwZWN0aW9uRGF0ZShkYXRlTmFtZSwgaXNJbnNwZWN0aW9uLCBpbnNwZWN0b3JJRCwgaXNNdWx0aXBsZUluc3BUeXBlLCBtb2R1bGVOYW1lKQ0Kew0KCXZhciBmb3JtTmFtZSA9IGRvY3VtZW50LmZvcm1zWzBdLm5hbWU7DQoJdmFyIHJlYWRPbmx5ID0gZG9jdW1lbnQuZm9ybXNbMF0uZWxlbWVudHNbZGF0ZU5hbWVdLmdldEF0dHJpYnV0ZSgncmVhZG9ubHknKSArICIiOw0KCWlmIChyZWFkT25seSA9PSAidHJ1ZSIpDQoJew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KDQoJaWYgKGlzSW5zcGVjdGlvbiAhPSAiWSIpDQoJew0KCQlyZXR1cm4gc2VsZWN0RGF0ZShkYXRlTmFtZSk7DQoJfQ0KCQ0KCWlmIChpc011bHRpcGxlSW5zcFR5cGUgPT0gIk4iKSAvLyBpbnNwZWN0b3JJRCBpcyBpbnNwZWN0aW9uIHR5cGUgaW4gZmFjdC4NCgl7DQoJCWlmIChpbnNwZWN0b3JJRCA9PSBudWxsIHx8IGluc3BlY3RvcklEID09ICIiIHx8IGluc3BlY3RvcklEID09ICItLVNlbGVjdC0tIikNCgkJew0KCQkJYWxlcnQoZ2V0VGV4dGxhYmxlKCJlcnJvci5qcy5hYzM2MC5zZWxlY3RJbnNwZWN0aW9uIikpOw0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJfQ0KCQ0KCXZhciBldmVudCA9ICh3aW5kb3cuZXZlbnQpID8gd2luZG93LmV2ZW50IDogdGhpcy5ldmVudDsNCgkNCglpZiAoZXZlbnQpDQoJew0KCQl2YXIgbGVmdDEgPSBldmVudC5zY3JlZW5YOw0KCQl2YXIgdG9wMSA9IGV2ZW50LnNjcmVlblk7DQoJfQ0KCQ0KCWlmKGxlZnQxKzIyNz5zY3JlZW4ud2lkdGgpew0KCQkJbGVmdDEgPWxlZnQxLTIyNzsNCgl9DQoJaWYodG9wMSsxNzU+c2NyZWVuLmhlaWdodCl7DQoJCQl0b3AxID10b3AxLTE3NTsNCgl9CQ0KCXZhciBzZXR0aW5ncyA9ICJ3aWR0aD0yMTAsaGVpZ2h0PTE2Mix0b3A9Iit0b3AxKyIsbGVmdD0iK2xlZnQxOw0KCXNldHRpbmdzICs9ICIsc2Nyb2xsYmFycz15ZXMscmVzaXphYmxlPW5vLHRvb2xiYXI9bm8sc3RhdHVzPW5vLG1lbnViYXI9bm8sc2Nyb2xsYmFycz1ubyI7DQoJIA0KCXZhciB1cmw7DQoJICAJCSAgCSANCgl2YXIgdXNlcklucHV0RGF0ZSA9IGV2YWwoImRvY3VtZW50LiIrZm9ybU5hbWUrIi5lbGVtZW50c1snIitkYXRlTmFtZSsiJ10udmFsdWUiKTsNCgkvLyBZYW4gWGlhbyAtIFN1cHBvcnQgTmV0c2NhcGUgYW5kIEZpcmVmb3ggKFNBTiMgMDZBQ1QtMDAwMDAtMDAyMzUpOiANCgkvLyBhY2NvdW50IGZvciAiZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUoY2FwTW9kZWwqZmlsZURhdGUpKSBoYXMgbm8gcHJvcGVydGllcyIgY2F1c2luZyBkYXRlIHBpY2tlciBub3Qgd29ya2luZyBpbiBGaXJlZm94IGFuZCBOZXRzY2FwZS4NCgl2YXIgaW5wdXREYXRlTmFtZSA9IGV2YWwoImRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCciK2RhdGVOYW1lKyInKVswXS5uYW1lIik7DQoJaWYoaW5wdXREYXRlTmFtZS5pbmRleE9mKCJfdmFsdWUiKSE9IC0xKQ0KCXsNCgkJCXZhciBoaWRkZW5fbmFtZSA9IGlucHV0RGF0ZU5hbWUuc3Vic3RyaW5nKDAsaW5wdXREYXRlTmFtZS5pbmRleE9mKCJfdmFsdWUiKSkrIl9tYXNrZm9ybWF0IitpbnB1dERhdGVOYW1lLnN1YnN0cmluZygoaW5wdXREYXRlTmFtZS5pbmRleE9mKCJfdmFsdWUiKSs3KSwoaW5wdXREYXRlTmFtZS5sZW5ndGgtMSkpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoJCQl2YXIgbWFzayA9IGV2YWwoImRvY3VtZW50LiIrZm9ybU5hbWUrIi5lbGVtZW50c1tcJyIraGlkZGVuX25hbWUrIlwnXS52YWx1ZSIpOw0KCQkJdXJsID0gIi9wb3J0bGV0cy9jb21tb25zL2RhdGFwaWNrZXIvaW5zcGVjdGlvbkNhbGVuZGFyLmpzcD9mb3JtPSIgKyBlbmNvZGVVUkkoZm9ybU5hbWUgKyAiJmlucHV0RGF0ZT0iICtkYXRlTmFtZSArICImdXNlcklucHV0RGF0ZT0iICsgdXNlcklucHV0RGF0ZSArICImbWFzaz0iICsgbWFzayArICImaXNJbnNwZWN0aW9uPSIgKyBpc0luc3BlY3Rpb24gKyAiJmluc3BlY3RvcklEPSIgKyBpbnNwZWN0b3JJRCArICImaXNNdWx0aXBsZUluc3BUeXBlPSIgKyBpc011bHRpcGxlSW5zcFR5cGUgKyAiJm1vZHVsZT0iICsgbW9kdWxlTmFtZSk7DQoJfQ0KCWVsc2UNCgl7DQoJICAgCQl1cmwgPSAiL3BvcnRsZXRzL2NvbW1vbnMvZGF0YXBpY2tlci9pbnNwZWN0aW9uQ2FsZW5kYXIuanNwP2Zvcm09IiArIGVuY29kZVVSSShmb3JtTmFtZSArICImaW5wdXREYXRlPSIgKyBkYXRlTmFtZSArICImdXNlcklucHV0RGF0ZT0iICsgdXNlcklucHV0RGF0ZSArICImaXNJbnNwZWN0aW9uPSIgKyBpc0luc3BlY3Rpb24gKyAiJmluc3BlY3RvcklEPSIgKyBpbnNwZWN0b3JJRCArICImaXNNdWx0aXBsZUluc3BUeXBlPSIgKyBpc011bHRpcGxlSW5zcFR5cGUgKyAiJm1vZHVsZT0iICsgbW9kdWxlTmFtZSk7DQoJfSANCgluZXd3aW4gPSB3aW5kb3cub3Blbih1cmwsIkRhdGVQaWNrZXIiLHNldHRpbmdzKTsNCgkgDQoJaWYgKG5ld3dpbi5vcGVuZXIgPT0gbnVsbCkNCgkJICAJbmV3d2luLm9wZW5lcj13aW5kb3c7DQoJCSAJbmV3d2luLmZvY3VzKCk7DQoJCSAJcmV0dXJuIGZhbHNlOyANCn0NCg0KZnVuY3Rpb24gTU1fY2xpY2tEcm9wTWVudShkcm9wTWVudSkNCnsJCQ0KCWlmIChkcm9wTWVudS5jbGljaykNCgl7DQoJCWlmKHdpbmRvdy5ldmVudC5zcmNFbGVtZW50LnRhZ05hbWUhPSdBJyAmJiB3aW5kb3cuZXZlbnQuc3JjRWxlbWVudC50YWdOYW1lIT0nRk9OVCcpCQkJDQoJCXsJCQkJDQoJCQlkcm9wTWVudS5jbGljaygpOw0KCQl9DQoJfQkNCgllbHNlDQoJewkvLyBTdXBwb3J0IE5ldHNjYXBlIGFuZCBGaXJlZm94IChTQU4jIDA2QUNULTAwMDAwLTAwMjM1KTogZHJvcE1lbnUuY2xpY2soKSBpcyBub3QgYSBmdW5jdGlvbiBpbiBGaXJlZm94Lg0KCQlNb3ppbGxhTGlua0NsaWNrKGRyb3BNZW51KTsNCgl9DQoJLy8gWWFuIFhpYW8gLSBTdXBwb3J0IE5ldHNjYXBlIGFuZCBGaXJlZm94IChTQU4jIDA2QUNULTAwMDAwLTAwMjM1KTogDQoJLy8gT3JpZ2luYWwgY29kZSBhc3N1bWVkIHRoYXQgd2luZG93LmV2ZW50IGlzIHRoZSBjdXJyZW50IGV2ZW50Lg0KCS8vIEhvd2V2ZXIsIEZpcmVmb3ggZG9lcyBub3QgZGVmaW5lIHdpbmRvdy5ldmVudCBhdCBhbGwuIEFzIHJlc3VsdCwgd2UgbmVlZCB0byB1c2UgInRoaXMuZXZlbiIgaW5zdGVhZCBvZiAiZXZlbiIuDQoJdmFyIGV2ZW50ID0gKHdpbmRvdy5ldmVudCkgPyB3aW5kb3cuZXZlbnQgOiB0aGlzLmV2ZW50Ow0KCWlmIChldmVudCkNCgl7DQoJCWV2ZW50LmNhbmNlbEJ1YmJsZSA9IHRydWU7CQkJDQoJfQkJCQkNCn0NCmZ1bmN0aW9uIHRleHRMZW5ndGhMaW1pdCgpIHsgDQoJdmFyIG1heExlbjsNCgl2YXIgYWNFdmVudCA9IF9nZXRBQ0V2ZW50KCk7DQoJdmFyIHRhT2JqPWFjRXZlbnQuc3JjRWxlbWVudDsJDQoJaWYodGFPYmoubWF4bGVuZ3RoKQ0KCXsNCgkJdmFyIHJlYWxNYXhsZW5ndGggPSB0YU9iai5tYXhsZW5ndGg7DQoJCWlmKHJlYWxNYXhsZW5ndGggPjQwMDApDQoJCXsNCgkJCXJlYWxNYXhsZW5ndGggPSA0MDAwOw0KCQl9DQoJCWlmKGlzRG91YmxlQnl0ZSh0YU9iai52YWx1ZSkpew0KCQkJbWF4TGVuPXJlYWxNYXhsZW5ndGgtZ2V0RG91YmxlQnl0ZUNvdW50KHRhT2JqLnZhbHVlKTsNCgkJfWVsc2V7DQoJCQltYXhMZW4gPSByZWFsTWF4bGVuZ3RoOw0KCQl9DQoJCWlmKCB0YU9iai52YWx1ZS5sZW5ndGggPiBtYXhMZW4qMSkNCgkJew0KCQkJYWxlcnQoZ2V0VGV4dExhYmxlYnlBcmcoImVycm9yLmpzLmFjMzYwLmNvbW1lbnRNYXhsZW5ndGgiLCBuZXcgQXJyYXkocmVhbE1heGxlbmd0aCkpKTsNCgkJCXRhT2JqLnZhbHVlID0gdGFPYmoudmFsdWUuc3Vic3RyaW5nKDAsIG1heExlbioxKTsNCgkJfQ0KCX0NCn0NCi8vMDcvMjMvMjAwNSAgYnkgU3RhbmxleSBEaW5nDQovL3RvIGxpbWl0IHRoZSBsZW5ndGggb2YgdGhlIHRleHRhcmVhLg0KZnVuY3Rpb24gZ2V0U3RyaW5nTGVuZ3RoKHN0cikNCnsNCiAgICB2YXIgbmV3TGluZUNoYXIgPSBuZXcgU3RyaW5nKCJcclxuIik7DQogICAgdmFyIHMgPSBuZXcgU3RyaW5nKHN0cik7DQogICAgdmFyIGxlbmd0aCA9IHMubGVuZ3RoOw0KICAgIHZhciBpID0gMDsNCiAgICB3aGlsZShpPG5ld0xpbmVDaGFyLmxlbmd0aCkNCiAgICB7DQogICAgCXZhciBhQ2hhciA9IG5ld0xpbmVDaGFyLmNoYXJBdChpKTsNCiAgICAJdmFyIGogPSBzLmluZGV4T2YoYUNoYXIpOw0KICAgIAl3aGlsZSAoIGogIT0gLTEpDQogICAgCXsNCiAgIAkJCWxlbmd0aD1sZW5ndGgtMTsNCiAgIAkJCWogPSBzLmluZGV4T2YoYUNoYXIsaisxKTsNCiAgICAJfQ0KICAgIAlpPWkrMTsNCiAgICB9DQogICAgcmV0dXJuIGxlbmd0aDsNCn0NCi8vMDcvMjMvMjAwNSAgYnkgU3RhbmxleSBEaW5nDQovL3RvIGxpbWl0IHRoZSBsZW5ndGggb2YgdGhlIHRleHRhcmVhLg0KZnVuY3Rpb24gdGV4dExlbmd0aExpbWl0T25LZXlwcmVzcygpIA0KeyANCgl2YXIgYWNFdmVudCA9IF9nZXRBQ0V2ZW50KCk7DQoJdmFyIHRhT2JqPWFjRXZlbnQuc3JjRWxlbWVudDsJDQoJdmFyIHJldCA9IHRydWU7DQoJdmFyIGxlbmd0aCA9IHRhT2JqLnZhbHVlLmxlbmd0aDsNCglpZiAgKCBsZW5ndGggPiBnZXRNYXhMZW5ndGgodGFPYmopLTEpIA0KICAgIHsNCiAgICAJcmV0ID0gZmFsc2U7DQogICAgfQ0KCWFjRXZlbnQucmV0dXJuVmFsdWUgPSByZXQ7ICANCn0NCi8vIGdldCB0ZXh0YXJlYSBtYXhMZW5ndGggcHJvcGVydHkgZm9yIElFMTANCmZ1bmN0aW9uIGdldE1heExlbmd0aChvYmopDQp7DQoJaWYgKG9iai5tYXhsZW5ndGgpDQoJew0KCQlyZXR1cm4gb2JqLm1heGxlbmd0aDsNCgl9DQoJDQoJaWYgKG9iai5nZXRBdHRyaWJ1dGUoJ21heGxlbmd0aCcpKQ0KCXsNCgkJcmV0dXJuIG9iai5nZXRBdHRyaWJ1dGUoJ21heGxlbmd0aCcpOw0KCX0NCgkNCglpZiAob2JqLmdldEF0dHJpYnV0ZU5vZGUgJiYgb2JqLmdldEF0dHJpYnV0ZU5vZGUoJ21heGxlbmd0aCcpKQ0KCXsNCgkJcmV0dXJuIG9iai5nZXRBdHRyaWJ1dGVOb2RlKCdtYXhsZW5ndGgnKS52YWx1ZTsNCgl9DQoJcmV0dXJuIG51bGw7DQp9DQovLzA3LzIzLzIwMDUgIGJ5IFN0YW5sZXkgRGluZw0KLy90byBsaW1pdCB0aGUgbGVuZ3RoIG9mIHRoZSB0ZXh0YXJlYS4NCmZ1bmN0aW9uIHRleHRMZW5ndGhMaW1pdE9uUGFzdGUoKSANCnsgDQogICB2YXIgYWNFdmVudCA9IF9nZXRBQ0V2ZW50KCk7DQogICB2YXIgb2JqID0gYWNFdmVudC5zcmNFbGVtZW50OyANCiAgIHZhciBtYXhMZW4gPSBnZXRNYXhMZW5ndGgob2JqKTsgDQogICB2YXIgY3VyTGVuID0gb2JqLnZhbHVlLmxlbmd0aDsgDQogICBpZiAoY3VyTGVuID49IG1heExlbikgDQogICB7IA0KCSAgIGFjRXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTsgDQogICAgICAgcmV0dXJuOyANCiAgIH0gDQogICB2YXIgbmV3VGV4dCA9IHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEoInRleHQiKTsgDQogICBpZiAobmV3VGV4dC5sZW5ndGggKyBjdXJMZW4gPD1tYXhMZW4gKSANCiAgIHsgDQoJICAgYWNFdmVudC5yZXR1cm5WYWx1ZSA9IHRydWU7IA0KICAgICAgIHJldHVybjsgDQogICB9IA0KICAgZXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTsgDQogICBvYmoudmFsdWUgPSBvYmoudmFsdWUgKyBuZXdUZXh0LnN1YnN0cmluZygwLG1heExlbi1jdXJMZW4pOyAgDQp9DQovKioNCiogR2V0IGV2ZW50Ow0KKiANCiogQHJldHVybiBldmVudA0KKi8NCmZ1bmN0aW9uIF9nZXRBQ0V2ZW50KCkgew0KICAgcmV0dXJuIEFjMzYwLmdldEV2ZW50KCk7DQp9DQovKg0KYWRqdXN0IGdpcyBwaWN0dXJlIGZyYW1lIHNpemUNCiovDQpmdW5jdGlvbiByZXNpemVQaWN0dXJlSUZyYW1lKCkgeyANCgl2YXIgbGlzdEZyYW1lOw0KCXRyeXsvL0NhdGNoIGVycm9yIGlmIGJyb3dzZXIgc2VjdXJpdHkgdmlvbGF0aW9uLi4uIGp1c3QgaWdub3JlLg0KCQlsaXN0RnJhbWUgPSB3aW5kb3cucGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjYXBMaXN0Iik7DQoJfWNhdGNoKEVycm9yKXsNCgkJcmV0dXJuOw0KCX0NCgl2YXIgbFBpY3R1cmUgPSBmYWxzZTsNCgl2YXIgY2hhcnQgPSBmYWxzZTsNCglpZihsaXN0RnJhbWUpDQoJew0KCQl2YXIgZCA9IHdpbmRvdy5wYXJlbnQuZnJhbWVzWyJjYXBMaXN0Il07DQoJCXZhciBzaHJlZjsNCgkJdHJ5DQoJCXsNCgkJCXNocmVmID0gZC5sb2NhdGlvbi5ocmVmOw0KCQl9DQoJCWNhdGNoKEVycm9yKQ0KCQl7DQoJCQlyZXR1cm47DQoJCX0JCQ0KCQl2YXIgaW5keCA9IHNocmVmLmluZGV4T2YoJy9wb3J0bGV0cy8nKTsJDQoJCXZhciBzYWN0aW9uID0gJyc7DQoJCWlmKGluZHggPj0wKQ0KCQl7DQoJCQlzYWN0aW9uID0gc2hyZWYuc3Vic3RyaW5nKGluZHgsIGluZHgrMTcpOw0KCQl9DQoJCXZhciBsaXN0Q29udGFpbmVyID0gbGlzdEZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxpc3RDb250YWluZXIiKTsNCgkJdmFyIHBpY0NvbnRhaW5lciA9IHdpbmRvdy5wYXJlbnQuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBpY3R1cmVBcmVhIik7DQoJCWlmKGxpc3RDb250YWluZXIgJiYgcGljQ29udGFpbmVyICYmIHNhY3Rpb24gPT0gJy9wb3J0bGV0cy9jYXAvY2FwJykgDQoJCXsNCgkJCXZhciBvcmlnQ2FwTGlzdExlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJvcmlnQ2FwTGlzdExlbiIpOw0KCQkJLyogVG8gYXZvaWQgZXhlY3V0ZSBjaGFuZ2UgcHJldmlvdXMgdmFsdWUgYXQgdGhlIHNlY29uZCByZXNpemVQaWN0dXJlSUZyYW1lIGV4ZWN1dGlvbiBpbiBwYWdlaW5pdCovDQoJCQlpZihvcmlnQ2FwTGlzdExlbiAmJiBvcmlnQ2FwTGlzdExlbi52YWx1ZSA9PSAiMjUzcHgiICYmIGxpc3RDb250YWluZXIub2Zmc2V0SGVpZ2h0ICAhPSAiMjc5IikNCgkJCXsNCgkJCQlvcmlnQ2FwTGlzdExlbi52YWx1ZSA9IGxpc3RDb250YWluZXIub2Zmc2V0SGVpZ2h0Ow0KCQkJfQ0KDQoJCQlsUGljdHVyZSA9IHRydWU7DQoJCQl2YXIgcGljdHVyZUFyZWEgPSB3aW5kb3cucGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwaWN0dXJlQXJlYSIpOw0KCQkJaWYocGljdHVyZUFyZWEgJiYgcGljdHVyZUFyZWEuc3R5bGUuZGlzcGxheSE9Im5vbmUiDQoJCQkJJiZsaXN0Q29udGFpbmVyLm9mZnNldFdpZHRoID4gcGljQ29udGFpbmVyLnN0eWxlLmxlZnQpDQoJCQl7DQoJCQkJLy9saXN0Q29udGFpbmVyLnN0eWxlLnBpeGVsV2lkdGggPSBsaXN0Q29udGFpbmVyLnN0eWxlLnBpeGVsV2lkdGggLTMwMDsNCg0KCQkJCWlmKGxpc3RDb250YWluZXIub2Zmc2V0SGVpZ2h0IDwgMjc5KQ0KCQkJCXsNCgkJCQkJbGlzdENvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSAyNzk7DQoJCQkJfQ0KCQkJfQ0KCQkJLy9waWNDb250YWluZXIuc3R5bGUucGl4ZWxMZWZ0ID0gbGlzdENvbnRhaW5lci5zdHlsZS5waXhlbFdpZHRoICsgMTsNCgkJCXZhciBwaWNUb3AgPSBsaXN0RnJhbWUub2Zmc2V0SGVpZ2h0IC0gbGlzdENvbnRhaW5lci5vZmZzZXRIZWlnaHQ7DQoJCQlpZihwaWNUb3AgPCAzNikNCgkJCXsNCgkJCQlwaWNUb3AgPSAzNjsNCgkJCX0gDQoJCQlwaWNDb250YWluZXIuc3R5bGUudG9wID0gcGljVG9wOw0KCQl9DQoJfQ0KCXZhciBsaXN0RnJhbWUgPSB3aW5kb3cucGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnNwZWN0aW9uTGlzdCIpOw0KCWlmKGxpc3RGcmFtZSkNCgl7DQoJCXZhciBkPXdpbmRvdy5wYXJlbnQuZnJhbWVzWyJpbnNwZWN0aW9uTGlzdCJdOw0KCQl2YXIgc2hyZWYgPSBkLmxvY2F0aW9uLmhyZWY7DQoJCXZhciBpbmR4ID0gc2hyZWYuaW5kZXhPZignL3BvcnRsZXRzLycpOwkNCgkJdmFyIHNhY3Rpb24gPSAnJzsNCgkJaWYoaW5keCA+PTApDQoJCXsNCgkJCXNhY3Rpb24gPSBzaHJlZi5zdWJzdHJpbmcoaW5keCwgaW5keCszOCk7DQoJCX0NCgkJdmFyIGxpc3RDb250YWluZXIgPSBsaXN0RnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGlzdENvbnRhaW5lciIpOw0KCQl2YXIgcGljQ29udGFpbmVyID0gd2luZG93LnBhcmVudC5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGljdHVyZUFyZWEiKTsNCgkJaWYobGlzdENvbnRhaW5lciAmJiBwaWNDb250YWluZXIgJiYgc2FjdGlvbiA9PSAnL3BvcnRsZXRzL2luc3BlY3Rpb24vaW5zcGVjdGlvbkxpc3QuZG8nKSANCgkJew0KCQkJdmFyIG9yaWdJbnNwTGlzdExlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJvcmlnSW5zcExpc3RMZW4iKTsNCgkJCWlmKG9yaWdJbnNwTGlzdExlbiAmJiBvcmlnSW5zcExpc3RMZW4udmFsdWUgPT0gIjI1M3B4IiAmJiBsaXN0Q29udGFpbmVyLm9mZnNldEhlaWdodCAgIT0gIjI3OSIpDQoJCQl7DQoJCQkJb3JpZ0luc3BMaXN0TGVuLnZhbHVlID0gbGlzdENvbnRhaW5lci5vZmZzZXRIZWlnaHQ7DQoJCQl9DQoNCgkJCWxQaWN0dXJlID0gdHJ1ZTsNCgkJCXZhciBwaWN0dXJlQXJlYSA9IHdpbmRvdy5wYXJlbnQuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBpY3R1cmVBcmVhIik7DQoJCQlpZihwaWN0dXJlQXJlYSAmJiBwaWN0dXJlQXJlYS5zdHlsZS5kaXNwbGF5IT0ibm9uZSINCgkJCQkmJmxpc3RDb250YWluZXIub2Zmc2V0V2lkdGggPiBwaWNDb250YWluZXIuc3R5bGUubGVmdCkNCgkJCXsNCgkJCQkvL2xpc3RDb250YWluZXIuc3R5bGUucGl4ZWxXaWR0aCA9IGxpc3RDb250YWluZXIuc3R5bGUucGl4ZWxXaWR0aCAtMzAwOw0KCQkJCWlmKGxpc3RDb250YWluZXIub2Zmc2V0SGVpZ2h0IDwgMjc5KQ0KCQkJCXsNCgkJCQkJbGlzdENvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSAyNzk7DQoJCQkJfQ0KCQkJfQ0KCQkJLy9waWNDb250YWluZXIuc3R5bGUucGl4ZWxMZWZ0ID0gbGlzdENvbnRhaW5lci5zdHlsZS5waXhlbFdpZHRoICsgMTsNCgkJCS8vcGljQ29udGFpbmVyLnN0eWxlLnBpeGVsVG9wID0gbGlzdEZyYW1lLnN0eWxlLnBpeGVsSGVpZ2h0IC0gbGlzdENvbnRhaW5lci5zdHlsZS5waXhlbEhlaWdodDsNCgkJCXBpY0NvbnRhaW5lci5zdHlsZS50b3AgPSA1NjsNCgkJfQ0KCX0NCgl2YXIgbGlzdEZyYW1lNGRhdGFMaXN0ID0gd2luZG93LnBhcmVudC5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGF0YUxpc3QiKTsNCglpZihsaXN0RnJhbWU0ZGF0YUxpc3QpDQoJew0KCQl2YXIgZD13aW5kb3cucGFyZW50LmZyYW1lc1siZGF0YUxpc3QiXTsNCgkJLy8gaW4gb3BlbmVyIHdpbmRvdywgdGhlIHRhZ05hbWUgaXMgJ2Zvcm0nIA0KCQlpZiggZC50YWdOYW1lID09ICdGT1JNJykNCgkJew0KCQkJZCA9IG9wZW5lci53aW5kb3cucGFyZW50LmZyYW1lc1siZGF0YUxpc3QiXTsNCgkJCWxpc3RGcmFtZTRkYXRhTGlzdCA9IG9wZW5lci53aW5kb3cucGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkYXRhTGlzdCIpOw0KCQl9DQoJCXZhciBzaHJlZiA9IGQubG9jYXRpb24uaHJlZjsNCgkJdmFyIGluZHggPSBzaHJlZi5pbmRleE9mKCcvcG9ydGxldHMvJyk7CQ0KCQl2YXIgc2FjdGlvbiA9ICcnOw0KCQlpZihpbmR4ID49MCkNCgkJew0KCQkJc2FjdGlvbiA9IHNocmVmLnN1YnN0cmluZyhpbmR4LCBpbmR4KzMxKTsNCgkJfQ0KCQl2YXIgbGlzdENvbnRhaW5lciA9IGxpc3RGcmFtZTRkYXRhTGlzdC5jb250ZW50V2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsaXN0Q29udGFpbmVyIik7DQoJCXZhciBwaWNDb250YWluZXIgPSB3aW5kb3cucGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwaWN0dXJlQXJlYSIpOw0KCQlpZihsaXN0Q29udGFpbmVyICYmIHBpY0NvbnRhaW5lciAmJiBzYWN0aW9uID09ICcvcG9ydGxldHMvYW1zL2Fzc2V0L2RhdGFMaXN0LmRvJykgDQoJCXsNCgkJCXZhciBvcmlnRGF0YUxpc3RMZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgib3JpZ0RhdGFMaXN0TGVuIik7DQoJCQlpZihvcmlnRGF0YUxpc3RMZW4gJiYgb3JpZ0RhdGFMaXN0TGVuLnZhbHVlID09ICIyNTNweCIgJiYgbGlzdENvbnRhaW5lci5vZmZzZXRIZWlnaHQgICE9ICIyNzkiKQ0KCQkJew0KCQkJCW9yaWdEYXRhTGlzdExlbi52YWx1ZSA9IGxpc3RDb250YWluZXIub2Zmc2V0SGVpZ2h0Ow0KCQkJfQ0KDQoJCQlsUGljdHVyZSA9IHRydWU7DQoJCQl2YXIgcGljdHVyZUFyZWEgPSB3aW5kb3cucGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwaWN0dXJlQXJlYSIpOw0KCQkJaWYocGljdHVyZUFyZWEgJiYgcGljdHVyZUFyZWEuc3R5bGUuZGlzcGxheSE9Im5vbmUiDQoJCQkJJiZsaXN0Q29udGFpbmVyLm9mZnNldFdpZHRoID4gcGljQ29udGFpbmVyLnN0eWxlLmxlZnQpDQoJCQl7DQoJCQkJLy9saXN0Q29udGFpbmVyLnN0eWxlLnBpeGVsV2lkdGggPSBsaXN0Q29udGFpbmVyLnN0eWxlLnBpeGVsV2lkdGggLTMwMDsNCgkJCQlpZihsaXN0Q29udGFpbmVyLm9mZnNldEhlaWdodCA8IDI3OSkNCgkJCQl7DQoJCQkJCWxpc3RDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gMjc5Ow0KCQkJCX0NCgkJCX0NCgkJCS8vcGljQ29udGFpbmVyLnN0eWxlLnBpeGVsTGVmdCA9IGxpc3RDb250YWluZXIuc3R5bGUucGl4ZWxXaWR0aCArIDE7DQoJCQlwaWNDb250YWluZXIuc3R5bGUudG9wID0gbGlzdEZyYW1lNGRhdGFMaXN0Lm9mZnNldEhlaWdodCAtIGxpc3RDb250YWluZXIub2Zmc2V0SGVpZ2h0Ow0KCQl9DQoJfQ0KDQoJLy9mb3Igc2hvdyBhc3NldCByYXRpbmcgY2hhcnQuDQoNCgl2YXIgIHJhdGluZ1R5cGVVcmwgPSAnL3BvcnRsZXRzL2Ftcy9hc3NldC9hc3NldFJhdGluZ0xpc3Q0VHlwZS5kbyc7CQ0KCXZhciBsaXN0RnJhbWUgPSB3aW5kb3cucGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkYXRhRm9ybSIpOw0KCWlmKGxpc3RGcmFtZSkNCgl7DQoJCQ0KCQl2YXIgZD13aW5kb3cucGFyZW50LmZyYW1lc1siZGF0YUZvcm0iXTsNCgkJLy8gaW4gb3BlbmVyIHdpbmRvdywgdGhlIHRhZ05hbWUgaXMgJ2Zvcm0nIA0KCQlpZiggb3BlbmVyICYmIGQudGFnTmFtZSA9PSAnRk9STScpDQoJCXsNCgkJCS8vY2F0Y2ggdGhlIGV4Y2VwdGlvbiB3aGVuIHJlcG9ydCBkYXRhRm9ybSBmcm9tIG90aGVyIGRvbWFpbi4gDQoJCQl0cnkNCgkJCXsNCgkJCQlkID0gb3BlbmVyLndpbmRvdy5wYXJlbnQuZnJhbWVzWyJkYXRhRm9ybSJdOw0KCQkJCWxpc3RGcmFtZSA9IG9wZW5lci53aW5kb3cucGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkYXRhRm9ybSIpOw0KCQkJfQ0KCQkJY2F0Y2goZSkNCgkJCXsgDQoJCQl9DQoJCX0NCgkJDQoJCWlmIChkICYmIGQudGFnTmFtZSAhPSAnRk9STScpDQoJCXsNCgkJCXZhciBzaHJlZiA9IGQubG9jYXRpb24uaHJlZjsNCgkJCXZhciBpbmR4ID0gc2hyZWYuaW5kZXhPZignL3BvcnRsZXRzLycpOwkNCg0KCQkJdmFyIHNhY3Rpb24gPSAnJzsNCgkJCWlmKGluZHggPj0wKQ0KCQkJew0KCQkJCXNhY3Rpb24gPSBzaHJlZi5zdWJzdHJpbmcoaW5keCwgaW5keCs0Myk7DQoJCQl9DQoJCQl2YXIgbGlzdENvbnRhaW5lciA9IGxpc3RGcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsaXN0Q29udGFpbmVyIik7DQoJCQl2YXIgcGljQ29udGFpbmVyID0gd2luZG93LnBhcmVudC5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhcnRBcmVhIik7DQoJCQlpZihsaXN0Q29udGFpbmVyICYmIHBpY0NvbnRhaW5lciAmJiBzYWN0aW9uID09IHJhdGluZ1R5cGVVcmwpIA0KCQkJew0KCQkJCXZhciBvcmlnQXNzZXRSYXRpbmdMaXN0TGVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm9yaWdBc3NldFJhdGluZ0xpc3RMZW4iKTsNCgkJCQlpZihvcmlnQXNzZXRSYXRpbmdMaXN0TGVuICYmIG9yaWdBc3NldFJhdGluZ0xpc3RMZW4udmFsdWUgPT0gIjI1M3B4IiAmJiBsaXN0Q29udGFpbmVyLm9mZnNldEhlaWdodCAgIT0gIjI3OSIpDQoJCQkJew0KCQkJCQlvcmlnQXNzZXRSYXRpbmdMaXN0TGVuLnZhbHVlID0gbGlzdENvbnRhaW5lci5vZmZzZXRIZWlnaHQ7DQoJCQkJfQ0KDQoJCQkJY2hhcnQgPSB0cnVlOw0KCQkJCXZhciBwaWN0dXJlQXJlYSA9IHdpbmRvdy5wYXJlbnQuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXJ0QXJlYSIpOw0KCQkJCWlmKHBpY3R1cmVBcmVhICYmIHBpY3R1cmVBcmVhLnN0eWxlLmRpc3BsYXkhPSJub25lIg0KCQkJCQkmJmxpc3RDb250YWluZXIub2Zmc2V0V2lkdGggPiBwaWNDb250YWluZXIuc3R5bGUubGVmdCkNCgkJCQl7DQoNCgkJCQkJLy9saXN0Q29udGFpbmVyLnN0eWxlLnBpeGVsV2lkdGggPSBsaXN0Q29udGFpbmVyLnN0eWxlLnBpeGVsV2lkdGggLTMwMDsNCgkJCQkJaWYobGlzdENvbnRhaW5lci5vZmZzZXRIZWlnaHQgPCAyNzkpDQoJCQkJCXsNCgkJCQkJCWxpc3RDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gMjc5Ow0KCQkJCQl9DQoJCQkJfQ0KCQkJCS8vcGljQ29udGFpbmVyLnN0eWxlLnBpeGVsTGVmdCA9IGxpc3RDb250YWluZXIuc3R5bGUucGl4ZWxXaWR0aCArIDE7DQoJCQkJLy9waWNDb250YWluZXIuc3R5bGUucGl4ZWxUb3AgPSBsaXN0RnJhbWUuc3R5bGUucGl4ZWxIZWlnaHQgLSBsaXN0Q29udGFpbmVyLnN0eWxlLnBpeGVsSGVpZ2h0Ow0KCQkJCWlmKGxpc3RGcmFtZTRkYXRhTGlzdCkNCgkJCQl7CQkJCQ0KCQkJCQlwaWNDb250YWluZXIuc3R5bGUudG9wID0gbGlzdEZyYW1lNGRhdGFMaXN0Lm9mZnNldEhlaWdodCArIDkwOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCX0NCgllbHNlIGlmIChkb2N1bWVudC5sb2NhdGlvbi5ocmVmLmluZGV4T2YocmF0aW5nVHlwZVVybCkgPiAtMSkNCgl7DQoJCWNoYXJ0ID0gdHJ1ZTsJCQkNCgl9DQoNCglpZighbFBpY3R1cmUpDQoJew0KCQl2YXIgcGljdHVyZUFyZWEgPSB3aW5kb3cucGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwaWN0dXJlQXJlYSIpOw0KCQlpZihwaWN0dXJlQXJlYSAmJiBwaWN0dXJlQXJlYS5zdHlsZS5kaXNwbGF5IT0ibm9uZSIpDQoJCXsNCgkJCXBpY3R1cmVBcmVhLnN0eWxlLmRpc3BsYXk9Im5vbmUiOw0KCQl9CQkNCgl9DQoNCg0KCWlmKCFjaGFydCkNCgl7DQoJCXZhciBjaGFydEFyZWEgPSB3aW5kb3cucGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGFydEFyZWEiKTsNCgkJaWYoY2hhcnRBcmVhICYmIGNoYXJ0QXJlYS5zdHlsZS5kaXNwbGF5IT0ibm9uZSIpDQoJCXsNCgkJCWNoYXJ0QXJlYS5zdHlsZS5kaXNwbGF5PSJub25lIjsNCgkJfQ0KCX0NCn0NCg0KDQovKg0KKiB2YWxpZGF0ZSB3aGV0aGVyICJ1c2VySW5wdXREYXRlIiBpcyBhIHZhbGlkIGRhdGUgYnkgdGhlIG1hc2sgd2hpY2ggcHJvdmlkZWQgYnkgc3lzdGVtDQoqIHdoeSBuYW1lZCAidmFsaWRhdGVEYXRlQnlTeXN0ZW1NYXNrIjogDQoqIHRoZXJlIGlzIGFub3RoZXIgdmFsaWRhdGUgZGF0ZSBjYXNlIHdoaWNoIHdpbGwgdXNlIHRoZSBtYXNrIHdoaWNoIHByb3ZpZGVkIGJ5IHBhZ2UgaGlkZGVuIHByb3BlcnR5Lg0KKiBtb3JlIGRldGFpbCBwbGVhc2UgcmVmZXIgdG8gY2hlY2tEYXRlKElucHV0LGksY3VycmVudERhdGVTdHIpIG1ldGhvZCBpbiB0aGlzIGZpbGUuDQoqLw0KZnVuY3Rpb24gdmFsaWRhdGVEYXRlQnlTeXN0ZW1NYXNrKHVzZXJJbnB1dERhdGUpDQp7DQoJdmFyIHVzZXJJbnB1dERhdGUgPSAodXNlcklucHV0RGF0ZSkucmVwbGFjZSgvKF5ccyopfChccyokKS9pZywiIik7DQoJDQoJaWYgKHVzZXJJbnB1dERhdGUgIT0gIiIpDQoJew0KCQkvLyBnZXQgc3lzdGVtIG1hc2sNCgkJdmFyIG1hc2sgPSBnZXREYXRlRm9ybWF0KCk7DQoJCQ0KCQkvLyBnZXQgdGhlIG1ldGhvZCB3aGljaCBjYW4gY2hlY2sgd2hldGhlciBhIGRhdGUgaXMgdmFsaWQNCgkJdmFyIGNoZWNrRGF0ZU1ldGhvZCA9ICJJc0RhdGUoJyIrbWFzaysiJykiOw0KCQkNCgkJaWYgKGV2YWwoIlwiIiArIHVzZXJJbnB1dERhdGUgKyAiXCIuIiArIGNoZWNrRGF0ZU1ldGhvZCkpDQoJCXsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoJfQ0KCQ0KCXJldHVybiBmYWxzZTsNCn0NCg0KDQpmdW5jdGlvbiBjaGVja01hc2sobWFzaykNCnsgIA0KCXZhciBmb3JtYXQ9bmV3IEFycmF5KDE3KTsNCglmb3JtYXRbMF09Inl5eXkvTS9kIjsNCglmb3JtYXRbMV09Inl5eXkvTS9kIGg6bSBhIjsNCglmb3JtYXRbMl09Inl5eXkvTS9kIEg6bSBhIjsNCglmb3JtYXRbM109Inl5L00vZCI7DQoJZm9ybWF0WzRdPSJNL2QiOw0KCWZvcm1hdFs1XT0iTS9kL3l5IjsNCglmb3JtYXRbNl09Ik1NL2RkL3l5IjsNCglmb3JtYXRbN109ImQtTU1NIjsNCglmb3JtYXRbOF09ImQtTU1NLXl5IjsNCglmb3JtYXRbOV09ImRkLU1NTS15eSI7DQoJZm9ybWF0WzEwXT0iTU1NLXl5IjsNCglmb3JtYXRbMTFdPSJNTU1NTS15eSI7DQoJZm9ybWF0WzEyXT0iTU0vZGQveXl5eSI7DQoJZm9ybWF0WzEzXT0iaDptIGEiOw0KCWZvcm1hdFsxNF09Ikg6bTpzIjsNCglmb3JtYXRbMTVdPSJoOm06cyBhIjsNCglmb3JtYXRbMTZdPSJkZC9NTS95eXl5IjsNCgl2YXIgbSA9IDA7DQoJZm9yICh2YXIgaT0wOyBpPDE3O2krKykNCgl7DQoJCWlmKG1hc2s9PWZvcm1hdFtpXSkNCgkJeyANCgkJCW0gPSBpOw0KCQkJYnJlYWs7DQoJCX0JICANCgl9DQoJdmFyIGNoZWNrRGF0ZU1ldGhvZCA9ICJJc0RhdGUiK20rIigpIjsNCglyZXR1cm4gY2hlY2tEYXRlTWV0aG9kOw0KfQ0KDQovL21pbmludW0gZGF0ZTogMDEvMDEvMTc1Mw0KdmFyIG1pbmltdW1EYXRlID0gbmV3IERhdGUoJzAxLzAxLzE3NTMgMDA6MDA6MDAnKTsNCi8vbWF4aW51bSBkYXRlOiAxMi8zMS85OTk5DQp2YXIgbWF4aW11bURhdGUgPSBuZXcgRGF0ZSgnMTIvMzEvOTk5OSAyMzo1OTo1OScpOw0KDQovKioNCiAqIEp1ZGdlIHdldGhlciB0aGUgZGF0ZSBpcyBvdmVyIHRoZSBkYXRlIGxpbWl0KDAxLzAxLzE3NTMgYW5kIDEyLzMxLzk5OTkpOyANCiAqIA0KICogQHBhcmFtIGQgZGF0ZSBvYmplY3QNCiAqIEByZXR1cm4gdm9pZA0KICovDQpmdW5jdGlvbiBpc091dE9mRGF0ZWxpbWl0KGQpDQp7DQoJdmFyIHJlc3VsdCA9IGZhbHNlOw0KCWlmKG1pbmltdW1EYXRlID4gZCB8fCBtYXhpbXVtRGF0ZSA8IGQpDQoJew0KCQlyZXN1bHQgPSB0cnVlOw0KCX0NCgkNCglyZXR1cm4gcmVzdWx0Ow0KfQ0KDQovLyBtZXRob2QgZm9yICB5eXl5L00vZCAgZm9ybWF0IA0KU3RyaW5nLnByb3RvdHlwZS5Jc0RhdGUwPWZ1bmN0aW9uKCkNCnsNCgl2YXIgc3RyPXRoaXM7DQoJdmFyIHJlZyA9L14oXGR7NH0pXC8oXGR7MSwyfSlcLyhcZHsxLDJ9KSQvOyAgICANCgl2YXIgcj1zdHIubWF0Y2gocmVnKTsgICAgDQoJaWYocj09bnVsbClyZXR1cm4gZmFsc2U7ICAgIA0KCXJbMl09clsyXS0xOyANCgl2YXIgZD1uZXcgRGF0ZShyWzFdLHJbMl0sclszXSk7ICANCglpZihkLmdldEZ1bGxZZWFyKCkhPXJbMV0pcmV0dXJuIGZhbHNlOyAgICANCglpZihkLmdldE1vbnRoKCkhPXJbMl0pcmV0dXJuIGZhbHNlOyAgICANCglpZihkLmdldERhdGUoKSE9clszXSlyZXR1cm4gZmFsc2U7ICAgIA0KCXJldHVybiAhaXNPdXRPZkRhdGVsaW1pdChkKTsgIA0KfQ0KDQovLyBtZXRob2QgZm9yICB5eXl5L00vZCBoOm0gYSAgZm9ybWF0IA0KU3RyaW5nLnByb3RvdHlwZS5Jc0RhdGUxPWZ1bmN0aW9uKCkNCnsNCgl2YXIgc3RyPXRoaXM7DQoJdmFyIHJlZyA9L14oXGR7NH0pXC8oXGR7MSwyfSlcLyhcZHsxLDJ9KVxzKFxkezEsMn0pOihcZHsxLDJ9KVxzKEFNfFBNKSQvOyAgICAgIA0KCXZhciByPXN0ci5tYXRjaChyZWcpOyAgICANCglpZihyPT1udWxsKXJldHVybiBmYWxzZTsgICAgDQoJclsyXT1yWzJdLTE7IA0KCXZhciBkPW5ldyBEYXRlKHJbMV0sclsyXSxyWzNdLHJbNF0scls1XSk7ICANCglpZihkLmdldEZ1bGxZZWFyKCkhPXJbMV0pcmV0dXJuIGZhbHNlOyAgICANCglpZihkLmdldE1vbnRoKCkhPXJbMl0pcmV0dXJuIGZhbHNlOyAgICANCglpZihkLmdldERhdGUoKSE9clszXSlyZXR1cm4gZmFsc2U7DQoJaWYocls0XT4xMikgcmV0dXJuIGZhbHNlOw0KCWlmKGQuZ2V0SG91cnMoKSE9cls0XSlyZXR1cm4gZmFsc2U7DQoJaWYoZC5nZXRNaW51dGVzKCkhPXJbNV0pcmV0dXJuIGZhbHNlOwkNCglyZXR1cm4gIWlzT3V0T2ZEYXRlbGltaXQoZCk7DQp9DQoNCi8vIG1ldGhvZCBmb3IgIHl5eXkvTS9kIEg6bSBhICBmb3JtYXQgDQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZTI9ZnVuY3Rpb24oKQ0Kew0KCXZhciBzdHI9dGhpczsNCgl2YXIgcmVnID0vXihcZHs0fSlcLyhcZHsxLDJ9KVwvKFxkezEsMn0pXHMoXGR7MSwyfSk6KFxkezEsMn0pJC87ICAgICAgDQoJdmFyIHI9c3RyLm1hdGNoKHJlZyk7ICAgIA0KCWlmKHI9PW51bGwpcmV0dXJuIGZhbHNlOyAgICANCglyWzJdPXJbMl0tMTsgDQoJdmFyIGQ9bmV3IERhdGUoclsxXSxyWzJdLHJbM10scls0XSxyWzVdKTsgIA0KCWlmKGQuZ2V0RnVsbFllYXIoKSE9clsxXSlyZXR1cm4gZmFsc2U7ICAgIA0KCWlmKGQuZ2V0TW9udGgoKSE9clsyXSlyZXR1cm4gZmFsc2U7ICAgIA0KCWlmKGQuZ2V0RGF0ZSgpIT1yWzNdKXJldHVybiBmYWxzZTsJDQoJaWYoZC5nZXRIb3VycygpIT1yWzRdKXJldHVybiBmYWxzZTsNCglpZihkLmdldE1pbnV0ZXMoKSE9cls1XSlyZXR1cm4gZmFsc2U7ICAgIA0KCXJldHVybiAhaXNPdXRPZkRhdGVsaW1pdChkKTsNCn0NCg0KLy8gbWV0aG9kIGZvciAgeXkvTS9kICAgZm9ybWF0IA0KU3RyaW5nLnByb3RvdHlwZS5Jc0RhdGUzPWZ1bmN0aW9uKCkNCnsNCgl2YXIgc3RyPXRoaXM7DQoJdmFyIHJlZyA9L14oXGR7Mn0pXC8oXGR7MSwyfSlcLyhcZHsxLDJ9KSQvOyAgICAgIA0KCXZhciByPXN0ci5tYXRjaChyZWcpOyAgICANCglpZihyPT1udWxsKXJldHVybiBmYWxzZTsgICAgDQoJclsyXT1yWzJdLTE7IA0KCXZhciBkPW5ldyBEYXRlKHJbMV0sclsyXSxyWzNdKTsgIA0KCWlmKGQuZ2V0WWVhcigpIT1yWzFdKXJldHVybiBmYWxzZTsgICAgDQoJaWYoZC5nZXRNb250aCgpIT1yWzJdKXJldHVybiBmYWxzZTsgICAgDQoJaWYoZC5nZXREYXRlKCkhPXJbM10pcmV0dXJuIGZhbHNlOwkgIA0KCXJldHVybiAhaXNPdXRPZkRhdGVsaW1pdChkKTsgIA0KfQ0KDQovLyBtZXRob2QgZm9yICBNL2QgZm9ybWF0DQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZTQ9ZnVuY3Rpb24oKQ0Kew0KCXZhciBzdHI9dGhpczsNCgl2YXIgcmVnID0vXihcZHsxLDJ9KVwvKFxkezEsMn0pJC87ICAgICAgDQoJdmFyIHI9c3RyLm1hdGNoKHJlZyk7ICAgIA0KCWlmKHI9PW51bGwpcmV0dXJuIGZhbHNlOyAgICANCglyWzFdPXJbMV0tMTsgCQ0KCXZhciBkPW5ldyBEYXRlKDAsclsxXSxyWzJdKTsgIA0KCWlmKGQuZ2V0TW9udGgoKSE9clsxXSlyZXR1cm4gZmFsc2U7ICAgIA0KCWlmKGQuZ2V0RGF0ZSgpIT1yWzJdKXJldHVybiBmYWxzZTsJICANCglyZXR1cm4gIWlzT3V0T2ZEYXRlbGltaXQoZCk7IA0KfQ0KDQovLyBtZXRob2QgZm9yICBNL2QveXkgZm9ybWF0DQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZTU9ZnVuY3Rpb24oKQ0Kew0KCXZhciBzdHI9dGhpczsNCgl2YXIgcmVnID0vXihcZHsxLDJ9KVwvKFxkezEsMn0pXC8oXGR7Mn0pJC87ICAgICAgDQoJdmFyIHI9c3RyLm1hdGNoKHJlZyk7ICAgIA0KCWlmKHI9PW51bGwpcmV0dXJuIGZhbHNlOyAgICANCglyWzFdPXJbMV0tMTsgDQoJdmFyIGQ9bmV3IERhdGUoclszXSxyWzFdLHJbMl0pOyAgDQoJaWYoZC5nZXRZZWFyKCkhPXJbM10pcmV0dXJuIGZhbHNlOyAgICANCglpZihkLmdldE1vbnRoKCkhPXJbMV0pcmV0dXJuIGZhbHNlOyAgICANCglpZihkLmdldERhdGUoKSE9clsyXSlyZXR1cm4gZmFsc2U7CSAgDQoJcmV0dXJuICFpc091dE9mRGF0ZWxpbWl0KGQpOw0KfQ0KDQovLyBtZXRob2QgZm9yICBNTS9kZC95eSBmb3JtYXQNClN0cmluZy5wcm90b3R5cGUuSXNEYXRlNj1mdW5jdGlvbigpDQp7DQoJdmFyIHN0cj10aGlzOw0KCXZhciByZWcgPS9eKFxkezEsMn0pXC8oXGR7MSwyfSlcLyhcZHsyfSkkLzsgICAgICANCgl2YXIgcj1zdHIubWF0Y2gocmVnKTsgICAgDQoJaWYocj09bnVsbClyZXR1cm4gZmFsc2U7ICAgIA0KCXJbMV09clsxXS0xOyANCgl2YXIgZD1uZXcgRGF0ZShyWzNdLHJbMV0sclsyXSk7ICANCglpZihkLmdldFllYXIoKSE9clszXSlyZXR1cm4gZmFsc2U7ICAgIA0KCWlmKGQuZ2V0TW9udGgoKSE9clsxXSlyZXR1cm4gZmFsc2U7ICAgIA0KCWlmKGQuZ2V0RGF0ZSgpIT1yWzJdKXJldHVybiBmYWxzZTsJICANCglyZXR1cm4gIWlzT3V0T2ZEYXRlbGltaXQoZCk7ICANCn0NCg0KLy8gbWV0aG9kIGZvciAgZC1NTU0gZm9ybWF0DQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZTc9ZnVuY3Rpb24oKQ0Kew0KCXZhciBzdHI9dGhpczsNCgl2YXIgcmVnID0vXihcZHsxLDJ9KS0oSmFufEZlYnxNYXJ8QXByfE1heXxKdW58SnVsfEF1Z3xTZXB8T2N0fE5vdnxEZWMpJC87ICAgICAgDQoJdmFyIHI9c3RyLm1hdGNoKHJlZyk7ICAgIA0KCWlmKHI9PW51bGwpcmV0dXJuIGZhbHNlOyAgICANCgl2YXIgZD1uZXcgRGF0ZSgwLDAsclsxXSk7ICAgIA0KCWlmKGQuZ2V0RGF0ZSgpIT1yWzFdKXJldHVybiBmYWxzZTsJICANCglyZXR1cm4gIWlzT3V0T2ZEYXRlbGltaXQoZCk7ICANCn0NCg0KLy8gbWV0aG9kIGZvciAgZC1NTU0teXkgZm9ybWF0DQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZTg9ZnVuY3Rpb24oKQ0Kew0KCXZhciBzdHI9dGhpczsNCgl2YXIgcmVnID0vXihcZHsxLDJ9KS0oSmFufEZlYnxNYXJ8QXByfE1heXxKdW58SnVsfEF1Z3xTZXB8T2N0fE5vdnxEZWMpLShcZHsyfSkkLzsgICAgICANCgl2YXIgcj1zdHIubWF0Y2gocmVnKTsgICAgDQoJaWYocj09bnVsbClyZXR1cm4gZmFsc2U7IAkgICANCgl2YXIgZD1uZXcgRGF0ZShyWzNdLDAsclsxXSk7ICAgIA0KCWlmKGQuZ2V0WWVhcigpIT1yWzNdKXJldHVybiBmYWxzZTsgDQoJaWYoZC5nZXREYXRlKCkhPXJbMV0pcmV0dXJuIGZhbHNlOw0KCXJldHVybiAhaXNPdXRPZkRhdGVsaW1pdChkKTsgIA0KfQ0KDQovLyBtZXRob2QgZm9yICBkZC1NTU0teXkgZm9ybWF0DQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZTk9ZnVuY3Rpb24oKQ0Kew0KCXZhciBzdHI9dGhpczsNCgl2YXIgcmVnID0vXihcZHsxLDJ9KS0oSmFufEZlYnxNYXJ8QXByfE1heXxKdW58SnVsfEF1Z3xTZXB8T2N0fE5vdnxEZWMpLShcZHsyfSkkLzsgICAgICANCgl2YXIgcj1zdHIubWF0Y2gocmVnKTsgICAgDQoJaWYocj09bnVsbClyZXR1cm4gZmFsc2U7ICANCgl2YXIgZD1uZXcgRGF0ZShyWzNdLDAsclsxXSk7ICAgIA0KCWlmKGQuZ2V0WWVhcigpIT1yWzNdKXJldHVybiBmYWxzZTsgICAgDQoJaWYoZC5nZXREYXRlKCkhPXJbMV0pcmV0dXJuIGZhbHNlOwkgIA0KCXJldHVybiAhaXNPdXRPZkRhdGVsaW1pdChkKTsgIA0KfQ0KDQovLyBtZXRob2QgZm9yICBNTU0teXkgZm9ybWF0DQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZTEwPWZ1bmN0aW9uKCkNCnsNCgl2YXIgc3RyPXRoaXM7DQoJdmFyIHJlZyA9L14oSmFufEZlYnxNYXJ8QXByfE1heXxKdW58SnVsfEF1Z3xTZXB8T2N0fE5vdnxEZWMpLShcZHsyfSkkLzsgICAgICANCgl2YXIgcj1zdHIubWF0Y2gocmVnKTsgICAgDQoJaWYocj09bnVsbClyZXR1cm4gZmFsc2U7IA0KCXZhciBkPW5ldyBEYXRlKHJbMl0sMSwxKTsgICAgDQoJaWYoZC5nZXRZZWFyKCkhPXJbMl0pcmV0dXJuIGZhbHNlOyAgICAJICANCglyZXR1cm4gIWlzT3V0T2ZEYXRlbGltaXQoZCk7ICANCn0NCg0KLy8gbWV0aG9kIGZvciAgTU1NTU0teXkgZm9ybWF0DQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZTExPWZ1bmN0aW9uKCkNCnsNCgl2YXIgc3RyPXRoaXM7DQoJdmFyIHJlZyA9L14oSmFudWFyeXxGZWJydWFyeXxNYXJjaHxBcHJpbHxNYXl8SnVuZXxKdWx5fEF1Z3VzdGV8U2VwdGVtYmVyfE9jdG9iZXJ8Tm92ZW1iZXJ8RGVjZW1iZXIpLShcZHsyfSkkLzsgICAgICANCgl2YXIgcj1zdHIubWF0Y2gocmVnKTsgICAgDQoJaWYocj09bnVsbClyZXR1cm4gZmFsc2U7IA0KCXZhciBkPW5ldyBEYXRlKHJbMl0sMSwxKTsgICAgDQoJaWYoZC5nZXRZZWFyKCkhPXJbMl0pcmV0dXJuIGZhbHNlOyAgICAJICANCglyZXR1cm4gIWlzT3V0T2ZEYXRlbGltaXQoZCk7ICANCn0NCg0KLy8gbWV0aG9kIGZvciAgTU0vZGQveXl5eSBmb3JtYXQNClN0cmluZy5wcm90b3R5cGUuSXNEYXRlMTI9ZnVuY3Rpb24oKQ0Kew0KCXZhciBzdHI9dGhpczsNCgl2YXIgcmVnID0vXihcZHsxLDJ9KVwvKFxkezEsMn0pXC8oXGR7NH0pJC87ICAgIA0KCXZhciByPXN0ci5tYXRjaChyZWcpOyAgICANCglpZihyPT1udWxsKXJldHVybiBmYWxzZTsgICAgDQoJclsxXT1yWzFdLTE7DQoJdmFyIGQ9bmV3IERhdGUoclszXSxyWzFdLHJbMl0pOyAgDQoJaWYoZC5nZXRGdWxsWWVhcigpIT1yWzNdKXJldHVybiBmYWxzZTsNCglpZihkLmdldE1vbnRoKCkhPXJbMV0pcmV0dXJuIGZhbHNlOyAgICANCglpZihkLmdldERhdGUoKSE9clsyXSlyZXR1cm4gZmFsc2U7DQoJcmV0dXJuICFpc091dE9mRGF0ZWxpbWl0KGQpOyAgDQp9DQovKioNCiAqIEEgdG9vbHMgbWV0aG9kIHRvIHBhcnNlIGEgc3RyaW5nIGFuZCBnZW5lcmF0ZSBhIGRhdGUgb2JqZWN0DQogKiBiYXNlZCBvbiB0aGUgc3BlY2lmaWMgbWFzaw0KICogRm9yIGV4YW1wbGU6DQogKiAgICAgcGFyc2Ugc3RyaW5nICIyMDA5LTEwLTE2IiBuZWVkIHNldCB0aGUgbWFzayB0byAieXl5eS1tbS1kZCINCiAqLw0KU3RyaW5nLnByb3RvdHlwZS5Ub0RhdGU9ZnVuY3Rpb24obWFzaykNCnsNCgl2YXIgeWVhcixtb250aCxkYXk7DQoJdmFyIG1za0RhdGVBcnI7DQoJdmFyIG1za0FycjsNCgl2YXIgc3BjaGFyOw0KCQ0KCXZhciBzbGlwQ2hhcj1uZXcgQXJyYXkoJy0nLCcvJywnXFwnKTsNCglmb3IodmFyIGk9MDtpPHNsaXBDaGFyLmxlbmd0aDtpKyspew0KCQlpZihtYXNrLmluZGV4T2Yoc2xpcENoYXJbaV0pPjApew0KCQkJc3BjaGFyID0gc2xpcENoYXJbaV07DQoJCQltc2tBcnIgPSBtYXNrLnNwbGl0KHNsaXBDaGFyW2ldKTsNCgkJCW1za0RhdGVBcnIgPSB0aGlzLnNwbGl0KHNsaXBDaGFyW2ldKTsNCgkJCWJyZWFrOw0KCQl9DQoJfQ0KDQoJZm9yIChpPTA7aTxtc2tBcnIubGVuZ3RoO2krKykNCgl7DQoJCWlmIChtc2tBcnJbaV0udG9Mb3dlckNhc2UoKS5pbmRleE9mKCJ5Iik+PTApDQoJCXsNCgkJCXllYXIgPSBtc2tEYXRlQXJyW2ldOw0KCQl9DQoJCWVsc2UgaWYobXNrQXJyW2ldLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigibSIpPj0wKQ0KCQl7DQoJCQltb250aCA9IG1za0RhdGVBcnJbaV07DQoJCX0NCgkJZWxzZSBpZihtc2tBcnJbaV0udG9Mb3dlckNhc2UoKS5pbmRleE9mKCJkIik+PTApDQoJCXsNCgkJCWRheSA9IG1za0RhdGVBcnJbaV07DQoJCX0NCgl9DQoJDQoJbW9udGggPSBtb250aCAtIDE7DQoJdmFyIG1hc2tEYXRlPW5ldyBEYXRlKHllYXIsbW9udGgsZGF5KTsNCgkNCglyZXR1cm4gbWFza0RhdGU7DQp9DQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZT1mdW5jdGlvbihtYXNrKQ0Kew0KCQ0KCQ0KCXZhciB5ZWFyLG1vbnRoLGRheTsNCgl2YXIgbXNrRGF0ZUFycjsNCgl2YXIgbXNrQXJyOw0KCXZhciBzcGNoYXI7DQoJdHJ5ew0KCQkNCgkJdmFyIHNsaXBDaGFyPW5ldyBBcnJheSgnLScsJy8nLCdcXCcpOw0KCQlmb3IodmFyIGk9MDtpPHNsaXBDaGFyLmxlbmd0aDtpKyspew0KCQkJaWYobWFzay5pbmRleE9mKHNsaXBDaGFyW2ldKT4wKXsNCgkJCQlzcGNoYXIgPSBzbGlwQ2hhcltpXTsNCgkJCQltc2tBcnIgPSBtYXNrLnNwbGl0KHNwY2hhcik7DQoJCQkJbXNrRGF0ZUFyciA9IHRoaXMuc3BsaXQoc3BjaGFyKTsNCgkJCQkNCgkJCQlicmVhazsNCgkJCX0NCgkJfQ0KCQ0KCQlmb3IgKGk9MDtpPG1za0Fyci5sZW5ndGg7aSsrKQ0KCQl7DQoJCQlpZiAobXNrQXJyW2ldLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigieSIpPj0wKQ0KCQkJew0KCQkJCXllYXIgPSBtc2tEYXRlQXJyW2ldOw0KCQkJfQ0KCQkJZWxzZSBpZihtc2tBcnJbaV0udG9Mb3dlckNhc2UoKS5pbmRleE9mKCJtIik+PTApDQoJCQl7DQoJCQkJbW9udGggPSBtc2tEYXRlQXJyW2ldOw0KCQkJfQ0KCQkJZWxzZSBpZihtc2tBcnJbaV0udG9Mb3dlckNhc2UoKS5pbmRleE9mKCJkIik+PTApDQoJCQl7DQoJCQkJZGF5ID0gbXNrRGF0ZUFycltpXTsNCgkJCX0NCgkJfQ0KCQkNCgkNCgkJDQoJCW1vbnRoID0gbW9udGggLSAxOw0KCQkNCgkJdmFyIG1hc2tEYXRlPW5ldyBEYXRlKHllYXIsbW9udGgsZGF5KTsNCgkJdmFyIGRmPW5ldyBEYXRlRm9ybWF0KCk7DQoJCXZhciBzdHJEYXRlID0gZGYuZm9ybWF0KG1hc2tEYXRlLCBtYXNrKTsNCgkJdmFyIHJlc3VsdCA9IGZhbHNlOw0KCQlpZihzdHJEYXRlPT10aGlzKQ0KCQl7DQoJCQlyZXN1bHQgPSB0cnVlOw0KCQl9DQoJCWVsc2UNCgkJew0KCQkJLy8gcmVtb3ZlIDAgYW5kIGNoZWNrIGFnYWluLCANCgkJCS8vIGUuZy4sIGlmIHRoZSBtYXNrIGlzICdkZC9tbS95eXl5JywgYW5kIHVzZXIgaW5wdXQgdmFsdWUgaXMgJzEvMS8yMDA5JywgaXQgc2hvdWxkIHJldHVybiB0cnVlDQoJCQlpZiAoc3RyRGF0ZS5pbmRleE9mKCcwJykgPT0gMCkNCgkJCXsNCgkJCQlzdHJEYXRlID0gc3RyRGF0ZS5zdWJzdHJpbmcoMSk7DQoJCQl9DQoJCQlzdHJEYXRlID0gc3RyRGF0ZS5yZXBsYWNlKHNwY2hhciArICcwJywgc3BjaGFyKTsgLy8gcmVwbGFjZSB0d2ljZSBmb3IgYm90aCBtb250aCBhbmQgZGF0ZQ0KCQkJc3RyRGF0ZSA9IHN0ckRhdGUucmVwbGFjZShzcGNoYXIgKyAnMCcsIHNwY2hhcik7DQoJCQlpZiAoc3RyRGF0ZSA9PSB0aGlzKQ0KCQkJew0KCQkJCXJlc3VsdCA9IHRydWU7DQoJCQl9DQoJCX0NCgkJDQoJCXJldHVybiByZXN1bHQgJiYgIWlzT3V0T2ZEYXRlbGltaXQobWFza0RhdGUpOw0KCX0NCgljYXRjaChlKQ0KCXsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCn0NCi8vIG1ldGhvZCBmb3IgaDptIGEgZm9ybWF0DQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZTEzPWZ1bmN0aW9uKCkNCnsNCgl2YXIgc3RyPXRoaXM7DQoJdmFyIHJlZyA9L14oXGR7MSwyfSk6KFxkezEsMn0pXHMoQU18UE0pJC87ICAgIA0KCXZhciByPXN0ci5tYXRjaChyZWcpOyAgICANCglpZihyPT1udWxsKXJldHVybiBmYWxzZTsgICAgICAgIA0KCXZhciBkPW5ldyBEYXRlKDAwMDEsMDEsMDEsclsxXSxyWzJdKTsgIA0KCWlmKHJbMV0+MTIpIHJldHVybiBmYWxzZTsNCglpZihkLmdldEhvdXJzKCkhPXJbMV0pcmV0dXJuIGZhbHNlOw0KCWlmKGQuZ2V0TWludXRlcygpIT1yWzJdKXJldHVybiBmYWxzZTsgICAgDQoJcmV0dXJuICFpc091dE9mRGF0ZWxpbWl0KGQpOyAgDQp9DQovLyBtZXRob2QgZm9yIEg6bTpzIGZvcm1hdA0KU3RyaW5nLnByb3RvdHlwZS5Jc0RhdGUxND1mdW5jdGlvbigpDQp7DQoJdmFyIHN0cj10aGlzOw0KCXZhciByZWcgPS9eKFxkezEsMn0pOihcZHsxLDJ9KTooXGR7MSwyfSkkLzsgICAgICANCgl2YXIgcj1zdHIubWF0Y2gocmVnKTsgICAgDQoJaWYocj09bnVsbClyZXR1cm4gZmFsc2U7ICAgDQoJdmFyIGQ9bmV3IERhdGUoMDAwMSwwMSwwMSxyWzFdLHJbMl0sclszXSk7ICAgICAJDQoJaWYoZC5nZXRIb3VycygpIT1yWzFdKXJldHVybiBmYWxzZTsNCglpZihkLmdldE1pbnV0ZXMoKSE9clsyXSlyZXR1cm4gZmFsc2U7ICANCglpZihkLmdldFNlY29uZHMoKSE9clszXSlyZXR1cm4gZmFsc2U7ICAgIA0KCXJldHVybiAhaXNPdXRPZkRhdGVsaW1pdChkKTsNCn0NCi8vIG1ldGhvZCBmb3IgaDptOnMgYSBmb3JtYXQNClN0cmluZy5wcm90b3R5cGUuSXNEYXRlMTU9ZnVuY3Rpb24oKQ0Kew0KCXZhciBzdHI9dGhpczsNCgl2YXIgcmVnID0vXihcZHsxLDJ9KTooXGR7MSwyfSk6KFxkezEsMn0pXHMoQU18UE0pJC87ICAgICAgDQoJdmFyIHI9c3RyLm1hdGNoKHJlZyk7ICAgIA0KCWlmKHI9PW51bGwpcmV0dXJuIGZhbHNlOyAgICANCgl2YXIgZD1uZXcgRGF0ZSgwMDAxLDAxLDAxLHJbMV0sclsyXSxyWzNdKTsgICAgICAgDQoJaWYoclsxXT4xMikgcmV0dXJuIGZhbHNlOyAgCQ0KCWlmKGQuZ2V0SG91cnMoKSE9clsxXSlyZXR1cm4gZmFsc2U7DQoJaWYoZC5nZXRNaW51dGVzKCkhPXJbMl0pcmV0dXJuIGZhbHNlOyAgDQoJaWYoZC5nZXRTZWNvbmRzKCkhPXJbM10pcmV0dXJuIGZhbHNlOyAgICANCglyZXR1cm4gIWlzT3V0T2ZEYXRlbGltaXQoZCk7DQp9DQoNCi8vIG1ldGhvZCBmb3IgIGRkL01NL3l5eXkgZm9ybWF0DQpTdHJpbmcucHJvdG90eXBlLklzRGF0ZTE2PWZ1bmN0aW9uKCkNCnsNCgl2YXIgc3RyPXRoaXM7DQoJdmFyIHJlZyA9L14oXGR7MSwyfSlcLyhcZHsxLDJ9KVwvKFxkezR9KSQvOyAgICANCgl2YXIgcj1zdHIubWF0Y2gocmVnKTsgICAgDQoJaWYocj09bnVsbClyZXR1cm4gZmFsc2U7ICAgIA0KCXJbMV09clsxXS0xOyANCgl2YXIgZD1uZXcgRGF0ZShyWzNdLHJbMl0sclsxXSk7ICANCglpZihkLmdldEZ1bGxZZWFyKCkhPXJbM10pcmV0dXJuIGZhbHNlOyAgICANCglpZihkLmdldE1vbnRoKCkhPXJbMl0pcmV0dXJuIGZhbHNlOyAgICANCglpZihkLmdldERhdGUoKSE9clsxXSlyZXR1cm4gZmFsc2U7ICAgIA0KCXJldHVybiB0cnVlOyAgDQp9DQoNCmZ1bmN0aW9uIERhdGVGb3JtYXQoKQ0Kew0KCXZhciBzaG9ydE1vbnRoPW5ldyBBcnJheSgiSmFuIiwiRmViIiwiTWFyIiwiQXByIiwiTWF5IiwiSnVuIiwiSnVsIiwiQXVnIiwiU2VwIiwiT2N0IiwiTm92IiwiRGVjIik7DQoJdmFyIGxvbmdNb250aD1uZXcgQXJyYXkoIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIik7DQoNCgl0aGlzLmZvcm1hdD1mdW5jdGlvbiAoZGF0ZU9iaiwgcGF0dGVybikNCgl7DQoJCXZhciB5ZWFyPWRhdGVPYmouZ2V0RnVsbFllYXIoKSxtb250aD1kYXRlT2JqLmdldE1vbnRoKCkrMSxkYXRlPWRhdGVPYmouZ2V0RGF0ZSgpOwkJDQoJCXZhciBob3Vycz1kYXRlT2JqLmdldEhvdXJzKCksbWludXRlcz1kYXRlT2JqLmdldE1pbnV0ZXMoKSxzZWNvbmRzPWRhdGVPYmouZ2V0U2Vjb25kcygpOw0KCQl2YXIgYXA7DQoJCXZhciByZXM9cGF0dGVybjsJDQoJCWlmKHJlcy5pbmRleE9mKCJIIik+PTAgJiYgcmVzLmluZGV4T2YoIiBhIik+PTAgKQ0KCQl7DQoJCQlyZXMgPSByZXMucmVwbGFjZSgiIGEiLCIiKTsJICAJDQoJCX0gDQoJCWlmKHBhdHRlcm4uaW5kZXhPZigieSIpPj0wKQkNCgkJICAgcmVzPXNldEZpZWxkVmFsdWUocmVzLCAieSIsIHllYXIpOw0KCQlpZihwYXR0ZXJuLmluZGV4T2YoIk0iKT49MCkNCgkJICAgcmVzPXNldEZpZWxkVmFsdWUocmVzLCAiTSIsIG1vbnRoKTsNCgkJaWYocGF0dGVybi5pbmRleE9mKCJkIik+PTApDQoJCSAgIHJlcz1zZXRGaWVsZFZhbHVlKHJlcywgImQiLCBkYXRlKTsNCgkJaWYocGF0dGVybi5pbmRleE9mKCJIIik+PTApDQoJCSAgIHJlcz1zZXRGaWVsZFZhbHVlKHJlcywgIkgiLCBob3Vycyk7DQoJCWlmKHBhdHRlcm4uaW5kZXhPZigiaCIpPj0wKQ0KCQkgICByZXM9c2V0RmllbGRWYWx1ZShyZXMsICJoIiwgaG91cnMpOw0KCQlpZihwYXR0ZXJuLmluZGV4T2YoIm0iKT49MCkNCgkJICAgcmVzPXNldEZpZWxkVmFsdWUocmVzLCAibSIsIG1pbnV0ZXMpOw0KCQlpZihwYXR0ZXJuLmluZGV4T2YoInMiKT49MCkNCgkJICAgcmVzPXNldEZpZWxkVmFsdWUocmVzLCAicyIsIHNlY29uZHMpOw0KCQlpZihwYXR0ZXJuLmluZGV4T2YoImEiKT49MCkNCgkJICAgcmVzPXNldEZpZWxkVmFsdWUocmVzLCAiYSIsIGFwKTsJDQoJCQkJDQoJCXJldHVybiByZXM7DQoJfQ0KCSAgDQoJZnVuY3Rpb24gc2V0RmllbGRWYWx1ZShwYXR0ZXJuLCB0YXJnLCB2YWx1ZSkNCgl7DQoJCXZhciBpMT1wYXR0ZXJuLmluZGV4T2YodGFyZyk7CQkNCgkJaWYoaTE8MCkNCgkJew0KCQkJcmV0dXJuIHBhdHRlcm47CQkJDQoJCX0NCgkJdmFyIGkyPWkxKzE7DQoJCXdoaWxlKGkyPjAgJiYgaTI8cGF0dGVybi5sZW5ndGggJiYgcGF0dGVybi5zdWJzdHJpbmcoaTIsaTIrMSk9PXRhcmcpDQoJCXsNCgkJCWkyKys7CQkJDQoJCX0NCgkJdmFyIHRhcmdzPXBhdHRlcm4uc3Vic3RyaW5nKGkxLGkyKTsNCgkJdmFyIGw9dGFyZ3MubGVuZ3RoOw0KCQlzd2l0Y2godGFyZykNCgkJew0KCQkJY2FzZSAieSI6DQoJCQkJaWYobD09NCkNCgkJCQl7DQoJCQkJCWlmKHZhbHVlPDEwKQ0KCQkJCQkJdmFsdWU9IjIwMCIrdmFsdWU7DQoJCQkJCWVsc2UgaWYodmFsdWU8MTAwKQ0KCQkJCQkJdmFsdWU9IjIwIit2YWx1ZTsNCgkJCQkJZWxzZSBpZih2YWx1ZTwxMDAwKQ0KCQkJCQkgICB2YWx1ZT0iMiIrdmFsdWU7DQoJCQkJfQ0KCQkJCWVsc2UgaWYobDw0KQ0KCQkJCXsNCgkJCQkJdmFsdWU9IiIrKHZhbHVlICUgTWF0aC5wb3coMTAsbCkpOw0KCQkJCQlmb3IodmFyIGk9MDsgaTxsOyBpKyspDQoJCQkJCXsNCgkJCQkJCWlmKHZhbHVlLmxlbmd0aDwoaSsxKSkNCgkJCQkJCQl2YWx1ZT0iMCIrdmFsdWU7DQoJCQkJCX0NCgkJCQl9DQoJCQkJYnJlYWs7DQoJCQljYXNlICJNIjoNCgkJCQkvL2wrKzsNCgkJCQlpZihsPT0yICYmIHZhbHVlPDEwKQ0KCQkJCXsNCgkJCQkJdmFsdWU9IjAiK3ZhbHVlOw0KCQkJCX0NCgkJCQllbHNlIGlmKGw9PTMpDQoJCQkJew0KCQkJCQl2YWx1ZT1zaG9ydE1vbnRoW3ZhbHVlLTFdOw0KCQkJCX0NCgkJCQllbHNlIGlmKGw+MykNCgkJCQl7DQoJCQkJCXZhbHVlPWxvbmdNb250aFt2YWx1ZS0xXTsNCgkJCQl9DQoJCQkJYnJlYWs7DQoJCQljYXNlICJkIjoNCgkJCQlpZihsPT0yICYmIHZhbHVlPDEwKQ0KCQkJCXsNCgkJCQkJdmFsdWU9IjAiK3ZhbHVlOw0KCQkJCX0NCgkJCQlicmVhazsNCgkJCWNhc2UgIkgiOgkJCQkNCgkJCQl2YWx1ZT0rdmFsdWU7CQkJCQ0KCQkJCWJyZWFrOw0KCQkJY2FzZSAiaCI6CQkJCQ0KCQkJCXZhbHVlPXZhbHVlLTEyOwkJCQkNCgkJCQlicmVhazsNCgkJCWNhc2UgIm0iOgkJCQkNCgkJCQl2YWx1ZT0rdmFsdWU7CQkJCQ0KCQkJCWJyZWFrOw0KCQkJY2FzZSAicyI6CQkJCQ0KCQkJCXZhbHVlPSt2YWx1ZTsJCQkJDQoJCQkJYnJlYWs7DQoJCQljYXNlICJhIjoJCQkJDQoJCQkJdmFyIHRvZGF5ID0gbmV3IERhdGUoKTsNCgkJCQlpZih0b2RheS5nZXRIb3VycygpPjEyKQ0KCQkJCXsNCgkJCQkJdmFsdWU9IlBNIjsJCQkJDQoJCQkJfQ0KCQkJCWVsc2UNCgkJCQl7DQoJCQkJCXZhbHVlPSJBTSI7CQ0KCQkJCX0gCQkJICAJICANCgkJCQlicmVhazsJCQkNCgkJfQ0KCQlwYXR0ZXJuPXBhdHRlcm4uc3Vic3RyaW5nKDAsaTEpK3ZhbHVlK3BhdHRlcm4uc3Vic3RyaW5nKGkyLHBhdHRlcm4ubGVuZ3RoKTsNCgkJcmV0dXJuIHBhdHRlcm47DQoJfQ0KDQp9DQoNCg0KZnVuY3Rpb24gZ2V0VG9wSWZyYW1lKGlubmVyRnJhbWUpCQ0Kew0KCXRyeXsNCgkJdmFyIGkgPSAwOw0KCQl3aGlsZShpPDUpDQoJCXsNCgkJCWlmIChpbm5lckZyYW1lLmlmcmFtZVJlc2l6ZSkgDQoJCQkJYnJlYWs7DQoJCQlpbm5lckZyYW1lID0gaW5uZXJGcmFtZS5wYXJlbnQ7DQoJCQlpKys7DQoJCX0NCgkJcmV0dXJuIGlubmVyRnJhbWU7DQoJfWNhdGNoKEUpew0KCQlyZXR1cm4gaW5uZXJGcmFtZTsNCgl9DQp9DQoNCmZ1bmN0aW9uIGlmcmFtZVJlc2l6ZVRvVG9wKCkNCnsNCgl2YXIgdG1wRnJhbWUgPSB0aGlzLnBhcmVudDsNCgkNCglpZih0bXBGcmFtZSkNCgl7DQoJCWZvcih2YXIgaT0wOyBpPCB0bXBGcmFtZS5mcmFtZXMubGVuZ3RoOyBpKyspDQoJCXsNCgkJCXRyeSB7DQoJCQkJdmFyIG9Cb2R5ID10bXBGcmFtZS5mcmFtZXNbaV0uZG9jdW1lbnQuYm9keTsNCgkJCQl2YXIgb0ZyYW1lID0gdG1wRnJhbWUuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocGFyZW50LmZyYW1lc1tpXS5uYW1lKTsNCgkJCQluSGVpZ2h0ID0gb0JvZHkuc2Nyb2xsSGVpZ2h0ICsgb0JvZHkub2Zmc2V0SGVpZ2h0LW9Cb2R5LmNsaWVudEhlaWdodDsNCgkJCQlpZihuSGVpZ2h0ID4gNTApDQoJCQkJew0KCQkJCQlvRnJhbWUuc3R5bGUuaGVpZ2h0ID0gbkhlaWdodCArICJweCI7DQoJCQkJfQkNCgkJCX0gY2F0Y2ggKGVycm9yKSB7IC8vTXVzdCBiZSBzZWN1cml0eSB2aW9sYXRpb24uLi4NCgkJCQljb250aW51ZTsNCgkJCX0NCgkJfQ0KCX0NCn0NCg0KLyoNCglUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gZGlzYWJsZSBhbGwgZm9ybSBmaWVsZHMNCiovDQpmdW5jdGlvbiBkaXNhYmxlSW5wdXRGaWVsZCgpDQp7DQoJdmFyIGxvb3AgPSBkb2N1bWVudC5mb3Jtcy5sZW5ndGg7DQoJZm9yICh2YXIgaT0wO2k8bG9vcDtpKyspDQoJew0KCQlmb3IoIHZhciBqPTA7ajxkb2N1bWVudC5mb3Jtc1tpXS5lbGVtZW50cy5sZW5ndGg7aisrKQ0KCQl7DQoJCQlFbGU9ZG9jdW1lbnQuZm9ybXNbaV0uZWxlbWVudHNbal07DQoJCQlkaXNhYmxlU2luZ2xlSW5wdXRGaWVsZChFbGUpOw0KCQl9DQoJfQ0KfQ0KDQovKg0KCVRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBkaXNhYmxlIHNvbWUgaW5wdXRlZCBmb3JtIGZpbGVkLg0KKi8NCmZ1bmN0aW9uIGRpc2FibGVTaW5nbGVJbnB1dEZpZWxkKGlucHV0RmllbGQpDQp7DQoJdmFyIEVsZSA9IGlucHV0RmllbGQ7DQoJc3dpdGNoKEVsZS50YWdOYW1lKQkNCgl7DQoJCWNhc2UgJ0lOUFVUJzoNCgkJCWlmIChFbGUudHlwZT09InRleHQiIHx8IEVsZS50eXBlPT0icGFzc3dvcmQiKSANCgkJCXsNCgkJCQlFbGUuZGlzYWJsZWQ9ZmFsc2U7DQoJCQkJRWxlLnJlYWRPbmx5PXRydWU7DQoJCQl9ZWxzZSBpZihFbGUudHlwZT09ImNoZWNrYm94IiB8fCBFbGUudHlwZT09InJhZGlvIikNCgkJCXsNCgkJCQlFbGUuZGlzYWJsZWQ9dHJ1ZTsNCgkJCQlFbGUucmVhZE9ubHk9dHJ1ZTsNCgkJCQlpZiAoRWxlLmNoZWNrZWQpDQoJCQkJew0KCQkJCQl2YXIgaGlkZGVuT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFzc2lzdGFudF8iK0VsZS5uYW1lKTsNCgkJCQkJdmFyIHBhcmVudHMgPSBnZXRQYXJlbnRCeVR5cGUoRWxlLCAidGQiKTsNCgkJCQkJaWYoIWhpZGRlbk9iaiAmJiBwYXJlbnRzIT1udWxsKQ0KCQkJCQl7DQoJCQkJCQloaWRkZW5PYmogPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KCQkJCQkJaGlkZGVuT2JqLnR5cGU9ImhpZGRlbiI7DQoJCQkJCQloaWRkZW5PYmoubmFtZT0iYXNzaXN0YW50XyIgKyBFbGUubmFtZTsNCgkJCQkJCWhpZGRlbk9iai5pZD0iYXNzaXN0YW50XyIgKyBFbGUubmFtZTsNCgkJCQkJCWhpZGRlbk9iai52YWx1ZT1FbGUudmFsdWU7DQoJCQkJCQlwYXJlbnRzLmFwcGVuZENoaWxkKGhpZGRlbk9iaik7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCQlicmVhazsNCgkJY2FzZSAnU0VMRUNUJzoNCgkJCUVsZS5kaXNhYmxlZD10cnVlOw0KCQkJRWxlLnJlYWRPbmx5PXRydWU7DQoJCQlicmVhazsNCgkJY2FzZSAnVEVYVEFSRUEnOg0KCQkJRWxlLnJlYWRPbmx5PXRydWU7DQoJCQlFbGUuZGlzYWJsZWQ9ZmFsc2U7DQoJCQlicmVhazsNCgl9CQ0KCXJlYWRPbmx5T2JqLnJlc2V0UmVhZE9ubHkoW0VsZV0pOw0KfQ0KDQpmdW5jdGlvbiBnZXRQYXJlbnRCeVR5cGUobm9kZSwgdHlwZSkNCnsNCglpZihub2RlICYmIHR5cGUpDQoJew0KCQl2YXIgcGFyZW50ID0gbm9kZTsNCgkJdmFyIF9kb2N1bWVudCA9IGRvY3VtZW50Ow0KCQl3aGlsZShwYXJlbnQpDQoJCXsNCgkJCWlmKHBhcmVudD09KF9kb2N1bWVudFsiYm9keSJdfHxfZG9jdW1lbnRbImRvY3VtZW50RWxlbWVudCJdKSkNCgkJCXsNCgkJCQlyZXR1cm4gbnVsbDsNCgkJCX0NCgkJCXBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlOw0KCQkJaWYocGFyZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PXR5cGUpDQoJCQl7DQoJCQkJYnJlYWs7DQoJCQl9DQoJCX0NCgkJcmV0dXJuIHBhcmVudDsNCgl9DQoJcmV0dXJuIG51bGw7DQp9DQoNCmZ1bmN0aW9uIGZvY3VzSW5wdXRhYmxlRWxlbWVudChkb2MpDQp7DQoJaWYoZG9jID09IHVuZGVmaW5lZCkgcmV0dXJuOw0KCWlmIChkb2MuZm9ybXMubGVuZ3RoID4gMCkgDQoJew0KCQl2YXIgZmllbGQgPSBkb2MuZm9ybXNbMF07DQoJCS8vYWRkIGJ5IEplZmYuIEl0IHdpbGwgZG8gbm90aGluZyB3aGVuIGVuY291bnRlciBlZGl0IHZpZXcgZm9ybSBvciBmb3JtIHBvcnRsZXQgZGVzaWduZXIgZm9ybS4NCgkJaWYgKGZpZWxkLm5hbWUgPT0iZ2VuZXJpY3ZpZXdEYWlseUFkbWluU2V0dXAiIA0KCQkJfHwgZmllbGQubmFtZSA9PSAiZ2VuZXJpY3ZpZXdGb3JtIiANCgkJCXx8IGZpZWxkLm5hbWUgPT0gImdlbmVyaWNzY3JlZW5Gb3JtIiANCgkJCXx8IGZpZWxkLm5hbWUgPT0gImFwb3NjcmVlbkZvcm0iIA0KCQkJfHxmaWVsZC5uYW1lID09ICJhc3NldHNjcmVlbkZvcm0iIA0KCQkJfHxmaWVsZC5uYW1lID09ICJ0YXNrc3BlY2luZm9zY3JlZW5Gb3JtIg0KCQkJfHwgZmllbGQubmFtZSA9PSAiY2FwRXhhbWluYXRpb24iIA0KCQkJfHwgZmllbGQubmFtZSA9PSAiY2FwQ29udEVkdWNhdGlvbiIgDQoJCQl8fCBmaWVsZC5uYW1lID09ICJjYXBFZHVjYXRpb24iDQoJCQl8fCBmaWVsZC5uYW1lID09ICJjYXBIZWFyaW5nTGlzdCINCgkJCXx8IGZpZWxkLm5hbWUgPT0gImhlYXJpbmdBZ2VuZGFMaXN0IikNCgkJew0KCQkJcmV0dXJuIDsNCgkJfQ0KCSAgLy9lbmQgb2YgYWRkaW5nLg0KDQoNCglpZih3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCJhdXRvRm9jdXM9ZmFsc2UiKSA+IC0xKQ0KCXsNCgkJaWYodG9wLmpldHNwZWVkT25Mb2FkKQ0KCQl7DQoJCQl0b3AuamV0c3BlZWRPbkxvYWQoKTsNCgkJCXJldHVybjsNCgkJfQ0KCSAgfQ0KCQkNCgkgIHZhciBmb2N1c0ZsYWdGaWVsZCA9IGRvYy5mb3Jtc1swXS5uZWVkRm9jdXM7DQoJICBpZiAoZm9jdXNGbGFnRmllbGQgJiYgZm9jdXNGbGFnRmllbGQudmFsdWUgPT0gJ2ZhbHNlJykNCgkgIHsvL25lZWQgZm9jdXMgdG8gcG9wdXAgd2luZG93IA0KCQkgIHJldHVybjsNCgkgIH0NCgkgIA0KCSAgLy8gVGhlIENvb2tpZSAid2luZG93X3BvcF91cCIgaXMgZGVmaW5lZCBpbiB0aGUgcG9wIHVwIHdpbmRvd3MgKGxpa2UgRU1TRU1lc3NhZ2UuanNwLCBzZWxlY3RQZW5kaW5nSW5zcGVjdGlvbnMuanNwKQ0KCSAgcG9wVXBWYWx1ZSA9IGdldENvb2tpZVZhbHVlKCJ3aW5kb3dfcG9wX3VwIik7DQoJICBpZihwb3BVcFZhbHVlID09ICJ5ZXMiKQ0KCSAgew0KCQkgIHJldHVybjsNCgkgIH0NCgkgIA0KCSAgICAvL1RvIGNoZWNrIGlmIHNlY3Rpb24gNTA4IEZJRCBpcyBvcGVuZWQuIA0KCSAgCWlmKHByb2ZpbGUuaXNFbmFibGVkNTA4KQ0KCSAgCXsNCgkJCWZvY3VzRmlyc3RGb3JtRWxlbWVudChmaWVsZCk7DQoJCQlyZXR1cm47DQoJCX0NCgkJDQoJCWZvciAoaSA9IDA7IGkgPCBmaWVsZC5sZW5ndGg7IGkrKykNCgkJew0KCQkJLy8gQXZvaWQgZm9jdXNpbmcgb24gZHJvcGRvd24gbGlzdCBmaWVsZC4NCgkJCS8vIGlmICgoKGZpZWxkLmVsZW1lbnRzW2ldLnR5cGUgPT0gInRleHQiKSB8fCAoZmllbGQuZWxlbWVudHNbaV0udHlwZSA9PSAidGV4dGFyZWEiKSB8fCAoZmllbGQuZWxlbWVudHNbaV0udHlwZS50b1N0cmluZygpLmNoYXJBdCgwKSA9PSAicyIpKSYmKCFmaWVsZC5lbGVtZW50c1tpXS5kaXNhYmxlZCkpIA0KCQkJaWYgKCgoZmllbGQuZWxlbWVudHNbaV0udHlwZSA9PSAidGV4dCIpIHx8IChmaWVsZC5lbGVtZW50c1tpXS50eXBlID09ICJ0ZXh0YXJlYSIpKSYmKCFmaWVsZC5lbGVtZW50c1tpXS5kaXNhYmxlZCkpIA0KCQkJew0KCQkJCWlmKGRvYy5mb3Jtc1swXS5lbGVtZW50c1tpXS5zdHlsZSAmJiBkb2MuZm9ybXNbMF0uZWxlbWVudHNbaV0uc3R5bGVbJ3Zpc2liaWxpdHknXSAhPSAiaGlkZGVuIikNCgkJCQl7CQ0KCQkJCQkNCgkJCQkgICAgdHJ5ew0KCQkJCQkJaWYodHlwZW9mIGZvY3Vzb2JqICE9ICJ1bmRlZmluZWQiICYmIGZvY3Vzb2JqICE9IG51bGwpDQoJCQkJCQl7DQoJCQkJCQkJZm9jdXNvYmouZm9jdXMoKTsNCgkJCQkJCX0NCgkJCQkJCXZhciBmaXJzdEVsZSA9IGRvYy5mb3Jtc1swXS5lbGVtZW50c1tpXTsNCgkJCQkJCWlmKCEoZmlyc3RFbGUuaWQgJiYgInBhZ2UtbmF2aWdhdG9yLWlucHV0LWlkIiA9PSBmaXJzdEVsZS5pZCkpDQoJCQkJICAgIAl7CQ0KCQkJCQkJCXZhciBpZ25vcmVGb2N1cyA9IHNjcm9sbEJhcklzc3VlLmdldEF0dHJpYnV0ZShmaXJzdEVsZSwgImlnbm9yZUZvY3VzIik7DQoJCQkJCQkJaWYoaWdub3JlRm9jdXMgJiYgaWdub3JlRm9jdXMudG9VcHBlckNhc2UoKSA9PSAiVFJVRSIpDQoJCQkJCSAgICAJew0KCQkJCQkJCQljb250aW51ZQ0KCQkJCQkgICAgCX0NCgkJCQkJCQlpZighb2xkVUkgJiYgc2Nyb2xsQmFySXNzdWUuZ2V0QnJvd3NlclR5cGUoKSA9PT0gIklFIikNCgkJCQkJCQl7DQoJCQkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKXtmaXJzdEVsZS5mb2N1cygpO30gLCA1MDApOw0KCQkJCQkJCX0NCgkJCQkJCQllbHNlDQoJCQkJCQkJew0KCQkJCQkJCQlmaXJzdEVsZS5mb2N1cygpOw0KCQkJCQkJCX0NCgkJCQkgICAgCX0NCgkJCQkJCWlmKHR5cGVvZih0b3Auc2V0R2xvYmFsRm9jdXMpICE9ICJ1bmRlZmluZWQiKQ0KCQkJCQkJew0KCQkJCQkJCXRvcC5zZXRHbG9iYWxGb2N1cyA9IHRydWU7DQoJCQkJCQl9DQoNCgkJCQkJCWJyZWFrOw0KCQkJCSAgICB9DQoJCQkJICAgIGNhdGNoKGUpDQoJCQkJICAgIHsNCgkJCQkgICAgCS8vQ2FuJ3QgbW92ZSBmb2N1cyB0byB0aGUgY29udHJvbCBiZWNhdXNlIGl0IGlzIGludmlzaWJsZSwgbm90IGVuYWJsZWQsIG9yIG9mIGEgdHlwZSB0aGF0IGRvZXMgbm90IGFjY2VwdCB0aGUgZm9jdXMuIA0KCQkJCSAgICB9DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfQkNCn0NCg0KZnVuY3Rpb24gZ2V0Q29va2llVmFsdWUoY19uYW1lKQ0Kew0KCWlmIChkb2N1bWVudC5jb29raWUubGVuZ3RoPjApDQoJew0KCQljX3N0YXJ0PWRvY3VtZW50LmNvb2tpZS5pbmRleE9mKGNfbmFtZSArICI9IikNCgkJaWYgKGNfc3RhcnQhPS0xKQ0KCQl7IA0KCQkJY19zdGFydD1jX3N0YXJ0ICsgY19uYW1lLmxlbmd0aCsxIA0KCQkJY19lbmQ9ZG9jdW1lbnQuY29va2llLmluZGV4T2YoIjsiLGNfc3RhcnQpDQoJCQlpZiAoY19lbmQ9PS0xKSBjX2VuZD1kb2N1bWVudC5jb29raWUubGVuZ3RoDQoJCQlyZXR1cm4gdW5lc2NhcGUoZG9jdW1lbnQuY29va2llLnN1YnN0cmluZyhjX3N0YXJ0LGNfZW5kKSkNCgkJfSANCgl9DQoJcmV0dXJuICIiDQp9DQoNCi8vVG8gc2V0IHRoZSBmaXJzdCBlbGVtZW50IG9mIEZvcm0uDQpmdW5jdGlvbiBmb2N1c0ZpcnN0Rm9ybUVsZW1lbnQoZm9ybSkNCnsNCgl2YXIgcmV0ID0gZmFsc2U7DQoJaWYoaXNGb2N1c0VsZW1lbnQpDQoJew0KCQl2YXIgZm9jdXNFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoZm9jdXNFbGVtZW50TmFtZSlbMF07DQoJCWlmKGZvY3VzRWxlbWVudCA9PSBudWxsKQ0KCQl7DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCg0KCQlmb2N1c0VsZW1lbnQuZm9jdXMoKTsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KCWlzRm9jdXNFbGVtZW50ID0gZmFsc2U7DQoJd2luZG93LmZvY3VzRmxhZyA9IHRydWU7DQoJaWYoZm9ybSkNCgl7DQoJCXZhciBsaXN0Q2hrID0gZm9ybS5vd25lckRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhYzM2MF9saXN0X2lkIik7DQoJCWlmKGxpc3RDaGsgPT0gbnVsbCkNCgkJew0KCQkJdmFyIGVsZXMgPSBmb3JtLmVsZW1lbnRzOw0KCQkJZm9yKHZhciBpPTA7aTxlbGVzLmxlbmd0aDtpKyspew0KCQkJCXRyeXsNCgkJCQkJaWYgKCgoKGVsZXNbaV0udHlwZSA9PSAidGV4dCIpIHx8IChlbGVzW2ldLnR5cGUgPT0gInRleHRhcmVhIikpICkmJighZWxlc1tpXS5kaXNhYmxlZCkgJiYgKGVsZXNbaV0udHlwZSAhPSAiaGlkZGVuIikpDQoJCQkJCXsNCgkJCQkJCWVsZXNbaV0uZm9jdXMoKTsNCgkJCQkJCXJldD0gdHJ1ZTsNCgkJCQkJCWJyZWFrOw0KCQkJCQl9DQoJCQkJfWNhdGNoKGUpew0KCQkJCQljb250aW51ZTsNCgkJCQl9DQoJCQl9DQoJCX0NCgl9DQoJcmV0dXJuIHJldDsNCn0NCg0KDQpmdW5jdGlvbiByZXNldFJlZnJlc2hUYXJnZXQoKQ0Kew0KCXZhciB0YXJnZXRvYmo9Z2V0T2JqZWN0KCJyZWZyZXNoX3RhcmdldCIpOw0KCWlmKHRhcmdldG9iaiAhPW51bGwpDQoJew0KCQl0YXJnZXRvYmoudmFsdWU9IiI7DQoJfQkNCn0NCg0KZnVuY3Rpb24gY2xvc2VXaW5kb3coKQ0Kew0KCXdpbmRvdy5jbG9zZSgpOw0KCXJldHVybiBmYWxzZTsNCn0NCmZ1bmN0aW9uIHByaW50V2luZG93KCkNCnsNCgl3aW5kb3cucHJpbnQoKTsNCglyZXR1cm4gZmFsc2U7DQp9DQpmdW5jdGlvbiBoaWRlRHJvcGRvd25NZW51KHRoZURpdikNCnsNCgl0cnkNCgl7DQoJCW9iaiA9IE1NX2ZpbmRPYmoodGhlRGl2KTsNCgkJb2JqLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCU1NX3Nob3dIaWRlTGF5ZXJzKHRoZURpdiwnJywnaGlkZGVuJyk7DQoNCgl9Y2F0Y2goRSl7fQ0KfQ0KDQpmdW5jdGlvbiBhcHBlbmRSZWZyZXNoRmxhZyh1cmwsZmxhZykNCnsNCglpZih1cmwuaW5kZXhPZigicmVmcmVzaEZsYWc9Iik8MCkNCgl7DQoJCWlmKHVybC5pbmRleE9mKCI/Iik8MCkNCgkJew0KCQkJdXJsID0gdXJsICsgIj8iOw0KCQl9DQoJCWVsc2UNCgkJew0KCQkJdXJsID0gdXJsICsgIiYiOw0KCQl9DQoJCXVybCA9IHVybCArICJyZWZyZXNoRmxhZz0iICsgZmxhZzsNCgl9DQoJcmV0dXJuIHVybDsNCn0NCg0KLyoqDQoqIFlhbiBYaWFvIC0gU3VwcG9ydCBOZXRzY2FwZSBhbmQgRmlyZWZveCAoU0FOIyAwNkFDVC0wMDAwMC0wMDIzNSkNCiogRW11bGF0ZSB0aGUgSUUgbGluay5jbGljayBtZXRob2QgaW4gRmlyZUZveC4NCiogbGlua09iamVjdCAtIFRoZSBsaW5rIG9iamVjdCB0byBlbXVsYXRlIHRoZSBjbGljayBvbi4NCiovDQpmdW5jdGlvbiBNb3ppbGxhTGlua0NsaWNrKGxpbmtPYmplY3QpDQp7DQoJLy8gRW11bGF0ZSBjbGljayBvbiBNb3ppbGxhDQoJdmFyIGJvbEZvbGxvd0xpbmsgPSB0cnVlOw0KCXZhciBzdHJUYXJnZXQgPSBudWxsOw0KDQoJLy8gUnVuIHRoZSBsaW5rIG9uQ2xpY2sgZXZlbnQuDQoJaWYgKGxpbmtPYmplY3Qub25jbGljaykNCgl7DQoJCWlmIChsaW5rT2JqZWN0Lm9uY2xpY2soKSA9PSBmYWxzZSkNCgkJew0KCQkJYm9sRm9sbG93TGluayA9IGZhbHNlOw0KCQl9DQoJfQ0KDQoJLy8gR2V0IHRoZSBsaW5rIHRhcmdldC4NCglpZiAobGlua09iamVjdC50YXJnZXQpDQoJew0KCQlzdHJUYXJnZXQgPSBsaW5rT2JqZWN0LnRhcmdldDsNCgl9DQoJaWYgKGJvbEZvbGxvd0xpbmspDQoJew0KCQlpZiAoc3RyVGFyZ2V0ID09IG51bGwpDQoJCXsNCgkJCS8vIE9wZW4gdXNpbmcgdGhlIGRlZmF1bHQgdGFyZ2V0IGlmIG5vdCBzZXQgb24gdGhlIGxpbmsuDQoJCQkvL3dpbmRvdy5vcGVuKGxpbmtPYmplY3QuaHJlZik7DQoJCX0gDQoJCWVsc2UgDQoJCXsNCgkJCS8vIE9wZW4gdXNpbmcgdGhlIGxpbmsgdGFyZ2V0Lg0KCQkJd2luZG93Lm9wZW4obGlua09iamVjdC5ocmVmLCBzdHJUYXJnZXQpOw0KCQl9DQoJfQ0KfQ0KDQovKioNCiogVHJveSBZYW5nIC0gU2V0IGZvY3VzIGVsZW1lbnQgbmFtZSBvZiB0aGUgcGFnZSBhbmQgb3BlbiBzZXQgZm9jdXNlLg0KKiBfZm9jdXNFbGVtZW50TmFtZSB0aGUgbmFtZSBvZiBmb2N1cyBlbGVtZW50DQoqLw0KZnVuY3Rpb24gc2V0Rm9jdXNFbGVtZW50TmFtZShfZm9jdXNFbGVtZW50TmFtZSkgDQp7DQoJaXNGb2N1c0VsZW1lbnQgPSB0cnVlOw0KCXRoaXMuZm9jdXNFbGVtZW50TmFtZSA9IF9mb2N1c0VsZW1lbnROYW1lOw0KfQ0KDQpmdW5jdGlvbiBzZXRGb2N1c0J5SWQoZWxlbWVudElkKQ0Kew0KCWlmKGVsZW1lbnRJZCAmJiBlbGVtZW50SWQhPScnKQ0KCXsNCgkJdmFyIGVsZW1lbnRPYmogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpOw0KCQlpZihlbGVtZW50T2JqKQ0KCQl7DQoJCQlmb2N1c0VsZW1lbnQoZWxlbWVudE9iaik7DQoJCX0NCgl9DQp9DQovL0ZvY3VzIGVsZW1lbnQgYW5kIGNhdGNoIHRoZSBleGNlcHRpb24NCmZ1bmN0aW9uIGZvY3VzRWxlbWVudChlbGUpew0KCXNldFRpbWVvdXQoZnVuY3Rpb24oKXt0cnl7ZWxlLmZvY3VzKCk7fWNhdGNoKGUpe319LDApOw0KfQ0KLyoqDQoqIFRyb3kgWWFuZyAtIFNldCBlbGVtZW50IGZvY3VzDQoqLw0KZnVuY3Rpb24gc2V0Rm9jdXNFbGVtZW50KCkNCnsNCglpZihpc0ZvY3VzRWxlbWVudCkNCgl7DQoJCXZhciBmb2N1c0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZShmb2N1c0VsZW1lbnROYW1lKVswXTsNCgkJaWYoZm9jdXNFbGVtZW50ID09IG51bGwpDQoJCXsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWZvY3VzRWxlbWVudC5mb2N1cygpOw0KCX0NCg0KCWlzRm9jdXNFbGVtZW50ID0gZmFsc2U7DQoJd2luZG93LmZvY3VzRmxhZyA9IHRydWU7DQp9DQovKg0KKiAgQ29vbGVyIENodSwgc2V0IGNhcCBTdGF0dXMNCiovDQpmdW5jdGlvbiBjbG9zZUNhcCgpDQoJew0KCQl2YXIgZWxlQ2xvc2VkRGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkYXRlKGNhcERldGFpbE1vZGVsKmNsb3NlZERhdGUpIik7DQoJCWlmKGVsZUNsb3NlZERhdGUudmFsdWUgPT0gJycpDQoJCXsNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KCQl2YXIgZWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZhbHVlKGNhcE1vZGVsKmNhcFN0YXR1cykiKTsNCgkJdmFyIG9wcyA9IGVsZS5vcHRpb25zOw0KCQlpZighb3BzKQ0KCQl7DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCgkJZm9yKHZhciBpPTA7IGk8b3BzLmxlbmd0aDtpKyspDQoJCXsNCgkJCWlmIChvcHNbaV0udmFsdWUgPT0gJ0Nsb3NlZCcgfHwgb3BzW2ldLnZhbHVlID09ICdjbG9zZWQnIHx8IG9wc1tpXS52YWx1ZSA9PSAnQ0xPU0VEJykNCgkJCXsNCgkJCQlvcHNbaV0uc2VsZWN0ZWQgPSB0cnVlOw0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCgkJfQ0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCQ0KLyogYWRkIGJ5IGt5bGUgZm9yIGRpcmVjdCBzZWFyY2ggYmVnaW4gKi8JDQovLyByZW1vdGUgYWNjZXNzIGJ5IERPSk8NCmZ1bmN0aW9uIHJlbW90ZUFjY2Vzcyh1cmwsIHJlc3BvbnNlLGZvcm0pDQp7DQoJZG9qby5pby5iaW5kKHsgDQoJCXVybDp1cmwsIA0KCQltZXRob2Q6IlBPU1QiLA0KCQlmb3JtTm9kZTpmb3JtLCANCgkJbG9hZDpmdW5jdGlvbih0eXBlLGRhdGEsZXZ0KSB7DQoJCQlyZXNwb25zZShkYXRhKTsNCgkJCXNjcm9sbEJhcklzc3VlLnBhZ2VBZGp1c3QoKTsNCgkJfSwgDQoJCWVycm9yOmZ1bmN0aW9uKHR5cGUsZXJyb3IpIHt9LCANCgkgICAgdGltZW91dDpmdW5jdGlvbiAodHlwZSkge30sDQoJCW1pbWV0eXBlOiJ0ZXh0L3BsYWluIg0KCX0pOw0KfQ0KDQovKiBhZGQgYnkga3lsZSBmb3IgZGlyZWN0IHNlYXJjaCBiZWdpbiAqLwkNCi8vcmVtb3RlIGFjY2VzcyBieSBET0pPDQpmdW5jdGlvbiByZW1vdGVBY2Nlc3ModXJsLCByZXNwb25zZSxmb3JtLCBzeW5jKQ0Kew0KCWRvam8uaW8uYmluZCh7IA0KCQl1cmw6dXJsLCANCgkJbWV0aG9kOiJQT1NUIiwNCgkJZm9ybU5vZGU6Zm9ybSwgDQoJCWxvYWQ6ZnVuY3Rpb24odHlwZSxkYXRhLGV2dCkgew0KCQkJcmVzcG9uc2UoZGF0YSk7DQoJCQlzY3JvbGxCYXJJc3N1ZS5wYWdlQWRqdXN0KCk7DQoJCX0sIA0KCQllcnJvcjpmdW5jdGlvbih0eXBlLGVycm9yKSB7fSwgDQoJICAgIHRpbWVvdXQ6ZnVuY3Rpb24gKHR5cGUpIHt9LA0KCQltaW1ldHlwZToidGV4dC9wbGFpbiIsDQoJCXN5bmM6IHN5bmMNCgl9KTsNCn0NCg0KLy8gcmVtb3RlIGFjY2VzcyBieSBET0pPIHdpdGhvdXQgZm9ybSwgdGhlIHBhcmFtcyB3aWxsIHRyYW5zZmVyIGJ5IHVybCANCmZ1bmN0aW9uIHJlbW90ZUFjY2Vzc05vRm9ybSh1cmwsIHJlc3BvbnNlKQ0Kew0KCWRvam8uaW8uYmluZCh7IA0KCQl1cmw6dXJsLCANCgkJbWV0aG9kOiJQT1NUIiwNCgkJbG9hZDpmdW5jdGlvbih0eXBlLGRhdGEsZXZ0KSB7DQoJCQlyZXNwb25zZShkYXRhKTsNCgkJCXNjcm9sbEJhcklzc3VlLnBhZ2VBZGp1c3QoKTsNCgkJfSwgDQoJCWVycm9yOmZ1bmN0aW9uKHR5cGUsZXJyb3IpIHt9LCANCgkgICAgdGltZW91dDpmdW5jdGlvbiAodHlwZSkge30sDQoJCW1pbWV0eXBlOiJ0ZXh0L3BsYWluIiANCgl9KTsNCn0NCg0KZnVuY3Rpb24gcmVtb3RlQWNjZXNzU2hvd0VNU0UodXJsLCByZXNwb25zZSkNCnsNCgl1cmwgKz0gIiZhamF4UmVxdWVzdGVkPVkiOw0KCWRvam8uaW8uYmluZCh7IA0KCQl1cmw6dXJsLCANCgkJbWV0aG9kOiJQT1NUIiwNCgkJbG9hZDpmdW5jdGlvbih0eXBlLGRhdGEsZXZ0KSB7DQoJCXNob3dFTVNFTWVzc2FnZShjdXJyTW9kdWxlKTsNCgkJcmVzcG9uc2UoZGF0YSk7DQoJCXNjcm9sbEJhcklzc3VlLnBhZ2VBZGp1c3QoKTsNCgl9LCANCgllcnJvcjpmdW5jdGlvbih0eXBlLGVycm9yKSB7fSwgDQoJdGltZW91dDpmdW5jdGlvbiAodHlwZSkge30sDQoJbWltZXR5cGU6InRleHQvcGxhaW4iIA0KCX0pOw0KfQ0KDQovLyBlbmNhcHN1bGF0ZSB0aGUga2V5IGFuZCB2YWx1ZSANCmZ1bmN0aW9uIEpTT05PYmplY3QoKQ0Kew0KCXRoaXMua2V5cyA9IG5ldyBBcnJheSgpOw0KCXRoaXMudmFsdWVzID0gbmV3IEFycmF5KCk7DQoJdGhpcy5wdXQgPSBmdW5jdGlvbihrZXksdmFsdWUpDQoJewkJCQ0KCQl0aGlzLmtleXNbdGhpcy5rZXlzLmxlbmd0aF0gPSAiJyIgK2tleSsiJyI7DQoJCXRoaXMudmFsdWVzW3RoaXMudmFsdWVzLmxlbmd0aF0gPSAiJyIgK3ZhbHVlKyInIjsNCgl9DQoJdGhpcy5sZW5ndGggPSBmdW5jdGlvbigpDQoJewkJCQ0KCQlyZXR1cm4gdGhpcy5rZXlzLmxlbmd0aDsNCgl9DQoJdGhpcy5nZXRWYWx1ZSA9IGZ1bmN0aW9uKGtleSkNCgl7CQkJDQoJCWZvcih2YXIgaT0wOyBpPHRoaXMua2V5cy5sZW5ndGg7IGkrKykNCgkJew0KCQkJaWYodGhpcy5rZXlzW2ldID09IGtleSkNCgkJCXsNCgkJCQlyZXR1cm4gdGhpcy52YWx1ZXNbaV07DQoJCQl9DQoJCX0NCgkJcmV0dXJuICcnOw0KCX0NCgl0aGlzLmdldEtleSA9IGZ1bmN0aW9uKGluZGV4KQ0KCXsJCQkNCgkJcmV0dXJuIHRoaXMua2V5c1tpbmRleF07DQoJfQ0KCXRoaXMudG9TdHJpbmcgPSBmdW5jdGlvbigpDQoJew0KCQl2YXIgc3RyID0gInsiOw0KCQlmb3IodmFyIGkgPSAwOyBpPCB0aGlzLmtleXMubGVuZ3RoOyBpKyspDQoJCXsNCgkJCWlmKGkgPT0gMCkNCgkJCXsNCgkJCQlzdHIgKz0gdGhpcy5rZXlzW2ldICsgIjoiICsgdGhpcy52YWx1ZXNbaV07IA0KCQkJfQ0KCQkJZWxzZQ0KCQkJew0KCQkJCXN0ciArPSAiLCIgKyB0aGlzLmtleXNbaV0gKyAiOiIgKyB0aGlzLnZhbHVlc1tpXTsNCgkJCX0JIA0KCQl9DQoJCXN0ciArPSAifSI7DQoJCXJldHVybiBzdHI7DQoJfQkJDQp9CQ0KDQovLyBkaXNwbGF5IHRoZSBtc2cNCmZ1bmN0aW9uIGRpc3BsYXlNc2cobmFtZSwgdmFsdWUpDQp7DQoJX2Rpc3BsYXlNc2cobmFtZSwgdmFsdWUsIHZhbHVlKTsNCn0NCg0KZnVuY3Rpb24gX2Rpc3BsYXlNc2cobmFtZSwgdmFsdWUsIG1zZykNCnsNCglpZiAoaWUgJiYgQWMzNjAuZ2V0RWxlbWVudEJ5SWRPck5hbWUobmFtZSkpDQoJewkJCQ0KCQlBYzM2MC5nZXRFbGVtZW50QnlJZE9yTmFtZShuYW1lKS5pbm5lckhUTUw9dmFsdWU7DQoJCUFjMzYwLmdldEVsZW1lbnRCeUlkT3JOYW1lKG5hbWUpLnN0eWxlLmRpc3BsYXkgPSAnJzsNCgl9DQoJZWxzZSBpZiAobnM0ICYmIGRvY3VtZW50LmxheWVyc1tuYW1lXSkNCgl7DQoJCWRvY3VtZW50LmxheWVyc1tuYW1lXS5pbm5lckhUTUw9dmFsdWU7DQoJCWRvY3VtZW50LmxheWVyc1tuYW1lXS5zdHlsZS5kaXNwbGF5ID0gJyc7DQoJfQ0KCQ0KCWlmICh3aW5kb3cucmVmcmVzaEFsbFdhdGVybWFya3MpDQoJew0KCQl3aW5kb3cucmVmcmVzaEFsbFdhdGVybWFya3MoKTsNCgl9DQoJDQoJLy9jaGVjayB2YWx1ZQ0KCWlmKG1zZyAmJiBtc2cucmVwbGFjZSgvKF5ccyopfChccyokKS9nLCAiIikubGVuZ3RoID4gMCkNCgl7DQoJCXBvcE1lc3NhZ2U1MDgobXNnKTsNCgl9DQp9DQoNCmZ1bmN0aW9uIGRpc3BsYXlNc2dXaXRoU3R5bGUobmFtZSwgdmFsdWUpDQp7ICANCgkNCgkvL3ZhbHVlIGxpa2UgICI8Zm9udCBjbGFzcz1lcnJvcj5UaGUgY29udGFjdCBpcyB2YWxpZDwvZm9udD4iDQoJaWYodmFsdWUpIA0KCXsNCgkJdmFyIG1zZyA9IG51bGw7DQoJCXZhciBzdGFydCA9IHZhbHVlLmluZGV4T2YoIj4iKTsNCgkJdmFyIGVuZCA9IHZhbHVlLmxhc3RJbmRleE9mKCI8LyIpOw0KCQlpZihzdGFydCA+IDAgJiYgZW5kID4gMCkNCgkJew0KCSAgICAgIG1zZyA9IHZhbHVlLnN1YnN0cmluZyhzdGFydCArIDEsIGVuZCk7DQoJCX0NCgl9DQoJDQoJDQoJX2Rpc3BsYXlNc2cobmFtZSwgdmFsdWUsIG1zZyk7DQp9DQovLyBkaXNwbGF5IHRoZSBtc2cNCmZ1bmN0aW9uIGFwcGVuZE1zZyhuYW1lLCB2YWx1ZSkNCnsNCgkNCglpZiAoaWUgJiYgQWMzNjAuZ2V0RWxlbWVudEJ5SWRPck5hbWUobmFtZSkpDQoJewkJCQ0KCQlBYzM2MC5nZXRFbGVtZW50QnlJZE9yTmFtZShuYW1lKS5pbm5lckhUTUwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChuYW1lKS5pbm5lckhUTUwgKyB2YWx1ZTsNCgkJQWMzNjAuZ2V0RWxlbWVudEJ5SWRPck5hbWUobmFtZSkuc3R5bGUuZGlzcGxheSA9ICcnOw0KCX0NCgllbHNlIGlmIChuczQgJiYgZG9jdW1lbnQubGF5ZXJzW25hbWVdKQ0KCXsNCgkJZG9jdW1lbnQubGF5ZXJzW25hbWVdLmlubmVySFRNTCA9IGRvY3VtZW50LmxheWVyc1tuYW1lXS5pbm5lckhUTUwgKyB2YWx1ZTsNCgkJZG9jdW1lbnQubGF5ZXJzW25hbWVdLnN0eWxlLmRpc3BsYXkgPSAnJzsNCgl9DQp9DQoNCi8vIHVwZGF0ZSB0aGUgbXNnDQpmdW5jdGlvbiB1cGRhdGVNc2cobmFtZSwgdmFsdWUpDQp7DQoJDQoJaWYgKGllICYmIEFjMzYwLmdldEVsZW1lbnRCeUlkT3JOYW1lKG5hbWUpKQ0KCXsJCQkJCQ0KCQlBYzM2MC5nZXRFbGVtZW50QnlJZE9yTmFtZShuYW1lKS52YWx1ZSA9IHZhbHVlOwkJDQoJfQ0KCWVsc2UgaWYgKG5zNCAmJiBkb2N1bWVudC5sYXllcnNbbmFtZV0pDQoJewkJDQoJCWRvY3VtZW50LmxheWVyc1tuYW1lXS52YWx1ZSA9IHZhbHVlOwkJDQoJfQ0KCXNjcm9sbEJhcklzc3VlLmF1dG9BZGp1c3RGb3JFcnJvck1zZ0Rpc3BsYXkoKTsNCn0NCg0KLy8gY2xlYXIgbWVzc2FnZQ0KZnVuY3Rpb24gY2xlYXJNc2cobmFtZSkNCnsNCglpZiAoaWUgJiYgQWMzNjAuZ2V0RWxlbWVudEJ5SWRPck5hbWUobmFtZSkpDQoJewkJDQoJCUFjMzYwLmdldEVsZW1lbnRCeUlkT3JOYW1lKG5hbWUpLmlubmVySFRNTD0nJzsNCgkJQWMzNjAuZ2V0RWxlbWVudEJ5SWRPck5hbWUobmFtZSkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCgl9DQoJZWxzZSBpZiAobnM0ICYmIGRvY3VtZW50LmxheWVyc1tuYW1lXSkNCgl7DQoJCWRvY3VtZW50LmxheWVyc1tuYW1lXS5pbm5lckhUTUw9IiI7DQoJCWRvY3VtZW50LmxheWVyc1tuYW1lXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KCX0NCgkNCglzY3JvbGxCYXJJc3N1ZS5hdXRvQWRqdXN0Rm9yRXJyb3JNc2dEaXNwbGF5KCk7DQoJDQoJaWYgKHdpbmRvdy5yZWZyZXNoQWxsV2F0ZXJtYXJrcykNCgl7DQoJCXdpbmRvdy5yZWZyZXNoQWxsV2F0ZXJtYXJrcygpOw0KCX0NCn0NCg0KLy8gQ2xlYXIgbWVzc2FnZSBieSBJRCBmb3IgNTA4DQpmdW5jdGlvbiBjbGVhck1lc3NhZ2UoaWQpDQp7DQoJaWYocHJvZmlsZS5pc0VuYWJsZWQ1MDggJiYgaWQgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKQ0KCXsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLmlubmVySFRNTD0nJzsNCgkJc2Nyb2xsQmFySXNzdWUuYXV0b0FkanVzdEZvckVycm9yTXNnRGlzcGxheSgpOw0KCX0NCn0NCg0KLy8gc2hvdyBlcnJvciBtZXNzYWdlDQpmdW5jdGlvbiBzaG93RXJyb3JNZXNzYWdlKG5hbWUsIG1zZykNCnsNCgl2YXIgZXJyTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobmFtZSk7CQkNCglpZihlcnJNc2cpDQoJewkNCgkJZXJyTXNnLmlubmVySFRNTCA9ICc8Zm9udCBjbGFzcz0iRXJyb3IiPicrbXNnKyc8L2ZvbnQ+JzsNCgkJc2Nyb2xsQmFySXNzdWUuYXV0b0FkanVzdEZvckVycm9yTXNnRGlzcGxheSgpOw0KCQlwb3BNZXNzYWdlNTA4KG1zZyk7DQoJfQ0KfQ0KLy9zaG93IGVycm9yIG1lc3NhZ2UNCmZ1bmN0aW9uIHBvcEVycm9yQW5kRm9jdXNCeUlkNTA4KGlkLCBtc2cpDQp7DQoJaWYocHJvZmlsZS5pc0VuYWJsZTUwOCkNCgl7DQoJCXBvcE1lc3NhZ2U1MDgobXNnKTsNCgkJc2V0Rm9jdXNCeUlkKGlkKTsNCgl9DQp9DQovKiBhZGQgYnkga3lsZSBmb3IgZGlyZWN0IHNlYXJjaCBlbmQgKi8NCg0KZnVuY3Rpb24gZ2V0VG9wT2Zmc2V0KGUpDQp7DQoJdmFyIG9mZnNldD1lLm9mZnNldFRvcDsNCglpZihlLm9mZnNldFBhcmVudCE9bnVsbCkgDQoJew0KCQlvZmZzZXQrPWdldFRvcE9mZnNldChlLm9mZnNldFBhcmVudCk7DQoJfQ0KCXJldHVybiBvZmZzZXQ7DQp9DQoNCmZ1bmN0aW9uIGdldExlZnRPZmZzZXQoZSkNCnsNCgl2YXIgb2Zmc2V0PWUub2Zmc2V0TGVmdDsNCglpZihlLm9mZnNldFBhcmVudCE9bnVsbCkNCgl7DQoJCW9mZnNldCs9Z2V0TGVmdE9mZnNldChlLm9mZnNldFBhcmVudCk7DQoJfQ0KCXJldHVybiBvZmZzZXQ7DQp9DQoJDQovLy0tLS0tLS0tLS0tLS0tQmVnaW46IGluZm8gdGFibGUgIC0tLS0tLS0tLS0tLS0tDQoNCmZ1bmN0aW9uIGdldE5hbWVTdWZmaXgoaW5kZXhTdHIpDQoJew0KCQl2YXIgbGVuPWluZGV4U3RyLnRvU3RyaW5nKCkubGVuZ3RoOw0KCQlpZihsZW49PTEpDQoJCXsNCgkJCWluZGV4U3RyID0gIjAwMCIgKyBpbmRleFN0ci50b1N0cmluZygpOw0KCQl9DQoJCWVsc2UgaWYobGVuPT0yKQ0KCQl7DQoJCQlpbmRleFN0ciA9IjAwIiArIGluZGV4U3RyLnRvU3RyaW5nKCk7DQoJCX0NCgkJZWxzZSBpZihsZW49PTMpDQoJCXsNCgkJCWluZGV4U3RyID0iMCIgKyBpbmRleFN0ci50b1N0cmluZygpOw0KCQl9DQoJCXJldHVybiBpbmRleFN0cjsNCgl9DQovKioNCiogQWRkIGFuIHRlbXBsYXRlIFJvdyB0byB0aGUgZW5kIG9mIG9ialRhYmxlDQoqIEBwYXJhbSB0YWJsZU5hbWUgdGhlIG5hbWUgb2YgdGFyZ2V0IHRhYmxlIHRoYXQgbmVlZCB0byBiZSBhcHBlbmRlZCByb3cNCiovDQp2YXIgY2FsY3VsYXRpb25Db3VudCA9IDA7DQpmdW5jdGlvbiBhZGRSb3codGFibGVOYW1lKXsNCgl2YXIgZmllbGROYW1lUHJlZml4ID0gImFwcF9zcGVjX2luZm9fdGFibGVfIiArICJpbmZvX3RibF8iICsgdGFibGVOYW1lICsgIl8iOw0KCXZhciBsYXN0ZmllbGROYW1lUHJlZml4ID0gImFwcF9zcGVjX2luZm9fdGFibGVfIiArICJpbmZvX3RibF8iICsgdGFibGVOYW1lICsgICJfc3RhdHVzIiArICJfIjsNCgkNCgl2YXIgb2JqVGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5mb190YmxfIiArIHRhYmxlTmFtZSk7DQoJdmFyIGhpZGRlblJvd0NlbGxzID0gb2JqVGFibGUucm93c1sxXS5jZWxsczsNCg0KCXZhciByb3cgPSBvYmpUYWJsZS5pbnNlcnRSb3coIG9ialRhYmxlLnJvd3MubGVuZ3RoICk7DQoJdmFyIHRvdGFsQ29sdW1uID0gaGlkZGVuUm93Q2VsbHMubGVuZ3RoDQoJcm93LmlkID0gInJvd18iK29ialRhYmxlK3RoaXMuY2FsY3VsYXRpb25Db3VudDsNCglyb3cuY2xhc3NOYW1lID0gKHRoaXMuY2FsY3VsYXRpb25Db3VudCUyKSAhPSAwID8gInNpbmdsZVJvdyIgOiAiZG91YmxlUm93IjsNCgl0aGlzLmNhbGN1bGF0aW9uQ291bnQrKyA7DQoJcm93Lm9ubW91c2VvdXQgPSBmdW5jdGlvbigpew0KICAgIAlyb3dNb3VzZW91dChyb3cuaWQpOw0KICAgIH07DQogICAgcm93Lm9ubW91c2Vtb3ZlID0gZnVuY3Rpb24oKXsNCiAgICAJcm93TW91c2VPdmVyKHJvdy5pZCk7DQogICAgfTsNCiAgICByb3cub25jbGljayA9IGZ1bmN0aW9uKCl7DQogICAgCWhpZ2hsaWdodChyb3cuaWQpOw0KICAgIH07CQ0KCXZhciBmaWVsZEluZGV4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1heF9pbmRleF8iICsgdGFibGVOYW1lKS52YWx1ZTsNCglmaWVsZEluZGV4ID0gcGFyc2VJbnQoZmllbGRJbmRleCk7DQoJDQoJZm9yKHZhciBpID0gMDsgaSA8IHRvdGFsQ29sdW1uOyBpICsrKQ0KCXsNCgkJdmFyIGNlbGxIdG1sID0gaGlkZGVuUm93Q2VsbHNbaV0uaW5uZXJIVE1MLnJlcGxhY2UoL3RlbXBsYXRlXy9nLCIiKTsJDQoJCWlmKGkgIT0gMCkNCgkJew0KCQkJdmFyCXBvc2l0aW9uID0gY2VsbEh0bWwuaW5kZXhPZihmaWVsZE5hbWVQcmVmaXgpOw0KCQkJdmFyIHBvc2l0aW9uTGFzdENvbHVtbiA9IGNlbGxIdG1sLmluZGV4T2YobGFzdGZpZWxkTmFtZVByZWZpeCk7DQoJCQlpZihwb3NpdGlvbkxhc3RDb2x1bW4gIT0gLTEpDQoJCQl7DQoJCQkJdmFyIGNvbHVtbkluZGV4ID0gY2VsbEh0bWwuc3Vic3RyaW5nKHBvc2l0aW9uTGFzdENvbHVtbiArIGxhc3RmaWVsZE5hbWVQcmVmaXgubGVuZ3RoLCBwb3NpdGlvbkxhc3RDb2x1bW4gKyBsYXN0ZmllbGROYW1lUHJlZml4Lmxlbmd0aCArIDQpOw0KCQkJCXZhciBjb2x1bW5OYW1lT2xkID0gbGFzdGZpZWxkTmFtZVByZWZpeCArIGNvbHVtbkluZGV4Ow0KCQkJCQ0KCQkJCWNvbHVtbkluZGV4ID0gIGdldE5hbWVTdWZmaXgoIChmaWVsZEluZGV4KzEpLyh0b3RhbENvbHVtbiAtMiktMSk7CQkNCgkJCQl2YXIgY29sdW1uTmFtZU5ldyA9IGxhc3RmaWVsZE5hbWVQcmVmaXggKyBjb2x1bW5JbmRleDsJDQoJCQkJDQoJCQkJaWYoY29sdW1uTmFtZU9sZCAhPWNvbHVtbk5hbWVOZXcgKQ0KCQkJCXsNCgkJCQkJd2hpbGUoY2VsbEh0bWwuaW5kZXhPZihjb2x1bW5OYW1lT2xkKSE9LTEpDQoJCQkJCXsNCgkJCQkJCWNlbGxIdG1sID0gY2VsbEh0bWwucmVwbGFjZShjb2x1bW5OYW1lT2xkLGNvbHVtbk5hbWVOZXcgKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJCWVsc2UgaWYocG9zaXRpb24gIT0gLTEpDQoJCQl7CQkJDQoJCQkJdmFyIGNvbHVtbkluZGV4ID0gY2VsbEh0bWwuc3Vic3RyaW5nKHBvc2l0aW9uICsgZmllbGROYW1lUHJlZml4Lmxlbmd0aCwgcG9zaXRpb24gKyBmaWVsZE5hbWVQcmVmaXgubGVuZ3RoICsgNCk7DQoJCQkJdmFyIGNvbHVtbk5hbWVPbGQgPSBmaWVsZE5hbWVQcmVmaXggKyBjb2x1bW5JbmRleDsJCQkJDQoJCQkJY29sdW1uSW5kZXggPSAgZ2V0TmFtZVN1ZmZpeCgrK2ZpZWxkSW5kZXgpOw0KCQkJCQ0KCQkJCXZhciBjb2x1bW5OYW1lTmV3ID0gZmllbGROYW1lUHJlZml4ICsgY29sdW1uSW5kZXg7CQ0KCQkJCQ0KCQkJCWlmKGNvbHVtbk5hbWVPbGQgIT1jb2x1bW5OYW1lTmV3ICkNCgkJCQl7DQoJCQkJCXdoaWxlKGNlbGxIdG1sLmluZGV4T2YoY29sdW1uTmFtZU9sZCkhPS0xKQ0KCQkJCQl7DQoJCQkJCQljZWxsSHRtbCA9IGNlbGxIdG1sLnJlcGxhY2UoY29sdW1uTmFtZU9sZCxjb2x1bW5OYW1lTmV3ICk7DQoJCQkJCX0JDQoJCQkJfQkJCQ0KCQkJfQ0KCQkJDQoJCX0NCgkJdmFyIG5ld0NlbGwgPSByb3cuaW5zZXJ0Q2VsbChpKTsNCgkJbmV3Q2VsbC5jbGFzc05hbWUgPSBpPT0wID8gIkFsaWduTC10ZC1ib3JkZXIiIDogInBvcnRsZXQtc2VjdGlvbi1ib2R5IjsNCgkJbmV3Q2VsbC5zdHlsZS5wYWRkaW5nVG9wID0gMDsNCgkJbmV3Q2VsbC5zdHlsZS5wYWRkaW5nQm90dG9tID0gMDsNCgkJbmV3Q2VsbC5pbm5lckhUTUwgPWNlbGxIdG1sOw0KCQlpZihuZXdDZWxsLmlubmVySFRNTC5pbmRleE9mKCI8VEVYVEFSRUEiKSE9LTEpDQoJCXsNCgkJCWFkZExpbWl0ZWRFdmVudEZvckFkZEFTSVRSb3cobmV3Q2VsbCk7DQoJCX0NCgl9DQoJDQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1heF9pbmRleF8iICsgdGFibGVOYW1lKS52YWx1ZSA9IGZpZWxkSW5kZXg7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVycm9yX21lc3NhZ2VfIiArIHRhYmxlTmFtZSkuaW5uZXJIVE1MPSIiOw0KfQ0KDQoNCi8qKg0KKiBEZWxldGUgdXNlIHBpY2tlZCByb3cocykNCiogQHBhcmFtIHRhYmxlTmFtZSB0aGUgbmFtZSBvZiB0YXJnZXQgdGFibGUgdGhhdCBuZWVkIHRvIGJlIGRlbGV0ZWQgcm93DQoqLw0KZnVuY3Rpb24gcmVtb3ZlUm93KHRhYmxlTmFtZSl7CQ0KCXZhciBvYmpUYWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbmZvX3RibF8iICsgdGFibGVOYW1lKTsJDQoJdmFyIGNicyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCJhYzM2MF9saXN0X2lkXyIgKyB0YWJsZU5hbWUpOw0KCXZhciBub3NlbGVjdCA9IHRydWU7DQoNCglmb3IoIHZhciBpID0gY2JzLmxlbmd0aCA7IGkgPiAxOyBpLS0pDQoJew0KCQlpZiggY2JzW2ktMV0uY2hlY2tlZCApDQoJCXsJDQoJCQlub3NlbGVjdCA9IGZhbHNlOw0KCQkJb2JqVGFibGUuZGVsZXRlUm93KGkpOw0KCQl9DQoJfQ0KDQoJLy9pZiB1c2VyIGRvZXNuJ3Qgc2VsZWN0IGFueSByb3cgdG8gZGVsZXRlLCBwcm9tcHQgYW4gZXJyb3IgbWVzc2FnZS4NCglpZiggbm9zZWxlY3QgKQ0KCXsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVycm9yX21lc3NhZ2VfIiArIHRhYmxlTmFtZSkuaW5uZXJIVE1MPSI8Zm9udCBjb2xvcj1yZWQ+IitnZXRUZXh0bGFibGUoImVycm9yLmpzLmFjMzYwLnNlbGVjdFJvd0RlbCIpKyI8L2ZvbnQ+IjsNCgl9DQoJZWxzZQ0KCXsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVycm9yX21lc3NhZ2VfIiArIHRhYmxlTmFtZSkuaW5uZXJIVE1MPSIiOwkJDQoJfQ0KfQ0KDQovKioNCiogVG8gc2VsZWN0ZWQgb3IgcmVsZWFzZSBhbGwgY2hlY2tib3guDQoqLw0KZnVuY3Rpb24gaW5mb1RhYmxlTGlzdENsaWNrZWQodGFibGVOYW1lLCBpc0NoZWNrZWQpDQp7DQoJdmFyIG9iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCJhYzM2MF9saXN0X2lkXyIgKyB0YWJsZU5hbWUpOw0KCWZvcih2YXIgaT0wOyBpIDwgb2JqLmxlbmd0aDsgaSsrICkNCgl7CQ0KCQlvYmpbaV0uY2hlY2tlZD1pc0NoZWNrZWQ7CQkJDQoJfQkNCn0NCg0KLy8tLS0tLS0tLS0tLS0tLUVuZDppbmZvIHRhYmxlLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpmdW5jdGlvbiBzZXRDYW5jZWxCdWJibGVUcnVlKGV2dCkNCnsNCgkvL0ZpcmVmb3ggZG9lcyBub3QgZGVmaW5lIHdpbmRvdy5ldmVudCBhdCBhbGwuIEFzIHJlc3VsdCwgd2UgbmVlZCB0byB1c2UgInRoaXMuZXZlbiIgaW5zdGVhZCBvZiAiZXZlbiIuDQoJdmFyIGV2ZW50PShldnQpP2V2dDp3aW5kb3cuZXZlbnQ7DQoNCglpZiAod2luZG93LmV2ZW50KQ0KCXsNCgkJZXZlbnQuY2FuY2VsQnViYmxlID0gdHJ1ZTsNCgl9DQoJZWxzZQ0KCXsNCgkJZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7DQoJfQ0KfQ0KDQoJZnVuY3Rpb24gdHJpbSAoc3RyKSANCgl7DQoJCXJldHVybiBzdHIucmVwbGFjZSgvXlxzKy9nLCAnJykucmVwbGFjZSgvXHMrJC9nLCAnJyk7DQoJfQkNCg0KCWZ1bmN0aW9uICBjaGVja1JhbmdlKG9iamVjdFZhbHVlLCBtaW5WYWx1ZSwgbWF4VmFsdWUpDQoJeyAgICANCgkgICAgaWYgKG9iamVjdFZhbHVlLmxlbmd0aCA9PSAwKQ0KCSAgICAgICAgcmV0dXJuIHRydWU7DQoJICAgIGlmICghIGNoZWNrTnVtYmVyKG9iamVjdFZhbHVlKSl7DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX1lbHNlew0KCQkJcmV0dXJuICggbnVtYmVyUmFuZ2UoKGV2YWwob2JqZWN0VmFsdWUpKSwgbWluVmFsdWUsIG1heFZhbHVlKSk7DQoJCX0NCgkgICAgcmV0dXJuIHRydWU7DQoJfQ0KCQ0KCWZ1bmN0aW9uICBjaGVja051bWJlcihvYmplY3RWYWx1ZSkgDQoJew0KCSAgICBpZiAob2JqZWN0VmFsdWUubGVuZ3RoID09IDApDQogICAgICAgCQlyZXR1cm4gdHJ1ZTsNCg0KCQl2YXIgc3RhcnRGb3JtYXQgPSAiIC4rLTAxMjM0NTY3ODkiOw0KCQl2YXIgbnVtYmVyRm9ybWF0ID0gIiAuMDEyMzQ1Njc4OSI7DQoJCXZhciBjaGVja0NoYXI7DQoJCXZhciBkZWNpbWFsID0gZmFsc2U7DQoJCXZhciB0cmFpbGluZ0JsYW5rID0gZmFsc2U7DQoJCXZhciBkaWdpdHMgPSBmYWxzZTsNCg0KCSAgCWNoZWNrQ2hhciA9IHN0YXJ0Rm9ybWF0LmluZGV4T2Yob2JqZWN0VmFsdWUuY2hhckF0KDApKQ0KCSAgCWlmIChjaGVja0NoYXIgPT0gMSkNCgkJICAgIGRlY2ltYWwgPSB0cnVlOw0KCQllbHNlIGlmIChjaGVja0NoYXIgPCAxKQ0KCQkJcmV0dXJuIGZhbHNlOw0KCQkNCgkJZm9yICh2YXIgaSA9IDE7IGkgPCBvYmplY3RWYWx1ZS5sZW5ndGg7IGkrKyl7DQoJCQljaGVja0NoYXIgPSBudW1iZXJGb3JtYXQuaW5kZXhPZihvYmplY3RWYWx1ZS5jaGFyQXQoaSkpDQoJCQlpZiAoY2hlY2tDaGFyIDwgMCkNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQllbHNlIGlmIChjaGVja0NoYXIgPT0gMSl7DQoJCQkJaWYgKGRlY2ltYWwpCQkvLyBTZWNvbmQgZGVjaW1hbC4NCgkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCWVsc2UNCgkJCQkJZGVjaW1hbCA9IHRydWU7DQoJCQl9DQoJCQllbHNlIGlmIChjaGVja0NoYXIgPT0gMCl7DQoJCQkJaWYgKGRlY2ltYWwgfHwgZGlnaXRzKQ0KCQkJCQl0cmFpbGluZ0JsYW5rID0gdHJ1ZTsNCgkgICAgICAgIC8vIGlnbm9yZSBsZWFkaW5nIGJsYW5rcw0KCQkJfQ0KCQkgICAgICAgIGVsc2UgaWYgKHRyYWlsaW5nQmxhbmspDQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJZWxzZQ0KCQkJCWRpZ2l0cyA9IHRydWU7DQoJCX0NCgkJaWYoIXZhbGlkYXRlRGVjaW1hbFBvaW50cyhvYmplY3RWYWx1ZSkpDQoJCXsNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KCQkgICAgDQoJICAgIHJldHVybiB0cnVlOw0KCX0NCgkNCglmdW5jdGlvbiBudW1iZXJSYW5nZShvYmplY3RWYWx1ZSwgbWluVmFsdWUsIG1heFZhbHVlKQ0KICAgIHsNCgkgICAgaWYgKG1pblZhbHVlICE9IG51bGwpDQoJCXsNCgkgICAgICAgIGlmIChvYmplY3RWYWx1ZSA8IG1pblZhbHVlKQ0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJICAgIGlmIChtYXhWYWx1ZSAhPSBudWxsKQ0KCQl7DQoJCWlmIChvYmplY3RWYWx1ZSA+IG1heFZhbHVlKQ0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJICAgIHJldHVybiB0cnVlOw0KICAgIH0NCgkNCglmdW5jdGlvbiAgZm9yRGlnaHQoRGlnaHQsSG93KSAgDQoJeyAgDQogICAgCURpZ2h0ICA9ICBNYXRoLnJvdW5kKERpZ2h0Kk1hdGgucG93KDEwLEhvdykpL01hdGgucG93KDEwLEhvdyk7ICANCiAgICAgICAgcmV0dXJuICBEaWdodDsgIA0KCX0JCQ0KDQoJZnVuY3Rpb24gdmFsaWRhdGVEZWNpbWFsUG9pbnRzKHZhbHVlKQ0KCXsNCgkJdmFyIHBvaW50UG9zaXRpb24gPSB2YWx1ZS5pbmRleE9mKCIuIik7DQoJCWlmKHBvaW50UG9zaXRpb24+LTEpDQoJCXsNCgkJCXZhciBmcmFjdGlvbiA9IHZhbHVlLnN1YnN0cmluZyhwb2ludFBvc2l0aW9uKzEpOw0KCQkJaWYoZnJhY3Rpb24ubGVuZ3RoPjIpDQoJCQl7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KCQl9DQoJCXJldHVybiB0cnVlOw0KCX0NCg0KLy8tLSBGUkQ6MDM3OTkgQ29kZSBFbmZvcmNlbWVudCBVcGRhdGUsIEFuZGVyc29uIEJlZ2luIC0tDQovLyBVc2VkIGluIGNhcEZvcm1Nb2RlRWRpdC5qc3AuDQovLyB3aGVuIHVzZXIgc2V0dGluZyBhcHBlYXJhbmNlZCBEYXRlLCBzeXN0ZW0gd2lsbCBhdXRvIHNldCB0aGUgdmFsdWUgb2YgQXBwZWFyYW5jZSBEYXkgb2YgV2Vlaw0KDQovKioNCiogR2V0IHRoZSB3ZWVrIHN0cmluZyBmb3IgdGhlIGRhdGUgb2JqZWN0DQoqDQoqIEByZXR1cm46IGN1cnJlbnQgZGF0YSdzIHdlZWsgbnVtYmVyLg0KKiBAYXV0aG9yOiBBbmRlcnNvbiBMaXUNCiovDQpEYXRlLnByb3RvdHlwZS5nZXRXZWVrID0gZnVuY3Rpb24oKXsNCgl2YXIgZD1uZXcgRGF0ZSgpDQoJdmFyIHdlZWtkYXk9bmV3IEFycmF5KDcpDQoJd2Vla2RheVswXT0iU3VuZGF5Ig0KCXdlZWtkYXlbMV09Ik1vbmRheSINCgl3ZWVrZGF5WzJdPSJUdWVzZGF5Ig0KCXdlZWtkYXlbM109IldlZG5lc2RheSINCgl3ZWVrZGF5WzRdPSJUaHVyc2RheSINCgl3ZWVrZGF5WzVdPSJGcmlkYXkiDQoJd2Vla2RheVs2XT0iU2F0dXJkYXkiDQoJcmV0dXJuIHdlZWtkYXlbdGhpcy5nZXREYXkoKV07DQp9DQoNCi8qKg0KKiBHZXQgRGF0ZSBvYmplY3QgZm9yIHN0cmluZw0KKiBAcmV0dXJuIGlmIHRoaXMgaXMgYSBNTS9kZC95eXl5IGRhdGUgZm9ybWF0IHN0cmluZywgdGhlbiByZXR1cm4gYSBEYXRlIGluc3RhbmNlLCBlbHNlIHJldHVybiBudWxsDQoqIEBhdXRob3IgQW5kZXJzb24gTGl1DQoqLw0KU3RyaW5nLnByb3RvdHlwZS5nZXREYXRlID0gZnVuY3Rpb24oKXsNCg0KCXZhciB0aGUxc3QgPSB0aGlzLmluZGV4T2YoJy8nKTsNCgl2YXIgdGhlMm5kID0gdGhpcy5sYXN0SW5kZXhPZignLycpOw0KDQoJaWYgKHRoZTFzdCAhPTIgfHwgdGhlMm5kICE9NSB8fCB0aGlzLmxlbmd0aCAhPSAxMCkNCgl7IA0KCQlyZXR1cm4gbnVsbDsNCgl9DQoJZWxzZQ0KCXsNCgkJdmFyIG0gPSAgdGhpcy5zdWJzdHJpbmcoMCx0aGUxc3QpOw0KCQl2YXIgZCA9IHRoaXMuc3Vic3RyaW5nKHRoZTFzdCsxLHRoZTJuZCk7DQoJCXZhciB5ID0gdGhpcy5zdWJzdHJpbmcodGhlMm5kKzEsdGhpcy5sZW5ndGgpOw0KCQl2YXIgbWF4RGF5cyA9IDMxOw0KDQoJCWlmIChpc05hTihtKSB8fCBpc05hTihkKSB8fCBpc05hTih5KSkNCgkJew0KCQkJcmV0dXJuKG51bGwpOyANCgkJfQ0KCQllbHNlIGlmICh5Lmxlbmd0aCAhPSA0KQ0KCQl7DQoJCQlyZXR1cm4obnVsbCk7IA0KCQl9DQoJCWVsc2UgaWYgKCEoKG0+PTEpICYmIChtPD0xMikpKQ0KCQl7IA0KCQkJcmV0dXJuKG51bGwpOyANCgkJfQ0KCQllbHNlIGlmIChtPT00IHx8IG09PTYgfHwgbT09OSB8fCBtPT0xMSkNCgkJew0KCQkJbWF4RGF5cyA9IDMwOw0KCQl9DQoJCWVsc2UgaWYgKG09PTIpDQoJCXsNCgkJCWlmICh5ICUgNCA+IDApDQoJCQl7DQoJCQkJbWF4RGF5cyA9IDI4Ow0KCQkJfQ0KCQkJZWxzZSBpZiAoeSAlIDEwMCA9PSAwICYmIHkgJSA0MDAgPiAwKQ0KCQkJew0KCQkJCW1heERheXMgPSAyODsNCgkJCX0NCgkJCWVsc2UgDQoJCQl7DQoJCQkJbWF4RGF5cyA9IDI5Ow0KCQkJfQ0KCQl9DQoNCgkJaWYgKCEoKGQ+PTEpICYmIChkPD1tYXhEYXlzKSkpIA0KCQl7IA0KCQkJcmV0dXJuIG51bGw7IA0KCQl9DQoJCWVsc2UgeyANCgkJCXZhciBkYXRlT2JqZWN0ID0gbmV3IERhdGUoKTsNCgkJCWRhdGVPYmplY3Quc2V0RnVsbFllYXIoeSxtLTEsZCk7DQoJCQlyZXR1cm4gZGF0ZU9iamVjdDsgDQoJCX0NCgkJDQoJCXJldHVybiBudWxsOw0KCX0NCn0NCg0KZnVuY3Rpb24gZW5hYmxlQWxsU2VsZWN0KCkNCnsNCgl2YXIgc2VsZWN0Q29sID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNlbGVjdCIpOw0KCWZvcih2YXIgaT0wO3NlbGVjdENvbCYmaTxzZWxlY3RDb2wubGVuZ3RoO2krKykNCgl7DQoJCXZhciBzZWxlY3QgPSBzZWxlY3RDb2xbaV07DQoJCWlmKHNlbGVjdCE9bnVsbCYmc2VsZWN0LmRpc2FibGVkKQ0KCQl7DQoJCQlzZWxlY3QuZGlzYWJsZWQ9ZmFsc2U7DQoJCX0NCgl9CQ0KfQ0KDQpmdW5jdGlvbiBjaGVja1VwZGF0ZUNvbmRpdGlvbigpDQp7DQoJdmFyIG9ianMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic3BhbiIpOw0KCWZvcih2YXIgaSA9IDAgOyBpIDxvYmpzLmxlbmd0aCA7aSsrICl7DQoJCWlmKG9ianNbaV0uaWQgJiYgb2Jqc1tpXS5pZC5pbmRleE9mKCJjb25kaXRpb24iKSA9PSAwKQ0KCQl7DQoJCQlyZXR1cm4gInRydWUiOw0KCQl9DQoJfQ0KCXJldHVybiAiZmFsc2UiOw0KfQ0KDQpmdW5jdGlvbiBnZXRDb25kaXRpb25MaXN0KHVybCkNCnsJDQoJd2luZG93Lm9wZW4odXJsLCJjb25kaXRpb25XaW4iLCJ3aWR0aD03NzAsaGVpZ2h0PTU3MCxzY3JvbGxiYXJzPXllcyxyZXNpemFibGU9eWVzLHRvb2xiYXI9bm8sdG9wPTEwLGxlZnQ9MTAsc3RhdHVzPW5vLG1lbnViYXI9bm8iKTsNCglyZXR1cm4gZmFsc2U7DQp9DQoNCg0KZnVuY3Rpb24gdXBkYXRlQ2FwRm9ybUNvbmRpdGlvbigpDQp7DQoJdHJ5DQoJew0KCSAgICAgICANCgkJdmFyIGNhcEZvcm0gPSBBYzM2MC5nZXRFbGVtZW50QnlJZE9yTmFtZSgnY2FwRm9ybScsd2luZG93LnBhcmVudC5vcGVuZXIucGFyZW50KTsNCgkJaWYgKGNhcEZvcm0pDQoJCXsJDQoJCQl2YXIgbGluayA9IGNhcEZvcm0uY29udGVudFdpbmRvdy5sb2NhdGlvbi5ocmVmOw0KCQkJaWYobGluay5pbmRleE9mKCJyZWZBZGRyZXNzTGlzdERldGFpbC5kbyIpID4gMCB8fCBsaW5rLmluZGV4T2YoInJlZlBhcmNlbExvb2tVcC5kbyIpID4gMA0KCQkJCXx8IGxpbmsuaW5kZXhPZigicmVmT3duZXJMaXN0LmRvIikgPiAwIHx8IGxpbmsuaW5kZXhPZigicmVmUHJvZmVzc2lvbmFsTGlzdEZvckNhcC5kbyIpID4gMA0KCQkJCXx8IGxpbmsuaW5kZXhPZigiY2FwU3RydWN0RXN0YWJsTGlzdG1lbnQuZG8iKSA+IDANCgkJCQl8fCBsaW5rLmluZGV4T2YoInJlZkNvbnRhY3RMaXN0Rm9yQ2FwLmRvIikgPiAwKQ0KCQkJew0KCQkJCWNhcEZvcm0uY29udGVudFdpbmRvdy51cGRhdGVDb25kaXRpb24oKTsNCgkJCX0NCgkJCWVsc2UNCgkJCXsNCgkJCQlBYzM2MC5nZXRFbGVtZW50QnlJZE9yTmFtZSgiY2FwTGlzdCIsd2luZG93LnBhcmVudC5vcGVuZXIucGFyZW50KS5jb250ZW50V2luZG93LnVwZGF0ZUNvbmRpdGlvbigpOw0KCQkJCWdvRmlyc3RFbnRyeVVSTCgiY2FwRm9ybSIpOw0KCQkJfQ0KCQl9DQoJfWNhdGNoKGUpe30NCn0NCg0KLy8tLSBGUkQ6MDM3OTkgQ29kZSBFbmZvcmNlbWVudCBVcGRhdGUsIEFuZGVyc29uIEVuZCAtLQ0KDQpmdW5jdGlvbiBwb3BNZXNzYWdlNTA4KG1zZyl7DQoJaWYocHJvZmlsZS5pc0VuYWJsZWQ1MDgpew0KCQlpZihtc2cgJiYgbXNnICE9ICIiKXsNCgkJCQ0KCQkJYWxlcnQobXNnLnJlcGxhY2VBbGwoIjwvYnI+IiwgIlxuIikpOw0KCQl9DQoJCWlmKCB0eXBlb2YoZXZlbnQpID09ICJ1bmRlZmluZWQiKQ0KCQl7DQoJCQlyZXR1cm47DQoJCX0NCgkJaWYoZXZlbnQpDQoJCXsNCgkJCXZhciBldnRTcmMgPSBldmVudC5zcmNFbGVtZW50ID8gZXZlbnQuc3JjRWxlbWVudDpldmVudC50YXJnZXQ7DQoJCQlpZihldnRTcmMgIT0gbnVsbCl7DQoJCQkJZm9jdXNFbGVtZW50KGV2dFNyYyk7DQoJCQl9DQoJCX0NCgl9DQp9DQpmdW5jdGlvbiBwb3BVcGRhdGVkTWVzc2FnZTUwOCgpew0KCWlmKCB0eXBlb2YoZXZlbnQpID09ICJ1bmRlZmluZWQiIHx8ICFldmVudCkNCgl7DQoJCXJldHVybjsNCgl9DQoJdmFyIGV2dFNyYyA9IGV2ZW50LnNyY0VsZW1lbnQgPyBldmVudC5zcmNFbGVtZW50OmV2ZW50LnRhcmdldDsNCglpZihldnRTcmM9PW51bGwpew0KCQlyZXR1cm4gOw0KCX0NCglwb3BNZXNzYWdlNTA4KGdldFRleHRsYWJsZSgic2VjdGlvbjUwOC5jb21tb24ub25jaGFuZ2UubWVzc2FnZS5sYWJlbCIpKTsNCn0NCg0KZnVuY3Rpb24gY2xlYXJBbmRTaG93RXJyb3JNZXNzYWdlKCkNCnsJDQoJaWYoIXByb2ZpbGUuaXNFbmFibGVkNTA4KQ0KCXsNCgkJcmV0dXJuOw0KCX0NCgl2YXIgZXJyTGlzdFBhbmVsPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJfbXNnJyk7CQ0KCWVyckxpc3RQYW5lbC5pbm5lckhUTUw9JzxTUEFOLz4nDQoJCSsnPEZPTlQgYWNjZXNzS2V5PTkgaWQ9ZXJyb3JNc2dQYW5lbCBjbGFzcz1FcnJvciB0YWJJbmRleD0wPicrZ2V0VGV4dGxhYmxlKCJjb21tb24uZXJyb3IucHJvbXB0IikrJzwvRk9OVD4nDQoJCSsnPFNQQU4vPicNCgkJKyc8RElWIGlkPWVycl9tc2dfZGl2Lz4nOw0KCS8vc2V0IGFjY2VzcyBrZXkNCgl2YXIgZXJyb3JNc2dQYW5lbD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JNc2dQYW5lbCcpOw0KCWVycm9yTXNnUGFuZWwuYWNjZXNzS2V5ID0gZ0Vycm9yUGFubGVBY2Nlc3NLZXk7DQoJcHJlcGFyZVZpcnR1YWxCdWZmZXIoKTsNCn0NCg0KLyoqDQogKiBTY3JlZW4gcmVhZCB3aWxsIHJlYWQgdGhlIHJlc3VsdFR4dA0KICovDQpmdW5jdGlvbiB1cGRhdGVWaXJ0dWFsQnVmZmVyKHJlc3VsdFR4dCxtc2dJZCkNCnsNCgkgdmFyIGVycm9yTXNnUGFuZWw7DQoJIGlmKG1zZ0lkKQ0KCSB7DQoJCSBlcnJvck1zZ1BhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobXNnSWQpOw0KCSB9ZWxzZQ0KCSB7DQoJCSBlcnJvck1zZ1BhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yTXNnUGFuZWwnKTsNCgkgfQ0KCSAgDQoJIGlmKGVycm9yTXNnUGFuZWwgJiYgcHJvZmlsZS5pc0VuYWJsZWQ1MDgpDQoJIHsNCgkJIGlmKHJlc3VsdFR4dCkNCgkJIHsNCgkJCSBlcnJvck1zZ1BhbmVsLmlubmVySFRNTCA9IHJlc3VsdFR4dDsNCgkJIH0NCgkJIGZvY3VzRWxlbWVudChlcnJvck1zZ1BhbmVsKTsNCgkgfQ0KfQ0KDQpmdW5jdGlvbiBhZGRFcnJvck1lc3NhZ2UoZXJyb3JNZXNzYWdlKQ0Kew0KCXZhciBlcnJvclBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVycl9tc2ciKTsNCglpZih0eXBlb2YoZXJyb3JNZXNzYWdlKSAhPSAidW5kZWZpbmVkIiAmJiBlcnJvck1lc3NhZ2UgIT0gbnVsbCkNCgl7DQoJCWVycm9yUGFuZWwuaW5uZXJIVE1MID0gZXJyb3JQYW5lbC5pbm5lckhUTUwgKyAiPGZvbnQgY2xhc3M9J3BvcnRsZXQtbXNnLWVycm9yJyB0YWJpbmRleD0nLTEnIGlkPSdlcnJvck1zZ1BhbmVsJz48YnI+IitlcnJvck1lc3NhZ2UrIjwvZm9udD4iOw0KCQl1cGRhdGVWaXJ0dWFsQnVmZmVyKCk7DQoJfQ0KfQ0KLy8tLSBGUkQ6MDMwODkgRXZpZGVuY2UgVGFiLCBIaWtlbGVlIEJlZ2luIC0tDQoNCnZhciBkb1ZhbGlkVmFsdWU9ZnVuY3Rpb24oaW5wdXQpew0KCXZhciB2YWx1ZT1pbnB1dC52YWx1ZTsNCglvbmx5TnVtYmVyKGlucHV0KTsNCglpZihpbnB1dC52YWx1ZSl7DQoJCWlucHV0LnZhbHVlPXBhcnNlRmxvYXQoaW5wdXQudmFsdWUpLnRvRml4ZWQoMikNCgl9DQp9Ow0KDQp2YXIgb25seU51bWJlcj1mdW5jdGlvbihpbnB1dCl7DQoJdmFyIG9ialJlZ0V4cCA9IC9eW1wuXGRdKiQvOw0KCWlmKCFvYmpSZWdFeHAudGVzdChpbnB1dC52YWx1ZSkpew0KCQlpbnB1dC52YWx1ZT1pbnB1dC52YWx1ZS5yZXBsYWNlKC9bXlwuXGRdL2csJycpOw0KCX0gICANCglpZihpbnB1dC52YWx1ZS5zcGxpdCgnLicpLmxlbmd0aD4yKXsNCgkJaW5wdXQudmFsdWU9aW5wdXQudmFsdWUuc3BsaXQoJy4nKVswXSsnLicraW5wdXQudmFsdWUuc3BsaXQoJy4nKVsxXTsNCgl9DQp9Ow0KLyoqDQogKiBzZWxlY3QgdGhlIGNhcCB0eXBlIGZyb20gY2FwIHR5cGUgdHJlZQ0KICogQHBhcmFtOiBjYXBUeXBlIG5hbWUNCiAqIEBwYXJhbTogeW91IGNhbiBkZWZpbmUgdGhlIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgeW91ciBmdW5jdGlvbiBhZnRlciBwb3B1bGF0ZSB0aGUgY2FwIHR5cGUNCiAqIEByZXR1cm46IGNhcFR5cGUgc3RyaW5nDQogKiBAYXV0aG9yOiBXaW50ZXIgamlhbmcNCiAqLw0KZnVuY3Rpb24gc2VsZWN0Q2FwVHlwZShjYXBUeXBlT2JqTmFtZSxtZXRob2ROYW1lLHN1cHBvcnQ0bGV2ZWxzLCBpc0dlbmVyYXRlQ2FwLCBtb2R1bGUpICAgIA0KeyAgIAkNCgkJdmFyIGZvcm1OYW1lID0gZG9jdW1lbnQuZm9ybXNbMF0ubmFtZTsNCgkJdmFyIGV2ZW50ID0gKHdpbmRvdy5ldmVudCkgPyB3aW5kb3cuZXZlbnQgOiB0aGlzLmV2ZW50Ow0KCQkNCgkJaWYgKGV2ZW50KQ0KCQl7DQoJCQl2YXIgbGVmdDEgPSBldmVudC5zY3JlZW5YOw0KCQkJdmFyIHRvcDEgPSBldmVudC5zY3JlZW5ZOw0KCQl9DQoJCWlmKGxlZnQxKzIyNz5zY3JlZW4ud2lkdGgpew0KCQkJbGVmdDEgPWxlZnQxLTIyNzsNCgkJfQ0KCQlpZih0b3AxKzE3NT5zY3JlZW4uaGVpZ2h0KXsNCgkJCXRvcDEgPXRvcDEtMTc1Ow0KCQl9CQ0KCQkgdmFyIHNldHRpbmdzID0gIndpZHRoPTMwMCxoZWlnaHQ9NDAwLHRvcD0iK3RvcDErIixsZWZ0PSIrbGVmdDE7DQoJCSBzZXR0aW5ncyArPSAiLHNjcm9sbGJhcnM9eWVzLHJlc2l6YWJsZT1ubyx0b29sYmFyPW5vLHN0YXR1cz1ubyxtZW51YmFyPW5vLHNjcm9sbGJhcnM9eWVzIjsJCSANCgkJIHZhciB1cmw7CQkNCg0KCQkgaWYoc3VwcG9ydDRsZXZlbHM9PSd0cnVlJykJIA0KCQkgew0KCQkgCWlmICgnWScgPT0gaXNHZW5lcmF0ZUNhcCl7DQoJCQkJdXJsID0gIi9wb3J0bGV0cy9jb21tb25zL2RhdGFwaWNrZXIvY2FwVHlwZVRyZWVWaWV3LmpzcD9jYXBUeXBlTmFtZT0iICsgY2FwVHlwZU9iak5hbWUgKyAiJm1ldGhvZE5hbWU9IiArIG1ldGhvZE5hbWUgKyAiJnN1cHBvcnQ0bGV2ZWxzPXRydWUiICsgIiZpc0dlbmVyYWxDQVA9WSI7CQ0KCQkJfWVsc2UgaWYgKCdTVCcgPT0gaXNHZW5lcmF0ZUNhcCl7Ly9mb3Igc3RhbmRhcmQgY29tbWVudCBncm91cCBzZWFyY2gNCgkJCQl1cmwgPSAiL3BvcnRsZXRzL2NvbW1vbnMvZGF0YXBpY2tlci9jYXBUeXBlVHJlZVZpZXcuanNwP2NhcFR5cGVOYW1lPSIgKyBjYXBUeXBlT2JqTmFtZSArICImbWV0aG9kTmFtZT0iICsgbWV0aG9kTmFtZSArICImc3VwcG9ydDRsZXZlbHM9dHJ1ZSIgKyAiJmlzR2VuZXJhbENBUD1TVCI7CQ0KCQkJfWVsc2UgaWYgKHVuZGVmaW5lZCA9PSBtb2R1bGUgfHwgIiIgPT0gbW9kdWxlKXsNCgkJCQl1cmwgPSAiL3BvcnRsZXRzL2NvbW1vbnMvZGF0YXBpY2tlci9jYXBUeXBlVHJlZVZpZXcuanNwP2NhcFR5cGVOYW1lPSIgKyBjYXBUeXBlT2JqTmFtZSArICImbWV0aG9kTmFtZT0iICsgbWV0aG9kTmFtZSArICImc3VwcG9ydDRsZXZlbHM9dHJ1ZSI7DQoJCQl9ZWxzZSB7DQoJCQkJdXJsID0gIi9wb3J0bGV0cy9jb21tb25zL2RhdGFwaWNrZXIvY2FwVHlwZVRyZWVWaWV3LmpzcD9jYXBUeXBlTmFtZT0iICsgY2FwVHlwZU9iak5hbWUgKyAiJm1ldGhvZE5hbWU9IiArIG1ldGhvZE5hbWUgKyAiJnN1cHBvcnQ0bGV2ZWxzPXRydWUiICsgIiZtb2R1bGU9Iittb2R1bGU7DQoJCQl9DQoJCSB9DQoJCSBlbHNlDQoJCSB7DQoJCSAJaWYgKCdZJyA9PSBpc0dlbmVyYXRlQ2FwKSB7DQoJCQkJdXJsID0gIi9wb3J0bGV0cy9jb21tb25zL2RhdGFwaWNrZXIvY2FwVHlwZVRyZWVWaWV3LmpzcD9jYXBUeXBlTmFtZT0iICsgY2FwVHlwZU9iak5hbWUgKyAiJm1ldGhvZE5hbWU9IiArIG1ldGhvZE5hbWUgKyAiJmlzR2VuZXJhbENBUD1ZIjsJDQoJCQl9ZWxzZSAgaWYgKHVuZGVmaW5lZCA9PSBtb2R1bGUgfHwgIiIgPT0gbW9kdWxlKSB7DQoJCQkJdXJsID0gIi9wb3J0bGV0cy9jb21tb25zL2RhdGFwaWNrZXIvY2FwVHlwZVRyZWVWaWV3LmpzcD9jYXBUeXBlTmFtZT0iICsgY2FwVHlwZU9iak5hbWUgKyAiJm1ldGhvZE5hbWU9IiArIG1ldGhvZE5hbWU7DQoJCQl9ZWxzZSB7DQoJCQkJdXJsID0gIi9wb3J0bGV0cy9jb21tb25zL2RhdGFwaWNrZXIvY2FwVHlwZVRyZWVWaWV3LmpzcD9jYXBUeXBlTmFtZT0iICsgY2FwVHlwZU9iak5hbWUgKyAiJm1ldGhvZE5hbWU9IiArIG1ldGhvZE5hbWUgKyAiJm1vZHVsZT0iICsgbW9kdWxlOw0KCQkJfQ0KCQkgfQ0KCQkvL0ZpeCBidWcgNTgzMTguSWYgdGhlIHZhaXJhYmxlICJub3RGaWx0ZXJDaGlsZENhcFR5cGUiIHZhbHVlIGlzICJZIiwgDQoJCS8vZG9uJ3QgbmVlZCB0byBmaWx0ZXIgdGhlICJBcyBDaGlsZCBPbmx5IiByZWNvcmQgdHlwZSBpbiBBU0kgTG9va3VwIFRhYmxlcyAuDQoJCXZhciBub3RGaWx0ZXJDaGlsZENhcFR5cGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm90RmlsdGVyQ2hpbGRDYXBUeXBlIik7DQoJCWlmKHVuZGVmaW5lZCAhPSBub3RGaWx0ZXJDaGlsZENhcFR5cGUgJiYgbnVsbCAhPSBub3RGaWx0ZXJDaGlsZENhcFR5cGUgJiYgIlkiID09IG5vdEZpbHRlckNoaWxkQ2FwVHlwZS52YWx1ZSkNCgkJew0KCQkJdXJsID0gdXJsICsgIiZub3RGaWx0ZXJDaGlsZENhcFR5cGU9WSI7ICAgDQoJCX0NCgkJIG5ld3dpbiA9IHdpbmRvdy5vcGVuKHVybCwiY2FwVHlwZVBpY2tlciIsc2V0dGluZ3MpOwkJDQoJCSBpZiAobmV3d2luLm9wZW5lciA9PSBudWxsKQ0KCQkgIAluZXd3aW4ub3BlbmVyPXdpbmRvdzsNCgkJIAluZXd3aW4uZm9jdXMoKTsNCgkJIAlyZXR1cm4gZmFsc2U7IA0KfSANCi8vLS0gRlJEOjAzMDg5IEV2aWRlbmNlIFRhYiwgSGlrZWxlZSBFbmQgLS0NCg0KLy8gQ2xlYW4gdGhlIGNvbWJvYm94DQpmdW5jdGlvbiBjbGVhbkNvbWJvYm94KGNvbWJvYm94RWxlKXsNCgkvLyBjbGVhbiB0aGUgb3B0aW9ucw0KICAgIHdoaWxlKGNvbWJvYm94RWxlLm9wdGlvbnMubGVuZ3RoPjApIHsNCiAgICAgICAgY29tYm9ib3hFbGUub3B0aW9uc1swXT1udWxsOw0KICAgIH0NCiAgICAvLyBhZGQgZW1wdHkgb3B0aW9uDQogICAgdmFyIGVtcHR5T3B0aW9uID0gbmV3IE9wdGlvbihnZXRUZXh0bGFibGUoImNvbW1vbi5zZWxlY3QubGFiZWwiKSwnJyxmYWxzZSxmYWxzZSk7DQogICAgY29tYm9ib3hFbGUub3B0aW9uc1swXSA9IGVtcHR5T3B0aW9uOyANCn0NCg0KLy8gcG9wdWxhdGUgb3B0aW9ucyB0byB0aGUgY29tYm9ib3gNCmZ1bmN0aW9uIHBvcHVsYXRlQ29tYm9ib3godmFsdWVzLGNvbWJvYm94RWxlKSAgICAgICAgICAgIA0Kew0KICAgIGZvcih2YXIgcCBpbiB2YWx1ZXMpDQoJew0KCQl2YXIgb3B0dmFsID0gbmV3IE9wdGlvbih2YWx1ZXNbcF0scCxmYWxzZSxmYWxzZSk7DQogICAgICAgIGNvbWJvYm94RWxlLm9wdGlvbnNbY29tYm9ib3hFbGUub3B0aW9ucy5sZW5ndGhdPW9wdHZhbDsJCQkNCgl9DQp9DQoNCi8vIHBvcHVsYXRlIG9wdGlvbnMgdG8gdGhlIGNvbWJvYm94DQpmdW5jdGlvbiBzZXRDb21ib2JveFNlbGVjdGVkVmFsdWUoY29tYm9ib3hFbGUsIHZhbHVlKSAgICAgICAgICAgIA0Kew0KCWZvcih2YXIgaT0wOyBpPGNvbWJvYm94RWxlLm9wdGlvbnMubGVuZ3RoOyBpKyspDQoJew0KCQkvL2FsZXJ0KGNvbWJvYm94RWxlLm9wdGlvbnNbaV0rIjo6OiIrdmFsdWUpOw0KCQlpZiggY29tYm9ib3hFbGUub3B0aW9uc1tpXS52YWx1ZSA9PSB2YWx1ZSkNCgkJew0KCQkJDQoJCQljb21ib2JveEVsZS5zZWxlY3RlZEluZGV4ID0gaTsNCgkJCXJldHVybjsNCgkJfQkJCQ0KCX0NCn0NCg0KLy8gR2V0IHNlbGVjdGVkIGtleSBpbiB0aGUgbGlzdA0KLy8gdGhlIHByZWZpeCBpcyB0aGUgcHJlZml4IGZvciB0aGUga2V5IG5hbWUNCmZ1bmN0aW9uIGdldENoZWNrZWRLZXlzKHByZWZpeCkNCnsJCQ0KCXZhciBwYXJhbSA9ICIiOw0KCWZvcih2YXIgcCBpbiBkb2N1bWVudC5mb3Jtc1swXS5lbGVtZW50cykNCgl7CQkJCQkJCQkNCgkJaWYocC5pbmRleE9mKHByZWZpeCkgPT0gMCkJCQkNCgkJew0KCQkJdmFyIGVsZSA9IGRvY3VtZW50LmZvcm1zWzBdLmVsZW1lbnRzW3BdOwkNCgkJCWlmKCFlbGUuY2hlY2tlZCkNCgkJCXsNCgkJCQljb250aW51ZTsNCgkJCX0NCgkJCWlmKHBhcmFtID09ICIiKQ0KCQkJew0KCQkJCXBhcmFtID0gZWxlLnZhbHVlOw0KCQkJfQ0KCQkJZWxzZQ0KCQkJew0KCQkJCXBhcmFtICs9ICJ8IiArIGVsZS52YWx1ZTsNCgkJCX0NCgkJfQkNCgl9DQoJcmV0dXJuIHBhcmFtOw0KfQ0KDQpmdW5jdGlvbiBBQzM2MExpc3RDbGlja2VkKCkNCnsNCglpZihkb2N1bWVudC5mb3Jtc1swXS5hYzM2MF9saXN0X2lkICYmIGRvY3VtZW50LmZvcm1zWzBdLmFjMzYwX2xpc3RfaWRbMF0pDQoJew0KCQl2YXIgYWxsSXNDaGVja2VkID0gZG9jdW1lbnQuZm9ybXNbMF0uYWMzNjBfbGlzdF9pZFswXS5jaGVja2VkOw0KCQlpZighYWxsSXNDaGVja2VkKQ0KCQl7DQoJCQl1blNlbGVjdEFsbCgpOw0KCQl9ZWxzZXsNCgkJCXNlbGVjdEFsbCgpOw0KCQl9DQoJfQ0KfQ0KDQpmdW5jdGlvbiBzZWxlY3RBbGwoKQ0Kew0KCWlmKGRvY3VtZW50LmZvcm1zWzBdLmFjMzYwX2xpc3RfaWQpDQoJew0KCQlmb3IodmFyIGk9MDsgaTxkb2N1bWVudC5mb3Jtc1swXS5hYzM2MF9saXN0X2lkLmxlbmd0aDsgaSsrKQ0KCQl7DQoJCQlpZihkb2N1bWVudC5mb3Jtc1swXS5hYzM2MF9saXN0X2lkW2ldLmRpc2FibGVkID09IGZhbHNlKQ0KCQkJew0KCQkJCWRvY3VtZW50LmZvcm1zWzBdLmFjMzYwX2xpc3RfaWRbaV0uY2hlY2tlZCA9IHRydWU7DQoJCQl9DQoJCX0NCgl9DQp9DQoNCmZ1bmN0aW9uIHVuU2VsZWN0QWxsKCkNCnsNCglpZihkb2N1bWVudC5mb3Jtc1swXS5hYzM2MF9saXN0X2lkKQ0KCXsNCgkJZm9yKHZhciBpPTA7IGk8ZG9jdW1lbnQuZm9ybXNbMF0uYWMzNjBfbGlzdF9pZC5sZW5ndGg7IGkrKykNCgkJew0KCQkJaWYoZG9jdW1lbnQuZm9ybXNbMF0uYWMzNjBfbGlzdF9pZFtpXS5kaXNhYmxlZCA9PSBmYWxzZSkNCgkJCXsNCgkJCQlkb2N1bWVudC5mb3Jtc1swXS5hYzM2MF9saXN0X2lkW2ldLmNoZWNrZWQgPSBmYWxzZTsNCgkJCX0NCgkJfQ0KCX0NCn0NCg0KZnVuY3Rpb24gZ2V0QUMzNjBMaXN0U2VsZWN0ZWRDb3VudCgpew0KCXZhciBjb3VudCA9IDA7CQ0KCXZhciBjaGVja0xpc3Q9ZG9jdW1lbnQuZm9ybXNbMF0uYWMzNjBfbGlzdF9pZDsNCglpZihjaGVja0xpc3QpDQoJew0KCQl2YXIgYlR5cGU9Jyc7DQoJCWlmKGNoZWNrTGlzdC5sZW5ndGgpew0KCQkJYlR5cGU9Y2hlY2tMaXN0WzBdLnR5cGU7DQoJCX1lbHNlew0KCQkJYlR5cGU9Y2hlY2tMaXN0LnR5cGU7DQoJCQlpZihiVHlwZSA9PSAncmFkaW8nICYmIGNoZWNrTGlzdC5jaGVja2VkKXsNCgkJCQlyZXR1cm4gMTsNCgkJCX0NCgkJfQ0KCQl2YXIgaT0xOy8vRm9yIGNoZWNrYm94DQoJCWlmKGJUeXBlID09ICdyYWRpbycpew0KCQkJaT0wOwkJCQ0KCQl9CQ0KCQlmb3IoOyBpPGNoZWNrTGlzdC5sZW5ndGg7IGkrKykNCgkJew0KCQkJaWYoY2hlY2tMaXN0W2ldLmNoZWNrZWQpDQoJCQl7DQoJCQkJY291bnQgKys7DQoJCQl9DQoJCX0NCgl9DQoJcmV0dXJuIGNvdW50OwkNCn0NCg0KdmFyIGV4ZWN1dGVkQ2FwU2NyaXB0ID0gIiI7DQpmdW5jdGlvbiBvcGVuRU1TRShzY3JpcHROYW1lLHR5cGUpDQp7CQ0KCXZhciB1cmxTdHJpbmcgPSAiL3BvcnRsZXRzL3NldC9mZWVTZXRGb3JtLmRvP21vZGU9c2hvd0VNU0UmZnJvbVBhZ2U9IjsNCiAgICANCiAgICBpZiAodHlwZSA9PSAiY2FwX3NjcmlwdCIpDQoJew0KICAgIAlpZiAoZXhlY3V0ZWRDYXBTY3JpcHQuaW5kZXhPZihzY3JpcHROYW1lICsgIjsiKSA8IDApIA0KICAgIAl7DQogICAgCQlleGVjdXRlZENhcFNjcmlwdCArPSBzY3JpcHROYW1lICsgIjsiOw0KICAgIAkJbG9jYXRpb24gPSB1cmxTdHJpbmcgKyAiQ0FQJnNjcmlwdE5hbWU9IitzY3JpcHROYW1lOw0KICAgIAl9DQogICAgCWVsc2UgDQogICAgCXsNCiAgICAJCXJldHVybiBmYWxzZTsNCiAgICAJfQ0KCX0NCgllbHNlIGlmICh0eXBlID09ICJwYXJjZWxfc2NyaXB0IikNCgl7DQoJICBsb2NhdGlvbiA9IHVybFN0cmluZyArIlBBUkNFTCZzY3JpcHROYW1lPSIrc2NyaXB0TmFtZTsNCgl9DQoJZWxzZSBpZiAodHlwZSA9PSAiYWRkcmVzc19zY3JpcHQiKQ0KCXsNCgkgIGxvY2F0aW9uID0gdXJsU3RyaW5nICsiQUREUkVTUyZzY3JpcHROYW1lPSIrc2NyaXB0TmFtZTsNCgl9DQoJZWxzZSBpZiAodHlwZSA9PSAicHJvZmVzc2lvbmFsX3NjcmlwdCIpDQoJew0KCSAgbG9jYXRpb24gPSB1cmxTdHJpbmcgKyAiUFJPRkVTU0lPTkFMJnNjcmlwdE5hbWU9IitzY3JpcHROYW1lOw0KCX0NCgllbHNlIGlmICh0eXBlID09ICJhdWRpdHNldF9zY3JpcHQiKQ0KCXsNCgkgIGxvY2F0aW9uID0gIHVybFN0cmluZyArICJmcm9tQXVkaXRlU2V0TGlzdCZzY3JpcHROYW1lPSIrc2NyaXB0TmFtZTsNCgl9DQoJZWxzZSBpZiAodHlwZSA9PSAiYXVkaXRzZXRfaW5zcGVjdGlvbl9zY3JpcHQiKQ0KCXsNCgkgIGxvY2F0aW9uID0gIHVybFN0cmluZyArICJmcm9tSW5zcGVjdGlvbkF1ZGl0ZVNldExpc3Qmc2NyaXB0TmFtZT0iK3NjcmlwdE5hbWU7DQoJfQ0KCXJldHVybiBmYWxzZTsNCn0NCg0KZnVuY3Rpb24gaW5pUmVzdHJpY3QoKQ0KewkJDQoJaWYgKChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaXNSZXN0cmljdEZsYWciKSE9bnVsbCkmJihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VsZWN0Um9sZSIpIT1udWxsKSkNCgl7CQ0KCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlzUmVzdHJpY3RGbGFnIikudmFsdWU9PSJZIikNCgkJew0KCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlzUmVzdHJpY3RDaGVja0JveCIpLmNoZWNrZWQgPSB0cnVlOw0KCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlbGVjdFJvbGUiKS5kaXNhYmxlZCA9IGZhbHNlOw0KCQl9DQoJCWVsc2UNCgkJew0KCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlzUmVzdHJpY3RDaGVja0JveCIpLmNoZWNrZWQgPSBmYWxzZTsNCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWxlY3RSb2xlIikuZGlzYWJsZWQgPSB0cnVlOw0KCQl9DQoJfQkNCn0NCg0KDQpmdW5jdGlvbiBjaGVja1Jlc3RyaWN0KG9iaikNCnsJDQoJdmFyIGNoZWNrZWQgPSBvYmouY2hlY2tlZDsNCglpZihjaGVja2VkKQ0KCXsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlbGVjdFJvbGUiKS5kaXNhYmxlZCA9IGZhbHNlOw0KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaXNSZXN0cmljdEZsYWciKS52YWx1ZT0iWSIJCQ0KCX0NCgllbHNlDQoJew0KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VsZWN0Um9sZSIpLmRpc2FibGVkID0gdHJ1ZTsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlzUmVzdHJpY3RGbGFnIikudmFsdWU9Ik4iCQkJDQoJfQkNCn0gICANCi8qDQogKiBnZXQgY3VycmVudCB1c2VyJ3Mgc3NvIHNlc3Npb24gaWQgZnJvbSBjb29raWUNCiAqLw0KZnVuY3Rpb24gZ2V0QWNBdXRoKCkNCnsNCgl2YXIgY29vayA9IGRvY3VtZW50LmNvb2tpZTsNCglyZXR1cm4gZ2V0Q29va1ZhbHVlKGNvb2ssIkFDQXV0aD0iKTsNCn0NCi8qDQogKiBnZXQgY3VycmVudCB1c2VyJ3MgamF2YSBzZXNzaW9uIGlkIGZyb20gY29va2llDQogKi8NCmZ1bmN0aW9uIGdldEpTZXNzaW9uSUQoKQ0Kew0KCXZhciBjb29rID0gZG9jdW1lbnQuY29va2llOwkNCglyZXR1cm4gZ2V0Q29va1ZhbHVlKGNvb2ssIkpTRVNTSU9OSUQ9Iik7DQp9DQovKg0KICogZ2V0IGNvb2tpZSB2YWx1ZSBieSBuYW1lIA0KICovDQpmdW5jdGlvbiBnZXRDb29rVmFsdWUoY29va2llLCBuYW1lKQ0Kew0KCXZhciBpbmRleCA9IGNvb2tpZS5pbmRleE9mKG5hbWUpOwkNCglpZihpbmRleCAhPSAtMSkNCgl7CQkNCgkJdmFyIHN0YXJ0ID0gaW5kZXggKyBuYW1lLmxlbmd0aDsJCQ0KCQl2YXIgc3ViQ29va2llID0gY29va2llLnN1YnN0cmluZyhzdGFydCk7DQoJCXZhciBlbmQgPSBzdWJDb29raWUuaW5kZXhPZigiOyIpOw0KCQlyZXR1cm4gc3ViQ29va2llLnN1YnN0cmluZygwLGVuZCk7DQoJfQ0KCXJldHVybiAiIjsNCn0NCg0KLyoNCiAgcmV0dXJuIHRydWU6IElmIHRoZSBsYXlvdXQgaXMgcnRsICANCiAgcmV0dXJuIGZhbHNlOiBJZiB0aGUgbGF5b3V0IGlzIGx0bCBvciBubyBleGl0IGx0bCAgIA0KKi8NCg0KZnVuY3Rpb24gZ2V0RGlyZWN0aW9uKCkNCnsNCgkvLyBJRTEwIHRlc3QgY29kZQ0KCXJldHVybiBVdGlsLmNoZWNrQXIoKTsNCgkvKioNCgl2YXIgaHRtbFRhZz0iaHRtbCI7DQogICAgdmFyIGRpclByb3BlcnR5PSJkaXJlY3Rpb24iOw0KICAgIHZhciBkaXJQcm9wZXJ0eVZhbHVlPSJydGwiDQogICAgdmFyIHN0eWxlU2hlZXRMZW4gPSBkb2N1bWVudC5zdHlsZVNoZWV0cy5sZW5ndGg7DQogICAgaWYoIXN0eWxlU2hlZXRMZW4pIHJldHVybjsgDQogICAgdmFyIHJ1bGVOYW1lID0gKGRvY3VtZW50LnN0eWxlU2hlZXRzWzBdLmNzc1J1bGVzKT8nY3NzUnVsZXMnOidydWxlcyc7DQogICAgZm9yKHZhciBpPTA7IGk8c3R5bGVTaGVldExlbjsgaSsrKQ0KICAgIHsNCiAgICAgICAgdmFyIHN0eWxlU2hlZXQgPSBkb2N1bWVudC5zdHlsZVNoZWV0c1tpXTsgDQogICAgICAgIHZhciBydWxlTGVuID0gc3R5bGVTaGVldFtydWxlTmFtZV0ubGVuZ3RoOw0KICAgICAgICBmb3IodmFyIGo9MDsgajxydWxlTGVuOyBqKyspIA0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgc2VsZWN0b3JzID0gc3R5bGVTaGVldFtydWxlTmFtZV1bal0uc2VsZWN0b3JUZXh0LnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBzZWxlY3RvcnMgPSBzZWxlY3RvcnMucmVwbGFjZSgvKF5ccyopfChccyokKS9nLCAiIik7IA0KICAgICAgICAgICAgaWYgKHNlbGVjdG9ycyA9PSBodG1sVGFnKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBzdHlsZVNldCA9IHN0eWxlU2hlZXRbcnVsZU5hbWVdW2pdLnN0eWxlOw0KICAgICAgICAgICAgICAgIGZvciAocHJvcGVydHkgaW4gc3R5bGVTZXQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoc3R5bGVTZXRbcHJvcGVydHldICYmIHByb3BlcnR5ICE9ICdjc3NUZXh0JykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHkgPSBwcm9wZXJ0eS5yZXBsYWNlKC8oXlxzKil8KFxzKiQpL2csICIiKTsgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eSA9PSBkaXJQcm9wZXJ0eSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eVZhbHVlU3RyID0gc3R5bGVTZXRbcHJvcGVydHldOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VmFsdWVTdHIgPSBwcm9wZXJ0eVZhbHVlU3RyLnJlcGxhY2UoLyheXHMqKXwoXHMqJCkvZywgIiIpOyANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHlWYWx1ZVN0ciA9PSBkaXJQcm9wZXJ0eVZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQoJCQkJCQkJCQkJIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGZhbHNlOw0KICAgICoqLw0KfQ0KDQoNCi8qDQogIHJldHVybiBsZWZ0OiBJZiB0aGUgbGF5b3V0IGlzIHJ0bCwgZ2V0IG5ldyBsZWZ0LiAgICAgDQoqLw0KZnVuY3Rpb24gZ2V0U2NyZWVuTGVmdChsZWZ0LHdpZHRoKXsNCiAgICAgICAgICANCgkgd3dpZHRoPXdpbmRvdy5zY3JlZW4uYXZhaWxXaWR0aA0KCSBuZXdMZWZ0PXd3aWR0aC1sZWZ0LXdpZHRoDQoJIGlmKG5ld0xlZnQ8MCkNCgkJcmV0dXJuIGxlZnQ7DQoJIGVsc2UNCgkJcmV0dXJuIG5ld0xlZnQ7DQp9DQoNCi8qDQogIHJldHVybiBVVEYtOCBDb2RlLiAgICAgDQoqLw0KZnVuY3Rpb24gZW5jb2RlX3V0ZjgocmF3dGV4dCkgew0KICAgIHJhd3RleHQgPSByYXd0ZXh0LnJlcGxhY2UoL1xyXG4vZywiXG4iKTsNCiAgICB2YXIgdXRmdGV4dCA9ICIiOw0KICAgIGZvcih2YXIgbj0wOyBuPHJhd3RleHQubGVuZ3RoOyBuKyspDQogICAgICAgIHsNCiAgICAgICAgLy8NCiAgICAgICAgdmFyIGM9cmF3dGV4dC5jaGFyQ29kZUF0KG4pOw0KICAgICAgICAvLyAwLTEyNyA9PiAxYnl0ZQ0KICAgICAgICBpZiAoYzwxMjgpDQogICAgICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7DQogICAgICAgIC8vIDEyNyAtIDIwNDcgPT4gMmJ5dGUNCiAgICAgICAgZWxzZSBpZigoYz4xMjcpICYmIChjPDIwNDgpKSB7DQogICAgICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGM+PjYpfDE5Mik7DQogICAgICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMmNjMpfDEyOCk7fQ0KICAgICAgICAvLyAyMDQ4IC0gNjY1MzYgPT4gM2J5dGUNCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGM+PjEyKXwyMjQpOw0KICAgICAgICAgICAgdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYz4+NikmNjMpfDEyOCk7DQogICAgICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMmNjMpfDEyOCk7fQ0KICAgICAgICB9DQogICAgcmV0dXJuIHV0ZnRleHQ7DQp9DQoNCi8qDQogIHJldHVybiBVVEYtOCBTdHJpbmcuICAgICANCiovDQpmdW5jdGlvbiBkZWNvZGVfdXRmOCh1dGZ0ZXh0KSB7DQogICAgdmFyIHBsYWludGV4dCA9ICIiOyB2YXIgaT0wOyB2YXIgYz1jMT1jMj0wOw0KICAgIHdoaWxlKGk8dXRmdGV4dC5sZW5ndGgpDQogICAgICAgIHsNCiAgICAgICAgYyA9IHV0ZnRleHQuY2hhckNvZGVBdChpKTsNCiAgICAgICAgaWYgKGM8MTI4KSB7DQogICAgICAgICAgICBwbGFpbnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTsNCiAgICAgICAgICAgIGkrKzt9DQogICAgICAgIGVsc2UgaWYoKGM+MTkxKSAmJiAoYzwyMjQpKSB7DQogICAgICAgICAgICBjMiA9IHV0ZnRleHQuY2hhckNvZGVBdChpKzEpOw0KICAgICAgICAgICAgcGxhaW50ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjJjMxKTw8NikgfCAoYzImNjMpKTsNCiAgICAgICAgICAgIGkrPTI7fQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGMyID0gdXRmdGV4dC5jaGFyQ29kZUF0KGkrMSk7IGMzID0gdXRmdGV4dC5jaGFyQ29kZUF0KGkrMik7DQogICAgICAgICAgICBwbGFpbnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMmMTUpPDwxMikgfCAoKGMyJjYzKTw8NikgfCAoYzMmNjMpKTsNCiAgICAgICAgICAgIGkrPTM7fQ0KICAgICAgICB9DQogICAgcmV0dXJuIHBsYWludGV4dDsNCn0NCi8qDQogIHJldHVybiBEYXRhLg0KKi8NCmZ1bmN0aW9uIHRvU3RhbmREYXRlKGRhdGVTdHIsbWFzayl7DQogICAgICAgIHZhciB5ZWFyLG1vbnRoLGRheTsNCgl2YXIgbXNrRGF0ZUFycjsNCgl2YXIgbXNrQXJyOw0KDQoJdmFyIHNsaXBDaGFyPW5ldyBBcnJheSgnLScsJy8nLCdcXCcpOw0KCWZvcih2YXIgaT0wO2k8c2xpcENoYXIubGVuZ3RoO2krKyl7DQoJaWYobWFzay5pbmRleE9mKHNsaXBDaGFyW2ldKT4wKXsNCgkgICBtc2tBcnIgPSBtYXNrLnNwbGl0KHNsaXBDaGFyW2ldKTsNCgkgICBtc2tEYXRlQXJyID0gZGF0ZVN0ci5zcGxpdChzbGlwQ2hhcltpXSk7DQoJICAgYnJlYWs7DQoJICAgfQ0KCX0NCgkNCglmb3IgKHZhciBpPTA7aTxtc2tBcnIubGVuZ3RoO2krKykNCgl7DQoJCWlmIChtc2tBcnJbaV0udG9Mb3dlckNhc2UoKS5pbmRleE9mKCJ5Iik+PTApDQoJCXsNCgkJICB5ZWFyID0gbXNrRGF0ZUFycltpXTsNCgkJfQ0KCQllbHNlIGlmKG1za0FycltpXS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoIm0iKT49MCkNCgkJew0KCQkgIG1vbnRoID0gbXNrRGF0ZUFycltpXTsNCgkJfQ0KCQllbHNlIGlmKG1za0FycltpXS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoImQiKT49MCkNCgkJew0KCQkgIGRheSA9IG1za0RhdGVBcnJbaV07DQoJCX0NCgl9DQoJCQ0KCW1vbnRoID0gbW9udGggLSAxOw0KCXZhciBtYXNrRGF0ZT1uZXcgRGF0ZSh5ZWFyLG1vbnRoLGRheSk7DQoJcmV0dXJuIG1hc2tEYXRlOw0KfQ0KDQpmdW5jdGlvbiBpc0RvdWJsZUJ5dGUoc3RyKXsNCiBmb3IodmFyIGk9MDtpPHN0ci5sZW5ndGg7aSsrKXsNCiAgIGlmKHN0ci5jaGFyQ29kZUF0KGkpPjI1NSl7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgIH0NCiAgfQ0KfQ0KDQpmdW5jdGlvbiBnZXREb3VibGVCeXRlQ291bnQoc3RyKQ0Kew0KCXZhciBqPTA7DQoJZm9yKHZhciBpPTA7aTxzdHIubGVuZ3RoO2krKykNCgl7DQoJCWlmKHN0ci5jaGFyQ29kZUF0KGkpPjI1NSkNCgkJew0KCQkJaisrOw0KCQl9DQoJfQ0KCXJldHVybiBqOw0KfQ0KDQovKg0KVXBkYXRlIGZ1bmN0aW9uIG5hbWUgdG8gbm90IGVmZmVjdCBvdGhlciBKU1AgYW5kIEpTIGZpbGVzIHRoYXQgaGFzIHNhbWUgZnVuY3Rpb24sYnkgd2hpdGUgOS8zLzIwMDgNCiovDQpmdW5jdGlvbiBnZXRSZXR1cm5JdGVtSWRGb3JTdGF0ZShhZmwxLCBpZCkNCnsJDQoJdmFyIGFmbCA9IGRvY3VtZW50LmZvcm1zWzBdLmVsZW1lbnRzW2FmbDFdOw0KCWlmIChhZmwpDQoJew0KCQl2YXIgcmQgPSByZXR1cm5EYXRhRm9yU3RhdGUoaWQpOwkNCgkJdmFyIGFmTGVuID0gYWZsLm1heExlbmd0aDsNCgkJaWYgKHJkLmxlbmd0aCA+IGFmTGVuKSAgICAgIAkgICAgCQkNCgkJew0KCQkJcmQgPSByZC5zdWJzdHJpbmcoMCxhZkxlbik7DQogICAgCX0JDQoJCWFmbC52YWx1ZSA9IHJkOw0KCX0NCn0NCg0KZnVuY3Rpb24gcmV0dXJuRGF0YUZvclN0YXRlKGlucHV0RGF0YSkNCnsNCgl2YXIgcmV0dXJuRGF0YT0iIjsNCglpZiAoaW5wdXREYXRhPT0ibnVsbCIpDQoJew0KCQlyZXR1cm5EYXRhPSIiOw0KCX1lbHNlIGlmICggaW5wdXREYXRhID09IG51bGwgKQ0KCXsNCgkJcmV0dXJuRGF0YSA9ICIiOw0KCX0NCgllbHNlDQoJew0KCQlyZXR1cm5EYXRhPWlucHV0RGF0YTsNCgl9DQoJcmV0dXJuIHJldHVybkRhdGE7DQp9DQoNCmZ1bmN0aW9uIElFcHJpbnQoKSB7DQoJLy8gaWYoaXNGaXJlZm94PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiRmlyZWZveCIpPjApew0KCWlmIChzY3JvbGxCYXJJc3N1ZS5nZXRCcm93c2VyVHlwZSgpID09ICJGaXJlZm94Ig0KCQkJfHwgc2Nyb2xsQmFySXNzdWUuZ2V0QnJvd3NlclR5cGUoKSA9PSAiQ2hyb21lIikgew0KCQkvLyBhbGVydCgnRmlyZm94Jyk7DQoJCWRvY3VtZW50LmRlZmF1bHRWaWV3LnByaW50KCk7DQogICB9ZWxzZXsgDQoJaWYgKCFkb2N1bWVudC5wYXJlbnRXaW5kb3cpIHsNCgkJdGhpcy5wYXJlbnQucHJpbnQoKTsNCgkJcmV0dXJuOw0KCX0NCg0KICAgICAgIC8vYWxlcnQoJ0lFJyk7DQogICAgICAgZG9jdW1lbnQucGFyZW50V2luZG93LnByaW50KCk7DQogICB9DQp9DQogDQpmdW5jdGlvbiBnZXRJdGVtSWR4MWJ5c2luZ2xlRm9yU3RhdGUoYWZsMSwgaWQpDQp7DQoJYWZsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYWZsMSk7DQogICAJdmFyIHJldCA7DQoJaWYoYWZsICE9IG51bGwpDQogICAgew0KCQlmb3VuZCA9IGZhbHNlOw0KCQlmb3IodmFyIGk9MDsgaTxhZmwubGVuZ3RoICYmICFmb3VuZDsgaSsrKQ0KCQl7DQoJCQlpZihhZmwuaXRlbShpKS52YWx1ZSA9PSBpZCkNCgkJCXsNCgkJCQlmb3VuZCA9IHRydWU7DQoJCQkJcmV0ID0gaTsNCgkJCX0NCgkJfQ0KCQlpZihmb3VuZCkNCgkJew0KCQlhZmwub3B0aW9uc1tyZXRdLnNlbGVjdGVkID0gdHJ1ZTsNCgkJfQ0KCX0NCn0NCmZ1bmN0aW9uIGNvdW50cnlTdGF0ZVJlc2V0KHN0YXRlX3Byb3BlcnR5LHN0YXRlX3ZhbHVlLGNvdW50cnlfdmFsdWUsYWFab25lSWQpDQp7DQoJaWYoYWFab25lSWQ9PW51bGx8fGFhWm9uZUlkPT11bmRlZmluZWQpDQoJew0KCQlhYVpvbmVJZCA9ICJhYXpvbmUtY291bnRyeS1zdGF0ZSI7DQoJfQkNCglpZih0eXBlb2YgYWpheEFueXdoZXJlIT0gJ3VuZGVmaW5lZCcpDQoJew0KCQl2YXIgc3RhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzdGF0ZV9wcm9wZXJ0eSk7DQoJCXZhciBpbnB1dFdpZHRoID0gIiI7DQoJCWlmKHN0YXRlICE9IG51bGwpDQoJCXsNCgkJCWlucHV0V2lkdGggPSBzdGF0ZS5zdHlsZS53aWR0aDsNCgkJfQ0KCQkNCgkJYWpheEFueXdoZXJlLmdldEFKQVgoJy9wb3J0bGV0cy9jb21tb25zL2FkZHJlc3MvY291bnRyeVN0YXRlQUpBWC5qc3A/YWFab25lSWQ9JythYVpvbmVJZCsnJnN0YXRlUHJvcGVydHk9JytzdGF0ZV9wcm9wZXJ0eSsnJnN0YXRldmFsdWU9JytzdGF0ZV92YWx1ZSsnJmNvdW50cnk9Jytjb3VudHJ5X3ZhbHVlKycmd2lkdGg9JytpbnB1dFdpZHRoLGFhWm9uZUlkKTsNCgkgICAgDQoJCXZhciBvcmdpbmFsT25BZnRlciA9IGFqYXhBbnl3aGVyZS5vbkFmdGVyUmVzcG9uc2VQcm9jZXNzaW5nOw0KCQlhamF4QW55d2hlcmUub25BZnRlclJlc3BvbnNlUHJvY2Vzc2luZz1mdW5jdGlvbiAoKSANCgkJew0KCQkJaWYoIlVTIj09Y291bnRyeV92YWx1ZSkNCgkJCXsJICAgIAkgICAgICAgCQkgIA0KCQkJCWdldEl0ZW1JZHgxYnlzaW5nbGVGb3JTdGF0ZShzdGF0ZV9wcm9wZXJ0eSxzdGF0ZV92YWx1ZSk7IA0KCQkJfWVsc2UNCgkJCXsJICAgICAgICANCgkJCQlnZXRSZXR1cm5JdGVtSWRGb3JTdGF0ZShzdGF0ZV9wcm9wZXJ0eSxzdGF0ZV92YWx1ZSk7DQoJCQl9DQoJCQlhamF4QW55d2hlcmUub25BZnRlclJlc3BvbnNlUHJvY2Vzc2luZyA9IG9yZ2luYWxPbkFmdGVyOw0KCQl9OyAgICAgIA0KCX0NCn0NCg0KZnVuY3Rpb24gY3JlYXRlWE1MSHR0cFJlcXVlc3QoKQ0Kew0KCXZhciB4bWxIdHRwID0gZmFsc2U7DQoJaWYgKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCkgICAvLyBNb3ppbGxhLCBTYWZhcmksIC4uLg0KCXsNCgkJeG1sSHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KCX0NCgllbHNlIGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdCkgIC8vIElFDQoJew0KCQl0cnkNCgkJew0KCSAJCXhtbEh0dHAgPSBuZXcgQWN0aXZlWE9iamVjdCgiTXN4bWwyLlhNTEhUVFAiKTsNCgkJfQ0KCQljYXRjaChlMSkNCgkJew0KCQkJdHJ5DQoJCQl7DQoJCQkJeG1sSHR0cCA9IG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpOw0KCQkJfQ0KCQkJY2F0Y2goZTIpDQoJCQl7DQoJCQkJeG1sSHR0cCA9IGZhbHNlOw0KCQkJfQ0KCQl9DQoJfQ0KCQ0KCXJldHVybiB4bWxIdHRwOw0KfQ0KDQoNCi8vIGNsaWVudC1zaWRlIHdpbGwgcmVmcmVzaCB0aGUgem9uZUlkIHdpdGggaW5uZXIgaHRtbCANCi8vIHdoZW4gb25jZSBnZXQgcmVzcG9uc2UgZGF0YSBmcm9tIHNlcnZlci1zaWRlDQpmdW5jdGlvbiBmb3JtQWpheFJlcXVlc3QodXJsLCBwYXJhbSwgc3luYyx6b25lSWQpDQp7DQoJdmFyIHhtbEh0dHAgPSBjcmVhdGVYTUxIdHRwUmVxdWVzdCgpOw0KCWlmICgheG1sSHR0cCkgDQoJew0KCQl0aHJvdyBuZXcgRXJyb3IoIlhNTEh0dHAgb2JqZWN0IGNvdWxkIGJlIGNyZWF0ZWQuIik7DQoJfQ0KCQ0KCXhtbEh0dHAub3BlbigiUE9TVCIsIHVybCwgc3luYyk7DQoJeG1sSHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBjYWxsQmFjazsNCgl4bWxIdHRwLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTsNCgl4bWxIdHRwLnNlbmQocGFyYW0pOw0KCQ0KCWZ1bmN0aW9uIGNhbGxCYWNrKCkNCgl7DQoJCWlmKHhtbEh0dHAucmVhZHlTdGF0ZSA9PSA0KQ0KCQl7DQoJCQlpZiAoeG1sSHR0cC5zdGF0dXMgPT0gMjAwKQ0KCQkJew0KCQkJCXZhciByZXNwRGF0YSA9IHhtbEh0dHAucmVzcG9uc2VUZXh0Ow0KCQkJCXZhciBvYmogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh6b25lSWQpOw0KCQkJCWlmKG9iaikNCgkJCQl7DQoJCQkJCW9iai5pbm5lckhUTUwgPSByZXNwRGF0YTsNCgkJCQl9DQoJCQl9DQoJCX0NCgl9DQp9DQpmdW5jdGlvbiBwb3BVcFJlb3JkZXJXaW5kb3cocmVvcmRlclVSTCkNCnsNCgl2YXIgcmV0dXJuVmFsdWUgPSB3aW5kb3cuc2hvd01vZGFsRGlhbG9nICgnL3BvcnRsZXRzL2NvbW1vbnMvcmVvcmRlci9saXN0UmVvcmRlci5qc3AnLCByZW9yZGVyVVJMLCAnZGlhbG9nSGVpZ2h0PTQwMHB4O2RpYWxvZ1dpZHRoPTU1MHB4O3Njcm9sbDpubycpOw0KCXJldHVybiByZXR1cm5WYWx1ZTsNCn0NCg0KLy9zZXQgZWxlbWVudCB2YWx1ZSBieSBpZCwgZG8gbm90aGluZyBpZiB0aGUgZWxlbWVudCBpcyBub3QgZXhpc3RlZA0KZnVuY3Rpb24gc2V0RWxlbWVudFZhbHVlQnlJZChlbGVtZW50SWQsIHZhbHVlKQ0Kew0KCWlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCkhPW51bGwpDQoJew0KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpLnZhbHVlPXZhbHVlOw0KCX0NCn0NCg0KLy9nZXQgZWxlbWVudCB2YWx1ZSBieSBpZCwgcmV0dXJuIGVtcHR5IHN0cmluZyBpZiB0aGUgZWxlbWVudCBpcyBub3QgZXhpc3RlZA0KZnVuY3Rpb24gZ2V0RWxlbWVudFZhbHVlQnlJZChlbGVtZW50SWQpDQp7DQoJdmFyIHZhbHVlID0gIiI7DQoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCkgIT0gbnVsbCkNCgl7DQoJCXZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKS52YWx1ZTsNCgl9DQoNCglyZXR1cm4gdmFsdWU7DQp9DQoNCi8vRHJhdyBpbWFnZSBhbmQgbGltaXQgdGhlIHNpemUgYW5kIHRoZSBzY2FsZS4NCmZ1bmN0aW9uIHJlc2l6ZUltYWdlKGltZywgaXdpZHRoLCBpaGVpZ2h0LCBpc1VzZUVkaXRWaWV3KSANCnsNCglpZih0eXBlb2YoSW1hZ2UpPT0idW5kZWZpbmVkIikNCgl7DQoJCXJldHVybjsNCgl9DQoJdmFyIGltYWdlPW5ldyBJbWFnZSgpOw0KCWltYWdlLnNyYz1pbWcuc3JjOw0KCQ0KCS8vSWYgZGlkbid0IHVzZSBlZGl0IHZpZXcgYW5kIHRoZSBpbWFnZSBpcyBzbWFsbGVyIHRoYW4gYXNzaWduZWQgc2l6ZSx0aGVuIGRvIG5vdGhpbmcuDQoJaWYoIWlzVXNlRWRpdFZpZXcgJiYgaW1hZ2Uud2lkdGggPCBpd2lkdGggJiYgaW1hZ2UuaGVpZ2h0IDwgaWhlaWdodCkNCgl7DQoJCS8vRG8gbm90aGluZywga2VlcCB0aGUgb3JpZ2luYWwgc2l6ZS4NCgl9DQoJLy9DYXNlIDEuIE5vIGVkaXQgdmlldywgYW5kIGltYWdlIHNpemUgaXMgYmlnZ2VyIHRoYW4gYXNzaWduZWQgc2l6ZQ0KCS8vQ2FzZSAyLiBVc2luZyBlZGl0IHZpZXcgLGFuZCBpbWFnZSBpcyBiaWdnZXIgdGhhbiBhc3NpZ25lZCBzaXplDQoJLy9DYXNlIDMuIFVzaW5nIGVkaXQgdmlldywgYW5kIGltYWdlIGlzIHNtYWxsZXIgdGhhbiBhc3NpZ25lZCBzaXplDQoJLy9CYXNlIG9uIHRoZXNlIDMgY2FzZSwgd2UgbmVlZCB0byBrZWVwIHRoZSBpbWFnZSBzaXplIGluIHByb3BvcnRpb24uDQoJZWxzZQ0KCXsNCgkJaWYoaW1hZ2Uud2lkdGg+MCAmJiBpbWFnZS5oZWlnaHQ+MCkNCgkJew0KCQkJaWYoaW1hZ2Uud2lkdGgvaW1hZ2UuaGVpZ2h0Pj0gaXdpZHRoL2loZWlnaHQpDQoJCQl7DQoJCQkJaW1nLndpZHRoPWl3aWR0aDsNCgkJCQlpbWcuaGVpZ2h0PShpbWFnZS5oZWlnaHQqaXdpZHRoKS9pbWFnZS53aWR0aDsNCgkJCX0NCgkJCWVsc2UNCgkJCXsJDQoJCQkJaW1nLmhlaWdodD1paGVpZ2h0OyANCgkJCQlpbWcud2lkdGg9KGltYWdlLndpZHRoKmloZWlnaHQpL2ltYWdlLmhlaWdodDsgICAgICAgIA0KCQkJfQ0KCQl9DQoJfQ0KCQ0KCXZhciBsb2FkaW5nSW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvYWRpbmdJbWciKTsNCglpZiAobG9hZGluZ0ltZykNCgl7DQoJCWxvYWRpbmdJbWcuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgl9DQoJDQoJaW1nLnN0eWxlLmRpc3BsYXkgPSAiIjsNCn0gDQoNCmZ1bmN0aW9uIGpzb25EZWNvZGUoc3RyKQ0Kew0KCWlmKHN0cikNCgl7DQoJCXJldHVybiBzdHIucmVwbGFjZSgvX1xeTEVGVFxeXy9nLCI8IikNCgkJCS5yZXBsYWNlKC9fXF5SSUdIVFxeXy9nLCI+IikNCgkJCS5yZXBsYWNlKC9fXF5BTkRcXl8vZywiJiIpDQoJCQkucmVwbGFjZSgvX1xeU0lOR0xFXF5fL2csIiciKQ0KCQkJLnJlcGxhY2UoL19cXkRPVUJMRVxeXy9nLCciJykNCgkJCS5yZXBsYWNlKC9fXF5XRUxMXF5fL2csIiMiKQ0KCQkJLnJlcGxhY2UoL19cXlBFUlNFTlRcXl8vZywiJSIpOw0KCX1lbHNlew0KCQlyZXR1cm4gc3RyOw0KCX0NCn0NCi8vUmVnaXN0ZXIgZXZlbnQuIA0KZnVuY3Rpb24gYWRkRXZlbnQobm9kZSwgZXZlbnRfdHlwZSwgbGlzdGVuZXJfbWV0aG9kKSANCnsgIA0KCWlmKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIA0KCXsNCgkJbm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50X3R5cGUsbGlzdGVuZXJfbWV0aG9kLGZhbHNlKTsgDQoJfSANCgllbHNlIGlmIChkb2N1bWVudC5hdHRhY2hFdmVudCkgDQoJew0KCQlub2RlLmF0dGFjaEV2ZW50KCdvbicrZXZlbnRfdHlwZSxsaXN0ZW5lcl9tZXRob2QpOyAgIA0KCX0gDQoJZWxzZSANCgl7DQoJCW5vZGUub25rZXl1cCA9IGxpc3RlbmVyX21ldGhvZDsgICANCgl9DQp9DQoNCi8vR2V0IGtleS4NCmZ1bmN0aW9uIGdldEtleShlKQ0KeyANCgllID0gZSB8fCB3aW5kb3cuZXZlbnQ7IA0KCXZhciBrZXljb2RlID0gZS53aGljaCA/IGUud2hpY2ggOiBlLmtleUNvZGU7DQoJaWYoa2V5Y29kZSA9PSAxMyB8fCBrZXljb2RlID09IDEwOCkNCgl7DQoJCWVudGVyS2V5RXZlbnQoKTsJDQoJfSANCn0gDQoNCmZ1bmN0aW9uIGVudGVyS2V5RXZlbnQoKQ0Kew0KCS8vIE92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGFjaGlldmUgeW91ciBsb2dpYy4NCn0NCg0KLyoqDQogKiBFeGVjdXRlIHJlZnJlc2hOYXYgZnVjdGlvbi4NCiAqLw0KZnVuY3Rpb24gZG9SZWZyZXNoTmF2KCkNCnsNCglpZih0b3AucmVmcmVzaE5hdikNCgl7DQoJCXRvcC5yZWZyZXNoTmF2KCk7CQ0KCX0NCgllbHNlIGlmKG9wZW5lciAmJiBvcGVuZXIudG9wLnJlZnJlc2hOYXYpDQoJew0KCQlvcGVuZXIudG9wLnJlZnJlc2hOYXYoKTsNCgl9DQp9DQoNCmZ1bmN0aW9uIGRpc2FibGVLZXlFdmVudEV4Y2VwdFNwYWNlKCkNCnsNCglpZiAod2luZG93LmV2ZW50LmtleUNvZGUgIT0gMzIpDQoJew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCQ0KfQ0KDQovLz09PT09PT09PT09PT09YWRkIGtleWJvcmQgc3VwcG9ydCBmb3IgbWVudWJhcj09PT09PT09PT09DQp2YXIgY3VycmVudFJvdyA9IDA7DQp2YXIgcm93T2JqOw0KZnVuY3Rpb24gTU1fb25LZXlEb3duKHByZVJvd0lkKXsJDQoJaG9sZERvY1VwRG93bktleSgpOw0KCXJvd09iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByZVJvd0lkICsgY3VycmVudFJvdyk7DQoJaWYoZXZlbnQua2V5Q29kZSA9PSAyNyB8fCBldmVudC5rZXlDb2RlID09IDkpDQoJew0KCQlpZihyb3dPYmopew0KCQkJb25Nb3VzZU91dChyb3dPYmopOw0KCQl9DQoJCXdpbmRvdy5mb2N1cygpOwkJDQoJCXBhcmVudC5NTV9oaWRlblBhbmVsKCk7DQoJCXJldHVybjsNCgl9CQ0KCQ0KCQ0KCWlmKHJvd09iaikNCgl7DQoJCW9uTW91c2VPdXQocm93T2JqKTsNCgl9DQoJaWYoZXZlbnQua2V5Q29kZT09MTMpey8vZW50ZXINCgkJcm93T2JqLmNsaWNrKCk7CQ0KCX0NCgkJCQ0KCQ0KCWlmKGV2ZW50LmtleUNvZGU9PTM4ICYmIGN1cnJlbnRSb3c+MCl7Ly91cA0KCQljdXJyZW50Um93LS07CQ0KCQlyb3dPYmogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwcmVSb3dJZCArIGN1cnJlbnRSb3cpOw0KCQlpZighcm93T2JqKQ0KCQl7DQoJCQljdXJyZW50Um93Kys7DQoJCX0JCQkNCgl9DQoJZWxzZSBpZihldmVudC5rZXlDb2RlPT00MCkNCgl7DQoJCWN1cnJlbnRSb3crKzsJDQoJCXJvd09iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByZVJvd0lkICsgY3VycmVudFJvdyk7DQoJCWlmKCFyb3dPYmopDQoJCXsNCgkJCWN1cnJlbnRSb3ctLTsNCgkJfQkJCQkJDQoJfQkNCgkNCgkNCglyb3dPYmogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwcmVSb3dJZCArIGN1cnJlbnRSb3cpOw0KCWlmKHJvd09iaikNCgl7DQoJCW9uTW91c2VPdmVyKHJvd09iaik7DQoJCXRyeXsNCgkJCXJvd09iai5mb2N1cygpOw0KCQl9Y2F0Y2goZSl7DQoJCX0NCgl9CQ0KfQ0KDQpmdW5jdGlvbiBob2xkRG9jVXBEb3duS2V5KCkNCnsNCgl2YXIga2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7DQoJDQoJaWYgKGtleUNvZGUgPT0gNDAgfHwga2V5Q29kZSA9PSAzOCkNCgl7DQoJCXZhciBwYXJlbnREb2MgPSBkb2N1bWVudC5wYXJlbnRXaW5kb3cuZG9jdW1lbnQ7DQoJCWFkZEV2ZW50KHBhcmVudERvYywgImtleWRvd24iLCByZXR1cm5GYWxzZSk7DQoJCWFkZEV2ZW50KHBhcmVudERvYywgImtleXVwIiwgcmVtb3ZlUmV0dXJuRmFsc2UpOw0KCX0NCn0NCg0KZnVuY3Rpb24gcmV0dXJuRmFsc2UoKQ0Kew0KCXJldHVybiBmYWxzZTsNCn0NCg0KZnVuY3Rpb24gcmVtb3ZlUmV0dXJuRmFsc2UoKQ0Kew0KCXZhciBwYXJlbnREb2MgPSBkb2N1bWVudC5wYXJlbnRXaW5kb3cuZG9jdW1lbnQ7DQoJcmVtb3ZlRXZlbnQocGFyZW50RG9jLCAia2V5ZG93biIsIHJldHVybkZhbHNlKTsNCn0NCg0KZnVuY3Rpb24gTU1fZmlyc3RGb2N1cyhwcmVSb3dJZCxzZXRSb3cpewkNCgljdXJyZW50Um93ID0gc2V0Um93Ow0KCXJvd09iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByZVJvd0lkK3NldFJvdyk7DQoJb25Nb3VzZU92ZXIocm93T2JqKTsNCglyb3dPYmouZm9jdXMoKTsJDQp9DQoNCmZ1bmN0aW9uIHJlbW92ZUV2ZW50KG9iaixldmVudE5hbWUsZnVuYyl7DQoJaWYoZG9jdW1lbnQuYXR0YWNoRXZlbnQpDQoJew0KCQlvYmouZGV0YWNoRXZlbnQoIm9uIitldmVudE5hbWUsZnVuYyk7DQoJfQ0KCWVsc2UNCgl7DQoJCW9iai5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSxmdW5jLGZhbHNlKTsNCgl9DQp9DQoNCmZ1bmN0aW9uIGhhbmRsZUVycm9yKCkNCnsJDQoJYXJnbGVuID0gYXJndW1lbnRzLmxlbmd0aDsNCgl2YXIgZXJyb3JNc2cgPSAiOiIrYXJnbGVuOw0KCWZvcih2YXIgaSA9IDA7aSA8IGFyZ2xlbjtpKyspDQoJew0KCSAgIGVycm9yTXNnICs9IGFyZ3VtZW50c1tpXTsNCgl9DQoJDQoJaWYoZXJyb3JNc2cudG9Mb3dlckNhc2UoKS5pbmRleE9mKCd1bnNwZWNpZmllZCBlcnJvcicpID49IDApDQoJew0KCQl3aW5kb3cuZXZlbnQucmV0dXJuVmFsdWUgPSB0cnVlOw0KCX0NCgllbHNlDQoJew0KCQl3aW5kb3cuZXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTsNCgl9DQp9IA0KDQpmdW5jdGlvbiBzaG93RU1TRU1lc3NhZ2UobW9kdWxlKQ0Kew0KCXZhciB1cmwgPSAiL3BvcnRsZXRzL2NhcC9mb3JtQWpheFV0aWwuZG8/bW9kZT1nZXRFTVNFUmVzdWx0Jm1vZHVsZT0iICsgbW9kdWxlOw0KCWRvam8uaW8uYmluZCh7IA0KCQl1cmw6dXJsLCANCgkJbWV0aG9kOiJHRVQiLA0KCQlsb2FkOmZ1bmN0aW9uKHR5cGUsZGF0YSxldnQpIHsNCgkJICAgIHZhciBqc29uID0gZXZhbCgnKCcrZGF0YSsnKScpDQoJCSAgICB2YXIgbWVzc2FnZXMgPSBqc29uLm1lc3NhZ2VzOw0KCQkgICAgaWYgKG1lc3NhZ2VzKQ0KCQkgICAgew0KCQkJICAgIHZhciByZXBvcnRNZXNzYWdlID0ganNvbi5yZXBvcnRNZXNzYWdlOw0KCQkJICAgIGlmIChyZXBvcnRNZXNzYWdlKQ0KCQkJICAgIHsNCgkJCQkgICAgdmFyIG1heCA9IGpzb24ubWF4Ow0KCQkJCSAgICB2YXIgcnRuTXNnQXJyYXkgPSBqc29uLnJ0bk1zZ0FycmF5Ow0KCQkJCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJ0bk1zZ0FycmF5Lmxlbmd0aDsgaSsrKQ0KCQkJCSAgICB7DQoJCQkJCSAgICBpZiAocnRuTXNnQXJyYXkubGVuZ3RoID49IG1heCkNCgkJCQkJICAgIHsNCgkJCQkJCSAgICANCgkJCQkJICAgIH0NCgkJCQkJICAgIGVsc2UNCgkJCQkJICAgIHsNCgkJCQkJICAgIAl2YXIgcmVNZXNzYWdlID0ganNvbi5wcmVmaXhVcmwgKyBydG5Nc2dBcnJheVtpXTsNCgkJCQkJIAkJaWYoZ2V0RGlyZWN0aW9uKCkpDQoJCQkJCQkgCXsNCgkJCQkJIAkJCXdpbmRvdy5vcGVuKHJlTWVzc2FnZSwiX2JsYW5rIiwid2lkdGg9NTUwLGhlaWdodD00MzAsc2Nyb2xsYmFycz15ZXMscmVzaXphYmxlPXllcyx0b29sYmFyPW5vLHRvcD0xMCxzdGF0dXM9bm8sbWVudWJhcj1ubyxsZWZ0PSIrZ2V0U2NyZWVuTGVmdCgxMCw1NTApKTsJCQ0KCQkJCQkJCX0NCgkJCQkJCQllbHNlDQoJCQkJCQkJew0KCQkJCQkJCQl3aW5kb3cub3BlbihyZU1lc3NhZ2UsIl9ibGFuayIsIndpZHRoPTU1MCxoZWlnaHQ9NDMwLHNjcm9sbGJhcnM9eWVzLHJlc2l6YWJsZT15ZXMsdG9vbGJhcj1ubyx0b3A9MTAsbGVmdD0xMCxzdGF0dXM9bm8sbWVudWJhcj1ubyIpOwkJDQoJCQkJCQkJfQ0KCQkJCQkgICAgfQ0KCQkJCSAgICB9DQoJCQkJICAgIHZhciB1cmxDb2wgPSBqc29uLnVybENvbDsNCgkJCQkgICAgaWYgKHVybENvbCAmJiB1cmxDb2wubGVuZ3RoID4gMCkNCgkJCQkgICAgew0KCQkJCSAgICAJd2luZG93Lm9wZW4oanNvbi5wYWdlVXJsLCJfYmxhbmsiLCJ3aWR0aD04MDAsaGVpZ2h0PTYwMCxzY3JvbGxiYXJzPXllcyxyZXNpemFibGU9eWVzLHRvb2xiYXI9bm8sdG9wPTEwLGxlZnQ9MTAsc3RhdHVzPW5vLG1lbnViYXI9bm8iKTsNCgkJCQkgICAgfQ0KCQkJICAgIH0NCg0KCQkJICAgIGlmICgocmVwb3J0TWVzc2FnZSAmJiBtZXNzYWdlcyA+IDEpIHx8ICghcmVwb3J0TWVzc2FnZSAmJiBtZXNzYWdlcyA+IDApKQ0KCQkJICAgIHsNCgkJCSAgICAJaWYoZ2V0RGlyZWN0aW9uKCkpDQoJCQkJCXsNCgkJCQkJCXdpbmRvdy5vcGVuKGpzb24uZW1zZVVybCwiX2JsYW5rIiwid2lkdGg9NTUwLGhlaWdodD00MzAsc2Nyb2xsYmFycz15ZXMscmVzaXphYmxlPXllcyx0b29sYmFyPW5vLHRvcD0xMCxzdGF0dXM9bm8sbWVudWJhcj1ubyxsZWZ0PSIrZ2V0U2NyZWVuTGVmdCgxMCw1NTApKTsNCgkJCQkJfQ0KCQkJCQllbHNlDQoJCQkJCXsNCgkJCQkJCXdpbmRvdy5vcGVuKGpzb24uZW1zZVVybCwiX2JsYW5rIiwid2lkdGg9NTUwLGhlaWdodD00MzAsc2Nyb2xsYmFycz15ZXMscmVzaXphYmxlPXllcyx0b29sYmFyPW5vLHRvcD0xMCxsZWZ0PTEwLHN0YXR1cz1ubyxtZW51YmFyPW5vIik7DQoJCQkJCX0NCgkJCSAgICB9DQoJCSAgICB9DQoJCX0sIA0KCQllcnJvcjpmdW5jdGlvbih0eXBlLGVycm9yKSB7fSwgDQoJICAgIHRpbWVvdXQ6ZnVuY3Rpb24gKHR5cGUpIHt9LA0KCQltaW1ldHlwZToidGV4dC9wbGFpbiIgDQoJfSk7DQp9DQoNCmZ1bmN0aW9uIHNraXBUb1BhZ2VzKGluZGV4LCBtYXhQYWdlcykNCnsNCglpZihpbmRleC52YWx1ZSA8IDEpDQoJew0KCQlpbmRleC52YWx1ZSA9IDE7DQoJfQ0KCWVsc2UgaWYoaW5kZXgudmFsdWUgPiBtYXhQYWdlcykNCgl7DQoJCWluZGV4LnZhbHVlID0gbWF4UGFnZXM7DQoJfQ0KCQ0KCXZhciBza2lwTGluayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlLW5hdmlnYXRpb24nKTsNCgkNCglpZihza2lwTGluaykNCgl7DQoJCXZhciBza2lwTGlua1VybCA9IHNraXBMaW5rLmhyZWY7DQoJCWlmKHNraXBMaW5rVXJsICYmIHNraXBMaW5rVXJsLmluZGV4T2YoInBhZ2U9QEAjI0BAIikgPiAwKQ0KCQl7DQoJCQl2YXIgbmV3VVJMID0gc2tpcExpbmtVcmwucmVwbGFjZSgicGFnZT1AQCMjQEAiLCAicGFnZT0iKyBpbmRleC52YWx1ZSk7DQoJCQlza2lwTGluay5ocmVmID0gbmV3VVJMOyANCgkJfQ0KCQlza2lwTGluay5jbGljaygpOw0KCX0NCgl2YXIgZXZlbnRPYmogPSBBYzM2MC5nZXRFdmVudCgpOw0KCXNldENhbmNlbEJ1YmJsZVRydWUoZXZlbnRPYmopOw0KCWlmKGV2ZW50T2JqLnByZXZlbnREZWZhdWx0KQ0KCXsNCgkJZXZlbnRPYmoucHJldmVudERlZmF1bHQoKTsNCgl9DQoJZWxzZQ0KCXsNCgkJZXZlbnRPYmoucmV0dXJuVmFsdWUgPSBmYWxzZTsgDQoJfQ0KfQ0KDQpmdW5jdGlvbiBvbmx5TnVtKCkgew0KCXZhciBldmVudCA9IEFjMzYwLmdldEV2ZW50KCk7DQoJaWYoZXZlbnQua2V5Q29kZSAhPSAxMyAmJiBldmVudC5rZXlDb2RlICE9IDkpDQoJew0KCSAgICBpZighKGV2ZW50LmtleUNvZGU9PTQ2KSYmIShldmVudC5rZXlDb2RlPT04KSYmIShldmVudC5rZXlDb2RlPT0zNykmJiEoZXZlbnQua2V5Q29kZT09MzkpKQ0KCSAgICB7DQoJCSAgICBpZighKChldmVudC5rZXlDb2RlPj00OCYmZXZlbnQua2V5Q29kZTw9NTcpfHwoZXZlbnQua2V5Q29kZT49OTYmJmV2ZW50LmtleUNvZGU8PTEwNSkpKQ0KCQkgICAgew0KCQkgICAgCWlmKGV2ZW50LnByZXZlbnREZWZhdWx0KQ0KCQkgICAgCXsNCgkJICAgIAkJZXZlbnQucHJldmVudERlZmF1bHQoKTsNCgkJICAgIAl9DQoJCSAgICAJZWxzZQ0KCQkgICAgCXsNCgkJICAgIAkJZXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTsgDQoJCSAgICAJfQ0KCQkgICAgfQ0KCSAgICB9DQoJfQ0KfSANCg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>