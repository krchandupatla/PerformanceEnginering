<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="191">
  <HTTPTask id="960" hostname="aa-pt6245.dev.accela.com:5443" path="https://aa-pt6245.dev.accela.com:5443/portlets/framework/includes/javascript/widget/widget.js" url="https://aa-pt6245.dev.accela.com:5443/portlets/framework/includes/javascript/widget/widget.js" ip="13.93.163.237" port="5443" connectionId="193" origin="Primary" frame="1" startDateTime="2017-08-28T11:20:15.077-07:00" startTime="1029847843" endTime="1029847843">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Accept" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdCwgKi8qO3E9MC44</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9hZGRyZXNzL3JlZkFkZHJlc3NMaXN0LmRvP21vZGU9U2VhcmNo</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SlNFU1NJT05JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IF9fY2ZkdWlkPWRiNjBkNWU3ODRkYmRlN2NhNTlkZGVjNmUzYWNkYzk2MjE1MDI0MzA3NzM7IF9wZW5kb19hY2NvdW50SWQuNTY3YTE0NmUtNjVhYy00NmE1LTdhMTMtYjMyNDc0YTRmNjdiPUZMQUdTVEFGRjsgX3BlbmRvX3Zpc2l0b3JJZC41NjdhMTQ2ZS02NWFjLTQ2YTUtN2ExMy1iMzI0NzRhNGY2N2I9ZTlhZjFmYTUxNzFhZWQwYWRiZWUwMDI4NGE0NTUwODY0NjVhYTMxZmMzNjU2M2VkYWJmNjQ2ZTExZDU1YTYwODgwOTVhMjNlZmVlZTBjYTU2NzAzZDEwOTY5ZDNhYzU0ZTk3OWFiMjExODkyZWU1NmRlZmM5MWM0Njg0NzZhMDg7IF9wZW5kb19tZXRhLjU2N2ExNDZlLTY1YWMtNDZhNS03YTEzLWIzMjQ3NGE0ZjY3Yj0zMzk5OTk2NjE3OyBKU0VTU0lPTklEPSoqKioqKioqKioqKioqKioqKioqKioqKioqKjsgMDEtSmFuLTE5NzAgMDA6MDA6MTAgR01UOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ0MDQ4MDkyOyBob3N0U2lnbk9uPXRydWU7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM7IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBMQVRFU1RfU0VTU0lPTl9JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IEFDQXV0aD05OTE4NDQ3MDE1MDc4ODU2NDY0OTU2OTM1NDI5Mzg5NDYxOTQwOTc2MzMxNDg2MDc5NjMzMzEzMjIxMjYwMTIwNTMzODE2NTYwOTUyODc4MTk3OTA1MTQxMDUxODg5NjE2OTAyMjc5Mzc3ODg0NzYxOTY1Nzk1ODgzNzY5NjMyMjsgQUNTaWduT25Nb2R1bGU9U1NPU3RhbmRhcmQ7IEFBUGVyc2lzdExvZ2luU2VydlByb3ZDb2RlPUZMQUdTVEFGRjsgTG9naW5TZXJ2UHJvdkNvZGU0TXVsdGlBZ2VuY3k9RkxBR1NUQUZGOyBMb2dpblVzZXJuYW1lNE11bHRpQWdlbmN5PTE3OUREMTNBMTg2MDI4RjQ7IEFDU2lnbm9mZj0iaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zZWN1cml0eS9zaWdub3V0LmRvIjsgQUNTd2l0Y2hBZ2VuY3k9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Q2xvc2U=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIGh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvZnJhbWV3b3JrL2luY2x1ZGVzL2phdmFzY3JpcHQvd2lkZ2V0L3dpZGdldC5qcyBIVFRQLzEuMQ0KQWNjZXB0OiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCAqLyo7cT0wLjgNClJlZmVyZXI6IGh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvYWRkcmVzcy9yZWZBZGRyZXNzTGlzdC5kbz9tb2RlPVNlYXJjaA0KQWNjZXB0LUxhbmd1YWdlOiBlbi1VUw0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvDQpBY2NlcHQtRW5jb2Rpbmc6IGd6aXAsIGRlZmxhdGUNCkNvb2tpZTogSlNFU1NJT05JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IF9fY2ZkdWlkPWRiNjBkNWU3ODRkYmRlN2NhNTlkZGVjNmUzYWNkYzk2MjE1MDI0MzA3NzM7IF9wZW5kb19hY2NvdW50SWQuNTY3YTE0NmUtNjVhYy00NmE1LTdhMTMtYjMyNDc0YTRmNjdiPUZMQUdTVEFGRjsgX3BlbmRvX3Zpc2l0b3JJZC41NjdhMTQ2ZS02NWFjLTQ2YTUtN2ExMy1iMzI0NzRhNGY2N2I9ZTlhZjFmYTUxNzFhZWQwYWRiZWUwMDI4NGE0NTUwODY0NjVhYTMxZmMzNjU2M2VkYWJmNjQ2ZTExZDU1YTYwODgwOTVhMjNlZmVlZTBjYTU2NzAzZDEwOTY5ZDNhYzU0ZTk3OWFiMjExODkyZWU1NmRlZmM5MWM0Njg0NzZhMDg7IF9wZW5kb19tZXRhLjU2N2ExNDZlLTY1YWMtNDZhNS03YTEzLWIzMjQ3NGE0ZjY3Yj0zMzk5OTk2NjE3OyBKU0VTU0lPTklEPSoqKioqKioqKioqKioqKioqKioqKioqKioqKjsgMDEtSmFuLTE5NzAgMDA6MDA6MTAgR01UOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ0MDQ4MDkyOyBob3N0U2lnbk9uPXRydWU7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM7IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBMQVRFU1RfU0VTU0lPTl9JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IEFDQXV0aD05OTE4NDQ3MDE1MDc4ODU2NDY0OTU2OTM1NDI5Mzg5NDYxOTQwOTc2MzMxNDg2MDc5NjMzMzEzMjIxMjYwMTIwNTMzODE2NTYwOTUyODc4MTk3OTA1MTQxMDUxODg5NjE2OTAyMjc5Mzc3ODg0NzYxOTY1Nzk1ODgzNzY5NjMyMjsgQUNTaWduT25Nb2R1bGU9U1NPU3RhbmRhcmQ7IEFBUGVyc2lzdExvZ2luU2VydlByb3ZDb2RlPUZMQUdTVEFGRjsgTG9naW5TZXJ2UHJvdkNvZGU0TXVsdGlBZ2VuY3k9RkxBR1NUQUZGOyBMb2dpblVzZXJuYW1lNE11bHRpQWdlbmN5PTE3OUREMTNBMTg2MDI4RjQ7IEFDU2lnbm9mZj0iaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zZWN1cml0eS9zaWdub3V0LmRvIjsgQUNTd2l0Y2hBZ2VuY3k9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg0KSG9zdDogYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMNCkNvbm5lY3Rpb246IENsb3NlDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="JSESSIONID" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>T0kreDBoZEowUHYxWitLaDVGbDFiVnZY</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="__cfduid" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZGI2MGQ1ZTc4NGRiZGU3Y2E1OWRkZWM2ZTNhY2RjOTYyMTUwMjQzMDc3Mw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="_pendo_accountId.567a146e-65ac-46a5-7a13-b32474a4f67b" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="_pendo_visitorId.567a146e-65ac-46a5-7a13-b32474a4f67b" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZTlhZjFmYTUxNzFhZWQwYWRiZWUwMDI4NGE0NTUwODY0NjVhYTMxZmMzNjU2M2VkYWJmNjQ2ZTExZDU1YTYwODgwOTVhMjNlZmVlZTBjYTU2NzAzZDEwOTY5ZDNhYzU0ZTk3OWFiMjExODkyZWU1NmRlZmM5MWM0Njg0NzZhMDg=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="_pendo_meta.567a146e-65ac-46a5-7a13-b32474a4f67b" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MzM5OTk5NjYxNw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="JSESSIONID" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>KioqKioqKioqKioqKioqKioqKioqKioqKioq</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="01-Jan-1970 00:00:10 GMT; LASTEST_REQUEST_TIME" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTUwMzk0NDA0ODA5Mg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="hostSignOn" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="g_current_language_ext" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW5fVVM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_WEB_SERVER" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTAuMS4wLjY=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_SESSION_ID" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>T0kreDBoZEowUHYxWitLaDVGbDFiVnZY</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACAuth" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>OTkxODQ0NzAxNTA3ODg1NjQ2NDk1NjkzNTQyOTM4OTQ2MTk0MDk3NjMzMTQ4NjA3OTYzMzMxMzIyMTI2MDEyMDUzMzgxNjU2MDk1Mjg3ODE5NzkwNTE0MTA1MTg4OTYxNjkwMjI3OTM3Nzg4NDc2MTk2NTc5NTg4Mzc2OTYzMjI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignOnModule" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U1NPU3RhbmRhcmQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="AAPersistLoginServProvCode" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginServProvCode4MultiAgency" index="14">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginUsername4MultiAgency" index="15">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTc5REQxM0ExODYwMjhGNA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignoff" index="16">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvc2VjdXJpdHkvc2lnbm91dC5kbyI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSwitchAgency" index="17">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLUNveW90ZS8xLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHJpdmF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Expires" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBVVEM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-XSS-Protection" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NDA0ODQ5ODsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZSxMQVRFU1RfV0VCX1NFUlZFUj0xMC4xLjAuNjsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZSxMQVRFU1RfU0VTU0lPTl9JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Vy8iMjE3NDA3LTE0OTg3NDcxNDAwMDAi</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAyOSBKdW4gMjAxNyAxNDozOTowMCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyOCBBdWcgMjAxNyAxODoxNDowNyBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y2xvc2U=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IEFwYWNoZS1Db3lvdGUvMS4xDQpDYWNoZS1Db250cm9sOiBwcml2YXRlDQpFeHBpcmVzOiBUaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIFVUQw0KWC1YU1MtUHJvdGVjdGlvbjogMA0KU2V0LUNvb2tpZTogTEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NDA0ODQ5ODsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZSxMQVRFU1RfV0VCX1NFUlZFUj0xMC4xLjAuNjsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZSxMQVRFU1RfU0VTU0lPTl9JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpFVGFnOiBXLyIyMTc0MDctMTQ5ODc0NzE0MDAwMCINCkxhc3QtTW9kaWZpZWQ6IFRodSwgMjkgSnVuIDIwMTcgMTQ6Mzk6MDAgR01UDQpDb250ZW50LVR5cGU6IHRleHQvamF2YXNjcmlwdA0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KVmFyeTogQWNjZXB0LUVuY29kaW5nDQpEYXRlOiBNb24sIDI4IEF1ZyAyMDE3IDE4OjE0OjA3IEdNVA0KQ29ubmVjdGlvbjogY2xvc2UNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>LyoqDQoNCiAqIA0KDQogKiBWMzYwCSANCg0KICogRmlsZTogV2lkZ2V0RmFjb3RyeS5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuDQoNCiAqIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246DQoNCiAqIDw8R2VuZXJhbCBkZXNjcmlwdGlvbiBvZiB0aGUgY2xhc3M+Pg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKg0KDQogKi8NCg0KDQp2YXIgV2lkZ2V0TWFuYWdlciA9IHsNCg0KCXdpZGdldE1hcCA6IG5ldyBPYmplY3QoKSwNCg0KCQ0KDQoJZ2V0V2lkZ2V0IDogZnVuY3Rpb24od2lkZ2V0TmFtZSl7DQoNCgkJaWYod2lkZ2V0TmFtZSAmJiB0aGlzLndpZGdldE1hcFt3aWRnZXROYW1lXSkNCg0KCQkgICByZXR1cm4gbmV3IHRoaXMud2lkZ2V0TWFwW3dpZGdldE5hbWVdKCk7DQoNCgl9LA0KDQoJDQoNCglyZWdpc3RlcldpZGdldCA6IGZ1bmN0aW9uKHdpZGdldE5hbWUsd2lkZ2V0Q2xhc3Mpew0KDQoJCWlmKHdpZGdldE5hbWUpDQoNCgkJCXRoaXMud2lkZ2V0TWFwW3dpZGdldE5hbWVdID0gd2lkZ2V0Q2xhc3M7DQoNCgl9DQoNCn0vKioNCg0KICogDQoNCiAqIFYzNjAJIA0KDQogKiBGaWxlOiB2YWxpZGF0ZUVtYWlsLmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjoNCg0KICogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczoNCg0KICogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKiBSZXZpc2lvbiBIaXN0b3J5Og0KDQogKiA8PERhdGU+PiwgPDxXaG8+PiwgPDxXaGF0Pj4NCg0KICogMTIvMDMvMjAxMiwgVG9ueSBMaSwgSW5pdGlhbCB2ZXJzaW9uDQoNCiAqDQoNCiAqLw0KDQogICAgZnVuY3Rpb24gY2hlY2tFbWFpbChlbWFpbFN0cikgew0KDQogICAgICAgIGlmIChlbWFpbFN0ci5sZW5ndGggPT0gMCkgew0KDQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgLy8gVExEIGNoZWNraW5nIHR1cm5lZCBvZmYgYnkgZGVmYXVsdA0KDQogICAgICAgIHZhciBjaGVja1RMRD0wOw0KDQogICAgICAgIHZhciBrbm93bkRvbXNQYXQ9L14oY29tfG5ldHxvcmd8ZWR1fGludHxtaWx8Z292fGFycGF8Yml6fGFlcm98bmFtZXxjb29wfGluZm98cHJvfG11c2V1bSkkLzsNCg0KICAgICAgICB2YXIgZW1haWxQYXQ9L14oLispQCguKykkLzsNCg0KICAgICAgICB2YXIgc3BlY2lhbENoYXJzPSJcXChcXCk+PEAsOzpcXFxcXFxcIlxcLlxcW1xcXSI7DQoNCiAgICAgICAgdmFyIHZhbGlkQ2hhcnM9IlxbXlxccyIgKyBzcGVjaWFsQ2hhcnMgKyAiXF0iOw0KDQogICAgICAgIHZhciBxdW90ZWRVc2VyPSIoXCJbXlwiXSpcIikiOw0KDQogICAgICAgIHZhciBpcERvbWFpblBhdD0vXlxbKFxkezEsM30pXC4oXGR7MSwzfSlcLihcZHsxLDN9KVwuKFxkezEsM30pXF0kLzsNCg0KICAgICAgICB2YXIgYXRvbT12YWxpZENoYXJzICsgJysnOw0KDQogICAgICAgIHZhciB3b3JkPSIoIiArIGF0b20gKyAifCIgKyBxdW90ZWRVc2VyICsgIikiOw0KDQogICAgICAgIHZhciB1c2VyUGF0PW5ldyBSZWdFeHAoIl4iICsgd29yZCArICIoXFwuIiArIHdvcmQgKyAiKSokIik7DQoNCiAgICAgICAgdmFyIGRvbWFpblBhdD1uZXcgUmVnRXhwKCJeIiArIGF0b20gKyAiKFxcLiIgKyBhdG9tICsiKSokIik7DQoNCiAgICAgICAgdmFyIG1hdGNoQXJyYXk9ZW1haWxTdHIubWF0Y2goZW1haWxQYXQpOw0KDQogICAgICAgIGlmIChtYXRjaEFycmF5PT1udWxsKSB7DQoNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIHVzZXI9bWF0Y2hBcnJheVsxXTsNCg0KICAgICAgICB2YXIgZG9tYWluPW1hdGNoQXJyYXlbMl07DQoNCiAgICAgICAgZm9yIChpPTA7IGk8dXNlci5sZW5ndGg7IGkrKykgew0KDQogICAgICAgICAgICBpZiAodXNlci5jaGFyQ29kZUF0KGkpPjEyNykgew0KDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAoaT0wOyBpPGRvbWFpbi5sZW5ndGg7IGkrKykgew0KDQogICAgICAgICAgICBpZiAoZG9tYWluLmNoYXJDb2RlQXQoaSk+MTI3KSB7DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHVzZXIubWF0Y2godXNlclBhdCk9PW51bGwpIHsNCg0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgIH0NCg0KICAgICAgICB2YXIgSVBBcnJheT1kb21haW4ubWF0Y2goaXBEb21haW5QYXQpOw0KDQogICAgICAgIGlmIChJUEFycmF5IT1udWxsKSB7DQoNCiAgICAgICAgICAgIGZvciAodmFyIGk9MTtpPD00O2krKykgew0KDQogICAgICAgICAgICAgICAgaWYgKElQQXJyYXlbaV0+MjU1KSB7DQoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KDQogICAgICAgIH0NCg0KICAgICAgICB2YXIgYXRvbVBhdD1uZXcgUmVnRXhwKCJeIiArIGF0b20gKyAiJCIpOw0KDQogICAgICAgIHZhciBkb21BcnI9ZG9tYWluLnNwbGl0KCIuIik7DQoNCiAgICAgICAgdmFyIGxlbj1kb21BcnIubGVuZ3RoOw0KDQogICAgICAgIGZvciAoaT0wO2k8bGVuO2krKykgew0KDQogICAgICAgICAgICBpZiAoZG9tQXJyW2ldLnNlYXJjaChhdG9tUGF0KT09LTEpIHsNCg0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoY2hlY2tUTEQgJiYgZG9tQXJyW2RvbUFyci5sZW5ndGgtMV0ubGVuZ3RoIT0yICYmIA0KDQogICAgICAgICAgICBkb21BcnJbZG9tQXJyLmxlbmd0aC0xXS5zZWFyY2goa25vd25Eb21zUGF0KT09LTEpIHsNCg0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgIH0NCg0KICAgICAgICBpZiAobGVuPDIpIHsNCg0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgIH1hdiA9IHt9Ow0KDQphdi52YWxpZGF0aW9uID0ge307DQoNCmF2LnZhbGlkYXRpb24uTWFuYWdlciA9IGZ1bmN0aW9uKCkgew0KDQogICAgdmFyIGFsbE5hbWVzID0gW107DQoNCiAgICB2YXIgYWxsVmFsaWRhdG9ycyA9IFtdOw0KDQogICAgdGhpcy5hdHRhY2ggPSBmdW5jdGlvbihlbCkgew0KDQogICAgICAgIGlmIChlbC5fYXR0YWNoZWQpDQoNCiAgICAgICAgICAgIHJldHVybjsNCg0KDQogICAgICAgIHZhciB2YWxpZGF0b3JDZmcgPSBlbC5nZXRBdHRyaWJ1dGUoImRhdGEtcnVsZSIpOw0KDQogICAgICAgIGlmICghdmFsaWRhdG9yQ2ZnKQ0KDQogICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgdmFyIGFyclZhbGlkYXRvciA9IHZhbGlkYXRvckNmZy5zcGxpdCgiOyIpLCBydWxlU3RyOw0KDQogICAgICAgIGVsLnZhbGlkYXRvcnMgPSBbXTsNCg0KICAgICAgICBmb3IgKHZhciBpID0gMCwgY250ID0gYXJyVmFsaWRhdG9yLmxlbmd0aDsgaSA8IGNudDsgaSsrKSB7DQoNCiAgICAgICAgICAgIHJ1bGVTdHIgPSBhcnJWYWxpZGF0b3JbaV07DQoNCiAgICAgICAgICAgIGlmICghcnVsZVN0cikNCg0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQogICAgICAgICAgICB2YXIgdmFsaWRhdG9yID0gdGhpcy5fcGFyc2VWYWxpZGF0b3IocnVsZVN0cik7DQoNCiAgICAgICAgICAgIGlmICh2YWxpZGF0b3IpIHsNCg0KICAgICAgICAgICAgICAgIGVsLnZhbGlkYXRvcnMucHVzaCh2YWxpZGF0b3IpOw0KDQogICAgICAgICAgICAgICAgdmFyIHZhbGlkYXRlT2JqID0gdmFsaWRhdG9yLnZhbGlkYXRvcjsNCg0KICAgICAgICAgICAgICAgIGlmICh2YWxpZGF0ZU9iai5vbkF0dGFjaCkgew0KDQogICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlT2JqLm9uQXR0YWNoKGVsKTsNCg0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZWwudmFsaWRhdG9ycy5sZW5ndGggPiAwKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgQWMzNjAuYXR0YWNoRXZlbnQoZWwsIm9uYmx1ciIsIHRoaXMuZG9CbHVyKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICBBYzM2MC5hdHRhY2hFdmVudChlbCwib25rZXlwcmVzcyIsIHRoaXMuZG9LZXlwcmVzcyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgQWMzNjAuYXR0YWNoRXZlbnQoZWwsIm9ua2V5ZG93biIsIGZ1bmN0aW9uKCkgew0KDQogICAgICAgICAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7DQoNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgIH0NCg0KICAgICAgICBlbC5fYXR0YWNoZWQgPSAxOw0KDQogICAgfTsNCg0KDQogICAgdGhpcy5fcGFyc2VWYWxpZGF0b3IgPSBmdW5jdGlvbih2YWxpZGF0b3JTdHIpIHsNCg0KICAgICAgICB2YXIgayA9IHZhbGlkYXRvclN0ci5pbmRleE9mKCIoIiksIG5hbWUsIHBhcmFtcyA9IG51bGw7DQoNCiAgICAgICAgaWYgKGsgPCAwKQ0KDQogICAgICAgICAgICBuYW1lID0gdmFsaWRhdG9yU3RyOw0KDQogICAgICAgIGVsc2Ugew0KDQogICAgICAgICAgICBuYW1lID0gdmFsaWRhdG9yU3RyLnN1YnN0cmluZygwLCBrKTsNCg0KICAgICAgICAgICAgcGFyYW1zID0gdmFsaWRhdG9yU3RyLnN1YnN0cmluZyhrICsgMSwgdmFsaWRhdG9yU3RyLmxlbmd0aCAtIDEpOw0KDQogICAgICAgICAgICBwYXJhbXMgPSAnWycgKyBwYXJhbXMgKyAnXSc7DQoNCiAgICAgICAgICAgIHBhcmFtcyA9IHdpbmRvdy5ldmFsKHBhcmFtcyk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciB2YWxpZGF0b3IgPSB0aGlzLmdldFZhbGlkYXRvcihuYW1lKTsNCg0KICAgICAgICByZXR1cm4gew0KDQogICAgICAgICAgICB2YWxpZGF0b3IgOiB2YWxpZGF0b3IsDQoNCiAgICAgICAgICAgIHBhcmFtcyA6IHBhcmFtcw0KDQogICAgICAgIH07DQoNCiAgICB9DQoNCg0KICAgIHRoaXMudmFsaWRhdGUgPSBmdW5jdGlvbihlbCkgew0KDQogICAgICAgIHZhciB2YWxpZGF0b3IsIGVycm9yTXNnID0gbnVsbCwgY3VyclZhbGlkYXRvciwgdmFsdWU7DQoNCiAgICAgICAgZWwgPSB3aW5kb3cuZXZlbnQuc3JjRWxlbWVudDsNCg0KICAgICAgICBmb3IgKCBpID0gMCwgY250ID0gZWwudmFsaWRhdG9ycy5sZW5ndGg7IGkgPCBjbnQ7IGkrKykgew0KDQogICAgICAgICAgICBjdXJyVmFsaWRhdG9yID0gZWwudmFsaWRhdG9yc1tpXTsNCg0KICAgICAgICAgICAgdmFsaWRhdG9yID0gY3VyclZhbGlkYXRvci52YWxpZGF0b3I7DQoNCiAgICAgICAgICAgIGlmICh2YWxpZGF0b3IudmFsaWRhdGVCbHVyKSB7DQoNCiAgICAgICAgICAgICAgICBpZiAodHJpbSkNCg0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRyaW0oZWwudmFsdWUpOw0KDQogICAgICAgICAgICAgICAgZWxzZSBpZiAoJCAmJiAkLnRyaW0pDQoNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAkLnRyaW0oZWwudmFsdWUpOw0KDQoNCiAgICAgICAgICAgICAgICBlcnJvck1zZyA9IHZhbGlkYXRvci52YWxpZGF0ZUJsdXIodmFsdWUsIGN1cnJWYWxpZGF0b3IucGFyYW1zLCBlbCk7DQoNCiAgICAgICAgICAgICAgICBpZiAoZXJyb3JNc2cpIHsNCg0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0NCg0KICAgIH0NCg0KICAgIHZhciBaID0gdGhpczsNCg0KDQogICAgdGhpcy5kb0JsdXIgPSBmdW5jdGlvbihldmVudCkgew0KDQogICAgICAgIFoudmFsaWRhdGUodGhpcyk7DQoNCiAgICB9Ow0KDQoNCiAgICB0aGlzLmRvS2V5cHJlc3MgPSBmdW5jdGlvbihldmVudCkgew0KDQoNCiAgICAgICAgdmFyIGV2ZW50ID0gQWMzNjAuZ2V0RXZlbnQoKSwga2V5Q29kZSA9ICgnd2hpY2gnIGluIGV2ZW50KSA/IGV2ZW50LndoaWNoIDogZXZlbnQua2V5Q29kZSwgYyA9IFN0cmluZy5mcm9tQ2hhckNvZGUoa2V5Q29kZSksIHYgPSB0aGlzLnZhbHVlICsgYywgdmFsaWRhdG9yLCBlbCA9IHRoaXMsIHJ1bGVzID0gW107DQoNCiAgICAgICAgdmFyIHNyY0VsZW1lbnQgPSBldmVudC5zcmNFbGVtZW50IHx8IGV2ZW50LnRhcmdldDsNCg0KICAgICAgICBmb3IgKCBpID0gMCwgY250ID0gc3JjRWxlbWVudC52YWxpZGF0b3JzLmxlbmd0aDsgaSA8IGNudDsgaSsrKSB7DQoNCiAgICAgICAgICAgIHZhbGlkYXRvciA9IHNyY0VsZW1lbnQudmFsaWRhdG9yc1tpXS52YWxpZGF0b3I7DQoNCiAgICAgICAgICAgIGlmICh2YWxpZGF0b3IudmFsaWRhdGVLZXlQcmVzcykgew0KDQogICAgICAgICAgICAgICAgcnVsZXMucHVzaCh2YWxpZGF0b3IpOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KDQogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgY250ID0gcnVsZXMubGVuZ3RoOyBpIDwgY250OyBpKyspIHsNCg0KICAgICAgICAgICAgICAgIHZhciBydWxlID0gcnVsZXNbaV07DQoNCiAgICAgICAgICAgICAgICBpZiAoIXJ1bGUudmFsaWRhdGVLZXlQcmVzcyhlbC52YWx1ZSwgYykpIHsNCg0KICAgICAgICAgICAgICAgICAgICBlbC52YWx1ZSA9IGVsLm9sZFZhbHVlOw0KDQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0sIDIwKTsNCg0KDQogICAgICAgIHJldHVybiB0cnVlOw0KDQogICAgfTsNCg0KDQogICAgdGhpcy5nZXRWYWxpZGF0b3IgPSBmdW5jdGlvbihuYW1lKSB7DQoNCiAgICAgICAgdmFyIGsgPSBBYzM2MC5pbmRleE9mQXJyYXkoYWxsTmFtZXMsIG5hbWUpOw0KDQogICAgICAgIHJldHVybiBrID49IDAgPyBhbGxWYWxpZGF0b3JzW2tdIDogbnVsbDsNCg0KICAgIH07DQoNCg0KICAgIHRoaXMucmVxaXN0ZXIgPSBmdW5jdGlvbihuYW1lLCB2YWxpZGF0b3IpIHsNCg0KICAgICAgICBhbGxOYW1lcy5wdXNoKG5hbWUpOw0KDQogICAgICAgIGFsbFZhbGlkYXRvcnMucHVzaCh2YWxpZGF0b3IpOw0KDQogICAgfTsNCg0KDQogICAgdGhpcy51bnJlZ2lzdGVyID0gZnVuY3Rpb24obmFtZSkgew0KDQogICAgICAgIHZhciBrID0gQWMzNjAuaW5kZXhPZkFycmF5KGFsbE5hbWVzLCBuYW1lKTsNCg0KICAgICAgICBpZiAoayA+PSAwKSB7DQoNCiAgICAgICAgICAgIGFsbE5hbWVzLnNwbGljZShrLCAxKTsNCg0KICAgICAgICAgICAgYWxsVmFsaWRhdG9ycy5zcGxpY2UoaywgMSk7DQoNCiAgICAgICAgfQ0KDQogICAgfTsNCg0KfTsNCg0KDQphdi52YWxpZGF0aW9uLmdsb2JhbCA9IG5ldyBhdi52YWxpZGF0aW9uLk1hbmFnZXIoKTsNCg0KDQovKioNCg0KICogYXR0YWNoIHZhbGlkYXRpb24gdG8gZWxlbWVudCBieSBjdXN0b21pemVkIGF0dHJpYnV0ZTp2YWxpYXRvcg0KDQogKi8NCg0KYXYudmFsaWRhdGlvbi5hdHRhY2ggPSBmdW5jdGlvbigpIHsNCg0KICAgIHZhciBlbEFyciA9IGpRdWVyeSgiW2RhdGEtcnVsZV0iKSwgZWw7DQoNCg0KICAgIGZvciAodmFyIGkgPSAwLCBjbnQgPSBlbEFyci5sZW5ndGg7IGkgPCBjbnQ7IGkrKykgew0KDQogICAgICAgIGVsID0gZWxBcnJbaV07DQoNCiAgICAgICAgYXYudmFsaWRhdGlvbi5nbG9iYWwuYXR0YWNoKGVsKTsNCg0KICAgIH0NCg0KfTsNCg0KDQphdi52YWxpZGF0aW9uLmF0dGFjaEJ5RWxlbWVudCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsNCg0KICAgIGF2LnZhbGlkYXRpb24uZ2xvYmFsLmF0dGFjaChlbGVtZW50KTsNCg0KfTsNCg0KDQphdi52YWxpZGF0aW9uLmF0dGFjaEJ5SWQgPSBmdW5jdGlvbihpZCkgew0KDQogICAgYXYudmFsaWRhdGlvbi5nbG9iYWwuYXR0YWNoKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSk7DQoNCn07DQoNCg0KYXYudmFsaWRhdGlvbi5jaGVja1ZhbGlkID0gZnVuY3Rpb24ocGFyZW50Tm9kZSwgY2hlY2tBbGwpIHsNCg0KICAgIHZhciBlbEFyciA9IGpRdWVyeShwYXJlbnROb2RlKS5maW5kKCJbZGF0YS1ydWxlXSIpLCBlbCwgZmxhZyA9IHRydWU7DQoNCiAgICBpZiAoY2hlY2tBbGwgPT09IHVuZGVmaW5lZCkNCg0KICAgICAgICBjaGVja0FsbCA9IHRydWU7DQoNCiAgICBmb3IgKHZhciBpID0gMCwgY250ID0gZWxBcnIubGVuZ3RoOyBpIDwgY250OyBpKyspIHsNCg0KICAgICAgICBlbCA9IGVsQXJyW2ldOw0KDQogICAgICAgIGlmICghZWwuX2F0dGFjaGVkKQ0KDQogICAgICAgICAgICBhdi52YWxpZGF0aW9uLmF0dGFjaEJ5RWxlbWVudChlbCk7DQoNCg0KICAgICAgICBpZiAoZWwuaW52YWxpZCA9PT0gdW5kZWZpbmVkKQ0KDQogICAgICAgICAgICBhdi52YWxpZGF0aW9uLmdsb2JhbC52YWxpZGF0ZShlbCk7DQoNCiAgICAgICAgaWYgKGVsLmludmFsaWQpIHsNCg0KICAgICAgICAgICAgZmxhZyA9IGZhbHNlOw0KDQogICAgICAgICAgICBpZiAoIWNoZWNrQWxsKQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuIGZsYWcNCg0KICAgICAgICB9DQoNCiAgICB9DQoNCiAgICByZXR1cm4gZmxhZzsNCg0KfQ0KDQoNCmF2LnV0aWwgPSB7fTsNCg0KYXYudXRpbC5jaGVja3JlZ2V4ID0gZnVuY3Rpb24ocGF0dGVybiwgdmFsdWUpIHsNCg0KICAgIGlmICghdmFsdWUgfHwgdmFsdWUubGVuZ3RoID09IDApDQoNCiAgICAgICAgcmV0dXJuIHRydWU7DQoNCg0KICAgIHJldHVybiBwYXR0ZXJuLnRlc3QodmFsdWUpOw0KDQp9Ow0KDQoNCi8qKioNCg0KICogQWxsIFZhbGlkYXRvcg0KDQogKi8NCg0KDQphdi52YWxpZGF0aW9uLnBhdHRlcm5zID0ge307DQoNCmF2LnZhbGlkYXRpb24ucGF0dGVybnMuSU5UID0gL14tP1sxLTldWzAtOV0qJC87DQoNCmF2LnZhbGlkYXRpb24ucGF0dGVybnMuRkxPQVQgPSAvXi0/WzEtOV1bMC05XSooXC5bMC05XSopPyQvOw0KDQphdi52YWxpZGF0aW9uLnBhdHRlcm5zLkVNQUlMID0gL15bYS16QS1aXzAtOS0nXCt+XSsoXC5bYS16QS1aXzAtOS0nXCt+XSspKkAoW2EtekEtWl8wLTktXStcLikrW2EtekEtWl17Miw3fSQvOw0KDQphdi52YWxpZGF0aW9uLnBhdHRlcm5zLlVSTCA9IC9eKChodHRwfGh0dHBzfGZ0cHxmaWxlKVw6XC9cLyhbYS16QS1aMC0wXSo6W2EtekEtWjAtMF0qKEApKT9bYS16QS1aMC05LVwuXSsoXC5bYS16QS1aXXsyLDN9KT8oOlthLXpBLVowLTldKik/XC8/KFthLXpBLVowLTktXC5fXD9cLFwnXC9cKyZhbXA7JVwkI1w9fl0pKil8KChtYWlsdG8pXDpbYS16QS1aMC05LV0rKFwuW2EtekEtWjAtOS1dKykqQChbYS16QS1aMC05LV0rXC4pK1thLXpBLVowLTldezIsN30pfCgobmV3cylcOlthLXpBLVowLTlcLl0qKSQvOw0KDQphdi52YWxpZGF0aW9uLnBhdHRlcm5zLlRJTUUgPSAvXigoMj9bMC0zXSl8KFswLTFdP1swLTldKSk6KFswLTVdP1swLTldKSg6WzAtNV0/WzAtOV0pJC87DQoNCmF2LnZhbGlkYXRpb24ucGF0dGVybnMuU0hPUlRUSU1FID0gL14oKDI/WzAtM10pfChbMC0xXT9bMC05XSkpOihbMC01XT9bMC05XSkkLzsNCg0KDQovKioqDQoNCiAqIFJlcXVpcmVkIFZhbGlkYXRvcg0KDQogKi8NCg0KYXYudmFsaWRhdGlvbi5SZXFpcmVkVmFsaWRhdG9yID0gZnVuY3Rpb24oKSB7DQoNCiAgICB0aGlzLmVycm9yTWVzc2FnZSA9ICJSZXF1aXJlZCEiOw0KDQoNCiAgICB0aGlzLnZhbGlkYXRlQmx1ciA9IGZ1bmN0aW9uKHZhbHVlKSB7DQoNCiAgICAgICAgcmV0dXJuIHZhbHVlLmxlbmd0aCA+IDAgPyBudWxsIDogdGhpcy5lcnJvck1lc3NhZ2U7DQoNCiAgICB9Ow0KDQp9Ow0KDQphdi52YWxpZGF0aW9uLmdsb2JhbC5yZXFpc3RlcigicmVxdWlyZWQiLCBuZXcgYXYudmFsaWRhdGlvbi5SZXFpcmVkVmFsaWRhdG9yKCkpOw0KDQoNCi8qKioNCg0KICogSW50IGludmFsaWRhdG9yDQoNCiAqLw0KDQphdi52YWxpZGF0aW9uLkludFZhbGlkYXRvciA9IGZ1bmN0aW9uKCkgew0KDQogICAgdGhpcy5lcnJvck1lc3NhZ2UgPSAiSW52YWxpZCBpbnRlZ2VyISI7DQoNCg0KICAgIHRoaXMudmFsaWRhdGVCbHVyID0gZnVuY3Rpb24odmFsdWUpIHsNCg0KICAgICAgICByZXR1cm4gYXYudXRpbC5jaGVja3JlZ2V4KGF2LnZhbGlkYXRpb24ucGF0dGVybnMuSU5ULCB2YWx1ZSkgPyBudWxsIDogdGhpcy5lcnJvck1lc3NhZ2U7DQoNCiAgICB9Ow0KDQoNCiAgICB0aGlzLnZhbGlkYXRlS2V5UHJlc3MgPSBmdW5jdGlvbih2YWx1ZSkgew0KDQogICAgICAgIGlmICh2YWx1ZSA9PSAnLScpDQoNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KDQoNCiAgICAgICAgcmV0dXJuIGF2LnV0aWwuY2hlY2tyZWdleChhdi52YWxpZGF0aW9uLnBhdHRlcm5zLklOVCwgdmFsdWUpOw0KDQogICAgfTsNCg0KfTsNCg0KYXYudmFsaWRhdGlvbi5nbG9iYWwucmVxaXN0ZXIoImludCIsIG5ldyBhdi52YWxpZGF0aW9uLkludFZhbGlkYXRvcigpKTsNCg0KDQovKioqDQoNCiAqIEZsb2F0IGludmFsaWRhdG9yDQoNCiAqLw0KDQphdi52YWxpZGF0aW9uLkZsb2F0VmFsaWRhdG9yID0gZnVuY3Rpb24oKSB7DQoNCiAgICB0aGlzLmVycm9yTWVzc2FnZSA9ICJJbnZhbGlkIGZsb2F0ISI7DQoNCg0KICAgIHRoaXMudmFsaWRhdGVCbHVyID0gZnVuY3Rpb24odmFsdWUpIHsNCg0KICAgICAgICByZXR1cm4gYXYudXRpbC5jaGVja3JlZ2V4KGF2LnZhbGlkYXRpb24ucGF0dGVybnMuRkxPQVQsIHZhbHVlKSA/IG51bGwgOiB0aGlzLmVycm9yTWVzc2FnZTsNCg0KICAgIH07DQoNCg0KICAgIHRoaXMudmFsaWRhdGVLZXlQcmVzcyA9IGZ1bmN0aW9uKHZhbHVlKSB7DQoNCiAgICAgICAgaWYgKHZhbHVlID09ICctJykNCg0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQoNCiAgICAgICAgcmV0dXJuIGF2LnV0aWwuY2hlY2tyZWdleChhdi52YWxpZGF0aW9uLnBhdHRlcm5zLkZMT0FULCB2YWx1ZSk7DQoNCiAgICB9Ow0KDQp9Ow0KDQphdi52YWxpZGF0aW9uLmdsb2JhbC5yZXFpc3RlcigiZmxvYXQiLCBuZXcgYXYudmFsaWRhdGlvbi5GbG9hdFZhbGlkYXRvcigpKTsNCg0KDQovKioqDQoNCiAqIEVtYWlsIFZhbGlkYXRvcg0KDQogKi8NCg0KYXYudmFsaWRhdGlvbi5FbWFpbFZhbGlkYXRvciA9IGZ1bmN0aW9uKCkgew0KDQogICAgdGhpcy5lcnJvck1lc3NhZ2UgPSAiSW52YWxpZCBFbWFpbCBhZGRyZXNzISI7DQoNCg0KICAgIHRoaXMudmFsaWRhdGVCbHVyID0gZnVuY3Rpb24odmFsdWUpIHsNCg0KICAgICAgICByZXR1cm4gYXYudXRpbC5jaGVja3JlZ2V4KGF2LnZhbGlkYXRpb24ucGF0dGVybnMuRU1BSUwsIHZhbHVlKSA/IG51bGwgOiB0aGlzLmVycm9yTWVzc2FnZTsNCg0KICAgIH07DQoNCn07DQoNCmF2LnZhbGlkYXRpb24uZ2xvYmFsLnJlcWlzdGVyKCJlbWFpbCIsIG5ldyBhdi52YWxpZGF0aW9uLkVtYWlsVmFsaWRhdG9yKCkpOw0KDQoNCi8qKioNCg0KICogVGltZSBWYWxpZGF0b3INCg0KICovDQoNCmF2LnZhbGlkYXRpb24uVGltZVZhbGlkYXRvciA9IGZ1bmN0aW9uKCkgew0KDQogICAgdGhpcy5lcnJvck1lc3NhZ2UgPSAiSW52YWxpZCBUaW1lISI7DQoNCg0KICAgIHRoaXMudmFsaWRhdGVCbHVyID0gZnVuY3Rpb24odmFsdWUpIHsNCg0KICAgICAgICByZXR1cm4gYXYudXRpbC5jaGVja3JlZ2V4KGF2LnZhbGlkYXRpb24ucGF0dGVybnMuVElNRSwgdmFsdWUpID8gbnVsbCA6IHRoaXMuZXJyb3JNZXNzYWdlOw0KDQogICAgfTsNCg0KfTsNCg0KYXYudmFsaWRhdGlvbi5nbG9iYWwucmVxaXN0ZXIoInRpbWUiLCBuZXcgYXYudmFsaWRhdGlvbi5UaW1lVmFsaWRhdG9yKCkpOw0KDQoNCi8qKioNCg0KICogVGltZSBWYWxpZGF0b3INCg0KICovDQoNCmF2LnZhbGlkYXRpb24uU2hvcnRUaW1lVmFsaWRhdG9yID0gZnVuY3Rpb24oKSB7DQoNCiAgICB0aGlzLmVycm9yTWVzc2FnZSA9ICJJbnZhbGlkIFRpbWUhIjsNCg0KDQogICAgdGhpcy52YWxpZGF0ZUJsdXIgPSBmdW5jdGlvbih2YWx1ZSkgew0KDQogICAgICAgIHJldHVybiBhdi51dGlsLmNoZWNrcmVnZXgoYXYudmFsaWRhdGlvbi5wYXR0ZXJucy5TSE9SVFRJTUUsIHZhbHVlKSA/IG51bGwgOiB0aGlzLmVycm9yTWVzc2FnZTsNCg0KICAgIH07DQoNCn07DQoNCmF2LnZhbGlkYXRpb24uZ2xvYmFsLnJlcWlzdGVyKCJzaG9ydHRpbWUiLCBuZXcgYXYudmFsaWRhdGlvbi5TaG9ydFRpbWVWYWxpZGF0b3IoKSk7DQoNCg0KLyoqKg0KDQogKiBUaW1lIFZhbGlkYXRvcg0KDQogKi8NCg0KYXYudmFsaWRhdGlvbi5EYXRlVmFsaWRhdG9yID0gZnVuY3Rpb24oKSB7DQoNCiAgICB0aGlzLmVycm9yTWVzc2FnZSA9ICJJbnZhbGlkIERhdGUhIjsNCg0KDQogICAgdGhpcy5vbkF0dGFjaCA9IGZ1bmN0aW9uKGVsKSB7DQoNCiAgICAgICAgLy8JCWpRdWVyeShlbCkuZGF0ZXBpY2tlcihqUXVlcnkuZGF0ZXBpY2tlci5yZWdpb25hbFsnJ10pOw0KDQogICAgfQ0KDQoNCiAgICB0aGlzLnZhbGlkYXRlQmx1ciA9IGZ1bmN0aW9uKHZhbHVlLCBwYXJhbXMsIGVsKSB7DQoNCiAgICAgICAgY2hlY2tEYXRlKGVsLCAxKTsNCg0KICAgIH07DQoNCn07DQoNCmF2LnZhbGlkYXRpb24uZ2xvYmFsLnJlcWlzdGVyKCJkYXRlIiwgbmV3IGF2LnZhbGlkYXRpb24uRGF0ZVZhbGlkYXRvcigpKTsNCg0KDQphdi52YWxpZGF0aW9uLlJhbmdlVmFsaWRhdG9yID0gZnVuY3Rpb24oKSB7DQoNCiAgICAvLwl0aGlzLmVycm9yTWVzc2FnZSA9ICJWYWx1ZSByYW5nZTp7MH0gYW5kIHsxfSEiOw0KDQoNCiAgICB0aGlzLnZhbGlkYXRlQmx1ciA9IGZ1bmN0aW9uKHZhbHVlLCBwYXJhbXMpIHsNCg0KICAgICAgICBpZiAoIXBhcmFtcykNCg0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQoNCiAgICAgICAgdmFyIG1pblZhbHVlID0gcGFyYW1zWzBdOw0KDQogICAgICAgIHZhciBtYXhWYWx1ZSA9IChwYXJhbXMubGVuZ3RoID4gMSkgPyBwYXJhbXNbMV0gOiBudWxsOw0KDQogICAgICAgIGlmIChtaW5WYWx1ZSAmJiB0eXBlb2YgbWluVmFsdWUgPT0gJ251bWJlcicgfHwgbWF4VmFsdWUgJiYgdHlwZW9mIG1heFZhbHVlID09ICdudW1iZXInKSB7DQoNCiAgICAgICAgICAgIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChtaW5WYWx1ZSAmJiBtaW5WYWx1ZS5nZXREYXRlICE9PSB1bmRlZmluZWQpDQoNCiAgICAgICAgICAgIHZhbHVlID0gbmV3IERhdGUodmFsdWUpOw0KDQoNCiAgICAgICAgdmFyIGlzTGVzc01pbiA9IChtaW5WYWx1ZSAmJiB2YWx1ZSA8IG1pblZhbHVlKTsNCg0KICAgICAgICB2YXIgaXNNb3JlTWF4ID0gKG1heFZhbHVlICYmIHZhbHVlID4gbWF4VmFsdWUpOw0KDQogICAgICAgIGlmIChtaW5WYWx1ZSAmJiAhbWF4VmFsdWUgJiYgaXNMZXNzTWluKQ0KDQogICAgICAgICAgICByZXR1cm4gIm11c3QgbW9yZSB0aGFuOiAiICsgbWluVmFsdWU7DQoNCg0KICAgICAgICBpZiAobWF4VmFsdWUgJiYgIW1pblZhbHVlICYmIGlzTW9yZU1heCkNCg0KICAgICAgICAgICAgcmV0dXJuICJNdXN0IGxlc3MgdGhhbjogIiArIG1heFZhbHVlOw0KDQoNCiAgICAgICAgaWYgKGlzTGVzc01pbiB8fCBpc01vcmVNYXgpIHsNCg0KICAgICAgICAgICAgaWYgKG1pblZhbHVlICYmIG1pblZhbHVlLmdldERhdGUgIT09IHVuZGVmaW5lZCkgew0KDQogICAgICAgICAgICAgICAgbWluVmFsdWUgPSBtaW5WYWx1ZS50b0xvY2FsZURhdGVTdHJpbmcoKTsNCg0KICAgICAgICAgICAgICAgIG1heFZhbHVlID0gbWF4VmFsdWUudG9Mb2NhbGVEYXRlU3RyaW5nKCk7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuICJSYW5nZTogWyIgKyBtaW5WYWx1ZSArICJdIHRvIFsiICsgbWF4VmFsdWUgKyAiXSI7DQoNCiAgICAgICAgfQ0KDQogICAgfTsNCg0KfTsNCg0KYXYudmFsaWRhdGlvbi5nbG9iYWwucmVxaXN0ZXIoInJhbmdlIiwgbmV3IGF2LnZhbGlkYXRpb24uUmFuZ2VWYWxpZGF0b3IoKSk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IFV0aWwuanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiA8PEdlbmVyYWwgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzPj4NCg0KICogDQoNCiAqIE5vdGVzOg0KDQogKiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqIFJldmlzaW9uIEhpc3Rvcnk6DQoNCiAqIDw8RGF0ZT4+LCA8PFdobz4+LCA8PFdoYXQ+Pg0KDQogKiAxNS8wMS8yMDEyLCBSYXkgWmhhbmcsIEluaXRpYWwgdmVyc2lvbg0KDQogKg0KDQogKi8NCg0KDQpVdGlsID0gew0KDQoJLy90cnVlIC0gQVINCg0KCWNoZWNrQXIgOiBmdW5jdGlvbigpIHsNCg0KCQl2YXIgcCA9IHNlbGY7DQoNCgkJdmFyIGkgPSAwOw0KDQoJCWlmICh0eXBlb2YgKHApID09ICd1bmRlZmluZWQnKSB7DQoNCgkJCXJldHVybiBmYWxzZTsNCg0KCQl9DQoNCg0KCQl3aGlsZSAocCkgew0KDQoJCQlpZiAodHlwZW9mIChwLnByb2ZpbGUpICE9ICJ1bmRlZmluZWQiKSB7DQoNCgkJCQlpZiAocC5wcm9maWxlLmxhbmd1YWdlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigiYXIiKSA+PSAwKSB7DQoNCgkJCQkJcmV0dXJuIHRydWU7DQoNCgkJCQl9IGVsc2Ugew0KDQoJCQkJCXJldHVybiBmYWxzZTsNCg0KCQkJCX0NCg0KCQkJfQ0KDQoJCQlwID0gcC5wYXJlbnQ7DQoNCgkJCWkrKzsNCg0KCQkJaWYgKGkgPj0gMTApDQoNCgkJCQlicmVhazsNCg0KDQoJCX0NCg0KCQlyZXR1cm4gZmFsc2U7DQoNCgl9LA0KDQoNCglleHRlbmQgOiBmdW5jdGlvbihzdWJDbGFzcywgc3VwZXJDbGFzcywgbykgew0KDQoNCgkJaWYgKHR5cGVvZiBzdXBlckNsYXNzID09ICJvYmplY3QiKSB7DQoNCgkJCXRoaXMuYXBwbHkoc3ViQ2xhc3MucHJvdG90eXBlLCBzdXBlckNsYXNzKTsNCg0KCQkJcmV0dXJuOw0KDQoJCX0NCg0KDQoJCXZhciBzcHAgPSBzdXBlckNsYXNzLnByb3RvdHlwZTsNCg0KCQl2YXIgRiA9IGZ1bmN0aW9uKCkgew0KDQoJCX07DQoNCgkJRi5wcm90b3R5cGUgPSBzcHA7DQoNCgkJc3ViQ2xhc3MucHJvdG90eXBlID0gbmV3IEYoKTsNCg0KCQlpZiAobykgew0KDQoJCQl0aGlzLmFwcGx5KHN1YkNsYXNzLnByb3RvdHlwZSwgbyk7DQoNCgkJfQ0KDQoJCXN1YkNsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHN1YkNsYXNzOw0KDQoJCS8vc2V0IHN1cGVyIGNsYXNzDQoNCgkJc3ViQ2xhc3MucHJvdG90eXBlLnN1cGVyQ2xhc3MgPSBzdXBlckNsYXNzOw0KDQoNCgkJcmV0dXJuIHN1YkNsYXNzOw0KDQoJfSwNCg0KDQoJLy9uYW1lIHNwYWNlDQoNCgluYW1lc3BhY2UgOiBmdW5jdGlvbigpIHsNCg0KCQl2YXIgYSA9IGFyZ3VtZW50cywgbyA9IG51bGwsIGksIGosIGQsIHJ0Ow0KDQoJCWZvciAoaSA9IDA7IGkgPCBhLmxlbmd0aDsgKytpKSB7DQoNCgkJCWQgPSBhW2ldLnNwbGl0KCIuIik7DQoNCgkJCXJ0ID0gZFswXTsNCg0KCQkJZXZhbCgnaWYgKHR5cGVvZiAnICsgcnQgKyAnID09ICJ1bmRlZmluZWQiKXsnICsgcnQgKyAnID0ge307fSBvID0gJw0KDQoJCQkJCSsgcnQgKyAnOycpOw0KDQoJCQlmb3IgKGogPSAxOyBqIDwgZC5sZW5ndGg7ICsraikgew0KDQoJCQkJb1tkW2pdXSA9IG9bZFtqXV0gfHwge307DQoNCgkJCQlvID0gb1tkW2pdXTsNCg0KCQkJfQ0KDQoJCX0NCg0KCX0sDQoNCg0KCWFwcGx5SWYgOiBmdW5jdGlvbihvLCBjKSB7DQoNCgkJaWYgKG8gJiYgYykgew0KDQoJCQlmb3IgKCB2YXIgcCBpbiBjKSB7DQoNCgkJCQlpZiAodHlwZW9mIG9bcF0gPT0gInVuZGVmaW5lZCIpIHsNCg0KCQkJCQlvW3BdID0gY1twXTsNCg0KCQkJCX0NCg0KCQkJfQ0KDQoJCX0NCg0KCQlyZXR1cm4gbzsNCg0KCX0sDQoNCg0KCWFwcGx5IDogZnVuY3Rpb24obywgYykgew0KDQoJCWlmIChvICYmIGMgJiYgdHlwZW9mIGMgPT0gJ29iamVjdCcpIHsNCg0KCQkJZm9yICggdmFyIHAgaW4gYykgew0KDQoJCQkJaWYgKGNbcF0pDQoNCgkJCQkJb1twXSA9IGNbcF07DQoNCgkJCX0NCg0KCQl9DQoNCgkJcmV0dXJuIG87DQoNCgl9LA0KDQoNCglpbmNyZWFzZSA6IChmdW5jdGlvbigpIHsNCg0KCQl2YXIgaWQgPSAwOw0KDQoJCXJldHVybiBmdW5jdGlvbigpIHsNCg0KCQkJcmV0dXJuIGlkKys7DQoNCgkJfTsNCg0KCX0pKCksDQoNCg0KCWhhbmRsZUhyZWYgOiBmdW5jdGlvbihhSHJlZikgew0KDQoJCWlmIChhSHJlZi50b1VwcGVyQ2FzZSgpLnRyaW0oKS5zdGFydHNXaXRoKCJKQVZBU0NSSVBUOiIpKSB7DQoNCgkJCWlmIChhSHJlZi5pbmRleE9mKCI/IikgPiAwKQ0KDQoJCQkJYUhyZWYgPSBhSHJlZi5zdWJzdHJpbmcoMCwgYUhyZWYuaW5kZXhPZigiPyIpKTsNCg0KCQl9DQoNCgkJcmV0dXJuIGFIcmVmOw0KDQoJfSwNCg0KCQ0KDQoJc3BlY2lhbExldHRlcnMgOiAiIUAjJCVeJiooKV89Kz88Pj8uLDsnXCJcXHxbXSIsDQoNCgkNCg0KCWRlYWx3aXRoU3BlY2lhbExldHRlcjogZnVuY3Rpb24obGV0dGVycyl7DQoNCgkJdmFyIGxldHRlcjsNCg0KCQl2YXIgcGF0dGVybjsNCg0KCQl2YXIgYXJyYXlzID0gbmV3IEFycmF5KCk7DQoNCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBsZXR0ZXJzLmxlbmd0aDsgaSsrKQ0KDQoJCXsNCg0KCQkJbGV0dGVyID0gbGV0dGVycy5jaGFyQXQoaSk7DQoNCgkJCWlmICh0aGlzLnNwZWNpYWxMZXR0ZXJzLmluZGV4T2YobGV0dGVyKSA+PSAwKQ0KDQoJCQl7DQoNCgkJCQkvL3BhdHRlcm4gPSBuZXcgUmVnRXhwKGxldHRlciwgJ2lnJyk7DQoNCgkJCQlsZXR0ZXIgPSBsZXR0ZXIucmVwbGFjZShsZXR0ZXIsICJcXCIrbGV0dGVyKTsNCg0KCQkJfQ0KDQoJCQlhcnJheXMucHVzaChsZXR0ZXIpOw0KDQoJCX0NCg0KCQkNCg0KCQlsZXR0ZXJzID0gYXJyYXlzLmpvaW4oIiIpOw0KDQoJCXJldHVybiBsZXR0ZXJzOw0KDQoJfSwNCg0KCQ0KDQoJLyoNCg0KCSAqIHdvcmQ6IHNob3VsZCBxdWVyeSB3b3JkDQoNCgkgKiB0YWc6ICBzaG91bGQgc2VhcmNoIHRhZw0KDQoJICogY2xhc3NOYW1lOiBoaWdodCBicmlnaHQgY2xhc3MNCg0KCSAqIHNjb3BlT2JqOiBBZmZlY3QgYXJlYS4NCg0KCSAqIGV4Y2x1ZGVFeHByZXNzOiBleGNsdWRlIGV4cHJlc3MsIHVzZSBmb3IgZmlsdGVyIGV4Y2x1ZGUgZWxlbWVudC4NCg0KCSAqICovDQoNCgloaWdoTGlnaHQgOiBmdW5jdGlvbih3b3JkLCB0YWcsIGNsYXNzTmFtZSxzY29wZU9iaiwgZXhjbHVkZUV4cHJlc3MpIHsNCg0KDQoJCXdvcmQgPSB3b3JkLnRyaW0oKTsNCg0KCQl2YXIgaXNOdW0gPSBmYWxzZTsNCg0KCQlpZiAoIWlzTmFOKHBhcnNlSW50KHdvcmQpKSkNCg0KCQl7DQoNCgkJCWlzTnVtID0gdHJ1ZTsNCg0KCQl9DQoNCgkJaWYgKHdvcmQpDQoNCgkJew0KDQoJCQl3b3JkID0gd29yZC5yZXBsYWNlKC9cXC9nLCAiIik7DQoNCgkJfQ0KDQoJCQ0KDQoJCXdvcmQgPSB0aGlzLmRlYWx3aXRoU3BlY2lhbExldHRlcih3b3JkKTsNCg0KCQkNCg0KCQl2YXIgZXhwcmVzcyA9IG5ldyBSZWdFeHAod29yZCwgJ2lnJyk7DQoNCg0KCQlpZihzY29wZU9iail7DQoNCgkJCXRhZz0gc2NvcGVPYmouZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnKTsNCg0KCQl9ZWxzZXsNCg0KCQkgdGFnPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWcpOw0KDQoJCX0NCg0KCQkvL2hpZ2ggYnJpZ2h0IHN0eWxlDQoNCgkJdmFyIHJlcGxhY2VUbyA9IGZ1bmN0aW9uKHNlbnRlbmNlLCBkYXRhKXsNCg0KCQkJZm9yICh2YXIga2V5IGluIGRhdGEpDQoNCgkJCXsNCg0KCQkJCXNlbnRlbmNlID0gc2VudGVuY2UucmVwbGFjZShrZXksIGRhdGFba2V5XSk7DQoNCgkJCX0NCg0KCQkJcmV0dXJuIHNlbnRlbmNlOw0KDQoJCX07DQoNCgkJLy90aGUgc3R5bGUgYmV0d2VlbiBzZW50ZW5jZQ0KDQoJCXZhciBwYXR0ZXJuID0gIjxmb250IGNsYXNzPVxcXCIiICsgY2xhc3NOYW1lICsgIlxcXCIiICsiPihbXFx3XFxzXFwvXFwjXFwkXFwlXFxeXFwmXFwqXFwoXFwpXFxfXFwrXFx8PVxcP1xcLVxcIUAnXCI6XFwuXFwsXFxbXFxdXFx7XFx9XFx+XFxgXFw7XSopPFxcL2ZvbnQ+IjsNCg0KCQl2YXIgYmVmb3JlUmVndWxhciA9IG5ldyBSZWdFeHAocGF0dGVybiwgImlnIik7DQoNCgkJLy9odG1sIHBhdHRlbg0KDQoJCXZhciBodG1sUGF0dGVybiA9IC88W14+XSo+L2lnOw0KDQoJCXZhciBodG1sU3BlY2lhbFBhdHRlcm4gPSAiXFwmW2EtekEtWl17MSwxMH07IjsNCg0KCQl2YXIgaHRtbFNwZWNpYWxSZWd1bGFyID0gbmV3IFJlZ0V4cChodG1sU3BlY2lhbFBhdHRlcm4sICdpZycpOw0KDQoNCgkJLy9yczogcmVzdWx0IHdoaWNoIGlzIGZvdW5kIGJ5IHJlZ3VsYXIuIHdhc0NoYW5nZTogSXMgdGhlIGlubmVySFRNTCBjaGFuZ2U/DQoNCgkJdmFyIHJzLCB3YXNDaGFuZ2U7DQoNCg0KCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB0YWcubGVuZ3RoOyBpKyspIHsNCg0KCQkJdGhpcy53YXNDaGFuZ2UgPSBmYWxzZTsNCg0KCQkJdmFyIGlubmVySFRNTCA9IHRhZ1tpXS5pbm5lckhUTUw7DQoNCgkJCXZhciBpbm5lclRleHQgPSB0YWdbaV0uaW5uZXJUZXh0Ow0KDQoJCQl2YXIgdG1wSFRNTCA9IGlubmVySFRNTDsNCg0KDQoJCQkvLzEuIHJlcGxhY2UgYWxsIGJlZm9yZSBjaGFuZ2VkIHN0eWxlDQoNCgkJCXdoaWxlICgocnMgPSBiZWZvcmVSZWd1bGFyLmV4ZWMoaW5uZXJIVE1MKSkgIT0gbnVsbCkgew0KDQoJCQkJLy9hbGVydChyc1swXSArICIgOiAgIiArIHJzWzFdICsgIiBiZWdpbjogIitycy5pbmRleCArICIgbGFzdEluZGV4OiAgIitycy5sYXN0SW5kZXgpOw0KDQoJCQkJdG1wSFRNTCA9IHRtcEhUTUwucmVwbGFjZShyc1swXSwgcnNbMV0pOw0KDQoJCQkJdGhpcy53YXNDaGFuZ2UgPSB0cnVlOw0KDQoJCQl9DQoNCg0KCQkJaW5uZXJIVE1MID0gdG1wSFRNTDsNCg0KICAgICAgICAgICAgLy9maWx0ZXIgZXhjbHVkZSBlbGVtZW50Lg0KDQogICAgICAgICAgICBpZiAoZXhjbHVkZUV4cHJlc3MgJiYgZXhjbHVkZUV4cHJlc3MuZXhlYyhpbm5lckhUTUwpKSB7DQoNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCg0KICAgICAgICAgICAgfQ0KDQoJCQkvLzIuIGhpZ2h0IGJyaWdodChleGNlcHQgaHRtbCBnYXQgY29udGVudCkNCg0KCQkJaWYgKHdvcmQgJiYgaW5uZXJUZXh0LnRyaW0oKSkgew0KDQoJCQkJaW5uZXJIVE1MID0gdGhpcy5zcGVjaWFsQ2hhcihpbm5lclRleHQsIGlubmVySFRNTCwgd29yZCwNCg0KCQkJCQkJcmVwbGFjZVRvLCBodG1sUGF0dGVybiwgaHRtbFNwZWNpYWxSZWd1bGFyLCBleHByZXNzLCBjbGFzc05hbWUsIGlzTnVtKTsNCg0KCQkJfQ0KDQoNCgkJCS8vMy4gaWYgdGhlIGlubmVySFRNTCB3YXMgY2hhbmdlIGFudCAxJjIgc3RlcCwgd2UgbXVzdCByZXNldCB0aGUgaHRtbC4NCg0KCQkJaWYgKHRoaXMud2FzQ2hhbmdlKSB7DQoNCgkJCQl0YWdbaV0uaW5uZXJIVE1MID0gaW5uZXJIVE1MOw0KDQoJCQl9DQoNCgkJfQ0KDQoJCQ0KDQoJCXRoaXMud2FzQ2hhbmdlID0gbnVsbDsNCg0KCX0sDQoNCg0KCXNwZWNpYWxDaGFyIDogZnVuY3Rpb24oaW5uZXJUZXh0LCBpbm5lckh0bWwsIHdvcmQsIHJlcGxhY2VUbywgaHRtbFBhdHRlcm4sDQoNCgkJCWh0bWxTcGVjaWFsUmVndWxhciwgZXhwcmVzcywgY2xhc3NOYW1lLCBpc051bSkgew0KDQoJCXZhciBycywgdG1wSHRtbCA9IGlubmVySHRtbCwgaSA9IDAsIGNvbnRlbnQsIHRtcFNlbnRlbmNlLCByZXN1bHQ7DQoNCgkJLy9yZXBsYWNlQWxsKCJcXCZbYS16QS1aXXsxLDEwfTsiLCAiIikucmVwbGFjZUFsbCgiPFtePl0qPiIsICIiKS5yZXBsYWNlQWxsKCJbKC8+KTxdIiwgIiIpOyAgIA0KDQoJCXZhciBhcnJheSA9IGlubmVySHRtbC5zcGxpdChodG1sUGF0dGVybik7DQoNCgkJdmFyIGNvbnRlbnRBcnJheSwgd29yZE9iamVjdCwgc2h1bGRSZXBsYWNlLCB0bXAsIGtleTsNCg0KDQoJCQ0KDQoJCS8vMS4gc3BsaXQgZnJvbSBodG1sIGNvZGUoPC4uLj48Ly4uPikNCg0KCQlmb3IgKCB2YXIgaiA9IDA7IGogPCBhcnJheS5sZW5ndGg7IGorKykgew0KDQoJCQljb250ZW50ID0gYXJyYXlbal07DQoNCgkJCWlmICghY29udGVudCkgew0KDQoJCQkJY29udGludWU7DQoNCgkJCX0NCg0KCQkJLy8yLnNwbGl0IGZvcm0gc3BlY2lhbCBodG1sKCYuLi47KQ0KDQoJCQljb250ZW50QXJyYXkgPSBjb250ZW50LnNwbGl0KGh0bWxTcGVjaWFsUmVndWxhcik7DQoNCgkJCWZvciAoIHZhciB6ID0gMDsgeiA8IGNvbnRlbnRBcnJheS5sZW5ndGg7IHorKykgew0KDQoJCQkJc2h1bGRSZXBsYWNlID0gZmFsc2U7DQoNCgkJCQl2YXIgaW5kZXggPSAwOw0KDQoJCQkJcnMgPSBjb250ZW50QXJyYXlbel07DQoNCgkJCQl0bXAgPSByczsNCg0KCQkJCXdvcmRPYmplY3QgPSB7fTsNCg0KCQkJCXZhciByZXBsYWNlSW5kZXggPSAwOw0KDQoJCQkJd2hpbGUgKChyZXN1bHQgPSBleHByZXNzLmV4ZWMocnMpKSAhPSBudWxsKSB7DQoNCgkJCQkJc2h1bGRSZXBsYWNlID0gdHJ1ZTsNCg0KCQkJCX0NCg0KCQkJCQ0KDQoJCQkJaWYgKHNodWxkUmVwbGFjZSkNCg0KCQkJCXsNCg0KCQkJCQl2YXIgcGF0dGVybiA9ICI8Zm9udCBjbGFzcz0nIiArIGNsYXNzTmFtZSArICInPiI7DQoNCgkJCQkJdmFyIHJlZ1N0ciA9ICIoIiArIHBhdHRlcm4gKyAiKSIgKyB3b3JkICsgIjwvZm9udD58IiArICIoXFwmW2EtekEtWl17MSwxMH07KXw8W2EtekEtWlwvXStbXjw+XSoiICt3b3JkKyAiW148XSo+fDwiICsgd29yZCsiW148Pl0qPnwiICsgd29yZDsNCg0KCQkJCQl2YXIgcmVnID0gbmV3IFJlZ0V4cChyZWdTdHIsICJpZyIpOw0KDQoJCQkJCXRtcEh0bWwgPSB0bXBIdG1sLnJlcGxhY2UocmVnLCBmdW5jdGlvbihtYXRjaFdvcmQpew0KDQoJCQkJCQlyZXR1cm4gVXRpbC5oYW5kbGVNYXRjaGVkQ2hhcmFjdGVycyhtYXRjaFdvcmQsY2xhc3NOYW1lLHBhdHRlcm4scmVnKTsNCg0KCQkJCQl9KTsNCg0KCQkJCQl0aGlzLndhc0NoYW5nZSA9IHRydWU7DQoNCgkJCQl9DQoNCgkJCX0NCg0KCQl9DQoNCgkJDQoNCgkJcmV0dXJuIHRtcEh0bWw7DQoNCgl9LA0KDQoNCgkvKg0KDQoJICogaGFuZGxlIHRoZSBjaGFyYWN0ZXJzIHRoYXQgbWF0Y2ggdGhlIHJlZ2V4LA0KDQoJICogc3BlY2lhbCBoYW5kbGUgdGhlICI8Zm9udCBjbGFzcz0nIiArIGNsYXNzTmFtZSArICInPiIsICYsPGE+DQoNCgkgKi8NCg0KCWhhbmRsZU1hdGNoZWRDaGFyYWN0ZXJzIDogZnVuY3Rpb24obWF0Y2hXb3JkLCBjbGFzc05hbWUsIHBhdHRlcm4sIHJlZykgDQoNCgl7DQoNCgkJaWYgKG1hdGNoV29yZC5zZWFyY2goIiYiKSAhPSAtMSB8fCBtYXRjaFdvcmQuc2VhcmNoKHBhdHRlcm4pICE9IC0xIHx8IG1hdGNoV29yZC5zZWFyY2goIjxbYS16QS1aXC9dK1tePD5dKj4iKSAhPSAtMSkgDQoNCgkJew0KDQoJCQlyZXR1cm4gbWF0Y2hXb3JkOw0KDQoJCX0NCg0KCQllbHNlIA0KDQoJCXsNCg0KCQkJcmV0dXJuICI8Zm9udCBjbGFzcz0nIiArIGNsYXNzTmFtZSArICInPiIgKyBtYXRjaFdvcmQgKyAiPC9mb250PiI7DQoNCgkJfQ0KDQoJfSwNCg0KDQoJDQoNCgkvKioNCg0KCSogRmluZCB0aGUgbmVhcmVzdCBwYXJlbnQgbm9kZSB3aGljaCB0YWcgbmFtZSBpcyBzYW1lIHRvIHRoZSBzcGVjaWZpYyB0YWcgbmFtZQ0KDQoJKi8NCg0KCWZpbmRQYXJlbnROb2RlQnlUYWcgOiBmdW5jdGlvbihzcmNPYmosIHRhZ05hbWUsIG1heExldmVsKXsNCg0KCQl2YXIgcCA9IHNyY09iajsNCg0KCQl2YXIgY291bnQgPSAwOw0KDQoJCXZhciBtYXhMZXZlbFZhbCA9IG1heExldmVsIHx8IDU7DQoNCgkJd2hpbGUgKHApIA0KDQoJCXsNCg0KCQkJcCA9IHAucGFyZW50Tm9kZTsNCg0KCQkJY291bnQrKzsNCg0KCQkJaWYgKHAudGFnTmFtZSA9PSB0YWdOYW1lIHx8IGNvdW50ID09IG1heExldmVsVmFsKSANCg0KCQkJew0KDQoJCQkJYnJlYWs7DQoNCgkJCX0NCg0KCQl9DQoNCgkJcmV0dXJuIHA7DQoNCgl9LA0KDQoJDQoNCgkvKioNCg0KCSAqIHJlbW92ZSBkb20gbm9kZQ0KDQoJICovDQoNCglyZW1vdmVOb2RlIDogZnVuY3Rpb24oaWQpDQoNCgl7DQoNCgkJdmFyIG5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7DQoNCgkJaWYgKG5vZGUucGFyZW50Tm9kZSkgeyAgIA0KDQoJCQlub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7IA0KDQoJCX0NCg0KCX0NCg0KfQ0KDQoNCkZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24oKSB7DQoNCgl2YXIgYSA9IGFyZ3VtZW50czsNCg0KCXZhciBfX21ldGhvZCA9IHRoaXM7DQoNCgl2YXIgYXJncyA9IG51bGw7DQoNCgl2YXIgb2JqZWN0ID0gYVswXTsNCg0KDQoJaWYgKGEubGVuZ3RoID4gMSkgew0KDQoJCWFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOw0KDQoJfSBlbHNlIHsNCg0KCQlpZiAodHlwZW9mIG9iamVjdCAhPSAib2JqZWN0Iikgew0KDQoJCQlvYmplY3QgPSB3aW5kb3c7DQoNCgkJCWFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApOw0KDQoJCX0NCg0KCX0NCg0KDQoJcmV0dXJuIGZ1bmN0aW9uKCkgew0KDQoJCXJldHVybiBfX21ldGhvZC5hcHBseShvYmplY3QsIGFyZ3MgfHwgYXJndW1lbnRzKTsNCg0KCX0NCg0KfTsNCg0KDQpTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGggPSBmdW5jdGlvbihzdHIpIHsNCg0KCXJldHVybiAodGhpcy5tYXRjaCgiXiIgKyBzdHIpID09IHN0cikNCg0KfTsNCg0KDQpTdHJpbmcucHJvdG90eXBlLnRyaW0gPSBmdW5jdGlvbigpIHsNCg0KCXJldHVybiAodGhpcy5yZXBsYWNlKC9eW1xzXHhBMF0rLywgIiIpLnJlcGxhY2UoL1tcc1x4QTBdKyQvLCAiIikpOw0KDQp9Ow0KDQovKioNCg0KICogDQoNCiAqIFYzNjAJIA0KDQogKiBGaWxlOiBPYnNlcnZhYmxlLmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjoNCg0KICogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczoNCg0KICogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKiBSZXZpc2lvbiBIaXN0b3J5Og0KDQogKiA8PERhdGU+PiwgPDxXaG8+PiwgPDxXaGF0Pj4NCg0KICogMTUvMDEvMjAxMiwgUmF5IFpoYW5nLCBJbml0aWFsIHZlcnNpb24NCg0KICoNCg0KICovDQoNCg0KVUkuT2JzZXJ2YWJsZSA9IGZ1bmN0aW9uKCl7fTsNCg0KDQpVSS5PYnNlcnZhYmxlLnByb3RvdHlwZSA9IHsNCg0KCWFkZE9ic2VydmVyIDogZnVuY3Rpb24oZXZlbnROYW1lLCBmbiwgc2NvcGUsIG8pDQoNCgl7DQoNCgkJZXZlbnROYW1lID0gZXZlbnROYW1lLnRvTG93ZXJDYXNlKCk7DQoNCgkJdmFyIGNlID0gdGhpcy5ldmVudHNbZXZlbnROYW1lXSB8fCB0cnVlOw0KDQoJCWlmICh0eXBlb2YgY2UgPT0gJ2Jvb2xlYW4nKSB7DQoNCgkJCXRoaXMuZXZlbnRzW2V2ZW50TmFtZV0gPSBuZXcgVUkuRXZlbnRNZ3IodGhpcywgZXZlbnROYW1lKTsNCg0KCQl9DQoNCgkJdGhpcy5ldmVudHNbZXZlbnROYW1lXS5hZGRMaXN0ZW5lcihmbiwgc2NvcGUsIHR5cGVvZiBvID09ICdvYmplY3QnID8gbyA6IHt9KTsNCg0KCX0sDQoNCgkNCg0KCWFkZExpc3RlbmVyIDogZnVuY3Rpb24oZXZlbnROYW1lLCBmbiwgc2NvcGUsIG8pDQoNCgl7DQoNCgkJdGhpcy5hZGRPYnNlcnZlcihldmVudE5hbWUsIGZuLCBzY29wZSwgbyk7DQoNCgl9LA0KDQoJDQoNCglkZWxldGVPYnNlcnZlciA6IGZ1bmN0aW9uKGV2ZW50TmFtZSwgZm4sIHNjb3BlKQ0KDQoJew0KDQoJCXZhciBjZSA9IHRoaXMuZXZlbnRzW2V2ZW50TmFtZS50b0xvd2VyQ2FzZSgpXTsNCg0KCQlpZiAodHlwZW9mIGNlID09ICdvYmplY3QnKSB7DQoNCgkJCWNlLnJlbW92ZUxpc3RlbmVyKGZuLCBzY29wZSk7DQoNCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJY2xlYXJPYnNlcnZlcnMgOiBmdW5jdGlvbihldmVudE5hbWUsIGZuLCBzY29wZSkNCg0KCXsNCg0KCQl2YXIgY2UgPSB0aGlzLmV2ZW50c1tldmVudE5hbWUudG9Mb3dlckNhc2UoKV07DQoNCgkJaWYgKHR5cGVvZiBjZSA9PSAnb2JqZWN0Jykgew0KDQoJCQljZS5jbGVhckxpc3RlbmVyKGZuLCBzY29wZSk7DQoNCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJaGFzT2JzZXJ2ZXIgOiBmdW5jdGlvbihldmVudE5hbWUpDQoNCgl7DQoNCgkJdmFyIGNlID0gdGhpcy5ldmVudHNbZXZlbnROYW1lLnRvTG93ZXJDYXNlKCldOw0KDQoJCXJldHVybiB0eXBlb2YgY2UgPT0gJ29iamVjdCcgJiYgY2UubGlzdGVuZXJzLmxlbmd0aCA+IDA7DQoNCgl9LA0KDQoJDQoNCglmaXJlRXZlbnQgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJdmFyIGEgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApLA0KDQoJCQllbmFtZSA9IGFbMF0udG9Mb3dlckNhc2UoKSwNCg0KCQkJcmV0ID0gdHJ1ZSwNCg0KCQkJY2UgPSB0aGlzLmV2ZW50c1tlbmFtZV07DQoNCg0KCQkNCg0KCQlpZih0eXBlb2YgY2UgPT0gJ29iamVjdCcpIHsNCg0KCQkJYS5zaGlmdCgpOw0KDQoJCQlyZXQgPSBjZS5maXJlLmFwcGx5KGNlLCBhKTsNCg0KCQl9DQoNCgkJcmV0dXJuIHJldDsNCg0KCX0sDQoNCg0KCWFkZEV2ZW50cyA6IGZ1bmN0aW9uKG8pew0KDQoJCXRoaXMuZXZlbnRzID0gdGhpcy5ldmVudHMgfHwge307DQoNCgkJaWYgKHR5cGVvZiBvID09ICdzdHJpbmcnKSB7DQoNCgkJCXZhciBhID0gYXJndW1lbnRzLA0KDQoJCQkJaSA9IGEubGVuZ3RoOw0KDQoJCQl3aGlsZShpLS0pIHsNCg0KCQkJCXRoaXMuZXZlbnRzW2FbaV1dID0gdGhpcy5ldmVudHNbYVtpXV0gfHwgdHJ1ZTsNCg0KCQkJfQ0KDQoJCX0NCg0KCX0NCg0KfTsNCg0KDQoNClVJLkV2ZW50TWdyID0gZnVuY3Rpb24oc2NvcGUsIGV2ZW50TmFtZSl7DQoNCgl0aGlzLnNjb3BlID0gc2NvcGU7DQoNCgl0aGlzLmV2ZW50TmFtZSA9IGV2ZW50TmFtZTsNCg0KCXRoaXMubGlzdGVuZXJzID0gW107DQoNCn0NCg0KDQpVSS5FdmVudE1nci5wcm90b3R5cGUgPSB7DQoNCglhZGRMaXN0ZW5lciA6IGZ1bmN0aW9uKGZuLCBzY29wZSwgb3B0aW9ucyl7DQoNCgkgICAgdmFyIGw7DQoNCgkgICAgc2NvcGUgPSBzY29wZSB8fCB0aGlzLnNjb3BlOw0KDQoJICAgIGlmKCF0aGlzLmlzTGlzdGVuaW5nKGZuLCBzY29wZSkpew0KDQoJICAgICAgICBsID0gdGhpcy5jcmVhdGVMaXN0ZW5lcihmbiwgc2NvcGUsIG9wdGlvbnMpOw0KDQoJICAgICAgICB0aGlzLmxpc3RlbmVycy5wdXNoKGwpOw0KDQoJICAgIH0NCg0KCX0sDQoNCgkNCg0KCWNyZWF0ZUxpc3RlbmVyOiBmdW5jdGlvbihmbiwgc2NvcGUsIG9wdGlvbnMpew0KDQoJCXZhciBvID0gbyB8fCB7fSwgc2NvcGUgPSBzY29wZSB8fCB0aGlzLm9iajsNCg0KICAgICAgICByZXR1cm4gew0KDQogICAgICAgICAgICBmbjogZm4sDQoNCiAgICAgICAgICAgIHNjb3BlOiBzY29wZSwNCg0KICAgICAgICAgICAgb3B0aW9uczogbw0KDQogICAgICAgIH0NCg0KCX0sDQoNCgkNCg0KCWZpbmRMaXN0ZW5lciA6IGZ1bmN0aW9uKGZuLCBzY29wZSl7DQoNCiAgICAgICAgdmFyIGxpc3QgPSB0aGlzLmxpc3RlbmVycywNCg0KICAgICAgICAgICAgaSA9IGxpc3QubGVuZ3RoLA0KDQogICAgICAgICAgICBsOw0KDQoNCiAgICAgICAgc2NvcGUgPSBzY29wZSB8fCB0aGlzLm9iajsNCg0KICAgICAgICB3aGlsZShpLS0pew0KDQogICAgICAgICAgICBsID0gbGlzdFtpXTsNCg0KICAgICAgICAgICAgaWYobCl7DQoNCiAgICAgICAgICAgICAgICBpZihsLmZuID09IGZuICYmIGwuc2NvcGUgPT0gc2NvcGUpew0KDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpOw0KDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAtMTsNCg0KICAgIH0sDQoNCg0KICAgIGlzTGlzdGVuaW5nIDogZnVuY3Rpb24oZm4sIHNjb3BlKXsNCg0KICAgICAgICByZXR1cm4gdGhpcy5maW5kTGlzdGVuZXIoZm4sIHNjb3BlKSAhPSAtMTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIHJlbW92ZUxpc3RlbmVyIDogZnVuY3Rpb24oZm4sIHNjb3BlKXsNCg0KICAgICAgICB2YXIgaW5kZXgsCXJldCA9IGZhbHNlOw0KDQogICAgICAgIGlmKChpbmRleCA9IHRoaXMuZmluZExpc3RlbmVyKGZuLCBzY29wZSkpICE9IC0xKXsNCg0KICAgICAgICAgICAgbWUubGlzdGVuZXJzLnNwbGljZShpbmRleCwgMSk7DQoNCiAgICAgICAgICAgIHJldCA9IHRydWU7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICBjbGVhckxpc3RlbmVyIDogZnVuY3Rpb24oKXsNCg0KICAgIAkgdmFyIGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzLCBpID0gbGlzdGVuZXJzLmxlbmd0aDsNCg0KICAgIAkgd2hpbGUoaS0tKSB7DQoNCiAgICAJCSB0aGlzLnJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyc1tpXS5mbiwgbGlzdGVuZXJzW2ldLnNjb3BlKTsNCg0KICAgIAkgfQ0KDQogICAgfSwNCg0KICAgIA0KDQogICAgZmlyZSA6IGZ1bmN0aW9uKCl7DQoNCiAgICAgICAgdmFyIGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzLA0KDQogICAgICAgICAgICBsZW4gPSBsaXN0ZW5lcnMubGVuZ3RoLA0KDQogICAgICAgICAgICBpID0gbGVuIC0xLA0KDQogICAgICAgICAgICBycyA9IHRydWUsDQoNCiAgICAgICAgICAgIGxpc3RlbmVyOw0KDQoNCiAgICAgICAgaWYobGVuID4gMCl7DQoNCiAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsNCg0KICAgICAgICAgICAgZm9yICg7IGkgPj0gMDsgaS0tKSANCg0KICAgICAgICAgICAgew0KDQogICAgICAgICAgICAJbGlzdGVuZXIgPSBsaXN0ZW5lcnNbaV07DQoNCiAgICAgICAgICAgIAlpZiAobGlzdGVuZXIpDQoNCiAgICAgICAgICAgIAl7DQoNCiAgICAgICAgICAgIAkJcnMgPSBsaXN0ZW5lci5mbi5hcHBseShsaXN0ZW5lci5zY29wZSB8fCB0aGlzLm9iaiB8fCB3aW5kb3csIGFyZ3MpOw0KDQogICAgICAgICAgICAJfQ0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgcmV0dXJuIHJzOy8vb25seSByZXR1cm4gZmlyc3QgZnVuY3Rpb24NCg0KICAgIH0NCg0KfQ0KDQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IENvbXBvbmVudC5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuDQoNCiAqIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246DQoNCiAqIHVzYWdlOg0KDQogKiBVSS5WMzYwQnV0dG9uID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQogKiBVdGlsLmV4dGVuZChVSS5WMzYwQnV0dG9uLCB7Li4uLi4uLn0pOw0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICogUmV2aXNpb24gSGlzdG9yeToNCg0KICogPDxEYXRlPj4sIDw8V2hvPj4sIDw8V2hhdD4+DQoNCiAqIDE1LzAxLzIwMTIsIFJheSBaaGFuZywgSW5pdGlhbCB2ZXJzaW9uDQoNCiAqIA0KDQogKiAqLw0KDQoNClVJLkNvbXBvbmVudCA9IGZ1bmN0aW9uKCkgew0KDQoJdmFyIF9jbGFzcyA9IGZ1bmN0aW9uKGNvbmZpZyl7DQoNCgkJdGhpcy5jb25maWcgPSBjb25maWcgfHwge307DQoNCgkJDQoNCgkJdGhpcy5pbml0LmNhbGwodGhpcywgdGhpcy5jb25maWcpOw0KDQoJfQ0KDQoJX2NsYXNzID0gVXRpbC5leHRlbmQoX2NsYXNzLCBVSS5Db21wb25lbnQpOw0KDQoJX2NsYXNzLmV4dGVuZCA9IGZ1bmN0aW9uKG9iamVjdCkNCg0KCXsNCg0KCQlpZiAodHlwZW9mIG9iamVjdCAhPSAib2JqZWN0IikNCg0KCQkJcmV0dXJuOw0KDQoJCS8vd2UgY2FuIGluamVjdCBzb21lIHByb3BlcnR5IGluIGhlcmUuDQoNCgkJVXRpbC5leHRlbmQodGhpcywgb2JqZWN0KTsNCg0KCX0NCg0KCXJldHVybiBfY2xhc3M7DQoNCn07DQoNCg0KVXRpbC5leHRlbmQoVUkuQ29tcG9uZW50LCBVSS5PYnNlcnZhYmxlLCB7DQoNCgkNCg0KCWlkUHJldmlvdXMgOiAiY29tcG9uZW50LSIsDQoNCgkNCg0KCWdldElkIDogZnVuY3Rpb24oKXsNCg0KCQlpZih0aGlzLmlkKQ0KDQoJCQlyZXR1cm4gdGhpcy5pZDsNCg0KCQlyZXR1cm4gdGhpcy5pZFByZXZpb3VzICsgVXRpbC5pbmNyZWFzZSgpOyANCg0KCX0sDQoNCgkNCg0KCS8qDQoNCgkgKkNvbnZlcnQgZXZlbnRzIG9iamVjdCB0byBIVE1MIGZvcm1hdCBldmVudHMuIA0KDQoJICovDQoNCglldmVudHNUb0hUTUwgOiBmdW5jdGlvbihldmVudE1hcCxzdXBwb3J0RXZlbnRzKXsNCg0KCQl2YXIgZXZlbnRCdWlsZGVyID0gbmV3IEFycmF5KCk7DQoNCgkJZm9yKHZhciBldmVudE5hbWUgaW4gZXZlbnRNYXApew0KDQoJCQl2YXIgZXZlbnROYW1lTEMgPSBldmVudE5hbWUudG9Mb3dlckNhc2UoKTsNCg0KCQkJaWYoQWMzNjAuaW5kZXhPZkFycmF5KHN1cHBvcnRFdmVudHMsZXZlbnROYW1lTEMpPi0xICYmIGV2ZW50TWFwW2V2ZW50TmFtZV0pew0KDQoJCQkJZXZlbnRCdWlsZGVyLnB1c2goIiBvbiIpOw0KDQoJCQkJZXZlbnRCdWlsZGVyLnB1c2goZXZlbnROYW1lTEMpOw0KDQoJCQkJZXZlbnRCdWlsZGVyLnB1c2goIj0nIik7DQoNCgkJCQlldmVudEJ1aWxkZXIucHVzaChldmVudE1hcFtldmVudE5hbWVdKTsNCg0KCQkJCWV2ZW50QnVpbGRlci5wdXNoKCInIik7DQoNCgkJCX0NCg0KCQl9DQoNCgkJcmV0dXJuIGV2ZW50QnVpbGRlci5qb2luKCIiKTsNCg0KCX0sDQoNCgkNCg0KCS8qDQoNCgkgKiBCaW5kIGV2ZW50cyB0byB0YXJnZXQgb2JqZWN0Lg0KDQoJICovDQoNCgliaW5kRXZlbnRzIDogZnVuY3Rpb24odGFyZ2V0LGV2ZW50TWFwLHN1cHBvcnRFdmVudHMpew0KDQoJCWZvcih2YXIgZXZlbnROYW1lIGluIGV2ZW50TWFwKXsNCg0KCQkJdmFyIGV2ZW50TmFtZUxDID0gZXZlbnROYW1lLnRvTG93ZXJDYXNlKCk7DQoNCgkJCWlmKEFjMzYwLmluZGV4T2ZBcnJheShzdXBwb3J0RXZlbnRzLGV2ZW50TmFtZUxDKT4tMSAmJiBldmVudE1hcFtldmVudE5hbWVdKXsNCg0KCQkJCUJhc2VKUy5hZGRFdmVudEhhbmRsZXIodGFyZ2V0LGV2ZW50TmFtZUxDLG5ldyBGdW5jdGlvbihldmVudE1hcFtldmVudE5hbWVdKSk7DQoNCgkJCX0NCg0KCQl9DQoNCgl9LA0KDQoJDQoNCglwYXJzZVdpZHRoIDogZnVuY3Rpb24oc3R5bGUpew0KDQoJCXZhciB3aWR0aFB0biA9IC93aWR0aFxzKjpccyooXGQrKS9naTsNCg0KCQl2YXIgbWF0Y2hlcyA9IHdpZHRoUHRuLmV4ZWMoc3R5bGUpOw0KDQoJCWlmKG1hdGNoZXMpew0KDQoJCQlyZXR1cm4gcGFyc2VJbnQobWF0Y2hlc1sxXSk7DQoNCgkJfQ0KDQoJCXJldHVybiAwOw0KDQoJfSwNCg0KCQ0KDQoJLy8xLiBzaG91bGQgcmUtd3JpdGUNCg0KCWluaXQgOiBmdW5jdGlvbihjb25maWcpew0KDQoJCWFsZXJ0KCJpbml0Iik7DQoNCgl9LA0KDQoJDQoNCgkvLzIuIHJlLXdyaXRlDQoNCglyZW5kZXIgOiBmdW5jdGlvbigpe30sDQoNCgkNCg0KCS8vMy4gcmUtd3JpdGUNCg0KCWFkZERlZmF1bHRFdmVudCA6IGZ1bmN0aW9uKCl7fSwNCg0KCQ0KDQoJLyoNCg0KCSAqIElmIHRoZSBwYXJhbWV0ZXIgZGF0YSBpcyBub3Qgc3BlY2lmaWVkLCB0aGUgb3V0ZXJIVE1MIG9mIGEgZGVmYXVsdCBpbnN0YW5jZSBvZiB0aGlzIGNvbXBvbmVudCB3aWxsIGJlIHJldHVybmVkLiAgDQoNCgkgKiBAcGFyYW0gZGF0YTogZGF0YSB0byBpbml0aWFsaXplIHRoaXMgY29tcG9uZW50Lg0KDQoJICovDQoNCglnZXRPdXRlckhUTUwgOiBmdW5jdGlvbihkYXRhKXt9LA0KDQoJDQoNCgkvKg0KDQoJICogQHBhcmFtIHNpYmxpbmc6IERPTSBvYmplY3Qgd2l0aCB0aGUgc2FtZSB0eXBlIGFzIHRoaXMgY29tcG9uZW50LiANCg0KCSAqLw0KDQoJcGFyc2VTaWJsaW5nVmFsdWUgOiBmdW5jdGlvbihzaWJsaW5nKXt9LA0KDQoJDQoNCglnZXRIdG1sIDogZnVuY3Rpb24oKXt9LA0KDQoJDQoNCglrZXlDb2RlIDoge3VwIDogMzgsCWRvd24gOiA0MCwJcmlnaHQgOiAzOSwJbGVmdCA6IDM3LAllbnRlciA6IDEzLCB0YWIgOiA5fSwNCg0KCQ0KDQoJanNUb0h0bWwgOiBmdW5jdGlvbihzdHIpew0KDQoJICAgIHJldHVybiBzdHIucmVwbGFjZSgvJy9nLCAiXFwnIik7DQoNCgl9LA0KDQoJDQoNCgllbnZpcm9ubWVudCA6IHt3ZWJQYXRoIDogIiJ9LA0KDQoJDQoNCgkvL2ludm9rZSBpbiBFbGVtZW50U3VwcG9ydC5lbmNvZGVFbGVtQXR0cmlidXRlDQoNCgluZWVkVG9FbmNvZGUgOiAndHJ1ZScNCg0KfSk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IEZvcm1MYXlvdXQuanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiA8PENvbW1vbiBmb3JtIGxheW91dCBmb3IgQWMzNjA+Pg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICoNCg0KICovDQoNCg0KVUkuRWxlbWVudFN1cHBvcnQgPSBmdW5jdGlvbigpew0KDQp9DQoNCg0KVUkuRWxlbWVudFN1cHBvcnQucHJvdG90eXBlID0gew0KDQoJCS8qDQoNCgkgKiBDYWNoZSB0aGUgd2lkZ2V0IGluc3RhbmNlIHRvIGF2b2lkIGNyZWF0ZSBpdCBtYW55IHRpbWVzLg0KDQoJICovDQoNCgl3aWRnZXRDYWNoZSA6IG5ldyBPYmplY3QoKSwNCg0KCS8qDQoNCgkgKiBTb21lIGVsZW1lbnRzIGFyZSBub3QgaW1wbGVtZW50ZWQgaW4gcHVyZSBIVE1MIGZvcm1hdCwgd2UgaGF2ZSB0byBhZGQgdGhlbSB0byBncm91cCB0YWJsZSBhZnRlciBncm91cCB0YWJsZSBoYXMgYmVlbiByZW5kZXJlZC4NCg0KCSAqIFRoZSBjb250YWluZXIgaWQgb2YgdGhlc2UgZWxlbWVudHMgd2lsbCBiZSB1c2VkIGFzIHRoZSBrZXkgb2YgdGhpcyBtYXAsIGFuZCB0aGUgY29ycmVzcG9uZGluZyBqYXZhIHNjcmlwdCBjb21wb25lbnQgaW5zdGFuY2UgaXMgDQoNCgkgKiB0aGlzIG1hcCdzIHZhbHVlLg0KDQoJICovDQoNCglkZWxheUFwcGVuZE1hcCA6IG5ldyBPYmplY3QoKSwNCg0KCQ0KDQoJZ2V0V2lkZ2V0ICA6ICBmdW5jdGlvbih0eXBlKXsNCg0KCQlpZighdGhpcy53aWRnZXRDYWNoZVt0eXBlXSl7DQoNCgkJCXRoaXMud2lkZ2V0Q2FjaGVbdHlwZV0gPSBXaWRnZXRNYW5hZ2VyLmdldFdpZGdldCh0eXBlKTsNCg0KCQkJdGhpcy53aWRnZXRDYWNoZVt0eXBlXS5nZXRPdXRlckhUTUxXcmFwcGVyID0gZnVuY3Rpb24oZGF0YSl7DQoNCgkJCQkJCWlmKCFkYXRhLmlkKXsNCg0KCQkJCQkJCWRhdGEuaWQgPSB0aGlzLmlkUHJldmlvdXMgKyBBYzM2MC5pbmNyZWFzZSgpOw0KDQoJCQkJCQl9DQoNCgkJCQkJCXJldHVybiB0aGlzLmdldE91dGVySFRNTChkYXRhKTsNCg0KCQkJCQl9Ow0KDQoJCX0NCg0KCQlyZXR1cm4gdGhpcy53aWRnZXRDYWNoZVt0eXBlXTsNCg0KCX0sDQoNCgkNCg0KCXJlbmRlckRlbGF5ZWRFbGVtIDogZnVuY3Rpb24oKXsNCg0KCQlmb3IodmFyIGRlbGF5SWQgaW4gdGhpcy5kZWxheUFwcGVuZE1hcCl7DQoNCgkJCXRoaXMuZGVsYXlBcHBlbmRNYXBbZGVsYXlJZF0ucmVuZGVyKCk7DQoNCgkJfQ0KDQoJCXRoaXMuZGVsYXlBcHBlbmRNYXAgPSBudWxsOw0KDQoJfSwNCg0KCQ0KDQoJZ2VuZXJhdGVIVE1MRWxlbWVudCA6IGZ1bmN0aW9uKGh0bWxFbGVtZW50SGVhZCxodG1sRWxlbWVudERhdGEsY29udGFpbmVySWQpew0KDQoJCXZhciBjZWxsQnVpbGRlciA9IG5ldyBBcnJheSgpOw0KDQoJCXZhciBkYXRhID0gaHRtbEVsZW1lbnREYXRhOw0KDQoJCWRhdGEuZXZlbnRNYXAgPSBkYXRhLmV2ZW50RGVmaW5lOw0KDQoJCWRhdGEuY29udGFpbklkID0gY29udGFpbmVySWQ7DQoNCgkJZGF0YS5pdGVtcyA9IGRhdGEuaXRlbXMgfHwgaHRtbEVsZW1lbnRIZWFkLml0ZW1zOw0KDQoJCQ0KDQoJCXZhciB3aWRnZXQgPSB0aGlzLmdldFdpZGdldChodG1sRWxlbWVudEhlYWQuZWxlbWVudFR5cGUpOw0KDQoJCQ0KDQoJCWRhdGEgPSB0aGlzLmVuY29kZUVsZW1BdHRyaWJ1dGUoZGF0YSwgd2lkZ2V0KTsNCg0KCQkNCg0KCQl2YXIgZWxlbUNvbnRlbnQgPSB3aWRnZXQuZ2V0T3V0ZXJIVE1MV3JhcHBlcihkYXRhKTsNCg0KCQkNCg0KCQlpZihlbGVtQ29udGVudD09dW5kZWZpbmVkKXsNCg0KCQkJdmFyIHdpZGdldCA9IFdpZGdldE1hbmFnZXIuZ2V0V2lkZ2V0KGh0bWxFbGVtZW50SGVhZC5lbGVtZW50VHlwZSk7DQoNCgkJCXdpZGdldC5pbml0KGRhdGEpOw0KDQoJCQl0aGlzLmRlbGF5QXBwZW5kTWFwW2NvbnRhaW5lcklkXT0gd2lkZ2V0Ow0KDQoJCX1lbHNlIGlmKHR5cGVvZiBlbGVtQ29udGVudCA9PSAic3RyaW5nIil7DQoNCgkJCWNlbGxCdWlsZGVyLnB1c2goZWxlbUNvbnRlbnQpOw0KDQoJCX0NCg0KCQ0KDQoJCXZhciBjb250ZW50ID0gY2VsbEJ1aWxkZXIuam9pbigiIik7DQoNCgkJaWYgKEFjMzYwLnZhbGlkYXRvci5pc0VtcHR5KGNvbnRlbnQpKQ0KDQoJCSAgY29udGVudCA9ICImbmJzcDsiOw0KDQoJCQ0KDQoJCXJldHVybiBjb250ZW50Ow0KDQoJfSwNCg0KCQ0KDQoJLy9lbmNvZGUgYWxsIHRoZSBwcm9wZXJ0eS4NCg0KCWVuY29kZUVsZW1BdHRyaWJ1dGUgOiBmdW5jdGlvbihlbGVtRGF0YSwgd2lkZ2V0KXsNCg0KCQlpZighZWxlbURhdGEpew0KDQoJCQlyZXR1cm4gZWxlbURhdGE7DQoNCgkJfQ0KDQoJCWZvcih2YXIgaXRlbSBpbiBlbGVtRGF0YSl7DQoNCgkJCWlmKHR5cGVvZiBlbGVtRGF0YVtpdGVtXSA9PSAic3RyaW5nIiAmJiBpdGVtIT0idGV4dCIpew0KDQoJCQkJZWxlbURhdGFbaXRlbV09IEJhc2VKUy5odG1sRW5jb2RlKGVsZW1EYXRhW2l0ZW1dKTsNCg0KCQkJfWVsc2UgaWYodHlwZW9mIGVsZW1EYXRhW2l0ZW1dID09ICJzdHJpbmciICYmIGl0ZW09PSJ0ZXh0IiAmJiB3aWRnZXQubmVlZFRvRW5jb2RlID09ICd0cnVlJyl7DQoNCiAgICAgICAgICAgICAgICB2YXIgaHRtbEVuY29kZSA9IGVsZW1EYXRhLmh0bWxFbmNvZGU7DQoNCiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGVsZW1EYXRhW2l0ZW1dOw0KDQogICAgICAgICAgICAgICAgaWYoIUFjMzYwLnZhbGlkYXRvci5pc0VtcHR5KHRleHQpKQ0KDQogICAgICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgICAgIGlmIChBYzM2MC52YWxpZGF0b3IuaXNFbXB0eShodG1sRW5jb2RlKSB8fCAidHJ1ZSIgIT0gaHRtbEVuY29kZSkNCg0KICAgICAgICAgICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1EYXRhW2l0ZW1dID0gQmFzZUpTLmh0bWxFbmNvZGUodGV4dCk7DQoNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbGVtRGF0YVtpdGVtXSA9PSAic3RyaW5nIiAmJiBpdGVtID09ICJ0ZXh0IiAmJiB3aWRnZXQuZW5jb2RlKQ0KDQoJCQl7DQoNCgkJCQl2YXIgdGV4dCA9IGVsZW1EYXRhW2l0ZW1dOw0KDQoJCQkJaWYgKCFBYzM2MC52YWxpZGF0b3IuaXNFbXB0eSh0ZXh0KSkNCg0KCQkJCXsNCg0KCQkJCQllbGVtRGF0YVtpdGVtXSA9IHdpZGdldC5lbmNvZGUodGV4dCk7DQoNCgkJCQl9DQoNCgkJCX0NCg0KCQkJDQoNCgkJfQ0KDQoJCXZhciBldmVudE1hcCA9IGVsZW1EYXRhWydldmVudE1hcCddIHx8e307DQoNCgkJZm9yKHZhciBldmVudE5hbWUgaW4gZXZlbnRNYXApew0KDQoJCQlpZih0eXBlb2YgZXZlbnRNYXBbZXZlbnROYW1lXSA9PSAic3RyaW5nIil7DQoNCgkJCQlldmVudE1hcFtldmVudE5hbWVdID0gQmFzZUpTLmh0bWxFbmNvZGUoZXZlbnRNYXBbZXZlbnROYW1lXSk7DQoNCgkJCX0NCg0KCQl9DQoNCgkJcmV0dXJuIGVsZW1EYXRhOw0KDQoJfQ0KDQp9Ow0KDQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IERyb3BNZW51LmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjoNCg0KICogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczoNCg0KICogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKiBSZXZpc2lvbiBIaXN0b3J5Og0KDQogKiA8PERhdGU+PiwgPDxXaG8+PiwgPDxXaGF0Pj4NCg0KICogMTUvMDEvMjAxMiwgUmF5IFpoYW5nLCBJbml0aWFsIHZlcnNpb24NCg0KICoNCg0KICovDQoNCg0KLy92YXIgbWVudSA9IG5ldyBVSS5Ecm9wTWVudShbe3RleHQ6IGFhLCB1cmw6Li4sIGNsaWNrOn0sIHt0ZXh0OiB9XSk7DQoNCg0KVUkuRHJvcE1lbnUgPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNClVJLkRyb3BNZW51LmV4dGVuZCh7DQoNCgkNCg0KCWlkUHJldmlvdXMgOiAiZHJvcE1lbnUtIiwNCg0KCQ0KDQoJaXRlbXM6IG51bGwsDQoNCgkNCg0KCXNlbGVjdEluZGV4IDogLTEsDQoNCgkNCg0KCS8vZHJvcCBtZW51IHNob3cgc3RhdHVzLiB3aGVuIGlzU2hvdyA9IHRydWUsIHNob3cgZHJvcCBtZW51Lg0KDQoJaXNTaG93IDogZmFsc2UsDQoNCgkNCg0KCS8vZHJvcCBtZW51IHBhcmVudCBvYmplY3QsIGl0IGlzIGEgbWVudSBpdGVtLg0KDQoJcGFyZW50TWVudUl0ZW1PYmogOiBudWxsLA0KDQoJDQoNCgl0aW1lb3V0SWQ6IG51bGwsDQoNCgkNCg0KCS8vMS4gW3t0ZXh0OiAnMTExJywgY2xpY2s6IGZ1bmN0aW9uKCl7fSwgY2hpbGRyZW46IFt7dGV4dDogJzIyMicsIGNsaWNrOiBmdW5jdGlvbigpe319XX0sIHt0ZXh0OiAnMzMzJywgY2xpY2s6IGZ1bmN0aW9uKCl7fV0NCg0KCWluaXQgOiBmdW5jdGlvbihjb25maWcpew0KDQoNCgkJaWYoQWMzNjAudmFsaWRhdG9yLmlzRW1wdHkoY29uZmlnKSB8fCBjb25maWcgPT0gIm51bGwiKQ0KDQoJCXsNCg0KCQkJcmV0dXJuOw0KDQoJCX0NCg0KCQkNCg0KCQl0aGlzLml0ZW1zID0gbmV3IEFycmF5KCk7DQoNCgkJDQoNCgkJaWYgKHR5cGVvZihjb25maWcpID09ICJzdHJpbmciKQ0KDQoJCXsNCg0KCQkJY29uZmlnID0gQmFzZUpTLnN0clRvSnNvbihjb25maWcpOw0KDQoJCX0NCg0KCQkNCg0KCQkvL2dlbmVyYXRvciBtZW51IGl0ZW0NCg0KCQlmb3IgKHZhciBpID0wOyBpIDwgY29uZmlnLmxlbmd0aDsgaSsrKXsNCg0KCQkJdGhpcy5jcmVhdGVJdGVtKGNvbmZpZ1tpXSk7DQoNCgkJfTsNCg0KDQoJCS8vb25seSBzdXBlciB0aG9zZSBldmVudA0KDQoJCXRoaXMuYWRkRXZlbnRzKCJvbnNob3ciLCAic2hvd2VkIiwgImNsb3NlIiwgImhpZGRlbiIsICJtb3VzZWVudGVyIiwgIm1vdXNlbGVhdmUiLCAia2V5ZG93biIsICJ1cCIsICJkb3duIiwgImxlZnQiLCAicmlnaHQiLCAiYmx1ciIpOw0KDQoNCgl9LA0KDQoJDQoNCgkvLzIucmVuZGVyDQoNCglyZW5kZXIgOiBmdW5jdGlvbihzcmNJZCl7DQoNCgkJaWYoQWMzNjAudmFsaWRhdG9yLmlzRW1wdHkodGhpcy5pdGVtcykpDQoNCgkJew0KDQoJCQlyZXR1cm47DQoNCgkJfQ0KDQoJCQ0KDQoJCXZhciBjb250YWluID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQoNCgkJY29udGFpbi5jbGFzc05hbWUgPSAiZHJvcE1lbnVlRGl2IjsNCg0KCQljb250YWluLmlkID0gdGhpcy5nZXRJZCgpOwkNCg0KCQl0aGlzLm1lbnVJZCA9IGNvbnRhaW4uaWQ7DQoNCgkJdGhpcy5jb250YWluID0gY29udGFpbjsNCg0KCQljb250YWluLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoNCgkJDQoNCgkJdmFyIHRhYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsNCg0KCQl0YWIuaWQgPSB0aGlzLmdldElkKCk7DQoNCgkJdGFiLmhyZWYgPSAiIyI7DQoNCgkJdGFiLnRhYkluZGV4ID0gIi0xIjsNCg0KCQl0YWIub25jbGljayA9ICJyZXR1cm4gZmFsc2U7IjsNCg0KCQljb250YWluLmFwcGVuZENoaWxkKHRhYik7DQoNCgkJDQoNCgkJdmFyIHVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTsNCg0KCQkNCg0KCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspDQoNCgkJew0KDQoJCQl2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOw0KDQoJCQlsaS5hcHBlbmRDaGlsZCh0aGlzLml0ZW1zW2ldLmdldE1lbnVJdGVtKCkpOw0KDQoJCQl1bC5hcHBlbmRDaGlsZChsaSk7DQoNCgkJfQ0KDQoJCWNvbnRhaW4uYXBwZW5kQ2hpbGQodWwpOw0KDQoJDQoNCgkJLy9pbnNlcnQgYXMgYm9keSBmaXJzdCBub2RlDQoNCgkJdmFyIGZpcnN0Q2hpbGQgPSBkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGQ7DQoNCgkJdGhpcy5wYXJlbnROb2RlID0gZG9jdW1lbnQuYm9keTsNCg0KCQlkb2N1bWVudC5ib2R5Lmluc2VydEJlZm9yZShjb250YWluLCBmaXJzdENoaWxkKTsNCg0KCQkNCg0KCQl0aGlzLmFkZERlZmF1bHRFdmVudCgpOw0KDQoJfSwNCg0KDQoJLy8zLg0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXRoaXMuY29udGFpblsib25tb3VzZWVudGVyIl0gID0gdGhpcy5vbm1vdXNlRW50ZXIuYmluZCh0aGlzKTsNCg0KCQl0aGlzLmNvbnRhaW5bIm9ubW91c2VsZWF2ZSJdICA9IHRoaXMub25tb3VzZUxlYXZlLmJpbmQodGhpcyk7DQoNCgkJdGhpcy5jb250YWluWyJvbmtleWRvd24iXSAgPSB0aGlzLm9ua2V5RG93bi5iaW5kKHRoaXMpOw0KDQoJCXRoaXMuY29udGFpblsib25ibHVyIl0gID0gdGhpcy5vbmJsdXIuYmluZCh0aGlzKTsNCg0KCQl0aGlzLmFkZExpc3RlbmVyKCJzaG93ZWQiLCBmdW5jdGlvbigpew0KDQoJCQl0cnl7DQoNCgkJCQl2YXIgcGFyZW50X2ZyYW1lID0gZG9jdW1lbnQuZnJhbWVzLmZyYW1lRWxlbWVudDsNCg0KCQkJCWlmKHNjcm9sbEJhcklzc3VlLmp1ZGdlSXNPYmoocGFyZW50X2ZyYW1lKSkNCg0KCQkJCXsNCg0KCQkJCQl2YXIgaWdub3JlXyA9IHBhcmVudF9mcmFtZS5nZXRBdHRyaWJ1dGUoImlnbm9yZSIpOw0KDQoJCQkJCWlmKCFzY3JvbGxCYXJJc3N1ZS5qdWRnZUlzTnVsbChpZ25vcmVfKSl7CQkJCQkNCg0KCQkJCQkJaWYocGFyZW50X2ZyYW1lLnBvcFVwQWRkSWdub3JlKXsNCg0KCQkJCQkJCXBhcmVudF9mcmFtZS5yZW1vdmVBdHRyaWJ1dGUoImlnbm9yZSIpOw0KDQoJCQkJCQl9DQoNCgkJCQkJfQ0KDQoJCQkJfQ0KDQoJCQl9Y2F0Y2goZSl7fQ0KDQoJCX0pOw0KDQoJfSwNCg0KDQoJb25tb3VzZUVudGVyIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXRoaXMuZmlyZUV2ZW50KCJtb3VzZWVudGVyIik7DQoNCgkJDQoNCgkJLy9zZXQgcGFyZW50IG1lbnUgaXRlbSBzZWxlY3RlZCBzdHlsZQ0KDQoJCXRoaXMuc2V0U2VsZWN0ZWRNZW51U3R5bGUodHJ1ZSk7DQoNCgkJDQoNCgkJLy9zZXQgZHJvcCBtZW51IGFuZCBwYXJlbnQgZHJvcCBtZW51IGlzU2hvdyBzdGF0dXMuDQoNCgkJdGhpcy5pc1Nob3cgPSB0cnVlOw0KDQoJCWlmKHRoaXMudGltZW91dElkKQ0KDQoJCXsNCg0KCQkJY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dElkKTsNCg0KCQkJdGhpcy50aW1lb3V0SWQgPSBudWxsOw0KDQoJCX0NCg0KCQl0aGlzLmV2dFByb3BhZ2F0aW9uKHRoaXMsIHRydWUpOw0KDQoJfSwNCg0KCQ0KDQoJb25tb3VzZUxlYXZlIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXRoaXMuZmlyZUV2ZW50KCJtb3VzZWxlYXZlIik7DQoNCgkJDQoNCgkJdGhpcy5pc1Nob3cgPSBmYWxzZTsNCg0KCQl0aGlzLmhpZGRlbk1lbnUoKTsNCg0KCQl0aGlzLmV2dFByb3BhZ2F0aW9uKHRoaXMsIGZhbHNlKTsNCg0KCX0sDQoNCgkNCg0KCS8vc2V0IHBhcmVudCBtZW51IGl0ZW0gc2VsZWN0ZWQgc3R5bGUuICBmbGFnOiB0cnVlLCAgcGFyZW50IG1lbnUgc2VsZWN0ZWQuDQoNCglzZXRTZWxlY3RlZE1lbnVTdHlsZSA6IGZ1bmN0aW9uKGZsYWcpDQoNCgl7DQoNCgkJaWYodGhpcy5wYXJlbnRNZW51SXRlbU9iaiAmJiB0aGlzLnBhcmVudE1lbnVJdGVtT2JqLm9uYmFja0NvbG9yKQ0KDQoJCXsNCg0KCQkJaWYoZmxhZykNCg0KCQkJew0KDQoJCQkJdGhpcy5wYXJlbnRNZW51SXRlbU9iai5vbmJhY2tDb2xvcigpOw0KDQoJCQl9IGVsc2Ugew0KDQoJCQkJdGhpcy5wYXJlbnRNZW51SXRlbU9iai5sb3N0YmFja0NvbG9yKCk7DQoNCgkJCX0NCg0KCQl9DQoNCgl9LA0KDQoJDQoNCgkvL2hpZGRlbiBjdXJyZW50IGRyb3AgbWVudSB3aGVuIG1vdXNlIG91dC4NCg0KCWhpZGRlbk1lbnUgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJaWYgKCF0aGlzLnRpbWVvdXRGbikNCg0KICAgIAl7DQoNCiAgICAJCXRoaXMudGltZW91dEZuID0gZnVuY3Rpb24oKXsNCg0KICAgIAkJCWlmKHRoaXMuY29udGFpbiAmJiAhdGhpcy5pc1Nob3cpDQoNCiAgICAJCQl7DQoNCiAgICAJCQkJdGhpcy5jb250YWluLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoNCiAgICAJCQkJDQoNCiAgICAJCQkJLy9zZXQgcGFyZW50IG1lbnUgaXRlbSBzZWxlY3RlZCBzdHlsZQ0KDQogICAgCQkJCXRoaXMuc2V0U2VsZWN0ZWRNZW51U3R5bGUoZmFsc2UpOw0KDQogICAgCQkJfQ0KDQogICAgCQl9LmJpbmQodGhpcyk7DQoNCiAgICAJfQ0KDQoJCQ0KDQoJCWNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXRJZCk7DQoNCgkJdGhpcy50aW1lb3V0SWQgID0gc2V0VGltZW91dCh0aGlzLnRpbWVvdXRGbiwgMTAwKTsNCg0KCX0sDQoNCgkNCg0KCS8qKg0KDQoJICogZXZlbnQgcHJvcGFnYXRpb24sIGxvb3AgaGlkZGVuIHBhcmVudCBkcm9wIG1lbnUuDQoNCgkgKiBvYmo6IERyb3BNZW51IE9iamVjdC4gIGZsYWc6IHRydWUvZmFsc2UuICBpc0ltbWVkaWF0ZWx5SGlkZGVuOiB0cnVlL2ZhbHNlDQoNCgkgKi8NCg0KCWV2dFByb3BhZ2F0aW9uIDogZnVuY3Rpb24ob2JqLCBmbGFnLCBpc0ltbWVkaWF0ZWx5SGlkZGVuKQ0KDQoJew0KDQoJCS8vb2JqLnBhcmVudE1lbnVJdGVtT2JqIGlzIGEgbWVudSBpdGVtIG9iamVjdC4gb2JqLnBhcmVudE1lbnVJdGVtT2JqLnBhcmVudERyb3BNZW51T2JqIGlzIGEgZHJvcCBtZW51IG9iamVjdC4NCg0KCQlpZihvYmogJiYgb2JqLnBhcmVudE1lbnVJdGVtT2JqICYmIG9iai5wYXJlbnRNZW51SXRlbU9iai5wYXJlbnREcm9wTWVudU9iaikNCg0KCQl7DQoNCgkJCXZhciBwYXJlbnREcm9wTWVudU9iaiA9IG9iai5wYXJlbnRNZW51SXRlbU9iai5wYXJlbnREcm9wTWVudU9iajsNCg0KCQkJcGFyZW50RHJvcE1lbnVPYmouaXNTaG93ID0gZmxhZzsNCg0KCQkJaWYoIWZsYWcgJiYgcGFyZW50RHJvcE1lbnVPYmouaGlkZGVuTWVudSkNCg0KCQkJew0KDQoJCQkJaWYoaXNJbW1lZGlhdGVseUhpZGRlbikNCg0KCQkJCXsNCg0KCQkJCQlwYXJlbnREcm9wTWVudU9iai5jb250YWluLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoNCgkJCQl9IGVsc2Ugew0KDQoJCQkJCXBhcmVudERyb3BNZW51T2JqLmhpZGRlbk1lbnUoKTsNCg0KCQkJCX0NCg0KCQkJfQ0KDQoJCQkNCg0KCQkJdGhpcy5ldnRQcm9wYWdhdGlvbihwYXJlbnREcm9wTWVudU9iaiwgZmxhZywgaXNJbW1lZGlhdGVseUhpZGRlbik7DQoNCgkJfQ0KDQoJCWVsc2UNCg0KCQl7DQoNCgkJCS8vIGJpbmQgZHJvcCBtZW51IHRvIGVsZW1lbnQNCg0KCQkJaWYgKG9iaiAmJiBvYmouYmluZE1lbnUpDQoNCgkJCXsNCg0KCQkJCW9iai5iaW5kTWVudS5pc1Nob3cgPSBmbGFnOw0KDQoJCQkJaWYgKCFmbGFnKQ0KDQoJCQkJew0KDQoJCQkJCW9iai5iaW5kTWVudS5vbm1vdXNlTGVhdmUoKTsNCg0KCQkJCX0JDQoNCgkJCX0NCg0KCQl9DQoNCgl9LA0KDQoNCglvbmtleURvd24gOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJc3dpdGNoKGV2ZW50LmtleUNvZGUpDQoNCgkJew0KDQoJCQljYXNlIHRoaXMua2V5Q29kZS51cDoNCg0KCQkJCXRoaXMudXAoKTsNCg0KCQkJYnJlYWs7DQoNCgkJCWNhc2UgdGhpcy5rZXlDb2RlLmRvd246DQoNCgkJCQl0aGlzLmRvd24oKTsNCg0KCQkJYnJlYWs7DQoNCgkJCWNhc2UgdGhpcy5rZXlDb2RlLmxlZnQ6DQoNCgkJCQl0aGlzLmxlZnQoKTsNCg0KCQkJYnJlYWs7DQoNCgkJCWNhc2UgdGhpcy5rZXlDb2RlLnJpZ2h0Og0KDQoJCQkJdGhpcy5yaWdodCgpOw0KDQoJCQlicmVhazsNCg0KCQkJY2FzZSB0aGlzLmtleUNvZGUudGFiOg0KDQoJCQkJdGhpcy50YWIoKTsNCg0KCQkJYnJlYWs7DQoNCgkJfQ0KDQoJCXRoaXMuZmlyZUV2ZW50KCJrZXlkb3duIik7DQoNCgl9LA0KDQoJDQoNCglvbmJsdXIgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkgICAgDQoNCgkJdGhpcy5maXJlRXZlbnQoImJsdXIiKTsNCg0KCX0sDQoNCgkNCg0KCXVwIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCS8vIGhpZGRlbiBzdWIgbWVudQ0KDQoJCXRoaXMua2V5Ym9hcmRIaWRkZW5DaGlsZCgpOw0KDQoJCQ0KDQoJCXRoaXMuc2VsZWN0SW5kZXggLT0gMTsNCg0KCQlpZiAodGhpcy5zZWxlY3RJbmRleCA8PSAtMSkNCg0KCQl7DQoNCgkJCXRoaXMuc2VsZWN0SW5kZXggPSB0aGlzLml0ZW1zLmxlbmd0aCAtIDE7DQoNCgkJfQ0KDQoJCWlmKCF0aGlzLml0ZW1zW3RoaXMuc2VsZWN0SW5kZXhdLm1lbnVJdGVtLmlzRGlzYWJsZWQpDQoNCgkJew0KDQoJCQl0aGlzLml0ZW1zW3RoaXMuc2VsZWN0SW5kZXhdLm1lbnVJdGVtLmZvY3VzKCk7DQoNCgkJCS8vIHNob3cgc3ViIG1lbnUNCg0KCQkJdGhpcy5rZXlib2FyZFNob3dDaGlsZCgpOw0KDQoNCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJZG93biA6IGZ1bmN0aW9uKCl7DQoNCgkJLy8gaGlkZGVuIHN1YiBtZW51DQoNCgkJdGhpcy5rZXlib2FyZEhpZGRlbkNoaWxkKCk7DQoNCg0KCQlpZiAodGhpcy5zZWxlY3RJbmRleCA9PSB0aGlzLml0ZW1zLmxlbmd0aCAtIDEpDQoNCgkJew0KDQoJCQl0aGlzLnNlbGVjdEluZGV4ID0gMDsNCg0KCQl9DQoNCgkJZWxzZQ0KDQoJCXsNCg0KCQkJdGhpcy5zZWxlY3RJbmRleCArPSAxOw0KDQoJCX0NCg0KCQlpZighdGhpcy5pdGVtc1t0aGlzLnNlbGVjdEluZGV4XS5tZW51SXRlbS5pc0Rpc2FibGVkKQ0KDQoJCXsJDQoNCgkJCXRoaXMuaXRlbXNbdGhpcy5zZWxlY3RJbmRleF0ubWVudUl0ZW0uZm9jdXMoKTsNCg0KCQkJLy8gc2hvdyBzdWIgbWVudQ0KDQoJCQl0aGlzLmtleWJvYXJkU2hvd0NoaWxkKCk7DQoNCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJbGVmdCA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQkvLyBlbnRlciBwYXJlbnQgbWVudQ0KDQoJCWlmICh0aGlzLml0ZW1zICYmIHRoaXMuaXRlbXNbMF0gJiYgdGhpcy5pdGVtc1swXS5wYXJlbnREcm9wTWVudU9iaiAmJiB0aGlzLml0ZW1zWzBdLnBhcmVudERyb3BNZW51T2JqLnBhcmVudE1lbnVJdGVtT2JqKQ0KDQoJCXsNCg0KCQkJdGhpcy5pdGVtc1swXS5wYXJlbnREcm9wTWVudU9iai5wYXJlbnRNZW51SXRlbU9iai5tZW51SXRlbS5mb2N1cygpOw0KDQoJCX0NCg0KCX0sDQoNCgkNCg0KCXJpZ2h0IDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCS8vIGVudGVyIHN1YiBtZW51DQoNCgkJaWYgKHRoaXMuc2VsZWN0SW5kZXggPiAtMSAmJiB0aGlzLml0ZW1zW3RoaXMuc2VsZWN0SW5kZXhdLmNoaWxkcmVuKQ0KDQoJCXsNCg0KCQkJaWYgKHRoaXMuaXRlbXNbdGhpcy5zZWxlY3RJbmRleF0uY2hpbGRyZW4pDQoNCgkJCXsNCg0KCQkJCXRoaXMuaXRlbXNbdGhpcy5zZWxlY3RJbmRleF0uY2hpbGRyZW5NZW51Lml0ZW1zWzBdLm1lbnVJdGVtLmZvY3VzKCk7DQoNCgkJCQl0aGlzLml0ZW1zW3RoaXMuc2VsZWN0SW5kZXhdLmNoaWxkcmVuTWVudS5zZWxlY3RJbmRleCA9IDA7DQoNCgkJCX0NCg0KCQl9CQ0KDQoJfSwNCg0KCQ0KDQoJdGFiIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCS8vIGhpZGRlbiBzdWIgbWVudQ0KDQoJCXRoaXMua2V5Ym9hcmRIaWRkZW5DaGlsZCgpOw0KDQoJCQ0KDQoJCXRoaXMuc2VsZWN0SW5kZXggKz0gMTsNCg0KCQlpZiAodGhpcy5zZWxlY3RJbmRleCA+PSB0aGlzLml0ZW1zLmxlbmd0aCkvL2xvc3QgZm9jdXMsIG11c3Qgc2V0IGZvY3VzIGluIGRyb3AgbWVudSBidXR0b24NCg0KCQl7DQoNCgkJCXRoaXMub25ibHVyKCk7DQoNCgkJCXRoaXMuaGlkZGVuKCk7DQoNCgkJCXRoaXMuc2VsZWN0SW5kZXggPSAtMTsJDQoNCgkJfQ0KDQoJCWVsc2UNCg0KCQl7DQoNCgkJCS8vIHNob3cgc3ViIG1lbnUNCg0KCQkJdGhpcy5rZXlib2FyZFNob3dDaGlsZCgpOw0KDQoJCX0NCg0KCX0sDQoNCgkNCg0KCS8vIGhpZGRlbiBzdWIgbWVudQ0KDQoJa2V5Ym9hcmRIaWRkZW5DaGlsZCA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQlpZiAodGhpcy5zZWxlY3RJbmRleCA+IC0xICYmIHRoaXMuaXRlbXNbdGhpcy5zZWxlY3RJbmRleF0uY2hpbGRyZW4pDQoNCgkJew0KDQoJCQl0aGlzLml0ZW1zW3RoaXMuc2VsZWN0SW5kZXhdLmhpZGRlbkNoaWxkKCk7DQoNCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJLy8gc2hvdyBzdWIgbWVudQ0KDQoJa2V5Ym9hcmRTaG93Q2hpbGQgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJaWYgKHRoaXMuaXRlbXNbdGhpcy5zZWxlY3RJbmRleF0uY2hpbGRyZW4pDQoNCgkJew0KDQoJCQl0aGlzLml0ZW1zW3RoaXMuc2VsZWN0SW5kZXhdLnNob3dDaGlsZCgpOw0KDQoJCX0NCg0KCX0sDQoNCgkNCg0KCS8vY3JlYXRlIEl0ZW0NCg0KCWNyZWF0ZUl0ZW0gOiBmdW5jdGlvbihvYmopew0KDQoJCXZhciBtZW51aXRlbSA9IG5ldyBVSS5NZW51SXRlbShvYmopOw0KDQoJCS8vc2V0IHBhcmVudCBvYmplY3QgcG9pbnQsIHBhcmVudCBvYmplY3QgaXMgY3VycmVudCBkcm9wIG1lbnUgb2JqZWN0Lg0KDQoJCW1lbnVpdGVtLnBhcmVudERyb3BNZW51T2JqID0gdGhpczsNCg0KCQl0aGlzLmFkZEl0ZW0obWVudWl0ZW0pOwkNCg0KCX0sDQoNCgkNCg0KCS8vbXVzdCBNdW51SXRlbSBvYmplY3QNCg0KCWFkZEl0ZW0gOiBmdW5jdGlvbihtZW51SXRlbSl7DQoNCgkJbWVudUl0ZW0uYWRkTGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oKXsNCg0KCQkJdGhpcy5oaWRkZW4oKTsNCg0KCQkJdmFyIG1lbnVJdGVtID0gYXJndW1lbnRzWzBdOw0KDQoJCQlpZiAobWVudUl0ZW0gJiYgbWVudUl0ZW0uY2hpbGRyZW5NZW51KQ0KDQoJCQl7DQoNCgkJCQltZW51SXRlbS5jaGlsZHJlbk1lbnUuaGlkZGVuKCk7DQoNCgkJCX0NCg0KCQl9LmJpbmQodGhpcywgbWVudUl0ZW0pKTsNCg0KCQl0aGlzLml0ZW1zLnB1c2gobWVudUl0ZW0pOw0KDQoJfSwNCg0KCQ0KDQoJY2xlYXJJdGVtIDogZnVuY3Rpb24gKCkNCg0KCXsNCg0KCQl0aGlzLml0ZW1zLnNwbGljZSgwLCB0aGlzLml0ZW1zLmxlbmd0aCk7DQoNCgkJdGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMubWVudUlkKSk7DQoNCgl9LA0KDQoJDQoNCglnZXRJdGVtcyA6IGZ1bmN0aW9uKCl7DQoNCgkJcmV0dXJuIHRoaXMuaXRlbXM7DQoNCgl9LA0KDQoJDQoNCglnZXRMZW5ndGggOiBmdW5jdGlvbigpew0KDQoJCWlmICh0aGlzLml0ZW1zKQ0KDQoJCXsNCg0KCQkJcmV0dXJuIHRoaXMuaXRlbXMubGVuZ3RoOw0KDQoJCX0NCg0KCQllbHNlDQoNCgkJew0KDQoJCQlyZXR1cm4gMDsNCg0KCQl9DQoNCgl9LA0KDQoJDQoNCgloaWRkZW4gOiBmdW5jdGlvbihzdG9wRXZ0UHJvcGFnYXRpb25GbGFnKXsNCg0KCQlpZiAodGhpcy5tZW51SWQpew0KDQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm1lbnVJZCkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCg0KCQkJDQoNCgkJCS8vIGlmIHN0b3BFdnRQcm9wYWdhdGlvbkZsYWcgdmFsdWUgaXMgdHJ1ZSwgZG9uJ3QgcHJvcGFnYXRpb24gZXZlbnQNCg0KCQkJaWYgKCFzdG9wRXZ0UHJvcGFnYXRpb25GbGFnKQ0KDQoJCQl7DQoNCgkJCQkvL2hpZGRlbiBzdWIgbWVudSBpdGVtLg0KDQoJCQkJdGhpcy5ldnRQcm9wYWdhdGlvbih0aGlzLCBmYWxzZSwgdHJ1ZSk7DQoNCgkJCX0NCgkJCQ0KCQkJc2Nyb2xsQmFySXNzdWUuYXV0b1Jlc2l6ZVBvcFVwQ29udGFpbmVyKGRvY3VtZW50LHRoaXMubWVudUlkKTsNCg0KCQl9DQoNCgl9LA0KDQoJDQoNCglnZXRTaG93IDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCWlmICh0aGlzLm1lbnVJZCkNCg0KCQl7DQoNCgkJCWlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMubWVudUlkKS5zdHlsZS5kaXNwbGF5ID09ICdub25lJykNCg0KCQkJew0KDQoJCQkJcmV0dXJuIGZhbHNlOw0KDQoJCQl9DQoNCgkJCWVsc2UNCg0KCQkJew0KDQoJCQkJcmV0dXJuIHRydWU7DQoNCgkJCX0NCg0KCQl9DQoNCgkJZWxzZQ0KDQoJCXsNCg0KCQkJcmV0dXJuIGZhbHNlOw0KDQoJCX0NCg0KCX0sDQoNCgkNCg0KCS8vbGV0IGN1cnJlbnQgaW5wdXQvdGV4dC90ZXh0QXJlYSBlbGVtZW50IGxvb3NlIGZvY3VzLiBCZWNhdXNlIG9mIHRoYXQgY3Vyc2Ugd2lsbCB0aHJvdWdoIHBvcC11cCBESVYuDQoNCglsb29zZUZvY3VzIDogZnVuY3Rpb24oKXsNCg0KCQl2YXIgZm9jdXNlRWxlQmVmb3JlU2hvdzsNCg0KCQkNCg0KCQkvL3NvbWV0aW1lLCBkb2N1bWVudCBkb2Vzbid0IGxvYWRlciBjb21wbGV0ZSwgYmVsb3cgd2lsbCB0aHJvdyBleGNlcHRpb24NCg0KCQl0cnl7DQoNCgkJCWZvY3VzZUVsZUJlZm9yZVNob3cgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50Ow0KDQoJCX1jYXRjaChlKQ0KDQoJCXsNCg0KCQkJDQoNCgkJfQ0KDQoJCQ0KDQoJCWlmKGZvY3VzZUVsZUJlZm9yZVNob3cgJiYgKChmb2N1c2VFbGVCZWZvcmVTaG93Lm5vZGVOYW1lID09ICJJTlBVVCIgJiYgZm9jdXNlRWxlQmVmb3JlU2hvdy50eXBlID09ICJ0ZXh0IikgfHwgZm9jdXNlRWxlQmVmb3JlU2hvdy5ub2RlTmFtZSA9PSAiVEVYVEFSRUEiKSl7DQoNCgkJCWZvY3VzZUVsZUJlZm9yZVNob3cuYmx1cigpOw0KDQoJCX0NCg0KCX0sDQoNCgkNCg0KCXNob3cgOiBmdW5jdGlvbihzcmNJZCkNCg0KCXsNCg0KDQoJICAgIGlmKCF0aGlzLml0ZW1zIHx8ICF0aGlzLml0ZW1zLmxlbmd0aCkNCg0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KDQoNCgkJdGhpcy5sb29zZUZvY3VzKCk7DQoNCgkJDQoNCgkJaWYgKCF0aGlzLm1lbnVJZCkNCg0KCQl7DQoNCgkJCXRoaXMucmVuZGVyKHNyY0lkKTsNCg0KCQl9DQoNCgkJdGhpcy5maXJlRXZlbnQoIm9uc2hvdyIpOw0KDQoJCXRoaXMuaXNTaG93ID0gdHJ1ZTsNCg0KDQoJCS8vd2hldGhlciBzaG93IGNoaWxkcmVuIG1lbnUgaXRlbQ0KDQoJCXZhciBpc1Nob3dDaGlsZE1lbnUgPSBmYWxzZTsNCg0KCQl2YXIgY2hpbGRNZW51SWQgPSBudWxsOw0KDQoJCWlmKHNyY0lkLmluZGV4T2YoIm1lbnVJdGVtLSIpID09IDApDQoNCgkJew0KDQoJCQlpc1Nob3dDaGlsZE1lbnUgPSB0cnVlOw0KDQoJCQljaGlsZE1lbnVJZCA9IHRoaXMubWVudUlkOw0KDQoJCX0NCg0KCQlVSS5wb3NpdGlvbk1nci5zaG93KHNyY0lkLCB0aGlzLm1lbnVJZCwge2lzTWVudTogdHJ1ZSwgaXNTaG93Q2hpbGRNZW51OiBpc1Nob3dDaGlsZE1lbnUsIGNoaWxkTWVudUlkOiBjaGlsZE1lbnVJZH0pOw0KDQoJCQ0KDQoJCS8vc2V0IGRlZmF1bHQgbWVudSB3aWR0aA0KCQl2YXIgbWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMubWVudUlkKTsNCg0KCQl2YXIgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3JjSWQpOw0KDQoJCWlmIChtZW51LnN0eWxlLmRpc3BsYXkgIT0gIm5vbmUiICYmIG1lbnUub2Zmc2V0V2lkdGggPCBidXR0b24ub2Zmc2V0V2lkdGggJiYgIWlzU2hvd0NoaWxkTWVudSkNCg0KCQl7DQoNCgkJCS8vYXIgcG9zaXRpb24gbGVmdA0KDQoJCQlpZihVSS5CYXNlLmNoZWNrQXIoKSAmJiAhaXNOYU4ocGFyc2VJbnQobWVudS5zdHlsZS5sZWZ0KSkpDQoNCgkJCXsNCg0KCQkJCW1lbnUuc3R5bGUubGVmdCA9IHBhcnNlSW50KG1lbnUuc3R5bGUubGVmdCkgLSAoYnV0dG9uLm9mZnNldFdpZHRoIC0gbWVudS5vZmZzZXRXaWR0aCkgKyAicHgiOw0KDQoJCQl9DQoNCgkJCQ0KDQoJCQltZW51LnN0eWxlLndpZHRoID0gYnV0dG9uLm9mZnNldFdpZHRoICsicHgiOw0KDQoJCX0NCg0KCQkNCg0KCQl0aGlzLmZpcmVFdmVudCgic2hvd2VkIik7DQoNCgkJdGhpcy5zZWxlY3RJbmRleCA9IC0xOw0KDQoJfSwNCg0KCQ0KDQoJLy9keW5hbWljIHJldHJpZXZlIGRhdGEgZm9yIGRyb3AgbWVudSBpdGVtDQoNCglzZXRTdG9yZVVybCA6IGZ1bmN0aW9uKHN0b3JlVXJsKQ0KDQoJew0KDQoJCXRoaXMuc3RvcmVVcmwgPSBzdG9yZVVybDsNCg0KCX0sDQoNCgkNCg0KCXNldEJpbmRNZW51IDogZnVuY3Rpb24oYmluZE1lbnUpDQoNCgl7DQoNCgkJdGhpcy5iaW5kTWVudSA9IGJpbmRNZW51Ow0KDQoJfQ0KDQoJDQoNCn0pOw0KDQoNCi8vZ2FsZW4temhhbmc6DQoNCi8vY29uZmlnT2JqOiBqc29uIG9iamVjdC4gICAge2Ryb3BNZW51U3RyOiBkcm9wTWVudVN0ciwgdGFyZ2V0SWQ6IGlkLCB0YXJnZXRNb3VzZU92ZXJGbjogbW91c2VPdmVyRm4sIHRhcmdldE1vdXNlT3V0Rm46IG1vdXNlT3V0Rm4sIGRpc2FibGVNb3VzZUV2ZW50OiBmYWxzZX0NCg0KVUkuRHJvcE1lbnUuYmluZCA9IGZ1bmN0aW9uKGNvbmZpZ09iaikNCg0Kew0KDQoJaWYgKCFjb25maWdPYmouZHJvcE1lbnVTdHIpDQoNCgl7DQoNCgkJcmV0dXJuOw0KDQoJfQ0KDQoJY29uZmlnT2JqLmRyb3BNZW51ID0gbmV3IFVJLkRyb3BNZW51KGNvbmZpZ09iai5kcm9wTWVudVN0cik7IA0KDQoJDQoNCglmdW5jdGlvbiBiaW5kTWVudShjb25maWdPYmopIHsNCg0KCQl0aGlzLm1lbnUgPSBjb25maWdPYmouZHJvcE1lbnU7DQoNCgkJdGhpcy50YXJnZXRJZCA9IGNvbmZpZ09iai50YXJnZXRJZDsNCg0KCQl0aGlzLmlzU2hvdyA9IGZhbHNlOw0KDQoJCXRoaXMudGFyZ2V0TW91c2VPdmVyRm4gPSBjb25maWdPYmoudGFyZ2V0TW91c2VPdmVyRm4gfHwgdGhpcy5lbXB0eUZuOw0KDQoJCXRoaXMudGFyZ2V0TW91c2VPdXRGbiA9IGNvbmZpZ09iai50YXJnZXRNb3VzZU91dEZuIHx8IHRoaXMuZW1wdHlGbjsNCg0KCQl0aGlzLm1lbnUuc2V0QmluZE1lbnUodGhpcyk7DQoNCgkJDQoNCgkJdGhpcy5vbmtleURvd24gPSBmdW5jdGlvbigpDQoNCgkJew0KDQoJCQlzd2l0Y2goZXZlbnQua2V5Q29kZSkNCg0KCQkJew0KDQoJCQkJY2FzZSAxMzogLy8gRW50ZXINCg0KCQkJCQl0aGlzLnRhcmdldE1vdXNlT3ZlckZuKCk7DQoNCgkJCQkJYnJlYWs7DQoNCgkJCQljYXNlIDQwOiAvLyBEb3duDQoNCgkJCQkJdGhpcy5kb3duKCk7DQoNCgkJCQkJYnJlYWs7DQoNCgkJCX0NCg0KCQl9Ow0KDQoJCQ0KDQoJCXRoaXMub25tb3VzZUxlYXZlID0gZnVuY3Rpb24gKCkNCg0KCSAgICB7DQoNCgkgICAgCWlmICghdGhpcy50aW1lb3V0Rm4pDQoNCgkgICAgCXsNCg0KCSAgICAJCXRoaXMudGltZW91dEZuID0gZnVuY3Rpb24oKXsNCg0KCSAgICAJCQlpZiAoIXRoaXMuaXNTaG93ICYmIHRoaXMubWVudSkNCg0KCSAgICAJCQl7DQoNCgkgICAgCQkJCXRoaXMubWVudS5oaWRkZW4odHJ1ZSk7DQoNCgkgICAgCQkJCXRoaXMudGFyZ2V0TW91c2VPdXRGbigpOw0KDQoJICAgIAkJCX0NCg0KCSAgICAJCX0uYmluZCh0aGlzKTsNCg0KCSAgICAJfQ0KDQoJICAgIAkNCg0KCSAgICAJdGhpcy50aW1lb3V0ID0gc2V0VGltZW91dCh0aGlzLnRpbWVvdXRGbiwgMTAwKTsNCg0KCSAgICB9Ow0KDQoJICAgIA0KDQoJICAgIHRoaXMub25tb3VzZUVudGVyID0gZnVuY3Rpb24oKQ0KDQoJCXsNCg0KCQkJaWYgKHRoaXMudGltZW91dCl7DQoNCgkJCQljbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTsNCg0KCQkJfQ0KDQoNCgkJCWlmICh0aGlzLm1lbnUpDQoNCgkJCXsNCg0KCQkJCS8vIHNob3cgZG9ycCBtZW51LCB3aGVuIG1vdXNlIG1vdmUgZHJvcCBtZW51IHRvIGVsZW1lbnQsIGRvbid0IGhpZGRlbiBkcm9wIG1lbnUNCg0KCQkJCWlmICghdGhpcy5tZW51LmdldFNob3coKSkNCg0KCQkJCXsNCg0KCQkJCQl0aGlzLm1lbnUuc2hvdyh0aGlzLnRhcmdldElkKTsNCg0KCQkJCX0NCg0KCQkJCWVsc2UNCg0KCQkJCXsNCg0KCQkJCQl0aGlzLm1lbnUuaXNTaG93ID0gdHJ1ZTsNCg0KCQkJCX0NCg0KCQkJCXRoaXMudGFyZ2V0TW91c2VPdmVyRm4oKTsNCg0KCQkJfQ0KDQoJCQlyZXR1cm4gZmFsc2U7DQoNCgkgICAgfTsNCg0KCSAgICANCg0KCSAgICB0aGlzLmRvd24gPSBmdW5jdGlvbigpDQoNCgkgICAgew0KDQoJICAgIAlpZiAoIXRoaXMubWVudS5nZXRTaG93KCkpDQoNCgkgICAgCXsNCg0KCSAgICAJCXRoaXMub25tb3VzZUVudGVyKCk7DQoNCgkgICAgCX0NCg0KCSAgICAJdGhpcy5tZW51LmRvd24oKTsNCg0KCSAgICB9Ow0KDQoJICAgIA0KDQoJICAgIHRoaXMuZW1wdHlGbiA9IGZ1bmN0aW9uKCkNCg0KCSAgICB7fTsNCg0KCX07DQoNCiAgICANCg0KICAgIHZhciBiaW5kTWV0aG9kID0gbmV3IGJpbmRNZW51KGNvbmZpZ09iaik7DQoNCiAgICB2YXIgdGFyZ2V0T2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29uZmlnT2JqLnRhcmdldElkKTsNCg0KICAgIHRhcmdldE9iai5vbmNsaWNrID0gYmluZE1ldGhvZC5vbm1vdXNlRW50ZXIuYmluZChiaW5kTWV0aG9kKTsNCg0KICAgIHRhcmdldE9iai5vbmtleWRvd24gPSBiaW5kTWV0aG9kLm9ua2V5RG93bi5iaW5kKGJpbmRNZXRob2QpOw0KDQogICAgaWYgKCFjb25maWdPYmouZGlzYWJsZU1vdXNlRXZlbnQpDQoNCiAgICB7DQoNCgkgICAgdGFyZ2V0T2JqLm9ubW91c2VlbnRlciA9IGJpbmRNZXRob2Qub25tb3VzZUVudGVyLmJpbmQoYmluZE1ldGhvZCk7DQoNCgkgICAgdGFyZ2V0T2JqLm9ubW91c2VsZWF2ZSA9IGJpbmRNZXRob2Qub25tb3VzZUxlYXZlLmJpbmQoYmluZE1ldGhvZCk7DQoNCiAgICB9DQoNCiAgICANCg0KICAgIGNvbmZpZ09iaiA9IG51bGw7DQoNCn07DQoNCg0KLyoqDQoNCiAqIA0KDQogKiBWMzYwCSANCg0KICogRmlsZTogbWVudUl0ZW0uanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiA8PEdlbmVyYWwgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzPj4NCg0KICogDQoNCiAqIE5vdGVzOg0KDQogKiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqIFJldmlzaW9uIEhpc3Rvcnk6DQoNCiAqIDw8RGF0ZT4+LCA8PFdobz4+LCA8PFdoYXQ+Pg0KDQogKiAxNS8wMS8yMDEyLCBSYXkgWmhhbmcsIEluaXRpYWwgdmVyc2lvbg0KDQogKg0KDQogKi8NCg0KDQpVSS5NZW51SXRlbSA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KLy97dGV4dDogYSwgY3NzOiBjMSwgZXZlbnRzOntjbGljazpmbjEsIG1vdXNlb3ZlcjogZm4yLi4ufX0NCg0KVUkuTWVudUl0ZW0uZXh0ZW5kKHsNCg0KCQ0KDQoJaWRQcmV2aW91cyA6ICJtZW51SXRlbS0iLA0KDQoJDQoNCglvblNlbGVjdCA6IGZhbHNlLA0KDQoJDQoNCgl0aW1lb3V0SWQ6IG51bGwsDQoNCgkNCg0KCS8ve3RleHQ6Li4uLGNzczouLi4sIGNsaWNrOi4ufQ0KDQoJDQoNCglpbml0IDogZnVuY3Rpb24oY29uZmlnKQ0KDQoJew0KDQoJCXRoaXMudGV4dCA9IGNvbmZpZy50ZXh0IHx8ICIiOw0KDQoJCXRoaXMuY3NzID0gY29uZmlnLmNzcyB8fCAiIjsNCg0KCQl2YXIgY2xpY2tGbiA9IGNvbmZpZy5jbGljazsNCg0KCQl0aGlzLmlkID0gY29uZmlnLmlkIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLnRhcmdldCA9IGNvbmZpZy50YXJnZXQgfHwgIiI7DQoNCgkJdGhpcy5jaGlsZHJlbiA9IGNvbmZpZy5jaGlsZHJlbnMgfHwgIiI7DQoNCgkJdGhpcy5zZWxlY3RlZCA9IGNvbmZpZy5zZWxlY3RlZCB8fCBmYWxzZTsNCg0KCQl0aGlzLmhhc1NlbGVjdFN0YXR1cyA9IGNvbmZpZy5oYXNTZWxlY3RTdGF0dXMgfHwgZmFsc2U7DQoNCgkJdGhpcy5pc0dyYXlvdXQgPSBjb25maWcuaXNHcmF5b3V0IHx8IGZhbHNlOw0KDQoJCWlmIChjb25maWcudXJsKQ0KDQoJCXsNCg0KCQkJdGhpcy5zZXRIcmVmKGNvbmZpZy51cmwpOw0KDQoJCX0NCg0KCQkvL29ubHkgc3VwZXIgdGhvc2UgZXZlbnQNCg0KCQl0aGlzLmFkZEV2ZW50cygiY2xpY2siLCAibW91c2VvdmVyIiwgIm1vdXNlb3V0IiwgImZvY3VzIiwgImJsdXIiKTsNCg0KCQlpZiAoY2xpY2tGbikNCg0KCQl7DQoNCgkJCWlmICh0eXBlb2YoY2xpY2tGbikgPT0gInN0cmluZyIpDQoNCgkJCXsNCg0KCQkJCWlmIChjbGlja0ZuLmluZGV4T2YoInJldHVybiIpID09IDApDQoNCgkJCQl7DQoNCgkJCQkJY2xpY2tGbiA9IGNsaWNrRm4ucmVwbGFjZUFsbCgicmV0dXJuIiwgIiIpOw0KDQoJCQkJfQ0KDQoJCQkJdmFyIGNsaWNrRm4gPSBmdW5jdGlvbigpew0KDQoJCQkJCWV2YWwoYXJndW1lbnRzWzBdKTsNCg0KCQkJCX0uYmluZChjbGlja0ZuKTsNCg0KCQkJfQ0KDQoJCQl0aGlzLmFkZE9ic2VydmVyKCJjbGljayIsIGNsaWNrRm4pOw0KDQoJCX0NCg0KCQkNCg0KCX0sDQoNCgkNCg0KCXJlbmRlciA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQl2YXIgbWVudUl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7DQoNCgkJaWYodGhpcy5pc0dyYXlvdXQpDQoNCgkJCW1lbnVJdGVtLmRpc2FibGVkID0gdHJ1ZTsNCg0KDQoJCWlmICh0aGlzLmhyZWYgJiYgdGhpcy5ocmVmICE9ICIjIikNCg0KCQl7DQoNCgkJCW1lbnVJdGVtLmhyZWYgPSB0aGlzLmhyZWYgPSBVdGlsLmhhbmRsZUhyZWYodGhpcy5ocmVmKTsNCg0KCQkJbWVudUl0ZW0udGFyZ2V0ID0gdGhpcy50YXJnZXQ7DQoNCgkJfQ0KDQoJCWVsc2UNCg0KCQl7DQoNCgkJCW1lbnVJdGVtLmhyZWYgPSAiamF2YXNjcmlwdDp2b2lkKDApOyI7DQoNCgkJfQ0KDQoNCgkJbWVudUl0ZW0uY2xhc3NOYW1lID0gJ3BvcnRsZXQtbWVudS1pdGVtJzsNCg0KCQltZW51SXRlbS5pZCA9IHRoaXMuaWQ7DQoNCgkJbWVudUl0ZW0udW5zZWxlY3RhYmxlID0gIm9uIjsNCg0KCQltZW51SXRlbS5pbm5lckhUTUwgPSAiJm5ic3A7PHNwYW4gaWQ9JyIrdGhpcy5nZXRJZCgpKyInPiIrdGhpcy5hZGRDaGVja0NvbnRlbnQoKSt0aGlzLnRleHQrIjwvc3Bhbj4mbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsiOw0KDQoJCWlmICghdGhpcy5pc0dyYXlvdXQpDQoNCgkJCXRoaXMuYWRkRGVmYXVsdEV2ZW50KG1lbnVJdGVtKTsNCg0KCQl0aGlzLm1lbnVJdGVtID0gbWVudUl0ZW07DQoNCgkJcmV0dXJuIG1lbnVJdGVtOw0KDQoJfSwNCg0KCQ0KDQoJLy9ocmVmIGlzIGZpcnN0DQoNCglhZGREZWZhdWx0RXZlbnQgOiBmdW5jdGlvbihtZW51SXRlbSkNCg0KCXsNCg0KCQltZW51SXRlbVsib25jbGljayJdID0gdGhpcy5vbmNsaWNrLmJpbmQodGhpcyk7DQoNCgkJbWVudUl0ZW1bIm9ubW91c2VvdmVyIl0gPSB0aGlzLm9ubW91c2VvdmVyLmJpbmQodGhpcyk7DQoNCgkJbWVudUl0ZW1bIm9ubW91c2VvdXQiXSA9IHRoaXMub25tb3VzZW91dC5iaW5kKHRoaXMpOw0KDQoJCW1lbnVJdGVtWyJvbmZvY3VzIl0gPSB0aGlzLm9uZm9jdXMuYmluZCh0aGlzKTsNCg0KCQltZW51SXRlbVsib25ibHVyIl0gPSB0aGlzLm9uYmx1ci5iaW5kKHRoaXMpOw0KDQoJCW1lbnVJdGVtWyJvbm1vdXNlZW50ZXIiXSA9IHRoaXMub25tb3VzZWVudGVyLmJpbmQodGhpcyk7DQoNCgkJbWVudUl0ZW1bIm9ubW91c2VsZWF2ZSJdID0gdGhpcy5vbm1vdXNlbGVhdmUuYmluZCh0aGlzKTsNCg0KCX0sDQoNCgkNCg0KCS8qKg0KDQoJICogYWRkIG1lbnUgaXRlbSBjaGVja2VkIHN0eWxlDQoNCgkgKi8NCg0KCWFkZENoZWNrQ29udGVudCA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQl2YXIgaXRlbVByZWZpeCA9ICIiOw0KDQoJCWlmKHRoaXMuaGFzU2VsZWN0U3RhdHVzKXsNCg0KCQkJaXRlbVByZWZpeCA9IiZuYnNwOyZuYnNwOyZuYnNwOyI7DQoNCgkJfQ0KDQoJCWlmKHRoaXMuc2VsZWN0ZWQpDQoNCgkJew0KDQoJCQlpdGVtUHJlZml4PSAiPHNwYW4gY2xhc3M9J21lbnVpdGVtLWNoZWNrZWR0eXBlLXNlbGVjdGVkJz4mbmJzcDsmbmJzcDs8L3NwYW4+Jm5ic3A7IjsNCg0KCQl9DQoNCgkJcmV0dXJuIGl0ZW1QcmVmaXg7DQoNCgl9LA0KDQoJDQoNCglvbmNsaWNrIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXRoaXMuZmlyZUV2ZW50KCJjbGljayIpOw0KDQoJfSwNCg0KCQ0KDQoJb25tb3VzZW91dCA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQl0aGlzLmxvc3RiYWNrQ29sb3IoKTsNCg0KCQl0aGlzLmZpcmVFdmVudCgibW91c2VvdmVyIik7DQoNCgl9LA0KDQoJDQoNCglvbm1vdXNlb3ZlciA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQl0aGlzLm9uYmFja0NvbG9yKCk7DQoNCgkJdGhpcy5maXJlRXZlbnQoIm1vdXNlb3V0Iik7CQkNCg0KCX0sDQoNCg0KCW9ubW91c2VlbnRlciA6IGZ1bmN0aW9uKCl7DQoNCgkJdGhpcy5zaG93Q2hpbGQoKTsNCg0KCX0sDQoNCgkNCg0KCW9ubW91c2VsZWF2ZSA6IGZ1bmN0aW9uKCl7DQoNCgkJdGhpcy5oaWRkZW5DaGlsZCgpOw0KDQoJfSwNCg0KCQ0KDQoJaGlkZGVuQ2hpbGQgOiBmdW5jdGlvbigpew0KDQoJCQ0KDQoJCWlmICghdGhpcy5jaGlsZHJlbk1lbnUpDQoNCgkJCXJldHVybjsNCg0KCQkNCg0KCQl0aGlzLmNoaWxkcmVuTWVudS5pc1Nob3cgPSBmYWxzZTsNCg0KCQkNCg0KCQkvL3doZW4gbW91c2Ugb3V0IG1lbnUgaXRlbSwgaGlkZGVuIHRoaXMgbWVudSBpdGVtIGNoaWxkIGRyb3AgbWVudS4NCg0KCQlpZiAoIXRoaXMudGltZW91dEZuKQ0KDQogICAgCXsNCg0KICAgIAkJdGhpcy50aW1lb3V0Rm4gPSBmdW5jdGlvbigpew0KDQogICAgCQkJaWYodGhpcy5jaGlsZHJlbk1lbnUpDQoNCiAgICAJCQl7DQoNCiAgICAJCQkJaWYodGhpcy5jaGlsZHJlbk1lbnUuY29udGFpbiAmJiAhdGhpcy5jaGlsZHJlbk1lbnUuaXNTaG93KQ0KDQogICAgCQkJCXsNCg0KICAgIAkJCQkJdGhpcy5jaGlsZHJlbk1lbnUuY29udGFpbi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KDQogICAgCQkJCX0NCg0KICAgIAkJCX0NCg0KICAgIAkJfS5iaW5kKHRoaXMpOw0KDQogICAgCX0NCg0KCQkNCg0KCQljbGVhclRpbWVvdXQodGhpcy50aW1lb3V0SWQpOw0KDQoJCXRoaXMudGltZW91dElkICA9IHNldFRpbWVvdXQodGhpcy50aW1lb3V0Rm4sIDEwMCk7DQoNCgl9LA0KDQoJDQoNCglzaG93Q2hpbGQgOiBmdW5jdGlvbigpew0KDQoJCWlmICghdGhpcy5jaGlsZHJlbikNCg0KCQkJcmV0dXJuOw0KDQoJCQ0KDQoJCWlmICghdGhpcy5jaGlsZHJlbk1lbnUpDQoNCgkJew0KDQoJCQl0aGlzLmNoaWxkcmVuTWVudSA9IG5ldyBVSS5Ecm9wTWVudSh0aGlzLmNoaWxkcmVuKTsNCg0KCQkJdGhpcy5vbmJhY2tDb2xvcigpOw0KDQoJCX0NCg0KDQoJCS8vY2hpbGRyZW5NZW51IGlzIGEgZHJvcCBtZW51IG9iamVjdC4NCg0KCQlpZiAodGhpcy5jaGlsZHJlbk1lbnUpDQoNCgkJew0KDQoJCQl0aGlzLmNoaWxkcmVuTWVudS5zaG93KHRoaXMuaWQpOw0KDQoJCQkvL3NldCBwYXJlbnQgb2JqZWN0IHBvaW50LCBwYXJlbnQgb2JqZWN0IGlzIGN1cnJlbnQgbWVudSBpdGVtIG9iamVjdC4NCg0KCQkJdGhpcy5jaGlsZHJlbk1lbnUucGFyZW50TWVudUl0ZW1PYmogPSB0aGlzOw0KDQoJCX0NCg0KCX0sDQoNCgkNCg0KCW9uYmFja0NvbG9yIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCQ0KDQoJCWlmKHRoaXMuY2hpbGRyZW5NZW51KQ0KDQoJCXsNCg0KCQkJdGhpcy5tZW51SXRlbS5jbGFzc05hbWUgPSAicG9ydGxldC1tZW51LWl0ZW0gbWVudWl0ZW0taGFzY2xpbGRyZW4tc2VsZWN0ZWQiOw0KCQkJLy90byBjaGVjayBpZiBzZWN0aW9uIDUwOCBpcyBvcGVuIA0KCQkJaWYocHJvZmlsZS5pc0VuYWJsZWQ1MDgpew0KCQkJCXRoaXMubWVudUl0ZW0udGl0bGUgPSB0aGlzLm1lbnVJdGVtLnRleHQrZ2V0VGV4dGxhYmxlKCJnZW5lcmljdmlldy5nZW5lcmljdmlld2Zvcm0uZXhwYW5kLmxhYmVsIik7DQoJCQl9DQoJCQkNCgkJfSBlbHNlIHsNCg0KCQkJdGhpcy5tZW51SXRlbS5jbGFzc05hbWUgPSAicG9ydGxldC1tZW51LWl0ZW0gbWVudWl0ZW0tc2VsZWN0ZWQiOw0KDQoJCX0NCg0KCX0sDQoNCgkNCg0KCWxvc3RiYWNrQ29sb3IgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJdGhpcy5tZW51SXRlbS5jbGFzc05hbWUgPSAicG9ydGxldC1tZW51LWl0ZW0gbWVudWl0ZW0tbm90c2VsZWN0ZWQiOw0KDQoJfSwNCg0KCQ0KDQoJb25mb2N1cyA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQl0aGlzLm9uYmFja0NvbG9yKCk7DQoNCgkJdGhpcy5maXJlRXZlbnQoImZvY3VzIik7DQoNCgl9LA0KDQoJDQoNCglvbmJsdXIgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJdGhpcy5sb3N0YmFja0NvbG9yKCk7DQoNCgkJdGhpcy5maXJlRXZlbnQoImJsdXIiKTsNCg0KCX0sDQoNCgkNCg0KCXNldFRleHQgOiBmdW5jdGlvbih0ZXh0KQ0KDQoJew0KDQoJCXRoaXMudGV4dCA9IHRleHQ7DQoNCgl9LA0KDQoJDQoNCglzZXRDc3M6IGZ1bmN0aW9uKGNzcykNCg0KCXsNCg0KCQl0aGlzLmNzcyA9IGNzczsNCg0KCX0sDQoNCgkNCg0KCXNldERpc2FibGUgOiBmdW5jdGlvbihpc0Rpc2FibGUpDQoNCgl7DQoNCgkJdGhpcy5tZW51SXRlbS5kaXNhYmxlID0gaXNEaXNhYmxlOw0KDQoJfSwNCg0KCQ0KDQoJc2V0SHJlZiA6IGZ1bmN0aW9uKGhyZWYpDQoNCgl7DQoNCgkJaWYgKCFocmVmIHx8ICJudWxsIiA9PSBocmVmKQ0KDQoJCXsNCg0KCQkJaHJlZiA9ICJqYXZhc2NyaXB0OnZvaWQoMCk7IjsNCg0KCQl9DQoNCgkJdGhpcy5ocmVmID0gaHJlZjsNCg0KCX0sDQoNCgkNCg0KCXNldFRhcmdldCA6IGZ1bmN0aW9uKHRhcmdldCl7DQoNCgkJdGhpcy50YXJnZXQgPSB0YXJnZXQ7DQoNCgl9LA0KDQoJDQoNCglnZXRNZW51SXRlbSA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQlpZiAoIXRoaXMubWVudUl0ZW0pDQoNCgkJew0KDQoJCQlyZXR1cm4gdGhpcy5yZW5kZXIoKTsNCg0KCQl9DQoNCgkJcmV0dXJuIHRoaXMubWVudUl0ZW07DQoNCgl9DQoNCn0pOw0KDQovKioNCg0KICogDQoNCiAqIFYzNjAgRmlsZTogQmFzZUlucHV0LmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4gQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKiBSZXZpc2lvbiBIaXN0b3J5OiA8PERhdGU+PiwgPDxXaG8+PiwgPDxXaGF0Pj4gMjUvNC8yMDEyLCBSYXkgWmhhbmcsDQoNCiAqIEluaXRpYWwgdmVyc2lvbg0KDQogKiANCg0KICovDQoNCg0KVUkuQmFzZUlucHV0ID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClVJLkJhc2VJbnB1dC5leHRlbmQoIHsNCg0KDQoJaWRQcmV2aW91cyA6ICJiYXNlaW5wdXQtIiwNCg0KDQoJaW5pdCA6IGZ1bmN0aW9uKGNvbmZpZykgew0KDQoJCXRoaXMuaWQgPSBjb25maWcuaWQgfHwgdGhpcy5nZXRJZCgpOw0KDQoJCXRoaXMubmFtZSA9IGNvbmZpZy5uYW1lIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLmRpc2FibGVkID0gY29uZmlnLmRpc2FibGVkIHx8IGZhbHNlOw0KDQoJCXRoaXMuYWNjZXNzS2V5ID0gY29uZmlnLmFjY2Vzc0tleSB8fCAiIjsNCg0KCQl0aGlzLnN0eWxlID0gY29uZmlnLnN0eWxlIHx8ICIiOw0KDQoJCXRoaXMudGFiSW5kZXggPSBjb25maWcudGFiSW5kZXg7DQoNCgkJdGhpcy50aXRsZSA9IGNvbmZpZy50aXRsZSB8fCAiIjsNCg0KCQl0aGlzLmNsYXNzTmFtZSA9IGNvbmZpZy5jbGFzc05hbWUgfHwgIiI7DQoNCgkJdGhpcy5jb250YWluSWQgPSBjb25maWcuY29udGFpbklkOw0KDQoJCXRoaXMuZXZlbnRNYXAgPSBjb25maWcuZXZlbnRNYXB8fHt9Ow0KDQoJCXRoaXMuc3VwcG9ydEV2ZW50cyA9IGNvbmZpZy5zdXBwb3J0RXZlbnRzIHx8IFsgImNoYW5nZSIsICJjbGljayIgXTsNCg0KCQl0aGlzLmluaXRJbnB1dChjb25maWcpOw0KDQoJfSwNCg0KCQ0KDQoJaW5pdElucHV0IDogZnVuY3Rpb24oKXsNCg0KCX0sDQoNCgkNCg0KCWN1c3RvbWl6ZUlucHV0IDogZnVuY3Rpb24oaW5wdXQpew0KDQoJCXJldHVybiBpbnB1dDsNCg0KCX0sDQoNCgkNCg0KCWN1c3RvbWl6ZUhUTUwgOiBmdW5jdGlvbihkYXRhKXsNCg0KCQlyZXR1cm4gZGF0YTsNCg0KCX0sDQoNCgkNCg0KCXJlbmRlciA6IGZ1bmN0aW9uKCkgew0KDQoJCXZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7DQoNCgkJaW5wdXQuaWQgPSB0aGlzLmlkOw0KDQoJCWlucHV0Lm5hbWUgPSB0aGlzLm5hbWU7DQoNCgkJaWYgKHRoaXMudGl0bGUpIHsNCg0KCQkJaW5wdXQudGl0bGUgPSB0aGlzLnRpdGxlOw0KDQoJCX0NCg0KCQlpZiAodGhpcy5zdHlsZSkgew0KDQoJCQlpbnB1dC5zdHlsZSA9IHRoaXMuc3R5bGU7DQoNCgkJfQ0KDQoJCWlmICh0aGlzLmFjY2Vzc0tleSkgew0KDQoJCQlpbnB1dC5hY2Nlc3NLZXkgPSB0aGlzLmFjY2Vzc0tleTsNCg0KCQl9DQoNCgkJaWYgKHRoaXMudGFiSW5kZXgpIHsNCg0KCQkJaW5wdXQudGFiSW5kZXggPSB0aGlzLnRhYkluZGV4Ow0KDQoJCX0NCg0KCQlpZiAodGhpcy5kaXNhYmxlZCkgew0KDQoJCQlpbnB1dC5kaXNhYmxlZCA9IHRoaXMuZGlzYWJsZWQ7DQoNCgkJfQ0KDQoJCWlmICh0aGlzLmNsYXNzTmFtZSkgew0KDQoJCQlpbnB1dC5jbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZTsNCg0KCQl9DQoNCgkJdGhpcy5jdXN0b21pemVJbnB1dChpbnB1dCk7DQoNCgkJdGhpcy5iaW5kRXZlbnRzKGlucHV0LCB0aGlzLmV2ZW50TWFwLCB0aGlzLnN1cHBvcnRFdmVudHMpOw0KDQoJCXZhciBjb250YWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5jb250YWluSWQpOw0KDQoJCWNvbnRhaW4uYXBwZW5kQ2hpbGQoaW5wdXQpOw0KDQoJfSwNCg0KDQoJZ2V0T3V0ZXJIVE1MIDogZnVuY3Rpb24oZGF0YSkgew0KDQoJCXZhciBpbml0RGF0YSA9IGRhdGEgfHwge307DQoNCgkJdmFyIGlkID0gaW5pdERhdGEuaWQgfHwgdGhpcy5pZDsNCg0KCQl2YXIgbmFtZSA9IGluaXREYXRhLm5hbWUgfHwgaWQ7DQoNCgkJdmFyIGRpc2FibGVkID0gaW5pdERhdGEuZGlzYWJsZWQgfHwgdGhpcy5kaXNhYmxlZDsNCg0KCQl2YXIgY2xhc3NOYW1lID0gaW5pdERhdGEuY2xhc3NOYW1lIHx8IHRoaXMuY2xhc3NOYW1lOw0KDQoJCXZhciB0aXRsZSA9IGluaXREYXRhLnRpdGxlIHx8IHRoaXMudGl0bGU7DQoNCgkJdmFyIGFjY2Vzc2tleSA9IGluaXREYXRhLmFjY2Vzc2tleSB8fCB0aGlzLmFjY2Vzc2tleTsNCg0KCQl2YXIgc3R5bGUgPSBpbml0RGF0YS5zdHlsZSB8fCB0aGlzLnN0eWxlOw0KDQoJCXZhciB0YWJJbmRleCA9IGluaXREYXRhLnRhYkluZGV4IHx8IHRoaXMudGFiSW5kZXg7DQoNCgkJdmFyIGV2ZW50TWFwID0gaW5pdERhdGEuZXZlbnRNYXAgfHwgdGhpcy5ldmVudE1hcDsNCg0KCQl2YXIgc3VwcG9ydEV2ZW50cyA9IGluaXREYXRhLnN1cHBvcnRFdmVudHMgfHwgdGhpcy5zdXBwb3J0RXZlbnRzOw0KDQoJCXZhciBjb250ZW50ID0gbmV3IEFycmF5KCk7DQoNCgkJY29udGVudC5wdXNoKCI8aW5wdXQgaWQ9JyIpOw0KDQoJCWNvbnRlbnQucHVzaChpZCk7DQoNCgkJY29udGVudC5wdXNoKCInIG5hbWU9JyIpOw0KDQoJCWNvbnRlbnQucHVzaChuYW1lKTsNCg0KCQlpZiAoY2xhc3NOYW1lKSB7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyBjbGFzcz0nIik7DQoNCgkJCWNvbnRlbnQucHVzaChjbGFzc05hbWUpOw0KDQoJCX0NCg0KCQlpZiAodGl0bGUpIHsNCg0KCQkJY29udGVudC5wdXNoKCInIHRpdGxlPSciKTsNCg0KCQkJY29udGVudC5wdXNoKHRpdGxlKTsNCg0KCQl9DQoNCgkJaWYgKGFjY2Vzc2tleSkgew0KDQoJCQljb250ZW50LnB1c2goIicgYWNjZXNza2V5PSciKTsNCg0KCQkJY29udGVudC5wdXNoKGFjY2Vzc2tleSk7DQoNCgkJfQ0KDQoJCWlmIChzdHlsZSkgew0KDQoJCQljb250ZW50LnB1c2goIicgc3R5bGU9JyIpOw0KDQoJCQljb250ZW50LnB1c2goc3R5bGUpOw0KDQoJCX0NCg0KCQlpZiAodGFiSW5kZXgpIHsNCg0KCQkJY29udGVudC5wdXNoKCInIHRhYkluZGV4PSciKTsNCg0KCQkJY29udGVudC5wdXNoKHRhYkluZGV4KTsNCg0KCQl9DQoNCgkJY29udGVudC5wdXNoKCInIik7DQoNCgkJaWYgKGRpc2FibGVkKSB7DQoNCgkJCWNvbnRlbnQucHVzaCgiIGRpc2FibGVkPSdkaXNhYmxlZCciKTsNCg0KCQl9DQoNCgkJY29udGVudC5wdXNoKCIgIik7DQoNCgkJY29udGVudC5wdXNoKHRoaXMuY3VzdG9taXplSFRNTChkYXRhKSk7DQoNCgkJY29udGVudC5wdXNoKCIgIik7DQoNCgkJY29udGVudC5wdXNoKHRoaXMuZXZlbnRzVG9IVE1MKGV2ZW50TWFwLHN1cHBvcnRFdmVudHMpKTsNCg0KCQljb250ZW50LnB1c2goIi8+Iik7DQoNCiAgICAgICAJY29udGVudC5wdXNoKHRoaXMuZXh0cmFIVE1MKGRhdGEpKTsNCg0KCQlyZXR1cm4gY29udGVudC5qb2luKCIiKTsNCg0KCX0sDQoNCg0KICAgIGV4dHJhSFRNTCA6IGZ1bmN0aW9uKGRhdGEpDQoNCiAgICB7DQoNCiAgICAgIHJldHVybiAiIjsgIA0KDQogICAgfSwNCg0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKSB7DQoNCg0KCX0NCg0KDQp9KTsNCg0KLyoqDQoNCiAqIA0KDQogKiBWMzYwICANCg0KICogRmlsZTogQnV0dG9uLmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjoNCg0KICogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczoNCg0KICogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKiBSZXZpc2lvbiBIaXN0b3J5Og0KDQogKiA8PERhdGU+PiwgPDxXaG8+PiwgPDxXaGF0Pj4NCg0KICogMTUvMDEvMjAxMiwgUmF5IFpoYW5nLCBJbml0aWFsIHZlcnNpb24NCg0KICoNCg0KICovDQoNCg0KDQpVSS5CdXR0b24gPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNCg0KVXRpbC5leHRlbmQoVUkuQnV0dG9uLCBVSS5CYXNlSW5wdXQsIHsNCg0KDQoJaWRQcmV2aW91cyA6ICJidXR0b24tIiwNCg0KDQoJaW5pdElucHV0IDogZnVuY3Rpb24oY29uZmlnKSB7DQoNCgkJdGhpcy52YWx1ZSA9IGNvbmZpZy52YWx1ZSB8fCAiIjsNCg0KCQl0aGlzLnN1cHBvcnRFdmVudHMgPSBjb25maWcuc3VwcG9ydEV2ZW50cyB8fCBbICJjbGljayIgXTsNCg0KCX0sDQoNCg0KCWN1c3RvbWl6ZUlucHV0IDogZnVuY3Rpb24oaW5wdXQpIHsNCg0KCQlpbnB1dC50eXBlID0gJ2J1dHRvbic7DQoNCgkJaWYgKHRoaXMudmFsdWUpIHsNCg0KCQkJaW5wdXQudmFsdWUgPSB0aGlzLnZhbHVlOw0KDQoJCX0NCg0KCQlyZXR1cm4gaW5wdXQ7DQoNCgl9LA0KDQoNCgljdXN0b21pemVIVE1MIDogZnVuY3Rpb24oZGF0YSkgew0KDQoJCXZhciBpbml0RGF0YSA9IGRhdGEgfHwge307DQoNCgkJdmFyIHZhbHVlID0gaW5pdERhdGEudmFsdWUgfHwgdGhpcy52YWx1ZTsNCg0KCQl2YXIgY29udGVudCA9IG5ldyBBcnJheSgpOw0KDQoJCWNvbnRlbnQucHVzaCgidHlwZT0nYnV0dG9uJyIpOw0KDQoJCWlmICh2YWx1ZSkgew0KDQoJCQljb250ZW50LnB1c2goIiB2YWx1ZT0nIik7DQoNCgkJCWNvbnRlbnQucHVzaCh2YWx1ZSk7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyIpOw0KDQoJCX0NCg0KCQlyZXR1cm4gY29udGVudC5qb2luKCIiKTsNCg0KCX0sDQoNCg0KCXBhcnNlU2libGluZ1ZhbHVlIDogZnVuY3Rpb24oc2libGluZykgew0KDQoJCXJldHVybiBzaWJsaW5nLnZhbHVlOw0KDQoJfSwNCg0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKSB7DQoNCg0KCX0sDQoNCgkNCg0KCWNyZWF0ZU5ld1N0eWxlQnV0dG9uIDogZnVuY3Rpb24oKQ0KDQogICAgew0KDQoJCQ0KICAgICAgICB2YXIgbGVmdERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpOw0KDQogICAgICAgIGxlZnREaXYuaWQgPSB0aGlzLmdldEltZ0lkKCk7DQoNCiAgICAgICAgbGVmdERpdi5zdHlsZS5jc3NUZXh0PSAid2lkdGg6IGF1dG8iOw0KICAgICAgICANCg0KICAgICAgICB2YXIgcmlnaHREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKTsNCg0KICAgICAgICByaWdodERpdi5pZCA9IHRoaXMuZ2V0SWQoKTsNCiAgICAgICAgDQogICAgICAgIHJpZ2h0RGl2LnN0eWxlLmNzc1RleHQ9ICJ3aWR0aDogYXV0byI7DQoNCg0KICAgICAgICB2YXIgbWlkRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIik7DQoNCiAgICAgICAgbWlkRGl2LmlkID0gdGhpcy5nZXRJZCgpOw0KICAgICAgICANCiAgICAgICAgbWlkRGl2LnN0eWxlLmNzc1RleHQ9ICJ3aWR0aDogYXV0byI7DQoNCiAgICAgICAgbWlkRGl2LmlubmVySFRNTCA9ICI8Zm9udCBjbGFzcz0ncG9ydGxldC1tZW51LWl0ZW0nPiIgKyB0aGlzLnRleHQgKyAiPC9mb250PiI7DQoNCiAgICAgICAgDQoNCiAgICAgICAgcmlnaHREaXYuYXBwZW5kQ2hpbGQobWlkRGl2KTsNCg0KICAgICAgICBsZWZ0RGl2LmFwcGVuZENoaWxkKHJpZ2h0RGl2KTsNCg0KDQogICAgICAgIHRoaXMubGVmdCA9IGxlZnREaXY7DQoNCiAgICAgICAgdGhpcy5yaWdodCA9IHJpZ2h0RGl2Ow0KDQogICAgICAgIHRoaXMubWlkID0gbWlkRGl2Ow0KDQogICAgICAgIHRoaXMuY3JlYXRlV3JhcCgpLmFwcGVuZENoaWxkKGxlZnREaXYpOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgY3JlYXRlV3JhcCA6IGZ1bmN0aW9uKCkNCg0KICAgIHsNCg0KICAgICAgICB2YXIgYUhyZWYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7DQoNCiAgICAgICAgYUhyZWYuaWQgPSB0aGlzLmdldEhyZWZJZCgpOw0KDQogICAgICAgIGFIcmVmLnN0eWxlLnRleHREZWNvcmF0aW9uICA9ICJub25lIjsNCg0KICAgICAgICBpZiAodGhpcy5ocmVmKQ0KDQogICAgICAgICAgICB0aGlzLmhyZWYgPSBVdGlsLmhhbmRsZUhyZWYodGhpcy5ocmVmKTsNCg0KICAgICAgICBhSHJlZi5ocmVmID0gdGhpcy5ocmVmIHx8ICJqYXZhc2NyaXB0OnZvaWQoMCk7IjsNCg0KICAgICAgICBhSHJlZi50YXJnZXQgPSB0aGlzLnRhcmdldCB8fCAiIjsNCg0KICAgICAgICBhSHJlZi5hY2Nlc3NrZXkgPSB0aGlzLmFjY2Vzc2tleSB8fCAiIjsNCg0KICAgICAgICBpZih0aGlzLmNpcmNsZSkNCg0KICAgICAgICB7DQoNCiAgICAgICAgCWFIcmVmLmNpcmNsZSA9IHRoaXMuY2lyY2xlOw0KDQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLmFIcmVmID0gYUhyZWY7DQoNCiAgICAgICAgdmFyIGNvbnRhaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmNvbnRhaW5JZCk7DQoNCiAgICAgICAgY29udGFpbi5hcHBlbmRDaGlsZChhSHJlZik7DQoNCiAgICAgICAgDQoNCiAgICAgICAgdGhpcy5hZGREZWZhdWx0U3VibWl0KGFIcmVmKTsNCg0KICAgICAgICANCg0KICAgICAgICB0aGlzLmFkZERlZmF1bHRFdmVudCgpOw0KDQogICAgICAgIHRoaXMucmVzZXRCdXR0b25TdHlsZSgpOw0KDQogICAgICAgIHJldHVybiBhSHJlZjsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIC8vYWRkIGRlZmF1bHQgc3VibWl0IGltZw0KDQogICAgYWRkRGVmYXVsdFN1Ym1pdCA6IGZ1bmN0aW9uKGFIcmVmKQ0KDQogICAgew0KDQogICAgICAgIGlmICh0aGlzLmlzSW1nQnV0dG9uICYmIHRoaXMuaXNJbWdCdXR0b24gPT0gInRydWUiKQ0KDQogICAgICAgIHsNCg0KICAgICAgICAgICAgdmFyIGltZ0J1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQoNCiAgICAgICAgICAgIGltZ0J1dHRvbi50eXBlID0gImltYWdlIjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaW1nQnV0dG9uLnRhYkluZGV4ID0gIi0xIjsNCg0KICAgICAgICAgICAgaW1nQnV0dG9uLnN0eWxlLndpZHRoID0gIjBweCI7DQoNCiAgICAgICAgICAgIGltZ0J1dHRvbi5zdHlsZS5oZWlnaHQgPSAiMHB4IjsNCg0KICAgICAgICAgICAgaW1nQnV0dG9uLnN0eWxlLmJvcmRlciA9ICJub25lIjsNCg0KICAgICAgICAgICAgYUhyZWYuYXBwZW5kQ2hpbGQoaW1nQnV0dG9uKTsNCg0KICAgICAgICAgICAgaW1nQnV0dG9uWyJvbmNsaWNrIl0gPSBmdW5jdGlvbigpe3JldHVybiBmYWxzZTt9Ow0KDQogICAgICAgICAgICAvL3NIdG1sICs9ICc8aW5wdXQgb25jbGljaz0icmV0dXJuIGZhbHNlOyIgdHlwZT0iaW1hZ2UiIHNyYz0iIiBhbHQ9IiIgc3R5bGU9IndpZHRoOjBweDsgaGVpZ2h0OjBweDsgYm9yZGVyOm5vbmUiIHRhYmluZGV4PSItMSIvPic7DQoNCiAgICAgICAgfQ0KDQogICAgfSwNCg0KICAgIA0KDQogICAgLy9vbGQgc3R5bGUgYnV0dG9uDQoNCiAgICBjcmVhdGVPbGRTdHlsZUJ1dHRvbiA6IGZ1bmN0aW9uKCkNCg0KICAgIHsNCg0KICAgICAgICAvL3ZhciBzSHRtbCA9ICI8aW1nIHN0eWxlPSdib3JkZXI6MHB4Oycgc3JjPSciICsgdGhpcy5pbWcgKyAiJyBuYW1lPSciICsgdGhpcy5uYW1lICsgIicgaWQ9JyIrIHRoaXMuaW1nSWQgKyInIGFsZXJ0ID0gJyIgKyB0aGlzLnRpcCArICInLz4iOw0KDQogICAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsNCg0KICAgICAgICBpbWcuc3JjID0gdGhpcy5pbWc7DQoNCiAgICAgICAgaW1nLm5hbWUgPSB0aGlzLmdldEltZ0lkKCk7DQoNCiAgICAgICAgaW1nLmlkID0gdGhpcy5nZXRJbWdJZCgpOw0KDQogICAgICAgIGltZy5hbHQgPSB0aGlzLnRpcDsNCg0KICAgICAgICBpbWcudGl0bGUgPSB0aGlzLnRpcDsNCg0KICAgICAgICBpbWcuc3R5bGUuYm9yZGVyID0gIjBweCI7DQoNCiAgICAgICAgDQoNCiAgICAgICAgdGhpcy5pbWFnZSA9IGltZzsNCg0KICAgICAgICANCg0KICAgICAgICB2YXIgd3JhcCA9IHRoaXMuY3JlYXRlV3JhcCgpOw0KDQogICAgICAgIHdyYXAuYXBwZW5kQ2hpbGQoaW1nKTsNCg0KICAgICAgICBpZiAodGhpcy5kaXNwbGF5VGV4dCAmJiB0aGlzLmRpc3BsYXlUZXh0ICE9ICJmYWxzZSIpDQoNCiAgICAgICAgeyAgIHZhciBmb250ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZm9udCIpOw0KDQogICAgICAgICAgICBmb250LmNsYXNzTmFtZSA9ICJwb3J0bGV0LW1lbnUtaXRlbSI7DQoNCiAgICAgICAgICAgIGZvbnQuaW5uZXJIVE1MID0gIiZuYnNwOyIrdGhpcy50ZXh0Ow0KDQogICAgICAgICAgICB3cmFwLmFwcGVuZENoaWxkKGZvbnQpOw0KDQogICAgICAgICAgICAvL3NIdG1sICs9ICImbmJzcDs8Zm9udCBjbGFzcz0ncG9ydGxldC1tZW51LWl0ZW0nPjxsYWJlbD4iICsgdGhpcy50ZXh0ICsgIjwvbGFiZWw+PC9mb250PiINCg0KICAgICAgICB9DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICAvL3RyYWRpdGlvbiBidXR0b24NCg0KICAgIGNyZWF0ZVRyYWRpdGlvbkJ1dHRvbiA6IGZ1bmN0aW9uKCkNCg0KICAgIHsNCg0KICAgICAgICB2YXIgc0h0bWwgPSAiPGlucHV0IHR5cGU9J2J1dHRvbicgaWQ9JyIrdGhpcy5pZCsiJyB2YWx1ZT0nIit0aGlzLnRleHQrIicvPiI7DQoNCiAgICAgICAgdGhpcy5jcmVhdGVXcmFwKCkuaW5uZXJIVE1MID0gc0h0bWw7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICB1cGRhdGVJbWcgOiBmdW5jdGlvbihpbWdTcmMpDQoNCiAgICB7DQoNCiAgICAgICAgLy9vbmx5IHVzZSBvbGQgVUkNCg0KICAgICAgICBpZiAoaW1nU3JjKQ0KDQogICAgICAgIHsNCg0KICAgICAgICAgICAgLy9oYW5kbGUgbWVudSBiYXIgY29weQ0KDQogICAgICAgICAgICB2YXIgZXZlbnQgPSB0aGlzLmV2ZW50Ow0KDQogICAgICAgICAgICBpZiAoZXZlbnQpDQoNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgIHZhciBzcmMgPSBldmVudC5zcmNFbGVtZW50Ow0KDQogICAgICAgICAgICAgICAgdmFyIGNoaWxkTm9kZXMgPSBzcmMuY2hpbGRyZW47DQoNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkTm9kZXMubGVuZ3RoOyBpKyspDQoNCiAgICAgICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBjaGlsZE5vZGVzW2ldDQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09ICJpbWciKQ0KDQogICAgICAgICAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGltZyA9IG5vZGU7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCg0KICAgICAgICAgICAgaWYgKCFpbWcpDQoNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgIHZhciBpbWcgPSB0aGlzLmltYWdlOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KDQogICAgICAgICAgICBpZiAoaW1nKQ0KDQogICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICBpbWcuc3JjID0gaW1nU3JjOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KDQogICAgfQ0KDQoNCn0pOw0KDQoNCldpZGdldE1hbmFnZXIucmVnaXN0ZXJXaWRnZXQoImJ1dHRvbiIsVUkuQnV0dG9uKTsNCg0KLyoqDQoNCiAqIA0KDQogKiBWMzYwCSANCg0KICogRmlsZTogRHJvcE1lbnVCdXR0b24uanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiA8PEdlbmVyYWwgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzPj4NCg0KICogDQoNCiAqIE5vdGVzOg0KDQogKiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqIFJldmlzaW9uIEhpc3Rvcnk6DQoNCiAqIDw8RGF0ZT4+LCA8PFdobz4+LCA8PFdoYXQ+Pg0KDQogKiAxNS8wMS8yMDEyLCBSYXkgWmhhbmcsIEluaXRpYWwgdmVyc2lvbg0KDQogKg0KDQogKi8NCg0KDQpVSS5Ecm9wTWVudUJ1dHRvbiA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KDQpVdGlsLmV4dGVuZChVSS5Ecm9wTWVudUJ1dHRvbiwgVUkuQnV0dG9uLCB7DQoNCgkNCg0KCWlkUHJldmlvdXMgOiAiZHJvcGRvd25idXR0b24tIiwNCg0KCQ0KDQoJaXNTaG93IDogZmFsc2UsDQoNCgkNCg0KCWdldEhyZWZJZCA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQlyZXR1cm4gdGhpcy5pZDsNCg0KCX0sDQoNCgkNCg0KCWdldEltZ0lkIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXJldHVybiB0aGlzLmltZ0lkOw0KDQoJfSwNCg0KCQ0KDQoJLy8xCQ0KDQoJaW5pdCA6IGZ1bmN0aW9uKGNvbmZpZykNCg0KCXsNCg0KCQl0aGlzLnRleHQgPSBjb25maWcudGV4dDsNCg0KCQl0aGlzLmNvbnRhaW5JZCA9IGNvbmZpZy5jb250YWluSWQ7DQoNCgkJdGhpcy5pbWdJZCA9IGNvbmZpZy5pbWdJZCB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy5uYW1lID0gY29uZmlnLm5hbWUgfHwgdGhpcy5nZXRJZCgpOw0KDQoJCXRoaXMuaW1nID0gY29uZmlnLmltZyB8fCAiTi9DIjsNCg0KCQl0aGlzLnN3YXBJbWcgPSBjb25maWcuc3dhcEltZyB8fCAiIjsNCg0KCQl0aGlzLnRpcCA9IGNvbmZpZy50aXAgfHwgIiI7DQoNCgkJdGhpcy5pZCA9IGNvbmZpZy5pZCB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy5kaXNwbGF5VGV4dCA9IGNvbmZpZy5kaXNwbGF5VGV4dCB8fCB0cnVlOw0KDQoJCXRoaXMuYWRkRXZlbnRzKCJtb3VzZWVudGVyIiwgIm1vdXNlbGVhdmUiLCAia2V5ZG93biIsICJibHVyIik7DQoNCgl9LA0KDQoJLy8yDQoNCglyZW5kZXIgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJdGhpcy5jcmVhdGVOZXdTdHlsZUJ1dHRvbigpOw0KDQoJCS8vZGVmYXVsdCByZW5kZXIsIG5vdCBwb3N0cG9uZSByZW5kZXINCg0KCQlpZiAodGhpcy5tZW51KQ0KDQoJCQl0aGlzLm1lbnUucmVuZGVyKHRoaXMuYUhyZWYuaWQpOw0KDQoJfSwNCg0KCS8vMw0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24obWVudUJ1dHRvbikNCg0KCXsNCg0KCQl0aGlzLmFIcmVmWyJvbm1vdXNlZW50ZXIiXSA9IHRoaXMub25tb3VzZUVudGVyLmJpbmQodGhpcyk7DQoNCgkJdGhpcy5hSHJlZlsib25tb3VzZWxlYXZlIl0gPSB0aGlzLm9ubW91c2VMZWF2ZS5iaW5kKHRoaXMpOw0KDQoJCXRoaXMuYUhyZWZbIm9ua2V5ZG93biJdID0gdGhpcy5vbmtleWRvd24uYmluZCh0aGlzKTsNCg0KCQl0aGlzLmFIcmVmWyJvbmJsdXIiXSA9IHRoaXMub25ibHVyLmJpbmQodGhpcyk7DQoNCgl9LCANCg0KCQ0KDQoJb25tb3VzZUVudGVyIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCWlmICghdGhpcy5zdG9yZVVybCkNCg0KCQkJdGhpcy5tb3VzZUVudGVyKCk7DQoNCgkJZWxzZQ0KDQoJCQl0aGlzLnJlZnJlc2hNZW51SXRlbSgpOw0KDQoJCXRoaXMuZmlyZUV2ZW50KCJtb3VzZWVudGVyIik7DQoNCgl9LA0KDQoJDQoNCglvbm1vdXNlTGVhdmUgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJdGhpcy5tb3VzZUxlYXZlKCk7DQoNCgkJdGhpcy5maXJlRXZlbnQoIm1vdXNlTGVhdmUiKTsNCg0KCX0sDQoNCgkNCg0KCW1vdXNlRW50ZXIgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJaWYgKHRoaXMudGltZW91dCl7DQoNCgkJCWNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpOw0KDQoJCX0NCg0KCQl0aGlzLmxlZnQuY2xhc3NOYW1lID0gIm1lbnUtbGVmdC1ob3ZlciI7DQoNCgkJdGhpcy5taWQuY2xhc3NOYW1lID0gIm1lbnUtbWlkZGxlLWhvdmVyIjsNCg0KCQl0aGlzLnJpZ2h0LmNsYXNzTmFtZSA9ICJtZW51LXJpZ2h0LWhvdmVyIjsNCg0KCQl0aGlzLm1pZC5maXJzdENoaWxkLmNsYXNzTmFtZT0gInBvcnRsZXQtbWVudS1pdGVtLWhvdmVyIjsNCg0KDQoJCWlmICh0aGlzLm1lbnUpDQoNCgkJew0KDQoJCQl0aGlzLm1lbnUuaGlkZGVuKCk7DQoNCgkJCXRoaXMubWVudS5zaG93KHRoaXMuYUhyZWYuaWQpOw0KDQoJCX0NCg0KCQl0aGlzLmFIcmVmLnN0eWxlLmN1cnNvciA9ICJoYW5kIjsNCg0KCQlyZXR1cm4gZmFsc2U7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICAvKg0KDQogICAgICogcmV0dXJuIGRhdGEgZm9ybWF0OnttZW51Olt7dGV4dDouLiwgaXRlbU9uQ2xpY2tTdHI6IC4uLixpdGVtQWNjZXNzS2V5Oi4ufV0sIG1lbnVOYW1lOi4ufQ0KDQogICAgICogbW9yZTogQXR0YWNoZWRHSVNBY3Rpb24uZG9SZXRyaWV2ZU1lbnVJdGVtcw0KDQogICAgICogKi8NCg0KICAgIHJlZnJlc2hNZW51SXRlbSA6IGZ1bmN0aW9uKCkNCg0KICAgIHsNCg0KICAgIAlyZW1vdGVBY2Nlc3ModGhpcy5zdG9yZVVybCwgdGhpcy5oYW5kbGVSZXNwb25zZURhdGEuYmluZCh0aGlzKSk7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICBoYW5kbGVSZXNwb25zZURhdGEgOiBmdW5jdGlvbihkYXRhKQ0KDQogICAgew0KDQogICAgCXZhciByZXNwb25zZU1zZyA9IEJhc2VKUy5zdHJUb0pzb24oZGF0YSk7DQoNCgkJdmFyIG1lbnUgPSByZXNwb25zZU1zZy5tZW51Ow0KDQoJCW1lbnUgPSBCYXNlSlMuc3RyVG9Kc29uKG1lbnUpOw0KDQoJCXZhciBtZW51SXRlbTsNCg0KCQlpZiAodGhpcy5tZW51KXsNCg0KCQkJdGhpcy5tZW51LmNsZWFySXRlbSgpOw0KDQoJCQl0aGlzLm1lbnUgPSBudWxsOw0KDQoJCX0NCg0KCQlmb3IodmFyIGkgPSAwOyBpIDwgbWVudS5sZW5ndGg7IGkrKykNCg0KCQl7DQoNCgkJCW1lbnVJdGVtID0gQmFzZUpTLnN0clRvSnNvbihtZW51W2ldKTsNCg0KCQkJdmFyIGl0ZW0gPSBuZXcgVUkuTWVudUl0ZW0oe3RleHQ6bWVudUl0ZW0udGV4dCwgY2xpY2s6IG1lbnVJdGVtLml0ZW1PbkNsaWNrU3RyfSk7DQoNCgkJCXRoaXMuYWRkSXRlbShpdGVtKTsNCg0KCQl9DQoNCgkJdGhpcy5zaG93KCk7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICByZXNldEJ1dHRvblN0eWxlIDogZnVuY3Rpb24oKQ0KDQogICAgew0KDQoJCXRoaXMubGVmdC5jbGFzc05hbWUgPSAibWVudS1sZWZ0LW5vcm1hbCI7DQoNCgkJdGhpcy5taWQuY2xhc3NOYW1lID0gIm1lbnUtbWlkZGxlLW5vcm1hbCI7DQoNCgkJdGhpcy5yaWdodC5jbGFzc05hbWUgPSAibWVudS1yaWdodC1ub3JtYWwiOw0KDQoJCXRoaXMubWlkLmZpcnN0Q2hpbGQuY2xhc3NOYW1lPSAicG9ydGxldC1tZW51LWl0ZW0iOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgbW91c2VMZWF2ZSA6IGZ1bmN0aW9uICgpDQoNCiAgICB7DQoNCiAgICAJaWYgKCF0aGlzLnRpbWVvdXRGbikNCg0KICAgIAl7DQoNCiAgICAJCXRoaXMudGltZW91dEZuID0gZnVuY3Rpb24oKXsNCg0KICAgIAkJCWlmICh0aGlzLm1lbnUpDQoNCiAgICAJCQkJdGhpcy5tZW51LmhpZGRlbigpOw0KDQogICAgCQkJdGhpcy5yZXNldEJ1dHRvblN0eWxlKCk7DQoNCiAgICAJCX0uYmluZCh0aGlzKTsNCg0KICAgIAl9DQoNCiAgICAJDQoNCiAgICAJLy9kZWFsIHdpdGggbW91c2UgbW92ZSB0byBkcm9wIG1lbnUgZXZlbnQNCg0KICAgIAkvL2JlY2F1c2Ugd2hlbiBtb3VzZSBsZWF2ZSBidXR0b24sIHRoZSBtZW51IHdpbGwgaGlkZGVuDQoNCiAgICAJdGhpcy50aW1lb3V0ID0gc2V0VGltZW91dCh0aGlzLnRpbWVvdXRGbiwgMTAwKTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIG9uYmx1ciA6IGZ1bmN0aW9uKCkNCg0KICAgIHsNCg0KICAgIAlpZiAodGhpcy5pc1Nob3cpDQoNCiAgICAJCXJldHVybjsNCg0KICAgIAl0aGlzLm1vdXNlTGVhdmUoKTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIG9uZm9jdXMgOiBmdW5jdGlvbigpDQoNCiAgICB7DQoNCiAgICAJdGhpcy5pc1Nob3cgPSBmYWxzZTsNCg0KICAgIAl0aGlzLmFIcmVmLmZvY3VzKCk7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICBvbmtleWRvd24gOiBmdW5jdGlvbigpDQoNCiAgICB7DQoNCiAgICAJc3dpdGNoKGV2ZW50LmtleUNvZGUpDQoNCiAgICAJew0KDQogICAgCQljYXNlIHRoaXMua2V5Q29kZS5lbnRlcjoNCg0KICAgIAkJCXRoaXMubW91c2VFbnRlcigpOw0KDQogICAgCQkJYnJlYWs7DQoNCiAgICAJCWNhc2UgdGhpcy5rZXlDb2RlLnVwOg0KDQogICAgCQkJdGhpcy51cCgpOw0KDQogICAgCQkJYnJlYWs7DQoNCiAgICAJCWNhc2UgdGhpcy5rZXlDb2RlLmRvd246DQoNCiAgICAJCQl0aGlzLmRvd24oKTsNCg0KICAgIAkJCWJyZWFrOw0KDQogICAgCX0NCg0KCQl0aGlzLmZpcmVFdmVudCgia2V5ZG93biIpOw0KDQogICAgfSwNCg0KDQogICAgdXAgOiBmdW5jdGlvbigpDQoNCiAgICB7DQoNCiAgICAJaWYgKCF0aGlzLm1lbnUuZ2V0U2hvdygpKQ0KDQogICAgCXsNCg0KICAgIAkJdGhpcy5tb3VzZUVudGVyKCk7DQoNCiAgICAJfQ0KDQogICAgCXRoaXMuaXNTaG93ID0gdHJ1ZTsNCg0KICAgIAl0aGlzLm1lbnUudXAoKTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIGRvd24gOiBmdW5jdGlvbigpDQoNCiAgICB7DQoNCiAgICAJaWYgKCF0aGlzLm1lbnUuZ2V0U2hvdygpKQ0KDQogICAgCXsNCg0KICAgIAkJdGhpcy5tb3VzZUVudGVyKCk7DQoNCiAgICAJfQ0KDQogICAgCXRoaXMuaXNTaG93ID0gdHJ1ZTsNCg0KICAgIAl0aGlzLm1lbnUuZG93bigpOw0KDQogICAgfSwNCg0KICAgIA0KDQoJc2V0VGV4dCA6IGZ1bmN0aW9uKHRleHQpDQoNCgl7DQoNCgkJdGhpcy50ZXh0ID0gdGV4dDsNCg0KCX0sDQoNCgkNCg0KCXNldElkIDogZnVuY3Rpb24oaWQpDQoNCgl7DQoNCgkJdGhpcy5pZCA9IGlkIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCX0sDQoNCgkNCg0KCXNldEltZyA6IGZ1bmN0aW9uKGltZykNCg0KCXsNCg0KCQl0aGlzLmltZyA9IGltZzsNCg0KCX0sDQoNCgkNCg0KCXNldFN3YXBJbWcgOiBmdW5jdGlvbihzd2FwSW1nKXsNCg0KCQl0aGlzLnN3YXBJbWcgPSBzd2FwSW1nOw0KDQoJfSwNCg0KCQ0KDQoJc2V0Q29udGFpbklkIDogZnVuY3Rpb24oY29udGFpbklkKQ0KDQoJew0KDQoJCXRoaXMuY29udGFpbklkID0gY29udGFpbklkOw0KDQoJfSwNCg0KCQ0KDQoJc2V0VGlwIDogZnVuY3Rpb24odGlwKQ0KDQoJew0KDQoJCXRoaXMuc2V0VGlwKHRpcCk7DQoNCgl9LA0KDQoJDQoNCglzZXROYW1lIDogZnVuY3Rpb24obmFtZSkNCg0KCXsNCg0KCQl0aGlzLm5hbWUgPSBuYW1lOw0KDQoJfSwNCg0KCQ0KDQoJc2V0TWVudSA6IGZ1bmN0aW9uKG1lbnUpDQoNCgl7DQoNCgkJdGhpcy5tZW51ID0gbWVudTsNCg0KCX0sDQoNCgkNCg0KCWFkZEl0ZW0gOiBmdW5jdGlvbihtZW51SXRlbSkNCg0KCXsNCg0KCQlpZiAoIXRoaXMubWVudSkNCg0KCQl7DQoNCgkJCXRoaXMubWVudSA9IG5ldyBVSS5Ecm9wTWVudSgpOw0KDQoJCQl2YXIgbW91c2VFbnRlciA9IGZ1bmN0aW9uKCl7DQoNCgkJCQlpZiAodGhpcy50aW1lb3V0KQ0KDQoJCQkJCWNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpOw0KDQoJCQl9Ow0KDQoJCQl2YXIgbW91c2VMZWF2ZSA9IGZ1bmN0aW9uKCl7DQoNCgkJCQl0aGlzLm1vdXNlTGVhdmUoKTsNCg0KCQkJfTsNCg0KCQkJLy93aGVuIG1lbnUgaXRlbSBsb3N0IGZvY3VzLCBjaGFuZ2UgdGhpcy5pc1NvdyBzdGF0ZQ0KDQoJCQl2YXIgYmx1ciA9IGZ1bmN0aW9uKCl7DQoNCgkJCQl0aGlzLm9uZm9jdXMoKTsNCg0KCQkJfTsNCg0KCQkJDQoNCgkJCXRoaXMubWVudS5hZGRMaXN0ZW5lcigibW91c2VlbnRlciIsIG1vdXNlRW50ZXIsIHRoaXMpOw0KDQoJCQl0aGlzLm1lbnUuYWRkTGlzdGVuZXIoIm1vdXNlbGVhdmUiLCBtb3VzZUxlYXZlLCB0aGlzKTsNCg0KCQkJdGhpcy5tZW51LmFkZExpc3RlbmVyKCJibHVyIiwgYmx1ciwgdGhpcyk7Ly9saXN0ZW4gZm9jdXMgZXhpc3QgZHJvcCBtZW51DQoNCgkJfQ0KDQoJCXRoaXMubWVudS5hZGRJdGVtKG1lbnVJdGVtKTsNCg0KCX0sDQoNCgkJDQoNCglzaG93IDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXRoaXMubW91c2VFbnRlcigpOw0KDQoJfSwNCg0KCQ0KDQoJLy9keW5hbWljIHJldHJpZXZlIGRhdGEgZm9yIGRyb3AgbWVudSBpdGVtDQoNCglzZXRTdG9yZVVybCA6IGZ1bmN0aW9uKHN0b3JlVXJsKQ0KDQoJew0KDQoJCXRoaXMuc3RvcmVVcmwgPSBzdG9yZVVybDsNCg0KCX0NCg0KfSk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IG1lbnVCdXR0b24uanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiA8PEdlbmVyYWwgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzPj4NCg0KICogDQoNCiAqIE5vdGVzOg0KDQogKiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqIFJldmlzaW9uIEhpc3Rvcnk6DQoNCiAqIDw8RGF0ZT4+LCA8PFdobz4+LCA8PFdoYXQ+Pg0KDQogKiAyNS8xMC8yMDEwLCBSYXkgTGksIEluaXRpYWwgdmVyc2lvbg0KDQogKg0KDQogKi8NCg0KDQpVSS5WMzYwQnV0dG9uID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClV0aWwuZXh0ZW5kKFVJLlYzNjBCdXR0b24sIFVJLkJ1dHRvbiwgew0KDQoJDQoNCglpZFByZXZpb3VzIDogImJ1dHRvbi0iLA0KDQoJDQoNCglnZXRIcmVmSWQgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJaWYgKHRoaXMuaXNJbWdCdXR0b24gPT0gInRydWUiKQ0KDQoJCQlyZXR1cm4gdGhpcy5pZDsgDQoNCgkJcmV0dXJuICJhXyIrdGhpcy5pZDsNCg0KCX0sDQoNCg0KCWdldEltZ0lkIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXJldHVybiB0aGlzLmltZ0lkOw0KDQoJfSwNCg0KDQoJaW5pdDogZnVuY3Rpb24oY29uZmlnKSB7DQoNCgkJdGhpcy50ZXh0ID0gY29uZmlnLnRleHQ7DQoNCgkJdGhpcy5jb250YWluSWQgPSBjb25maWcuY29udGFpbklkOw0KDQoJCXRoaXMuaW1nSWQgPSBjb25maWcuaW1nSWQgfHwgdGhpcy5nZXRJZCgpOw0KDQoJCXRoaXMubmFtZSA9IGNvbmZpZy5uYW1lIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLmltZyA9IGNvbmZpZy5pbWc7DQoNCgkJdGhpcy50aXAgPSBjb25maWcudGlwIHx8ICIiOw0KDQoJCXRoaXMudGFyZ2V0ID0gY29uZmlnLnRhcmdldCB8fCAiIjsNCg0KCQl0aGlzLmhyZWYgPSBjb25maWcuaHJlZiB8fCAiamF2YXNjcmlwdDp2b2lkKDApOyI7DQoNCgkJdGhpcy5zd2FwSW1nID0gY29uZmlnLnN3YXBJbWcgfHwgIiI7DQoNCgkJdGhpcy5pZCA9IGNvbmZpZy5pZCB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy5kaXNwbGF5VGV4dCA9IGNvbmZpZy5kaXNwbGF5VGV4dCB8fCB0cnVlOw0KDQoJCXRoaXMuYWNjZXNza2V5ID0gY29uZmlnLmFjY2Vzc2tleSB8fCAiIjsNCg0KCQl0aGlzLmlzSW1nQnV0dG9uID0gY29uZmlnLmlzSW1nQnV0dG9uIHx8ICJmYWxzZSI7DQoNCgkJdGhpcy5hZGRFdmVudHMoIm1vdXNlZW50ZXIiLCAibW91c2VsZWF2ZSIsICJrZXlkb3duIiwgImNsaWNrIik7DQoNCgkJdGhpcy5zdXBwb3J0RXZlbnRzID0gY29uZmlnLnN1cHBvcnRFdmVudHMgfHwgWyAiY2xpY2siIF07DQoNCgkJdGhpcy5jaXJjbGUgPSBjb25maWcuY2lyY2xlOw0KDQoJfSwNCg0KCQ0KDQoJcmVuZGVyIDogZnVuY3Rpb24oKXsNCg0KCQl0aGlzLmNyZWF0ZU5ld1N0eWxlQnV0dG9uKCk7DQoNCgl9LA0KDQoJDQoNCiAgICBnZXRPdXRlckhUTUwgOiBmdW5jdGlvbihkYXRhKSB7DQoNCiAgICAgICAgdmFyIGluaXREYXRhID0gZGF0YSB8fCB7fTsNCg0KICAgICAgICB2YXIgaWQgPSBpbml0RGF0YS5pZCB8fCB0aGlzLmlkOw0KDQogICAgICAgIHZhciBuYW1lID0gaW5pdERhdGEubmFtZSB8fCBpZDsNCg0KICAgICAgICB2YXIgZGlzYWJsZWQgPSBpbml0RGF0YS5kaXNhYmxlZCB8fCB0aGlzLmRpc2FibGVkOw0KDQogICAgICAgIHZhciBjbGFzc05hbWUgPSBpbml0RGF0YS5jbGFzc05hbWUgfHwgdGhpcy5jbGFzc05hbWU7DQoNCiAgICAgICAgdmFyIHRpdGxlID0gaW5pdERhdGEudGl0bGUgfHwgdGhpcy50aXRsZTsNCg0KICAgICAgICB2YXIgYWNjZXNza2V5ID0gaW5pdERhdGEuYWNjZXNza2V5IHx8IHRoaXMuYWNjZXNza2V5Ow0KDQogICAgICAgIHZhciBzdHlsZSA9IGluaXREYXRhLnN0eWxlIHx8IHRoaXMuc3R5bGU7DQoNCiAgICAgICAgdmFyIHRhYkluZGV4ID0gaW5pdERhdGEudGFiSW5kZXggfHwgdGhpcy50YWJJbmRleDsNCg0KICAgICAgICB2YXIgZXZlbnRNYXAgPSBpbml0RGF0YS5ldmVudE1hcCB8fCB0aGlzLmV2ZW50TWFwOw0KDQogICAgICAgIHZhciBzdXBwb3J0RXZlbnRzID0gaW5pdERhdGEuc3VwcG9ydEV2ZW50cyB8fCB0aGlzLnN1cHBvcnRFdmVudHM7DQoNCiAgICAgICAgdmFyIHZhbHVlID0gaW5pdERhdGEudmFsdWUgfHwgdGhpcy52YWx1ZTsNCg0KDQogICAgICAgIHZhciBjb250ZW50ID0gbmV3IEFycmF5KCk7DQoNCiAgICAgICAgdmFyIGxlZnREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKTsNCg0KICAgICAgICBsZWZ0RGl2LmlkID0gdGhpcy5nZXRJZCgpOw0KDQogICAgDQoNCiAgICAgICAgdmFyIHJpZ2h0RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIik7DQoNCiAgICAgICAgcmlnaHREaXYuaWQgPSB0aGlzLmdldElkKCk7DQoNCg0KICAgICAgICB2YXIgbWlkRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIik7DQoNCiAgICAgICAgbWlkRGl2LmlkID0gdGhpcy5nZXRJZCgpOw0KDQogICAgICAgIG1pZERpdi5pbm5lckhUTUwgPSAiPGZvbnQgY2xhc3M9J3BvcnRsZXQtbWVudS1pdGVtJz4iICsgdmFsdWUgKyAiPC9mb250PiI7DQoNCiAgICANCg0KICAgICAgICByaWdodERpdi5hcHBlbmRDaGlsZChtaWREaXYpOw0KDQogICAgICAgIGxlZnREaXYuYXBwZW5kQ2hpbGQocmlnaHREaXYpOw0KDQoNCiAgICAgICAgdGhpcy5sZWZ0ID0gbGVmdERpdjsNCg0KICAgICAgICB0aGlzLnJpZ2h0ID0gcmlnaHREaXY7DQoNCiAgICAgICAgdGhpcy5taWQgPSBtaWREaXY7DQoNCg0KICAgICAgICBsZWZ0RGl2LmNsYXNzTmFtZSA9ICJtZW51LWxlZnQtbm9ybWFsLWJ1dHRvbiI7DQoNCiAgICAgICAgbWlkRGl2LmNsYXNzTmFtZSA9ICJtZW51LW1pZGRsZS1ub3JtYWwtYnV0dG9uIjsNCg0KICAgICAgICByaWdodERpdi5jbGFzc05hbWUgPSAibWVudS1yaWdodC1ub3JtYWwtYnV0dG9uIjsNCg0KICAgICAgICBjb250ZW50LnB1c2goJzxBIHN0eWxlPSJDVVJTT1I6IGhhbmQ7IFRFWFQtREVDT1JBVElPTjogbm9uZSIgaWQ9Jyk7DQoNCiAgICAgICAgY29udGVudC5wdXNoKGlkKTsNCg0KICAgICAgICBjb250ZW50LnB1c2goJyBocmVmPSIjIiAnKTsNCg0KICAgICAgICBjb250ZW50LnB1c2godGhpcy5ldmVudHNUb0hUTUwoZXZlbnRNYXAsIHN1cHBvcnRFdmVudHMpKTsNCg0KICAgICAgICBjb250ZW50LnB1c2goJyBvbm1vdXNlZW50ZXI9ZW50ZXJOZXdTdHlsZUJ1dHRvbigpOycpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCgnIG9ubW91c2VsZWF2ZT1sZWF2ZU5ld1N0eWxlQnV0dG9uKCk7Jyk7DQoNCiAgICAgICAgY29udGVudC5wdXNoKCc+Jyk7DQoNCiAgICAgICAgY29udGVudC5wdXNoKGxlZnREaXYub3V0ZXJIVE1MKTsNCg0KICAgICAgICBjb250ZW50LnB1c2goJzwvQT4nKTsNCg0KICAgICAgICAgDQoNCiAgICAgICAgIHJldHVybiBjb250ZW50LmpvaW4oIiIpOw0KDQogICAgfSwNCg0KCQ0KDQoJLy8zDQoNCglhZGREZWZhdWx0RXZlbnQgOiBmdW5jdGlvbihtZW51QnV0dG9uKQ0KDQoJew0KDQoJCUFjMzYwLmF0dGFjaEV2ZW50KHRoaXMuYUhyZWYsIm9ubW91c2VlbnRlciIsIHRoaXMub25tb3VzZUVudGVyLmJpbmQodGhpcykpOw0KDQoJCUFjMzYwLmF0dGFjaEV2ZW50KHRoaXMuYUhyZWYsIm9ubW91c2VsZWF2ZSIsIHRoaXMub25tb3VzZUxlYXZlLmJpbmQodGhpcykpOw0KDQoJCUFjMzYwLmF0dGFjaEV2ZW50KHRoaXMuYUhyZWYsIm9uY2xpY2siLCB0aGlzLm9uY2xpY2suYmluZCh0aGlzKSk7DQoNCgkJQWMzNjAuYXR0YWNoRXZlbnQodGhpcy5hSHJlZiwib25rZXlkb3duIiwgdGhpcy5vbmtleWRvd24uYmluZCh0aGlzKSk7DQoNCgl9LCANCg0KCQ0KDQoJb25tb3VzZUVudGVyIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXRoaXMuZXZlbnQgPSBBYzM2MC5nZXRFdmVudCgpOw0KDQoJCXRoaXMubW91c2VFbnRlcigpOw0KDQoJCXRoaXMuZmlyZUV2ZW50KCJtb3VzZWVudGVyIiwgdGhpcy5ldmVudCk7DQoNCgkJdGhpcy5ldmVudCA9IG51bGw7DQoNCgl9LA0KDQoJDQoNCglvbm1vdXNlTGVhdmUgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJdGhpcy5ldmVudCA9IEFjMzYwLmdldEV2ZW50KCk7DQoNCgkJdGhpcy5tb3VzZUxlYXZlKCk7DQoJCQ0KCQl0aGlzLmZpcmVFdmVudCgibW91c2VMZWF2ZSIsIHRoaXMuZXZlbnQpOw0KDQoJCXRoaXMuZXZlbnQgPSBudWxsOw0KDQoJfSwNCg0KCQ0KDQoJbW91c2VFbnRlciA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQkvL2hhbmRsZSBtZW51IGJhciBjb3B5DQoNCgkJdmFyIGV2ZW50ID0gdGhpcy5ldmVudDsNCg0KCQlpZiAoZXZlbnQpDQoNCgkJCXZhciBzcmMgPSBldmVudC5zcmNFbGVtZW50Ow0KDQoJCQ0KDQoJCWlmIChzcmMgJiYgc3JjLnRhZ05hbWUgJiYgc3JjLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSAiYSIpDQoNCgkJew0KDQoJCQlpZiAoc3JjLmZpcnN0Q2hpbGQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09ICJpbnB1dCIpDQoNCgkJCXsNCg0KCQkJCXNyYy5jaGlsZE5vZGVzWzFdLmNsYXNzTmFtZSArPSAiIG1lbnUtbGVmdC1ob3Zlci1idXR0b24iOw0KDQoJCQkJc3JjLmNoaWxkTm9kZXNbMV0uZmlyc3RDaGlsZC5jbGFzc05hbWUgKz0gIiBtZW51LXJpZ2h0LWhvdmVyLWJ1dHRvbiI7DQoNCgkJCQlzcmMuY2hpbGROb2Rlc1sxXS5maXJzdENoaWxkLmZpcnN0Q2hpbGQuY2xhc3NOYW1lICs9ICIgbWVudS1taWRkbGUtaG92ZXItYnV0dG9uIjsNCg0KCQkJCXNyYy5jaGlsZE5vZGVzWzFdLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5maXJzdENoaWxkLmNsYXNzTmFtZSArPSAiIHBvcnRsZXQtbWVudS1pdGVtLWhvdmVyIjsJCQkJCQ0KDQoJCQl9DQoNCgkJCWVsc2UNCg0KCQkJew0KDQoJCQkJc3JjLmZpcnN0Q2hpbGQuY2xhc3NOYW1lICs9ICIgbWVudS1sZWZ0LWhvdmVyLWJ1dHRvbiI7DQoNCgkJCQlzcmMuZmlyc3RDaGlsZC5maXJzdENoaWxkLmNsYXNzTmFtZSArPSAiIG1lbnUtcmlnaHQtaG92ZXItYnV0dG9uIjsNCg0KCQkJCXNyYy5maXJzdENoaWxkLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5jbGFzc05hbWUgKz0gIiBtZW51LW1pZGRsZS1ob3Zlci1idXR0b24iOw0KDQoJCQkJc3JjLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5maXJzdENoaWxkLmZpcnN0Q2hpbGQuY2xhc3NOYW1lICs9ICIgcG9ydGxldC1tZW51LWl0ZW0taG92ZXIiOwkJCQkJDQoNCgkJCX0NCg0KCQl9DQoNCgkJZWxzZQ0KDQoJCXsNCg0KCQkJdGhpcy5sZWZ0LmNsYXNzTmFtZSArPSAiIG1lbnUtbGVmdC1ob3Zlci1idXR0b24iOw0KDQoJCQl0aGlzLm1pZC5jbGFzc05hbWUgKz0gIiBtZW51LW1pZGRsZS1ob3Zlci1idXR0b24iOw0KDQoJCQl0aGlzLnJpZ2h0LmNsYXNzTmFtZSArPSAiIG1lbnUtcmlnaHQtaG92ZXItYnV0dG9uIjsNCg0KCQkJdGhpcy5taWQuZmlyc3RDaGlsZC5jbGFzc05hbWU9ICJwb3J0bGV0LW1lbnUtaXRlbS1ob3ZlciI7DQoNCgkJfQ0KDQoJCQ0KDQoJCXRoaXMuYUhyZWYuc3R5bGUuY3Vyc29yID0gImhhbmQiOw0KDQoJCQ0KDQoJCXJldHVybiBmYWxzZTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIG9uY2xpY2sgOiBmdW5jdGlvbigpDQoNCiAgICB7ICAgDQoNCiAgICAJLy9kZXN0cm95IGJvZHkgZXZlbnQNCg0KICAgIAlVSS5wb3NpdGlvbk1nci5kZXN0cm95RXZlbjJCb2R5KCk7DQoNCiAgICAJaWYgKHRoaXMuZGlzYWJsZWQpDQoNCiAgICAJCXJldHVybjsNCg0KICAgIAlyZXR1cm4gdGhpcy5maXJlRXZlbnQoImNsaWNrIik7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICBvbmtleWRvd24gOiBmdW5jdGlvbigpDQoNCiAgICB7DQoNCiAgICAJdGhpcy5maXJlRXZlbnQoImtleWRvd24iKTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIHJlc2V0QnV0dG9uU3R5bGUgOiBmdW5jdGlvbigpDQoNCiAgICB7DQoNCgkJLy9oYW5kbGUgbWVudSBiYXIgY29weSAgICAJCQ0KDQoJCXZhciBldmVudCA9IHRoaXMuZXZlbnQ7DQoNCgkJaWYgKGV2ZW50KQ0KDQoJCQl2YXIgc3JjID0gZXZlbnQuc3JjRWxlbWVudDsNCg0KCQkNCg0KCQlpZiAoc3JjICYmIHNyYy50YWdOYW1lICYmIHNyYy50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gImEiKQ0KDQoJCXsNCg0KCQkJdmFyIHNyYyA9IGV2ZW50LnNyY0VsZW1lbnQ7DQoNCgkJCWlmIChzcmMuZmlyc3RDaGlsZC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gImlucHV0IikNCg0KCQkJew0KDQoJCQkJc3JjLmNoaWxkTm9kZXNbMV0uY2xhc3NOYW1lID0gIm1lbnUtbGVmdC1ub3JtYWwtYnV0dG9uIjsNCg0KCQkJCXNyYy5jaGlsZE5vZGVzWzFdLmZpcnN0Q2hpbGQuY2xhc3NOYW1lID0gIm1lbnUtcmlnaHQtbm9ybWFsLWJ1dHRvbiI7DQoNCgkJCQlzcmMuY2hpbGROb2Rlc1sxXS5maXJzdENoaWxkLmZpcnN0Q2hpbGQuY2xhc3NOYW1lID0gIm1lbnUtbWlkZGxlLW5vcm1hbC1idXR0b24iOw0KDQoJCQkJc3JjLmNoaWxkTm9kZXNbMV0uZmlyc3RDaGlsZC5maXJzdENoaWxkLmZpcnN0Q2hpbGQuY2xhc3NOYW1lID0gInBvcnRsZXQtbWVudS1pdGVtIjsNCg0KCQkJfQ0KDQoJCQllbHNlDQoNCgkJCXsNCg0KCQkJCXNyYy5maXJzdENoaWxkLmNsYXNzTmFtZSA9ICJtZW51LWxlZnQtbm9ybWFsLWJ1dHRvbiI7DQoNCgkJCQlzcmMuZmlyc3RDaGlsZC5maXJzdENoaWxkLmNsYXNzTmFtZSA9ICJtZW51LXJpZ2h0LW5vcm1hbC1idXR0b24iOw0KDQoJCQkJc3JjLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5maXJzdENoaWxkLmNsYXNzTmFtZSA9ICJtZW51LW1pZGRsZS1ub3JtYWwtYnV0dG9uIjsNCg0KCQkJCXNyYy5maXJzdENoaWxkLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5maXJzdENoaWxkLmNsYXNzTmFtZSA9ICJwb3J0bGV0LW1lbnUtaXRlbSI7DQoNCgkJCX0NCg0KCQkJDQoNCgkJfQ0KDQoJCWVsc2UNCg0KCQl7DQoNCgkJCXRoaXMubGVmdC5jbGFzc05hbWUgPSAibWVudS1sZWZ0LW5vcm1hbC1idXR0b24iOw0KDQoJCQl0aGlzLm1pZC5jbGFzc05hbWUgPSAibWVudS1taWRkbGUtbm9ybWFsLWJ1dHRvbiI7DQoNCgkJCXRoaXMucmlnaHQuY2xhc3NOYW1lID0gIm1lbnUtcmlnaHQtbm9ybWFsLWJ1dHRvbiI7DQoNCgkJCXRoaXMubWlkLmZpcnN0Q2hpbGQuY2xhc3NOYW1lPSAicG9ydGxldC1tZW51LWl0ZW0iOw0KDQoJCX0NCg0KICAgIH0sDQoNCiAgICANCg0KICAgIG1vdXNlTGVhdmUgOiBmdW5jdGlvbiAoKQ0KDQogICAgew0KDQogICAgCXRoaXMucmVzZXRCdXR0b25TdHlsZSgpOw0KDQogICAgfSwNCg0KCQ0KDQoJc2V0SW1nIDogZnVuY3Rpb24oaW1nKQ0KDQoJew0KDQoJCXRoaXMuaW1nID0gaW1nOw0KDQoJfSwNCg0KCQ0KDQoJc2V0SHJlZiA6IGZ1bmN0aW9uKGhyZWYpDQoNCgl7DQoNCgkJdGhpcy5ocmVmID0gaHJlZjsNCg0KCX0sDQoNCgkNCg0KCXNldFN3YXBJbWcgOiBmdW5jdGlvbihzd2FwSW1nKQ0KDQoJew0KDQoJCXRoaXMuc3dhcEltZyA9IHN3YXBJbWc7DQoNCgl9LA0KDQoJDQoNCgllbmFibGUgOiBmdW5jdGlvbigpew0KDQoJCXRoaXMuZGlzYWJsZWQgPSBmYWxzZTsNCg0KCQl0aGlzLmFIcmVmLmRpc2FibGVkID0gZmFsc2U7DQoNCgl9LA0KDQoJDQoNCglkaXNhYmxlIDogZnVuY3Rpb24oKXsNCg0KCQl0aGlzLmRpc2FibGVkID0gdHJ1ZTsNCg0KCQl0aGlzLmFIcmVmLmRpc2FibGVkID0gdHJ1ZTsNCg0KCX0NCg0KfSk7DQoNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgiYnV0dG9uIiwgVUkuVjM2MEJ1dHRvbik7DQoNCg0KDQoNCmZ1bmN0aW9uIGVudGVyTmV3U3R5bGVCdXR0b24oKQ0KDQp7DQoNCiAgICAvL2hhbmRsZSBtZW51IGJhciBjb3B5DQoNCiAgICB2YXIgZXZlbnQgPSB0aGlzLmV2ZW50Ow0KDQogICAgaWYgKGV2ZW50KQ0KDQogICAgICAgIHZhciBzcmMgPSBldmVudC5zcmNFbGVtZW50Ow0KDQogICAgDQoNCiAgICBpZiAoc3JjICYmIHNyYy50YWdOYW1lICYmIHNyYy50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gImEiKQ0KDQogICAgew0KDQogICAgICAgIGlmIChzcmMuZmlyc3RDaGlsZC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gImlucHV0IikNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHNyYy5jaGlsZE5vZGVzWzFdLmNsYXNzTmFtZSArPSAiIG1lbnUtbGVmdC1ob3Zlci1idXR0b24iOw0KDQogICAgICAgICAgICBzcmMuY2hpbGROb2Rlc1sxXS5maXJzdENoaWxkLmNsYXNzTmFtZSArPSAiIG1lbnUtcmlnaHQtaG92ZXItYnV0dG9uIjsNCg0KICAgICAgICAgICAgc3JjLmNoaWxkTm9kZXNbMV0uZmlyc3RDaGlsZC5maXJzdENoaWxkLmNsYXNzTmFtZSArPSAiIG1lbnUtbWlkZGxlLWhvdmVyLWJ1dHRvbiI7DQoNCiAgICAgICAgICAgIHNyYy5jaGlsZE5vZGVzWzFdLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5maXJzdENoaWxkLmNsYXNzTmFtZSArPSAiIHBvcnRsZXQtbWVudS1pdGVtLWhvdmVyIjsgICAgICAgICAgICAgICAgIA0KDQogICAgICAgIH0NCg0KICAgICAgICBlbHNlDQoNCiAgICAgICAgew0KDQogICAgICAgICAgICBzcmMuZmlyc3RDaGlsZC5jbGFzc05hbWUgKz0gIiBtZW51LWxlZnQtaG92ZXItYnV0dG9uIjsNCg0KICAgICAgICAgICAgc3JjLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5jbGFzc05hbWUgKz0gIiBtZW51LXJpZ2h0LWhvdmVyLWJ1dHRvbiI7DQoNCiAgICAgICAgICAgIHNyYy5maXJzdENoaWxkLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5jbGFzc05hbWUgKz0gIiBtZW51LW1pZGRsZS1ob3Zlci1idXR0b24iOw0KDQogICAgICAgICAgICBzcmMuZmlyc3RDaGlsZC5maXJzdENoaWxkLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5jbGFzc05hbWUgKz0gIiBwb3J0bGV0LW1lbnUtaXRlbS1ob3ZlciI7ICAgICAgICAgICAgICAgICAgICANCg0KICAgICAgICB9DQoNCiAgICB9DQoNCn07DQoNCg0KZnVuY3Rpb24gbGVhdmVOZXdTdHlsZUJ1dHRvbigpDQoNCnsNCg0KICAgIC8vaGFuZGxlIG1lbnUgYmFyIGNvcHkgICAgICAgICAgDQoNCiAgICB2YXIgZXZlbnQgPSB0aGlzLmV2ZW50Ow0KDQogICAgaWYgKGV2ZW50KQ0KDQogICAgICAgIHZhciBzcmMgPSBldmVudC5zcmNFbGVtZW50Ow0KDQogICAgDQoNCiAgICBpZiAoc3JjICYmIHNyYy50YWdOYW1lICYmIHNyYy50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gImEiKQ0KDQogICAgew0KDQogICAgICAgIHZhciBzcmMgPSBldmVudC5zcmNFbGVtZW50Ow0KDQogICAgICAgIGlmIChzcmMuZmlyc3RDaGlsZC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gImlucHV0IikNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHNyYy5jaGlsZE5vZGVzWzFdLmNsYXNzTmFtZSA9ICJtZW51LWxlZnQtbm9ybWFsLWJ1dHRvbiI7DQoNCiAgICAgICAgICAgIHNyYy5jaGlsZE5vZGVzWzFdLmZpcnN0Q2hpbGQuY2xhc3NOYW1lID0gIm1lbnUtcmlnaHQtbm9ybWFsLWJ1dHRvbiI7DQoNCiAgICAgICAgICAgIHNyYy5jaGlsZE5vZGVzWzFdLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5jbGFzc05hbWUgPSAibWVudS1taWRkbGUtbm9ybWFsLWJ1dHRvbiI7DQoNCiAgICAgICAgICAgIHNyYy5jaGlsZE5vZGVzWzFdLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5maXJzdENoaWxkLmNsYXNzTmFtZSA9ICJwb3J0bGV0LW1lbnUtaXRlbSI7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGVsc2UNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHNyYy5maXJzdENoaWxkLmNsYXNzTmFtZSA9ICJtZW51LWxlZnQtbm9ybWFsLWJ1dHRvbiI7DQoNCiAgICAgICAgICAgIHNyYy5maXJzdENoaWxkLmZpcnN0Q2hpbGQuY2xhc3NOYW1lID0gIm1lbnUtcmlnaHQtbm9ybWFsLWJ1dHRvbiI7DQoNCiAgICAgICAgICAgIHNyYy5maXJzdENoaWxkLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5jbGFzc05hbWUgPSAibWVudS1taWRkbGUtbm9ybWFsLWJ1dHRvbiI7DQoNCiAgICAgICAgICAgIHNyYy5maXJzdENoaWxkLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5maXJzdENoaWxkLmNsYXNzTmFtZSA9ICJwb3J0bGV0LW1lbnUtaXRlbSI7DQoNCiAgICAgICAgfQ0KDQogICAgfQ0KDQp9DQoNCg0KLyoqDQoNCiAqIA0KDQogKiBWMzYwCSANCg0KICogRmlsZTogQ2hlY2tib3guanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiA8PEdlbmVyYWwgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzPj4NCg0KICogDQoNCiAqIE5vdGVzOg0KDQogKiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqIFJldmlzaW9uIEhpc3Rvcnk6DQoNCiAqIDw8RGF0ZT4+LCA8PFdobz4+LCA8PFdoYXQ+Pg0KDQogKiAyNS80LzIwMTIsIFJheSBaaGFuZywgSW5pdGlhbCB2ZXJzaW9uDQoNCiAqDQoNCiAqLw0KDQoNClVJLkNoZWNrYm94ID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClV0aWwuZXh0ZW5kKFVJLkNoZWNrYm94LCBVSS5CYXNlSW5wdXQsIHsNCg0KCQ0KDQoJaWRQcmV2aW91cyA6ICJjaGVja2JveC0iLA0KDQoJDQoNCglpbml0SW5wdXQgOiBmdW5jdGlvbihjb25maWcpew0KDQoJCXRoaXMudmFsdWUgPSBjb25maWcudmFsdWUgfHwgIiI7DQoNCgkJdGhpcy5jaGVja2VkID0gY29uZmlnLmNoZWNrZWQgfHwgZmFsc2U7DQoNCgl9LA0KDQoJDQoNCgljdXN0b21pemVJbnB1dCA6IGZ1bmN0aW9uKCl7DQoNCgkJaW5wdXQudHlwZSA9ICdjaGVja2JveCc7DQoNCgkJaWYodGhpcy52YWx1ZSl7DQoNCgkJCWlucHV0LnZhbHVlID0gdGhpcy52YWx1ZTsNCg0KCQl9DQoNCgkJaWYodGhpcy5jaGVja2VkKXsNCg0KCQkJaW5wdXQuY2hlY2tlZCA9IHRoaXMuY2hlY2tlZDsNCg0KCQl9DQoNCgkJcmV0dXJuIGlucHV0Ow0KDQoJfSwNCg0KCQ0KDQogICAgY3VzdG9taXplSFRNTCA6IGZ1bmN0aW9uKGRhdGEpIHsNCg0KICAgICAgICB2YXIgaW5pdERhdGEgPSBkYXRhIHx8IHt9Ow0KDQogICAgICAgIHZhciBjaGVja2VkID0gaW5pdERhdGEuY2hlY2tlZCB8fCBpbml0RGF0YS52YWx1ZSA9PSAnWScgfHwgdGhpcy5jaGVja2VkIHx8ICB0aGlzLnZhbHVlID09ICdZJyA7DQoNCiAgICAgICAgdmFyIHZhbHVlID0gaW5pdERhdGEudmFsdWUgfHwgdGhpcy52YWx1ZTsNCg0KICAgICAgICB2YXIgaWQgPSBpbml0RGF0YS5pZCB8fCB0aGlzLmlkOw0KDQogICAgICAgIHZhciBuYW1lID0gaW5pdERhdGEubmFtZSB8fCBpZDsNCg0KICAgICAgICB2YXIgY29udGVudCA9IG5ldyBBcnJheSgpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCgiIHR5cGU9J2NoZWNrYm94JyIpOw0KDQogICAgICAgIGlmIChjaGVja2VkKSB7DQoNCiAgICAgICAgICAgIGNvbnRlbnQucHVzaCgiIGNoZWNrZWQ9J2NoZWNrZWQnIik7DQoNCiAgICAgICAgICAgIGlmICghdmFsdWUpIHsNCg0KICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaCgiIHZhbHVlPSdZJyIpOw0KDQogICAgICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgICAgICAgICAgY29udGVudC5wdXNoKCIgdmFsdWU9JyIpOw0KDQogICAgICAgICAgICAgICAgY29udGVudC5wdXNoKHZhbHVlKTsNCg0KICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaCgiJyIpOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgaWYgKCF2YWx1ZSkgew0KDQogICAgICAgICAgICAgICAgY29udGVudC5wdXNoKCIgdmFsdWU9J04nIik7DQoNCiAgICAgICAgICAgIH0gZWxzZSB7DQoNCiAgICAgICAgICAgICAgICBjb250ZW50LnB1c2goIiB2YWx1ZT0nIik7DQoNCiAgICAgICAgICAgICAgICBjb250ZW50LnB1c2godmFsdWUpOw0KDQogICAgICAgICAgICAgICAgY29udGVudC5wdXNoKCInIik7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICB9DQoNCiAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGNvbnRlbnQuam9pbigiIik7DQoNCiAgICB9LA0KDQoJDQoNCglleHRyYUhUTUwgOiBmdW5jdGlvbihkYXRhKXsNCg0KCSAgICB2YXIgaW5pdERhdGEgPSBkYXRhIHx8IHt9Ow0KDQoJICAgIHZhciBpZCA9IGluaXREYXRhLmlkIHx8IHRoaXMuaWQ7DQoNCiAgICAgICAgdmFyIG5hbWUgPSBpbml0RGF0YS5uYW1lIHx8IGlkOw0KDQogICAgICAgIHZhciB2YWx1ZSA9IGluaXREYXRhLnZhbHVlIHx8IHRoaXMudmFsdWU7DQoNCiAgICAgICAgcmV0dXJuICc8aW5wdXQgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJyt2YWx1ZSsnIiAgbmFtZT0iJytuYW1lKydfaGlkZGVuQ2hlY2tib3giIGlkPSInK2lkKydfaGlkZGVuQ2hlY2tib3giIC8+JzsNCg0KCX0sDQoNCgkNCg0KCXBhcnNlU2libGluZ1ZhbHVlIDogZnVuY3Rpb24oc2libGluZyl7DQoNCgkJcmV0dXJuIHNpYmxpbmcudmFsdWU7DQoNCgl9LA0KDQoJDQoNCglhZGREZWZhdWx0RXZlbnQgOiBmdW5jdGlvbigpew0KDQoJCQ0KDQoJfQ0KDQoJDQoNCn0pOw0KDQoNCg0KVUkuQ2hlY2tib3gudXBkYXRlQ2hlY2tib3hIaWRkZW5WYWx1ZT0gZnVuY3Rpb24oKQ0KDQp7DQoNCiAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQ7IA0KDQogICAgQWMzNjAucXVlcnkodGFyZ2V0LmlkKydfaGlkZGVuQ2hlY2tib3gnKS52YWx1ZT10YXJnZXQuY2hlY2tlZD8nWSc6J04nOw0KDQp9Ow0KDQoNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgiY2hlY2tib3giLFVJLkNoZWNrYm94KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgibXVsdGlwbGVfc2VsZWN0IixVSS5DaGVja2JveCk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MCBGaWxlOiBMYWJlbC5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246IDw8R2VuZXJhbCBkZXNjcmlwdGlvbiBvZiB0aGUgY2xhc3M+Pg0KDQogKiANCg0KICogTm90ZXM6IDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICogDQoNCiAqLw0KDQoNClVJLkxhYmVsID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClVJLkxhYmVsLmV4dGVuZCggew0KDQoNCglpZFByZXZpb3VzIDogImxhYmVsLSIsDQoNCg0KCWluaXQgOiBmdW5jdGlvbihjb25maWcpIHsNCg0KCQl0aGlzLmlkID0gY29uZmlnLmlkIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLm5hbWUgPSBjb25maWcubmFtZSB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy50ZXh0ID0gY29uZmlnLnRleHQgfHwgIiI7DQoNCgkJdGhpcy5hY2Nlc3NLZXkgPSBjb25maWcuYWNjZXNzS2V5IHx8ICIiOw0KDQoJCXRoaXMuY2xhc3NOYW1lID0gY29uZmlnLmNsYXNzTmFtZSB8fCAiIjsNCg0KCQl0aGlzLmh0bWxGb3IgPSBjb25maWcuaHRtbEZvciB8fCAiIjsNCg0KCQl0aGlzLnN0eWxlID0gY29uZmlnLnN0eWxlIHx8ICIiOw0KDQoJCXRoaXMudGFiSW5kZXggPSBjb25maWcudGFiSW5kZXggfHwgIiI7DQoNCgkJdGhpcy50aXRsZSA9IGNvbmZpZy50aXRsZSB8fCAiIjsNCg0KCQl0aGlzLmNvbnRhaW5JZCA9IGNvbmZpZy5jb250YWluSWQ7DQoNCgl9LA0KDQoNCglyZW5kZXIgOiBmdW5jdGlvbigpIHsNCg0KCQl2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOw0KDQoJCWxhYmVsLm5hbWUgPSB0aGlzLm5hbWU7DQoNCgkJbGFiZWwuaWQgPSB0aGlzLmlkOw0KDQoJCWlmICh0aGlzLmh0bWxGb3IpIHsNCg0KCQkJbGFiZWwuaHRtbEZvciA9IHRoaXMuaHRtbEZvcjsNCg0KCQl9DQoNCgkJaWYgKHRoaXMuc3R5bGUpIHsNCg0KCQkJbGFiZWwuc3R5bGUgPSB0aGlzLnN0eWxlOw0KDQoJCX0NCg0KCQlpZiAodGhpcy50YWJJbmRleCkgew0KDQoJCQlsYWJlbC50YWJJbmRleCA9IHRoaXMudGFiSW5kZXg7DQoNCgkJfQ0KDQoJCWlmICh0aGlzLnRpdGxlKSB7DQoNCgkJCWxhYmVsLnRpdGxlID0gdGhpcy50aXRsZTsNCg0KCQl9DQoNCgkJaWYgKHRoaXMuY2xhc3NOYW1lKSB7DQoNCgkJCWxhYmVsLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lOw0KDQoJCX0NCg0KCQlpZiAodGhpcy5hY2Nlc3NLZXkpIHsNCg0KCQkJbGFiZWwuYWNjZXNzS2V5ID0gdGhpcy5hY2Nlc3NLZXk7DQoNCgkJfQ0KDQoJCWlmICh0aGlzLnRleHQpIHsNCg0KCQkJbGFiZWwuaW5uZXJIVE1MID0gdGhpcy50ZXh0Ow0KDQoJCX0NCg0KCQl2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5jb250YWluSWQpOw0KDQoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChsYWJlbCk7DQoNCgl9LA0KDQoNCglnZXRPdXRlckhUTUwgOiBmdW5jdGlvbihkYXRhKSB7DQoNCgkJdmFyIGluaXREYXRhID0gZGF0YSB8fCB7fTsNCg0KCQl2YXIgdGV4dCA9IGluaXREYXRhLnRleHQgfHwgIiI7DQoNCgkJdmFyIGlkID0gaW5pdERhdGEuaWQgfHwgdGhpcy5pZDsNCg0KCQl2YXIgbmFtZSA9IGluaXREYXRhLm5hbWUgfHwgaWQ7DQoNCgkJdmFyIGh0bWxGb3IgPSBpbml0RGF0YS5odG1sRm9yIHx8IHRoaXMuaHRtbEZvcjsNCg0KCQl2YXIgYWNjZXNzS2V5ID0gaW5pdERhdGEuYWNjZXNzS2V5IHx8IHRoaXMuYWNjZXNzS2V5Ow0KDQoJCXZhciB0aXRsZSA9IGluaXREYXRhLnRpdGxlIHx8IHRoaXMudGl0bGU7DQoNCgkJdmFyIHRhYkluZGV4ID0gaW5pdERhdGEudGFiSW5kZXggfHwgdGhpcy50YWJJbmRleDsNCg0KCQl2YXIgY2xhc3NOYW1lID0gaW5pdERhdGEuY2xhc3NOYW1lIHx8IHRoaXMuY2xhc3NOYW1lOw0KDQoJCXZhciBzdHlsZSA9IGluaXREYXRhLnN0eWxlIHx8IHRoaXMuc3R5bGU7DQoNCgkJdmFyIGNvbnRlbnQgPSBuZXcgQXJyYXkoKTsNCg0KCQljb250ZW50LnB1c2goIjxsYWJlbCBpZD0nIik7DQoNCgkJY29udGVudC5wdXNoKGlkKTsNCg0KCQljb250ZW50LnB1c2goIicgbmFtZT0nIik7DQoNCgkJY29udGVudC5wdXNoKG5hbWUpOw0KDQoJCWlmIChodG1sRm9yKSB7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyBmb3I9JyIpOw0KDQoJCQljb250ZW50LnB1c2goaHRtbEZvcik7DQoNCgkJfQ0KDQoJCWlmIChhY2Nlc3NLZXkpIHsNCg0KCQkJY29udGVudC5wdXNoKCInIGFjY2Vzc0tleT0nIik7DQoNCgkJCWNvbnRlbnQucHVzaChhY2Nlc3NLZXkpOw0KDQoJCX0NCg0KCQlpZiAodGl0bGUpIHsNCg0KCQkJY29udGVudC5wdXNoKCInIHRpdGxlPSciKTsNCg0KCQkJY29udGVudC5wdXNoKHRpdGxlKTsNCg0KCQl9DQoNCgkJaWYgKHRhYkluZGV4KSB7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyB0YWJJbmRleD0nIik7DQoNCgkJCWNvbnRlbnQucHVzaCh0YWJJbmRleCk7DQoNCgkJfQ0KDQoJCWlmIChjbGFzc05hbWUpIHsNCg0KCQkJY29udGVudC5wdXNoKCInIGNsYXNzPSciKTsNCg0KCQkJY29udGVudC5wdXNoKGNsYXNzTmFtZSk7DQoNCgkJfQ0KDQoJCWlmIChzdHlsZSkgew0KDQoJCQljb250ZW50LnB1c2goIicgc3R5bGU9JyIpOw0KDQoJCQljb250ZW50LnB1c2goc3R5bGUpOw0KDQoJCX0NCg0KCQljb250ZW50LnB1c2goIic+Iik7DQoNCgkJY29udGVudC5wdXNoKHRleHQpOw0KDQoJCWNvbnRlbnQucHVzaCgiPC9sYWJlbD4iKTsNCg0KCQlyZXR1cm4gY29udGVudC5qb2luKCIiKTsNCg0KCX0sDQoNCg0KCXBhcnNlU2libGluZ1ZhbHVlIDogZnVuY3Rpb24oc2libGluZykgew0KDQoJCXJldHVybiBzaWJsaW5nLmlubmVySFRNTDsNCg0KCX0sDQoNCg0KCWFkZERlZmF1bHRFdmVudCA6IGZ1bmN0aW9uKCkgew0KDQoNCgl9DQoNCg0KfSk7DQoNCldpZGdldE1hbmFnZXIucmVnaXN0ZXJXaWRnZXQoImxhYmVsIixVSS5MYWJlbCk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IFRhYmxlLmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjoNCg0KICogPDxDb21tb24gdGFibGUgZm9yIEFjMzYwPj4NCg0KICogDQoNCiAqIE5vdGVzOg0KDQogKiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqDQoNCiAqLw0KDQoNClVJLlRhYmxlID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQpVSS5UYWJsZS5leHRlbmQoVUkuRWxlbWVudFN1cHBvcnQucHJvdG90eXBlKTsNCg0KVUkuVGFibGUuZXh0ZW5kKHsNCg0KCQ0KDQoNCglpZFByZXZpb3VzIDogInRhYmxlLSIsDQoNCgkNCg0KCWluaXQgOiBmdW5jdGlvbihjb25maWcpew0KDQoJCS8qDQoNCgkJICogVGhlIGZvbGxvd2luZyBhcmUgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzIGZvciB0YWJsZS4NCg0KCQkgKi8NCg0KDQoJCXRoaXMuaWQgPSBjb25maWcuaWQgfHwgdGhpcy5nZXRJZCgpOw0KDQoJCXRoaXMubmFtZSA9IGNvbmZpZy5uYW1lIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLmNsYXNzTmFtZSA9IGNvbmZpZy5jbGFzc05hbWUgfHwgIkFjY2VsYU1haW5UYWJsZSI7DQoNCgkJdGhpcy5oZWFkZXJEYXRhID0gY29uZmlnLnRhYmxlSGVhZCB8fCB7fTsvL0NvbHVtbiBkZWZpbml0aW9uIGRhdGEuDQoNCgkJdGhpcy5ib2R5RGF0YSA9IGNvbmZpZy50YWJsZUJvZHkgfHwge307Ly9DZWxsIGRhdGEuIA0KDQoJCXRoaXMuZW52aXJvbm1lbnQud2ViUGF0aCA9ICIvIitjb25maWcud2ViUGF0aCB8fCAiIjsNCg0KCQl0aGlzLnBhZ2VJbmZvID0gY29uZmlnLnBhZ2U7Ly9QYWdpbmcgaW5mb3JtYXRpb24gZm9yIHRhYmxlLg0KDQoJCXRoaXMucmVhZE9ubHkgPSB0eXBlb2YgY29uZmlnLnJlYWRPbmx5PT0idW5kZWZpbmVkIj90cnVlOmNvbmZpZy5yZWFkT25seTsvL1RhYmxlIGNhbiBiZSBlZGl0IG9yIG5vdC4NCg0KCQl0aGlzLm1lc3NhZ2VzID0gY29uZmlnLm1lc3NhZ2VzIHx8IHt9Ow0KDQoJCXRoaXMub25TZWxlY3QgPSBjb25maWcub25TZWxlY3QgfHwgIiI7DQoNCgkJLyoNCg0KCQkgKiBUaGUgZm9sbG93aW5nIGFyZSBpbnN0YW5jZSBwYXJhbWV0ZXJzLg0KDQoJCSAqLw0KDQoJCXRoaXMuc2VsZWN0ZWRSb3dzID0gbmV3IEFycmF5KCk7Ly9Db2xsZWN0aW9uIG9mIElEcyBmb3IgdGhvc2Ugcm93cyB3aGljaCBhcmUgc2VsZWN0ZWQuDQoNCgkJdGhpcy5oaWdoTGlnaHRlZFJvdyA9IG51bGw7DQoNCgkJdGhpcy5kZWxldGVkUm93RGF0YSA9IG5ldyBBcnJheSgpOy8vQ29sbGVjdGlvbiB0byBzdG9yZSB0aGUgZGVsZXRlZCBkYXRhIHdoaWNoIHNob3VsZCBiZSBjb21taXR0ZWQgbGF0ZXIuDQoNCgkJdGhpcy53aWR0aD0wOyAvL1RhYmxlIHdpZHRoLg0KDQoJCXRoaXMuc2VsZWN0Q29sV2lkdGggPSAyMjsvL1dpZHRoIGZvciBzZWxlY3QgY29sdW1uLg0KDQoJCXRoaXMudG9vbEJhcklkID0gdGhpcy5pZFByZXZpb3VzICsidG9vbEJhci0iK0FjMzYwLmluY3JlYXNlKCk7DQoNCgkJdGhpcy5oYXNTZWxlY3RDb2wgPSB0aGlzLmV4aXN0U2VsZWN0Q29sKCk7DQoNCgkJdGhpcy5zZWxlY3RBbGxGdW5jID0gbnVsbDsvL0Z1bmN0aW9uIHRvIGJlIGludm9rZWQgd2hpbGUgY2xpY2sgb24gdGFibGUgaGVhZGVyJ3MgY2hlY2sgYm94Lg0KDQoJCS8qDQoNCgkJICogSW5pdGlhbGl6aW5nIG1ldGhvZC4gDQoNCgkJICovDQoNCgkJdGhpcy5hZGp1c3RDb2xXaWR0aCgpOw0KDQoJfSwNCg0KCQ0KDQoJZXhpc3RTZWxlY3RDb2wgOiBmdW5jdGlvbigpew0KDQoJCWlmKHRoaXMuaGVhZGVyRGF0YSAmJiB0aGlzLmhlYWRlckRhdGEubGVuZ3RoDQoNCgkJCQkmJiB0aGlzLmhlYWRlckRhdGFbMF0uaHRtbEVsZW1lbnRIZWFkcy5sZW5ndGgNCg0KCQkJCSYmICh0aGlzLmhlYWRlckRhdGFbMF0uaHRtbEVsZW1lbnRIZWFkc1swXS5lbGVtZW50VHlwZSA9PSAibXVsdGlwbGVfc2VsZWN0IiANCg0KCQkJCQl8fCB0aGlzLmhlYWRlckRhdGFbMF0uaHRtbEVsZW1lbnRIZWFkc1swXS5lbGVtZW50VHlwZSA9PSAic2luZ2xlX3NlbGVjdCIpKQ0KDQoJCQlyZXR1cm4gdHJ1ZTsNCg0KCQlyZXR1cm4gZmFsc2U7DQoNCgl9LA0KDQoJDQoNCglzZWxlY3RBbGxIYW5kbGUgOiBmdW5jdGlvbihzcmNPYmopew0KDQoJCXRyeXsNCg0KCQkJaWYoIXRoaXMuc2VsZWN0QWxsRnVuYyl7DQoNCgkJCQl0aGlzLnNlbGVjdEFsbEZ1bmMgPSBuZXcgRnVuY3Rpb24odGhpcy5vblNlbGVjdCkuYmluZChzcmNPYmopOw0KDQoJCQl9DQoNCgkJCXRoaXMuc2VsZWN0QWxsRnVuYygpOw0KDQoJCX1jYXRjaChlKXsNCg0KCQkJDQoNCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJZ2V0VG9vbEJhciA6IGZ1bmN0aW9uKCl7DQoNCgkJdmFyIG5ld0J0bklkID0gdGhpcy5pZFByZXZpb3VzKyJuZXctIitBYzM2MC5pbmNyZWFzZSgpOw0KDQoJCXZhciBkZWxCdG5JZCA9IHRoaXMuaWRQcmV2aW91cysiZGVsLSIrQWMzNjAuaW5jcmVhc2UoKTsNCg0KCQl2YXIgdG9vbEJhckJ1aWxkZXIgPSBuZXcgQXJyYXkoKTsNCg0KCQl0b29sQmFyQnVpbGRlci5wdXNoKCI8ZGl2IGNsYXNzPVwidWktdGFibGUtdG9vbGJhclwiIHZBbGlnbj1jZW50ZXIgaWQ9XCIiKTsNCg0KCQl0b29sQmFyQnVpbGRlci5wdXNoKHRoaXMudG9vbEJhcklkKTsNCg0KCQl0b29sQmFyQnVpbGRlci5wdXNoKCJcIj48aW1nIG9uY2xpY2s9XCJVSS5UYWJsZS5pbnNlcnQoKVwiIGFsdD1BZGQgc3JjPVwiL3BvcnRsZXRzL2ltYWdlcy9za3lfYmx1ZS9tZW51L2VkaXRfYnV0dG9uLmdpZlwiIGlkPVwiIik7DQoNCgkJdG9vbEJhckJ1aWxkZXIucHVzaChuZXdCdG5JZCk7DQoNCgkJdG9vbEJhckJ1aWxkZXIucHVzaCgiXCI+PEZPTlQgY2xhc3M9XCJwb3J0bGV0LW1lbnUtaXRlbVwiPiZuYnNwO0FkZCZuYnNwOyZuYnNwOzwvRk9OVD4iKTsNCg0KCQl0b29sQmFyQnVpbGRlci5wdXNoKCI8aW1nIG9uY2xpY2s9XCJVSS5UYWJsZS5yZW1vdmUoKVwiIGFsdD1EZWxldGUgc3JjPVwiL3BvcnRsZXRzL2ltYWdlcy9za3lfYmx1ZS9tZW51L2RlbGV0ZV9idXR0b24uZ2lmXCIgaWQ9XCIiKTsNCg0KCQl0b29sQmFyQnVpbGRlci5wdXNoKGRlbEJ0bklkKTsNCg0KCQl0b29sQmFyQnVpbGRlci5wdXNoKCJcIj48Rk9OVCBjbGFzcz1cInBvcnRsZXQtbWVudS1pdGVtXCI+Jm5ic3A7RGVsZXRlJm5ic3A7Jm5ic3A7PC9GT05UPjwvZGl2PiIpOw0KDQoJCXJldHVybiB0b29sQmFyQnVpbGRlci5qb2luKCIiKTsNCg0KCX0sDQoNCgkNCg0KCWFkanVzdENvbFdpZHRoIDogZnVuY3Rpb24oKXsNCg0KCQlpZih0aGlzLmhhc1NlbGVjdENvbCl7DQoNCgkJCXRoaXMuaGVhZGVyRGF0YVswXS53aWR0aCA9IHRoaXMuc2VsZWN0Q29sV2lkdGg7DQoNCgkJfQ0KDQoJCWZvcih2YXIgaT10aGlzLmhhc1NlbGVjdENvbD8xOjA7aTx0aGlzLmhlYWRlckRhdGEubGVuZ3RoO2krKyl7DQoNCgkJCXZhciBjb2xXaWR0aCA9IHRoaXMuaGVhZGVyRGF0YVtpXS53aWR0aCB8fCAxMDA7DQoNCgkJCXRoaXMuaGVhZGVyRGF0YVtpXS53aWR0aCA9IGNvbFdpZHRoOw0KDQoJCQl0aGlzLndpZHRoKz1jb2xXaWR0aDsNCg0KCQl9DQoNCgkJaWYodGhpcy53aWR0aDw2MDAgJiYgdGhpcy5oZWFkZXJEYXRhLmxlbmd0aD4wKXsNCg0KCQkJdmFyIHRvQWRqdXN0SGVhZGVyID0gdGhpcy5oZWFkZXJEYXRhW3RoaXMuaGVhZGVyRGF0YS5sZW5ndGgtMV07DQoNCgkJCXRvQWRqdXN0SGVhZGVyLndpZHRoID0gNjAwLXRoaXMud2lkdGgrdG9BZGp1c3RIZWFkZXIud2lkdGg7DQoNCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJZ2V0Um93SWQgOiBmdW5jdGlvbigpew0KDQogICAgICAgcmV0dXJuIHRoaXMuaWRQcmV2aW91cysicm93LSIrdGhpcy5pbmNyZWFzZSgpOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgaW5jcmVhc2UgOiAoZnVuY3Rpb24oKXsNCg0KICAgICAgIHZhciBpZCA9IDE7DQoNCiAgICAgICByZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gaWQrKzt9Ow0KDQogICAgfSkoKSwNCg0KDQoJDQoNCgkvKg0KDQoJICogQnVpbGQgdGhlIHRhYmxlIGhlYWRlciBmb3Igc2VsZWN0IGNvbHVtbiBpZiBpdCBleGlzdHMuDQoNCgkgKi8NCg0KCWdldFNlbGVjdENvbEhlYWRlciA6IGZ1bmN0aW9uKCl7DQoNCgkJdmFyIGNvbEhlYWRlckJ1aWxkZXIgPSBuZXcgQXJyYXkoKTsNCg0KCQlpZih0aGlzLmhhc1NlbGVjdENvbCl7DQoNCgkJCWNvbEhlYWRlckJ1aWxkZXIucHVzaCgiPHRoIHdpZHRoPVwiIik7DQoNCgkJCWNvbEhlYWRlckJ1aWxkZXIucHVzaCh0aGlzLmhlYWRlckRhdGFbMF0ud2lkdGgpOw0KDQoJCQljb2xIZWFkZXJCdWlsZGVyLnB1c2goIlwiIGNsYXNzPVwicG9ydGxldC1zZWN0aW9uLXN1YmhlYWRlci1jaGVja2JveCBBbGlnbkxcIiB0aXRsZT1cIiIpOw0KDQoJCQljb2xIZWFkZXJCdWlsZGVyLnB1c2godGhpcy5oZWFkZXJEYXRhWzBdLnRpcCk7DQoNCgkJCWNvbEhlYWRlckJ1aWxkZXIucHVzaCgiXCIgbm93cmFwIHZBbGlnbj1cInRvcFwiPiIpOw0KDQoJCQlpZih0aGlzLmhlYWRlckRhdGFbMF0uaHRtbEVsZW1lbnRIZWFkc1swXS5lbGVtZW50VHlwZSA9PSAibXVsdGlwbGVfc2VsZWN0Iil7DQoNCgkJCQl2YXIgZXZlbnRNYXAgPSBuZXcgT2JqZWN0KCk7DQoNCgkJCQlldmVudE1hcC5jbGljayA9ICJVSS5UYWJsZS5zZWxlY3RBbGwoKTsiOyANCg0KCQkJCXZhciBzZWxlY3RDb25maWcgPSB7aWQ6ImFjMzYwX2xpc3RfaWQiLA0KDQoJCQkJCQlldmVudE1hcDogZXZlbnRNYXAsDQoNCgkJCQkJCXRpdGxlOnRoaXMubWVzc2FnZXNbJ2RvY3VtZW50LnJvbGUubGlzdC5hbGwnXX07DQoNCgkJCQljb2xIZWFkZXJCdWlsZGVyLnB1c2godGhpcy5nZXRXaWRnZXQodGhpcy5oZWFkZXJEYXRhWzBdLmh0bWxFbGVtZW50SGVhZHNbMF0uZWxlbWVudFR5cGUpLmdldE91dGVySFRNTFdyYXBwZXIoc2VsZWN0Q29uZmlnKSk7DQoNCgkJCX0NCg0KCQkJY29sSGVhZGVyQnVpbGRlci5wdXNoKCI8L3RoPiIpOw0KDQoJCX1lbHNlIGlmKHRoaXMuaGFzU2VsZWN0Q29sKXsNCg0KCQkJY29sSGVhZGVyQnVpbGRlci5wdXNoKCI8dGggd2lkdGg9XCIyMlwiIGNsYXNzPVwicG9ydGxldC1zZWN0aW9uLXN1YmhlYWRlci1jaGVja2JveFwiPjwvdGg+Iik7DQoNCgkJfQ0KDQoJCXJldHVybiBjb2xIZWFkZXJCdWlsZGVyLmpvaW4oIiIpOw0KDQoJfSwNCg0KCQ0KDQoJLyoNCg0KCSAqIEJ1aWxkIHRoZSBjZWxscyBjb250YWluZWQgaW4gc2VsZWN0IGNvbHVtbi4NCg0KCSAqLw0KDQoJZ2V0U2VsZWN0Q29sQ2VsbCA6IGZ1bmN0aW9uKGNlbGxzKXsNCg0KCQl2YXIgY2VsbEJ1aWxkZXIgPSBuZXcgQXJyYXkoKTsNCg0KCQlpZih0aGlzLmhhc1NlbGVjdENvbCl7DQoNCgkJCWNlbGxCdWlsZGVyLnB1c2goIjx0ZCBjbGFzcz0nQWxpZ25MLXRkLWJvcmRlcic+Iik7DQoNCgkJCXZhciBodG1sRWxlbWVudEhlYWRzID0gdGhpcy5oZWFkZXJEYXRhWzBdLmh0bWxFbGVtZW50SGVhZHM7DQoNCgkJCWZvcih2YXIgaT0wOyBpPCBodG1sRWxlbWVudEhlYWRzLmxlbmd0aDsgaSsrKXsNCg0KCQkJCWlmKGh0bWxFbGVtZW50SGVhZHNbaV0uZWxlbWVudFR5cGU9PSJtdWx0aXBsZV9zZWxlY3QiIHx8IGh0bWxFbGVtZW50SGVhZHNbaV0uZWxlbWVudFR5cGUgPT0ic2luZ2xlX3NlbGVjdCIpew0KDQoJCQkJCXZhciBldmVudE1hcCA9IGNlbGxzWzBdLmh0bWxFbGVtZW50c1tpXS5ldmVudERlZmluZSB8fCB7fTsNCg0KCQkJCQl2YXIgZGlzYWJsZWQgPSBjZWxsc1swXS5odG1sRWxlbWVudHNbaV0uZGlzYWJsZWQ7DQoNCgkJCQkJdmFyIGNsaWNrRnVuU3RyID0gZXZlbnRNYXAuY2xpY2t8fCIiOw0KDQoJCQkJCWV2ZW50TWFwLmNsaWNrID0gIlVJLlRhYmxlLnNlbGVjdCgpOyIrY2xpY2tGdW5TdHI7DQoNCgkJCQkJdmFyIGNvbmZpZyA9IGNlbGxzWzBdLmh0bWxFbGVtZW50c1swXTsNCg0KCQkJCQl2YXIgc2VsZWN0Q29uZmlnID0ge2lkIDogImFjMzYwX2xpc3RfaWQiLA0KDQoJCQkJCQkJdGl0bGUgOiB0aGlzLm1lc3NhZ2VzWydtZW51YmFyLmNvbW1vbi5zZWxlY3QubGFiZWwnXSwNCg0KCQkJCQkJCWRpc2FibGVkIDogZGlzYWJsZWQsDQoNCgkJCQkJCQlldmVudE1hcCA6IGV2ZW50TWFwLA0KDQoJCQkJCQkJbmFtZSA6IGNlbGxzWzBdLmh0bWxFbGVtZW50c1swXS5uYW1lLA0KDQoJCQkJCQkJdmFsdWUgOiBCYXNlSlMuaHRtbEVuY29kZShjZWxsc1swXS5odG1sRWxlbWVudHNbMF0udmFsdWUpfHwiIn07DQoNCgkJCQkJCQkNCg0KCQkJCQlzZWxlY3RDb25maWcgPSBVdGlsLmFwcGx5SWYoc2VsZWN0Q29uZmlnLCBjb25maWcpOw0KDQoJCQkJCQkNCg0KCQkJCQljZWxsQnVpbGRlci5wdXNoKHRoaXMuZ2V0V2lkZ2V0KGh0bWxFbGVtZW50SGVhZHNbaV0uZWxlbWVudFR5cGUpLmdldE91dGVySFRNTFdyYXBwZXIoc2VsZWN0Q29uZmlnKSk7DQoNCgkJCQl9DQoNCgkJCX0NCg0KCQkJY2VsbEJ1aWxkZXIucHVzaCgiPC90ZD4iKTsNCg0KCQl9DQoNCgkJcmV0dXJuIGNlbGxCdWlsZGVyLmpvaW4oIiIpOw0KDQoJfSwNCg0KCQ0KDQoJZ2VuZXJhdGVIZWFkTGluayA6IGZ1bmN0aW9uKHNvcnRMaW5rKQ0KDQoJew0KDQoJICAgIHJldHVybiBzb3J0TGluazsNCg0KCX0sDQoNCg0KICAgIGdldE9yZGVyTWVzc2FnZSA6IGZ1bmN0aW9uKG1lc3NhZ2VzKQ0KDQogICAgew0KDQogICAgICAgIHJldHVybiBtZXNzYWdlc1snZXJyb3IuanMucGFnZUhlYWRlci5zb3J0J107DQoNCiAgICB9LA0KDQoJDQoNCglnZXREZXNjT3JkZXJNZXNzYWdlIDogZnVuY3Rpb24obWVzc2FnZXMpDQoNCiAgICB7DQoNCiAgICAgICAgcmV0dXJuIG1lc3NhZ2VzWydlcnJvci5qcy5wYWdlSGVhZGVyLnNvcnRBc2NlbmRpbmcnXTsNCg0KICAgIH0sDQoNCiAgICANCg0KCQ0KDQoJZ2V0T3JkZXJTdHlsZSA6IGZ1bmN0aW9uKHNvcnRMaW5rKQ0KDQoJew0KDQoJICAgIGlmIChzb3J0TGluay5pbmRleE9mKCJvcmRlcj10cnVlIik+MCkNCg0KCSAgICB7DQoNCgkgICAgICAgIHJldHVybiAib3JkZXJfZG93biI7DQoNCgkgICAgfQ0KDQoJICAgIGVsc2UNCg0KCSAgICB7DQoNCgkgICAgICAgIHJldHVybiAib3JkZXJfdXAiOw0KDQoJICAgIH0NCg0KCX0sDQoNCgkNCg0KCWdldFRhYmxlSGVhZGVyIDogZnVuY3Rpb24oKXsNCg0KCQl2YXIgaGVhZGVyQnVpbGRlciA9IG5ldyBBcnJheSgpOw0KDQoJCWhlYWRlckJ1aWxkZXIucHVzaCgiPHRhYmxlIGNsYXNzPVwiIik7DQoNCgkJaGVhZGVyQnVpbGRlci5wdXNoKHRoaXMuY2xhc3NOYW1lKTsNCg0KCQloZWFkZXJCdWlsZGVyLnB1c2goIlwiIGlkPVwiIik7DQoNCgkJaGVhZGVyQnVpbGRlci5wdXNoKHRoaXMuaWQpOw0KDQoJCWhlYWRlckJ1aWxkZXIucHVzaCgiXCIgbmFtZT1cIiIpOw0KDQoJCWhlYWRlckJ1aWxkZXIucHVzaCh0aGlzLm5hbWUpOw0KDQoJCWhlYWRlckJ1aWxkZXIucHVzaCgiXCI+PHRoZWFkPjx0ciB3aWR0aD1cIjYwMFwiPiIpOw0KDQoJCWhlYWRlckJ1aWxkZXIucHVzaCh0aGlzLmdldFNlbGVjdENvbEhlYWRlcigpKTsNCg0KCQlmb3IodmFyIGk9dGhpcy5oYXNTZWxlY3RDb2w/MTowO2k8dGhpcy5oZWFkZXJEYXRhLmxlbmd0aDtpKyspew0KDQoJCQl2YXIgc29ydExpbmsgPSB0aGlzLmhlYWRlckRhdGFbaV0uc29ydExpbms7DQoNCgkJCWhlYWRlckJ1aWxkZXIucHVzaCgiPHRoIHdpZHRoPVwiIik7DQoNCgkJCWhlYWRlckJ1aWxkZXIucHVzaCh0aGlzLmhlYWRlckRhdGFbaV0ud2lkdGgpOw0KDQoJCQlpZiAodGhpcy5oZWFkZXJEYXRhW2ldLmlkKQ0KDQoJCQl7DQoNCgkJCQloZWFkZXJCdWlsZGVyLnB1c2goIlwiIGlkPVwiIik7DQoNCgkJCQloZWFkZXJCdWlsZGVyLnB1c2godGhpcy5oZWFkZXJEYXRhW2ldLmlkKTsNCg0KCQkJfQ0KDQoJCQloZWFkZXJCdWlsZGVyLnB1c2goIlwiIGNsYXNzPVwiIik7DQoNCgkJCWhlYWRlckJ1aWxkZXIucHVzaCh0aGlzLmdldFRhYmxlSGVhZGVyQ3NzKCkpOw0KDQoJCQloZWFkZXJCdWlsZGVyLnB1c2goIlwiIHRpdGxlPVwiIik7DQoNCgkJCWhlYWRlckJ1aWxkZXIucHVzaCh0aGlzLmhlYWRlckRhdGFbaV0udGlwKTsNCg0KCQkJaGVhZGVyQnVpbGRlci5wdXNoKCJcIiBub3dyYXAgdkFsaWduPVwidG9wXCI+Iik7DQoNCgkJCWlmKHNvcnRMaW5rKXsNCg0KCQkJCWhlYWRlckJ1aWxkZXIucHVzaCgiPGEgaHJlZj1cIiIpOw0KDQoJCQkJaGVhZGVyQnVpbGRlci5wdXNoKHRoaXMuZ2VuZXJhdGVIZWFkTGluayhzb3J0TGluaykpOw0KDQoJCQkJaWYoc29ydExpbmsuaW5kZXhPZigib3JkZXI9dHJ1ZSIpPjApew0KDQoJCQkJCWhlYWRlckJ1aWxkZXIucHVzaCgiXCIgY2xhc3M9XCIiKTsNCg0KCQkJCSAgICBoZWFkZXJCdWlsZGVyLnB1c2godGhpcy5nZXRPcmRlclN0eWxlKHRoaXMuZ2VuZXJhdGVIZWFkTGluayhzb3J0TGluaykpKTsNCg0KCQkJCSAgICBoZWFkZXJCdWlsZGVyLnB1c2goIlwiIHRpdGxlPVwiIik7DQoNCgkJCQkJaGVhZGVyQnVpbGRlci5wdXNoKHRoaXMuZ2V0T3JkZXJNZXNzYWdlKHRoaXMubWVzc2FnZXMpKTsNCg0KCQkJCX0NCg0KCQkJCWVsc2UgaWYoc29ydExpbmsuaW5kZXhPZigib3JkZXI9ZmFsc2UiKT4wKXsNCg0KICAgICAgICAgICAgICAgICAgICBoZWFkZXJCdWlsZGVyLnB1c2goIlwiIGNsYXNzPVwiIik7DQoNCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyQnVpbGRlci5wdXNoKHRoaXMuZ2V0T3JkZXJTdHlsZSh0aGlzLmdlbmVyYXRlSGVhZExpbmsoc29ydExpbmspKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyQnVpbGRlci5wdXNoKCJcIiB0aXRsZT1cIiIpOw0KDQoJCQkJCWhlYWRlckJ1aWxkZXIucHVzaCh0aGlzLmdldERlc2NPcmRlck1lc3NhZ2UodGhpcy5tZXNzYWdlcykpOw0KDQoJCQkJfQ0KDQoJCQkJaGVhZGVyQnVpbGRlci5wdXNoKCJcIiB0YXJnZXQ9XCJfc2VsZlwiPiIpOw0KDQoJCQkJaGVhZGVyQnVpbGRlci5wdXNoKHRoaXMuaGVhZGVyRGF0YVtpXS5sYWJlbCk7DQoNCgkJCQloZWFkZXJCdWlsZGVyLnB1c2goIjwvYT4iKTsNCg0KCQkJfWVsc2V7DQoNCgkJCQloZWFkZXJCdWlsZGVyLnB1c2godGhpcy5nZXRUYWJsZUhlYWRlckxhYmVsKHRoaXMuaGVhZGVyRGF0YVtpXS5sYWJlbCkpOw0KDQoJCQl9DQoNCgkJCWhlYWRlckJ1aWxkZXIucHVzaCgiPC90aD4iKTsNCg0KCQl9DQoNCgkJaGVhZGVyQnVpbGRlci5wdXNoKCI8dGggY2xhc3M9XCIiICsgdGhpcy5nZXRUYWJsZUhlYWRlckNzcygpICsgIlwiIHdpZHRoPVwiMTAwJVwiPjwvdGg+PC90cj48L3RoZWFkPiIpOy8vQWRkIGEgYmxhbmsgY2VsbCB0byBleHBhbmQgdGFibGUgc2l6ZS4NCg0KCQlyZXR1cm4gaGVhZGVyQnVpbGRlci5qb2luKCIiKTsNCg0KCX0sDQoNCgkNCg0KCWdldFRhYmxlQm9keSA6IGZ1bmN0aW9uKCl7DQoNCgkJdmFyIGJvZHlCdWlsZGVyID0gbmV3IEFycmF5KCk7DQoNCgkJYm9keUJ1aWxkZXIucHVzaCgiPHRib2R5PiIpOw0KDQoJCWZvcih2YXIgaT0wO2k8dGhpcy5ib2R5RGF0YS5sZW5ndGg7aSsrKXsNCg0KCQkJdmFyIHJvd0J1aWxkZXIgPSBuZXcgQXJyYXkoKTsNCg0KCQkJcm93QnVpbGRlci5wdXNoKHRoaXMuZ2V0Um93SGVhZChpLHRoaXMuYm9keURhdGFbaV0pKTsNCg0KCQkJcm93QnVpbGRlci5wdXNoKHRoaXMuZ2V0U2VsZWN0Q29sQ2VsbCh0aGlzLmJvZHlEYXRhW2ldLmNlbGxzKSk7DQoNCgkJCXZhciByb3dEYXRhID0gdGhpcy5ib2R5RGF0YVtpXS5jZWxscyB8fCBbXTsNCg0KDQogICAgICAgICAgICBmb3IodmFyIGo9dGhpcy5oYXNTZWxlY3RDb2w/MTowO2o8cm93RGF0YS5sZW5ndGg7aisrKXsNCg0KICAgICAgICAgICAgICAgIHJvd0J1aWxkZXIucHVzaCgiPHRkIGNsYXNzPSciKTsNCg0KICAgICAgICAgICAgICAgIHJvd0J1aWxkZXIucHVzaCh0aGlzLmdldFRhYmxlQm9keUNzcygpKTsNCg0KICAgICAgICAgICAgICAgIHJvd0J1aWxkZXIucHVzaCh0aGlzLmdldFRhYmxlQm9keUNlbGxIZWFkZXJzKHJvd0RhdGFbal0uaHRtbEVsZW1lbnRzKSk7DQoNCiAgICAgICAgICAgICAgICByb3dCdWlsZGVyLnB1c2goIic+Iik7DQoNCiAgICAgICAgICAgICAgICB2YXIgaHRtbEVsZW1lbnRIZWFkcyA9IHRoaXMuaGVhZGVyRGF0YVtqXS5odG1sRWxlbWVudEhlYWRzIHx8IFtdOw0KDQogICAgICAgICAgICAgICAgcm93QnVpbGRlci5wdXNoKHRoaXMuZ2VuZXJhdGVDZWxsKGh0bWxFbGVtZW50SGVhZHMscm93RGF0YVtqXS5odG1sRWxlbWVudHMpKTsNCg0KICAgICAgICAgICAgICAgIHJvd0J1aWxkZXIucHVzaCgiPC90ZD4iKTsNCg0KICAgICAgICAgICAgfQkJCQ0KDQoNCgkJCXJvd0J1aWxkZXIucHVzaCgiPHRkPjwvdGQ+PC90cj4iKTsvL0FkZCBhIGJsYW5rIGNlbGwgdG8gZXhwYW5kIHRhYmxlIHNpemUuDQoNCgkJCWJvZHlCdWlsZGVyLnB1c2gocm93QnVpbGRlci5qb2luKCIiKSk7DQoNCgkJfQ0KDQoJCWlmKHRoaXMuYm9keURhdGEubGVuZ3RoPT0wKXsNCg0KCQkJYm9keUJ1aWxkZXIucHVzaCh0aGlzLmdldE5vUmVjb3JkU3RyKCkpOw0KDQoJCX0NCg0KCQlib2R5QnVpbGRlci5wdXNoKCI8L3Rib2R5PjwvdGFibGU+Iik7DQoNCgkJcmV0dXJuIGJvZHlCdWlsZGVyLmpvaW4oIiIpOw0KDQoJfSwNCg0KDQoJZ2VuZXJhdGVDZWxsIDogZnVuY3Rpb24oY2VsbEVsZW1lbnRIZWFkcyxjZWxsRWxlbWVudERhdGFzKXsNCg0KDQogICAgICAgIHZhciBjZWxsQnVpbGRlciA9IG5ldyBBcnJheSgpOw0KDQoNCiAgICAgICAgY2VsbEJ1aWxkZXIucHVzaCgiPHRhYmxlPjx0cj4iKTsNCg0KDQogICAgICAgIGZvcih2YXIgaT0wO2k8Y2VsbEVsZW1lbnRIZWFkcy5sZW5ndGg7aSsrKXsNCg0KDQogICAgICAgICAgICB2YXIgY29udGFpbmVySWQgPSB0aGlzLmlkUHJldmlvdXMrImNvbnRhaW5lci0iK0FjMzYwLmluY3JlYXNlKCk7DQoNCg0KICAgICAgICAgICAgY2VsbEJ1aWxkZXIucHVzaCgiPHRkIHN0eWxlPSdib3JkZXItYm90dG9tOjA7JyBpZD0nIik7DQoNCg0KICAgICAgICAgICAgY2VsbEJ1aWxkZXIucHVzaChjb250YWluZXJJZCk7DQoNCg0KICAgICAgICAgICAgY2VsbEJ1aWxkZXIucHVzaCgiJz4iKTsNCg0KDQogICAgICAgICAgICBpZihjZWxsRWxlbWVudERhdGFzW2ldICYmICFjZWxsRWxlbWVudERhdGFzW2ldLmNsYXNzTmFtZSl7DQoNCg0KICAgICAgICAgICAgICAgIGNlbGxFbGVtZW50RGF0YXNbaV0uY2xhc3NOYW1lID0gdGhpcy5nZXRHZW5lcmF0ZUNlbGxDc3MoKTsNCg0KDQogICAgICAgICAgICB9DQoNCg0KICAgICAgICAgICAgY2VsbEJ1aWxkZXIucHVzaCh0aGlzLmdlbmVyYXRlSFRNTEVsZW1lbnQoY2VsbEVsZW1lbnRIZWFkc1tpXSxjZWxsRWxlbWVudERhdGFzW2ldLGNvbnRhaW5lcklkKSk7DQoNCg0KICAgICAgICAgICAgY2VsbEJ1aWxkZXIucHVzaCgiPC90ZD4iKTsNCg0KDQogICAgICAgIH0NCg0KDQogICAgICAgIGNlbGxCdWlsZGVyLnB1c2goIjwvdHI+PC90YWJsZT4iKTsNCg0KDQogICAgICAgIHJldHVybiBjZWxsQnVpbGRlci5qb2luKCIiKTsNCg0KCX0sDQoNCgkNCg0KCS8vIHNjcmVlbiByZWFkZXJzIHRvIHNwZWFrIHRoZSBoZWFkZXJzIGFzc29jaWF0ZWQgd2l0aCBlYWNoIGRhdGEgY2VsbC4NCg0KCWdldFRhYmxlQm9keUNlbGxIZWFkZXJzIDogZnVuY3Rpb24oY2VsbEVsZW1lbnREYXRhcykNCg0KCXsNCg0KCQl2YXIgcnRuU3RyID0gIiI7DQoNCgkJaWYgKGNlbGxFbGVtZW50RGF0YXMgJiYgY2VsbEVsZW1lbnREYXRhcy5sZW5ndGggPiAwKQ0KDQoJCXsNCg0KCQkJdmFyIGRhdGEgPSBjZWxsRWxlbWVudERhdGFzWzBdOw0KDQoJCQlpZiAoZGF0YSkNCg0KCQkJew0KDQoJCQkJaWYgKGRhdGEuaGVhZGVycykNCg0KCQkJCXsNCg0KCQkJCQlydG5TdHIgPSAiJyBoZWFkZXJzPSciICsgZGF0YS5oZWFkZXJzOw0KDQoJCQkJfQ0KDQoJCQkJZWxzZSBpZiAoZGF0YS5pZCkNCg0KCQkJCXsNCg0KCQkJCQlydG5TdHIgPSAiJyBoZWFkZXJzPSciICsgZGF0YS5pZDsNCg0KCQkJCX0NCg0KCQkJfQ0KDQoJCX0NCg0KCQlyZXR1cm4gcnRuU3RyOw0KDQoJfSwNCg0KDQoJZ2V0Um93SGVhZCA6IGZ1bmN0aW9uKGluZGV4LHJvd0RhdGEpew0KDQoJCXZhciByb3dDbGFzcyA9ICJzaW5nbGVSb3ciOw0KDQoJCWlmKGluZGV4JTI9PTEpew0KDQoJCQlyb3dDbGFzcyA9ICJkb3VibGVSb3ciOw0KDQoJCX0NCg0KCQl2YXIgcm93SGVhZEJ1aWxkZXIgPSBuZXcgQXJyYXkoKTsNCg0KCQlyb3dIZWFkQnVpbGRlci5wdXNoKCI8dHIgIik7DQoNCgkJcm93SGVhZEJ1aWxkZXIucHVzaCh0aGlzLmdldFJvd0hlYWRFdmVudFN0cihyb3dEYXRhKSk7DQoNCgkJcm93SGVhZEJ1aWxkZXIucHVzaCgiIGlkPVwiIik7DQoNCgkJcm93SGVhZEJ1aWxkZXIucHVzaCh0aGlzLmdldFJvd0lkKCkpOw0KDQoJCXJvd0hlYWRCdWlsZGVyLnB1c2goIlwiIGNsYXNzPVwiIik7DQoNCgkJcm93SGVhZEJ1aWxkZXIucHVzaChyb3dDbGFzcyk7DQoNCgkJcm93SGVhZEJ1aWxkZXIucHVzaCgiXCI+Iik7CQ0KDQoJCXJldHVybiByb3dIZWFkQnVpbGRlci5qb2luKCIiKTsNCg0KCX0sDQoNCgkNCg0KCWFwcGVuZFBhZ2luZ0luZm8gOiBmdW5jdGlvbihvdXRlckhUTUwpDQoNCgl7DQoNCgkgICAgaWYodGhpcy5wYWdlSW5mbyl7DQoNCiAgICAgICAgICAgIHZhciBwYWdlSW5mbyA9IHRoaXMucGFnZUluZm87DQoNCiAgICAgICAgICAgIHZhciB3ZWJQYXRoID0gdGhpcy5lbnZpcm9ubWVudC53ZWJQYXRoOw0KDQogICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHRoaXMubWVzc2FnZXM7DQoNCiAgICAgICAgICAgIHZhciBwYWdlTmF2aWdhdG9yID0gbmV3IFVJLlBhZ2VOYXZpZ2F0b3Ioe3BhZ2VJbmZvOnBhZ2VJbmZvLHdlYlBhdGg6d2ViUGF0aCxtZXNzYWdlOm1lc3NhZ2V9KTsNCg0KICAgICAgICAgICAgdmFyIG5hdmlnYXRvckhUTUwgPSBwYWdlTmF2aWdhdG9yLmdldE91dGVySFRNTCh0cnVlLCBmYWxzZSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHZhciBuYXZpZ2F0b3JGb290SFRNTCA9IHBhZ2VOYXZpZ2F0b3IuZ2V0T3V0ZXJIVE1MKGZhbHNlLCB0cnVlKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgb3V0ZXJIVE1MID0gbmF2aWdhdG9ySFRNTCArb3V0ZXJIVE1MK25hdmlnYXRvckZvb3RIVE1MOw0KICAgICAgICAgICAgDQogICAgICAgICANCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIG91dGVySFRNTDsNCg0KCX0sDQoNCgkNCg0KCXJlbmRlciA6IGZ1bmN0aW9uKCl7DQoNCgkJdmFyIG91dGVySFRNTCA9IHRoaXMuZ2V0VGFibGVIZWFkZXIoKSt0aGlzLmdldFRhYmxlQm9keSgpOw0KDQoJCW91dGVySFRNTCA9IHRoaXMuYXBwZW5kUGFnaW5nSW5mbyhvdXRlckhUTUwpOw0KDQoJCQ0KDQoJCWlmKCF0aGlzLnJlYWRPbmx5KXsNCg0KCQkJb3V0ZXJIVE1MID0gdGhpcy5nZXRUb29sQmFyKCkgKyBvdXRlckhUTUw7DQoNCgkJfQ0KDQoJCQ0KDQoJCWRvY3VtZW50LndyaXRlKG91dGVySFRNTCk7DQoNCgkJdGhpcy5yZW5kZXJEZWxheWVkRWxlbSgpOw0KDQoJCXZhciB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuaWQpOw0KDQoJCXRhYmxlLnJlZkpTVGFibGUgPSB0aGlzOy8vQWRkIGEgcmVmZXJlbmNlIHRvIGl0cyBjb3JyZXNwb25kaW5nIEpTIFRhYmxlIG9iamVjdC4NCg0KCQlpZih0aGlzLmJvZHlEYXRhLmxlbmd0aCE9MCl7DQoNCgkJCXZhciByb3dzID0gdGFibGUuY2hpbGRyZW5bMV0ucm93czsNCg0KCQkJZm9yKHZhciBpPTA7aTxyb3dzLmxlbmd0aDtpKyspew0KDQoJCQkJcm93c1tpXS5kYXRhID0gdGhpcy5ib2R5RGF0YVtpXS5jZWxscyB8fCBbXTsvL0JpbmQgRE9NIHJvd3Mgd2l0aCBqc29uIGRhdGEgZm9yIHF1aWNrIHJlZmVyZW5jZS4NCg0KCQkJfQ0KDQoJCQl2YXIgY2lsY2tGaXNydFJvdyA9IGZ1bmN0aW9uKCl7DQoNCgkJCQlpZihkb2N1bWVudC5yZWFkeVN0YXRlPT0nY29tcGxldGUnICYmIFVJLlRhYmxlLnNlbGVjdEZpcnN0Um93KXsNCg0KCQkJCQlyb3dzWzBdLmNsaWNrKCk7DQoNCgkJCQkJY2xlYXJJbnRlcnZhbCh0aW1lcik7DQoNCgkJCQl9DQoNCgkJCX07DQoNCgkJCWlmKHJvd3MgJiYgcm93cy5sZW5ndGg+MCl7DQoNCgkJCQl2YXIgdGltZXIgPSBzZXRJbnRlcnZhbChjaWxja0Zpc3J0Um93LDEwMCk7DQoNCgkJCX0NCg0KCQl9DQoNCgkJdGFibGVDb3JuZXIuYWRkVGFibGVMaXN0ZW4odGhpcy5pZCk7Ly9EcmF3IGNvcm5lcnMgZm9yIHRhYmxlLg0KDQoJCWlmKCF0aGlzLnJlYWRPbmx5KXsNCg0KCQkJdmFyIHRvb2xCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnRvb2xCYXJJZCk7DQoNCgkJCXRvb2xCYXIucmVmVGFibGUgPSB0YWJsZTsvL0FkZCBhIHJlZmVyZW5jZSB0byBET00gdGFibGUuDQoNCgkJCXRoaXMucHJlU3VibWl0KCk7DQoNCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJY3JlYXRlTmV3Um93IDogZnVuY3Rpb24oKXsNCg0KCQl2YXIgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidHIiKTsNCg0KCQlyb3cub25jbGljaz0gZnVuY3Rpb24oKXsNCg0KCQkJVUkuVGFibGUuaGlnaGxpZ2h0KHRoaXMpDQoNCgkJfTsNCg0KCQlyb3cub25tb3VzZW92ZXIgPSBmdW5jdGlvbigpew0KDQoJCQlVSS5UYWJsZS5yb3dNb3VzZU92ZXIodGhpcyk7DQoNCgkJfTsNCg0KCQlyb3cub25tb3VzZW91dCA9IGZ1bmN0aW9uKCl7DQoNCgkJCVVJLlRhYmxlLnJvd01vdXNlT3V0KHRoaXMpOw0KDQoJCX07DQoNCgkJcm93LmlkID0gdGhpcy5nZXRSb3dJZCgpOw0KDQoJCXZhciBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCg0KCQlpZih0aGlzLmhhc1NlbGVjdENvbCl7DQoNCgkJCXZhciBzZWxlY3RDb25maWcgPSB7aWQ6ImFjMzYwX2xpc3RfaWQiLA0KDQoJCQkJCW9uQ2xpY2s6IlVJLlRhYmxlLnNlbGVjdCgpIiwNCg0KCQkJCQl0aXRsZTp0aGlzLm1lc3NhZ2VzWydtZW51YmFyLmNvbW1vbi5zZWxlY3QubGFiZWwnXX07DQoNCgkJCWNlbGwuaW5uZXJIVE1MID0gdGhpcy5nZXRXaWRnZXQodGhpcy5oZWFkZXJEYXRhWzBdLmh0bWxFbGVtZW50SGVhZHNbMF0uZWxlbWVudFR5cGUpLmdldE91dGVySFRNTFdyYXBwZXIoc2VsZWN0Q29uZmlnKTsNCg0KCQkJcm93LmFwcGVuZENoaWxkKGNlbGwpOw0KDQoJCX0NCg0KCQlmb3IodmFyIGk9dGhpcy5oYXNTZWxlY3RDb2w/MTowO2k8dGhpcy5oZWFkZXJEYXRhLmxlbmd0aDtpKyspew0KDQoJCQljZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCg0KCQkJdmFyIGh0bWxFbGVtZW50SGVhZHMgPSB0aGlzLmhlYWRlckRhdGFbaV0uaHRtbEVsZW1lbnRIZWFkcyB8fCBbXTsNCg0KCQkJZm9yKHZhciBqPTA7ajxodG1sRWxlbWVudEhlYWRzLmxlbmd0aDtqKyspew0KDQoJCQkJY2VsbC5pbm5lckhUTUwgKz0gdGhpcy5nZXRXaWRnZXQoaHRtbEVsZW1lbnRIZWFkc1tqXS5lbGVtZW50VHlwZSkuZ2V0T3V0ZXJIVE1MV3JhcHBlcigpOw0KDQoJCQl9DQoNCgkJCXJvdy5hcHBlbmRDaGlsZChjZWxsKTsNCg0KCQl9DQoNCgkJY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7Ly90aGUgbGFzdCBjb2x1bW4gdG8gZXhwYW5kIHRhYmxlIHdpZHRoLg0KDQoJCXJvdy5hcHBlbmRDaGlsZChjZWxsKTsNCg0KCQlyZXR1cm4gcm93Ow0KDQoJfSwNCg0KCQ0KDQoJZ2V0SW5pdFJvd0RhdGEgOiBmdW5jdGlvbigpew0KDQoJCXZhciByb3dEYXRhID0gbmV3IE9iamVjdCgpOw0KDQoJCXJvd0RhdGEuc2lnbiA9ICJuZXciOw0KDQoJCXJvd0RhdGEuaWQgPSAiIjsNCg0KCQlyb3dEYXRhLmNlbGxzID0gbmV3IEFycmF5KCk7DQoNCgkJZm9yKHZhciBpPTA7aTx0aGlzLmhlYWRlckRhdGEubGVuZ3RoO2krKyl7DQoNCgkJCXZhciBjZWxsID0gbmV3IE9iamVjdCgpOw0KDQoJCQljZWxsLmh0bWxFbGVtZW50cz1uZXcgQXJyYXkoKTsNCg0KCQkJdmFyIGh0bWxFbGVtZW50SGVhZHMgPSB0aGlzLmhlYWRlckRhdGFbaV0uaHRtbEVsZW1lbnRIZWFkcyB8fCBbXTsNCg0KCQkJZm9yKHZhciBqPTA7ajxodG1sRWxlbWVudEhlYWRzLmxlbmd0aDtqKyspew0KDQoJCQkJY2VsbC5odG1sRWxlbWVudHMucHVzaChudWxsKTsNCg0KCQkJfQ0KDQoJCQlyb3dEYXRhLmNlbGxzLnB1c2goY2VsbCk7DQoNCgkJfQ0KDQoJCXJldHVybiByb3dEYXRhOw0KDQoJfSwNCg0KCQ0KDQoJZ2V0Q29tbWl0RGF0YSA6IGZ1bmN0aW9uKCl7DQoNCgkJdmFyIHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5pZCk7DQoNCgkJdmFyIHJvd3MgPSB0YWJsZS5jaGlsZHJlblsxXS5yb3dzOw0KDQoJCXZhciByZXN1bHREYXRhID0gbmV3IEFycmF5KCk7DQoNCgkJZm9yKHZhciBpPTA7aTxyb3dzLmxlbmd0aDtpKyspew0KDQoJCQl2YXIgY29scyA9IHJvd3NbaV0uY2hpbGRyZW47DQoNCgkJCWlmKHRoaXMuaGFzU2VsZWN0Q29sKXsvL3NlbGVjdCBjb2x1bW4gZG9lcyBub3QgY29udGFpbiBkYXRhIHRvIHN1Ym1pdC4NCg0KCQkJCWNvbHMgPSBjb2xzLnNsaWNlKDEpOw0KDQoJCQl9DQoNCgkJCWZvcih2YXIgaj0wO2o8Y29scy5sZW5ndGgtMTtqKyspey8vc2tpcCB0aGUgbGFzdCBjb2x1bW4gd2hpY2ggaXMgdXNlZCB0byBleHBhbmQgdGFibGUgc2l6ZS4NCg0KCQkJCXZhciBjaGlsZE5vZGVzID0gY29sc1tqXS5jaGlsZE5vZGVzOw0KDQoJCQkJZm9yKHZhciBrPTA7azxjaGlsZE5vZGVzLmxlbmd0aDtrKyspew0KDQoJCQkJCXZhciB2YWx1ZSA9IHRoaXMuZ2V0V2lkZ2V0KHRoaXMuaGVhZGVyRGF0YVtqXS5odG1sRWxlbWVudEhlYWRzW2tdLmVsZW1lbnRUeXBlKS5wYXJzZVNpYmxpbmcoY2hpbGROb2Rlc1trXSk7DQoNCgkJCQkJdmFyIGNoYW5nZWQgPSBmYWxzZTsNCg0KCQkJCQlpZihyb3dbaV0uZGF0YS5jZWxsc1tqXS5odG1sRWxlbWVudHNba10udmFsdWUhPXZhbHVlKXsNCg0KCQkJCQkJcm93W2ldLmRhdGEuY2VsbHNbal0uaHRtbEVsZW1lbnRzW2tdLnZhbHVlID0gdmFsdWU7DQoNCgkJCQkJCWNoYW5nZWQgPSB0cnVlOw0KDQoJCQkJCX0NCg0KCQkJCQlpZihjaGFuZ2VkICYmICFyb3dbaV0uZGF0YS5zaWduKQ0KDQoJCQkJCQlyb3dbaV0uZGF0YS5zaWduID0gInVwZGF0ZSI7DQoNCgkJCQl9DQoNCgkJCX0NCg0KCQkJaWYocm93W2ldLmRhdGEuc2lnbil7DQoNCgkJCQlyZXN1bHREYXRhLnB1c2gocm93W2ldLmRhdGEpOw0KDQoJCQl9DQoNCgkJfQ0KDQoJCXZhciByZXN1bHREYXRhID0gcmVzdWx0RGF0YS5jb25jYXQodGhpcy5kZWxldGVkUm93RGF0YSk7DQoNCgkJcmV0dXJuIEFjMzYwLmpzb25Ub1N0cihyZXN1bHREYXRhKTsNCg0KCX0sDQoNCgkNCg0KCXByZVN1Ym1pdCA6IGZ1bmN0aW9uKCl7DQoNCgkJaWYoZG9jdW1lbnQuZm9ybXNbMF0pew0KDQoJCQlCYXNlSlMuYWRkRXZlbnRIYW5kbGVyKGRvY3VtZW50LmZvcm1zWzBdLCJvbnN1Ym1pdCIsZnVuY3Rpb24oKXsNCg0KCQkJCWRvY3VtZW50LmZvcm1zWzBdLmlubmVySFRNTCA9IGRvY3VtZW50LmZvcm1zWzBdLmlubmVySFRNTCANCg0KCQkJCSsgIjxpbnB1dCB0eXBlPWhpZGRlbiBuYW1lPVwiYWMzNjBfbGlzdFwiIHZhbHVlPVwiIg0KDQoJCQkJK3RoaXMuZ2V0Q29tbWl0RGF0YSgpDQoNCgkJCQkrIlwiPjwvaW5wdXQ+IjsNCg0KCQkJfSk7DQoNCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJZ2V0VGFibGVIZWFkZXJDc3MgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJcmV0dXJuICJwb3J0bGV0LXNlY3Rpb24tc3ViaGVhZGVyIEFsaWduTCI7DQoNCgl9LA0KDQoJDQoNCglnZXRUYWJsZUJvZHlDc3MgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJcmV0dXJuICJwb3J0bGV0LXNlY3Rpb24tYm9keSI7DQoNCgl9LA0KDQoJDQoNCglnZXRHZW5lcmF0ZUNlbGxDc3MgOiBmdW5jdGlvbigpDQoNCgl7DQoNCgkJcmV0dXJuICJsaXN0LWZpZWxkLWVsbGlwc2lzIjsNCg0KCX0sDQoNCgkNCg0KCWdldFRhYmxlSGVhZGVyTGFiZWwgOiBmdW5jdGlvbihsYWJlbCkNCg0KCXsNCg0KCQlyZXR1cm4gIjxmb250IGNsYXNzPVwiaWdub3JlU29ydEhlYWRlclwiPiIgKyBsYWJlbCArICI8L2ZvbnQ+IjsNCg0KCX0sDQoNCgkNCg0KCWdldE5vUmVjb3JkU3RyIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXZhciBydG5TdHIgPSAiPHRyIGlkPSdwb3BOb3JlY29yZCc+IjsNCg0KCQlpZih0aGlzLmhhc1NlbGVjdENvbCl7DQoNCgkJCXJ0blN0ciArPSAiPHRkIHdpZHRoPScxJScvPiI7DQoNCgkJfQ0KDQoJCXJ0blN0ciArPSAiPHRkIGNsYXNzPSdwb3J0bGV0LW1zZy1hbGVydCcgY29sc3Bhbj0nMTk5Jz4iOw0KDQoJCXJ0blN0ciArPSB0aGlzLm1lc3NhZ2VzWydwYWdlLm5vcmVjb3JkLmxhYmVsJ107DQoNCgkJcnRuU3RyICs9ICI8L3RkPjwvdHI+IjsNCg0KCQlyZXR1cm4gcnRuU3RyOw0KDQoJfSwNCg0KCQ0KDQoJZ2V0Um93SGVhZEV2ZW50U3RyIDogZnVuY3Rpb24ocm93RGF0YSkNCg0KCXsNCg0KCQl2YXIgcnRuU3RyID0gIiBvbmNsaWNrPVwiVUkuVGFibGUuaGlnaGxpZ2h0KHRoaXMpOyI7DQoNCgkJaWYocm93RGF0YS5yb3dDbGljayl7DQoNCgkJCXJ0blN0ciArPSAiVUkuVGFibGUucm93Q2xpY2tGdW5jKHRoaXMsJyI7DQoNCgkJCXJ0blN0ciArPSB0aGlzLmpzVG9IdG1sKHJvd0RhdGEucm93Q2xpY2spOw0KDQoJCQlydG5TdHIgKz0gIicpOyI7DQoNCgkJfQ0KDQoJCXJ0blN0ciArPSAiXCIgb25tb3VzZW92ZXI9XCJVSS5UYWJsZS5yb3dNb3VzZU92ZXIodGhpcylcIiBvbm1vdXNlb3V0PVwiVUkuVGFibGUucm93TW91c2VPdXQodGhpcylcIiAiOw0KDQoJCXJldHVybiBydG5TdHI7DQoNCgl9LA0KDQoJDQoNCglhZGREZWZhdWx0RXZlbnQgOiBmdW5jdGlvbigpew0KDQoJCQ0KDQoJfQ0KDQp9KTsNCg0KLy9BZGQgdGhlIGV2ZW50IGhhbmRsZXIgZm9yIHRhYmxlIGNvbXBvbmVudC4NCg0KVUkuVGFibGUuaW5zZXJ0ID0gZnVuY3Rpb24oKXsNCg0KCXZhciBldmVudCA9IEFjMzYwLmdldEV2ZW50KCk7DQoNCgl2YXIgc3JjT2JqID0gZXZlbnQuc3JjRWxlbWVudCB8fCBldmVudC5vcmlnaW5hbFRhcmdldDsNCg0KCXZhciB0YWJsZU5vZGUgPSBzcmNPYmoucGFyZW50Tm9kZS5yZWZUYWJsZTsNCg0KCXZhciB0YWJsZUJvZHkgPSB0YWJsZU5vZGUuY2hpbGRyZW5bMV07DQoNCgl2YXIgdGFibGUgPSB0YWJsZU5vZGUucmVmSlNUYWJsZTsNCg0KCXZhciByb3dEYXRhID0gdGFibGUuZ2V0SW5pdFJvd0RhdGEoKTsNCg0KCXZhciBuZXdOb2RlID0gdGFibGUuY3JlYXRlTmV3Um93KCk7DQoNCgluZXdOb2RlLmRhdGEgPSByb3dEYXRhOw0KDQoJdGFibGVCb2R5LmFwcGVuZENoaWxkKG5ld05vZGUpOw0KDQoJc2Nyb2xsQmFySXNzdWUuYXV0b0FkanVzdEZvclRhYmxlQWRkT3JSZW1vdmVSb3dzKGRvY3VtZW50KTsNCg0KfTsNCg0KDQpVSS5UYWJsZS5yZW1vdmUgPSBmdW5jdGlvbigpew0KDQoJdmFyIGV2ZW50ID0gQWMzNjAuZ2V0RXZlbnQoKTsNCg0KCXZhciBzcmNPYmogPSBldmVudC5zcmNFbGVtZW50IHx8IGV2ZW50Lm9yaWdpbmFsVGFyZ2V0Ow0KDQoJdmFyIHRhYmxlTm9kZSA9IHNyY09iai5wYXJlbnROb2RlLnJlZlRhYmxlOw0KDQoJdmFyIHRhYmxlQm9keSA9IHRhYmxlTm9kZS5jaGlsZHJlblsxXTsNCg0KCXZhciByb3dzID0gdGFibGVCb2R5LnJvd3M7DQoNCgl2YXIgdGFibGUgPSB0YWJsZU5vZGUucmVmSlNUYWJsZTsNCg0KCXZhciBkZWxldGVkRWxlbXMgPSBuZXcgQXJyYXkoKTsNCg0KCXZhciB0b0RlbGV0ZURhdGFzID0gbmV3IEFycmF5KCk7DQoNCglpZih0YWJsZS5zZWxlY3RlZFJvd3MubGVuZ3RoPT0wKXsNCg0KCQlyZXR1cm47DQoNCgl9DQoNCglmb3IodmFyIGk9MDtpPHRhYmxlLnNlbGVjdGVkUm93cy5sZW5ndGg7aSsrKXsNCg0KCQkJdmFyIHRvRGVsZXRlRGF0YSA9IHRhYmxlLnNlbGVjdGVkUm93c1tpXS5kYXRhOw0KDQoJCQlpZih0b0RlbGV0ZURhdGEuc2lnbiE9Im5ldyIpew0KDQoJCQkJdG9EZWxldGVEYXRhLnNpZ24gPSAiZGVsZXRlIjsNCg0KCQkJCXRhYmxlLmRlbGV0ZWRSb3dEYXRhLnB1c2godG9EZWxldGVEYXRhKTsNCg0KCQkJfQ0KDQoJCQlkZWxldGVkRWxlbXMucHVzaCh0YWJsZS5zZWxlY3RlZFJvd3NbaV0pOw0KDQoJfQ0KDQoJZm9yKGk9MDtpPGRlbGV0ZWRFbGVtcy5sZW5ndGg7aSsrKXsNCg0KCQl0YWJsZUJvZHkucmVtb3ZlQ2hpbGQoZGVsZXRlZEVsZW1zW2ldKTsNCg0KCX0NCg0KCXRhYmxlLnNlbGVjdGVkUm93cz0gbmV3IEFycmF5KCk7DQoNCglpZihyb3dzICYmIHJvd3MubGVuZ3RoPjApew0KDQoJCXJvd3NbMF0uY2xpY2soKTsNCg0KCX0NCg0KCXNjcm9sbEJhcklzc3VlLmF1dG9BZGp1c3RGb3JUYWJsZUFkZE9yUmVtb3ZlUm93cyhkb2N1bWVudCk7DQoNCglyZXR1cm4gZGVsZXRlZEVsZW1zOw0KDQp9Ow0KDQoNClVJLlRhYmxlLnJvd01vdXNlT3ZlciA9IGZ1bmN0aW9uKHJvd09iail7DQoNCglpZihyb3dPYmopew0KDQoJCXZhciByb3dDbGFzcyA9IHJvd09iai5jbGFzc05hbWU7DQoNCgkJaWYocm93Q2xhc3MgJiYgKHJvd0NsYXNzLmluZGV4T2YoJ3Jvd0NsaWNrJykgPiAtMSB8fCByb3dDbGFzcy5pbmRleE9mKCdyb3dPdmVyJykgPiAtMSkpew0KDQoJCQlyZXR1cm47DQoNCgkJfQ0KDQoJCXJvd09iai5jbGFzc05hbWUgKz0gJyByb3dPdmVyJzsNCg0KCX0JDQoNCn07DQoNCg0KVUkuVGFibGUucm93TW91c2VPdXQgPSBmdW5jdGlvbihyb3dPYmopew0KDQoJaWYocm93T2JqKXsNCg0KCQl2YXIgcm93Q2xhc3MgPSByb3dPYmouY2xhc3NOYW1lOw0KDQoJCWlmKHJvd0NsYXNzICYmIHJvd0NsYXNzLmluZGV4T2YoJ3Jvd0NsaWNrJykgPiAtMSl7DQoNCgkJCXJldHVybjsNCg0KCQl9DQoNCgkJcm93T2JqLmNsYXNzTmFtZSA9IHJvd0NsYXNzLnJlcGxhY2UoL3Jvd092ZXIvaWcsJycpOw0KDQoJfQ0KDQp9Ow0KDQoNClVJLlRhYmxlLmhpZ2hsaWdodCA9IGZ1bmN0aW9uKHJvd09iaikgew0KDQoJdmFyIGV2ZW50ID0gQWMzNjAuZ2V0RXZlbnQoKTsNCg0KCXZhciBzcmNPYmogPSBldmVudC5zcmNFbGVtZW50IHx8IGV2ZW50Lm9yaWdpbmFsVGFyZ2V0Ow0KDQoJaWYoc3JjT2JqICE9IG51bGwgJiYgKHNyY09iai50eXBlID09ICJjaGVja2JveCIgfHwgc3JjT2JqLnR5cGUgPT0gInJhZGlvIiANCg0KCQl8fCBzcmNPYmoudHlwZSA9PSAidGV4dCIgfHwgc3JjT2JqLnRhZ05hbWUgPT0gIlNFTEVDVCIpKQ0KDQoJCXJldHVybjsNCg0KCXZhciB0YWJsZU5vZGUgPSByb3dPYmoucGFyZW50Tm9kZS5wYXJlbnROb2RlOw0KDQoJdmFyIHRhYmxlID0gdGFibGVOb2RlLnJlZkpTVGFibGU7DQoNCgl2YXIgcm93Q2xhc3MgPSByb3dPYmouY2xhc3NOYW1lOw0KDQoJaWYocm93Q2xhc3MuaW5kZXhPZigncm93Q2xpY2snKSA8IDApew0KDQoJCXJvd09iai5jbGFzc05hbWUgKz0gJyByb3dDbGljayc7DQoNCgl9DQoNCglpZih0YWJsZS5oaWdoTGlnaHRlZFJvdyAmJiB0YWJsZS5oaWdoTGlnaHRlZFJvdyE9cm93T2JqKQ0KDQoJCXRhYmxlLmhpZ2hMaWdodGVkUm93LmNsYXNzTmFtZSA9IHRhYmxlLmhpZ2hMaWdodGVkUm93LmNsYXNzTmFtZS5yZXBsYWNlKC9yb3dDbGlja3xyb3dPdmVyL2lnLCcnKTsNCg0KCXRhYmxlLmhpZ2hMaWdodGVkUm93ID0gcm93T2JqOw0KDQp9Ow0KDQoNClVJLlRhYmxlLnJvd0NsaWNrRnVuYyA9IGZ1bmN0aW9uKHJvd09iaixjbGlja0Z1bmNTdHIpew0KDQoJdmFyIGV2ZW50ID0gQWMzNjAuZ2V0RXZlbnQoKTsNCg0KCXZhciBzcmNPYmogPSBldmVudC5zcmNFbGVtZW50IHx8IGV2ZW50Lm9yaWdpbmFsVGFyZ2V0Ow0KDQoJaWYoc3JjT2JqICE9IG51bGwgJiYgKHNyY09iai50eXBlID09ICJjaGVja2JveCIgfHwgc3JjT2JqLnR5cGUgPT0gInJhZGlvIiANCg0KCQl8fCBzcmNPYmoudHlwZSA9PSAidGV4dCIgfHwgc3JjT2JqLnRhZ05hbWUgPT0gIlNFTEVDVCIgfHwgc3JjT2JqLnRhZ05hbWUgPT0gIkEiKSkNCg0KCQlyZXR1cm47DQoNCgl0cnl7DQoNCgkJdmFyIGNsaWNrRnVuYyA9IG5ldyBGdW5jdGlvbihjbGlja0Z1bmNTdHIpLmJpbmQocm93T2JqKTsNCg0KCQljbGlja0Z1bmMoKTsNCg0KCX1jYXRjaChlKXsNCg0KCQkNCg0KCX0NCg0KfTsNCg0KDQpVSS5UYWJsZS5zZWxlY3RBbGwgPSBmdW5jdGlvbigpew0KDQoJdmFyIGV2ZW50ID0gQWMzNjAuZ2V0RXZlbnQoKTsNCg0KCXZhciBzcmNPYmogPSBldmVudC5zcmNFbGVtZW50IHx8IGV2ZW50Lm9yaWdpbmFsVGFyZ2V0Oy8vY2hlY2sgYm94IG9iamVjdC4NCg0KCXZhciBzZWxlY3RlZFJvdyA9IHNyY09iai5wYXJlbnROb2RlLnBhcmVudE5vZGU7Ly9jaGVja2JveC0+dGgtPnRyDQoNCgl2YXIgdGFibGVOb2RlID0gc2VsZWN0ZWRSb3cucGFyZW50Tm9kZS5wYXJlbnROb2RlOy8vdHItPnRoZWFkLT50YWJsZQ0KDQoJdmFyIHRhYmxlID0gdGFibGVOb2RlLnJlZkpTVGFibGU7DQoNCgl2YXIgcm93cyA9IHRhYmxlTm9kZS5jaGlsZHJlblsxXS5yb3dzOw0KDQoJZm9yKHZhciBpPTA7aTxyb3dzLmxlbmd0aDtpKyspew0KDQoJCXZhciBjaGVja0JveCA9IHJvd3NbaV0uY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF07Ly90ci0+dGQtPmNoZWNrYm94DQoNCgkJaWYoY2hlY2tCb3ggJiYgIWNoZWNrQm94LmNoZWNrZWQgJiYgIWNoZWNrQm94LmRpc2FibGVkKXsNCg0KCQkJY2hlY2tCb3guY2hlY2tlZCA9IHRydWU7DQoNCgkJCXRhYmxlLnNlbGVjdGVkUm93cy5wdXNoKHJvd3NbaV0pOw0KDQoJCX0NCg0KCX0NCg0KCXRhYmxlLnNlbGVjdEFsbEhhbmRsZShzcmNPYmopOw0KDQoJc3JjT2JqLm9uY2xpY2sgPSBVSS5UYWJsZS51blNlbGVjdEFsbDsNCg0KfTsNCg0KDQpVSS5UYWJsZS51blNlbGVjdEFsbCA9IGZ1bmN0aW9uKCl7DQoNCgl2YXIgZXZlbnQgPSBBYzM2MC5nZXRFdmVudCgpOw0KDQoJdmFyIHNyY09iaiA9IGV2ZW50LnNyY0VsZW1lbnQgfHwgZXZlbnQub3JpZ2luYWxUYXJnZXQ7Ly9jaGVjayBib3ggb2JqZWN0Lg0KDQoJdmFyIHNlbGVjdGVkUm93ID0gc3JjT2JqLnBhcmVudE5vZGUucGFyZW50Tm9kZTsvL2NoZWNrYm94LT50aC0+dHINCg0KCXZhciB0YWJsZU5vZGUgPSBzZWxlY3RlZFJvdy5wYXJlbnROb2RlLnBhcmVudE5vZGU7Ly90ci0+dGhlYWQtPnRhYmxlDQoNCgl2YXIgdGFibGUgPSB0YWJsZU5vZGUucmVmSlNUYWJsZTsNCg0KCXZhciByb3dzID0gdGFibGVOb2RlLmNoaWxkcmVuWzFdLnJvd3M7DQoNCglmb3IodmFyIGk9MDtpPHJvd3MubGVuZ3RoO2krKyl7DQoNCgkJdmFyIGNoZWNrQm94ID0gcm93c1tpXS5jaGlsZHJlblswXS5jaGlsZHJlblswXTsvL3RyLT50ZC0+Y2hlY2tib3gNCg0KCQlpZihjaGVja0JveCAmJiBjaGVja0JveC5jaGVja2VkICYmICFjaGVja0JveC5kaXNhYmxlZCl7DQoNCgkJCWNoZWNrQm94LmNoZWNrZWQgPSBmYWxzZTsNCg0KCQkJdmFyIGluZGV4ID0gQWMzNjAuaW5kZXhPZkFycmF5KHRhYmxlLnNlbGVjdGVkUm93cyxyb3dzW2ldKTsNCg0KCQkJdGFibGUuc2VsZWN0ZWRSb3dzLnNwbGljZShpbmRleCwxKTsNCg0KCQl9DQoNCgl9DQoNCgl0YWJsZS5zZWxlY3RBbGxIYW5kbGUoc3JjT2JqKTsNCg0KCXNyY09iai5vbmNsaWNrID0gVUkuVGFibGUuc2VsZWN0QWxsOw0KDQp9Ow0KDQoNClVJLlRhYmxlLnNlbGVjdCA9IGZ1bmN0aW9uKCl7DQoNCgl2YXIgZXZlbnQgPSBBYzM2MC5nZXRFdmVudCgpOw0KDQoJdmFyIHNyY09iaiA9IGV2ZW50LnNyY0VsZW1lbnQgfHwgZXZlbnQub3JpZ2luYWxUYXJnZXQ7Ly9jaGVja2JveCBvciByYWRpbyBvYmplY3QuDQoNCgl2YXIgc2VsZWN0ZWRSb3cgPSBzcmNPYmoucGFyZW50Tm9kZS5wYXJlbnROb2RlOy8vY2hlY2tib3ggb3IgcmFkaW8tPnRkLT50cg0KDQoJdmFyIHRhYmxlTm9kZSA9IHNlbGVjdGVkUm93LnBhcmVudE5vZGUucGFyZW50Tm9kZTsvL3RyLT50Ym9keS0+dGFibGUNCg0KCXZhciB0YWJsZSA9IHRhYmxlTm9kZS5yZWZKU1RhYmxlOw0KDQoJaWYoc3JjT2JqLmNoZWNrZWQpew0KDQoJCXRhYmxlLnNlbGVjdGVkUm93cy5wdXNoKHNlbGVjdGVkUm93KTsNCg0KCX1lbHNlew0KDQoJCXZhciBpbmRleCA9IEFjMzYwLmluZGV4T2ZBcnJheSh0YWJsZS5zZWxlY3RlZFJvd3Msc2VsZWN0ZWRSb3cpOw0KDQoJCXRhYmxlLnNlbGVjdGVkUm93cy5zcGxpY2UoaW5kZXgsMSk7DQoNCgl9DQoNCn07DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IFRleHQuanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiA8PEdlbmVyYWwgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzPj4NCg0KICogDQoNCiAqIE5vdGVzOg0KDQogKiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqDQoNCiAqLw0KDQoNClVJLlRleHQgPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNCg0KVUkuVGV4dC5leHRlbmQoew0KDQoJDQoNCglpZFByZXZpb3VzIDogInRleHQtIiwNCg0KCQ0KDQoJaW5pdCA6IGZ1bmN0aW9uKGNvbmZpZyl7DQoNCgkJdGhpcy50ZXh0ID0gY29uZmlnLnRleHQgfHwgIiI7DQoNCgkJdGhpcy5jb250YWluZXJJZCA9IGNvbmZpZy5jb250YWluZXJJZDsNCg0KCQl0aGlzLnN0eWxlID0gY29uZmlnLnN0eWxlIHx8ICIiOw0KDQoJCXRoaXMud2lkdGggPSB0aGlzLnBhcnNlV2lkdGgodGhpcy5zdHlsZSk7DQoNCiAgICAgICAgaWYgKCFBYzM2MC52YWxpZGF0b3IuaXNFbXB0eShjb25maWcubGVuZ3RoUmVzdHJpY3RlZCkgJiYgY29uZmlnLmxlbmd0aFJlc3RyaWN0ZWQgID09ICJmYWxzZSIpDQoNCiAgICAgICAgew0KDQogICAgICAgICAgICB0aGlzLmxlbmd0aFJlc3RyaWN0ZWQgPSBmYWxzZTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgZWxzZQ0KDQogICAgICAgIHsNCg0KICAgICAgICAgICAgdGhpcy5sZW5ndGhSZXN0cmljdGVkID0gdHJ1ZTsNCg0KICAgICAgICB9DQoNCgl9LA0KDQoJDQoNCglyZW5kZXIgOiBmdW5jdGlvbigpew0KDQoJCXZhciB0ZXh0ID0gdGhpcy50ZXh0Ow0KDQoJCWlmKHRoaXMubGVuZ3RoUmVzdHJpY3RlZCAmJiB0aGlzLndpZHRoKQ0KDQoJCQl0ZXh0ID0gQWMzNjAuZm9ybWF0VG9NYXhMZW5ndGgodGV4dCx0aGlzLndpZHRoLHRydWUpOw0KDQoJCXZhciB0ZXh0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpOw0KDQoJCXZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmNvbnRhaW5lcklkKTsNCg0KCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dE5vZGUpOw0KDQoJfSwNCg0KCQ0KDQoJZ2V0T3V0ZXJIVE1MIDogZnVuY3Rpb24oZGF0YSl7DQoNCgkJdmFyIGluaXREYXRhID0gZGF0YSB8fCB7fTsNCg0KCQl2YXIgdGV4dCA9IGluaXREYXRhLnRleHQgfHwgIiI7DQoNCgkJdmFyIHN0eWxlID0gaW5pdERhdGEuc3R5bGUgfHwgdGhpcy5zdHlsZTsNCg0KCQl2YXIgd2lkdGggPSB0aGlzLnBhcnNlV2lkdGgoc3R5bGUpOw0KDQogICAgICAgIHZhciBsZW5ndGhSZXN0cmljdGVkID0gdHJ1ZTsNCg0KICAgICAgICANCg0KICAgICAgICBpZiAoIUFjMzYwLnZhbGlkYXRvci5pc0VtcHR5KGluaXREYXRhLmxlbmd0aFJlc3RyaWN0ZWQpICYmIGluaXREYXRhLmxlbmd0aFJlc3RyaWN0ZWQgID09ICJmYWxzZSIpDQoNCiAgICAgICAgew0KDQogICAgICAgICAgICBsZW5ndGhSZXN0cmljdGVkID0gZmFsc2U7DQoNCiAgICAgICAgfQ0KDQoNCgkJaWYobGVuZ3RoUmVzdHJpY3RlZCAmJiB3aWR0aCkNCg0KCQl7DQoNCgkJCXRleHQgPSBBYzM2MC5mb3JtYXRUb01heExlbmd0aCh0ZXh0LHdpZHRoLHRydWUpOw0KDQoJCX0NCg0KCQkNCg0KCQlyZXR1cm4gdGV4dDsNCg0KCX0sDQoNCgkNCg0KCXBhcnNlU2libGluZ1ZhbHVlIDogZnVuY3Rpb24oc2libGluZyl7DQoNCgkJcmV0dXJuIHNpYmxpbmcuaW5uZXJIVE1MOw0KDQoJfSwNCg0KCQ0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKXsNCg0KCQkNCg0KCX0NCg0KCQ0KDQp9KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgidGV4dCIsVUkuVGV4dCk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MCBGaWxlOiBSYWRpby5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246IDw8R2VuZXJhbCBkZXNjcmlwdGlvbiBvZiB0aGUgY2xhc3M+Pg0KDQogKiANCg0KICogTm90ZXM6IDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICogUmV2aXNpb24gSGlzdG9yeTogPDxEYXRlPj4sIDw8V2hvPj4sIDw8V2hhdD4+IDI1LzQvMjAxMiwgUmF5IFpoYW5nLA0KDQogKiBJbml0aWFsIHZlcnNpb24NCg0KICogDQoNCiAqLw0KDQoNClVJLlJhZGlvID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClVJLlJhZGlvLmV4dGVuZCh7DQoNCg0KICAgIGlkUHJldmlvdXMgOiAicmFkaW8tIiwNCg0KDQogICAgaW5pdCA6IGZ1bmN0aW9uKGNvbmZpZyl7DQoNCiAgICAgICAgdGhpcy5pZCA9IGNvbmZpZy5pZCB8fCB0aGlzLmdldElkKCk7DQoNCiAgICAgICAgdGhpcy5uYW1lID0gY29uZmlnLm5hbWUgfHwgdGhpcy5nZXRJZCgpOw0KDQogICAgICAgIHRoaXMuYWNjZXNzS2V5ID0gY29uZmlnLmFjY2Vzc0tleSB8fCAiIjsNCg0KICAgICAgICB0aGlzLmFsaWduID0gY29uZmlnLmFsaWduIHx8ICIiOw0KDQogICAgICAgIHRoaXMudmFsdWUgPSBjb25maWcudmFsdWUgfHwgIiI7DQoNCiAgICAgICAgdGhpcy5jbGFzc05hbWUgPSBjb25maWcuY2xhc3NOYW1lIHx8ICIiOw0KDQogICAgICAgIHRoaXMuZGlzYWJsZWQgPSBjb25maWcuZGlzYWJsZWQgfHwgZmFsc2U7DQoNCiAgICAgICAgdGhpcy5yZWFkT25seSA9IGNvbmZpZy5yZWFkT25seSB8fCBmYWxzZTsNCg0KICAgICAgICB0aGlzLm11bHRpcGxlID0gY29uZmlnLm11bHRpcGxlIHx8IGZhbHNlOw0KDQogICAgICAgIHRoaXMuc3R5bGUgPSBjb25maWcuc3R5bGU7DQoNCiAgICAgICAgdGhpcy50YWJJbmRleCA9IGNvbmZpZy50YWJJbmRleDsNCg0KICAgICAgICB0aGlzLml0ZW1zID0gY29uZmlnLml0ZW1zIHx8IFtdOw0KDQogICAgICAgIHRoaXMuY29udGFpbmVySWQgPSBjb25maWcuY29udGFpbmVySWQ7DQoNCiAgICAgICAgdGhpcy5ldmVudE1hcCA9IGNvbmZpZy5ldmVudE1hcHx8e307DQoNCiAgICAgICAgdGhpcy5zdXBwb3J0RXZlbnRzID0gY29uZmlnLnN1cHBvcnRFdmVudHMgfHwgWyJjaGFuZ2UiLCJjbGljayJdOw0KDQogICAgfSwNCg0KDQogICAgcmVuZGVyIDogZnVuY3Rpb24oKXsNCg0KICAgICAgICBmb3IodmFyIGk9MDtpPHRoaXMuaXRlbXMubGVuZ3RoO2krKyl7DQoNCiAgICAgICAgICAgIHZhciByYWRpb0l0ZW1zID0gdGhpcy5pdGVtc1tpXTsNCg0KICAgICAgICAgICAgdmFyIHJhZGlvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsNCg0KICAgICAgICAgICAgcmFkaW8uc2V0QXR0cmlidXRlKCd0eXBlJywncmFkaW8nKTsNCg0KICAgICAgICAgICAgcmFkaW8ubmFtZSA9IHRoaXMubmFtZTsNCg0KICAgICAgICAgICAgcmFkaW8uaWQgPSB0aGlzLmlkOw0KDQogICAgICAgICAgICBpZihyYWRpb0l0ZW1zLmNsYXNzTmFtZSl7DQoNCiAgICAgICAgICAgICAgICByYWRpby5jbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihyYWRpb0l0ZW1zLmFjY2Vzc0tleSl7DQoNCiAgICAgICAgICAgICAgICByYWRpby5hY2Nlc3NLZXkgPSB0aGlzLmFjY2Vzc0tleTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihyYWRpb0l0ZW1zLmFsaWduKXsNCg0KICAgICAgICAgICAgICAgIHJhZGlvLmFsaWduID0gdGhpcy5hbGlnbjsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihyYWRpb0l0ZW1zLnZhbHVlID09IHRoaXMudmFsdWUpew0KDQogICAgICAgICAgICAgICAgcmFkaW8uY2hlY2tlZCA9IHRydWU7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYocmFkaW9JdGVtcy5kaXNhYmxlZCl7DQoNCiAgICAgICAgICAgICAgICByYWRpby5kaXNhYmxlZCA9IHRoaXMuZGlzYWJsZWQ7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYodGhpc3JhZGlvSXRlbXMuc3R5bGUpew0KDQogICAgICAgICAgICAgICAgcmFkaW8uc3R5bGUgPSB0aGlzLnN0eWxlOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKHJhZGlvSXRlbXMudGFiSW5kZXgpew0KDQogICAgICAgICAgICAgICAgcmFkaW8udGFiSW5kZXggPSB0aGlzLnRhYkluZGV4Ow0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KDQogICAgICAgICAgICBpZihyYWRpb0l0ZW1zLmNoZWNrZWQpew0KDQogICAgICAgICAgICAgICAgdGhpcy5jaGVja2VkID0gdHJ1ZTsgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KDQogICAgICAgICAgICBpZih0aGlzLmxhYmVsKXsNCg0KICAgICAgICAgICAgICAgIC8vb3B0aW9uLmlubmVySFRNTCA9IHRoaXMuaXRlbXNbaV0udGV4dCB8fCB0aGlzLml0ZW1zW2ldLmxhYmVsOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KDQogICAgICAgICAgICB0aGlzLmJpbmRFdmVudHMocmFkaW8sdGhpcy5ldmVudE1hcCx0aGlzLnN1cHBvcnRFdmVudHMpOw0KDQogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5jb250YWluZXJJZCk7DQoNCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChyYWRpbyk7DQoNCiAgICAgICAgfQ0KDQogICAgfSwNCg0KDQogICAgZ2V0T3V0ZXJIVE1MIDogZnVuY3Rpb24oY29uZmlnKXsNCg0KICAgICAgICB2YXIgaW5pdERhdGEgPSBjb25maWcgfHwge307DQoNCiAgICAgICAgdmFyIHRleHQgPSBpbml0RGF0YS52YWx1ZSB8fCAiIjsNCg0KICAgICAgICB2YXIgaWQgPSBpbml0RGF0YS5pZCB8fCB0aGlzLmlkOw0KDQogICAgICAgIHZhciBuYW1lID0gaW5pdERhdGEubmFtZSB8fCBpZDsNCg0KICAgICAgICB2YXIgY2xhc3NOYW1lID0gaW5pdERhdGEuY2xhc3NuYW1lIHx8IHRoaXMuY2xhc3NOYW1lOw0KDQogICAgICAgIHZhciBkaXNhYmxlZCA9IGluaXREYXRhLmRpc2FibGVkIHx8IHRoaXMuZGlzYWJsZWQ7DQoNCiAgICAgICAgdmFyIHJlYWRPbmx5ID0gaW5pdERhdGEucmVhZE9ubHkgfHwgdGhpcy5yZWFkT25seTsNCg0KICAgICAgICB2YXIgc3R5bGUgPSBpbml0RGF0YS5zdHlsZSB8fCB0aGlzLnN0eWxlOw0KDQogICAgICAgIHZhciBpdGVtcyA9IGluaXREYXRhLml0ZW1zIHx8IHRoaXMuaXRlbXM7DQoNCiAgICAgICAgdmFyIGV2ZW50TWFwID0gaW5pdERhdGEuZXZlbnRNYXAgfHwgdGhpcy5ldmVudE1hcDsNCg0KICAgICAgICB2YXIgc3VwcG9ydEV2ZW50cyA9IGluaXREYXRhLnN1cHBvcnRFdmVudHMgfHwgdGhpcy5zdXBwb3J0RXZlbnRzOw0KDQogICAgICAgIHZhciBhbGlnblN0ciA9ICc8L2JyPic7DQoNCiAgICAgICAgdmFyIGNvbnRlbnQgPVtdOw0KDQogICAgICAgIGlmKGl0ZW1zICYmIGl0ZW1zLmxlbmd0aD09MCkNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHJldHVybiAiPGlucHV0IHR5cGU9J3JhZGlvJyBuYW1lPSciK25hbWUrIicgY2xhc3M9JyIrY2xhc3NOYW1lKyInIHN0eWxlPSciK3N0eWxlKyInIHZhbHVlPSciKyB0ZXh0ICsiJyAvPiI7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGlmKHN0eWxlKQ0KDQogICAgICAgIHsNCg0KICAgICAgICAgICAgdmFyIHJlZyA9IC9eLipob3Jpem9udGFsXHMqOlxzKihcdyopOyouKiQvOw0KDQogICAgICAgICAgICB2YXIgbWF0Y2hBcnJheSA9IHJlZy5leGVjKHN0eWxlKTsNCg0KICAgICAgICAgICAgaWYobWF0Y2hBcnJheSAhPSBudWxsKQ0KDQogICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICBpZihtYXRjaEFycmF5WzFdID09J3RydWUnKQ0KDQogICAgICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgICAgIGFsaWduU3RyID0gJyc7DQoNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICB9DQoNCiAgICAgICAgZm9yKHZhciBpPTA7aTxpdGVtcy5sZW5ndGg7aSsrKXsNCg0KICAgICAgICAgICAgdmFyIHJhZGlvID0gaXRlbXNbaV07DQoNCiAgICAgICAgICAgIHZhciByYWRpb0VsZW1lbnRTdHIgPSAiPGlucHV0IHR5cGU9J3JhZGlvJyBuYW1lPSciK25hbWUrIicgdmFsdWU9JyIrcmFkaW8udmFsdWUrIicgY2xhc3M9JyIrY2xhc3NOYW1lKyInICAiOw0KDQogICAgICAgICAgICByYWRpb0VsZW1lbnRTdHIgKz0gKHJhZGlvLnZhbHVlID09IHRleHQgPyAnIGNoZWNrZWQgJzonJyk7DQoNCiAgICAgICAgICAgIHJhZGlvRWxlbWVudFN0ciArPSB0aGlzLmV2ZW50c1RvSFRNTChldmVudE1hcCxzdXBwb3J0RXZlbnRzKSsnIC8+JzsNCg0KICAgICAgICAgICAgcmFkaW9FbGVtZW50U3RyICs9IChyYWRpby50ZXh0IHx8IHJhZGlvLmxhYmVsKTsgIA0KDQogICAgICAgICAgICByYWRpb0VsZW1lbnRTdHIgKz0gKCcmbmJzcDsnK2FsaWduU3RyKTsgDQoNCiAgICAgICAgICAgIGNvbnRlbnQucHVzaChyYWRpb0VsZW1lbnRTdHIpOw0KDQogICAgICAgIH0gIA0KDQogICAgICAgIHJldHVybiBjb250ZW50LmpvaW4oIiIpOw0KDQogICAgfSwNCg0KDQoNCg0KICAgIGN1c3RvbWl6ZUhUTUwgOiBmdW5jdGlvbihkYXRhKSB7DQoNCiAgICAgICAgICAgICAgICANCg0KICAgIH0sDQoNCg0KDQogICAgcGFyc2VTaWJsaW5nVmFsdWUgOiBmdW5jdGlvbihzaWJsaW5nKSB7DQoNCg0KICAgICAgICByZXR1cm4gc2libGluZy52YWx1ZTsNCg0KDQogICAgfSwNCg0KDQoNCiAgICBhZGREZWZhdWx0RXZlbnQgOiBmdW5jdGlvbigpIHsNCg0KICAgICAgICANCg0KICAgIH0NCg0KDQp9KTsNCg0KDQpXaWRnZXRNYW5hZ2VyLnJlZ2lzdGVyV2lkZ2V0KCJyYWRpbyIsVUkuUmFkaW8pOw0KDQoNCldpZGdldE1hbmFnZXIucmVnaXN0ZXJXaWRnZXQoInNpbmdsZV9zZWxlY3QiLFVJLlJhZGlvKTsNCg0KLyoqDQoNCiAqIA0KDQogKiBWMzYwIEZpbGU6IExpbmsuanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOiA8PEdlbmVyYWwgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzPj4NCg0KICogDQoNCiAqIE5vdGVzOiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqLw0KDQoNClVJLkxpbmsgPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNCg0KVUkuTGluay5leHRlbmQoIHsNCg0KDQoJaWRQcmV2aW91cyA6ICJsaW5rLSIsDQoNCg0KCWluaXQgOiBmdW5jdGlvbihjb25maWcpIHsNCg0KCQl0aGlzLmlkID0gY29uZmlnLmlkIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLm5hbWUgPSBjb25maWcubmFtZSB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy50ZXh0ID0gY29uZmlnLnRleHQgfHwgIiI7DQoNCgkJdGhpcy5hY2Nlc3NLZXkgPSBjb25maWcuYWNjZXNzS2V5IHx8ICIiOw0KDQoJCXRoaXMuZGlzYWJsZWQgPSBjb25maWcuZGlzYWJsZWQgfHwgZmFsc2U7DQoNCgkJdGhpcy5ocmVmID0gY29uZmlnLmhyZWYgfHwgIiI7DQoNCgkJdGhpcy5zdHlsZSA9IGNvbmZpZy5zdHlsZSB8fCAiIjsNCg0KCQl0aGlzLnRhcmdldCA9IGNvbmZpZy50YXJnZXQgfHwgIiI7DQoNCgkJdGhpcy50YWJJbmRleCA9IGNvbmZpZy50YWJJbmRleDsNCg0KCQl0aGlzLnRpdGxlID0gY29uZmlnLnRpdGxlIHx8ICIiOw0KDQoJCXRoaXMuY29udGFpbklkID0gY29uZmlnLmNvbnRhaW5JZDsNCg0KCQl0aGlzLndpZHRoID0gdGhpcy5wYXJzZVdpZHRoKHRoaXMuc3R5bGUpOw0KDQoJCQ0KDQogICAgICAgIGlmICghQWMzNjAudmFsaWRhdG9yLmlzRW1wdHkoY29uZmlnLmxlbmd0aFJlc3RyaWN0ZWQpICYmIGNvbmZpZy5sZW5ndGhSZXN0cmljdGVkICA9PSAiZmFsc2UiKQ0KDQogICAgICAgIHsNCg0KICAgICAgICAgICAgdGhpcy5sZW5ndGhSZXN0cmljdGVkID0gZmFsc2U7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGVsc2UNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHRoaXMubGVuZ3RoUmVzdHJpY3RlZCA9IHRydWU7DQoNCiAgICAgICAgfQ0KDQoNCgkJdGhpcy5ldmVudE1hcCA9IGNvbmZpZy5ldmVudE1hcCB8fCB7fTsNCg0KCQl0aGlzLnN1cHBvcnRFdmVudHMgPSBjb25maWcuc3VwcG9ydEV2ZW50cyB8fCBbICJjaGFuZ2UiLCAiY2xpY2siIF07DQoNCgkJdGhpcy5jbGFzc05hbWUgPSBjb25maWcuY2xhc3NOYW1lOw0KDQoJfSwNCg0KDQoJcmVuZGVyIDogZnVuY3Rpb24oKSB7DQoNCgkJdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7DQoNCgkJbGluay5pZCA9IHRoaXMuaWQ7DQoNCgkJbGluay5uYW1lID0gdGhpcy5uYW1lOw0KDQoJCWlmICh0aGlzLmhyZWYpIHsNCg0KCQkJbGluay5ocmVmID0gdGhpcy5ocmVmOw0KDQoJCX0NCg0KCQlpZiAodGhpcy50ZXh0KSB7DQoNCgkJCWxpbmsuaW5uZXJIVE1MID0gdGhpcy50ZXh0Ow0KDQoJCQlpZih0aGlzLmxlbmd0aFJlc3RyaWN0ZWQgJiYgdGhpcy53aWR0aCkNCg0KCQkJbGluay5pbm5lckhUTUwgPSBBYzM2MC5mb3JtYXRUb01heExlbmd0aChsaW5rLmlubmVySFRNTCx0aGlzLndpZHRoLHRydWUpOw0KDQoJCX0NCg0KCQlpZiAodGhpcy50aXRsZSkgew0KDQoJCQlsaW5rLnRpdGxlID0gdGhpcy50aXRsZTsNCg0KCQl9DQoNCgkJaWYgKHRoaXMuYWNjZXNzS2V5KSB7DQoNCgkJCWxpbmsuYWNjZXNzS2V5ID0gdGhpcy5hY2Nlc3NLZXk7DQoNCgkJfQ0KDQoJCWlmICh0aGlzLmRpc2FibGVkKSB7DQoNCgkJCWxpbmsuZGlzYWJsZWQgPSB0aGlzLmRpc2FibGVkOw0KDQoJCX0NCg0KCQlpZiAodGhpcy5zdHlsZSkgew0KDQoJCQlsaW5rLnN0eWxlID0gdGhpcy5zdHlsZTsNCg0KCQl9DQoNCgkJaWYgKHRoaXMudGFyZ2V0KSB7DQoNCgkJCWxpbmsudGFyZ2V0ID0gdGhpcy50YXJnZXQ7DQoNCgkJfQ0KDQoJCWlmICh0aGlzLnRhYkluZGV4KSB7DQoNCgkJCWxpbmsudGFiSW5kZXggPSB0aGlzLnRhYkluZGV4Ow0KDQoJCX0NCg0KCQlpZiAodGhpcy5jbGFzc05hbWUpIHsNCg0KCQkJbGluay5jbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZTsNCg0KCQl9DQoNCgkJdGhpcy5iaW5kRXZlbnRzKGlucHV0LCB0aGlzLmV2ZW50TWFwLCB0aGlzLnN1cHBvcnRFdmVudHMpOw0KDQoJCXZhciBjb250YWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5jb250YWluSWQpOw0KDQoJCWNvbnRhaW4uYXBwZW5kQ2hpbGQobGluayk7DQoNCgl9LA0KDQoNCglnZXRPdXRlckhUTUwgOiBmdW5jdGlvbihkYXRhKSB7DQoNCgkJdmFyIGluaXREYXRhID0gZGF0YSB8fCB7fTsNCg0KCQl2YXIgdGV4dCA9IGluaXREYXRhLnRleHQgfHwgdGhpcy50ZXh0Ow0KDQoJCWlmIChBYzM2MC52YWxpZGF0b3IuaXNFbXB0eSh0ZXh0KSkNCg0KCQl7DQoNCgkJICAgIHJldHVybiAiIjsNCg0KCQl9DQoNCgkJDQoNCgkJdmFyIGlkID0gaW5pdERhdGEuaWQgfHwgdGhpcy5pZDsNCg0KCQl2YXIgbmFtZSA9IGluaXREYXRhLm5hbWUgfHwgaWQ7DQoNCgkJdmFyIHRpdGxlID0gaW5pdERhdGEudGl0bGUgfHwgdGhpcy50aXRsZTsNCg0KCQl2YXIgaHJlZiA9IGluaXREYXRhLmhyZWYgfHwgdGhpcy5ocmVmOw0KDQoJCXZhciBhY2Nlc3NLZXkgPSBpbml0RGF0YS5hY2Nlc3NLZXkgfHwgdGhpcy5hY2Nlc3NLZXk7DQoNCgkJdmFyIHRhYkluZGV4ID0gaW5pdERhdGEudGFiSW5kZXggfHwgdGhpcy50YWJJbmRleDsNCg0KCQl2YXIgZGlzYWJsZWQgPSBpbml0RGF0YS5kaXNhYmxlZCB8fCB0aGlzLmRpc2FibGVkOw0KDQoJCXZhciB0YXJnZXQgPSBpbml0RGF0YS50YXJnZXQgfHwgdGhpcy50YXJnZXQ7DQoNCgkJdmFyIHN0eWxlID0gaW5pdERhdGEuc3R5bGUgfHwgdGhpcy5zdHlsZTsNCg0KCQl2YXIgZXZlbnRNYXAgPSBpbml0RGF0YS5ldmVudE1hcCB8fCB0aGlzLmV2ZW50TWFwOw0KDQoJCXZhciBzdXBwb3J0RXZlbnRzID0gaW5pdERhdGEuc3VwcG9ydEV2ZW50cyB8fCB0aGlzLnN1cHBvcnRFdmVudHM7DQoNCgkJdmFyIHdpZHRoID0gdGhpcy5wYXJzZVdpZHRoKHN0eWxlKTsNCg0KCQkNCg0KICAgICAgICB2YXIgbGVuZ3RoUmVzdHJpY3RlZCA9IHRydWU7DQoNCiAgICAgICAgaWYgKCFBYzM2MC52YWxpZGF0b3IuaXNFbXB0eShpbml0RGF0YS5sZW5ndGhSZXN0cmljdGVkKSAmJiBpbml0RGF0YS5sZW5ndGhSZXN0cmljdGVkICA9PSAiZmFsc2UiKQ0KDQogICAgICAgIHsNCg0KICAgICAgICAgICAgbGVuZ3RoUmVzdHJpY3RlZCA9IGZhbHNlOw0KDQogICAgICAgIH0NCg0KDQoJCXZhciBjbGFzc05hbWUgPSBpbml0RGF0YS5jbGFzc05hbWUgfHwgdGhpcy5jbGFzc05hbWU7DQoNCgkJdmFyIGNvbnRlbnQgPSBuZXcgQXJyYXkoKTsNCg0KCQkvLyBjbGVhciBsaW5rIHdpZHRoLCBhdm9pZCBibGFuayBhcmVhIGxpbmsgDQoNCgkJaWYgKHdpZHRoKQ0KDQoJCXsNCg0KCQkJdmFyIHNwYW5XaWR0aFB0biA9IC93aWR0aFxzKjpccyooXGQrKVs7IF0qL2dpOw0KDQoJCQlzdHlsZSA9IHN0eWxlLnJlcGxhY2Uoc3BhbldpZHRoUHRuLCAiIik7DQoNCgkJCWNvbnRlbnQucHVzaCgiPHNwYW4gc3R5bGU9J3dpZHRoOiIpOw0KDQoJCQljb250ZW50LnB1c2god2lkdGgpOw0KDQoJCQljb250ZW50LnB1c2goIicgaWQ9JyIpOw0KDQoJCQljb250ZW50LnB1c2godGhpcy5pZFByZXZpb3VzICsgVXRpbC5pbmNyZWFzZSgpKTsNCg0KCQkJY29udGVudC5wdXNoKCInPiIpOwkNCg0KCQl9DQoNCgkJDQoNCgkJY29udGVudC5wdXNoKCI8YSBpZD0nIik7DQoNCgkJY29udGVudC5wdXNoKGlkKTsNCg0KCQljb250ZW50LnB1c2goIicgbmFtZT0nIik7DQoNCgkJY29udGVudC5wdXNoKG5hbWUpOw0KDQoJCWlmIChocmVmKSB7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyBocmVmPSciKTsNCg0KCQkJY29udGVudC5wdXNoKGhyZWYpOw0KDQoJCX0NCg0KCQlpZiAodGl0bGUpIHsNCg0KCQkJY29udGVudC5wdXNoKCInIHRpdGxlPSciKTsNCg0KCQkJY29udGVudC5wdXNoKHRpdGxlKTsNCg0KCQl9DQoNCgkJaWYgKGFjY2Vzc0tleSkgew0KDQoJCQljb250ZW50LnB1c2goIicgYWNjZXNzS2V5PSciKTsNCg0KCQkJY29udGVudC5wdXNoKGFjY2Vzc0tleSk7DQoNCgkJfQ0KDQoJCWlmICh0YWJJbmRleCkgew0KDQoJCQljb250ZW50LnB1c2goIicgdGFiSW5kZXg9JyIpOw0KDQoJCQljb250ZW50LnB1c2godGFiSW5kZXgpOw0KDQoJCX0NCg0KCQlpZiAodGFyZ2V0KSB7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyB0YXJnZXQ9JyIpOw0KDQoJCQljb250ZW50LnB1c2godGFyZ2V0KTsNCg0KCQl9DQoNCgkJaWYgKHN0eWxlKSB7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyBzdHlsZT0nIik7DQoNCgkJCWNvbnRlbnQucHVzaChzdHlsZSk7DQoNCgkJfQ0KDQoJCWNvbnRlbnQucHVzaCgiJyIpOw0KDQoJCWlmIChkaXNhYmxlZCkgew0KDQoJCQljb250ZW50LnB1c2goIiBkaXNhYmxlZD0nZGlzYWJsZWQnIik7DQoNCgkJfQ0KDQoJCWlmKGxlbmd0aFJlc3RyaWN0ZWQgJiYgd2lkdGgpDQoNCgkJew0KDQoJCQljb250ZW50LnB1c2goVUkuVGlwLmFwcGVuZFRpcCh0ZXh0KSk7DQoNCgkJCXRleHQgPSBBYzM2MC5mb3JtYXRUb01heExlbmd0aCh0ZXh0LHdpZHRoLHRydWUpOw0KDQoJCX0NCg0KCQlpZihjbGFzc05hbWUpew0KDQoJCQljb250ZW50LnB1c2goIiBjbGFzcz0nIik7DQoNCgkJCWNvbnRlbnQucHVzaChjbGFzc05hbWUpOw0KDQoJCQljb250ZW50LnB1c2goIiciKTsNCg0KCQl9DQoNCgkJY29udGVudC5wdXNoKHRoaXMuZXZlbnRzVG9IVE1MKGV2ZW50TWFwLHN1cHBvcnRFdmVudHMpKTsNCg0KCQljb250ZW50LnB1c2goIj4iKTsNCg0KCQkNCg0KCQljb250ZW50LnB1c2godGV4dCk7DQoNCgkJDQoNCgkJY29udGVudC5wdXNoKCI8L2E+Iik7DQoNCgkJaWYgKHdpZHRoKQ0KDQoJCXsNCg0KCQkJY29udGVudC5wdXNoKCI8L3NwYW4+Iik7DQoNCgkJfQ0KDQoJCXJldHVybiBjb250ZW50LmpvaW4oIiIpOw0KDQoJfSwNCg0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKSB7DQoNCg0KCX0NCg0KDQp9KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgibGluayIsVUkuTGluayk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IEhpZGRlbi5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuDQoNCiAqIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246DQoNCiAqIDw8R2VuZXJhbCBkZXNjcmlwdGlvbiBvZiB0aGUgY2xhc3M+Pg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICoNCg0KICovDQoNCg0KVUkuSGlkZGVuID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClVJLkhpZGRlbi5leHRlbmQoew0KDQoJDQoNCglpZFByZXZpb3VzIDogImhpZGRlbi0iLA0KDQoJDQoNCglpbml0IDogZnVuY3Rpb24oY29uZmlnKXsNCg0KCQl0aGlzLmlkID0gY29uZmlnLmlkIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLm5hbWUgPSBjb25maWcubmFtZSB8fCB0aGlzLmlkOw0KDQoJCXRoaXMudmFsdWUgPSBjb25maWcudmFsdWUgfHwgIiI7DQoNCgkJdGhpcy5jbGFzc05hbWUgPSBjb25maWcuY2xhc3NOYW1lIHx8ICIiOw0KDQoJCXRoaXMuc3R5bGUgPSBjb25maWcuc3R5bGU7DQoNCgkJdGhpcy5jb250YWluSWQgPSBjb25maWcuY29udGFpbklkOw0KDQoJfSwNCg0KCQ0KDQoJcmVuZGVyIDogZnVuY3Rpb24oKXsNCg0KCQl2YXIgaGlkZGVuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCg0KCQloaWRkZW4udHlwZSA9ICJoaWRkZW4iOw0KDQoJCWhpZGRlbi5pZCA9IHRoaXMuaWQ7DQoNCgkJaGlkZGVuLm5hbWUgPSB0aGlzLm5hbWU7DQoNCgkJaWYodGhpcy52YWx1ZSl7DQoNCgkJCWhpZGRlbi52YWx1ZSA9IHRoaXMudmFsdWU7DQoNCgkJfQ0KDQoJCWlmKHRoaXMuY2xhc3NOYW1lKXsNCg0KCQkJaGlkZGVuLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lOw0KDQoJCX0NCg0KCQlpZih0aGlzLnN0eWxlKXsNCg0KCQkJaGlkZGVuLnN0eWxlID0gdGhpcy5zdHlsZTsNCg0KCQl9DQoNCgkJdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuY29udGFpbklkKTsNCg0KCQljb250YWluZXIuYXBwZW5kQ2hpbGQoaGlkZGVuKTsNCg0KCX0sDQoNCgkNCg0KCWdldE91dGVySFRNTCA6IGZ1bmN0aW9uKGRhdGEpew0KDQoJCXZhciBpbml0RGF0YSA9IGRhdGEgfHwge307DQoNCgkJdmFyIHZhbHVlID0gaW5pdERhdGEudmFsdWUgfHwgIiI7DQoNCgkJdmFyIG5hbWUgPSBpbml0RGF0YS5uYW1lIHx8IHRoaXMubmFtZTsNCg0KCQl2YXIgaWQgPSBpbml0RGF0YS5pZCB8fCB0aGlzLmlkOw0KDQoJCXZhciBjbGFzc05hbWUgPSBpbml0RGF0YS5jbGFzc05hbWUgfHwgdGhpcy5jbGFzc05hbWU7DQoNCgkJdmFyIHN0eWxlID0gaW5pdERhdGEuc3R5bGUgfHwgdGhpcy5zdHlsZTsNCg0KCQl2YXIgY29udGVudCA9IG5ldyBBcnJheSgpOw0KDQoJCWNvbnRlbnQucHVzaCgiPGlucHV0IHR5cGU9aGlkZGVuIGlkPSciKTsNCg0KCQljb250ZW50LnB1c2goaWQpOw0KDQoJCWNvbnRlbnQucHVzaCgiJyBuYW1lPSciKQ0KDQoJCWNvbnRlbnQucHVzaChuYW1lKTsNCg0KCQlpZih2YWx1ZSl7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyB2YWx1ZT0nIik7DQoNCgkJCWNvbnRlbnQucHVzaCh2YWx1ZSk7DQoNCgkJfQ0KDQoJCWlmKGNsYXNzTmFtZSl7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyBjbGFzc05hbWU9JyIpOw0KDQoJCQljb250ZW50LnB1c2goY2xhc3NOYW1lKTsNCg0KCQl9DQoNCgkJaWYoc3R5bGUpew0KDQoJCQljb250ZW50LnB1c2goIicgc3R5bGU9JyIpOw0KDQoJCQljb250ZW50LnB1c2goc3R5bGUpOw0KDQoJCX0NCg0KCQljb250ZW50LnB1c2goIicvPiIpOw0KDQoJCXJldHVybiBjb250ZW50LmpvaW4oIiIpOw0KDQoJfSwNCg0KCQ0KDQoJcGFyc2VTaWJsaW5nVmFsdWUgOiBmdW5jdGlvbihzaWJsaW5nKXsNCg0KCQlyZXR1cm4gc2libGluZy52YWx1ZTsNCg0KCX0sDQoNCgkNCg0KCWFkZERlZmF1bHRFdmVudCA6IGZ1bmN0aW9uKCl7DQoNCgkJDQoNCgl9DQoNCgkNCg0KfSk7DQoNCldpZGdldE1hbmFnZXIucmVnaXN0ZXJXaWRnZXQoImhpZGRlbiIsVUkuSGlkZGVuKTsNCg0KLyoqDQoNCiAqIA0KDQogKiBWMzYwCSANCg0KICogRmlsZTogRm9udC5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuDQoNCiAqIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246DQoNCiAqIDw8R2VuZXJhbCBkZXNjcmlwdGlvbiBvZiB0aGUgY2xhc3M+Pg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICoNCg0KICovDQoNCg0KVUkuRm9udCA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KDQpVSS5Gb250LmV4dGVuZCh7DQoNCgkNCg0KCWlkUHJldmlvdXMgOiAiZm9udC0iLA0KDQoJDQoNCglpbml0IDogZnVuY3Rpb24oY29uZmlnKXsNCg0KCQl0aGlzLmlkID0gY29uZmlnLmlkIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLm5hbWUgPSBjb25maWcubmFtZSB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy50ZXh0ID0gY29uZmlnLnRleHQgfHwgIiI7DQoNCgkJdGhpcy5hY2Nlc3NLZXkgPSBjb25maWcuYWNjZXNzS2V5IHx8ICIiOw0KDQoJCXRoaXMuY2xhc3NOYW1lID0gY29uZmlnLmNsYXNzTmFtZSB8fCAiIjsNCg0KCQl0aGlzLnN0eWxlID0gY29uZmlnLnN0eWxlIHx8ICIiOw0KDQoJCXRoaXMudGFiSW5kZXggPSBjb25maWcudGFiSW5kZXggfHwgIiI7DQoNCgkJdGhpcy5kaXNhYmxlZCA9IGNvbmZpZy5kaXNhYmxlZCB8fCBmYWxzZTsNCg0KCQl0aGlzLmNvbG9yID0gY29uZmlnLmNvbG9yIHx8ICIiOw0KDQoJCXRoaXMuY29udGFpbmVySWQgPSBjb25maWcuY29udGFpbmVySWQ7DQoNCgkJdGhpcy53aWR0aCA9IHRoaXMucGFyc2VXaWR0aCh0aGlzLnN0eWxlKTsNCg0KCQkNCg0KICAgICAgICBpZiAoIUFjMzYwLnZhbGlkYXRvci5pc0VtcHR5KGNvbmZpZy5sZW5ndGhSZXN0cmljdGVkKSAmJiBjb25maWcubGVuZ3RoUmVzdHJpY3RlZCAgPT0gImZhbHNlIikNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHRoaXMubGVuZ3RoUmVzdHJpY3RlZCA9IGZhbHNlOw0KDQogICAgICAgIH0NCg0KICAgICAgICBlbHNlDQoNCiAgICAgICAgew0KDQogICAgICAgICAgICB0aGlzLmxlbmd0aFJlc3RyaWN0ZWQgPSB0cnVlOw0KDQogICAgICAgIH0NCg0KDQoJCXRoaXMuZXZlbnRNYXAgPSBjb25maWcuZXZlbnRNYXAgfHwge307DQoNCgkJdGhpcy5zdXBwb3J0RXZlbnRzID0gY29uZmlnLnN1cHBvcnRFdmVudHMgfHwgWyJtb3VzZWVudGVyIiwgIm1vdXNlb3V0IiwgIm9ubW91c2VvdmVyIl07DQoNCgl9LA0KDQoJDQoNCglyZW5kZXIgOiBmdW5jdGlvbigpew0KDQoJCXZhciBmb250ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9udCcpOw0KDQoJCWZvbnQubmFtZSA9IHRoaXMubmFtZTsNCg0KCQlmb250LmlkID0gdGhpcy5pZDsNCg0KCQlpZih0aGlzLnRleHQpew0KDQoJCQlmb250LmlubmVySFRNTCA9IHRoaXMudGV4dDsNCg0KCQkJaWYodGhpcy5sZW5ndGhSZXN0cmljdGVkICYmIHRoaXMud2lkdGgpDQoNCgkJCWZvbnQuaW5uZXJIVE1MID0gQWMzNjAuZm9ybWF0VG9NYXhMZW5ndGgoZm9udC5pbm5lckhUTUwsdGhpcy53aWR0aCx0cnVlKTsNCg0KCQl9DQoNCgkJaWYodGhpcy5hY2Nlc3NLZXkpew0KDQoJCQlmb250LmFjY2Vzc0tleSA9IHRoaXMuYWNjZXNzS2V5Ow0KDQoJCX0NCg0KCQlpZih0aGlzLmNsYXNzTmFtZSl7DQoNCgkJCWZvbnQuY2xhc3NOYW1lID0gdGhpcy5jbGFzc05hbWU7DQoNCgkJfQ0KDQoJCWlmKHRoaXMuc3R5bGUpew0KDQoJCQlmb250LnN0eWxlID0gdGhpcy5zdHlsZTsNCg0KCQl9DQoNCgkJaWYodGhpcy50YWJJbmRleCl7DQoNCgkJCWZvbnQudGFiSW5kZXggPSB0aGlzLnRhYkluZGV4Ow0KDQoJCX0NCg0KCQlpZih0aGlzLmRpc2FibGVkKXsNCg0KCQkJZm9udC5kaXNhYmxlZCA9IHRoaXMuZGlzYWJsZWQ7DQoNCgkJfQ0KDQoJCWlmKHRoaXMuY29sb3Ipew0KDQoJCQlmb250LmNvbG9yID0gdGhpcy5jb2xvcjsNCg0KCQl9DQoNCgkJdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuY29udGFpbmVySWQpOw0KDQoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChmb250KTsNCg0KCX0sDQoNCg0KCWdldE91dGVySFRNTCA6IGZ1bmN0aW9uKGRhdGEpew0KDQoJCXZhciBpbml0RGF0YSA9IGRhdGEgfHwge307DQoNCgkJdmFyIHRleHQgPSBpbml0RGF0YS50ZXh0IHx8ICIiOw0KDQoJCXZhciBpZCA9IGluaXREYXRhLmlkIHx8IHRoaXMuaWQ7DQoNCgkJdmFyIG5hbWUgPSBpbml0RGF0YS5uYW1lIHx8IGlkOw0KDQoJCXZhciBjbGFzc05hbWUgPSBpbml0RGF0YS5jbGFzc05hbWUgfHwgdGhpcy5jbGFzc05hbWU7DQoNCgkJdmFyIHRhYkluZGV4ID0gaW5pdERhdGEudGFiSW5kZXggfHwgdGhpcy50YWJJbmRleDsNCg0KCQl2YXIgYWNjZXNza2V5ID0gaW5pdERhdGEuYWNjZXNza2V5IHx8IHRoaXMuYWNjZXNza2V5Ow0KDQoJCXZhciBzdHlsZSA9IGluaXREYXRhLnN0eWxlIHx8IHRoaXMuc3R5bGU7DQoNCgkJdmFyIGRpc2FibGVkID0gaW5pdERhdGEuZGlzYWJsZWQgfHwgdGhpcy5kaXNhYmxlZDsNCg0KCQl2YXIgY29sb3IgPSBpbml0RGF0YS5jb2xvciB8fCB0aGlzLmNvbG9yOw0KDQoJCXZhciB3aWR0aCA9IHRoaXMucGFyc2VXaWR0aChzdHlsZSk7DQoNCgkJdmFyIGV2ZW50TWFwID0gaW5pdERhdGEuZXZlbnRNYXAgfHwgdGhpcy5ldmVudE1hcDsNCg0KCQl2YXIgc3VwcG9ydEV2ZW50cyA9IGluaXREYXRhLnN1cHBvcnRFdmVudHMgfHwgdGhpcy5zdXBwb3J0RXZlbnRzOw0KDQoJCQ0KDQoJCXZhciBsZW5ndGhSZXN0cmljdGVkID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoIUFjMzYwLnZhbGlkYXRvci5pc0VtcHR5KGluaXREYXRhLmxlbmd0aFJlc3RyaWN0ZWQpICYmIGluaXREYXRhLmxlbmd0aFJlc3RyaWN0ZWQgID09ICJmYWxzZSIpDQoNCiAgICAgICAgew0KDQogICAgICAgICAgICBsZW5ndGhSZXN0cmljdGVkID0gZmFsc2U7DQoNCiAgICAgICAgfQ0KDQoNCgkJDQoNCgkJdmFyIGNvbnRlbnQgPSBuZXcgQXJyYXkoKTsNCg0KCQljb250ZW50LnB1c2goIjxmb250IGlkPSciKTsNCg0KCQljb250ZW50LnB1c2goaWQpOw0KDQoJCWNvbnRlbnQucHVzaCgiJyBuYW1lPSciKTsNCg0KCQljb250ZW50LnB1c2gobmFtZSk7DQoNCgkJaWYoY2xhc3NOYW1lKXsNCg0KCQkJY29udGVudC5wdXNoKCInIGNsYXNzPSciKTsNCg0KCQkJY29udGVudC5wdXNoKGNsYXNzTmFtZSk7DQoNCgkJfQ0KDQoJCWlmKHRhYkluZGV4KXsNCg0KCQkJY29udGVudC5wdXNoKCInIHRhYkluZGV4PSciKTsNCg0KCQkJY29udGVudC5wdXNoKHRhYkluZGV4KTsNCg0KCQl9DQoNCgkJaWYoYWNjZXNza2V5KXsNCg0KCQkJY29udGVudC5wdXNoKCInIGFjY2Vzc0tleT0nIik7DQoNCgkJCWNvbnRlbnQucHVzaChhY2Nlc3NLZXkpOw0KDQoJCX0NCg0KCQlpZihzdHlsZSl7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyBzdHlsZT0nIik7DQoNCgkJCWNvbnRlbnQucHVzaChzdHlsZSk7DQoNCgkJfQ0KDQoJCWlmKGNvbG9yKXsNCg0KCQkJY29udGVudC5wdXNoKCInIGNvbG9yPSciKTsNCg0KCQkJY29udGVudC5wdXNoKGNvbG9yKTsNCg0KCQl9DQoNCgkJY29udGVudC5wdXNoKCInIik7DQoNCgkJaWYoZGlzYWJsZWQpew0KDQoJCQljb250ZW50LnB1c2goIiBkaXNhYmxlZD0nZGlzYWJsZWQnIik7DQoNCgkJfQ0KDQoJCWlmKGxlbmd0aFJlc3RyaWN0ZWQgJiYgd2lkdGgpDQoNCgkJew0KDQoJCQljb250ZW50LnB1c2goVUkuVGlwLmFwcGVuZFRpcCh0ZXh0KSk7DQoNCgkJCXRleHQgPSBBYzM2MC5mb3JtYXRUb01heExlbmd0aCh0ZXh0LHdpZHRoLHRydWUpOw0KDQoJCX0NCg0KCQkNCg0KCQljb250ZW50LnB1c2godGhpcy5ldmVudHNUb0hUTUwoZXZlbnRNYXAsc3VwcG9ydEV2ZW50cykpOw0KDQoJCWNvbnRlbnQucHVzaCgiPiIpOw0KDQoJCWNvbnRlbnQucHVzaCh0ZXh0KTsNCg0KCQljb250ZW50LnB1c2goIjwvZm9udD4iKTsNCg0KCQlyZXR1cm4gY29udGVudC5qb2luKCIiKTsNCg0KCX0sDQoNCgkNCg0KCXBhcnNlU2libGluZ1ZhbHVlIDogZnVuY3Rpb24oc2libGluZyl7DQoNCgkJcmV0dXJuIHNpYmxpbmcuaW5uZXJIVE1MOw0KDQoJfSwNCg0KCQ0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKXsNCg0KCQkNCg0KCX0NCg0KCQ0KDQp9KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgiZm9udCIsVUkuRm9udCk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MCBGaWxlOiBGaWxlLmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4gQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKiANCg0KICovDQoNCg0KVUkuRmlsZSA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KDQpVdGlsLmV4dGVuZChVSS5GaWxlLFVJLkJhc2VJbnB1dCwgew0KDQoNCglpZFByZXZpb3VzIDogImZpbGUtIiwNCg0KDQoJY3VzdG9taXplSW5wdXQgOiBmdW5jdGlvbihpbnB1dCkgew0KDQoJCWlucHV0LnR5cGUgPSAnZmlsZSc7DQoNCgkJcmV0dXJuIGlucHV0Ow0KDQoJfSwNCg0KDQoJY3VzdG9taXplSFRNTCA6IGZ1bmN0aW9uKGRhdGEpIHsNCg0KCQlyZXR1cm4gInR5cGU9J2ZpbGUnIjsNCg0KCX0sDQoNCg0KCXBhcnNlU2libGluZ1ZhbHVlIDogZnVuY3Rpb24oc2libGluZykgew0KDQoJCXJldHVybiBzaWJsaW5nLnZhbHVlOw0KDQoJfSwNCg0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKSB7DQoNCg0KCX0NCg0KDQp9KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgiZmlsZSIsVUkuRmlsZSk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IEltYWdlLmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjoNCg0KICogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczoNCg0KICogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKg0KDQogKi8NCg0KDQpVSS5JbWFnZSA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KDQpVSS5JbWFnZS5leHRlbmQoew0KDQoJDQoNCglpZFByZXZpb3VzIDogImltYWdlLSIsDQoNCgkNCg0KCWluaXQgOiBmdW5jdGlvbihjb25maWcpew0KDQoJCXRoaXMubmFtZSA9IGNvbmZpZy5uYW1lIHx8ICIiOw0KDQoJCXRoaXMuaWQgPSBjb25maWcuaWQgfHwgdGhpcy5nZXRJZCgpOw0KDQoJCXRoaXMuY29udGFpbmVySWQgPSBjb25maWcuY29udGFpbmVySWQ7DQoNCgkJdGhpcy5jbGFzc05hbWUgPSBjb25maWcuY2xhc3NOYW1lIHx8ICIiOw0KDQoJCXRoaXMuYWNjZXNzS2V5ID0gY29uZmlnLmFjY2Vzc0tleSB8fCAiIjsNCg0KCQl0aGlzLmFsdCA9IGNvbmZpZy5hbHQgfHwgIiI7DQoNCgkJdGhpcy5zdHlsZSA9IGNvbmZpZy5zdHlsZSB8fCAiIjsNCg0KCQl0aGlzLnRhYkluZGV4ID0gY29uZmlnLnRhYkluZGV4Ow0KDQoJCXRoaXMudGl0bGUgPSBjb25maWcudGl0bGUgfHwgIiI7DQoNCgkJdGhpcy52c3BhY2UgPSBjb25maWcudnNwYWNlOw0KDQoJCXRoaXMuaHNwYWNlID0gY29uZmlnLmhzcGFjZTsNCg0KCQl0aGlzLnNyYyA9IGNvbmZpZy5zcmMgfHwgIiI7DQoNCgkJdGhpcy5ldmVudE1hcCA9IGNvbmZpZy5ldmVudE1hcCB8fCB7fTsNCg0KCQl0aGlzLnN1cHBvcnRFdmVudHMgPSBjb25maWcuc3VwcG9ydEV2ZW50cyB8fCBbImNsaWNrIiwgIm1vdXNlb3ZlciIsICJtb3VzZW91dCIsICJtb3VzZW1vdmUiXTsNCg0KCX0sDQoNCgkNCg0KCXJlbmRlciA6IGZ1bmN0aW9uKCl7DQoNCgkJdmFyIGltZ05vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsNCg0KCQlpbWdOb2RlLmlkID0gdGhpcy5pZDsNCg0KCQlpbWdOb2RlLm5hbWUgPSB0aGlzLm5hbWU7DQoNCgkJaWYodGhpcy5zcmMpew0KDQoJCQlpbWdOb2RlLnNyYyA9ICh0aGlzLnNyYy5pbmRleE9mKHRoaXMuZW52aXJvbm1lbnQud2ViUGF0aCk+PTApP3RoaXMuc3JjOih0aGlzLmVudmlyb25tZW50LndlYlBhdGgrdGhpcy5zcmMpOw0KDQoJCX0NCg0KCQlpZih0aGlzLmNsYXNzTmFtZSl7DQoNCgkJCWltZ05vZGUuY2xhc3NOYW1lID0gdGhpcy5jbGFzc05hbWU7DQoNCgkJfQ0KDQoJCWlmKHRoaXMuYWx0KXsNCg0KCQkJaW1nTm9kZS5hbHQgPSB0aGlzLmFsdDsNCg0KCQl9DQoNCgkJaWYodGhpcy5zdHlsZSl7DQoNCgkJCWltZ05vZGUuc3R5bGUgPSB0aGlzLnN0eWxlOw0KDQoJCX0NCg0KCQlpZih0aGlzLnRhYkluZGV4KXsNCg0KCQkJaW1nTm9kZS50YWJJbmRleCA9IHRoaXMudGFiSW5kZXg7DQoNCgkJfQ0KDQoJCWlmKHRoaXMudGl0bGUpew0KDQoJCQlpbWdOb2RlLnRpdGxlID0gdGhpcy50aXRsZTsNCg0KCQl9DQoNCgkJaWYodGhpcy52c3BhY2Upew0KDQoJCQlpbWdOb2RlLnZzcGFjZSA9IHRoaXMudnNwYWNlOw0KDQoJCX0NCg0KCQlpZih0aGlzLmhzcGFjZSl7DQoNCgkJCWltZ05vZGUuaHNwYWNlID0gdGhpcy5oc3BhY2U7DQoNCgkJfQ0KDQoJCXRoaXMuYmluZEV2ZW50cyhpbWdOb2RlLHRoaXMuZXZlbnRNYXAsdGhpcy5zdXBwb3J0RXZlbnRzKTsNCg0KCQl2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5jb250YWluZXJJZCk7DQoNCgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGltZ05vZGUpOw0KDQoJfSwNCg0KCQ0KDQoJZ2V0T3V0ZXJIVE1MIDogZnVuY3Rpb24oZGF0YSl7DQoNCgkJdmFyIGluaXREYXRhID0gZGF0YSB8fCB7fTsNCg0KCQl2YXIgaWQgPSBpbml0RGF0YS5pZCB8fCB0aGlzLmlkOw0KDQoJCXZhciBjbGFzc05hbWUgPSBpbml0RGF0YS5jbGFzc05hbWUgfHwgdGhpcy5jbGFzc05hbWU7DQoNCgkJdmFyIG5hbWUgPSBpbml0RGF0YS5uYW1lIHx8IGlkOw0KDQoJCXZhciBzcmMgPSBpbml0RGF0YS5zcmMgfHwgdGhpcy5zcmM7DQoNCgkJc3JjID0gKHNyYy5pbmRleE9mKHRoaXMuZW52aXJvbm1lbnQud2ViUGF0aCk+PTApP3NyYzoodGhpcy5lbnZpcm9ubWVudC53ZWJQYXRoK3NyYyk7DQoNCgkJdmFyIHRhYkluZGV4ID0gaW5pdERhdGEudGFiSW5kZXggfHwgdGhpcy50YWJJbmRleDsNCg0KCQl2YXIgdGl0bGUgPSBpbml0RGF0YS50aXRsZSB8fCB0aGlzLnRpdGxlOw0KDQoJCXZhciBoc3BhY2UgPSBpbml0RGF0YS5oc3BhY2UgfHwgdGhpcy5oc3BhY2U7DQoNCgkJdmFyIHZzcGFjZSA9IGluaXREYXRhLnZzcGFjZSB8fCB0aGlzLnZzcGFjZTsNCg0KCQl2YXIgYWx0ID0gaW5pdERhdGEuYWx0IHx8IHRoaXMuYWx0Ow0KDQoJCXZhciBzdHlsZSA9IGluaXREYXRhLnN0eWxlIHx8IHRoaXMuc3R5bGU7DQoNCgkJdmFyIGV2ZW50TWFwID0gaW5pdERhdGEuZXZlbnRNYXAgfHwgdGhpcy5ldmVudE1hcDsNCg0KCQl2YXIgc3VwcG9ydEV2ZW50cyA9IGluaXREYXRhLnN1cHBvcnRFdmVudHMgfHwgdGhpcy5zdXBwb3J0RXZlbnRzOw0KDQoJCXZhciBldmVudFRvSHRtbCA9IHRoaXMuZXZlbnRzVG9IVE1MKGV2ZW50TWFwLHN1cHBvcnRFdmVudHMpOw0KDQoJCXZhciBjbGlja0V2ZW50VG9IdG1sID0gdGhpcy5ldmVudHNUb0hUTUwoZXZlbnRNYXAsWyJjbGljayJdKTsNCg0KCQkNCg0KCQl2YXIgaW1nQnVpbGRlciA9IG5ldyBBcnJheSgpOw0KDQogICAgICAgIGltZ0J1aWxkZXIucHVzaCgiPGEgaHJlZj0namF2YXNjcmlwdDp2b2lkKDApOyciKTsNCg0KICAgICAgICBpbWdCdWlsZGVyLnB1c2goY2xpY2tFdmVudFRvSHRtbCk7DQoNCiAgICAgICAgaW1nQnVpbGRlci5wdXNoKCI+Iik7DQoNCg0KCQlpbWdCdWlsZGVyLnB1c2goIjxpbWcgaWQ9JyIpOw0KDQoJCWltZ0J1aWxkZXIucHVzaChpZCk7DQoNCgkJaW1nQnVpbGRlci5wdXNoKCInIG5hbWU9JyIpOw0KDQoJCWltZ0J1aWxkZXIucHVzaChuYW1lKTsNCg0KCQlpZihjbGFzc05hbWUpew0KDQoJCQlpbWdCdWlsZGVyLnB1c2goIicgY2xhc3M9JyIpOw0KDQoJCQlpbWdCdWlsZGVyLnB1c2goY2xhc3NOYW1lKTsNCg0KCQl9DQoNCgkJaWYoc3JjKXsNCg0KCQkJaW1nQnVpbGRlci5wdXNoKCInIHNyYz0nIik7DQoNCgkJCWltZ0J1aWxkZXIucHVzaChzcmMpOw0KDQoJCX0NCg0KCQlpZih0YWJJbmRleCl7DQoNCgkJCWltZ0J1aWxkZXIucHVzaCgiJyB0YWJJbmRleD0nIik7DQoNCgkJCWltZ0J1aWxkZXIucHVzaCh0YWJJbmRleCk7DQoNCgkJfQ0KDQoJCWlmKGhzcGFjZSl7DQoNCgkJCWltZ0J1aWxkZXIucHVzaCgiJyBoc3BhY2U9JyIpOw0KDQoJCQlpbWdCdWlsZGVyLnB1c2goaHNwYWNlKTsNCg0KCQl9DQoNCgkJaWYodnNwYWNlKXsNCg0KCQkJaW1nQnVpbGRlci5wdXNoKCInIHZzcGFjZT0nIik7DQoNCgkJCWltZ0J1aWxkZXIucHVzaCh2c3BhY2UpOw0KDQoJCX0NCg0KCQlpZih0aXRsZSl7DQoNCgkJCWltZ0J1aWxkZXIucHVzaCgiJyB0aXRsZT0nIik7DQoNCgkJCWltZ0J1aWxkZXIucHVzaCh0aXRsZSk7DQoNCgkJfQ0KDQoJCWlmKGFsdCl7DQoNCgkJCWltZ0J1aWxkZXIucHVzaCgiJyBhbHQ9JyIpOw0KDQoJCQlpbWdCdWlsZGVyLnB1c2goYWx0KTsNCg0KCQl9DQoNCgkJaWYoc3R5bGUpew0KDQoJCQlpbWdCdWlsZGVyLnB1c2goIicgc3R5bGU9JyIpOw0KDQoJCQlpbWdCdWlsZGVyLnB1c2goc3R5bGUpOw0KDQoJCQlpbWdCdWlsZGVyLnB1c2goIjtib3JkZXI6bm9uZTsiKTsNCg0KCQl9IGVsc2Ugew0KDQogICAgICAgICAgICBpbWdCdWlsZGVyLnB1c2goIicgc3R5bGU9J2JvcmRlcjpub25lOyIpOw0KDQogICAgICAgIH0NCg0KCQlpbWdCdWlsZGVyLnB1c2goIiciKTsNCg0KCQlpbWdCdWlsZGVyLnB1c2godGhpcy5ldmVudHNUb0hUTUwoZXZlbnRNYXAsc3VwcG9ydEV2ZW50cykpOw0KDQoJCWltZ0J1aWxkZXIucHVzaCgiLz4iKTsNCg0KICAgICAgICBpbWdCdWlsZGVyLnB1c2goIjwvYT4iKTsJCQ0KDQoJCXJldHVybiBpbWdCdWlsZGVyLmpvaW4oIiIpOw0KDQoJfSwNCg0KCQ0KDQoJcGFyc2VTaWJsaW5nVmFsdWUgOiBmdW5jdGlvbihzaWJsaW5nKXsNCg0KCQlyZXR1cm4gc2libGluZy5zcmM7DQoNCgl9LA0KDQoJDQoNCglhZGREZWZhdWx0RXZlbnQgOiBmdW5jdGlvbigpew0KDQoJCQ0KDQoJfQ0KDQoJDQoNCn0pOw0KDQpXaWRnZXRNYW5hZ2VyLnJlZ2lzdGVyV2lkZ2V0KCJpbWFnZSIsVUkuSW1hZ2UpOw0KDQovKioNCg0KICogDQoNCiAqIFYzNjAJIA0KDQogKiBGaWxlOiBJbWFnZUlucHV0LmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjoNCg0KICogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczoNCg0KICogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKg0KDQogKi8NCg0KDQpVSS5JbWFnZUlucHV0ID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClV0aWwuZXh0ZW5kKFVJLkltYWdlSW5wdXQsVUkuQmFzZUlucHV0LHsNCg0KCQ0KDQoJaWRQcmV2aW91cyA6ICJpbWFnZWlucHV0LSIsDQoNCgkNCg0KCWluaXRJbnB1dCA6IGZ1bmN0aW9uKGNvbmZpZyl7DQoNCgkJdGhpcy5hbHQgPSBjb25maWcuYWx0IHx8ICIiOw0KDQoJCXRoaXMudnNwYWNlID0gY29uZmlnLnZzcGFjZTsNCg0KCQl0aGlzLmhzcGFjZSA9IGNvbmZpZy5oc3BhY2U7DQoNCgkJdGhpcy5zcmMgPSBjb25maWcuc3JjIHx8ICIiOw0KDQoJfSwNCg0KCQ0KDQoJY3VzdG9taXplSW5wdXQgOiBmdW5jdGlvbihpbnB1dCl7DQoNCgkJaW5wdXQudHlwZSA9ICJpbWFnZSI7DQoNCgkJaWYodGhpcy5zcmMpew0KDQoJCQlpbnB1dC5zcmMgPSB0aGlzLnNyYzsNCg0KCQl9DQoNCgkJaWYodGhpcy5hbHQpew0KDQoJCQlpbnB1dC5hbHQgPSB0aGlzLmFsdDsNCg0KCQl9DQoNCgkJaWYodGhpcy52c3BhY2Upew0KDQoJCQlpbnB1dC52c3BhY2UgPSB0aGlzLnZzcGFjZTsNCg0KCQl9DQoNCgkJaWYodGhpcy5oc3BhY2Upew0KDQoJCQlpbnB1dC5oc3BhY2UgPSB0aGlzLmhzcGFjZTsNCg0KCQl9DQoNCgkJcmV0dXJuIGlucHV0Ow0KDQoJfSwNCg0KCQ0KDQoJY3VzdG9taXplSFRNTCA6IGZ1bmN0aW9uKGRhdGEpew0KDQoJCXZhciBpbml0RGF0YSA9IGRhdGEgfHwge307DQoNCgkJdmFyIHNyYyA9IGluaXREYXRhLnNyYyB8fCB0aGlzLnNyYzsNCg0KICAgICAgICBzcmMgPSAoc3JjLmluZGV4T2YodGhpcy5lbnZpcm9ubWVudC53ZWJQYXRoKT49MCk/c3JjOih0aGlzLmVudmlyb25tZW50LndlYlBhdGgrc3JjKTsNCg0KCQl2YXIgaHNwYWNlID0gaW5pdERhdGEuaHNwYWNlIHx8IHRoaXMuaHNwYWNlOw0KDQoJCXZhciB2c3BhY2UgPSBpbml0RGF0YS52c3BhY2UgfHwgdGhpcy52c3BhY2U7DQoNCgkJdmFyIGFsdCA9IGluaXREYXRhLmFsdCB8fCB0aGlzLmFsdDsNCg0KCQl2YXIgY29udGVudCA9IG5ldyBBcnJheSgpOw0KDQoJCWNvbnRlbnQucHVzaCgidHlwZT0naW1hZ2UnIik7DQoNCgkJaWYoc3JjKXsNCg0KCQkJY29udGVudC5wdXNoKCIgc3JjPSciKTsNCg0KCQkJY29udGVudC5wdXNoKHNyYyk7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyIpOw0KDQoJCX0NCg0KCQlpZihoc3BhY2Upew0KDQoJCQljb250ZW50LnB1c2goIiBoc3BhY2U9JyIpOw0KDQoJCQljb250ZW50LnB1c2goaHNwYWNlKTsNCg0KCQkJY29udGVudC5wdXNoKCInIik7DQoNCgkJfQ0KDQoJCWlmKHZzcGFjZSl7DQoNCgkJCWNvbnRlbnQucHVzaCgiIHZzcGFjZT0nIik7DQoNCgkJCWNvbnRlbnQucHVzaCh2c3BhY2UpOw0KDQoJCQljb250ZW50LnB1c2goIiciKTsNCg0KCQl9DQoNCgkJaWYoYWx0KXsNCg0KCQkJY29udGVudC5wdXNoKCIgYWx0PSciKTsNCg0KCQkJY29udGVudC5wdXNoKGFsdCk7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyIpOw0KDQoJCX0NCg0KCQlyZXR1cm4gY29udGVudC5qb2luKCIiKTsNCg0KCX0sDQoNCgkNCg0KCXBhcnNlU2libGluZ1ZhbHVlIDogZnVuY3Rpb24oc2libGluZyl7DQoNCgkJcmV0dXJuIHNpYmxpbmcuc3JjOw0KDQoJfSwNCg0KCQ0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKXsNCg0KCQkNCg0KCX0NCg0KCQ0KDQp9KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgiaW1hZ2VfaW5wdXQiLFVJLkltYWdlSW5wdXQpOw0KDQovKioNCg0KICogDQoNCiAqIFYzNjAgRmlsZTogUGFzc3dvcmQuanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOiA8PEdlbmVyYWwgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzPj4NCg0KICogDQoNCiAqIE5vdGVzOiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqIA0KDQogKi8NCg0KDQpVSS5QYXNzd29yZCA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KDQpVdGlsLmV4dGVuZChVSS5QYXNzd29yZCxVSS5CYXNlSW5wdXQsIHsNCg0KDQoJaWRQcmV2aW91cyA6ICJwYXNzd29yZC0iLA0KDQoNCglpbml0SW5wdXQgOiBmdW5jdGlvbihjb25maWcpIHsNCg0KCQl0aGlzLnZhbHVlID0gY29uZmlnLnZhbHVlIHx8ICIiOw0KDQoJfSwNCg0KDQoJY3VzdG9taXplSW5wdXQgOiBmdW5jdGlvbihpbnB1dCkgew0KDQoJCWlucHV0LnR5cGUgPSAncGFzc3dvcmQnOw0KDQoJCWlmICh0aGlzLnZhbHVlKSB7DQoNCgkJCWlucHV0LnZhbHVlID0gdGhpcy52YWx1ZTsNCg0KCQl9DQoNCgkJcmV0dXJuIGlucHV0Ow0KDQoJfSwNCg0KDQoJY3VzdG9taXplSFRNTCA6IGZ1bmN0aW9uKGRhdGEpIHsNCg0KCQl2YXIgaW5pdERhdGEgPSBkYXRhIHx8IHt9Ow0KDQoJCXZhciB2YWx1ZSA9IGluaXREYXRhLnZhbHVlIHx8IHRoaXMudmFsdWU7DQoNCgkJdmFyIGNvbnRlbnQgPSBuZXcgQXJyYXkoKTsNCg0KCQljb250ZW50LnB1c2goInR5cGU9J3Bhc3N3b3JkJyIpOw0KDQoJCWlmICh2YWx1ZSkgew0KDQoJCQljb250ZW50LnB1c2goIiB2YWx1ZT0nIik7DQoNCgkJCWNvbnRlbnQucHVzaCh2YWx1ZSk7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyIpOw0KDQoJCX0NCg0KCQlyZXR1cm4gY29udGVudC5qb2luKCIiKTsNCg0KCX0sDQoNCg0KCXBhcnNlU2libGluZ1ZhbHVlIDogZnVuY3Rpb24oc2libGluZykgew0KDQoJCXJldHVybiBzaWJsaW5nLnZhbHVlOw0KDQoJfSwNCg0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKSB7DQoNCg0KCX0NCg0KDQp9KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgicGFzc3dvcmQiLFVJLlBhc3N3b3JkKTsNCg0KLyoqDQoNCiAqIA0KDQogKiBWMzYwIEZpbGU6IFJlc2V0LmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4gQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKiANCg0KICovDQoNCg0KVUkuUmVzZXQgPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNCg0KVXRpbC5leHRlbmQoVUkuUmVzZXQsVUkuQmFzZUlucHV0LCB7DQoNCg0KCWlkUHJldmlvdXMgOiAicmVzZXQtIiwNCg0KDQoJaW5pdElucHV0IDogZnVuY3Rpb24oY29uZmlnKSB7DQoNCgkJdGhpcy52YWx1ZSA9IGNvbmZpZy52YWx1ZSB8fCAiIjsNCg0KCQl0aGlzLnN1cHBvcnRFdmVudHMgPSBjb25maWcuc3VwcG9ydEV2ZW50cyB8fCBbICJjbGljayIgXTsNCg0KCX0sDQoNCg0KCWN1c3RvbWl6ZUlucHV0IDogZnVuY3Rpb24oaW5wdXQpIHsNCg0KCQlpbnB1dC50eXBlID0gJ3Jlc2V0JzsNCg0KCQlpZiAodGhpcy52YWx1ZSkgew0KDQoJCQlpbnB1dC52YWx1ZSA9IHRoaXMudmFsdWU7DQoNCgkJfQ0KDQoJCXJldHVybiBpbnB1dDsNCg0KCX0sDQoNCg0KCWN1c3RvbWl6ZUhUTUwgOiBmdW5jdGlvbihkYXRhKSB7DQoNCgkJdmFyIGluaXREYXRhID0gZGF0YSB8fCB7fTsNCg0KCQl2YXIgdmFsdWUgPSBpbml0RGF0YS52YWx1ZSB8fCB0aGlzLnZhbHVlOw0KDQoJCXZhciBjb250ZW50ID0gbmV3IEFycmF5KCk7DQoNCgkJY29udGVudC5wdXNoKCJ0eXBlPSdyZXNldCciKTsNCg0KCQlpZiAodmFsdWUpIHsNCg0KCQkJY29udGVudC5wdXNoKCIgdmFsdWU9JyIpOw0KDQoJCQljb250ZW50LnB1c2godmFsdWUpOw0KDQoJCQljb250ZW50LnB1c2goIiciKTsNCg0KCQl9DQoNCgkJcmV0dXJuIGNvbnRlbnQuam9pbigiIik7DQoNCgl9LA0KDQoNCglwYXJzZVNpYmxpbmdWYWx1ZSA6IGZ1bmN0aW9uKHNpYmxpbmcpIHsNCg0KCQlyZXR1cm4gc2libGluZy52YWx1ZTsNCg0KCX0sDQoNCg0KCWFkZERlZmF1bHRFdmVudCA6IGZ1bmN0aW9uKCkgew0KDQoNCgl9DQoNCg0KfSk7DQoNCldpZGdldE1hbmFnZXIucmVnaXN0ZXJXaWRnZXQoInJlc2V0IixVSS5SZXNldCk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MCBGaWxlOiBTdWJtaXQuanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOiA8PEdlbmVyYWwgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzPj4NCg0KICogDQoNCiAqIE5vdGVzOiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqIA0KDQogKi8NCg0KDQpVSS5TdWJtaXQgPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNCg0KVXRpbC5leHRlbmQoVUkuU3VibWl0LFVJLkJhc2VJbnB1dCwgew0KDQoNCglpZFByZXZpb3VzIDogInN1Ym1pdC0iLA0KDQoNCglpbml0SW5wdXQgOiBmdW5jdGlvbihjb25maWcpIHsNCg0KCQl0aGlzLnZhbHVlID0gY29uZmlnLnZhbHVlIHx8ICIiOw0KDQoJCXRoaXMuc3VwcG9ydEV2ZW50cyA9IGNvbmZpZy5zdXBwb3J0RXZlbnRzIHx8IFsgImNsaWNrIiBdOw0KDQoJfSwNCg0KCQ0KDQoJY3VzdG9taXplSW5wdXQgOiBmdW5jdGlvbihpbnB1dCkgew0KDQoJCWlucHV0LnR5cGUgPSAnc3VibWl0JzsNCg0KCQlpbnB1dC52YWx1ZSA9IHRoaXMudmFsdWU7DQoNCgkJcmV0dXJuIGlucHV0Ow0KDQoJfSwNCg0KDQoJY3VzdG9taXplSFRNTCA6IGZ1bmN0aW9uKGRhdGEpIHsNCg0KCQl2YXIgaW5pdERhdGEgPSBkYXRhIHx8IHt9Ow0KDQoJCXZhciB2YWx1ZSA9IGluaXREYXRhLnZhbHVlIHx8IHRoaXMudmFsdWU7DQoNCgkJdmFyIGNvbnRlbnQgPSBuZXcgQXJyYXkoKTsNCg0KCQljb250ZW50LnB1dCgidHlwZT0nc3VibWl0JyIpOw0KDQoJCWlmICh2YWx1ZSkgew0KDQoJCQljb250ZW50LnB1c2goIiB2YWx1ZT0nIik7DQoNCgkJCWNvbnRlbnQucHVzaCh2YWx1ZSk7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyIpOw0KDQoJCX0NCg0KCQlyZXR1cm4gY29udGVudC5qb2luKCIiKTsNCg0KCX0sDQoNCg0KCXBhcnNlU2libGluZ1ZhbHVlIDogZnVuY3Rpb24oc2libGluZykgew0KDQoJCXJldHVybiBzaWJsaW5nLnZhbHVlOw0KDQoJfSwNCg0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKSB7DQoNCg0KCX0NCg0KDQp9KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgic3VibWl0IixVSS5TdWJtaXQpOw0KDQovKioNCg0KICogDQoNCiAqIFYzNjAJIA0KDQogKiBGaWxlOiBUZXh0QXJlYS5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuDQoNCiAqIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246DQoNCiAqIDw8R2VuZXJhbCBkZXNjcmlwdGlvbiBvZiB0aGUgY2xhc3M+Pg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICoNCg0KICovDQoNCg0KVUkuVGV4dEFyZWEgPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNCg0KVUkuVGV4dEFyZWEuZXh0ZW5kKHsNCg0KCQ0KDQoJaWRQcmV2aW91cyA6ICJ0ZXh0YXJlYS0iLA0KDQoJDQoNCglpbml0IDogZnVuY3Rpb24oY29uZmlnKXsNCg0KCQl0aGlzLmlkID0gY29uZmlnLmlkIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLm5hbWUgPSBjb25maWcubmFtZSB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy5hY2Nlc3NLZXkgPSBjb25maWcuYWNjZXNzS2V5IHx8ICIiOw0KDQoJCXRoaXMuY2xhc3NOYW1lID0gY29uZmlnLmNsYXNzTmFtZSB8fCAiIjsNCg0KCQl0aGlzLnJlYWRPbmx5ID0gY29uZmlnLnJlYWRPbmx5IHx8IGZhbHNlOw0KDQoJCXRoaXMuZGlzYWJsZWQgPSBjb25maWcuZGlzYWJsZWQgfHwgZmFsc2U7DQoNCgkJdGhpcy53cmFwID0gY29uZmlnLndyYXA7DQoNCgkJdGhpcy50ZXh0ID0gY29uZmlnLnRleHQgfHwgIiI7DQoNCgkJdGhpcy5zdHlsZSA9IGNvbmZpZy5zdHlsZTsNCg0KCQl0aGlzLnRhYkluZGV4ID0gY29uZmlnLnRhYkluZGV4Ow0KDQoJCXRoaXMuY29udGFpbmVySWQgPSBjb25maWcuY29udGFpbmVySWQ7DQoNCgkJdGhpcy5jb2xzID0gY29uZmlnLmNvbHMgfHwgIiI7DQoNCiAgICAgICAgdGhpcy5yb3dzID0gY29uZmlnLnJvd3MgfHwgIiI7DQoNCgkJdGhpcy5ldmVudE1hcCA9IGNvbmZpZy5ldmVudHx8e307DQoNCgkJdGhpcy5rZXlzTWFwID0gY29uZmlnLmtleXNNYXA7DQoNCgkJdGhpcy5zdXBwb3J0RXZlbnRzID0gY29uZmlnLnN1cHBvcnRFdmVudHMgfHwgWyJjaGFuZ2UiXTsNCg0KCQl0aGlzLnNwZWxsQ2hlY2tFbmFibGVkID0gY29uZmlnLnNwZWxsQ2hlY2tFbmFibGVkOw0KDQoJCXRoaXMubG9hZFNwZWxsQ2hlY2tKUygpOw0KDQoNCgl9LA0KDQoJDQoNCglsb2FkU3BlbGxDaGVja0pTIDogZnVuY3Rpb24oKXsNCg0KCQl2YXIgc2NyaXB0Tm9kZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IikgfHwgW107DQoNCgkJdmFyIHNjcmlwdExvYWRlZCA9IGZhbHNlOw0KDQoJCXZhciBzcGVsbENoZWNrSlNQYXRoID0gIi9wb3J0bGV0cy9jb21tb25zL3NwZWxsY2hlY2tlci9zcGVsbGNoZWNrZXItY2FsbGVyLmpzIjsNCg0KCQlmb3IodmFyIGk9MDtpPHNjcmlwdE5vZGVzLmxlbmd0aDtpKyspew0KDQoJCQlpZihzcGVsbENoZWNrSlNQYXRoPT1zY3JpcHROb2Rlc1tpXS5zcmMpew0KDQoJCQkJc2NyaXB0TG9hZGVkID0gdHJ1ZTsNCg0KCQkJCWJyZWFrOw0KDQoJCQl9DQoNCgkJfQ0KDQoJCWlmKCFzY3JpcHRMb2FkZWQpew0KDQoJCQlkb2N1bWVudC53cml0ZSgiPHNjcmlwdCBzcmM9JyIrc3BlbGxDaGVja0pTUGF0aCsiJz48L3NjcmlwdD4iKTsNCg0KCQl9DQoNCgl9LA0KDQoJDQoNCglyZW5kZXIgOiBmdW5jdGlvbigpew0KDQoJCXZhciB0ZXh0QXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7DQoNCgkJdGV4dEFyZWEubmFtZSA9IHRoaXMubmFtZTsNCg0KCQl0ZXh0QXJlYS5pZCA9IHRoaXMuaWQ7DQoNCgkJaWYodGhpcy5jbGFzc05hbWUpew0KDQoJCQl0ZXh0QXJlYS5jbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZTsNCg0KCQl9DQoNCgkJaWYodGhpcy5hY2Nlc3NLZXkpew0KDQoJCQl0ZXh0QXJlYS5hY2Nlc3NLZXkgPSB0aGlzLmFjY2Vzc0tleTsNCg0KCQl9DQoNCgkJaWYodGhpcy50ZXh0KXsNCg0KCQkJdGV4dEFyZWEuaW5uZXJIVE1MID0gdGhpcy50ZXh0Ow0KDQoJCX0NCg0KCQlpZih0aGlzLmRpc2FibGVkKXsNCg0KCQkJdGV4dEFyZWEuZGlzYWJsZWQgPSB0aGlzLmRpc2FibGVkOw0KDQoJCX0NCg0KCQlpZih0aGlzLnJlYWRPbmx5KXsNCg0KCQkJdGV4dEFyZWEucmVhZE9ubHkgPSB0aGlzLnJlYWRPbmx5Ow0KDQoJCX0NCg0KCQlpZih0aGlzLndyYXApew0KDQoJCQl0ZXh0QXJlYS53cmFwID0gdGhpcy53cmFwOw0KDQoJCX0NCg0KCQlpZih0aGlzLnN0eWxlKXsNCg0KCQkJdGV4dEFyZWEuc3R5bGUgPSB0aGlzLnN0eWxlOw0KDQoJCX0NCg0KCQlpZih0aGlzLnRhYkluZGV4KXsNCg0KCQkJdGV4dEFyZWEudGFiSW5kZXggPSB0aGlzLnRhYkluZGV4Ow0KDQoJCX0NCg0KCQl0aGlzLmJpbmRFdmVudHModGV4dEFyZWEsdGhpcy5ldmVudE1hcCx0aGlzLnN1cHBvcnRFdmVudHMpOw0KDQoNCgkJaWYodGhpcy5zcGVsbENoZWNrRW5hYmxlZCAmJiAhcmVhZE9ubHkpew0KDQoJCQl2YXIgc3BlbGxDaGVjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsNCg0KCQkJc3BlbGxDaGVjay5vbmNsaWNrID0gZnVuY3Rpb24oKXtkb1NwZWxsQ2hlY2soIi9wb3J0bGV0cy9jb21tb25zL3NwZWxsY2hlY2tlci8iLCB0aGlzLmlkKX07DQoNCgkJCXNwZWxsQ2hlY2suaHJlZiA9ICJKYXZhU2NyaXB0OnZvaWQoMCkiOw0KDQoJCQlzcGVsbENoZWNrLmlubmVySFRNTCA9IGtleXNNYXAuc3BlbGxjaGVja2VyTGFiZWw7DQoNCgkJCXNwZWxsQ2hlY2suY2xhc3NOYW1lID0gInVpLXRleHRhcmVhLXNwZWxsY2hlY2siOw0KDQoJCQl2YXIgc3BlbGxDaGVja0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KDQoJCQlzcGVsbENoZWNrQ29udGFpbmVyLnN0eWxlLmNsZWFyPSJib3RoIjsNCg0KCQkJc3BlbGxDaGVja0NvbnRhaW5lci5hcHBlbmRDaGlsZChzcGVsbENoZWNrKTsNCg0KCQl9DQoNCgkJdmFyIHRleHRBcmVhQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoNCgkJdGV4dEFyZWFDb250YWluZXIuc3R5bGUuY2xlYXI9ImJvdGgiOw0KDQoJCXRleHRBcmVhQ29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRBcmVhKTsNCg0KCQl2YXIgb3V0ZXN0Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoNCgkJb3V0ZXN0Q29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRBcmVhQ29udGFpbmVyKTsNCg0KCQlpZih0aGlzLnNwZWxsQ2hlY2tFbmFibGVkKXsNCg0KCQkJb3V0ZXN0Q29udGFpbmVyLmFwcGVuZENoaWxkKHNwZWxsQ2hlY2tDb250YWluZXIpOw0KDQoJCX0NCg0KCQl2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5jb250YWluZXJJZCk7DQoNCgkJY29udGFpbmVyLmFwcGVuZENoaWxkKG91dGVzdENvbnRhaW5lcik7DQoNCgl9LA0KDQoJDQoNCglnZXRPdXRlckhUTUwgOiBmdW5jdGlvbihjb25maWcpew0KDQoJCXZhciBpbml0RGF0YSA9IGNvbmZpZyB8fCB7fTsNCg0KCQl2YXIgdGV4dCA9IGluaXREYXRhLnRleHQgfHwgIiI7DQoNCgkJdmFyIGlkID0gaW5pdERhdGEuaWQgfHwgdGhpcy5pZDsNCg0KCQl2YXIgbmFtZSA9IGluaXREYXRhLm5hbWUgfHwgaWQ7DQoNCgkJdmFyIGNsYXNzTmFtZSA9IGluaXREYXRhLmNsYXNzbmFtZSB8fCB0aGlzLmNsYXNzTmFtZTsNCg0KCQlpZiAoY2xhc3NOYW1lID09IG51bGwpDQoNCgkJew0KDQoJCQljbGFzc05hbWUgPSAicG9ydGxldC1mb3JtLWlucHV0LWZpZWxkIjsNCg0KCQl9DQoNCgkJZWxzZSBpZiAoY2xhc3NOYW1lLmluZGV4T2YoInBvcnRsZXQtZm9ybS1pbnB1dC1maWVsZCIpIDwgMCkNCg0KCQl7DQoNCgkJCWNsYXNzTmFtZSA9ICJwb3J0bGV0LWZvcm0taW5wdXQtZmllbGQgIiArIGNsYXNzTmFtZTsNCg0KCQl9DQoNCgkJdmFyIGRpc2FibGVkID0gaW5pdERhdGEuZGlzYWJsZWQgfHwgdGhpcy5kaXNhYmxlZDsNCg0KCQl2YXIgcmVhZE9ubHkgPSBpbml0RGF0YS5yZWFkT25seSB8fCB0aGlzLnJlYWRPbmx5Ow0KDQoJCXZhciB3cmFwID0gaW5pdERhdGEud3JhcCB8fCB0aGlzLndyYXA7DQoNCgkJdmFyIHN0eWxlID0gaW5pdERhdGEuc3R5bGUgfHwgdGhpcy5zdHlsZTsNCg0KCQl2YXIgY29scyA9IGluaXREYXRhLmNvbHMgfHwgdGhpcy5jb2xzOw0KDQoJCXZhciByb3dzID0gaW5pdERhdGEucm93cyB8fCB0aGlzLnJvd3M7DQoNCgkJdmFyIHRhYkluZGV4ID0gaW5pdERhdGEudGFiSW5kZXggfHwgdGhpcy50YWJJbmRleDsNCg0KCQl2YXIgYWNjZXNzS2V5ID0gaW5pdERhdGEuYWNjZXNzS2V5IHx8IHRoaXMuYWNjZXNzS2V5Ow0KDQoJCXZhciBldmVudE1hcCA9IGluaXREYXRhLmV2ZW50IHx8IHRoaXMuZXZlbnRNYXA7DQoNCgkJdmFyIHN1cHBvcnRFdmVudHMgPSBpbml0RGF0YS5zdXBwb3J0RXZlbnRzIHx8IHRoaXMuc3VwcG9ydEV2ZW50czsNCg0KCQl2YXIga2V5c01hcCA9IGluaXREYXRhLmtleXNNYXAgfHwgdGhpcy5rZXlzTWFwOw0KDQoJCXZhciBzcGVsbENoZWNrRW5hYmxlZCA9IGNvbmZpZy5zcGVsbENoZWNrRW5hYmxlZDsNCg0KCQkNCg0KCQl2YXIgY29udGVudCA9IG5ldyBBcnJheSgpOw0KDQoJCWNvbnRlbnQucHVzaCgiPGRpdj48ZGl2IHN0eWxlPSdjbGVhcjpib3RoOyc+PHRleHRhcmVhIGlkPSciKTsNCg0KCQljb250ZW50LnB1c2goaWQpOw0KDQoJCWNvbnRlbnQucHVzaCgiJyBuYW1lPSciKTsNCg0KCQljb250ZW50LnB1c2gobmFtZSk7DQoNCgkJaWYoY2xhc3NOYW1lKXsNCg0KCQkJY29udGVudC5wdXNoKCInIGNsYXNzPSciKTsNCg0KCQkJY29udGVudC5wdXNoKGNsYXNzTmFtZSk7DQoNCgkJfQ0KDQoJCWlmKHdyYXApew0KDQoJCQljb250ZW50LnB1c2goIicgd3JhcD0nIik7DQoNCgkJCWNvbnRlbnQucHVzaCh3cmFwKTsNCg0KCQl9DQoNCgkJaWYoc3R5bGUpew0KDQoJCQljb250ZW50LnB1c2goIicgc3R5bGU9JyIpOw0KDQoJCQljb250ZW50LnB1c2goc3R5bGUpOw0KDQoJCX0NCg0KCQlpZih0YWJJbmRleCl7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyB0YWJJbmRleD0nIik7DQoNCgkJCWNvbnRlbnQucHVzaCh0YWJJbmRleCk7DQoNCgkJfQ0KDQoJCWlmKGFjY2Vzc0tleSl7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyBhY2Nlc3NLZXk9JyIpOw0KDQoJCQljb250ZW50LnB1c2goYWNjZXNzS2V5KTsNCg0KCQl9DQoNCgkJY29udGVudC5wdXNoKCInIik7DQoNCgkJaWYocmVhZE9ubHkpew0KDQoJCQljb250ZW50LnB1c2goIiByZWFkT25seT0ncmVhZE9ubHknIik7DQoNCgkJfQ0KDQoJCWlmKGRpc2FibGVkKXsNCg0KCQkJY29udGVudC5wdXNoKCIgZGlzYWJsZWQ9J2Rpc2FibGVkJyIpOw0KDQoJCX0NCg0KICAgICAgICBpZihyb3dzKXsNCg0KICAgICAgICAgICAgY29udGVudC5wdXNoKCIgcm93cz0nIik7DQoNCiAgICAgICAgICAgIGNvbnRlbnQucHVzaChyb3dzKTsNCg0KICAgICAgICAgICAgY29udGVudC5wdXNoKCInIik7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGlmKGNvbHMpew0KDQogICAgICAgICAgICBjb250ZW50LnB1c2goIiBjb2xzPScnIik7DQoNCiAgICAgICAgICAgIGNvbnRlbnQucHVzaChjb2xzKTsNCg0KICAgICAgICAgICAgY29udGVudC5wdXNoKCInIik7DQoNCiAgICAgICAgfQ0KDQoJCWNvbnRlbnQucHVzaCh0aGlzLmV2ZW50c1RvSFRNTChldmVudE1hcCxzdXBwb3J0RXZlbnRzKSk7DQoNCgkJY29udGVudC5wdXNoKCI+Iik7DQoNCgkJaWYodGV4dCl7DQoNCgkJCWNvbnRlbnQucHVzaCh0ZXh0KTsNCg0KCQl9DQoNCgkJY29udGVudC5wdXNoKCI8L3RleHRhcmVhPjwvZGl2PiIpOw0KDQoJCWlmKHNwZWxsQ2hlY2tFbmFibGVkICYmICFyZWFkT25seSl7DQoNCgkJCWNvbnRlbnQucHVzaCgiPGRpdiBzdHlsZT0nY2xlYXI6Ym90aDsnPjxhIG9uY2xpY2s9XCdKYXZhU2NyaXB0OmRvU3BlbGxDaGVjayhcIi9wb3J0bGV0cy9jb21tb25zL3NwZWxsY2hlY2tlci9cIiwgXCIiKTsNCg0KCQkJY29udGVudC5wdXNoKGlkKTsNCg0KCQkJY29udGVudC5wdXNoKCJcIik7XCcgaHJlZj1cJ0phdmFTY3JpcHQ6dm9pZCgwKVwnIGNsYXNzPSd1aS10ZXh0YXJlYS1zcGVsbGNoZWNrJz4iKQ0KDQoJCQljb250ZW50LnB1c2goa2V5c01hcC5zcGVsbGNoZWNrZXJMYWJlbCk7DQoNCgkJCWNvbnRlbnQucHVzaCgiPC9hPjwvZGl2PiIpOw0KDQoJCX0NCg0KCQljb250ZW50LnB1c2goIjwvZGl2PiIpOw0KDQoJCXJldHVybiBjb250ZW50LmpvaW4oIiIpOw0KDQoJfSwNCg0KCQ0KDQoJcGFyc2VTaWJsaW5nVmFsdWUgOiBmdW5jdGlvbihzaWJsaW5nKXsNCg0KCQkNCg0KCX0sDQoNCgkNCg0KCWFkZERlZmF1bHRFdmVudCA6IGZ1bmN0aW9uKCl7DQoNCgkJDQoNCgl9LA0KDQoJDQoNCgluZWVkVG9FbmNvZGUgOiAnZmFsc2UnLA0KDQoJDQoNCgllbmNvZGUgOiBmdW5jdGlvbih0ZXh0KQ0KDQoJew0KDQoJCXJldHVybiB0ZXh0LnJlcGxhY2UoLyYvZywgIiZhbXA7Iik7DQoNCgl9DQoNCgkNCg0KfSk7DQoNCldpZGdldE1hbmFnZXIucmVnaXN0ZXJXaWRnZXQoInRleHRhcmVhIixVSS5UZXh0QXJlYSk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IFRleHRJbnB1dC5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuDQoNCiAqIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246DQoNCiAqIDw8R2VuZXJhbCBkZXNjcmlwdGlvbiBvZiB0aGUgY2xhc3M+Pg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICoNCg0KICovDQoNCg0KVUkuVGV4dElucHV0ID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClVJLlRleHRJbnB1dC5leHRlbmQoew0KDQoJDQoNCglpZFByZXZpb3VzIDogInRleHRpbnB1dC0iLA0KDQoJDQoNCglpbml0IDogZnVuY3Rpb24oY29uZmlnKXsNCg0KCQl0aGlzLmlkID0gY29uZmlnLmlkIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLm5hbWUgPSBjb25maWcubmFtZSB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy52YWx1ZSA9IGNvbmZpZy52YWx1ZSB8fCAiIjsNCg0KCQl0aGlzLmNvbnRhaW5JZCA9IGNvbmZpZy5jb250YWluSWQ7DQoNCgkJdGhpcy5hY2Nlc3NLZXkgPSBjb25maWcuYWNjZXNzS2V5Ow0KDQoJCXRoaXMuY2xhc3NOYW1lID0gY29uZmlnLmNsYXNzTmFtZTsNCg0KCQl0aGlzLnN0eWxlID0gY29uZmlnLnN0eWxlOw0KDQoJCXRoaXMudGFiSW5kZXggPSBjb25maWcudGFiSW5kZXg7DQoNCgkJdGhpcy50aXRsZSA9IGNvbmZpZy50aXRsZTsNCg0KCQkvKg0KDQoJCSAqIHJ1bGUgZm9ybWF0OiAicmVxdWlyZWQ7cmFuZ2UoMSwyMCkiLCB1c2UgIjsiIGFzIHNlbWljb2xvbi4NCg0KCQkgKiBTdXBwb3J0ZWQgYXR0cmlidXRlczogcmVxdWlyZWQscmFuZ2UuDQoNCgkJICovDQoNCgkJdGhpcy5ydWxlID0gY29uZmlnLnJ1bGU7DQoNCgkJdGhpcy5tc2dMYWJlbFBvcyA9IGNvbmZpZy5tc2dMYWJlbFBvczsNCg0KCQl0aGlzLm1heExlbmd0aCA9IGNvbmZpZy5tYXhMZW5ndGg7DQoNCgkJdGhpcy5yZWFkT25seSA9IGNvbmZpZy5yZWFkT25seTsNCg0KCQl0aGlzLmRpc2FibGVkID0gY29uZmlnLmRpc2FibGVkOw0KDQoJCXRoaXMuYWx0ID0gY29uZmlnLmFsdCB8fCAiIjsNCg0KCQl0aGlzLmV2ZW50TWFwID0gY29uZmlnLmV2ZW50TWFwIHx8IHt9Ow0KDQoJCXRoaXMuc3VwcG9ydEV2ZW50cyA9IGNvbmZpZy5zdXBwb3J0RXZlbnRzIHx8IFsiY2xpY2siLCAiY2hhbmdlIiwia2V5cHJlc3MiXTsNCg0KCX0sDQoNCgkNCg0KCXJlbmRlciA6IGZ1bmN0aW9uKCl7DQoNCgkJdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCg0KCQlpbnB1dC5pZCA9IHRoaXMuaWQ7DQoNCgkJaW5wdXQubmFtZSA9IHRoaXMubmFtZTsNCg0KCQlpZih0aGlzLnZhbHVlKQ0KDQoJCQlpbnB1dC52YWx1ZSA9IHRoaXMudmFsdWU7DQoNCgkJaWYodGhpcy5hY2Nlc3NLZXkpDQoNCgkJCWlucHV0LmFjY2Vzc0tleSA9IHRoaXMuYWNjZXNzS2V5Ow0KDQoJCWlmKHRoaXMuY2xhc3NOYW1lKQ0KDQoJCQlpbnB1dC5jbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZTsNCg0KCQlpZih0aGlzLnN0eWxlKQ0KDQoJCQlpbnB1dC5zdHlsZSA9IHRoaXMuc3R5bGU7DQoNCgkJaWYodGhpcy50YWJJbmRleCkNCg0KCQkJaW5wdXQudGFiSW5kZXggPSB0aGlzLnRhYkluZGV4Ow0KDQoJCWlmKHRoaXMudGl0bGUpDQoNCgkJCWlucHV0LnRpdGxlID0gdGhpcy50aXRsZTsNCg0KCQlpZih0aGlzLnJ1bGUpDQoNCgkJCWlucHV0LnJ1bGUgPSB0aGlzLnJ1bGU7DQoNCgkJaWYodGhpcy5tYXhMZW5ndGgpDQoNCgkJCWlucHV0Lm1heExlbmd0aCA9IHRoaXMubWF4TGVuZ3RoOw0KDQoJCWlmKHRoaXMucmVhZE9ubHkpDQoNCgkJCWlucHV0LnJlYWRPbmx5ID0gdGhpcy5yZWFkT25seTsNCg0KCQlpZih0aGlzLmRpc2FibGVkKQ0KDQoJCQlpbnB1dC5kaXNhYmxlZCA9IHRoaXMuZGlzYWJsZWQ7DQoNCgkJaW5wdXQub25mb2N1cyA9IGZ1bmN0aW9uKCl7IGF2LnZhbGlkYXRpb24uYXR0YWNoQnlFbGVtZW50KGlucHV0KSB9Ow0KDQoJICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmNvbnRhaW5JZCk7DQoNCgkgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGlucHV0KTsNCg0KCSAgICBpZih0aGlzLmV4dHJhUmVuZGVyKXsNCg0KCQkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZXh0cmFSZW5kZXIoKSk7DQoNCgkJfQ0KDQoJCWlmKHRoaXMubXNnTGFiZWxQb3MgfHwgdGhpcy5tc2dMYWJlbFBvcyA9PSAicmlnaHQiKXsNCg0KCQkJdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsNCg0KCQkJbGFiZWwuaWQgPSB0aGlzLmlkKyIqbXNnIjsNCg0KCQkJY29udGFpbmVyLmFwcGVuZENoaWxkKGxhYmVsKTsNCg0KCQl9DQoNCgl9LA0KDQoJDQoNCglnZXRPdXRlckhUTUwgOiBmdW5jdGlvbihkYXRhKXsNCg0KCQl2YXIgaW5pdERhdGEgPSBkYXRhIHx8IHt9Ow0KDQoJCXZhciBpZCA9IGluaXREYXRhLmlkIHx8IHRoaXMuaWQ7DQoNCgkJdmFyIG5hbWUgPSBpbml0RGF0YS5uYW1lIHx8IGlkOw0KDQoJCXZhciB2YWx1ZSA9IGluaXREYXRhLnZhbHVlIHx8IHRoaXMudmFsdWU7DQoNCgkJdmFyIGFjY2Vzc0tleSA9IGluaXREYXRhLmFjY2Vzc0tleSB8fCB0aGlzLmFjY2Vzc0tleTsNCg0KCQl2YXIgY2xhc3NOYW1lID0gaW5pdERhdGEuY2xhc3NOYW1lIHx8IHRoaXMuY2xhc3NOYW1lOw0KDQoJCWlmIChjbGFzc05hbWUgPT0gbnVsbCkNCg0KCQl7DQoNCgkJCWNsYXNzTmFtZSA9ICJwb3J0bGV0LWZvcm0taW5wdXQtZmllbGQiOw0KDQoJCX0NCg0KCQllbHNlIGlmIChjbGFzc05hbWUuaW5kZXhPZigicG9ydGxldC1mb3JtLWlucHV0LWZpZWxkIikgPCAwKQ0KDQoJCXsNCg0KCQkJY2xhc3NOYW1lID0gInBvcnRsZXQtZm9ybS1pbnB1dC1maWVsZCAiICsgY2xhc3NOYW1lOw0KDQoJCX0NCg0KCQl2YXIgc3R5bGUgPSBpbml0RGF0YS5zdHlsZSB8fCB0aGlzLnN0eWxlOw0KDQoJCXZhciB0YWJJbmRleCA9IGluaXREYXRhLnRhYkluZGV4IHx8IHRoaXMudGFiSW5kZXg7DQoNCgkJdmFyIHRpdGxlID0gaW5pdERhdGEudGl0bGUgfHwgdGhpcy50aXRsZTsNCg0KCQl2YXIgcnVsZSA9IGluaXREYXRhLnJ1bGUgfHwgdGhpcy5ydWxlOw0KDQoJCXZhciBtc2dMYWJlbFBvcyA9IGluaXREYXRhLm1zZ0xhYmVsUG9zIHx8IHRoaXMubXNnTGFiZWxQb3M7DQoNCgkJdmFyIG1heExlbmd0aCA9IGluaXREYXRhLm1heExlbmd0aCB8fCB0aGlzLm1heExlbmd0aDsNCg0KCQl2YXIgcmVhZE9ubHkgPSBpbml0RGF0YS5yZWFkT25seSB8fCB0aGlzLnJlYWRPbmx5Ow0KDQoJCXZhciBkaXNhYmxlZCA9IGluaXREYXRhLmRpc2FibGVkIHx8IHRoaXMuZGlzYWJsZWQ7DQoNCgkJdmFyIGV2ZW50TWFwID0gaW5pdERhdGEuZXZlbnRNYXAgfHwgdGhpcy5ldmVudE1hcDsNCg0KCQl2YXIgc3VwcG9ydEV2ZW50cyA9IGluaXREYXRhLnN1cHBvcnRFdmVudHMgfHwgdGhpcy5zdXBwb3J0RXZlbnRzOw0KDQoJCXZhciBjb250ZW50ID0gWyI8aW5wdXQgdHlwZT0ndGV4dCcgaWQ9JyJdOw0KDQoJCWNvbnRlbnQucHVzaChpZCk7DQoNCgkJY29udGVudC5wdXNoKCInIG5hbWU9JyIpOw0KDQoJCWNvbnRlbnQucHVzaChuYW1lKTsNCg0KCQljb250ZW50LnB1c2goIicgIik7DQoNCgkJaWYocnVsZSkNCg0KCQkJcnVsZSA9ICh0aGlzLmlucHV0VHlwZSA/ICh0aGlzLmlucHV0VHlwZSArICI7Iik6IiIpICsgcnVsZTsNCg0KCQllbHNlDQoNCgkJCXJ1bGUgPSB0aGlzLmlucHV0VHlwZTsNCg0KCQkNCg0KCQljb250ZW50LnB1c2goImRhdGEtcnVsZT0nIikNCg0KCQljb250ZW50LnB1c2gocnVsZSk7DQoNCgkJY29udGVudC5wdXNoKCInIik7DQoNCgkJDQoNCgkJaWYobWF4TGVuZ3RoKXsNCg0KCQkJY29udGVudC5wdXNoKCIgbWF4TGVuZ3RoPSciKTsNCg0KCQkJY29udGVudC5wdXNoKG1heExlbmd0aCk7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyIpOw0KDQoJCX0NCg0KCQkNCg0KCQlpZihzdHlsZSl7DQoNCgkJCWNvbnRlbnQucHVzaCgiIHN0eWxlPSciKTsNCg0KCQkJY29udGVudC5wdXNoKHN0eWxlKTsNCg0KCQkJY29udGVudC5wdXNoKCInIik7DQoNCgkJfQ0KDQoJCQ0KDQoJCWlmKGNsYXNzTmFtZSl7DQoNCgkJCWNvbnRlbnQucHVzaCgiIGNsYXNzPSciKTsNCg0KCQkJY29udGVudC5wdXNoKGNsYXNzTmFtZSk7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyIpOw0KDQoJCX0NCg0KCQkNCg0KCQlpZih0YWJJbmRleCl7DQoNCgkJCWNvbnRlbnQucHVzaCgiIHRhYkluZGV4PSciKTsNCg0KCQkJY29udGVudC5wdXNoKHRhYkluZGV4KTsNCg0KCQkJY29udGVudC5wdXNoKCInIik7DQoNCgkJfQ0KDQoJCQ0KDQoJCWlmKHRpdGxlKXsNCg0KCQkJY29udGVudC5wdXNoKCIgdGl0bGU9JyIpOw0KDQoJCQljb250ZW50LnB1c2godGl0bGUpOw0KDQoJCQljb250ZW50LnB1c2goIiciKTsNCg0KCQl9DQoNCgkJDQoNCgkJaWYocmVhZE9ubHkpew0KDQoJCQljb250ZW50LnB1c2goIiByZWFkT25seT0ndHJ1ZSciKTsNCg0KCQl9DQoNCgkJDQoNCgkJaWYoZGlzYWJsZWQpew0KDQoJCQljb250ZW50LnB1c2goIiBkaXNhYmxlZD0ndHJ1ZSciKTsNCg0KCQl9DQoNCgkJDQoNCgkJaWYoYWNjZXNzS2V5KXsNCg0KCQkJY29udGVudC5wdXNoKCIgYWNjZXNzS2V5PSciKTsNCg0KCQkJY29udGVudC5wdXNoKGFjY2Vzc0tleSk7DQoNCgkJCWNvbnRlbnQucHVzaCgiJyIpOw0KDQoJCX0NCg0KCQkNCg0KCQlpZih2YWx1ZSl7DQoNCgkJCWNvbnRlbnQucHVzaCgiIHZhbHVlPSciKTsNCg0KCQkJY29udGVudC5wdXNoKHZhbHVlKTsNCg0KCQkJY29udGVudC5wdXNoKCInIik7DQoNCgkJfQ0KDQoJCWNvbnRlbnQucHVzaCh0aGlzLmV2ZW50c1RvSFRNTChldmVudE1hcCxzdXBwb3J0RXZlbnRzKSk7DQoNCgkJY29udGVudC5wdXNoKCIgb25mb2N1cz0nYXYudmFsaWRhdGlvbi5hdHRhY2hCeUVsZW1lbnQodGhpcyk7JyIpOw0KDQoJCWNvbnRlbnQucHVzaCgiLz4iKTsNCg0KCQkNCg0KCQlpZih0aGlzLmV4dHJhUmVuZGVyKQ0KDQoJCQljb250ZW50LnB1c2godGhpcy5leHRyYUdldE91dGVySFRNTChkYXRhKSk7DQoNCgkJaWYobXNnTGFiZWxQb3MgfHwgbXNnTGFiZWxQb3MgPT0gInJpZ2h0IikNCg0KCQkJY29udGVudC5wdXNoKCI8bGFiZWwgaWQ9JyIgKyBpZCArICIqbXNnJz48L2xhYmVsPiIpOw0KDQoJCXJldHVybiBjb250ZW50LmpvaW4oJycpOw0KDQoJfQ0KDQp9KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgidGV4dF9pbnB1dCIsVUkuVGV4dElucHV0KTsNCg0KDQovL0ludGVnZXIgSW5wdXQNCg0KVUkuSW50SW5wdXQgPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNClV0aWwuZXh0ZW5kKFVJLkludElucHV0LCBVSS5UZXh0SW5wdXQsIHsNCg0KCWlucHV0VHlwZTogImludCINCg0KfSk7DQoNCldpZGdldE1hbmFnZXIucmVnaXN0ZXJXaWRnZXQoImludCIsVUkuSW50SW5wdXQpOw0KDQoNCi8vRmxvYXQgdmFsdWUgSW5wdXQNCg0KVUkuRmxvYXRJbnB1dCA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KVXRpbC5leHRlbmQoVUkuRmxvYXRJbnB1dCwgVUkuVGV4dElucHV0LCB7DQoNCglpbnB1dFR5cGU6ICJmbG9hdCINCg0KfSk7DQoNCldpZGdldE1hbmFnZXIucmVnaXN0ZXJXaWRnZXQoImZsb2F0IixVSS5GbG9hdElucHV0KTsNCg0KDQovL0VtYWlsIHZhbHVlIElucHV0DQoNClVJLkVtYWlsSW5wdXQgPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNClV0aWwuZXh0ZW5kKFVJLkVtYWlsSW5wdXQsIFVJLlRleHRJbnB1dCwgew0KDQoJaW5wdXRUeXBlOiAiZW1haWwiDQoNCn0pOw0KDQpXaWRnZXRNYW5hZ2VyLnJlZ2lzdGVyV2lkZ2V0KCJlbWFpbCIsVUkuRW1haWxJbnB1dCk7DQoNCg0KLy9UaW1lIHZhbHVlIElucHV0DQoNClVJLlRpbWVJbnB1dCA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KVXRpbC5leHRlbmQoVUkuVGltZUlucHV0LCBVSS5UZXh0SW5wdXQsIHsNCg0KCWlucHV0VHlwZTogInRpbWUiDQoNCn0pOw0KDQpXaWRnZXRNYW5hZ2VyLnJlZ2lzdGVyV2lkZ2V0KCJ0aW1lIixVSS5UaW1lSW5wdXQpOw0KDQoNCi8vU2hvcnQgVGltZSB2YWx1ZSBJbnB1dA0KDQpVSS5TaG9ydFRpbWVJbnB1dCA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KVXRpbC5leHRlbmQoVUkuU2hvcnRUaW1lSW5wdXQsIFVJLlRleHRJbnB1dCwgew0KDQoJaW5wdXRUeXBlOiAic2hvcnR0aW1lIg0KDQp9KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgic2hvcnR0aW1lIixVSS5TaG9ydFRpbWVJbnB1dCk7DQoNCg0KLy9EYXRlIHZhbHVlIElucHV0DQoNClVJLkRhdGVJbnB1dCA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KVXRpbC5leHRlbmQoVUkuRGF0ZUlucHV0LCBVSS5UZXh0SW5wdXQsIHsNCg0KCWlucHV0VHlwZTogImRhdGUiLA0KDQoJDQoNCglleHRyYVJlbmRlciA6IGZ1bmN0aW9uKCl7DQoNCgkJdmFyIG5hbWUgPSB0aGlzLm5hbWUgfHwgIiI7DQoNCgkJdmFyIGFsdCA9IHRoaXMuYWx0IHx8ICIiOw0KDQoJCXZhciBzcGFuTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsNCg0KCQl2YXIgbGlua05vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7DQoNCgkJbGlua05vZGUuaHJlZiA9ICIjIjsNCg0KCQlsaW5rTm9kZS5vbmtleWRvd24gPSBmdW5jdGlvbigpew0KDQoJCQlpZihldmVudC5rZXlDb2RlPT0zMikgZXZlbnQua2V5Q29kZT0xMzsNCg0KCQl9Ow0KDQoJCWxpbmtOb2RlLm9uY2xpY2sgPSBmdW5jdGlvbigpew0KDQoJCQlyZXR1cm4gc2VsZWN0RGF0ZShuYW1lKTsNCg0KCQl9Ow0KDQoJCXZhciBpbWFnZU5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsNCg0KCQlpbWFnZU5vZGUuc3JjID0gdGhpcy5lbnZpcm9ubWVudC53ZWJQYXRoKyIvaW1hZ2VzL3NlbGVjdERhdGUuZ2lmIjsNCg0KCQlpYW1nZU5vZGUuYWx0ID0gYWx0Ow0KDQoJCWltYWdlTm9kZS5ib3JkZXIgPSAwOw0KDQoJCXZhciB0ZXh0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCImbmJzcDsiKTsNCg0KCQlsaW5rTm9kZS5hcHBlbmRDaGlsZChpbWFnZU5vZGUpOw0KDQoJCXNwYW5Ob2RlLmFwcGVuZENoaWxkKGxpbmtOb2RlKTsNCg0KCQlzcGFuTm9kZS5hcHBlbmRDaGlsZCh0ZXh0Tm9kZSk7DQoNCgkJcmV0dXJuIHNwYW5Ob2RlOw0KDQoJfSwNCg0KCQ0KDQoJZXh0cmFHZXRPdXRlckhUTUw6IGZ1bmN0aW9uKGRhdGEpew0KDQoJCXZhciBpbml0RGF0YSA9IGRhdGEgfHwge307DQoNCgkJdmFyIG5hbWUgPSBpbml0RGF0YS5uYW1lIHx8IGluaXREYXRhLmlkIHx8IHRoaXMuaWQ7DQoNCgkJdmFyIGFsdCA9IGluaXREYXRhLmFsdCB8fCB0aGlzLmFsdDsNCg0KCQlyZXR1cm4gIjxzcGFuPiZuYnNwOzxhIGhyZWY9JyMnIG9uS2V5RG93bj0naWYoZXZlbnQua2V5Q29kZT09MzIpIGV2ZW50LmtleUNvZGU9MTM7JyBvbmNsaWNrPSdyZXR1cm4gc2VsZWN0RGF0ZShcIiIrIA0KDQoJCW5hbWUgKyAiXCIpJz48aW1nIHNyYz0nIit0aGlzLmVudmlyb25tZW50LndlYlBhdGgrIi9pbWFnZXMvc2VsZWN0RGF0ZS5naWYnIGFsdD0nIithbHQrIicgYm9yZGVyPTAgPjwvYT4mbmJzcDs8L3NwYW4+IjsNCg0KCX0NCg0KfSk7DQoNCldpZGdldE1hbmFnZXIucmVnaXN0ZXJXaWRnZXQoImRhdGUiLFVJLkRhdGVJbnB1dCk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IFNlbGVjdC5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuDQoNCiAqIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246DQoNCiAqIDw8R2VuZXJhbCBkZXNjcmlwdGlvbiBvZiB0aGUgY2xhc3M+Pg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICoNCg0KICovDQoNCg0KVUkuU2VsZWN0ID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClVJLlNlbGVjdC5leHRlbmQoew0KDQoJDQoNCglpZFByZXZpb3VzIDogInNlbGVjdC0iLA0KDQoJDQoNCglpbml0IDogZnVuY3Rpb24oY29uZmlnKXsNCg0KCQl0aGlzLmlkID0gY29uZmlnLmlkIHx8IHRoaXMuZ2V0SWQoKTsNCg0KCQl0aGlzLm5hbWUgPSBjb25maWcubmFtZSB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy5hY2Nlc3NLZXkgPSBjb25maWcuYWNjZXNzS2V5IHx8ICIiOw0KDQoJCXRoaXMuYWxpZ24gPSBjb25maWcuYWxpZ24gfHwgIiI7DQoNCgkJdGhpcy52YWx1ZSA9IGNvbmZpZy52YWx1ZSB8fCAiIjsNCg0KCQl0aGlzLmNsYXNzTmFtZSA9IGNvbmZpZy5jbGFzc05hbWUgfHwgIiI7DQoNCgkJdGhpcy5kaXNhYmxlZCA9IGNvbmZpZy5kaXNhYmxlZCB8fCBmYWxzZTsNCg0KCQl0aGlzLnJlYWRPbmx5ID0gY29uZmlnLnJlYWRPbmx5IHx8IGZhbHNlOw0KDQoJCXRoaXMubXVsdGlwbGUgPSBjb25maWcubXVsdGlwbGUgfHwgZmFsc2U7DQoNCgkJdGhpcy5zdHlsZSA9IGNvbmZpZy5zdHlsZTsNCg0KCQl0aGlzLnRhYkluZGV4ID0gY29uZmlnLnRhYkluZGV4Ow0KDQoJCXRoaXMuaXRlbXMgPSBjb25maWcuaXRlbXMgfHwgW107DQoNCgkJdGhpcy5jb250YWluZXJJZCA9IGNvbmZpZy5jb250YWluZXJJZDsNCg0KCQl0aGlzLmV2ZW50TWFwID0gY29uZmlnLmV2ZW50TWFwfHx7fTsNCg0KCQl0aGlzLnN1cHBvcnRFdmVudHMgPSBjb25maWcuc3VwcG9ydEV2ZW50cyB8fCBbImNoYW5nZSIsImNsaWNrIl07DQoNCgl9LA0KDQoJDQoNCglyZW5kZXIgOiBmdW5jdGlvbigpew0KDQoJCXZhciBzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKTsNCg0KCQlzZWxlY3QubmFtZSA9IHRoaXMubmFtZTsNCg0KCQlzZWxlY3QuaWQgPSB0aGlzLmlkOw0KDQoJCWlmKHRoaXMuY2xhc3NOYW1lKXsNCg0KCQkJc2VsZWN0LmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lOw0KDQoJCX0NCg0KCQlpZih0aGlzLmFjY2Vzc0tleSl7DQoNCgkJCXNlbGVjdC5hY2Nlc3NLZXkgPSB0aGlzLmFjY2Vzc0tleTsNCg0KCQl9DQoNCgkJaWYodGhpcy5hbGlnbil7DQoNCgkJCXNlbGVjdC5hbGlnbiA9IHRoaXMuYWxpZ247DQoNCgkJfQ0KDQoJCWlmKHRoaXMudmFsdWUpew0KDQoJCQlzZWxlY3QudmFsdWUgPSB0aGlzLnZhbHVlOw0KDQoJCX0NCg0KCQlpZih0aGlzLmRpc2FibGVkKXsNCg0KCQkJc2VsZWN0LmRpc2FibGVkID0gdGhpcy5kaXNhYmxlZDsNCg0KCQl9DQoNCgkJaWYodGhpcy5tdWx0aXBsZSl7DQoNCgkJCXNlbGVjdC5tdWx0aXBsZSA9IHRoaXMubXVsdGlwbGU7DQoNCgkJfQ0KDQoJCWlmKHRoaXMuc3R5bGUpew0KDQoJCQlzZWxlY3Quc3R5bGUgPSB0aGlzLnN0eWxlOw0KDQoJCX0NCg0KCQlpZih0aGlzLnRhYkluZGV4KXsNCg0KCQkJc2VsZWN0LnRhYkluZGV4ID0gdGhpcy50YWJJbmRleDsNCg0KCQl9DQoNCgkJDQoNCgkJZm9yKHZhciBpPTA7aTx0aGlzLml0ZW1zLmxlbmd0aDtpKyspew0KDQoJCQl2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7DQoNCgkJCWlmKHRoaXMudmFsdWUgPT0gdGhpcy5pdGVtc1tpXS52YWx1ZSl7DQoNCgkJCQlvcHRpb24uc2VsZWN0ZWQgPSAnc2VsZWN0ZWQnOw0KDQoJCQl9DQoNCgkJCQ0KDQoJCQlvcHRpb24udmFsdWUgPSB0aGlzLml0ZW1zW2ldLnZhbHVlOw0KDQoJCQkNCg0KCQkJaWYodGhpcy5pdGVtc1tpXS50ZXh0IHx8IHRoaXMuaXRlbXNbaV0ubGFiZWwpew0KDQoJCQkJb3B0aW9uLmlubmVySFRNTCA9IHRoaXMuaXRlbXNbaV0udGV4dCB8fCB0aGlzLml0ZW1zW2ldLmxhYmVsOw0KDQoJCQl9DQoNCgkJCXNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pOw0KDQoJCX0NCg0KCQl0aGlzLmJpbmRFdmVudHMoc2VsZWN0LHRoaXMuZXZlbnRNYXAsdGhpcy5zdXBwb3J0RXZlbnRzKTsNCg0KCQl2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5jb250YWluZXJJZCk7DQoNCgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGVjdCk7DQoNCgl9LA0KDQoJDQoNCglnZXRPdXRlckhUTUwgOiBmdW5jdGlvbihjb25maWcpew0KDQoJCXZhciBpbml0RGF0YSA9IGNvbmZpZyB8fCB7fTsNCg0KCQl2YXIgdGV4dCA9IGluaXREYXRhLnZhbHVlIHx8ICIiOw0KDQoJCXZhciBpZCA9IGluaXREYXRhLmlkIHx8IHRoaXMuaWQ7DQoNCgkJdmFyIG5hbWUgPSBpbml0RGF0YS5uYW1lIHx8IGlkOw0KDQoJCXZhciBjbGFzc05hbWUgPSBpbml0RGF0YS5jbGFzc25hbWUgfHwgdGhpcy5jbGFzc05hbWU7DQoNCgkJdmFyIGRpc2FibGVkID0gaW5pdERhdGEuZGlzYWJsZWQgfHwgdGhpcy5kaXNhYmxlZDsNCg0KCQl2YXIgcmVhZE9ubHkgPSBpbml0RGF0YS5yZWFkT25seSB8fCB0aGlzLnJlYWRPbmx5Ow0KDQoJCXZhciBtdWx0aXBsZSA9IGluaXREYXRhLm11bHRpcGxlIHx8IHRoaXMubXVsdGlwbGU7DQoNCgkJdmFyIHN0eWxlID0gaW5pdERhdGEuc3R5bGUgfHwgdGhpcy5zdHlsZTsNCg0KCQl2YXIgdGFiSW5kZXggPSBpbml0RGF0YS50YWJJbmRleCB8fCB0aGlzLnRhYkluZGV4Ow0KDQoJCXZhciBpdGVtcyA9IGluaXREYXRhLml0ZW1zIHx8IHRoaXMuaXRlbXM7DQoNCgkJdmFyIGV2ZW50TWFwID0gaW5pdERhdGEuZXZlbnRNYXAgfHwgdGhpcy5ldmVudE1hcDsNCg0KCQl2YXIgc3VwcG9ydEV2ZW50cyA9IGluaXREYXRhLnN1cHBvcnRFdmVudHMgfHwgdGhpcy5zdXBwb3J0RXZlbnRzOw0KDQoJCXZhciBjb250ZW50ID0gbmV3IEFycmF5KCk7DQoNCgkJY29udGVudC5wdXNoKCI8c2VsZWN0IGlkPSciKTsNCg0KCQljb250ZW50LnB1c2goaWQpOw0KDQoJCWNvbnRlbnQucHVzaCgiJyBuYW1lPSciKTsNCg0KCQljb250ZW50LnB1c2gobmFtZSk7DQoNCgkJaWYoY2xhc3NOYW1lKXsNCg0KCQkJY29udGVudC5wdXNoKCInIGNsYXNzPSciKTsNCg0KCQkJY29udGVudC5wdXNoKGNsYXNzTmFtZSk7DQoNCgkJfQ0KDQoJCWlmKHN0eWxlKXsNCg0KCQkJY29udGVudC5wdXNoKCInIHN0eWxlPSciKTsNCg0KCQkJY29udGVudC5wdXNoKHN0eWxlKTsNCg0KCQl9DQoNCgkJaWYodGFiSW5kZXgpew0KDQoJCQljb250ZW50LnB1c2goIicgdGFiSW5kZXg9JyIpOw0KDQoJCQljb250ZW50LnB1c2godGFiSW5kZXgpOw0KDQoJCX0NCg0KCQljb250ZW50LnB1c2goIiciKTsNCg0KCQlpZihtdWx0aXBsZSl7DQoNCgkJCWNvbnRlbnQucHVzaCgiIG11bHRpcGxlPSdtdWx0aXBsZSciKTsNCg0KCQl9DQoNCgkJaWYoZGlzYWJsZWQgfHwgcmVhZE9ubHkpew0KDQoJCQljb250ZW50LnB1c2goIiBkaXNhYmxlZD0nZGlzYWJsZWQnIik7DQoNCgkJfQ0KDQoJCWNvbnRlbnQucHVzaCh0aGlzLmV2ZW50c1RvSFRNTChldmVudE1hcCxzdXBwb3J0RXZlbnRzKSk7DQoNCgkJY29udGVudC5wdXNoKCI+Iik7DQoNCgkJZm9yKHZhciBpPTA7aTxpdGVtcy5sZW5ndGg7aSsrKXsNCg0KCQkJY29udGVudC5wdXNoKCI8b3B0aW9uICIpOw0KDQoJCQlpZihpdGVtc1tpXS5zZWxlY3RlZCB8fCBpdGVtc1tpXS52YWx1ZT09dGV4dCB8fCBpdGVtc1tpXS52YWx1ZSA9PSBCYXNlSlMuaHRtbERlY29kZSh0ZXh0KSl7DQoNCgkJCQljb250ZW50LnB1c2goIiBzZWxlY3RlZD0nc2VsZWN0ZWQnIik7DQoNCgkJCX0NCg0KCQkJaWYodHlwZW9mIGl0ZW1zW2ldLnZhbHVlID09ICdzdHJpbmcnKXsNCg0KCQkJCWNvbnRlbnQucHVzaCgiIHZhbHVlPSciKTsNCg0KCQkJCWNvbnRlbnQucHVzaChpdGVtc1tpXS52YWx1ZSk7DQoNCgkJCQljb250ZW50LnB1c2goIiciKTsNCg0KCQkJCWNvbnRlbnQucHVzaCgiIHRpdGxlPSciKTsNCg0KCQkJCWNvbnRlbnQucHVzaChpdGVtc1tpXS52YWx1ZSk7DQoNCgkJCQljb250ZW50LnB1c2goIiciKTsNCg0KCQkJfQ0KDQoJCQljb250ZW50LnB1c2goIj4iKTsNCg0KCQkJaWYoaXRlbXNbaV0udGV4dCl7DQoNCgkJCQljb250ZW50LnB1c2goaXRlbXNbaV0udGV4dCB8fCBpdGVtc1tpXS5sYWJlbCk7DQoNCgkJCX0NCg0KCQkJY29udGVudC5wdXNoKCI8L29wdGlvbj4iKTsNCg0KCQl9DQoNCgkJY29udGVudC5wdXNoKCI8L3NlbGVjdD4iKTsNCg0KCQl0aGlzLmFmdGVyUmVuZGVyKGlkKTsNCg0KCQlyZXR1cm4gY29udGVudC5qb2luKCIiKTsNCg0KCX0sDQoNCgkNCg0KCXBhcnNlU2libGluZ1ZhbHVlIDogZnVuY3Rpb24oc2libGluZyl7DQoNCgkJDQoNCgl9LA0KDQoJDQoNCglhZGREZWZhdWx0RXZlbnQgOiBmdW5jdGlvbigpew0KDQoJCQ0KDQoJfSwNCg0KCQ0KDQoJYWZ0ZXJSZW5kZXIgOiBmdW5jdGlvbihzZWxlY3RJRCkNCg0KCXsNCg0KCSAgICANCg0KCX0NCg0KCQ0KDQp9KTsNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgic2VsZWN0IixVSS5TZWxlY3QpOw0KDQpXaWRnZXRNYW5hZ2VyLnJlZ2lzdGVyV2lkZ2V0KCJ1c2VyIixVSS5TZWxlY3QpOw0KDQovKioNCg0KICogDQoNCiAqIFYzNjAJIA0KDQogKiBGaWxlOiBQYWdlTmF2aWdhdG9yLmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjoNCg0KICogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczoNCg0KICogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKg0KDQogKi8NCg0KDQpVSS5QYWdlTmF2aWdhdG9yID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClVJLlBhZ2VOYXZpZ2F0b3IuZXh0ZW5kKHsNCg0KCQ0KDQoJaWRQcmV2aW91cyA6ICJwYWdlbmF2aWdhdG9yLSIsDQoNCgkNCg0KCWluaXQgOiBmdW5jdGlvbihjb25maWcpew0KCQkNCgkJdGhpcy5pZCA9IGNvbmZpZy5pZCB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy5uYW1lID0gY29uZmlnLm5hbWUgfHwgdGhpcy5nZXRJZCgpOw0KDQoJCXRoaXMucGFnZUluZm8gPSBjb25maWcucGFnZUluZm8gfHwge307DQoNCgkJdGhpcy53ZWJQYXRoID0gY29uZmlnLndlYlBhdGggfHwgIiI7DQoNCgkJdGhpcy5tZXNzYWdlID0gY29uZmlnLm1lc3NhZ2UgfHwge307DQoNCgkJdGhpcy5waWN0dXJlVHlwZSA9ICIuZ2lmIjsNCg0KCQl0aGlzLnRoZW1lID0gcHJvZmlsZS50aGVtZSB8fCAiIjsNCg0KCQl0aGlzLnBpY3R1cmVUeXBlID0gIi5wbmciOw0KDQoJfSwNCg0KCQ0KDQoJcmVuZGVyIDogZnVuY3Rpb24oKXsNCg0KCQkNCg0KCX0sDQoNCg0KICAgIGJ1aWxkVXJsIDogIGZ1bmN0aW9uKHBhZ2VJbmZvLCBwYWdlSW5kZXgpIHsNCiAgICAJDQogICAgICAgIHZhciB1cmwgPSBwYWdlSW5mby5wYWdlVXJpOw0KDQogICAgICAgIHZhciBtb2R1bGUgPSBwYWdlSW5mby5tb2R1bGU7DQoNCiAgICAgICAgdmFyIGNvbHVtbiA9IHBhZ2VJbmZvLmNvbHVtbjsNCg0KICAgICAgICB2YXIgb3JkZXIgPSBwYWdlSW5mby5vcmRlcjsNCg0KICAgICAgICB2YXIgcGFyYW1ldGVyU3RyaW5nID0gcGFnZUluZm8ucGFyYW1ldGVyU3RyaW5nOw0KDQoNCiAgICAgICAgdXJsICs9ICI/IiArICJtb2R1bGU9IiArIG1vZHVsZSArICImcGFnZT0iICsgcGFnZUluZGV4Ow0KDQogICAgICAgIGlmIChjb2x1bW4pIHsNCg0KICAgICAgICAgICAgdXJsICs9ICImY29sdW1uPSIgKyBjb2x1bW4gKyAiJm9yZGVyPSIgKyBvcmRlcjsNCg0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHBhcmFtZXRlclN0cmluZykgew0KDQogICAgICAgICAgICB1cmwgKz0gIiYiICsgcGFyYW1ldGVyU3RyaW5nOw0KDQogICAgICAgIH0NCiAgICAgICAgdmFyIHJWYWx1ZTsNCiAgICAgICAgaWYocGFnZUluZGV4PT0nQEAjI0BAJykNCiAgICAgICAgew0KCSAgICAgICAgclZhbHVlID0gIlwiIG9uY2xpY2s9XCJKYXZhU2NyaXB0OiBuZXcgZnVuY3Rpb24oKXsiOw0KCSAgICAgICAgDQoJICAgICAgICByVmFsdWUgKz0gInZhciB1cmw9JyI7DQoJICAgICAgICANCgkgICAgICAgIHJWYWx1ZSArPSB1cmw7DQoJICAgICAgICANCgkgICAgICAgIHJWYWx1ZSArPSAiJzsgdmFyIGluZGV4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZ2UtbmF2aWdhdG9yLWlucHV0LWlkJykudmFsdWU7IjsNCgkgICAgICAgIA0KCSAgICAgICAgclZhbHVlICs9ICJ2YXIgbmV3VVJMPXVybC5yZXBsYWNlKCdAQCMjQEAnLCBpbmRleCk7IjsNCgkgICAgICAgIA0KCSAgICAgICAgclZhbHVlICs9ICJyZXR1cm4gU2ltdWxhdGVDbGljaygnMScsJ2FjY2VsYXN1Ym1pdGJ1dHRvbm5hbWUnLCcnLCdhY3Rpb24nLG5ld1VSTCwgJ3RhcmdldCcsICdfc2VsZicpO31cIiI7DQogICAgICAgIH0NCiAgICAgICAgZWxzZQ0KICAgICAgICB7DQoJICAgICAgICByVmFsdWUgPSAiXCIgb25jbGljaz1cIkphdmFTY3JpcHQ6IHJldHVybiBTaW11bGF0ZUNsaWNrKCcxJywnYWNjZWxhc3VibWl0YnV0dG9ubmFtZScsJycsJ2FjdGlvbicsJyI7DQoJICAgICAgICANCgkgICAgICAgIHJWYWx1ZSArPSB1cmw7ICAgICAgICAgICAgICAgDQoJICAgICAgICANCgkgICAgICAgIHJWYWx1ZSArPSAiJywgJ3RhcmdldCcsICdfc2VsZicpOyI7DQogICAgICAgIH0NCg0KDQogICAgICAgIHJldHVybiByVmFsdWU7DQoNCiAgICB9LA0KDQoNCiAgICBidWlsZExhc3RQYWdlIDogZnVuY3Rpb24ocGFnZUluZm8sIHBhZ2VJbmZvKQ0KDQogICAgew0KDQogICAgICAgcmV0dXJuIHRoaXMuYnVpbGRVcmwocGFnZUluZm8sIHBhZ2VJbmZvLm1heFBhZ2VJbmRleCkgDQoNCiAgICB9LA0KDQoNCglnZXRPdXRlckhUTUwgOiBmdW5jdGlvbihoZWFkQ29udGVjdCwgZm9vdENvbnRlbnQpew0KCQkNCgkJdmFyIGNyZWF0ZUlNR0xpbmsgPSBmdW5jdGlvbihjb25maWcpew0KDQoJCQl2YXIgbGlua0J1aWxkZXIgPSBuZXcgQXJyYXkoKTsNCg0KCQkJbGlua0J1aWxkZXIucHVzaCgiPElNRyBTUkM9XCIiKTsNCg0KCQkJbGlua0J1aWxkZXIucHVzaCh0aGlzLndlYlBhdGgpOy8vDQoNCgkJCWxpbmtCdWlsZGVyLnB1c2goIi9pbWFnZXMvIik7DQoNCgkJCWxpbmtCdWlsZGVyLnB1c2godGhpcy50aGVtZSk7DQoNCgkJCWxpbmtCdWlsZGVyLnB1c2goIi9tZW51LyIpOw0KDQoJCQlsaW5rQnVpbGRlci5wdXNoKGNvbmZpZy5pY29uTmFtZSk7DQoJCQlpZihjb25maWcucGljdHVyZVR5cGUpDQoJCQl7DQoJCQkJbGlua0J1aWxkZXIucHVzaChjb25maWcucGljdHVyZVR5cGUpOw0KCQkJfQ0KCQkJZWxzZQ0KCQkJew0KCQkJCWxpbmtCdWlsZGVyLnB1c2godGhpcy5waWN0dXJlVHlwZSk7DQoJCQl9DQoJCQkNCgkJCWlmKGNvbmZpZy5pY29uSG92ZXIpDQoJCQl7DQoJCQkJbGlua0J1aWxkZXIucHVzaCgiXCIgb25tb3VzZW92ZXI9XCIiKTsNCgkJCQkNCgkJCQlsaW5rQnVpbGRlci5wdXNoKHRoaXMud2ViUGF0aCk7Ly8NCg0KCQkJCWxpbmtCdWlsZGVyLnB1c2goIi9pbWFnZXMvIik7DQoNCgkJCQlsaW5rQnVpbGRlci5wdXNoKHRoaXMudGhlbWUpOw0KDQoJCQkJbGlua0J1aWxkZXIucHVzaCgiL21lbnUvIik7DQoNCgkJCQlsaW5rQnVpbGRlci5wdXNoKGNvbmZpZy5pY29uSG92ZXIpOw0KDQoJCQkJaWYoY29uZmlnLnBpY3R1cmVUeXBlKQ0KCQkJCXsNCgkJCQkJbGlua0J1aWxkZXIucHVzaChjb25maWcucGljdHVyZVR5cGUpOw0KCQkJCX0NCgkJCQllbHNlDQoJCQkJew0KCQkJCQlsaW5rQnVpbGRlci5wdXNoKHRoaXMucGljdHVyZVR5cGUpOw0KCQkJCX0NCgkJCX0NCgkJCQ0KCQkJaWYoY29uZmlnLnN0eWxlKQ0KCQkJew0KCQkJCWxpbmtCdWlsZGVyLnB1c2goIlwiIHN0eWxlPVwiIik7DQoJCQkJDQoJCQkJbGlua0J1aWxkZXIucHVzaChjb25maWcuc3R5bGUpOw0KCQkJCQ0KCQkJfQ0KCQkJDQoJCQlsaW5rQnVpbGRlci5wdXNoKCJcIiBBTFQ9XCIiKTsNCg0KCQkJbGlua0J1aWxkZXIucHVzaCh0aGlzLm1lc3NhZ2VbY29uZmlnLnRpcEtleV0pOw0KDQoJCQlsaW5rQnVpbGRlci5wdXNoKCJcIiBCT1JERVI9MCBjbGFzcz1cIiIpOw0KDQoJCQlsaW5rQnVpbGRlci5wdXNoKGNvbmZpZy5jbGFzc05hbWUpOw0KDQoJCQlsaW5rQnVpbGRlci5wdXNoKCJcIj4iKTsNCg0KCQkJcmV0dXJuIGxpbmtCdWlsZGVyLmpvaW4oIiIpOw0KDQoJCX0uYmluZCh0aGlzKTsNCgkJDQoJCXZhciBuYXZpZ2F0b3JCdWlsZGVyID0gbmV3IEFycmF5KCk7DQoNCgkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCI8dGFibGUgY2xhc3M9XCJ1aS10YWJsZS1uYXZpZ2F0b3JcIiBpZD1cIiIpOw0KDQoJCW5hdmlnYXRvckJ1aWxkZXIucHVzaCh0aGlzLmlkKTsNCg0KCQluYXZpZ2F0b3JCdWlsZGVyLnB1c2goIlwiIG5hbWU9XCIiKTsNCg0KCQluYXZpZ2F0b3JCdWlsZGVyLnB1c2godGhpcy5uYW1lKTsNCg0KCQluYXZpZ2F0b3JCdWlsZGVyLnB1c2goIlwiPjx0cj4iKTsNCgkJDQoJCW5hdmlnYXRvckJ1aWxkZXIucHVzaCgiPHRkIGNsYXNzPVwiQWxpZ25MIGFycm93LXBhZGRpbmctbGVmdFwiPiIpOw0KDQoJCWlmKGhlYWRDb250ZWN0IHx8ICghaGVhZENvbnRlY3QgJiYgIWZvb3RDb250ZW50KSkNCgkJew0KCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCI8c3BhbiBjbGFzcz1cInBhZ2UtbmF2aWdhdG9yLXNob3dcIj4iK3RoaXMucGFnZUluZm8uc2hvd2luZ0xhYmVsKyI8L3NwYW4+Iik7DQoJCX0NCgkJaWYoZm9vdENvbnRlbnQgfHwgKCFoZWFkQ29udGVjdCAmJiAhZm9vdENvbnRlbnQpKQ0KCQl7DQoJCQluYXZpZ2F0b3JCdWlsZGVyLnB1c2goIjxzcGFuIGNsYXNzPVwicGFnZS1uYXZpZ2F0b3Itc2hvd1wiPjxsYWJlbCBmb3I9J3BhZ2UtbmF2aWdhdG9yLWlucHV0LWlkJz4iK3RoaXMucGFnZUluZm8ucGFnZUxhYmVsKyI8L2xhYmVsPiAmbmJzcDs8L3NwYW4+Iik7DQoJCQkNCgkJCW5hdmlnYXRvckJ1aWxkZXIucHVzaCgiPGlucHV0IGlkPVwicGFnZS1uYXZpZ2F0b3ItaW5wdXQtaWRcIiB0eXBlPVwidGV4dFwiIGNsYXNzPVwicGFnZS1uYXZpZ2F0b3ItaW5wdXRcIiB2YWx1ZT1cIiIpOw0KCQ0KCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKHRoaXMucGFnZUluZm8uY3VyUGFnZUluZGV4KTsNCgkJCQ0KCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCJcIiBvbmtleWRvd249XCJvbmx5TnVtKCk7XCIgc3R5bGU9XCJpbWUtbW9kZTpEaXNhYmxlZDt3aWR0aDogMzVweFwiIik7DQoJCQkNCgkJCW5hdmlnYXRvckJ1aWxkZXIucHVzaCgiIG9ua2V5cHJlc3M9XCJpZihldmVudC5rZXlDb2RlPT0xMyl7c2tpcFRvUGFnZXModGhpcywiKTsNCgkJCQ0KCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKE1hdGguY2VpbCh0aGlzLnBhZ2VJbmZvLnRvdGFsTnVtYmVyL3RoaXMucGFnZUluZm8ucGFnZVNpemUpKTsNCgkJCQ0KCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCIpO31cIj48L2lucHV0PiIpOw0KCQkJDQoJCQluYXZpZ2F0b3JCdWlsZGVyLnB1c2goIjxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMCkiKTsNCg0KCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKHRoaXMuYnVpbGRVcmwodGhpcy5wYWdlSW5mbywgJ0BAIyNAQCcpKTsNCg0KCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCJcIiB0YXJnZXQ9XCJfc2VsZlwiIGlkPVwicGFnZS1uYXZpZ2F0aW9uXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+IikNCgkJCQ0KCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCI8L2E+PHNwYW4gY2xhc3M9XCJwYWdlLW5hdmlnYXRvci1vZlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OjZweDttYXJnaW4tcmlnaHQ6MjBweDtcIj4iK3RoaXMucGFnZUluZm8ub2ZMYWJlbCsiJm5ic3A7Iik7DQoJCQluYXZpZ2F0b3JCdWlsZGVyLnB1c2goIjxpbnB1dCBpZD1cInBhZ2VuYXZpZ2F0b3JzaXplXCIgdHlwZT1cImhpZGRlblwiIHZhbHVlPVwiIitNYXRoLmNlaWwodGhpcy5wYWdlSW5mby50b3RhbE51bWJlci90aGlzLnBhZ2VJbmZvLnBhZ2VTaXplKSsiXCIvPiIpOw0KCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKE1hdGguY2VpbCh0aGlzLnBhZ2VJbmZvLnRvdGFsTnVtYmVyL3RoaXMucGFnZUluZm8ucGFnZVNpemUpKTsNCgkJCQ0KCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCI8L3NwYW4+Iik7DQoJCQkNCgkJCWlmKHRoaXMucGFnZUluZm8uY3VyUGFnZUluZGV4PjEpew0KCQ0KCQkJCW5hdmlnYXRvckJ1aWxkZXIucHVzaCgiPGEgaWQ9XCJQcmV2aW91c1BhZ2VcIiBocmVmPVwiIik7DQoJDQoJCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKHRoaXMuYnVpbGRVcmwodGhpcy5wYWdlSW5mbywgdGhpcy5wYWdlSW5mby5jdXJQYWdlSW5kZXgtMSkpOw0KCQ0KCQkJCW5hdmlnYXRvckJ1aWxkZXIucHVzaCgiXCIgdGFyZ2V0PVwiX3NlbGZcIiIpOw0KCQ0KCQkJCW5hdmlnYXRvckJ1aWxkZXIucHVzaCgiPiIpOw0KCQ0KCQkJCS8vbmF2aWdhdG9yQnVpbGRlci5wdXNoKGNyZWF0ZUlNR0xpbmsoe2ljb25OYW1lOiJyZXN1bHRzZXRfYmFjayIsdGlwS2V5OiJwYWdlLnByZXYubGFiZWwiLGNsYXNzTmFtZToiYWxpZ25Cb3R0b20ifSkpOw0KCQkJCW5hdmlnYXRvckJ1aWxkZXIucHVzaChjcmVhdGVJTUdMaW5rKHtpY29uTmFtZToiUHJldmlvdXNfQnV0dG9uX0RlZmF1bHQiLHRpcEtleToicGFnZS5wcmV2LmxhYmVsIixjbGFzc05hbWU6ImFsaWduQm90dG9tIixpY29uSG92ZXI6IlByZXZpb3VzX0J1dHRvbl9Ib3ZlciIscGljdHVyZVR5cGU6Ii5qcGciLHN0eWxlOiJtYXJnaW4tcmlnaHQ6MHB4OyJ9KSk7DQoJDQoJCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCI8L2E+Jm5ic3A7Jm5ic3A7Jm5ic3A7Iik7DQoJDQoJCQl9ZWxzZXsNCgkNCgkJCQkvL25hdmlnYXRvckJ1aWxkZXIucHVzaChjcmVhdGVJTUdMaW5rKHtpY29uTmFtZToicmVzdWx0c2V0X2JhY2tfZGlzYWJsZWQiLHRpcEtleToicGFnZS5wcmV2LmxhYmVsIixjbGFzc05hbWU6ImFsaWduQm90dG9tIHNlY29uZEFycm93In0pKTsNCgkJCQluYXZpZ2F0b3JCdWlsZGVyLnB1c2goY3JlYXRlSU1HTGluayh7aWNvbk5hbWU6IlByZXZpb3VzX0J1dHRvbl9HcmF5ZWRfT3V0Iix0aXBLZXk6InBhZ2UucHJldi5sYWJlbCIsY2xhc3NOYW1lOiJhbGlnbkJvdHRvbSBzZWNvbmRBcnJvdyIscGljdHVyZVR5cGU6Ii5qcGciLHN0eWxlOiJtYXJnaW4tcmlnaHQ6MHB4OyJ9KSk7DQoJDQoJCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCImbmJzcDsmbmJzcDsmbmJzcDsiKTsNCgkNCgkJCX0NCgkNCgkJCXZhciBzdGFydFBhZ2VJbmRleCA9IE1hdGguY2VpbCh0aGlzLnBhZ2VJbmZvLmN1clBhZ2VJbmRleC8xMCkqMTAtOTsNCgkNCgkJCXZhciBlbmRJbmRleCA9IE1hdGgubWluKHN0YXJ0UGFnZUluZGV4KzksdGhpcy5wYWdlSW5mby5tYXhQYWdlSW5kZXgpOw0KCQ0KCQkJDQoJDQoJCQlpZiAodGhpcy5wYWdlSW5mby5jdXJQYWdlSW5kZXggPCBNYXRoLmNlaWwodGhpcy5wYWdlSW5mby50b3RhbE51bWJlci90aGlzLnBhZ2VJbmZvLnBhZ2VTaXplKSkNCgkNCgkJCXsNCgkNCgkJCQluYXZpZ2F0b3JCdWlsZGVyLnB1c2goIjxhIGlkPVwiTmV4dFBhZ2VcIiBocmVmPVwiIik7DQoJDQoJCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKHRoaXMuYnVpbGRVcmwodGhpcy5wYWdlSW5mbyx0aGlzLnBhZ2VJbmZvLmN1clBhZ2VJbmRleCsxKSk7DQoJDQoJCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCJcIiB0YXJnZXQ9XCJfc2VsZlwiIik7DQoJDQoJCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCI+Iik7DQoJDQoJCQkJLy9uYXZpZ2F0b3JCdWlsZGVyLnB1c2goY3JlYXRlSU1HTGluayh7aWNvbk5hbWU6InJlc3VsdHNldF9mb3J3YXJkIix0aXBLZXk6InBhZ2UubmV4dC5sYWJlbCIsY2xhc3NOYW1lOiJhbGlnbkJvdHRvbSJ9KSk7DQoJCQkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKGNyZWF0ZUlNR0xpbmsoe2ljb25OYW1lOiJOZXh0X0J1dHRvbl9EZWZhdWx0Iix0aXBLZXk6InBhZ2UubmV4dC5sYWJlbCIsY2xhc3NOYW1lOiJhbGlnbkJvdHRvbSIsaWNvbkhvdmVyOiJOZXh0X0J1dHRvbl9Ib3ZlciIscGljdHVyZVR5cGU6Ii5qcGcifSkpOw0KCQ0KCQkJCW5hdmlnYXRvckJ1aWxkZXIucHVzaCgiPC9hPiZuYnNwOyIpOw0KCQ0KCQkJfQ0KCQ0KCQkJZWxzZQ0KCQ0KCQkJew0KCQ0KCQkJCS8vbmF2aWdhdG9yQnVpbGRlci5wdXNoKGNyZWF0ZUlNR0xpbmsoe2ljb25OYW1lOiJyZXN1bHRzZXRfZm9yd2FyZF9kaXNhYmxlZCIsdGlwS2V5OiJwYWdlLm5leHQubGFiZWwiLGNsYXNzTmFtZToiYWxpZ25Cb3R0b20gc2Vjb25kQXJyb3cifSkpOw0KCQkJCW5hdmlnYXRvckJ1aWxkZXIucHVzaChjcmVhdGVJTUdMaW5rKHtpY29uTmFtZToiTmV4dF9CdXR0b25fR3JheWVkX091dCIsdGlwS2V5OiJwYWdlLm5leHQubGFiZWwiLGNsYXNzTmFtZToiYWxpZ25Cb3R0b20gc2Vjb25kQXJyb3ciLHBpY3R1cmVUeXBlOiIuanBnIixzdHlsZToibWFyZ2luLXJpZ2h0OjBweDttYXJnaW4tbGVmdDowcHgifSkpOw0KCQ0KCQkJCW5hdmlnYXRvckJ1aWxkZXIucHVzaCgiJm5ic3A7Iik7DQoJDQoJCQl9DQoJCX0NCgkJbmF2aWdhdG9yQnVpbGRlci5wdXNoKCI8L3RkPjwvdHI+PC90YWJsZT4iKTsNCg0KCQlyZXR1cm4gbmF2aWdhdG9yQnVpbGRlci5qb2luKCIiKTsNCg0KCX0sDQoNCgkNCg0KCWFkZERlZmF1bHRFdmVudCA6IGZ1bmN0aW9uKCl7DQoNCgkJDQoNCgl9DQoNCgkNCg0KfSk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IE1lbnVBY3Rpb24uanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiA8PEdlbmVyYWwgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzPj4NCg0KICogDQoNCiAqIE5vdGVzOg0KDQogKiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICogDQoNCiAqDQoNCiAqLw0KDQoNClVJLk1lbnVBY3Rpb24gPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNCg0KVUkuTWVudUFjdGlvbi5leHRlbmQoew0KDQoJDQoNCglpZFByZXZpb3VzIDogIm1lbnVhY3Rpb24tIiwNCg0KCQ0KDQoJaW5pdCA6IGZ1bmN0aW9uKGNvbmZpZyl7DQoNCgkJdGhpcy5pZCA9IGNvbmZpZy5pZCB8fCB0aGlzLmdldElkKCk7DQoNCgkJdGhpcy5uYW1lID0gY29uZmlnLm5hbWUgfHwgdGhpcy5nZXRJZCgpOw0KDQoJCXRoaXMuY2xhc3NOYW1lID0gY29uZmlnLmNsYXNzTmFtZSB8fCAiY3Vyc29yX2hhbmQiOw0KDQoJCXRoaXMudmFsdWUgPSBjb25maWcudmFsdWUgfHwgIiI7DQoNCgkJdGhpcy5jb250YWluSWQgPSBjb25maWcuY29udGFpbklkOw0KDQoJCXRoaXMuaXRlbXMgPSBjb25maWcuaXRlbXMgfHwge307DQoNCgkJdGhpcy5kcm9wTWVudSA9IG51bGw7DQoNCgkJLy9vbmx5IHN1cGVyIHRob3NlIGV2ZW50DQoNCgkJdGhpcy5hZGRFdmVudHMoImtleWRvd24iLCAiZG93biIpOw0KDQoJfSwNCg0KCQ0KDQoJcmVuZGVyIDogZnVuY3Rpb24oKXsNCg0KCQl2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsNCg0KCQlsaW5rLmlkID0gdGhpcy5pZDsNCg0KCQlsaW5rLmhyZWYgPSAiamF2YXNjcmlwdDp2b2lkKDApIjsNCg0KCQlsaW5rLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lOw0KDQoJCWxpbmsuaW5uZXJIVE1MID0gQmFzZUpTLmh0bWxEZWNvZGUodGhpcy52YWx1ZSk7DQoNCgkJbGluay5vbmNsaWNrID0gdGhpcy5zaG93RHJvcE1lbnUuYmluZCh0aGlzKTsNCg0KCQlsaW5rLm9ua2V5ZG93biA9IHRoaXMub25rZXlEb3duLmJpbmQodGhpcyk7DQoNCgkJdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuY29udGFpbklkKTsNCg0KCQljb250YWluZXIuYXBwZW5kQ2hpbGQobGluayk7DQoNCgl9LA0KDQoJDQoNCglzaG93RHJvcE1lbnUgOiBmdW5jdGlvbigpew0KDQoJCWlmICghdGhpcy5kcm9wTWVudSkNCg0KCQl7DQoNCgkJCXRoaXMuZHJvcE1lbnUgPSBuZXcgVUkuRHJvcE1lbnUodGhpcy5pdGVtcyk7IA0KDQoJCX0JDQoNCgkJDQoNCgkJdGhpcy5kcm9wTWVudS5zaG93KHRoaXMuaWQpOw0KDQoJfSwNCg0KCQ0KDQoJb25rZXlEb3duIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXN3aXRjaChldmVudC5rZXlDb2RlKQ0KDQoJCXsNCg0KCQkJY2FzZSB0aGlzLmtleUNvZGUuZG93bjoNCg0KCQkJCWlmICh0aGlzLmRyb3BNZW51KQ0KDQoJCSAgICAJew0KDQoJCQkJCWlmICghdGhpcy5kcm9wTWVudS5nZXRTaG93KCkpDQoNCgkJCQkJew0KDQoJCQkJCQl0aGlzLmRyb3BNZW51LnNob3codGhpcy5pZCk7DQoNCgkJCQkJfQ0KDQoJCSAgICAJfQ0KDQoJCQkJZWxzZQ0KDQoJCQkJew0KDQoJCQkJCXRoaXMuc2hvd0Ryb3BNZW51KCk7DQoNCgkJCQl9DQoNCgkJCQl0aGlzLmRyb3BNZW51Lm9ua2V5RG93bigpOw0KDQoJCQkJYnJlYWs7DQoNCgkJfQ0KDQoJCXRoaXMuZmlyZUV2ZW50KCJrZXlkb3duIik7DQoNCgl9LA0KDQoJDQoNCglhZGREZWZhdWx0RXZlbnQgOiBmdW5jdGlvbigpew0KDQoNCgl9DQoNCn0pOw0KDQpXaWRnZXRNYW5hZ2VyLnJlZ2lzdGVyV2lkZ2V0KCJtZW51YWN0aW9uIixVSS5NZW51QWN0aW9uKTsNCg0KLyoqDQoNCiAqIA0KDQogKiBWMzYwICANCg0KICogRmlsZTogRm9ybUxheW91dC5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuDQoNCiAqIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246DQoNCiAqIDw8Q29tbW9uIGZvcm0gbGF5b3V0IGZvciBBYzM2MD4+DQoNCiAqIA0KDQogKiBOb3RlczoNCg0KICogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKg0KDQogKi8NCg0KDQpVSS5Gb3JtTGF5b3V0ID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQpVSS5Gb3JtTGF5b3V0LmV4dGVuZChVSS5FbGVtZW50U3VwcG9ydC5wcm90b3R5cGUpOw0KDQpVSS5Gb3JtTGF5b3V0LmV4dGVuZCh7DQoNCiAgICANCg0KICAgIA0KDQogICAgaWRQcmV2aW91cyA6ICJmb3JtbGF5b3V0LSIsDQoNCiAgICANCg0KICAgIGluaXQgOiBmdW5jdGlvbihjb25maWcpew0KDQogICAgICAgIHRoaXMuaWQgPSBjb25maWcuaWQgfHwgdGhpcy5nZXRJZCgpOw0KDQogICAgICAgIHRoaXMubmFtZSA9IGNvbmZpZy5uYW1lIHx8IHRoaXMuZ2V0SWQoKTsNCg0KICAgICAgICB0aGlzLmNsYXNzTmFtZSA9IGNvbmZpZy5jbGFzc05hbWUgfHwgInVpLWZvcm1sYXlvdXQiOw0KDQogICAgICAgIHRoaXMubGF5b3V0QXJyYXkgPSBjb25maWcubGF5b3V0IHx8IFtdOw0KDQogICAgICAgIHRoaXMuY29sTnVtID0gY29uZmlnLmNvbE51bSB8fCAzOw0KDQogICAgICAgIHRoaXMuZm9ybUVsZW1lbnRzID0gY29uZmlnLmh0bWxFbGVtZW50cyB8fCBbXTsNCg0KICAgICAgICB0aGlzLmhpZGRlbkh0bWxFbGVtZW50cyA9IGNvbmZpZy5oaWRkZW5IdG1sRWxlbWVudHMgfHwgW107DQoNCiAgICAgICAgdGhpcy5lbnZpcm9ubWVudC53ZWJQYXRoID0gIi8iK2NvbmZpZy53ZWJQYXRoIHx8ICIiOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgZ2V0RWxlbWVudEhlYWQgOiBmdW5jdGlvbihmb3JtRWxlbWVudCl7DQoNCiAgICAgICAgdmFyIGhlYWRCdWlsZGVyID0gbmV3IEFycmF5KCk7DQoNCiAgICAgICAgaGVhZEJ1aWxkZXIucHVzaCgiPGRpdiBjbGFzcz0ndWktZm9ybWxheW91dC1sYWJlbCc+Iik7DQoNCiAgICAgICAgaGVhZEJ1aWxkZXIucHVzaCh0aGlzLmdldFdpZGdldCgnbGFiZWwnKS5nZXRPdXRlckhUTUxXcmFwcGVyKHt0ZXh0OmZvcm1FbGVtZW50LmxhYmVsLGh0bWxGb3I6Zm9ybUVsZW1lbnQuZWxlbWVudElkfSkpOw0KDQogICAgICAgIGlmKGZvcm1FbGVtZW50LmVycm9ySFRNTCl7DQoNCiAgICAgICAgICAgIGhlYWRCdWlsZGVyLnB1c2goZm9ybUVsZW1lbnQuZXJyb3JIVE1MKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgaWYoZm9ybUVsZW1lbnQuaTE4blN1cHBvcnRpdmUpew0KDQogICAgICAgICAgICBoZWFkQnVpbGRlci5wdXNoKCImbmJzcCIpOw0KDQogICAgICAgICAgICBoZWFkQnVpbGRlci5wdXNoKHRoaXMuZ2V0V2lkZ2V0KCdmb250JykuZ2V0T3V0ZXJIVE1MV3JhcHBlcih7Y2xhc3NOYW1lOiJ1aS1mb3JtbGF5b3V0LWxhYmVsLWkxOG4iLA0KDQogICAgICAgICAgICAgICAgdGV4dDogIiYjOTgzMDsiLCBodG1sRW5jb2RlOiJ0cnVlIn0pKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgaGVhZEJ1aWxkZXIucHVzaCgiPC9kaXY+Iik7DQoNCiAgICAgICAgcmV0dXJuIGhlYWRCdWlsZGVyLmpvaW4oIiIpOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgZ2V0RWxlbWVudERlZmF1bHRMYXlvdXQgOiBmdW5jdGlvbihmb3JtRWxlbWVudCl7DQoNCiAgICAgICAgdmFyIGNvbXBvc2l0ZUVsZW1zID0gZm9ybUVsZW1lbnQuY29tcG9zaXRlRWxlbWVudHMgfHwgW107DQoNCiAgICAgICAgdmFyIGVsZW1MYXlvdXRCdWlsZGVyID0gbmV3IEFycmF5KCk7DQoNCiAgICAgICAgDQoNCiAgICAgICAgZWxlbUxheW91dEJ1aWxkZXIucHVzaCgiPHRhYmxlIikNCg0KICAgICAgICAvL2lmIHRoZSBmaXJzdCBlbGVtZW50IGlzIGhpZGRlbiwgdGhlbiB3ZSB3aWxsIHNldCBoaWRkZW4gc3R5bGUgdG8gdGhlIGVsZW1lbnQuDQoNCiAgICAgICAgaWYgKCFBYzM2MC52YWxpZGF0b3IuaXNFbXB0eShjb21wb3NpdGVFbGVtc1swXSkgJiYgJ2hpZGRlbicgPT0gY29tcG9zaXRlRWxlbXNbMF0uaHRtbEVsZW1lbnRIZWFkLmVsZW1lbnRUeXBlKQ0KDQogICAgICAgIHsNCg0KICAgICAgICAgICAgZWxlbUxheW91dEJ1aWxkZXIucHVzaCgiIHN0eWxlPSdkaXNwbGF5Om5vbmU7JyIpOw0KDQogICAgICAgIH0NCg0KICAgICAgICBlbGVtTGF5b3V0QnVpbGRlci5wdXNoKCI+Iik7DQoNCiAgICAgICAgDQoNCiAgICAgICAgaWYoZm9ybUVsZW1lbnQubGFiZWwpew0KDQogICAgICAgICAgICBlbGVtTGF5b3V0QnVpbGRlci5wdXNoKCI8dHI+PHRkIHZBbGlnbj0nYm90dG9tJyIpOw0KDQogICAgICAgICAgICAvL2ZvciBtdWx0aXBsZSBpbnB1dCBib3hlcw0KDQogICAgICAgICAgICBpZiAoY29tcG9zaXRlRWxlbXMubGVuZ3RoID4gMSkNCg0KICAgICAgICAgICAgew0KDQogICAgICAgICAgICAJZWxlbUxheW91dEJ1aWxkZXIucHVzaCgiIGNvbHNwYW49JyIgKyBjb21wb3NpdGVFbGVtcy5sZW5ndGggKyAiJyAiKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBlbGVtTGF5b3V0QnVpbGRlci5wdXNoKCI+Iik7DQoNCiAgICAgICAgICAgIGVsZW1MYXlvdXRCdWlsZGVyLnB1c2godGhpcy5nZXRFbGVtZW50SGVhZChmb3JtRWxlbWVudCkpOw0KDQogICAgICAgICAgICBlbGVtTGF5b3V0QnVpbGRlci5wdXNoKCI8L3RkPjwvdHI+Iik7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGVsZW1MYXlvdXRCdWlsZGVyLnB1c2goIjx0cj4iKTsNCg0KICAgICAgICBmb3IodmFyIGk9MDtpPGNvbXBvc2l0ZUVsZW1zLmxlbmd0aDtpKyspew0KDQogICAgICAgICAgICB2YXIgaHRtbEVsZW1IZWFkID0gY29tcG9zaXRlRWxlbXNbaV0uaHRtbEVsZW1lbnRIZWFkOw0KDQogICAgICAgICAgICB2YXIgaHRtbEVsZW0gPSBjb21wb3NpdGVFbGVtc1tpXS5odG1sRWxlbWVudDsNCg0KICAgICAgICAgICAgdmFyIGNvbnRhaW5lcklkID0gdGhpcy5pZFByZXZpb3VzKyJjb250YWluZXItIitBYzM2MC5pbmNyZWFzZSgpOw0KDQogICAgICAgICAgICBlbGVtTGF5b3V0QnVpbGRlci5wdXNoKCI8dGQgaWQ9JyIpOw0KDQogICAgICAgICAgICBlbGVtTGF5b3V0QnVpbGRlci5wdXNoKGNvbnRhaW5lcklkKTsNCg0KICAgICAgICAgICAgZWxlbUxheW91dEJ1aWxkZXIucHVzaCgiJz4iKTsNCg0KICAgICAgICAgICAgdmFyIGVsZW1Db250ZW50ID0gdGhpcy5nZW5lcmF0ZUhUTUxFbGVtZW50KGh0bWxFbGVtSGVhZCxodG1sRWxlbSxjb250YWluZXJJZCk7DQoNCiAgICAgICAgICAgIGVsZW1MYXlvdXRCdWlsZGVyLnB1c2goZWxlbUNvbnRlbnQpOw0KDQogICAgICAgICAgICBlbGVtTGF5b3V0QnVpbGRlci5wdXNoKCI8L3RkPiIpOw0KDQogICAgICAgIH0NCg0KICAgICAgICBlbGVtTGF5b3V0QnVpbGRlci5wdXNoKCI8L3RyPiIpOw0KDQogICAgICAgIGVsZW1MYXlvdXRCdWlsZGVyLnB1c2goIjwvdGFibGU+Iik7DQoNCiAgICAgICAgcmV0dXJuIGVsZW1MYXlvdXRCdWlsZGVyLmpvaW4oIiIpOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgZ2V0RWxlbWVudEN1c3RvbUxheW91dCA6IGZ1bmN0aW9uKGZvcm1FbGVtZW50LGxheW91dEV4cCl7DQoNCiAgICAgICAgdmFyIGNvbXBvc2l0ZUVsZW1zID0gZm9ybUVsZW1lbnQuY29tcG9zaXRlRWxlbWVudHMgfHwgW107DQoNCiAgICAgICAgdmFyIGxheW91dE1hcCA9IG5ldyBPYmplY3QoKTsNCg0KICAgICAgICBpZihmb3JtRWxlbWVudC5sYWJlbCl7DQoNCiAgICAgICAgICAgIGxheW91dE1hcC5sYWJlbCA9IHRoaXMuZ2V0RWxlbWVudEhlYWQoZm9ybUVsZW1lbnQpOw0KDQogICAgICAgIH0NCg0KICAgICAgICBmb3IodmFyIGk9MDtpPGNvbXBvc2l0ZUVsZW1zLmxlbmd0aDtpKyspew0KDQogICAgICAgICAgICB2YXIgaHRtbEVsZW1IZWFkID0gY29tcG9zaXRlRWxlbXNbaV0uaHRtbEVsZW1lbnRIZWFkOw0KDQogICAgICAgICAgICB2YXIgaHRtbEVsZW0gPSBjb21wb3NpdGVFbGVtc1tpXS5odG1sRWxlbWVudDsNCg0KICAgICAgICAgICAgdmFyIG1hcEl0ZW0gPSB7ZWxlbUhlYWQ6aHRtbEVsZW1IZWFkLGVsZW1Db250ZW50Omh0bWxFbGVtfTsNCg0KICAgICAgICAgICAgbGF5b3V0TWFwW2h0bWxFbGVtLmlkXT0gbWFwSXRlbTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgbGF5b3V0RXhwID0gdGhpcy5yZWJ1aWxkTGF5b3V0RXhwKGxheW91dEV4cCk7DQoNCiAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tTGF5b3V0KGxheW91dEV4cCwgbGF5b3V0TWFwKTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIGZvcm1FbGVtZW50VG9IVE1MIDogZnVuY3Rpb24oZm9ybUVsZW1lbnQpew0KDQogICAgICAgIHZhciBmb3JtRWxlbUJ1aWxkZXIgPSBuZXcgQXJyYXkoKTsNCg0KICAgICAgICB2YXIgbGF5b3V0RXhwID0gQmFzZUpTLnN0clRvSnNvbihmb3JtRWxlbWVudC5sYXlvdXRFeHApOw0KDQogICAgICAgIGlmKGZvcm1FbGVtZW50LmxheW91dEV4cCl7DQoNCiAgICAgICAgICAgIGZvcm1FbGVtQnVpbGRlci5wdXNoKHRoaXMuZ2V0RWxlbWVudEN1c3RvbUxheW91dChmb3JtRWxlbWVudCxsYXlvdXRFeHApKTsNCg0KICAgICAgICB9ZWxzZXsNCg0KICAgICAgICAgICAgZm9ybUVsZW1CdWlsZGVyLnB1c2godGhpcy5nZXRFbGVtZW50RGVmYXVsdExheW91dChmb3JtRWxlbWVudCkpOw0KDQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gZm9ybUVsZW1CdWlsZGVyLmpvaW4oIiIpOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgYnVpbGREZWZhdWx0TGF5b3V0IDogZnVuY3Rpb24oZm9ybUVsZW1lbnRzKXsNCg0KICAgICAgICB2YXIgYm9keUJ1aWxkZXIgPSBuZXcgQXJyYXkoKTsNCg0KICAgICAgICB2YXIgY3VyQ29sTnVtID0gMTsNCg0KICAgICAgICBpZiAoQWMzNjAudmFsaWRhdG9yLmlzRW1wdHkoZm9ybUVsZW1lbnRzKSkNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIGZvcm1FbGVtZW50cyA9IHRoaXMuZm9ybUVsZW1lbnRzOw0KDQogICAgICAgIH0NCg0KICAgICAgICBmb3IodmFyIGk9MDtpPGZvcm1FbGVtZW50cy5sZW5ndGg7aSsrKXsNCg0KICAgICAgICAgICAgaWYoY3VyQ29sTnVtPT0xKXsNCg0KICAgICAgICAgICAgICAgIGJvZHlCdWlsZGVyLnB1c2goIjx0cj4iKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBib2R5QnVpbGRlci5wdXNoKCI8dGQgdkFsaWduPSd0b3AnPiIpOw0KDQogICAgICAgICAgICBib2R5QnVpbGRlci5wdXNoKHRoaXMuZm9ybUVsZW1lbnRUb0hUTUwoZm9ybUVsZW1lbnRzW2ldKSk7DQoNCiAgICAgICAgICAgIGJvZHlCdWlsZGVyLnB1c2goIjwvdGQ+Iik7DQoNCiAgICAgICAgICAgIGlmKGN1ckNvbE51bT09dGhpcy5jb2xOdW0pew0KDQogICAgICAgICAgICAgICAgYm9keUJ1aWxkZXIucHVzaCgiPC90cj4iKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjdXJDb2xOdW09Y3VyQ29sTnVtJXRoaXMuY29sTnVtKzE7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBib2R5QnVpbGRlci5qb2luKCIiKTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIGJ1aWxkSGlkZGVuTGF5b3V0IDogZnVuY3Rpb24oKXsNCg0KICAgICAgICB2YXIgYm9keUJ1aWxkZXIgPSBuZXcgQXJyYXkoKTsNCg0KICAgICAgICBib2R5QnVpbGRlci5wdXNoKCI8dGFibGUgaWQ9J3VpX2Zvcm1sYXlvdXRfaGlkZGVuX2lkJyBjbGFzcz0ndWktZm9ybWxheW91dCcgc3R5bGU9J2Rpc3BsYXk6bm9uZTsnPiIpOw0KDQogICAgICAgIA0KDQogICAgICAgIGJvZHlCdWlsZGVyLnB1c2godGhpcy5idWlsZERlZmF1bHRMYXlvdXQodGhpcy5oaWRkZW5IdG1sRWxlbWVudHMpKTsNCg0KDQogICAgICAgIGJvZHlCdWlsZGVyLnB1c2goIjwvdGFibGU+Iik7DQoNCiAgICAgICAgcmV0dXJuIGJvZHlCdWlsZGVyLmpvaW4oIiIpOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgYnVpbGRDdXN0b21pemVkTGF5b3V0IDogZnVuY3Rpb24oKXsNCg0KICAgICAgICB2YXIgYm9keUJ1aWxkZXIgPSBuZXcgQXJyYXkoKTsNCg0KICAgICAgICBmb3IodmFyIGk9MDtpPHRoaXMuZm9ybUVsZW1lbnRzLmxlbmd0aDtpKyspew0KDQogICAgICAgICAgICB2YXIgbGF5b3V0ID0gdGhpcy5sYXlvdXRBcnJheVtpXTsNCg0KICAgICAgICAgICAgLyoNCg0KICAgICAgICAgICAgICogd2Ugd2lsbCByZW5kZXIgdGhlIGhpZGRlbiBmaWVsZCBhbG9uZSBpZiBpdCBkb24ndCBjdXN0b20gaW4gZWRpdCB2aWV3LiANCg0KICAgICAgICAgICAgICogDQoNCiAgICAgICAgICAgICovDQoNCiAgICAgICAgICAgIGlmIChBYzM2MC52YWxpZGF0b3IuaXNFbXB0eShsYXlvdXQpKQ0KDQogICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICBib2R5QnVpbGRlci5wdXNoKHRoaXMuZm9ybUVsZW1lbnRUb0hUTUwodGhpcy5mb3JtRWxlbWVudHNbaV0pKTsgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZWxzZQ0KDQogICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICBsYXlvdXQgPSBsYXlvdXQuc3Vic3RyaW5nKDAsbGF5b3V0Lmxlbmd0aC0xKSsiIHZBbGlnbj0ndG9wJz4iOy8vc2V0IGZvcm0gZWxlbWVudCdzIHZlcnRpY2FsIGFsaWduLg0KDQogICAgICAgICAgICAgICAgYm9keUJ1aWxkZXIucHVzaChsYXlvdXQpOw0KDQogICAgICAgICAgICAgICAgYm9keUJ1aWxkZXIucHVzaCh0aGlzLmZvcm1FbGVtZW50VG9IVE1MKHRoaXMuZm9ybUVsZW1lbnRzW2ldKSk7DQoNCiAgICAgICAgICAgICAgICBpZihpKzE9PXRoaXMuZm9ybUVsZW1lbnRzLmxlbmd0aCl7DQoNCiAgICAgICAgICAgICAgICAgICAgYm9keUJ1aWxkZXIucHVzaCh0aGlzLmxheW91dEFycmF5W2kgKyAxXSk7DQoNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGJvZHlCdWlsZGVyLmpvaW4oIiIpOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgYnVpbGRCb2R5IDogZnVuY3Rpb24oKXsNCg0KICAgICAgICBpZih0aGlzLmxheW91dEFycmF5Lmxlbmd0aD09MCkNCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGREZWZhdWx0TGF5b3V0KCk7DQoNCiAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRDdXN0b21pemVkTGF5b3V0KCk7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICByZW5kZXIgOiBmdW5jdGlvbigpew0KDQogICAgICAgIHZhciBmb3JtTGF5b3V0QnVpbGRlciA9IG5ldyBBcnJheSgpOw0KDQogICAgICAgIGZvcm1MYXlvdXRCdWlsZGVyLnB1c2goIjx0YWJsZSBpZD1cIiIpOw0KDQogICAgICAgIGZvcm1MYXlvdXRCdWlsZGVyLnB1c2godGhpcy5pZCk7DQoNCiAgICAgICAgZm9ybUxheW91dEJ1aWxkZXIucHVzaCgiXCIgY2xhc3M9XCIiKTsNCg0KICAgICAgICBmb3JtTGF5b3V0QnVpbGRlci5wdXNoKHRoaXMuY2xhc3NOYW1lKTsNCg0KICAgICAgICBmb3JtTGF5b3V0QnVpbGRlci5wdXNoKCJcIiBuYW1lPVwiIik7DQoNCiAgICAgICAgZm9ybUxheW91dEJ1aWxkZXIucHVzaCh0aGlzLm5hbWUpOw0KDQogICAgICAgIGZvcm1MYXlvdXRCdWlsZGVyLnB1c2goIlwiPiIpOw0KDQogICAgICAgIGZvcm1MYXlvdXRCdWlsZGVyLnB1c2godGhpcy5idWlsZEJvZHkoKSk7DQoNCiAgICAgICAgZm9ybUxheW91dEJ1aWxkZXIucHVzaCgiPC90YWJsZT4iKTsNCg0KICAgICAgICANCg0KICAgICAgICBpZiAodGhpcy5oaWRkZW5IdG1sRWxlbWVudHMubGVuZ3RoID4gMCkNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIGZvcm1MYXlvdXRCdWlsZGVyLnB1c2godGhpcy5idWlsZEhpZGRlbkxheW91dCgpKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgDQoNCiAgICAgICAgZG9jdW1lbnQud3JpdGUoZm9ybUxheW91dEJ1aWxkZXIuam9pbigiIikpOw0KDQogICAgICAgIHRoaXMucmVuZGVyRGVsYXllZEVsZW0oKTsNCg0KICAgICAgICB0aGlzLndpZGdldENhY2hlID0gbnVsbDsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIC8vY2hlY2sgd2hldGhlciB0aGUgbGF5b3V0IGhhcyBkZWZpbmVkIGxhYmVsLCBpZiBpdCBkb2Vzbid0LCB3ZSB3aWxsIGFkZCBpdCBieSBkZWZhdWx0Lg0KDQogICAgcmVidWlsZExheW91dEV4cCA6IGZ1bmN0aW9uKGxheW91dEV4cCl7DQoNCiAgICAgICAgdmFyIGhhc1ZhbHVlID0gZnVuY3Rpb24ob2JqLHZhbHVlKXsNCg0KICAgICAgICAgICAgaWYoIW9iaiB8fCAhdmFsdWUpDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAgICAgIGlmKG9iaj09dmFsdWUpDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlOw0KDQogICAgICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBBcnJheSl7DQoNCiAgICAgICAgICAgICAgICBmb3IodmFyIGk9MDtpPG9iai5sZW5ndGg7aSsrKXsNCg0KICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBhcmd1bWVudHMuY2FsbGVlKG9ialtpXSx2YWx1ZSk7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0KQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mIG9iaiA9PSAib2JqZWN0Iil7DQoNCiAgICAgICAgICAgICAgICBmb3IodmFyIGl0ZW0gaW4gb2JqKXsNCg0KICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBhcmd1bWVudHMuY2FsbGVlKG9ialtpdGVtXSx2YWx1ZSk7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0KQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KDQogICAgICAgIH07DQoNCiAgICAgICAgaWYoIWhhc1ZhbHVlKGxheW91dEV4cCwibGFiZWwiKSl7DQoNCiAgICAgICAgICAgIHZhciBuZXdMYXlvdXRFeHAgPSBuZXcgT2JqZWN0KCk7DQoNCiAgICAgICAgICAgIHZhciB2ZXJ0aWNhbEFycmF5ID0gbmV3IEFycmF5KCk7DQoNCiAgICAgICAgICAgIHZlcnRpY2FsQXJyYXkucHVzaCgibGFiZWwiKTsNCg0KICAgICAgICAgICAgdmVydGljYWxBcnJheS5wdXNoKGxheW91dEV4cCk7DQoNCiAgICAgICAgICAgIG5ld0xheW91dEV4cC52ID0gdmVydGljYWxBcnJheTsNCg0KICAgICAgICAgICAgcmV0dXJuIG5ld0xheW91dEV4cDsNCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGxheW91dEV4cDsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIGN1c3RvbUxheW91dCA6IGZ1bmN0aW9uKGxheW91dEV4cCxsYXlvdXRNYXAsY29udGFpbmVySWQpew0KDQogICAgICAgIGlmKCFsYXlvdXRFeHAgDQoNCiAgICAgICAgICAgICAgICB8fCAobGF5b3V0RXhwLmggJiYgbGF5b3V0RXhwLnYpIA0KDQogICAgICAgICAgICAgICAgfHwoIWxheW91dEV4cC5oICYmICFsYXlvdXRFeHAudiAmJiB0eXBlb2YgbGF5b3V0RXhwIT0ic3RyaW5nIikNCg0KICAgICAgICAgICAgICAgIHx8ICFsYXlvdXRNYXApew0KDQogICAgICAgICAgICByZXR1cm4gIiI7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciByZXN1bHQgPSBuZXcgQXJyYXkoKTsNCg0KICAgICAgICBpZih0eXBlb2YgbGF5b3V0RXhwID09ICJzdHJpbmciICYmIGxheW91dE1hcFtsYXlvdXRFeHBdKXsNCg0KICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBsYXlvdXRNYXBbbGF5b3V0RXhwXXx8e307DQoNCiAgICAgICAgICAgIHZhciBlbGVtQ29udGVudCA9IGVsZW1lbnQ7DQoNCiAgICAgICAgICAgIGlmKGxheW91dEV4cCE9ImxhYmVsIikNCg0KICAgICAgICAgICAgICAgZWxlbUNvbnRlbnQgPSB0aGlzLmdlbmVyYXRlSFRNTEVsZW1lbnQoZWxlbWVudC5lbGVtSGVhZCxlbGVtZW50LmVsZW1Db250ZW50LGNvbnRhaW5lcklkKTsNCg0KICAgICAgICAgICAgcmVzdWx0LnB1c2goZWxlbUNvbnRlbnQpOw0KDQogICAgICAgIH1lbHNlIGlmKGxheW91dEV4cC5oIGluc3RhbmNlb2YgQXJyYXkpew0KDQogICAgICAgICAgICByZXN1bHQucHVzaCgiPHRhYmxlPjx0cj4iKTsNCg0KICAgICAgICAgICAgZm9yKHZhciBpPTA7aTxsYXlvdXRFeHAuaC5sZW5ndGg7aSsrKXsNCg0KICAgICAgICAgICAgICB2YXIgY29udGFpbmVySWQgPSB0aGlzLmlkUHJldmlvdXMrImNvbnRhaW5lci0iK0FjMzYwLmluY3JlYXNlKCk7DQoNCiAgICAgICAgICAgICAgcmVzdWx0LnB1c2goIjx0ZCBpZD0nIik7DQoNCiAgICAgICAgICAgICAgcmVzdWx0LnB1c2goY29udGFpbmVySWQpOw0KDQogICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCInIikNCg0KICAgICAgICAgICAgICBpZiAobGF5b3V0RXhwLmhbaV0gPT0gImxhYmVsIikNCg0KICAgICAgICAgICAgICB7DQoNCiAgICAgICAgICAgIAkgIHJlc3VsdC5wdXNoKCIgdkFsaWduPSdib3R0b20nIik7DQoNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCI+Iik7DQoNCiAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYXJndW1lbnRzLmNhbGxlZS5jYWxsKHRoaXMsbGF5b3V0RXhwLmhbaV0sbGF5b3V0TWFwLGNvbnRhaW5lcklkKSk7DQoNCiAgICAgICAgICAgICAgcmVzdWx0LnB1c2goIjwvdGQ+Iik7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmVzdWx0LnB1c2goIjwvdHI+PC90YWJsZT4iKTsNCg0KICAgICAgICB9ZWxzZSBpZihsYXlvdXRFeHAudiBpbnN0YW5jZW9mIEFycmF5KXsNCg0KICAgICAgICAgICAgcmVzdWx0LnB1c2goIjx0YWJsZT4iKTsNCg0KICAgICAgICAgICAgZm9yKHZhciBpPTA7aTxsYXlvdXRFeHAudi5sZW5ndGg7aSsrKXsNCg0KICAgICAgICAgICAgICAgIHZhciBjb250YWluZXJJZCA9IHRoaXMuaWRQcmV2aW91cysiY29udGFpbmVyLSIrQWMzNjAuaW5jcmVhc2UoKTsNCg0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCI8dHI+PHRkIHZBbGlnbj0ndG9wJyBpZD0nIik7DQoNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChjb250YWluZXJJZCk7DQoNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgiJz4iKTsNCg0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFyZ3VtZW50cy5jYWxsZWUuY2FsbCh0aGlzLGxheW91dEV4cC52W2ldLGxheW91dE1hcCxjb250YWluZXJJZCkpOw0KDQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goIjwvdGQ+PC90cj4iKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXN1bHQucHVzaCgiPC90YWJsZT4iKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCIiKTsgICAgIA0KDQogICAgfSwNCg0KICAgIA0KDQogICAgYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKXsNCg0KICAgICAgICANCg0KICAgIH0NCg0KfSk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MAkgDQoNCiAqIEZpbGU6IEdyb3VwVGFibGUuanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICogDQoNCiAqICovDQoNCg0KLyoNCg0KICogZnVuY3Rpb24gZm9yIG92ZXJyaWRlLiBJbXBsZW1lbnQgeW91ciBjdXN0b21pemVkIGhlYWRlciBjZWxsIGRlZmluaXRpb24gaGVyZS4NCg0KICogQHJldHVybiB0aGUgY2VsbCBvZiB0YWJsZSBpbiBIVE1MIGZvcm1hdC4NCg0KICovDQoNCmZ1bmN0aW9uIGN1c3RvbWl6ZUhhbmRsZXIodmFsdWVXcmFwQmVhbil7DQoNCglyZXR1cm4gIiI7DQoNCn0NCg0KDQpVSS5Hcm91cFRhYmxlID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQpVSS5Hcm91cFRhYmxlLmV4dGVuZChVSS5FbGVtZW50U3VwcG9ydC5wcm90b3R5cGUpOw0KDQpVSS5Hcm91cFRhYmxlLmV4dGVuZCh7DQoNCgkNCg0KCQ0KDQoJaWRQcmV2aW91cyA6ICJncm91cHRhYmxlLSIsDQoNCgkNCg0KCWluaXQgOiBmdW5jdGlvbihjb25maWcpew0KDQoJCXRoaXMuaWQgPSBjb25maWcuaWQgfHwgdGhpcy5nZXRJZCgpOw0KDQoJCXRoaXMubmV4dFJvd0NsYXNzID0gImV2ZW4iOw0KDQoJCS8qDQoNCgkJICogYWxsIG5lY2Vzc2FyeSBkYXRhIGZvciBncm91cCB0YWJsZS4gRGF0YSBmb3JtYXQgaW4ganNvbjoge1sidGFibGVIZWFkZXJzIjp7fV0sWyJjb2xTcGFuIjoiLi4uIl0sWyJncm91cEJlYW5zIjp7fV19DQoNCgkJICogVHlwZSBmb3IgZWxlbWVudHMgY29udGFpbmVkIGluICJncm91cEJlYW5zIiBzaG91bGQgYmUgImNvbS5hY2NlbGEuYXYzNjAuZnJhbWV3b3JrLnRhZ2xpYi50YWcuYmVhbi5Hcm91cEJlYW4iOw0KDQoJCSAqIFR5cGUgZm9yIGVsZW1lbnRzIGNvbnRhaW5lZCBpbiAidGFibGVIZWFkZXJzIiBzaG91bGQgYmUgImNvbS5hY2NlbGEuYXYzNjAuZnJhbWV3b3JrLnRhZ2xpYi50YWcuYmVhbi5WYWx1ZVdyYXBCZWFuIjsNCg0KCQkgKiBUeXBlIGZvciAiY29sU3BhbiIgaXMgYSBnZW5lcmFsIHN0cmluZyB0byBpbmRpY2F0ZSB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgdXNlZCB0byByZW5kZXIgYSBjZWxsIG9mIGEgZ3JvdXAncyBoZWFkZXIuIA0KDQoJCSAqLw0KDQoJCXRoaXMudGFibGVIZWFkZXJzID0gY29uZmlnLmV4dGVuZHNGbiB8fCBbXTsNCg0KCQl0aGlzLmdyb3VwQmVhbnMgPSBjb25maWcuZ3JvdXBCZWFucyB8fCBbXTsNCg0KCQl0aGlzLmdyb3VwQ29sdW1uTnVtID0gY29uZmlnLmdyb3VwQ29sdW1uTnVtIHx8IDM7DQoNCgkJdGhpcy5tZXNzYWdlID0gY29uZmlnLm1lc3NhZ2UgfHwge307DQoNCgkJdGhpcy50YWJsZUhUTUxBcnJheSA9IG5ldyBBcnJheSgpOw0KDQoJfSwNCg0KCQ0KDQoJYnVpbGRIZWFkZXIgOiBmdW5jdGlvbigpew0KDQoJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiPHN0eWxlIHR5cGU9XCJ0ZXh0L2Nzc1wiPi5oaWdoQnJpZ2h0e2NvbG9yOiNGRjAwMDA7fWhye2hlaWdodDoxcHg7fTwvc3R5bGU+Iik7DQoNCgkJdmFyIGhlYWRlcnMgPSB0aGlzLnRhYmxlSGVhZGVyczsNCg0KCQlpZihoZWFkZXJzLmxlbmd0aD4wKXsNCg0KCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKCI8dGFibGUgd2lkdGg9XCI3MCVcIiBib3JkZXI9XCIwXCIgY2VsbHNwYWNpbmc9XCI1XCIgY2VsbHBhZGRpbmc9XCIwXCI+PHRyPiIpOw0KDQoJCQlmb3IodmFyIGk9MDtpPGhlYWRlcnMubGVuZ3RoO2krKyl7DQoNCgkJCQlpZihpIT0wICYmIGklMz09MCl7DQoNCgkJCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKCI8L3RyPjx0cj4iKTsNCg0KCQkJCX0NCg0KCQkJCWlmKGkhPTAgJiYgaSUzPT0xKXsNCg0KCQkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goIjx0ZCBub1dyYXA9XCJub3dyYXBcIiBjbGFzcz1cIlBhZGRpbmcyMFwiPiIpOy8vUGFkZGluZyByaWdodCBhdHRyaWJ1dGUgaXMgc2V0IGZvciBsZWF2aW5nIHNwYWNlIGJldHdlZW4gc2VhcmNoIGZpZWxkIGFuZCBzb3J0IGZpZWxkIHdoZW4gd2luZG93IGJlIHJlc2l6ZWQuIA0KDQoJCQkJfWVsc2V7DQoNCgkJCQkJLy8gZml4IGJ1ZyA1NDIwNywgaGFyZCBjb2RlIHRvIGxpbWl0IHRoZSA8VEQ+IHdpZHRoLCBtYWtlIGl0IHNob3cgbm9ybWFsbHkgaW4gQXIgZW52aXJvbm1lbnQgZm9yIHdhdGVyIG1hcmsNCg0KCQkJCQlpZiAoIndhdGVybWFya2VyIj09aGVhZGVyc1tpXS5odG1sRWxlbWVudEhlYWQuZWxlbWVudFR5cGUpDQoNCgkJCQkJew0KDQoJCQkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goIjx0ZCBub1dyYXA9XCJub3dyYXBcIiBzdHlsZT1cIndpZHRoOjE0NnB4XCI+Iik7DQoNCgkJCQkJfQ0KDQoJCQkJCWVsc2UNCg0KCQkJCQl7DQoNCgkJCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiPHRkIG5vV3JhcD1cIm5vd3JhcFwiPiIpOw0KDQoJCQkJCX0NCg0KCQkJCX0NCg0KCQkJCWlmKG51bGw9PWhlYWRlcnNbaV0uaHRtbEVsZW1lbnRIZWFkLmVsZW1lbnRUeXBlKXsvL0RlZmF1bHQgY2FzZSBpcyBjb25zaWRlcmVkIGFzIGxhYmVsIGNhc2UuDQoNCgkJCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKGhlYWRlcnNbaV0uaHRtbEVsZW1lbnQudmFsdWUpOw0KDQoJCQkJfWVsc2UgaWYoIndhdGVybWFya2VyIj09aGVhZGVyc1tpXS5odG1sRWxlbWVudEhlYWQuZWxlbWVudFR5cGUpew0KDQoJCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiPGlucHV0IHR5cGU9XCJ0ZXh0XCIgaWQ9XCJfaGlnaHRMaWdodFwiIHRpdGxlPSciK2hlYWRlcnNbaV0uaHRtbEVsZW1lbnQudGl0bGUrIicgLz4iKTsNCg0KCQkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goIjxzY3JpcHQgbGFuZ3VhZ2U9XCJqYXZhc2NyaXB0XCI+Iik7DQoNCgkJCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKCJ2YXIgd2F0ZXJNYXJrT2JqID0gbmV3IEFWMzYwV2F0ZXJtYXJrKFwiIik7DQoNCgkJCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKGhlYWRlcnNbaV0uaHRtbEVsZW1lbnQudmFsdWUpOw0KDQoJCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiXCIpOyIpOw0KDQoJCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgid2F0ZXJNYXJrT2JqLmF0dGFjaChcIl9oaWdodExpZ2h0XCIpOyIpOw0KDQoJCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiPC9zY3JpcHQ+Iik7DQoNCgkJCQl9ZWxzZXsNCg0KCQkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goY3VzdG9taXplSGFuZGxlcihoZWFkZXJzW2ldKSk7DQoNCgkJCQl9DQoNCgkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goIjwvdGQ+Iik7DQoNCgkJCX0NCg0KCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKCI8L3RyPjwvdGFibGU+PGhyLz48YnIvPiIpOw0KDQoJCX0NCg0KCX0sDQoNCgkNCg0KCWJ1aWxkR3JvdXBzIDogZnVuY3Rpb24oKXsNCg0KCQl2YXIgZ3JvdXBzID0gdGhpcy5ncm91cEJlYW5zOw0KDQoJCXZhciBjb2xTcGFuID0gdGhpcy5ncm91cENvbHVtbk51bTsNCg0KCQlpZihncm91cHMhPW51bGwpew0KDQoJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goIjx0YWJsZSB3aWR0aD1cIjEwMCVcIiBpZD1cIiIpOw0KDQoJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2godGhpcy5pZCk7DQoNCgkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiXCI+Iik7DQoNCgkJCXRoaXMuZXh0cmFjdEdyb3Vwcyhncm91cHMsIGNvbFNwYW4gKyAxKTsNCg0KCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKCI8L3RhYmxlPiIpOw0KDQoJCX0NCg0KCX0sDQoNCgkNCg0KCWRlYWxIaWdoTGlnaHQgOiBmdW5jdGlvbigpew0KDQoJCXZhciBfaGlnaHRMaWdodCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJfaGlnaHRMaWdodCIpOw0KDQoJCWlmIChfaGlnaHRMaWdodCkNCg0KCQl7DQoJCQlpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikNCgkJICAgIHsNCgkJCQlBYzM2MC5hdHRhY2hFdmVudChfaGlnaHRMaWdodCwnaW5wdXQnLCBmdW5jdGlvbihlKXsNCgkJCQkJICAgIA0KCQkJCQkgICAgdmFyIGVsZW0gPSBlLnNyY0VsZW1lbnQgfHwgZS50YXJnZXQ7DQoJCQkJCQl2YXIgdmFsdWUgPSBlbGVtLnZhbHVlOw0KCQkJCQkJdmFyIHNjb3BlT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5pZCk7DQoJCQ0KCQkJCQkJVXRpbC5oaWdoTGlnaHQodmFsdWUsICd0ZCcsICdoaWdoQnJpZ2h0JyxzY29wZU9iaiwgL2lkPW1lbnVhY3Rpb24tW15cc10qLyk7CQkNCgkJCQl9LmJpbmQodGhpcykpOw0KCQkJCQ0KCQkgICAgIH0NCgkJICAgIGVsc2UNCgkJICAgIHsNCgkJCQlBYzM2MC5hdHRhY2hFdmVudChfaGlnaHRMaWdodCwnb25wcm9wZXJ0eWNoYW5nZScsIGZ1bmN0aW9uKGUpew0KCQkJCWlmIChlLnByb3BlcnR5TmFtZSA9PSAidmFsdWUiKQ0KCQkJCXsNCgkJCQkJdmFyIGVsZW0gPSBlLnNyY0VsZW1lbnQgfHwgZS50YXJnZXQ7DQoJCQkJCXZhciB2YWx1ZSA9IGVsZW0udmFsdWU7DQoJDQoJCQkJCXZhciBzY29wZU9iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuaWQpOw0KCQ0KCQkJCQlVdGlsLmhpZ2hMaWdodCh2YWx1ZSwgJ3RkJywgJ2hpZ2hCcmlnaHQnLHNjb3BlT2JqLCAvaWQ9bWVudWFjdGlvbi1bXlxzXSovKTsNCgkJCQl9DQoJDQoJCQkJfS5iaW5kKHRoaXMpKTsNCgkJCX0NCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJZXh0cmFjdEdyb3VwcyA6IGZ1bmN0aW9uKGdyb3Vwcyxjb2xTcGFuKXsNCg0KCQlpZihncm91cHMubGVuZ3RoPjApew0KDQoJCQlmb3IodmFyIGk9MDtpPGdyb3Vwcy5sZW5ndGg7aSsrKXsNCg0KCQkJCXZhciBncm91cEJlYW4gPSBncm91cHNbaV07DQoNCgkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goIjx0ciBzdHlsZT1cImhlaWdodDoyMHB4O1wiPjx0ZCBjb2xzcGFuPVwiIik7DQoNCgkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goY29sU3Bhbik7DQoNCgkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goIlwiIHN0eWxlPVwiZm9udC13ZWlnaHQ6IGJvbGQ7XCI+PHNwYW4+Iik7DQoNCgkJCQl2YXIga2V5cyA9IGdyb3VwQmVhbi5ncm91cEtleS5zcGxpdCgiJjomIik7DQoNCgkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goa2V5c1trZXlzLmxlbmd0aC0xXSk7DQoNCgkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2goIjwvc3Bhbj48L3RkPjwvdHI+Iik7DQoNCgkJCQl2YXIgZ3JvdXBUYWJsZVJvd3MgPSBncm91cEJlYW4uZGF0YXM7DQoNCgkJCQlmb3IodmFyIGo9MDtqPGdyb3VwVGFibGVSb3dzLmxlbmd0aDtqKyspew0KDQoJCQkJCXZhciBncm91cFRhYmxlUm93ID0gZ3JvdXBUYWJsZVJvd3Nbal07DQoNCgkJCQkJdmFyIGNsYXNzaWMgPSAiY2xhc3M9XCJvZGRyb3ctY2xhc3NcIiI7DQoNCgkJCQkJaWYodGhpcy5uZXh0Um93Q2xhc3MgPT0gImV2ZW4iKQ0KDQoJCQkJCXsNCg0KCQkJCQkJY2xhc3NpYyA9ICJjbGFzcz1cImV2ZW5yb3ctY2xhc3NcIiI7DQoNCgkJCQkJCXRoaXMubmV4dFJvd0NsYXNzID0gIm9kZCINCg0KCQkJCQl9IA0KDQoJCQkJCWVsc2UNCg0KCQkJCQl7DQoNCgkJCQkJCXRoaXMubmV4dFJvd0NsYXNzID0gImV2ZW4iOw0KDQoJCQkJCX0NCg0KDQoJCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiPHRyIHN0eWxlPVwiaGVpZ2h0OjI4cHg7XCIgIiArIGNsYXNzaWMgKyAiIG9uY2xpY2s9XCJVSS5Hcm91cFRhYmxlLnJvd1NlbGVjdCh0aGlzKTtcIj4iKTsNCg0KCQkJCQlmb3IodmFyIGs9MDtrPGdyb3VwVGFibGVSb3cubGVuZ3RoO2srKyl7DQoNCgkJCQkJCXZhciBjb250YWluZXJJZCA9IHRoaXMuaWRQcmV2aW91cyArImNvbnRhaW5lci0iK0FjMzYwLmluY3JlYXNlKCk7DQoNCgkJCQkJCXZhciBodG1sRWxlbWVudCA9IGdyb3VwVGFibGVSb3dba10uaHRtbEVsZW1lbnQgfHwge307DQoNCgkJCQkJCWh0bWxFbGVtZW50Lmxlbmd0aFJlc3RyaWN0ZWQgPSBmYWxzZTsgDQoNCgkJCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiPHRkIGlkPSciKTsNCg0KCQkJCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKGNvbnRhaW5lcklkKTsNCg0KCQkJCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKCInPiIpOw0KDQoJCQkJCQl0aGlzLnRhYmxlSFRNTEFycmF5LnB1c2godGhpcy5nZW5lcmF0ZUhUTUxFbGVtZW50KGdyb3VwVGFibGVSb3dba10uaHRtbEVsZW1lbnRIZWFkLGh0bWxFbGVtZW50LGNvbnRhaW5lcklkKSk7DQoNCgkJCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiPC90ZD4iKTsNCg0KCQkJCQl9DQoNCgkJCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKCI8dGQgd2lkdGg9XCIzMCVcIj48L3RkPiIpOw0KDQoJCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiPC90cj4iKTsNCg0KCQkJCX0NCg0KCQkJCQ0KDQoJCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKCI8dHIgc3R5bGU9XCJoZWlnaHQ6MjhweDtcIj48dGQgIGNvbHNwYW49XCIiKTsNCg0KCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaChjb2xTcGFuKTsNCg0KCQkJCXRoaXMudGFibGVIVE1MQXJyYXkucHVzaCgiXCI+PGhyIHdpZHRoPVwiNTAlXCIgc2l6ZT1cIjFcIiAgc3R5bGU9XCJjb2xvcjojREZERkRGXCIgLz48L3RkPjwvdHI+Iik7DQoNCgkJCQlpZihncm91cEJlYW4uZ3JvdXBCZWFuIT1udWxsICYmIGdyb3VwQmVhbi5ncm91cEJlYW4ubGVuZ3RoPjApew0KDQoJCQkJCWFyZ3VtZW50cy5jYWxsZWUuY2FsbCh0aGlzLCBncm91cEJlYW4uZ3JvdXBCZWFuLCBjb2xTcGFuKTsNCg0KCQkJCX0NCg0KCQkJfQ0KDQoJCX1lbHNlIHsNCg0KCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKCI8dHI+PHRkIGNsYXNzPVwicG9ydGxldC1tc2ctYWxlcnRcIj4iKTsNCg0KCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKHRoaXMubWVzc2FnZVsncGFnZS5ub3JlY29yZC5sYWJlbCddKTsNCg0KCQkJdGhpcy50YWJsZUhUTUxBcnJheS5wdXNoKCI8L3RkPjwvdHI+Iik7DQoNCgkJfQ0KDQoJfSwNCg0KCQ0KDQoJcmVuZGVyIDogZnVuY3Rpb24oKXsNCg0KCQl0aGlzLmJ1aWxkSGVhZGVyKCk7DQoNCgkJdGhpcy5idWlsZEdyb3VwcygpOw0KDQoJCWRvY3VtZW50LndyaXRlKHRoaXMudGFibGVIVE1MQXJyYXkuam9pbigiIikpOw0KDQoJCXRoaXMucmVuZGVyRGVsYXllZEVsZW0oKTsNCg0KCQl0aGlzLmRlYWxIaWdoTGlnaHQoKTsNCg0KCQl0aGlzLmRhdGEgPSBudWxsOw0KDQoJCXRoaXMud2lkZ2V0Q2FjaGUgPSBudWxsOw0KDQoJfSwNCg0KCQ0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKXsNCg0KCQkNCg0KCX0NCg0KCQ0KDQp9KTsNCg0KDQpVSS5Hcm91cFRhYmxlLnJvd1NlbGVjdCA9IGZ1bmN0aW9uKHJvd09iamVjdCkNCg0Kew0KDQoJdmFyIGNoZWNrYm94ID0gbnVsbDsNCg0KCXZhciB0bXAgPSByb3dPYmplY3QuY2xhc3NOYW1lOw0KDQoJdmFyIHRkID0gcm93T2JqZWN0LmZpcnN0Q2hpbGQ7DQoNCgl2YXIgaW5wdXRzID0gdGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0Iik7DQoNCglmb3IgKHZhciBpIGluIGlucHV0cykNCg0KCXsNCg0KCQlpZiAoaW5wdXRzW2ldLnR5cGU9PSJjaGVja2JveCIpew0KDQoJCQljaGVja2JveCA9IGlucHV0c1tpXTsNCg0KCQkJYnJlYWs7DQoNCgkJfQ0KDQoJfQ0KDQoJaWYgKHJvd09iamVjdC5jbGFzc05hbWUgPT0gJ3Jvd0NsaWNrJyl7DQoNCgkJcm93T2JqZWN0LmNsYXNzTmFtZSA9IHJvd09iamVjdC5sYXN0Q2xhc3M7DQoNCgkJcm93T2JqZWN0Lmxhc3RDbGFzcyA9IHRtcDsNCg0KCQlpZiAoY2hlY2tib3gpDQoNCgkJCWNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTsNCg0KCQlyZXR1cm47DQoNCgl9DQoNCglyb3dPYmplY3QubGFzdENsYXNzID0gcm93T2JqZWN0LmNsYXNzTmFtZTsNCg0KCXJvd09iamVjdC5jbGFzc05hbWUgPSAncm93Q2xpY2snOw0KDQoJaWYgKGNoZWNrYm94KQ0KDQoJCWNoZWNrYm94LmNoZWNrZWQgPSB0cnVlOw0KDQp9DQoNCi8qKg0KDQogKiANCg0KICogVjM2MCAgDQoNCiAqIEZpbGU6IFF1ZXJ5RW5naW5lVGFibGUuanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiA8PENvbW1vbiB0YWJsZSBmb3IgQWMzNjA+Pg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiAwNC8wMS8yMDEzLCBSYXkgWmhhbmcsIEluaXRpYWwgdmVyc2lvbg0KDQogKg0KDQogKi8NCg0KVUkuUXVlcnlFbmdpbmVUYWJsZSA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KVXRpbC5leHRlbmQoVUkuUXVlcnlFbmdpbmVUYWJsZSwgVUkuVGFibGUsIHsNCg0KICAgIGlkUHJldmlvdXMgOiAidGFibGUtIiwNCg0KICAgIA0KDQogICAgYXBwZW5kUGFnaW5nSW5mbyA6IGZ1bmN0aW9uKG91dGVySFRNTCkNCg0KICAgIHsNCg0KICAgICAgICBpZih0aGlzLnBhZ2VJbmZvKXsNCg0KICAgICAgICAgICAgdmFyIHBhZ2VJbmZvID0gdGhpcy5wYWdlSW5mbzsNCg0KICAgICAgICAgICAgdmFyIHdlYlBhdGggPSB0aGlzLmVudmlyb25tZW50LndlYlBhdGg7DQoNCiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gdGhpcy5tZXNzYWdlczsNCg0KICAgICAgICAgICAgdmFyIHF1ZXJ5RmxhZyA9ICI8aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCJpc0R5bmFQYWdpbmdcIiB2YWx1ZT1cInRydWVcIi8+IjsNCg0KICAgICAgICAgICAgdmFyIHBhZ2VOYXZpZ2F0b3IgPSBuZXcgVUkuUXVlcnlFbmdpbmVQYWdlTmF2aWdhdG9yKHtwYWdlSW5mbzpwYWdlSW5mbyx3ZWJQYXRoOndlYlBhdGgsbWVzc2FnZTptZXNzYWdlfSk7DQoNCiAgICAgICAgICAgIHZhciBuYXZpZ2F0b3JIZWFkSFRNTCA9IHBhZ2VOYXZpZ2F0b3IuZ2V0T3V0ZXJIVE1MKHRydWUsIGZhbHNlKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdmFyIG5hdmlnYXRvckZvb3RIVE1MID0gcGFnZU5hdmlnYXRvci5nZXRPdXRlckhUTUwoZmFsc2UsIHRydWUpOw0KDQogICAgICAgICAgICBvdXRlckhUTUwgPSBuYXZpZ2F0b3JIZWFkSFRNTCArb3V0ZXJIVE1MK25hdmlnYXRvckZvb3RIVE1MICsgcXVlcnlGbGFnOw0KDQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gb3V0ZXJIVE1MOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgZ2V0T3JkZXJNZXNzYWdlIDogZnVuY3Rpb24obWVzc2FnZXMpDQoNCiAgICB7DQoNCiAgICAgICAgcmV0dXJuIG1lc3NhZ2VzWydlcnJvci5qcy5wYWdlSGVhZGVyLnNvcnRBc2NlbmRpbmcnXTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIGdldERlc2NPcmRlck1lc3NhZ2UgOiBmdW5jdGlvbihtZXNzYWdlcykNCg0KICAgIHsNCg0KICAgICAgICByZXR1cm4gbWVzc2FnZXNbJ2Vycm9yLmpzLnBhZ2VIZWFkZXIuc29ydCddOw0KDQogICAgfSwgICAgDQoNCiAgICANCg0KICAgIGdlbmVyYXRlSGVhZExpbmsgOiBmdW5jdGlvbihzb3J0TGluaykNCg0KICAgIHsNCg0KICAgICAgICB2YXIgclZhbHVlID0gIiNcIiBvbmNsaWNrPVwiSmF2YVNjcmlwdDogcmV0dXJuIFNpbXVsYXRlQ2xpY2soJzEnLCdhY2NlbGFzdWJtaXRidXR0b25uYW1lJywnJywnYWN0aW9uJywnIjsNCg0KICAgICAgICByVmFsdWUgKz0gc29ydExpbms7ICAgICAgICAgICAgICAgDQoNCiAgICAgICAgclZhbHVlICs9ICInLCAndGFyZ2V0JywgJ19zZWxmJyk7IjsNCg0KICAgICAgICByZXR1cm4gclZhbHVlOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgICAgIGdldE9yZGVyU3R5bGUgOiBmdW5jdGlvbihzb3J0TGluaykNCg0KICAgIHsNCg0KICAgICAgICBpZiAoc29ydExpbmsuaW5kZXhPZigib3JkZXI9dHJ1ZSIpPjApDQoNCiAgICAgICAgew0KDQogICAgICAgICAgICByZXR1cm4gIm9yZGVyX3VwIjsNCg0KICAgICAgICB9DQoNCiAgICAgICAgZWxzZQ0KDQogICAgICAgIHsNCg0KICAgICAgICAgICAgcmV0dXJuICJvcmRlcl9kb3duIjsNCg0KICAgICAgICB9DQoNCiAgICB9DQoNCiAgICANCg0KfSk7DQoNCi8qKg0KDQogKiANCg0KICogVjM2MCAgDQoNCiAqIEZpbGU6IER5bmFtaWNQYWdlTmF2aWdhdG9yLmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjoNCg0KICogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczoNCg0KICogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqICogMDQvMDEvMjAxMywgUmF5IFpoYW5nLCBJbml0aWFsIHZlcnNpb24NCg0KICoNCg0KICovDQoNCg0KVUkuUXVlcnlFbmdpbmVQYWdlTmF2aWdhdG9yID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQpVdGlsLmV4dGVuZChVSS5RdWVyeUVuZ2luZVBhZ2VOYXZpZ2F0b3IsIFVJLlBhZ2VOYXZpZ2F0b3IsIHsNCg0KICAgIA0KDQogICAgaWRQcmV2aW91cyA6ICJxdWVyeUVuZ2luZVBhZ2VuYXZpZ2F0b3ItIiwNCg0KICAgICAgIA0KDQogICAgYnVpbGRVcmwgOiAgZnVuY3Rpb24ocGFnZUluZm8sIHBhZ2VJbmRleCkgew0KDQogICAgICAgIHZhciB1cmwgPSBwYWdlSW5mby5wYWdlVXJpOw0KDQogICAgICAgIHZhciBtb2R1bGUgPSBwYWdlSW5mby5tb2R1bGU7DQoNCiAgICAgICAgdmFyIGNvbHVtbiA9IHBhZ2VJbmZvLmNvbHVtbjsNCg0KICAgICAgICB2YXIgb3JkZXIgPSBwYWdlSW5mby5vcmRlcjsNCg0KICAgICAgICB2YXIgcGFyYW1ldGVyU3RyaW5nID0gcGFnZUluZm8ucGFyYW1ldGVyU3RyaW5nOw0KDQogICAgICAgIHZhciBwYWdlU2l6ZSA9IHBhZ2VJbmZvLnBhZ2VTaXplOw0KDQogICAgICAgIHZhciBtYXhQYWdlSW5kZXggPSBNYXRoLmNlaWwodGhpcy5wYWdlSW5mby50b3RhbE51bWJlci90aGlzLnBhZ2VJbmZvLnBhZ2VTaXplKTsNCg0KICAgICAgICANCg0KICAgICAgICB1cmwgKz0gIj8iICsgIm1vZHVsZT0iICsgbW9kdWxlICsgIiZwYWdlTm89IiArIHBhZ2VJbmRleCsiJnBhZ2VTaXplPSIrcGFnZVNpemUrIiZ0b3RhbFBhZ2VzPSIrbWF4UGFnZUluZGV4Ow0KDQogICAgICAgIGlmIChjb2x1bW4pIHsNCg0KICAgICAgICAgICAgdXJsICs9ICImY29sdW1uPSIgKyBjb2x1bW4gKyAiJm9yZGVyPSIgKyBvcmRlcjsNCg0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHBhcmFtZXRlclN0cmluZykgew0KDQogICAgICAgICAgICB1cmwgKz0gIiYiICtwYXJhbWV0ZXJTdHJpbmc7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciByVmFsdWU7DQogICAgICAgIGlmKHBhZ2VJbmRleD09J0BAIyNAQCcpDQogICAgICAgIHsNCgkgICAgICAgIHJWYWx1ZSA9ICJcIiBvbmNsaWNrPVwiSmF2YVNjcmlwdDogbmV3IGZ1bmN0aW9uKCl7IjsNCgkgICAgICAgIA0KCSAgICAgICAgclZhbHVlICs9ICJ2YXIgdXJsPSciOw0KCSAgICAgICAgDQoJICAgICAgICByVmFsdWUgKz0gdXJsOw0KCSAgICAgICAgDQoJICAgICAgICByVmFsdWUgKz0gIic7IHZhciBpbmRleCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlLW5hdmlnYXRvci1pbnB1dC1pZCcpLnZhbHVlOyI7DQoJICAgICAgICByVmFsdWUgKz0gIiB2YXIgcGFnZUNvdW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZ2VuYXZpZ2F0b3JzaXplJykudmFsdWU7IjsgDQoJICAgICAgICByVmFsdWUgKz0gIiBpZihpbmRleC1wYWdlQ291bnQ+MCl7aW5kZXggPSBwYWdlQ291bnQ7IH07IjsNCgkgICAgICAgIHJWYWx1ZSArPSAidmFyIG5ld1VSTD11cmwucmVwbGFjZSgnQEAjI0BAJywgaW5kZXgpOyI7DQoJICAgICAgICANCgkgICAgICAgIHJWYWx1ZSArPSAicmV0dXJuIFNpbXVsYXRlQ2xpY2soJzEnLCdhY2NlbGFzdWJtaXRidXR0b25uYW1lJywnJywnYWN0aW9uJyxuZXdVUkwsICd0YXJnZXQnLCAnX3NlbGYnKTt9XCIiOw0KICAgICAgICB9DQogICAgICAgIGVsc2UNCiAgICAgICAgew0KCSAgICAgICAgclZhbHVlID0gIlwiIG9uY2xpY2s9XCJKYXZhU2NyaXB0OiByZXR1cm4gU2ltdWxhdGVDbGljaygnMScsJ2FjY2VsYXN1Ym1pdGJ1dHRvbm5hbWUnLCcnLCdhY3Rpb24nLCciOw0KCSAgICAgICAgDQoJICAgICAgICByVmFsdWUgKz0gdXJsOyAgICAgICAgICAgICAgIA0KCSAgICAgICAgDQoJICAgICAgICByVmFsdWUgKz0gIicsICd0YXJnZXQnLCAnX3NlbGYnKTsiOw0KICAgICAgICB9DQoNCiAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIHJWYWx1ZTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIGJ1aWxkTGFzdFBhZ2UgOiBmdW5jdGlvbihwYWdlSW5mbywgcGFnZUluZm8pDQoNCiAgICB7DQoNCiAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRVcmwocGFnZUluZm8sIC0xKTsgDQoNCiAgICB9DQoNCg0KfSk7LyoqDQoNCiAqIA0KDQogKiBWMzYwIEZpbGU6IExhYmVsLmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4gQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKiBEZXNjcmlwdGlvbjogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqIA0KDQogKiBOb3RlczogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqIA0KDQogKiANCg0KICovDQoNCg0KVUkuVGlwID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQoNClVJLlRpcC5leHRlbmQoIHsNCg0KICAgIGlkUHJldmlvdXMgOiAidGlwLSIsDQoNCiAgICANCg0KICAgIGluaXQgOiBmdW5jdGlvbihjb25maWcpIHsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIHJlbmRlciA6IGZ1bmN0aW9uKCkgew0KDQogICAgICAgIHZhciB0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKTsNCg0KICAgICAgICB0aXAuY2xhc3NOYW1lID0gInRpcC1kaXYiOw0KDQogICAgICAgIHRoaXMuaWQgPSB0aXAuaWQgPSB0aGlzLmdldElkKCk7DQoNCiAgICAgICAgdmFyIGZpcnN0Q2hpbGQgPSBkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGQ7DQoNCiAgICAgICAgZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUodGlwLCBmaXJzdENoaWxkKTsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIGdldE91dGVySFRNTCA6IGZ1bmN0aW9uKGRhdGEpIHsNCg0KICAgIH0sDQoNCiAgICANCg0KICAgIHNob3c6IGZ1bmN0aW9uKHNyY0lkLCBjb250ZW50KQ0KDQogICAgew0KDQogICAgICAgIGlmIChBYzM2MC52YWxpZGF0b3IuaXNFbXB0eShjb250ZW50KSkNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICB9DQoNCiAgICAgICAgDQoNCiAgICAgICAgaWYgKEFjMzYwLnZhbGlkYXRvci5pc0VtcHR5KHRoaXMuaWQpKQ0KDQogICAgICAgIHsNCg0KICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTsgICANCg0KICAgICAgICB9DQoNCiAgICAgICAgDQoNCiAgICAgICAgdmFyIHRpcERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuaWQpOw0KDQogICAgICAgIHZhciBzcmNFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3JjSWQpOyANCg0KICAgICAgICB0aXBEaXYuaW5uZXJIVE1MID0gY29udGVudDsNCg0KICAgICAgICB0aXBEaXYuc3R5bGUud2lkdGggPSBzcmNFbGVtZW50Lm9mZnNldFdpZHRoKyJweCI7DQoNCiAgICAgICAgVUkucG9zaXRpb25NZ3Iuc2hvdyhzcmNJZCwgdGhpcy5pZCk7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICBoaWRkZW4gOiBmdW5jdGlvbigpDQoNCiAgICB7DQoNCiAgICAgICAgIGlmIChBYzM2MC52YWxpZGF0b3IuaXNFbXB0eSh0aGlzLmlkKSkNCg0KICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIHZhciB0aXBEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmlkKTsNCg0KICAgICAgICB0aXBEaXYuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCg0KICAgIH0NCg0KICAgIA0KDQp9KTsNCg0KDQpVSS5UaXAuc2hvd1RpcCA9IGZ1bmN0aW9uKGNvbnRlbnQpDQoNCnsNCg0KCWlmICghY29udGVudCkNCg0KCXsNCg0KCQlyZXR1cm47DQoNCgl9DQoNCgkNCgl2YXIgZXZlbnRfID0gQWMzNjAuZ2V0RXZlbnQoKTsNCgkNCgkNCiAgICB2YXIgc3JjRWxlbWVudCA9IGV2ZW50Xy5zcmNFbGVtZW50IHx8IGV2ZW50Xy50YXJnZXQ7DQoNCiAgICANCg0KICAgIHZhciBjb250ZW50VGV4dCA9IGNvbnRlbnQ7DQoNCiAgICB0cnkNCg0KICAgIHsNCg0KCSAgICAvLyBIVE1MIGRlY29kZSBmb3IgY29udGVudA0KDQoJICAgIHZhciB0ZXh0YXJlYU9iaiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7DQoNCgkgICAgdGV4dGFyZWFPYmouaW5uZXJIVE1MID0gY29udGVudDsNCg0KCSAgICBjb250ZW50VGV4dCA9IHRleHRhcmVhT2JqLmlubmVyVGV4dDsNCg0KCSAgICB0ZXh0YXJlYU9iaiA9IG51bGw7DQoNCiAgICB9IA0KDQogICAgY2F0Y2goZSkNCg0KICAgIHt9DQoNCiAgICANCg0KICAgIGlmIChjb250ZW50VGV4dCA9PSBzcmNFbGVtZW50LmlubmVyVGV4dCkNCg0KICAgICAgICByZXR1cm47DQoNCiAgICANCg0KICAgIHZhciBwYXJlbnROb2RlID0gc3JjRWxlbWVudC5wYXJlbnROb2RlOw0KDQogICAgaWYgKEFjMzYwLnZhbGlkYXRvci5pc0VtcHR5KHRoaXMudGlwKSkNCg0KICAgICAgICB0aGlzLnRpcCA9IG5ldyBVSS5UaXAoKTsNCg0KICAgIHRoaXMudGlwLnNob3cocGFyZW50Tm9kZS5pZCwgY29udGVudCk7DQoNCn07DQoNCiAgICANCg0KVUkuVGlwLmhpZGRlbmlwID0gZnVuY3Rpb24oKQ0KDQp7DQoNCiAgICBpZiAoQWMzNjAudmFsaWRhdG9yLmlzRW1wdHkodGhpcy50aXApKQ0KDQogICAgICAgIHJldHVybjsNCg0KICAgIHRoaXMudGlwLmhpZGRlbigpOw0KDQp9Ow0KDQoNCg0KVUkuVGlwLmFwcGVuZFRpcCA9IGZ1bmN0aW9uKHRleHQpDQoNCnsNCg0KCXRleHQgPSB0ZXh0LnJlcGxhY2UoL1wnL2csICJcXCciKTsNCg0KCXJldHVybiAiIG9ubW91c2VlbnRlciA9ICdVSS5UaXAuc2hvd1RpcCgmIzM5OyIrQmFzZUpTLmh0bWxFbmNvZGUodGV4dCkrIiYjMzk7KTsnIG9ubW91c2VvdXQ9J1VJLlRpcC5oaWRkZW5pcCgpOycgIjsNCg0KfTsNCg0KDQpXaWRnZXRNYW5hZ2VyLnJlZ2lzdGVyV2lkZ2V0KCJ0aXAiLCBVSS5UaXApOy8qKg0KDQogKg0KDQogKiBWMzYwDQoNCiAqIEZpbGU6IERlcGFydG1lbnQuanMNCg0KICoNCg0KICogQWNjZWxhLCBJbmMuDQoNCiAqIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKg0KDQogKiBEZXNjcmlwdGlvbjoNCg0KICogPDxHZW5lcmFsIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzcz4+DQoNCiAqDQoNCiAqIE5vdGVzOg0KDQogKiA8PFNwZWNpZmljIHByb2dyYW1taW5nIG5vdGVzPj4NCg0KICoNCg0KICoNCg0KICovDQoNCg0KVUkuRGVwYXJ0bWVudCA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KDQpVdGlsLmV4dGVuZChVSS5EZXBhcnRtZW50LCBVSS5TZWxlY3QsIHsNCg0KDQogICAgYWZ0ZXJSZW5kZXIgOiBmdW5jdGlvbihzZWxlY3RJRCkgew0KDQogICAgICAgIFVJLkRlcGFydG1lbnQuaW5pdFVzZXIoc2VsZWN0SUQpOw0KDQogICAgfQ0KDQogICAgDQoNCn0pOw0KDQoNClVJLkRlcGFydG1lbnQuaW5pdFVzZXIgPSBmdW5jdGlvbihzZWxlY3RJRCkgew0KDQogICAgDQoNCiAgICB2YXIgdXBkYXRlVXNlciA9IGZ1bmN0aW9uKCl7DQoNCiAgICAgICAgaWYoZG9jdW1lbnQucmVhZHlTdGF0ZT09ImNvbXBsZXRlIikNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHZhciBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWxlY3RJRDApOw0KDQogICAgICAgICAgICBpZiAoc2VsZWN0Lm9uY2hhbmdlKQ0KDQogICAgICAgICAgICAgICAgc2VsZWN0Lm9uY2hhbmdlKCk7DQoNCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXIpOw0KDQogICAgICAgIH0NCg0KICAgIH07DQoNCiAgICB2YXIgc2VsZWN0SUQwID0gc2VsZWN0SUQ7DQoNCiAgICB2YXIgdGltZXIgPSBzZXRJbnRlcnZhbCh1cGRhdGVVc2VyLCA1MDApOw0KDQp9DQoNCg0KV2lkZ2V0TWFuYWdlci5yZWdpc3RlcldpZGdldCgiZGVwYXJ0bWVudCIsIFVJLkRlcGFydG1lbnQpOyAvKioNCg0KICogDQoNCiAqIFYzNjAJIA0KDQogKiBGaWxlOiBTdW1tYXJ5VGFibGUuanMNCg0KICogDQoNCiAqIEFjY2VsYSwgSW5jLg0KDQogKiBDb3B5cmlnaHQgKEMpOiAyMDEyLTIwMTQNCg0KICogDQoNCiAqIERlc2NyaXB0aW9uOg0KDQogKiA8PENvbW1vbiB0YWJsZSBmb3IgQWMzNjA+Pg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICoNCg0KICovDQoNCg0KVUkuU3VtbWFyeVRhYmxlID0gbmV3IFVJLkNvbXBvbmVudCgpOw0KDQpVdGlsLmV4dGVuZChVSS5TdW1tYXJ5VGFibGUsIFVJLlRhYmxlLCB7DQoNCgkNCg0KCWdldFRhYmxlSGVhZGVyQ3NzIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXJldHVybiAicG9ydGxldC1zZWN0aW9uLXN1YmhlYWRlciBzdW1tYXJ5LXNpbXBsZS1zdHlsZSBBbGlnbkwiOw0KDQoJfSwNCg0KCQ0KDQoJZ2V0VGFibGVCb2R5Q3NzIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXJldHVybiAicG9ydGxldC1zZWN0aW9uLWJvZHkgc3VtbWFyeS1zaW1wbGUtc3R5bGUiOw0KDQoJfSwNCg0KCQ0KDQoJZ2V0R2VuZXJhdGVDZWxsQ3NzIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXJldHVybiAiSW5mbyI7DQoNCgl9LA0KDQoJDQoNCglnZXRUYWJsZUhlYWRlckxhYmVsIDogZnVuY3Rpb24obGFiZWwpDQoNCgl7DQoNCgkJcmV0dXJuIGxhYmVsOw0KDQoJfSwNCg0KCQ0KDQoJZ2V0Um93SGVhZEV2ZW50U3RyIDogZnVuY3Rpb24oZ2V0Um93SGVhZEV2ZW50KQ0KDQoJew0KDQoJCXJldHVybiAiIjsNCg0KCX0sDQoNCgkNCg0KCWdldE5vUmVjb3JkU3RyIDogZnVuY3Rpb24oKQ0KDQoJew0KDQoJCXJldHVybiAiIjsNCg0KCX0sDQoNCgkNCg0KCXJlbmRlciA6IGZ1bmN0aW9uKCl7DQoNCgkJdmFyIG91dGVySFRNTCA9IHRoaXMuZ2V0VGFibGVIZWFkZXIoKSt0aGlzLmdldFRhYmxlQm9keSgpOw0KDQoJCQ0KDQoJCWRvY3VtZW50LndyaXRlKG91dGVySFRNTCk7DQoNCgkJdGhpcy5yZW5kZXJEZWxheWVkRWxlbSgpOw0KDQoJCXZhciB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuaWQpOw0KDQoJCXRhYmxlLnJlZkpTVGFibGUgPSB0aGlzOy8vQWRkIGEgcmVmZXJlbmNlIHRvIGl0cyBjb3JyZXNwb25kaW5nIEpTIFRhYmxlIG9iamVjdC4NCg0KCX0NCg0KCQ0KDQp9KTsvKioNCg0KICogDQoNCiAqIFYzNjAJIA0KDQogKiBGaWxlOiBQcm9jZXNzQmFyLmpzDQoNCiAqIA0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqIA0KDQogKi8NCg0KVUkuUHJvY2Vzc0JhciA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KVUkuUHJvY2Vzc0Jhci5leHRlbmQoew0KDQoNCglpc1BhZ2VMb2FkaW5nQ2lyY2xlIDogZmFsc2UsDQoNCgkNCg0KCVBCT0lEIDogIlBCT19JRF9LRVlfMDAwMDAwMDAwMCIsDQoNCgkNCg0KCVBCT19JTUdfSUQgOiAiUEJPX0lNR19JRF9LRVlfMDAwMDAwMDAwMCIsDQoNCgkNCg0KCVBHX0xPQURfQ0lSQ0xFIDogInBhZ2VMb2FkaW5nQ2lyY2xlIiwNCg0KCQ0KDQoJZ2V0UmFuZG9tTnVtIDogZnVuY3Rpb24oTWluLE1heCkNCg0KCXsgICANCg0KCQl2YXIgUmFuZ2UgPSBNYXggLSBNaW47ICAgDQoNCgkJdmFyIFJhbmQgPSBNYXRoLnJhbmRvbSgpOyAgIA0KDQoJCXJldHVybihNaW4gKyBNYXRoLnJvdW5kKFJhbmQgKiBSYW5nZSkpOyAgIA0KDQoJfSwgICANCg0KCQ0KDQoJaW5pdCA6IGZ1bmN0aW9uKGNvbmZpZyl7DQoNCgkJaWYoY29uZmlnICYmIGNvbmZpZy5wYWdlTG9hZGluZ0NpcmNsZSkNCg0KCQl7DQoNCgkJCXRoaXMuaXNQYWdlTG9hZGluZ0NpcmNsZSA9IGNvbmZpZy5wYWdlTG9hZGluZ0NpcmNsZTsNCg0KCQl9DQoNCgl9LA0KDQoJDQoNCglwYWdlTG9hZGluZ0NpcmNsZSA6IGZ1bmN0aW9uKCl7DQoNCgkJaWYodGhpcy5pc1BhZ2VMb2FkaW5nQ2lyY2xlKQ0KDQoJCXsNCg0KCQkJdG9wLkxPQ0tfT1BFUkFUSU9OX0tFWSA9IHRoaXMuUEdfTE9BRF9DSVJDTEU7DQoNCgkJCXZhciBvcGVyYXRpb25LZXkgPSB0aGlzLnJlbmRlcigpOw0KDQoJCQl2YXIgb25sb2FkRm4gPSBmdW5jdGlvbihvcGVyYXRpb25LZXkpew0KCQkJCQ0KCQkJCXRvcC5MT0NLX09QRVJBVElPTl9LRVkgPSAiaW52YWxpZGF0aW9uIjsNCgkJCQkNCgkJCQl0aGlzLmRlc3Ryb3kob3BlcmF0aW9uS2V5KTsNCg0KCQkJfS5iaW5kKHRoaXMsb3BlcmF0aW9uS2V5KTsNCg0KCQkJQWMzNjAuYXR0YWNoRXZlbnQod2luZG93LCJvbmxvYWQiLG9ubG9hZEZuKTsNCg0KCQl9DQoNCgkJZWxzZQ0KDQoJCXsNCg0KCQkJaWYodG9wLkxPQ0tfT1BFUkFUSU9OX0tFWSAhPSB0aGlzLlBHX0xPQURfQ0lSQ0xFKQ0KDQoJCQl7DQoNCgkJCQl0aGlzLmZvcmNlRGVzdHJveSh0aGlzLmdldFRhcmdldERvYygpLnRhcmdldERvYyk7DQoNCgkJCX0NCg0KCQl9DQoNCgl9LA0KDQoJDQoNCgljcmVhdGVPcGVyYXRpb25LZXkgOiBmdW5jdGlvbigpew0KDQoJCXJldHVybiAgIlBCT19PUEVSQVRJT05fS0VZXyIgKyB0aGlzLmdldFJhbmRvbU51bSgxMDAwMCw5OTk5OTkpOw0KDQoJfSwNCg0KCQ0KDQoJcmVuZGVyIDogZnVuY3Rpb24oKXsNCg0KCQl0cnl7DQoJCQkNCgkJCXZhciBmcmFtZUVsZSA9IHNjcm9sbEJhcklzc3VlLmdldEZyYW1lRWxlbWVudChkb2N1bWVudCk7DQoJCQkNCgkJCWlmKCFvbGRVSSB8fCBzY3JvbGxCYXJJc3N1ZS5pc1RvcElmcmFtZShmcmFtZUVsZSkpDQoNCgkJCXsNCg0KCQkJCXJldHVybjsNCg0KCQkJfQ0KDQoJCQl2YXIgcmVzdWx0ID0gdGhpcy5nZXRUYXJnZXREb2MoKTsNCg0KCQkJdmFyIHRhcmdldERvYyA9IHJlc3VsdC50YXJnZXREb2M7DQoNCgkJCXZhciBQQk8gPSB0YXJnZXREb2MuZ2V0RWxlbWVudEJ5SWQodGhpcy5QQk9JRCk7DQoNCgkJCXZhciBjaGVja1Jlc3VsdCA9IHRoaXMuY2hlY2tTaG93Q29uZGl0aW9uKHRhcmdldERvYywgUEJPLCByZXN1bHQuaXNBYzM2MFBvcFVwRG9jKTsNCg0KCQkJaWYoY2hlY2tSZXN1bHQgIT0gIk9LIikge3JldHVybiBjaGVja1Jlc3VsdDt9DQoNCgkJCXZhciBuZXdPcGVyYXRpb25LZXkgPSB0aGlzLmNyZWF0ZU9wZXJhdGlvbktleSgpOw0KDQoJCQl0aGlzLnBvcFVwUHJvY2VzcyhyZXN1bHQuaXNQb3BVcFdpbmRvdyxyZXN1bHQuaXNBYzM2MFBvcFVwRG9jLG5ld09wZXJhdGlvbktleSk7DQoNCgkJCWlmKCFzY3JvbGxCYXJJc3N1ZS5qdWRnZUlzT2JqKFBCTykpDQoNCgkJCXsNCg0KCQkJCVBCTyA9IGZ1bmN0aW9uKFBCT0lELFBCT19JTUdfSUQpew0KDQoJCQkJCXZhciBKQ0MgPSB0YXJnZXREb2MuZ2V0RWxlbWVudEJ5SWQoc2Nyb2xsQmFySXNzdWUuSkVUU1BFRURfQ09OVEVOVF9DT05UQUlORVJfSUQpOw0KDQoJCQkJCXZhciAgUEJPX0JHX0lGUkFNRSA9IHRhcmdldERvYy5jcmVhdGVFbGVtZW50KCJJRlJBTUUiKTsNCg0KCQkJCQlQQk9fQkdfSUZSQU1FLmlkID0gUEJPSUQrIl9JRlJBTUUiOw0KDQoJCQkJCVBCT19CR19JRlJBTUUuc3R5bGUubGVmdCA9ICIwcHgiOw0KDQoJCQkJCVBCT19CR19JRlJBTUUuc3R5bGUuekluZGV4ID0gIjIxNDc0ODM2NDUiOw0KDQoJCQkJCVBCT19CR19JRlJBTUUuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOw0KDQoJCQkJCVBCT19CR19JRlJBTUUuc3R5bGUudG9wID0gc2Nyb2xsQmFySXNzdWUuanVkZ2VJc09iaihKQ0MpID8gSkNDLm9mZnNldFRvcCsicHgiIDogIjBweCI7DQoNCgkJCQkJUEJPX0JHX0lGUkFNRS5zdHlsZS5vcGFjaXR5ID0gIjAuNSI7DQoJCQkJCQ0KCQkJCQl2YXIgUEJPX0JHX0RJViA9IHRhcmdldERvYy5jcmVhdGVFbGVtZW50KCJESVYiKTsNCg0KCQkJCQlQQk9fQkdfRElWLmlkID0gUEJPSUQ7DQoNCgkJCQkJUEJPX0JHX0RJVi5zdHlsZS5sZWZ0ID0gIjBweCI7DQoNCgkJCQkJUEJPX0JHX0RJVi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KDQoJCQkJCVBCT19CR19ESVYuc3R5bGUuekluZGV4ID0gIjIxNDc0ODM2NDYiOw0KDQoJCQkJCVBCT19CR19ESVYuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOw0KDQoJCQkJCVBCT19CR19ESVYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIndoaXRlIjsNCg0KCQkJCQlQQk9fQkdfRElWLnN0eWxlLnRvcCA9IHNjcm9sbEJhcklzc3VlLmp1ZGdlSXNPYmooSkNDKSA/IEpDQy5vZmZzZXRUb3ArInB4IiA6ICIwcHgiOw0KDQoJCQkJCVBCT19CR19ESVYuc3R5bGUub3BhY2l0eSA9ICIwLjUiOw0KDQoJCQkJCXZhciBQQk9fSU1HID0gdGFyZ2V0RG9jLmNyZWF0ZUVsZW1lbnQoIklNRyIpOw0KDQoJCQkJCVBCT19JTUcuc3JjID0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgKyAiLy8iKyBkb2N1bWVudC5sb2NhdGlvbi5ob3N0ICsgIi9wb3J0bGV0cy9pMThuL2VuX2F1L2ltYWdlcy9wYWdlTG9hZGluZy5naWYiOw0KDQoJCQkJCVBCT19JTUcuc3R5bGUucG9zaXRpb249ImFic29sdXRlIjsNCg0KCQkJCQlQQk9fSU1HLmlkID0gUEJPX0lNR19JRDsNCg0KCQkJCQlQQk9fQkdfRElWLmFwcGVuZENoaWxkKFBCT19JTUcpOw0KDQoJCQkJCXRhcmdldERvYy5ib2R5LmFwcGVuZENoaWxkKFBCT19CR19ESVYpOw0KDQoJCQkJCXRhcmdldERvYy5ib2R5LmFwcGVuZENoaWxkKFBCT19CR19JRlJBTUUpOw0KDQoJCQkJCXJldHVybiBQQk9fQkdfRElWOw0KDQoJCQkJfSh0aGlzLlBCT0lELHRoaXMuUEJPX0lNR19JRCk7DQoNCgkJCX0NCg0KCQkJdGhpcy5kaXNwbGF5KCk7DQoNCgkJCVBCTy5vcGVyYXRpb25LZXkgPSBuZXdPcGVyYXRpb25LZXk7DQoNCgkJCXJldHVybiBQQk8ub3BlcmF0aW9uS2V5Ow0KDQoJCX1jYXRjaChlKXt9DQoNCgl9LA0KDQoJDQoNCglnZXRMb2NhdGlvbkNvb3JkaW5hdGUgOiBmdW5jdGlvbih0YXJnZXREb2Mpew0KDQoJCXZhciB0b3BDb29yZGluYXRlID0gMDsNCg0KCQl2YXIgSkNDID0gdGFyZ2V0RG9jLmdldEVsZW1lbnRCeUlkKHNjcm9sbEJhcklzc3VlLkpFVFNQRUVEX0NPTlRFTlRfQ09OVEFJTkVSX0lEKTsNCg0KCQl2YXIgY2xpZW50SGVpZ2h0ID0gdGFyZ2V0RG9jLmJvZHkuY2xpZW50SGVpZ2h0Ow0KDQoJCXZhciBjbGllbnRXaWR0aCA9IHRhcmdldERvYy5ib2R5LmNsaWVudFdpZHRoOw0KDQoJCWlmKHNjcm9sbEJhcklzc3VlLmp1ZGdlSXNPYmoodGFyZ2V0RG9jLmRvY3VtZW50RWxlbWVudCkgJiYgdGFyZ2V0RG9jLmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgPiAwKQ0KDQoJCXsNCg0KCQkJY2xpZW50V2lkdGggPSB0YXJnZXREb2MuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDsNCg0KCQl9DQoNCgkJaWYoc2Nyb2xsQmFySXNzdWUuanVkZ2VJc09iaih0YXJnZXREb2MuZG9jdW1lbnRFbGVtZW50KSAmJiB0YXJnZXREb2MuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoID4gMCkNCg0KCQl7DQoNCgkJCWNsaWVudFdpZHRoID0gdGFyZ2V0RG9jLmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDsNCg0KCQl9DQoJCQ0KCQlpZihjbGllbnRIZWlnaHQgPT0gMCkNCgkJCQ0KCQl7DQoJCQkNCgkJCXZhciBoZWFkZXIgPSB0YXJnZXREb2MucXVlcnlTZWxlY3RvcigiaGVhZGVyW2NsYXNzPSdhcHBsaWNhdGlvbi1iYXIgbGF5ZXItMiBuZy1zY29wZSddIik7DQoJCQkNCgkJCXZhciBzZWN0aW9uID0gdGFyZ2V0RG9jLnF1ZXJ5U2VsZWN0b3IoInNlY3Rpb25bY2xhc3M9J21haW4tY29udGFpbmVyIGFkbWluLXZpZXcnXSIpOw0KCQkJDQoJCQljbGllbnRIZWlnaHQgKz0gaGVhZGVyID8gaGVhZGVyLm9mZnNldEhlaWdodCA6IDA7DQoJCQkNCgkJCWNsaWVudEhlaWdodCArPSBzZWN0aW9uID8gc2VjdGlvbi5vZmZzZXRIZWlnaHQgOiAwOw0KCQkJDQoJCX0NCgkJDQoJCWlmKGNsaWVudFdpZHRoID09IDApDQoJCQkNCgkJew0KCQkJdmFyIHNlY3Rpb24gPSByZXN1bHQudGFyZ2V0RG9jLnF1ZXJ5U2VsZWN0b3IoInNlY3Rpb25bY2xhc3M9J21haW4tY29udGFpbmVyIGFkbWluLXZpZXcnXSIpOw0KDQoJCQljbGllbnRXaWR0aCA9IGhlYWRlci5vZmZzZXRXaWR0aA0KCQkJDQoJCX0NCg0KCQlpZihzY3JvbGxCYXJJc3N1ZS5qdWRnZUlzT2JqKEpDQykpDQoNCgkJew0KDQoJCQlpZihKQ0Mub2Zmc2V0VG9wID4gdGFyZ2V0RG9jLmJvZHkuc2Nyb2xsVG9wKQ0KDQoJCQl7DQoNCgkJCQl0b3BDb29yZGluYXRlID0gKGNsaWVudEhlaWdodCAtIEpDQy5vZmZzZXRUb3AgKyB0YXJnZXREb2MuYm9keS5zY3JvbGxUb3ApIC8gMjsNCg0KCQkJfQ0KDQoJCQllbHNlIGlmKEpDQy5vZmZzZXRUb3AgPCB0YXJnZXREb2MuYm9keS5zY3JvbGxUb3ApDQoNCgkJCXsNCg0KCQkJCXRvcENvb3JkaW5hdGUgPSBjbGllbnRIZWlnaHQgLyAyICsgdGFyZ2V0RG9jLmJvZHkuc2Nyb2xsVG9wIC0gSkNDLm9mZnNldFRvcDsNCg0KCQkJfQ0KDQoJCX0NCg0KCQllbHNlDQoNCgkJew0KDQoJCQl0b3BDb29yZGluYXRlID0gY2xpZW50SGVpZ2h0IC8gMiArIHRhcmdldERvYy5ib2R5LnNjcm9sbFRvcDsNCg0KCQl9DQoNCgkJdmFyIGxlZnRDb29yZGluYXRlID0gY2xpZW50V2lkdGggLyAyIC0gMTY7DQoNCgkJcmV0dXJuIHsidG9wIiA6IHRvcENvb3JkaW5hdGUsICJsZWZ0IiA6IGxlZnRDb29yZGluYXRlfTsNCg0KCX0sDQoNCgkNCg0KCWlzSTE4Tkxhbmd1YWdlIDogZnVuY3Rpb24odGFyZ2V0RG9jKXsNCg0KCQl2YXIgZGlyZWN0aW9uVmFsID0gIiI7DQoJCQ0KCQlpZihzY3JvbGxCYXJJc3N1ZS5qdWRnZUlzT2JqKHRhcmdldERvYy5ib2R5LnJ1bnRpbWVTdHlsZSkpDQoJCXsNCgkJCWRpcmVjdGlvblZhbCA9IHRhcmdldERvYy5ib2R5LnJ1bnRpbWVTdHlsZS5kaXJlY3Rpb247DQoJCX0NCg0KCQlpZihzY3JvbGxCYXJJc3N1ZS5qdWRnZUlzTnVsbChkaXJlY3Rpb25WYWwpKQ0KDQoJCXsNCgkJCXZhciBjdXJyZW50U3R5bGUgPSBzY3JvbGxCYXJJc3N1ZS5nZXRDdXJyZW50U3R5bGUodGFyZ2V0RG9jLCB0YXJnZXREb2MuYm9keSk7DQoJCQkNCgkJCWRpcmVjdGlvblZhbCA9IGN1cnJlbnRTdHlsZS5kaXJlY3Rpb247DQoNCgkJfQ0KDQoJCWlmKHNjcm9sbEJhcklzc3VlLmp1ZGdlSXNOdWxsKGRpcmVjdGlvblZhbCkpDQoNCgkJew0KDQoJCQlkaXJlY3Rpb25WYWwgPSB0YXJnZXREb2MuYm9keS5zdHlsZS5kaXJlY3Rpb247DQoNCgkJfQkJDQoNCgkJaWYoc2Nyb2xsQmFySXNzdWUuanVkZ2VJc05vdE51bGwoZGlyZWN0aW9uVmFsKSkNCg0KCQl7DQoNCgkJCXJldHVybiBkaXJlY3Rpb25WYWwudG9VcHBlckNhc2UoKSA9PSAiUlRMIiA/IHRydWUgOiBmYWxzZTsNCg0KCQl9DQoNCgkJcmV0dXJuIGZhbHNlOw0KDQoJfSwNCg0KCQ0KDQoJZGlzcGxheSA6IGZ1bmN0aW9uKCkNCg0KCXsNCg0KCQl2YXIgcmVzdWx0ID0gdGhpcy5nZXRUYXJnZXREb2MoKTsNCgkJDQoJCXZhciBQQk9fSUZSQU1FID0gcmVzdWx0LnRhcmdldERvYy5nZXRFbGVtZW50QnlJZCh0aGlzLlBCT0lEICsgIl9JRlJBTUUiKTsNCg0KCQl2YXIgUEJPID0gcmVzdWx0LnRhcmdldERvYy5nZXRFbGVtZW50QnlJZCh0aGlzLlBCT0lEKTsNCg0KCQl2YXIgUEJPX0lNRyA9IHJlc3VsdC50YXJnZXREb2MuZ2V0RWxlbWVudEJ5SWQodGhpcy5QQk9fSU1HX0lEKTsNCg0KCQlQQk8uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoNCgkJdmFyIEpDQyA9IHJlc3VsdC50YXJnZXREb2MuZ2V0RWxlbWVudEJ5SWQoc2Nyb2xsQmFySXNzdWUuSkVUU1BFRURfQ09OVEVOVF9DT05UQUlORVJfSUQpOw0KDQoJCXZhciBKQ0NfT0ZGU0VUX1RPUCA9IHNjcm9sbEJhcklzc3VlLmp1ZGdlSXNPYmooSkNDKSA/IEpDQy5vZmZzZXRUb3AgOiAwOw0KDQoJCXZhciBtYXhWYWx1ZSA9IHNjcm9sbEJhcklzc3VlLmZpbmRTdWJOb2Rlc01heFZhbHVlKHJlc3VsdC50YXJnZXREb2MuYm9keSk7DQoNCgkJaWYoc2Nyb2xsQmFySXNzdWUuanVkZ2VJc051bGwobWF4VmFsdWUpKQ0KDQoJCXsNCg0KCQkJSkNDX09GRlNFVF9UT1AgPSBtYXhWYWx1ZS5vdmVyZmxvd194ID8gc2Nyb2xsQmFySXNzdWUuU0NST0xMX0JBUl9TSVpFICsgSkNDX09GRlNFVF9UT1AgOiBKQ0NfT0ZGU0VUX1RPUDsNCg0KCQl9DQoJCQ0KCQl2YXIgcmVzdWx0SGVpZ2h0ID0gKG1heFZhbHVlLm1heF9oZWlnaHQgLSBKQ0NfT0ZGU0VUX1RPUCkgPiAocmVzdWx0LnRhcmdldERvYy5ib2R5LnNjcm9sbEhlaWdodCArIHJlc3VsdC50YXJnZXREb2MuYm9keS5zY3JvbGxUb3AgLSBKQ0NfT0ZGU0VUX1RPUCkgPyANCg0KCQkJCQkJICAgIG1heFZhbHVlLm1heF9oZWlnaHQgLSBKQ0NfT0ZGU0VUX1RPUCA6IA0KDQoJCQkJCQkgICAocmVzdWx0LnRhcmdldERvYy5ib2R5LnNjcm9sbEhlaWdodCArIHJlc3VsdC50YXJnZXREb2MuYm9keS5zY3JvbGxUb3AgLSBKQ0NfT0ZGU0VUX1RPUCk7DQoNCgkJcmVzdWx0SGVpZ2h0ID0gcmVzdWx0LmlzUG9wVXBXaW5kb3cgPyByZXN1bHRIZWlnaHQgLSA0IDogcmVzdWx0SGVpZ2h0Ow0KCQkNCgkJaWYocmVzdWx0SGVpZ2h0ID09IDApDQoJCQkNCgkJew0KCQkJDQoJCQl2YXIgaGVhZGVyID0gcmVzdWx0LnRhcmdldERvYy5xdWVyeVNlbGVjdG9yKCJoZWFkZXJbY2xhc3M9J2FwcGxpY2F0aW9uLWJhciBsYXllci0yIG5nLXNjb3BlJ10iKTsNCgkJCQ0KCQkJdmFyIHNlY3Rpb24gPSByZXN1bHQudGFyZ2V0RG9jLnF1ZXJ5U2VsZWN0b3IoInNlY3Rpb25bY2xhc3M9J21haW4tY29udGFpbmVyIGFkbWluLXZpZXcnXSIpOw0KCQkJDQoJCQlyZXN1bHRIZWlnaHQgKz0gaGVhZGVyID8gaGVhZGVyLm9mZnNldEhlaWdodCA6IDA7DQoJCQkNCgkJCXJlc3VsdEhlaWdodCArPSBzZWN0aW9uID8gc2VjdGlvbi5vZmZzZXRIZWlnaHQgOiAwOw0KCQkJDQoJCX0NCg0KCQl2YXIgUEJPX1cgPSBzY3JvbGxCYXJJc3N1ZS5pc0FDMzYwUG9wVXAocmVzdWx0LnRhcmdldERvYykuaXNBQzM2MFBvcFVwID8gcmVzdWx0LnRhcmdldERvYy5ib2R5LnNjcm9sbFdpZHRoIDogbWF4VmFsdWUubWF4X3dpZHRoOw0KDQoJCVBCTy5zdHlsZS53aWR0aCA9IFBCT19XID09IDAgPyByZXN1bHQudGFyZ2V0RG9jLmJvZHkuc2Nyb2xsV2lkdGggLSA0IDogUEJPX1cgKyAicHgiOw0KDQoJCVBCTy5zdHlsZS5oZWlnaHQgPSByZXN1bHRIZWlnaHQgKyAicHgiOw0KCQkNCgkJUEJPX0lGUkFNRS5zdHlsZS53aWR0aCA9IFBCT19XID09IDAgPyByZXN1bHQudGFyZ2V0RG9jLmJvZHkuc2Nyb2xsV2lkdGggLSA0IDogUEJPX1cgKyAicHgiOw0KCQkNCgkJUEJPX0lGUkFNRS5zdHlsZS5oZWlnaHQgPSByZXN1bHRIZWlnaHQgKyAicHgiOw0KDQoJCXZhciBjb29yZGluYXRlVmFsID0gdGhpcy5nZXRMb2NhdGlvbkNvb3JkaW5hdGUocmVzdWx0LnRhcmdldERvYyk7DQoNCgkJaWYodGhpcy5pc0kxOE5MYW5ndWFnZShyZXN1bHQudGFyZ2V0RG9jKSkNCg0KCQl7DQoNCgkJCVBCT19JTUcuc3R5bGUucmlnaHQgPSBjb29yZGluYXRlVmFsLmxlZnQgKyAicHgiOw0KDQoJCX0NCg0KCQllbHNlDQoNCgkJew0KDQoJCQlQQk9fSU1HLnN0eWxlLmxlZnQgPSBjb29yZGluYXRlVmFsLmxlZnQgKyAicHgiOw0KDQoJCX0NCg0KCQlQQk9fSU1HLnN0eWxlLnRvcCA9IGNvb3JkaW5hdGVWYWwudG9wICsgInB4IjsNCg0KCX0sDQoNCgkNCg0KCWRlc3Ryb3kgOiBmdW5jdGlvbihvcGVyYXRpb25LZXkpew0KDQoJCXRyeXsNCg0KCQkJdmFyIHJlc3VsdCA9IHRoaXMuZ2V0VGFyZ2V0RG9jKCk7DQoNCgkJCXZhciBQQk8gPSByZXN1bHQudGFyZ2V0RG9jLmdldEVsZW1lbnRCeUlkKHRoaXMuUEJPSUQpOw0KDQoJCQl2YXIgUEJPX0lGUkFNRSA9IHJlc3VsdC50YXJnZXREb2MuZ2V0RWxlbWVudEJ5SWQodGhpcy5QQk9JRCArICJfSUZSQU1FIik7DQoNCgkJCWlmKG9wZXJhdGlvbktleSA9PSBQQk8ub3BlcmF0aW9uS2V5KQ0KDQoJCQl7DQoNCgkJCQlpZihzY3JvbGxCYXJJc3N1ZS5qdWRnZUlzT2JqKFBCTykpDQoNCgkJCQl7DQoNCgkJCQkJaWYoIXNjcm9sbEJhcklzc3VlLmp1ZGdlSXNIaWRkZW4oUEJPKSkNCg0KCQkJCQl7DQoNCgkJCQkJCVBCTy5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KDQoJCQkJCQlQQk9fSUZSQU1FLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJCQkNCgkJCQkJCXRvcC5MT0NLX09QRVJBVElPTl9LRVkgPSAiaW52YWxpZGF0aW9uIjsNCg0KCQkJCQl9DQoNCgkJCQl9DQoNCgkJCQlpZihyZXN1bHQuaXNBYzM2MFBvcFVwRG9jKQ0KDQoJCQkJewkJCQkJCQ0KDQoJCQkJCXRvcC5MT0NLX09QRVJBVElPTl9LRVkgPSAiaW52YWxpZGF0aW9uIjsNCg0KCQkJCX0NCg0KCQkJfQ0KDQoJCX1jYXRjaChlKXt9DQoNCgl9LA0KDQoJDQoNCglnZXRDdXN0b21BdHRyaWJ1dGUgOiBmdW5jdGlvbihhdHROYW1lKXsNCg0KCQl0cnl7DQoNCgkJCWlmKGF0dE5hbWUpDQoNCgkJCXsNCg0KCQkJCXZhciBzcmNFbGUgPSB3aW5kb3cuZXZlbnQuc3JjRWxlbWVudDsNCg0KCQkJCXZhciBpbmRleCA9IDA7DQoNCgkJCQl3aGlsZShzcmNFbGUubm9kZU5hbWUudG9VcHBlckNhc2UoKSAhPSAiQSIgJiYgaW5kZXggPCA1KQ0KDQoJCQkJew0KDQoJCQkJCXNyY0VsZSA9IHNyY0VsZS5wYXJlbnROb2RlOw0KDQoJCQkJCWluZGV4Kys7DQoNCgkJCQl9DQoNCgkJCQlyZXR1cm4gc3JjRWxlLmdldEF0dHJpYnV0ZShhdHROYW1lKTsNCg0KCQkJfQ0KDQoJCX1jYXRjaChlKXt9DQoNCgkJcmV0dXJuIGZhbHNlOw0KDQoJfSwNCg0KCQ0KDQoJY2hlY2tTaG93Q29uZGl0aW9uIDogZnVuY3Rpb24odGFyZ2V0RG9jLFBCTyxpc0FjMzYwUG9wVXBEb2Mpew0KDQoJCWlmKCFzY3JvbGxCYXJJc3N1ZS5qdWRnZUlzTnVsbCh3aW5kb3cuZXZlbnQpICYmIHRoaXMuZ2V0Q3VzdG9tQXR0cmlidXRlKCJjaXJjbGUiKSA9PSAiZmFsc2UiKQ0KDQoJCXsNCg0KCQkJcmV0dXJuIHNjcm9sbEJhcklzc3VlLmp1ZGdlSXNPYmooUEJPKSA/IFBCTy5vcGVyYXRpb25LZXkgOiAiIjsNCg0KCQl9DQoNCgkJZWxzZSBpZihzY3JvbGxCYXJJc3N1ZS5qdWRnZUlzT2JqKHdpbmRvdy5ldmVudCkgJiYgd2luZG93LmV2ZW50LnR5cGUudG9VcHBlckNhc2UoKSA9PSAiQkxVUiIpDQoNCgkJew0KDQoJCQkvL2lnbm9yZSAib25ibHVyIiBldmVudCB0byB0cmlnZ2VyIHByb2Nlc3MgY2lyY2xlIHNob3cuDQoNCgkJCXJldHVybiBzY3JvbGxCYXJJc3N1ZS5qdWRnZUlzT2JqKFBCTykgPyBQQk8ub3BlcmF0aW9uS2V5IDogIiI7DQoNCgkJfQ0KDQoJCWVsc2UgaWYoIWlzQWMzNjBQb3BVcERvYyAmJiB0aGlzLmlzTG9ja2VkKHRhcmdldERvYykpDQoNCgkJew0KDQoJCQlyZXR1cm4gc2Nyb2xsQmFySXNzdWUuanVkZ2VJc09iaihQQk8pID8gUEJPLm9wZXJhdGlvbktleSA6ICIiOw0KDQoJCX0NCg0KCQlyZXR1cm4gIk9LIjsNCg0KCX0sDQoNCgkNCg0KCXBvcFVwUHJvY2VzcyA6IGZ1bmN0aW9uKGlzUG9wVXBXaW5kb3csaXNBYzM2MFBvcFVwRG9jLG9wZXJhdGlvbktleSl7DQoNCgkJdHJ5ew0KDQoJCQlpZihpc1BvcFVwV2luZG93KQ0KDQoJCQl7DQoNCgkJCQkvL2ZvcmNlIHN0b3AgcHJvY2VzcyBjaXJjbGUgb2YgcGFyZW50IHdpbmRvdyB0byBkaXNwbGF5Lg0KDQoJCQkJdGhpcy5mb3JjZURlc3Ryb3kod2luZG93Lm9wZW5lci5kb2N1bWVudCk7DQoNCgkJCX0NCg0KCQkJZWxzZSBpZihpc0FjMzYwUG9wVXBEb2MpDQoNCgkJCXsNCg0KCQkJCS8vc3RvcCBwcm9jZXNzIGNpcmNsZSBhdCB0aGUgYmVoaW5kIG9mIFYzNjAgUG9wVXAgdG8gZGlzcGxheQ0KDQoJCQkJdG9wLkxPQ0tfT1BFUkFUSU9OX0tFWSA9IG9wZXJhdGlvbktleTsNCg0KCQkJfQ0KDQoJCX1jYXRjaChlKXt9Ow0KDQoJfSwNCg0KCQ0KDQoJZm9yY2VEZXN0cm95IDogZnVuY3Rpb24odGFyZ2V0RG9jKXsNCg0KCQl0cnl7DQoNCgkJCXZhciBQQk8gPSB0YXJnZXREb2MuZ2V0RWxlbWVudEJ5SWQodGhpcy5QQk9JRCk7DQoNCgkJCXZhciBQQk9fSUZSQU1FID0gdGFyZ2V0RG9jLmdldEVsZW1lbnRCeUlkKHRoaXMuUEJPSUQrIl9JRlJBTUUiKTsNCg0KCQkJaWYoIXNjcm9sbEJhcklzc3VlLmp1ZGdlSXNIaWRkZW4oUEJPKSkNCg0KCQkJew0KDQoJCQkJUEJPLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoNCgkJCQlQQk9fSUZSQU1FLnN0eWxlLmRpc3BsYXk9Im5vbmUiOw0KDQoJCQl9DQoNCgkJfWNhdGNoKGUpe30NCg0KCX0sDQoNCgkNCg0KCWZvcmNlRGVzdHJveUV4Y2VwdFBhZ2VMb2FkaW5nIDogZnVuY3Rpb24odGFyZ2V0RG9jKXsNCg0KCQlpZih0b3AuTE9DS19PUEVSQVRJT05fS0VZICE9IHRoaXMuUEdfTE9BRF9DSVJDTEUpDQoNCgkJew0KDQoJCQl0aGlzLmZvcmNlRGVzdHJveSh0YXJnZXREb2MpOw0KDQoJCX0NCg0KCX0sDQoNCgkNCg0KCWlzTG9ja2VkIDogZnVuY3Rpb24odGFyZ2V0RG9jKXsNCg0KCQlpZighc2Nyb2xsQmFySXNzdWUuanVkZ2VJc051bGwodG9wLkxPQ0tfT1BFUkFUSU9OX0tFWSkgJiYgdG9wLkxPQ0tfT1BFUkFUSU9OX0tFWS5pbmRleE9mKCJQQk9fT1BFUkFUSU9OX0tFWV8iKSA+IC0xKQ0KDQoJCXsNCg0KCQkJcmV0dXJuIHRydWU7DQoNCgkJfQ0KDQoJCXJldHVybiBmYWxzZTsNCg0KCX0sDQoNCgkNCg0KCWdldFRhcmdldERvYyA6IGZ1bmN0aW9uKCl7DQoNCgkJdmFyIHJlc3VsdCA9IHNjcm9sbEJhcklzc3VlLmlzQUMzNjBQb3BVcChkb2N1bWVudCk7DQoNCgkJdmFyIHRhcmdldERvYyA9IHJlc3VsdC5pc0FDMzYwUG9wVXAgPyBzY3JvbGxCYXJJc3N1ZS5nZXREb2N1bWVudEZyb21GcmFtZShyZXN1bHQuQUMzNjBQb3BVcE9iaikgOiBBYzM2MC5nZXRUb3BEb2N1bWVudCgpOw0KDQoJCXJldHVybiB7InRhcmdldERvYyIgOiB0YXJnZXREb2MsICJpc0FjMzYwUG9wVXBEb2MiIDogcmVzdWx0LmlzQUMzNjBQb3BVcCwgImlzUG9wVXBXaW5kb3ciIDogc2Nyb2xsQmFySXNzdWUuaXNQb3BVcFdpbmRvdyhkb2N1bWVudCl9Ow0KDQoJfSwNCg0KCQ0KDQoJYWRkRGVmYXVsdEV2ZW50IDogZnVuY3Rpb24oKXt9LA0KDQoJDQoNCglnZXRPdXRlckhUTUwgOiBmdW5jdGlvbihkYXRhKXt9DQoNCn0pOw0KDQpXaWRnZXRNYW5hZ2VyLnJlZ2lzdGVyV2lkZ2V0KCJwcm9jZXNzQmFyIiwgVUkuUHJvY2Vzc0Jhcik7LyoqDQoNCiAqIA0KDQogKiBWMzYwICANCg0KICogRmlsZTogVGltZS5qcw0KDQogKiANCg0KICogQWNjZWxhLCBJbmMuDQoNCiAqIENvcHlyaWdodCAoQyk6IDIwMTItMjAxNA0KDQogKiANCg0KICogRGVzY3JpcHRpb246DQoNCiAqIDw8R2VuZXJhbCBkZXNjcmlwdGlvbiBvZiB0aGUgY2xhc3M+Pg0KDQogKiANCg0KICogTm90ZXM6DQoNCiAqIDw8U3BlY2lmaWMgcHJvZ3JhbW1pbmcgbm90ZXM+Pg0KDQogKiANCg0KICoNCg0KICovDQoNCg0KVUkuVGltZSA9IG5ldyBVSS5Db21wb25lbnQoKTsNCg0KVUkuVGltZS5leHRlbmQoew0KDQogICAgDQoNCmluaXQgOiBmdW5jdGlvbihjb25maWcpew0KDQogICAgICAgIHRoaXMuaWQgPSBjb25maWcuaWQgfHwgdGhpcy5nZXRJZCgpOw0KDQogICAgICAgIHRoaXMubmFtZSA9IGNvbmZpZy5uYW1lIHx8IHRoaXMuZ2V0SWQoKTsNCg0KICAgICAgICB0aGlzLmFjY2Vzc0tleSA9IGNvbmZpZy5hY2Nlc3NLZXkgfHwgIiI7DQoNCiAgICAgICAgdGhpcy5hbGlnbiA9IGNvbmZpZy5hbGlnbiB8fCAiIjsNCg0KICAgICAgICB0aGlzLnZhbHVlID0gY29uZmlnLnZhbHVlIHx8ICIiOw0KDQogICAgICAgIHRoaXMuY2xhc3NOYW1lID0gY29uZmlnLmNsYXNzTmFtZSB8fCAiIjsNCg0KICAgICAgICB0aGlzLmRpc2FibGVkID0gY29uZmlnLmRpc2FibGVkIHx8IGZhbHNlOw0KDQogICAgICAgIHRoaXMucmVhZE9ubHkgPSBjb25maWcucmVhZE9ubHkgfHwgZmFsc2U7DQoNCiAgICAgICAgdGhpcy5tdWx0aXBsZSA9IGNvbmZpZy5tdWx0aXBsZSB8fCBmYWxzZTsNCg0KICAgICAgICB0aGlzLnN0eWxlID0gY29uZmlnLnN0eWxlOw0KDQogICAgICAgIHRoaXMudGFiSW5kZXggPSBjb25maWcudGFiSW5kZXg7DQoNCiAgICAgICAgdGhpcy5pdGVtcyA9IGNvbmZpZy5pdGVtcyB8fCBbXTsNCg0KICAgICAgICB0aGlzLmNvbnRhaW5lcklkID0gY29uZmlnLmNvbnRhaW5lcklkOw0KDQogICAgICAgIHRoaXMuZXZlbnRNYXAgPSBjb25maWcuZXZlbnRNYXB8fHt9Ow0KDQogICAgICAgIHRoaXMuc3VwcG9ydEV2ZW50cyA9IGNvbmZpZy5zdXBwb3J0RXZlbnRzIHx8IFsiY2hhbmdlIl07DQoNCg0KICAgICAgICB0aGlzLmhvdXIgPSBjb25maWcuaG91cjsNCg0KICAgICAgICB0aGlzLm1pbnV0ZSA9IGNvbmZpZy5taW51dGU7DQoNCiAgICAgICAgdGhpcy5hbVBtVmFsdWUgPSBjb25maWcuYW1QbVZhbHVlOw0KDQogICAgICAgIHRoaXMuYW1wbSA9IGNvbmZpZy5hbXBtOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgcmVuZGVyIDogZnVuY3Rpb24oKXsNCg0KICAgICAgICB2YXIgc2VsZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0Jyk7DQoNCiAgICAgICAgc2VsZWN0Lm5hbWUgPSB0aGlzLm5hbWUrJ19ob3VyJzsNCg0KICAgICAgICBzZWxlY3QuaWQgPSB0aGlzLmlkKydfaG91cic7DQoNCiAgICAgICAgaWYodGhpcy5hY2Nlc3NLZXkpew0KDQogICAgICAgICAgICBzZWxlY3QuYWNjZXNzS2V5ID0gdGhpcy5hY2Nlc3NLZXk7DQoNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgaWYodGhpcy52YWx1ZSl7DQoNCiAgICAgICAgICAgIHNlbGVjdC52YWx1ZSA9IHRoaXMudmFsdWU7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIA0KDQogICAgICAgIHRoaXMuY3JlYXRlT3B0aW9ucygyNCwgc2VsZWN0KTsNCg0KICAgICAgIA0KDQogICAgICAgIHRoaXMuYmluZEV2ZW50cyhzZWxlY3QsdGhpcy5ldmVudE1hcCx0aGlzLnN1cHBvcnRFdmVudHMpOw0KDQogICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmNvbnRhaW5lcklkKTsNCg0KICAgICAgICANCg0KICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOw0KDQogICAgICAgIGxhYmVsLmlubmVySFRNTCA9ICImbmJzcDs6Jm5ic3A7Jm5ic3A7IjsNCg0KICAgICAgICANCg0KICAgICAgICB2YXIgbWludXRlU2VsZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0Jyk7DQoNCiAgICAgICAgbWludXRlU2VsZWN0Lm5hbWUgPSB0aGlzLm5hbWUrJ19taW51dGUnOw0KDQogICAgICAgIG1pbnV0ZVNlbGVjdC5pZCA9IHRoaXMuaWQrJ19taW51dGUnOw0KDQogICAgICAgIGlmKHRoaXMuYWNjZXNzS2V5KXsNCg0KICAgICAgICAgICAgbWludXRlU2VsZWN0LmFjY2Vzc0tleSA9IHRoaXMuYWNjZXNzS2V5Ow0KDQogICAgICAgIH0NCg0KDQogICAgICAgIGlmKHRoaXMudmFsdWUpew0KDQogICAgICAgICAgICBtaW51dGVTZWxlY3QudmFsdWUgPSB0aGlzLnZhbHVlOw0KDQogICAgICAgIH0NCg0KICAgICAgICANCg0KICAgICAgICB0aGlzLmNyZWF0ZU9wdGlvbnMoNjAsIG1pbnV0ZVNlbGVjdCk7DQoNCiAgICAgICANCg0KICAgICAgICB0aGlzLmJpbmRFdmVudHMobWludXRlU2VsZWN0LHRoaXMuZXZlbnRNYXAsdGhpcy5zdXBwb3J0RXZlbnRzKTsNCg0KICAgICAgIA0KDQogICAgICAgIGlmKFVJLkJhc2UuY2hlY2tBcigpKXsNCg0KICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobWludXRlU2VsZWN0KTsNCg0KICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobGFiZWwpOw0KDQogICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxlY3QpOw0KDQogICAgICAgIH0NCg0KICAgICAgICBlbHNlew0KDQogICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxlY3QpOw0KDQogICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChsYWJlbCk7DQoNCiAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG1pbnV0ZVNlbGVjdCk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIA0KDQogICAgICAgIC8vZGVmYXVsdCB2YWx1ZQ0KDQogICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7DQoNCiAgICAgICAgaW5wdXQudHlwZT0naGlkZGVuJzsNCg0KICAgICAgICBpbnB1dC5pZCA9IHRoaXMuaWQ7DQoNCiAgICAgICAgaW5wdXQubmFtZSA9IHRoaXMuaWQ7DQoNCiAgICAgICAgaW5wdXQudmFsdWUgPSB0aGlzLnZhbHVlOw0KDQogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dCk7DQoNCiAgICAgICAgLy9hcHBlbmQgQU0vUE0NCg0KICAgICAgICAvL2FwcGVuZEFNUE0oKTsNCg0KICAgIH0sIA0KDQogICAgDQoNCiAgICBhcHBlbmRBTVBNIDogZnVuY3Rpb24oKQ0KDQogICAgew0KDQogICAgICAgIA0KDQogICAgfSwNCg0KICAgIA0KDQogICAgY3JlYXRlT3B0aW9ucyA6IGZ1bmN0aW9uKGxlbmd0aCwgc2VsZWN0T2JqKQ0KDQogICAgew0KDQogICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspew0KDQogICAgICAgICAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7DQoNCiAgICAgICAgICAgIGlmKHRoaXMudmFsdWUgPT0gaSl7DQoNCiAgICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSAnc2VsZWN0ZWQnOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBvcHRpb24udmFsdWUgPSBpOw0KDQogICAgICAgICAgICBpZiAoaSA8IDEwKQ0KDQogICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICBvcHRpb24uaW5uZXJIVE1MID0gJzAnK2k7ICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGVsc2UNCg0KICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgb3B0aW9uLmlubmVySFRNTCA9IGk7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc2VsZWN0T2JqLmFwcGVuZENoaWxkKG9wdGlvbik7DQoNCiAgICAgICAgfQ0KDQogICAgfSwNCg0KICAgIA0KDQogICAgZ2V0T3V0ZXJIVE1MIDogZnVuY3Rpb24oY29uZmlnKXsNCg0KICAgICAgICB0aGlzLmluaXQoY29uZmlnIHx8IHt9KTsNCg0KICAgICAgICB2YXIgY29udGVudCA9IG5ldyBBcnJheSgpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCh0aGlzLmdldEhvdXJIVE1MKCkpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCgiJm5ic3A7OiZuYnNwOyZuYnNwOyIpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCh0aGlzLmdldE1pbnV0ZXNIVE1MKCkpOw0KDQogICAgICAgIGlmKFVJLkJhc2UuY2hlY2tBcigpKXsNCg0KICAgICAgICAgICAgY29udGVudC5yZXZlcnNlKCk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnRlbnQucHVzaCgiJm5ic3A7Jm5ic3A7Jm5ic3A7Iik7DQoNCiAgICAgICAgY29udGVudC5wdXNoKHRoaXMuZ2V0QU1QTUhUTUwoKSk7DQoNCiAgICAgICAgDQoNCiAgICAgICAgY29udGVudC5wdXNoKCI8aW5wdXQgaWQ9Iit0aGlzLmlkKyIgdHlwZT1oaWRkZW4gbmFtZT0iK3RoaXMuaWQrIiB2YWx1ZT0nIit0aGlzLnZhbHVlKyInPiIpOw0KDQogICAgICAgIHJldHVybiBjb250ZW50LmpvaW4oIiIpOw0KDQogICAgfSwNCg0KICAgIA0KDQogICAgZ2V0SG91ckhUTUwgOiBmdW5jdGlvbigpDQoNCiAgICB7DQoNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VGltZUhUTUwoIl9ob3VyIiwgMTIsIHRoaXMuaG91cik7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICBnZXRNaW51dGVzSFRNTCA6IGZ1bmN0aW9uKCkNCg0KICAgIHsNCg0KICAgICAgICByZXR1cm4gdGhpcy5nZXRUaW1lSFRNTCgiX21pbnV0ZSIsIDU5LCB0aGlzLm1pbnV0ZSk7DQoNCiAgICB9LA0KDQogICAgDQoNCiAgICBnZXRBTVBNSFRNTCA6IGZ1bmN0aW9uKCkNCg0KICAgIHsNCg0KICAgICAgICB2YXIgY29udGVudCA9IG5ldyBBcnJheSgpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCgiPHNlbGVjdCBpZD0nIik7DQoNCiAgICAgICAgY29udGVudC5wdXNoKHRoaXMuaWQpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCgiX2FtcG0nIG5hbWU9JyIpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCh0aGlzLm5hbWUpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCgiX2FtcG0nIik7DQoNCiAgICAgICAgaWYodGhpcy5kaXNhYmxlZCB8fCB0aGlzLnJlYWRPbmx5KXsNCg0KICAgICAgICAgICAgY29udGVudC5wdXNoKCIgZGlzYWJsZWQ9J2Rpc2FibGVkJyIpOw0KDQogICAgICAgIH0NCg0KICAgICAgICBjb250ZW50LnB1c2goJyBjbGFzcz1wb3J0bGV0LWZvcm0tZmllbGQnKTsNCg0KICAgICAgICBjb250ZW50LnB1c2godGhpcy5ldmVudHNUb0hUTUwodGhpcy5ldmVudE1hcCwgdGhpcy5zdXBwb3J0RXZlbnRzKSk7DQoNCiAgICAgICAgY29udGVudC5wdXNoKCI+Iik7DQoNCiAgICAgICAgY29udGVudC5wdXNoKCc8b3B0aW9uIHZhbHVlPSIiPjwvb3B0aW9uPicpOyANCg0KICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5hbXBtLmxlbmd0aDsgaSsrKXsNCg0KICAgICAgICAgICAgY29udGVudC5wdXNoKCI8b3B0aW9uICIpOw0KDQogICAgICAgICAgICBpZih0aGlzLmFtcG1baV0gPT0gdGhpcy5hbVBtVmFsdWUpew0KDQogICAgICAgICAgICAgICAgY29udGVudC5wdXNoKCIgc2VsZWN0ZWQ9J3NlbGVjdGVkJyIpOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnRlbnQucHVzaCgiIHZhbHVlPSciKTsNCg0KICAgICAgICAgICAgY29udGVudC5wdXNoKHRoaXMuYW1wbVtpXSk7DQoNCiAgICAgICAgICAgIGNvbnRlbnQucHVzaCgiJz4iKTsNCg0KICAgICAgICAgICAgY29udGVudC5wdXNoKHRoaXMuYW1wbVsrK2ldKTsNCg0KICAgICAgICAgICAgY29udGVudC5wdXNoKCI8L29wdGlvbj4iKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgY29udGVudC5wdXNoKCI8L3NlbGVjdD4iKTsNCg0KICAgICAgICByZXR1cm4gY29udGVudC5qb2luKCIiKTsNCg0KICAgIH0sDQoNCg0KICAgIGdldFRpbWVIVE1MIDogZnVuY3Rpb24odHlwZSwgbGltaXQsIGRlZmF1bHRWYWx1ZSkNCg0KICAgIHsNCg0KICAgICAgICB2YXIgY29udGVudCA9IG5ldyBBcnJheSgpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCgiPHNlbGVjdCBpZD0nIik7DQoNCiAgICAgICAgY29udGVudC5wdXNoKHRoaXMuaWQpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCh0eXBlKTsNCg0KICAgICAgICBjb250ZW50LnB1c2goIicgbmFtZT0nIik7DQoNCiAgICAgICAgY29udGVudC5wdXNoKHRoaXMubmFtZSk7DQoNCiAgICAgICAgY29udGVudC5wdXNoKHR5cGUpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCgiJyIpOw0KDQogICAgICAgIGlmKHRoaXMuZGlzYWJsZWQgfHwgdGhpcy5yZWFkT25seSl7DQoNCiAgICAgICAgICAgIGNvbnRlbnQucHVzaCgiIGRpc2FibGVkPSdkaXNhYmxlZCciKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgY29udGVudC5wdXNoKCcgY2xhc3M9cG9ydGxldC1mb3JtLWZpZWxkJyk7DQoNCiAgICAgICAgY29udGVudC5wdXNoKHRoaXMuZXZlbnRzVG9IVE1MKHRoaXMuZXZlbnRNYXAsIHRoaXMuc3VwcG9ydEV2ZW50cykpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCgiPiIpOw0KDQogICAgICAgIGNvbnRlbnQucHVzaCgnPG9wdGlvbiB2YWx1ZT0iIj48L29wdGlvbj4nKTsNCg0KICAgICAgICBmb3IodmFyIGk9MDsgaSA8PSBsaW1pdDsgaSsrKXsNCg0KICAgICAgICAJLy8gc3RhcnQgZnJvbSAwMSBmb3IgaG91cg0KDQogICAgICAgIAlpZih0eXBlPT0nX2hvdXInICYmIGkgPT0wKQ0KDQogICAgICAgIAl7DQoNCiAgICAgICAgCQljb250aW51ZTsNCg0KICAgICAgICAJfQ0KDQogICAgICAgICAgICBjb250ZW50LnB1c2goIjxvcHRpb24gIik7DQoNCiAgICAgICAgICAgIGlmKGkgPT0gZGVmYXVsdFZhbHVlKXsNCg0KICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaCgiIHNlbGVjdGVkPSdzZWxlY3RlZCciKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb250ZW50LnB1c2goIiB2YWx1ZT0nIik7DQoNCiAgICAgICAgICAgIGlmIChpIDwgMTApDQoNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaCgiMCIgKyBpKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBlbHNlDQoNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaChpKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb250ZW50LnB1c2goIiciKTsNCg0KICAgICAgICAgICAgY29udGVudC5wdXNoKCI+Iik7DQoNCiAgICAgICAgICAgIGlmIChpIDwgMTApDQoNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaCgiMCIgKyBpKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBlbHNlDQoNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgIGNvbnRlbnQucHVzaChpKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb250ZW50LnB1c2goIjwvb3B0aW9uPiIpOw0KDQogICAgICAgIH0NCg0KICAgICAgICBjb250ZW50LnB1c2goIjwvc2VsZWN0PiIpOw0KDQogICAgICAgIHJldHVybiBjb250ZW50LmpvaW4oIiIpOw0KDQogICAgfQ0KDQoNCn0pOw0KDQoNClVJLlRpbWUucG9zdGZpeEFycmF5ID0gWyJfaG91ciIsIl9taW51dGUiLCJfYW1wbSJdOw0KDQpVSS5UaW1lLnVwZGF0ZVZhbHVlID0gZnVuY3Rpb24oKQ0KDQp7DQoNCiAgICAvL2hvdXI6bWludXRlIEFNL1BNDQoNCiAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQ7IA0KDQogICAgdmFyIGlkID0gdGFyZ2V0LmlkOw0KDQogICAgdmFyIGluZGV4ID0gaWQubGFzdEluZGV4T2YoIl8iKTsNCg0KICAgIHZhciB0aW1lSUQgPSBpZC5zdWJzdHJpbmcoMCwgaW5kZXgpOw0KDQogICAgdmFyIHBvc3RmaXhBcnJheSA9IHRoaXMucG9zdGZpeEFycmF5Ow0KDQogICAgdmFyIHRlbXBvcmFyeVZhbHVlID0gIiI7DQoNCiAgICB2YXIgdGVtcG9yYXJ5RWxlID0gbnVsbA0KDQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb3N0Zml4QXJyYXkubGVuZ3RoOyBpKyspDQoNCiAgICB7DQoNCiAgICAgICAgdGVtcG9yYXJ5RWxlID0gQWMzNjAucXVlcnkodGltZUlEICsgcG9zdGZpeEFycmF5W2ldKTsNCg0KICAgICAgICBpZiAoaT09MSkNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHRlbXBvcmFyeVZhbHVlICs9ICI6Iit0ZW1wb3JhcnlFbGUudmFsdWU7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGVsc2UgaWYgKGkgPT0gMikNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHRlbXBvcmFyeVZhbHVlICs9ICIgIit0ZW1wb3JhcnlFbGUudmFsdWU7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGVsc2UNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHRlbXBvcmFyeVZhbHVlID0gdGVtcG9yYXJ5RWxlLnZhbHVlOw0KDQogICAgICAgIH0NCg0KICAgICAgICANCg0KICAgIH0NCg0KICAgIA0KDQogICAgdGVtcG9yYXJ5RWxlID0gQWMzNjAucXVlcnkodGltZUlEKTsNCg0KICAgIHRlbXBvcmFyeUVsZS52YWx1ZSA9IHRlbXBvcmFyeVZhbHVlOw0KDQp9DQoNCg0KDQpXaWRnZXRNYW5hZ2VyLnJlZ2lzdGVyV2lkZ2V0KCJ0aW1lIiwgVUkuVGltZSk7LyoqDQoNCiAqDQoNCiAqIFYzNjANCg0KICogRmlsZTogRGVwYXJ0bWVudC5qcw0KDQogKg0KDQogKiBBY2NlbGEsIEluYy4NCg0KICogQ29weXJpZ2h0IChDKTogMjAxMi0yMDE0DQoNCiAqDQoNCiAqIERlc2NyaXB0aW9uOm5vIGFtL3BtDQoNCiAqIDw8R2VuZXJhbCBkZXNjcmlwdGlvbiBvZiB0aGUgY2xhc3M+Pg0KDQogKg0KDQogKiBOb3RlczoNCg0KICogPDxTcGVjaWZpYyBwcm9ncmFtbWluZyBub3Rlcz4+DQoNCiAqDQoNCiAqDQoNCiAqLw0KDQoNClVJLlNpbXBsZVRpbWUgPSBuZXcgVUkuQ29tcG9uZW50KCk7DQoNCg0KVXRpbC5leHRlbmQoVUkuU2ltcGxlVGltZSwgVUkuVGltZSwgew0KDQoNCiAgICBnZXRBTVBNSFRNTCA6IGZ1bmN0aW9uKCkNCg0KICAgIHsNCg0KICAgICAgICANCg0KICAgIH0NCg0KICAgIA0KDQp9KTsNCg0KDQpVSS5TaW1wbGVUaW1lLnBvc3RmaXhBcnJheSA9IFsiX2hvdXIiLCJfbWludXRlIl07DQoNClVJLlNpbXBsZVRpbWUudXBkYXRlVmFsdWUgPSBmdW5jdGlvbigpDQoNCnsgICAgDQoNCiAgICAvL2hvdXI6bWludXRlIEFNL1BNDQoNCiAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQ7IA0KDQogICAgdmFyIGlkID0gdGFyZ2V0LmlkOw0KDQogICAgdmFyIGluZGV4ID0gaWQubGFzdEluZGV4T2YoIl8iKTsNCg0KICAgIHZhciB0aW1lSUQgPSBpZC5zdWJzdHJpbmcoMCwgaW5kZXgpOw0KDQogICAgdmFyIHBvc3RmaXhBcnJheSA9IHRoaXMucG9zdGZpeEFycmF5Ow0KDQogICAgdmFyIHRlbXBvcmFyeVZhbHVlID0gIiI7DQoNCiAgICB2YXIgdGVtcG9yYXJ5RWxlID0gbnVsbA0KDQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb3N0Zml4QXJyYXkubGVuZ3RoOyBpKyspDQoNCiAgICB7DQoNCiAgICAgICAgdGVtcG9yYXJ5RWxlID0gQWMzNjAucXVlcnkodGltZUlEICsgcG9zdGZpeEFycmF5W2ldKTsNCg0KICAgICAgICBpZiAoQWMzNjAudmFsaWRhdG9yLmlzRW1wdHkodGVtcG9yYXJ5RWxlLnZhbHVlKSkNCg0KICAgICAgICB7DQoNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGk9PTEpDQoNCiAgICAgICAgew0KDQogICAgICAgICAgICB0ZW1wb3JhcnlWYWx1ZSArPSAiOiIrdGVtcG9yYXJ5RWxlLnZhbHVlOw0KDQogICAgICAgIH0NCg0KICAgICAgICBlbHNlDQoNCiAgICAgICAgew0KDQogICAgICAgICAgICB0ZW1wb3JhcnlWYWx1ZSA9IHRlbXBvcmFyeUVsZS52YWx1ZTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgDQoNCiAgICB9DQoNCiAgICANCg0KICAgIHRlbXBvcmFyeUVsZSA9IEFjMzYwLnF1ZXJ5KHRpbWVJRCk7DQoNCiAgICB0ZW1wb3JhcnlFbGUudmFsdWUgPSB0ZW1wb3JhcnlWYWx1ZTsNCg0KfQ0KDQpXaWRnZXRNYW5hZ2VyLnJlZ2lzdGVyV2lkZ2V0KCJzaW1wbGF0ZXRpbWUiLCBVSS5TaW1wbGVUaW1lKTsgDQoNCg0K</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="1029847843" offset="0" length="600" />
        <PacketInfo time="1029847843" offset="600" length="40135" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>