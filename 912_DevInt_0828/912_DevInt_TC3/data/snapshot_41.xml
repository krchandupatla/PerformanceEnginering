<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="41">
  <HTTPTask id="211" hostname="aa-pt6245.dev.accela.com:5443" path="https://aa-pt6245.dev.accela.com:5443/portlets/spa/bower_components/lodash/lodash.js" url="https://aa-pt6245.dev.accela.com:5443/portlets/spa/bower_components/lodash/lodash.js" ip="13.93.163.237" port="5443" connectionId="43" origin="Primary" frame="1" startDateTime="2017-08-28T11:20:12.370-07:00" startTime="1029813046" endTime="1029813046">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Accept" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdCwgKi8qO3E9MC44</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zcGEvZGFzaGJvYXJkLmRv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SlNFU1NJT05JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IF9fY2ZkdWlkPWRiNjBkNWU3ODRkYmRlN2NhNTlkZGVjNmUzYWNkYzk2MjE1MDI0MzA3NzM7IF9wZW5kb19hY2NvdW50SWQuNTY3YTE0NmUtNjVhYy00NmE1LTdhMTMtYjMyNDc0YTRmNjdiPUZMQUdTVEFGRjsgX3BlbmRvX3Zpc2l0b3JJZC41NjdhMTQ2ZS02NWFjLTQ2YTUtN2ExMy1iMzI0NzRhNGY2N2I9ZTlhZjFmYTUxNzFhZWQwYWRiZWUwMDI4NGE0NTUwODY0NjVhYTMxZmMzNjU2M2VkYWJmNjQ2ZTExZDU1YTYwODgwOTVhMjNlZmVlZTBjYTU2NzAzZDEwOTY5ZDNhYzU0ZTk3OWFiMjExODkyZWU1NmRlZmM5MWM0Njg0NzZhMDg7IF9wZW5kb19tZXRhLjU2N2ExNDZlLTY1YWMtNDZhNS03YTEzLWIzMjQ3NGE0ZjY3Yj0zMzk5OTk2NjE3OyBKU0VTU0lPTklEPSoqKioqKioqKioqKioqKioqKioqKioqKioqKjsgMDEtSmFuLTE5NzAgMDA6MDA6MTAgR01UOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ0MDEzMDYzOyBob3N0U2lnbk9uPXRydWU7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM7IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBMQVRFU1RfU0VTU0lPTl9JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IEFDQXV0aD05OTE4NDQ3MDE1MDc4ODU2NDY0OTU2OTM1NDI5Mzg5NDYxOTQwOTc2MzMxNDg2MDc5NjMzMzEzMjIxMjYwMTIwNTMzODE2NTYwOTUyODc4MTk3OTA1MTQxMDUxODg5NjE2OTAyMjc5Mzc3ODg0NzYxOTY1Nzk1ODgzNzY5NjMyMjsgQUNTaWduT25Nb2R1bGU9U1NPU3RhbmRhcmQ7IEFBUGVyc2lzdExvZ2luU2VydlByb3ZDb2RlPUZMQUdTVEFGRjsgTG9naW5TZXJ2UHJvdkNvZGU0TXVsdGlBZ2VuY3k9RkxBR1NUQUZGOyBMb2dpblVzZXJuYW1lNE11bHRpQWdlbmN5PTE3OUREMTNBMTg2MDI4RjQ7IEFDU2lnbm9mZj0iaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zZWN1cml0eS9zaWdub3V0LmRvIjsgQUNTd2l0Y2hBZ2VuY3k9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Q2xvc2U=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIGh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvc3BhL2Jvd2VyX2NvbXBvbmVudHMvbG9kYXNoL2xvZGFzaC5qcyBIVFRQLzEuMQ0KQWNjZXB0OiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCAqLyo7cT0wLjgNClJlZmVyZXI6IGh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvc3BhL2Rhc2hib2FyZC5kbw0KQWNjZXB0LUxhbmd1YWdlOiBlbi1VUw0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvDQpBY2NlcHQtRW5jb2Rpbmc6IGd6aXAsIGRlZmxhdGUNCkNvb2tpZTogSlNFU1NJT05JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IF9fY2ZkdWlkPWRiNjBkNWU3ODRkYmRlN2NhNTlkZGVjNmUzYWNkYzk2MjE1MDI0MzA3NzM7IF9wZW5kb19hY2NvdW50SWQuNTY3YTE0NmUtNjVhYy00NmE1LTdhMTMtYjMyNDc0YTRmNjdiPUZMQUdTVEFGRjsgX3BlbmRvX3Zpc2l0b3JJZC41NjdhMTQ2ZS02NWFjLTQ2YTUtN2ExMy1iMzI0NzRhNGY2N2I9ZTlhZjFmYTUxNzFhZWQwYWRiZWUwMDI4NGE0NTUwODY0NjVhYTMxZmMzNjU2M2VkYWJmNjQ2ZTExZDU1YTYwODgwOTVhMjNlZmVlZTBjYTU2NzAzZDEwOTY5ZDNhYzU0ZTk3OWFiMjExODkyZWU1NmRlZmM5MWM0Njg0NzZhMDg7IF9wZW5kb19tZXRhLjU2N2ExNDZlLTY1YWMtNDZhNS03YTEzLWIzMjQ3NGE0ZjY3Yj0zMzk5OTk2NjE3OyBKU0VTU0lPTklEPSoqKioqKioqKioqKioqKioqKioqKioqKioqKjsgMDEtSmFuLTE5NzAgMDA6MDA6MTAgR01UOyBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ0MDEzMDYzOyBob3N0U2lnbk9uPXRydWU7IGdfY3VycmVudF9sYW5ndWFnZV9leHQ9ZW5fVVM7IExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBMQVRFU1RfU0VTU0lPTl9JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IEFDQXV0aD05OTE4NDQ3MDE1MDc4ODU2NDY0OTU2OTM1NDI5Mzg5NDYxOTQwOTc2MzMxNDg2MDc5NjMzMzEzMjIxMjYwMTIwNTMzODE2NTYwOTUyODc4MTk3OTA1MTQxMDUxODg5NjE2OTAyMjc5Mzc3ODg0NzYxOTY1Nzk1ODgzNzY5NjMyMjsgQUNTaWduT25Nb2R1bGU9U1NPU3RhbmRhcmQ7IEFBUGVyc2lzdExvZ2luU2VydlByb3ZDb2RlPUZMQUdTVEFGRjsgTG9naW5TZXJ2UHJvdkNvZGU0TXVsdGlBZ2VuY3k9RkxBR1NUQUZGOyBMb2dpblVzZXJuYW1lNE11bHRpQWdlbmN5PTE3OUREMTNBMTg2MDI4RjQ7IEFDU2lnbm9mZj0iaHR0cHM6Ly9hYS1wdDYyNDUuZGV2LmFjY2VsYS5jb206NTQ0My9wb3J0bGV0cy9zZWN1cml0eS9zaWdub3V0LmRvIjsgQUNTd2l0Y2hBZ2VuY3k9Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg0KSG9zdDogYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMNCkNvbm5lY3Rpb246IENsb3NlDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="JSESSIONID" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>T0kreDBoZEowUHYxWitLaDVGbDFiVnZY</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="__cfduid" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZGI2MGQ1ZTc4NGRiZGU3Y2E1OWRkZWM2ZTNhY2RjOTYyMTUwMjQzMDc3Mw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="_pendo_accountId.567a146e-65ac-46a5-7a13-b32474a4f67b" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="_pendo_visitorId.567a146e-65ac-46a5-7a13-b32474a4f67b" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZTlhZjFmYTUxNzFhZWQwYWRiZWUwMDI4NGE0NTUwODY0NjVhYTMxZmMzNjU2M2VkYWJmNjQ2ZTExZDU1YTYwODgwOTVhMjNlZmVlZTBjYTU2NzAzZDEwOTY5ZDNhYzU0ZTk3OWFiMjExODkyZWU1NmRlZmM5MWM0Njg0NzZhMDg=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="_pendo_meta.567a146e-65ac-46a5-7a13-b32474a4f67b" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MzM5OTk5NjYxNw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="JSESSIONID" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>KioqKioqKioqKioqKioqKioqKioqKioqKioq</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="01-Jan-1970 00:00:10 GMT; LASTEST_REQUEST_TIME" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTUwMzk0NDAxMzA2Mw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="hostSignOn" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="g_current_language_ext" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW5fVVM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_WEB_SERVER" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTAuMS4wLjY=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LATEST_SESSION_ID" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>T0kreDBoZEowUHYxWitLaDVGbDFiVnZY</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACAuth" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>OTkxODQ0NzAxNTA3ODg1NjQ2NDk1NjkzNTQyOTM4OTQ2MTk0MDk3NjMzMTQ4NjA3OTYzMzMxMzIyMTI2MDEyMDUzMzgxNjU2MDk1Mjg3ODE5NzkwNTE0MTA1MTg4OTYxNjkwMjI3OTM3Nzg4NDc2MTk2NTc5NTg4Mzc2OTYzMjI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignOnModule" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U1NPU3RhbmRhcmQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="AAPersistLoginServProvCode" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginServProvCode4MultiAgency" index="14">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RkxBR1NUQUZG</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="LoginUsername4MultiAgency" index="15">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTc5REQxM0ExODYwMjhGNA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSignoff" index="16">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvc2VjdXJpdHkvc2lnbm91dC5kbyI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ACSwitchAgency" index="17">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Imh0dHBzOi8vYWEtcHQ2MjQ1LmRldi5hY2NlbGEuY29tOjU0NDMvcG9ydGxldHMvY29tbW9ucy9zc28vYmxhbmsuanNwIg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLUNveW90ZS8xLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-XSS-Protection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Set-Cookie" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TEFTVEVTVF9SRVFVRVNUX1RJTUU9MTUwMzk0NDAxMzU2MzsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZSxMQVRFU1RfV0VCX1NFUlZFUj0xMC4xLjAuNjsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZSxMQVRFU1RfU0VTU0lPTl9JRD1PSSt4MGhkSjBQdjFaK0toNUZsMWJWdlg7IERvbWFpbj1kZXYuYWNjZWxhLmNvbTsgUGF0aD0vOyBTZWN1cmU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Vy8iNDIwMzc3LTE1MDE2MTc0ODAwMDAi</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VHVlLCAwMSBBdWcgMjAxNyAxOTo1ODowMCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyOCBBdWcgMjAxNyAxODoxMzozMyBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y2xvc2U=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IEFwYWNoZS1Db3lvdGUvMS4xDQpYLVhTUy1Qcm90ZWN0aW9uOiAwDQpTZXQtQ29va2llOiBMQVNURVNUX1JFUVVFU1RfVElNRT0xNTAzOTQ0MDEzNTYzOyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJlLExBVEVTVF9XRUJfU0VSVkVSPTEwLjEuMC42OyBEb21haW49ZGV2LmFjY2VsYS5jb207IFBhdGg9LzsgU2VjdXJlLExBVEVTVF9TRVNTSU9OX0lEPU9JK3gwaGRKMFB2MVorS2g1RmwxYlZ2WDsgRG9tYWluPWRldi5hY2NlbGEuY29tOyBQYXRoPS87IFNlY3VyZQ0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkVUYWc6IFcvIjQyMDM3Ny0xNTAxNjE3NDgwMDAwIg0KTGFzdC1Nb2RpZmllZDogVHVlLCAwMSBBdWcgMjAxNyAxOTo1ODowMCBHTVQNCkNvbnRlbnQtVHlwZTogdGV4dC9qYXZhc2NyaXB0DQpDb250ZW50LUVuY29kaW5nOiBnemlwDQpWYXJ5OiBBY2NlcHQtRW5jb2RpbmcNCkRhdGU6IE1vbiwgMjggQXVnIDIwMTcgMTg6MTM6MzMgR01UDQpDb25uZWN0aW9uOiBjbG9zZQ0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>LyoqDQogKiBAbGljZW5zZQ0KICogbG9kYXNoIDMuOS4zIChDdXN0b20gQnVpbGQpIDxodHRwczovL2xvZGFzaC5jb20vPg0KICogQnVpbGQ6IGBsb2Rhc2ggbW9kZXJuIC1vIC4vbG9kYXNoLmpzYA0KICogQ29weXJpZ2h0IDIwMTItMjAxNSBUaGUgRG9qbyBGb3VuZGF0aW9uIDxodHRwOi8vZG9qb2ZvdW5kYXRpb24ub3JnLz4NCiAqIEJhc2VkIG9uIFVuZGVyc2NvcmUuanMgMS44LjMgPGh0dHA6Ly91bmRlcnNjb3JlanMub3JnL0xJQ0VOU0U+DQogKiBDb3B5cmlnaHQgMjAwOS0yMDE1IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzDQogKiBBdmFpbGFibGUgdW5kZXIgTUlUIGxpY2Vuc2UgPGh0dHBzOi8vbG9kYXNoLmNvbS9saWNlbnNlPg0KICovDQo7KGZ1bmN0aW9uKCkgew0KDQogIC8qKiBVc2VkIGFzIGEgc2FmZSByZWZlcmVuY2UgZm9yIGB1bmRlZmluZWRgIGluIHByZS1FUzUgZW52aXJvbm1lbnRzLiAqLw0KICB2YXIgdW5kZWZpbmVkOw0KDQogIC8qKiBVc2VkIGFzIHRoZSBzZW1hbnRpYyB2ZXJzaW9uIG51bWJlci4gKi8NCiAgdmFyIFZFUlNJT04gPSAnMy45LjMnOw0KDQogIC8qKiBVc2VkIHRvIGNvbXBvc2UgYml0bWFza3MgZm9yIHdyYXBwZXIgbWV0YWRhdGEuICovDQogIHZhciBCSU5EX0ZMQUcgPSAxLA0KICAgICAgQklORF9LRVlfRkxBRyA9IDIsDQogICAgICBDVVJSWV9CT1VORF9GTEFHID0gNCwNCiAgICAgIENVUlJZX0ZMQUcgPSA4LA0KICAgICAgQ1VSUllfUklHSFRfRkxBRyA9IDE2LA0KICAgICAgUEFSVElBTF9GTEFHID0gMzIsDQogICAgICBQQVJUSUFMX1JJR0hUX0ZMQUcgPSA2NCwNCiAgICAgIEFSWV9GTEFHID0gMTI4LA0KICAgICAgUkVBUkdfRkxBRyA9IDI1NjsNCg0KICAvKiogVXNlZCBhcyBkZWZhdWx0IG9wdGlvbnMgZm9yIGBfLnRydW5jYC4gKi8NCiAgdmFyIERFRkFVTFRfVFJVTkNfTEVOR1RIID0gMzAsDQogICAgICBERUZBVUxUX1RSVU5DX09NSVNTSU9OID0gJy4uLic7DQoNCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IHdoZW4gYSBmdW5jdGlvbiBiZWNvbWVzIGhvdC4gKi8NCiAgdmFyIEhPVF9DT1VOVCA9IDE1MCwNCiAgICAgIEhPVF9TUEFOID0gMTY7DQoNCiAgLyoqIFVzZWQgdG8gaW5kaWNhdGUgdGhlIHR5cGUgb2YgbGF6eSBpdGVyYXRlZXMuICovDQogIHZhciBMQVpZX0RST1BfV0hJTEVfRkxBRyA9IDAsDQogICAgICBMQVpZX0ZJTFRFUl9GTEFHID0gMSwNCiAgICAgIExBWllfTUFQX0ZMQUcgPSAyOw0KDQogIC8qKiBVc2VkIGFzIHRoZSBgVHlwZUVycm9yYCBtZXNzYWdlIGZvciAiRnVuY3Rpb25zIiBtZXRob2RzLiAqLw0KICB2YXIgRlVOQ19FUlJPUl9URVhUID0gJ0V4cGVjdGVkIGEgZnVuY3Rpb24nOw0KDQogIC8qKiBVc2VkIGFzIHRoZSBpbnRlcm5hbCBhcmd1bWVudCBwbGFjZWhvbGRlci4gKi8NCiAgdmFyIFBMQUNFSE9MREVSID0gJ19fbG9kYXNoX3BsYWNlaG9sZGVyX18nOw0KDQogIC8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi8NCiAgdmFyIGFyZ3NUYWcgPSAnW29iamVjdCBBcmd1bWVudHNdJywNCiAgICAgIGFycmF5VGFnID0gJ1tvYmplY3QgQXJyYXldJywNCiAgICAgIGJvb2xUYWcgPSAnW29iamVjdCBCb29sZWFuXScsDQogICAgICBkYXRlVGFnID0gJ1tvYmplY3QgRGF0ZV0nLA0KICAgICAgZXJyb3JUYWcgPSAnW29iamVjdCBFcnJvcl0nLA0KICAgICAgZnVuY1RhZyA9ICdbb2JqZWN0IEZ1bmN0aW9uXScsDQogICAgICBtYXBUYWcgPSAnW29iamVjdCBNYXBdJywNCiAgICAgIG51bWJlclRhZyA9ICdbb2JqZWN0IE51bWJlcl0nLA0KICAgICAgb2JqZWN0VGFnID0gJ1tvYmplY3QgT2JqZWN0XScsDQogICAgICByZWdleHBUYWcgPSAnW29iamVjdCBSZWdFeHBdJywNCiAgICAgIHNldFRhZyA9ICdbb2JqZWN0IFNldF0nLA0KICAgICAgc3RyaW5nVGFnID0gJ1tvYmplY3QgU3RyaW5nXScsDQogICAgICB3ZWFrTWFwVGFnID0gJ1tvYmplY3QgV2Vha01hcF0nOw0KDQogIHZhciBhcnJheUJ1ZmZlclRhZyA9ICdbb2JqZWN0IEFycmF5QnVmZmVyXScsDQogICAgICBmbG9hdDMyVGFnID0gJ1tvYmplY3QgRmxvYXQzMkFycmF5XScsDQogICAgICBmbG9hdDY0VGFnID0gJ1tvYmplY3QgRmxvYXQ2NEFycmF5XScsDQogICAgICBpbnQ4VGFnID0gJ1tvYmplY3QgSW50OEFycmF5XScsDQogICAgICBpbnQxNlRhZyA9ICdbb2JqZWN0IEludDE2QXJyYXldJywNCiAgICAgIGludDMyVGFnID0gJ1tvYmplY3QgSW50MzJBcnJheV0nLA0KICAgICAgdWludDhUYWcgPSAnW29iamVjdCBVaW50OEFycmF5XScsDQogICAgICB1aW50OENsYW1wZWRUYWcgPSAnW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0nLA0KICAgICAgdWludDE2VGFnID0gJ1tvYmplY3QgVWludDE2QXJyYXldJywNCiAgICAgIHVpbnQzMlRhZyA9ICdbb2JqZWN0IFVpbnQzMkFycmF5XSc7DQoNCiAgLyoqIFVzZWQgdG8gbWF0Y2ggZW1wdHkgc3RyaW5nIGxpdGVyYWxzIGluIGNvbXBpbGVkIHRlbXBsYXRlIHNvdXJjZS4gKi8NCiAgdmFyIHJlRW1wdHlTdHJpbmdMZWFkaW5nID0gL1xiX19wIFwrPSAnJzsvZywNCiAgICAgIHJlRW1wdHlTdHJpbmdNaWRkbGUgPSAvXGIoX19wIFwrPSkgJycgXCsvZywNCiAgICAgIHJlRW1wdHlTdHJpbmdUcmFpbGluZyA9IC8oX19lXCguKj9cKXxcYl9fdFwpKSBcK1xuJyc7L2c7DQoNCiAgLyoqIFVzZWQgdG8gbWF0Y2ggSFRNTCBlbnRpdGllcyBhbmQgSFRNTCBjaGFyYWN0ZXJzLiAqLw0KICB2YXIgcmVFc2NhcGVkSHRtbCA9IC8mKD86YW1wfGx0fGd0fHF1b3R8IzM5fCM5Nik7L2csDQogICAgICByZVVuZXNjYXBlZEh0bWwgPSAvWyY8PiInYF0vZywNCiAgICAgIHJlSGFzRXNjYXBlZEh0bWwgPSBSZWdFeHAocmVFc2NhcGVkSHRtbC5zb3VyY2UpLA0KICAgICAgcmVIYXNVbmVzY2FwZWRIdG1sID0gUmVnRXhwKHJlVW5lc2NhcGVkSHRtbC5zb3VyY2UpOw0KDQogIC8qKiBVc2VkIHRvIG1hdGNoIHRlbXBsYXRlIGRlbGltaXRlcnMuICovDQogIHZhciByZUVzY2FwZSA9IC88JS0oW1xzXFNdKz8pJT4vZywNCiAgICAgIHJlRXZhbHVhdGUgPSAvPCUoW1xzXFNdKz8pJT4vZywNCiAgICAgIHJlSW50ZXJwb2xhdGUgPSAvPCU9KFtcc1xTXSs/KSU+L2c7DQoNCiAgLyoqIFVzZWQgdG8gbWF0Y2ggcHJvcGVydHkgbmFtZXMgd2l0aGluIHByb3BlcnR5IHBhdGhzLiAqLw0KICB2YXIgcmVJc0RlZXBQcm9wID0gL1wufFxbKD86W15bXF1dKnwoWyInXSkoPzooPyFcMSlbXlxuXFxdfFxcLikqP1wxKVxdLywNCiAgICAgIHJlSXNQbGFpblByb3AgPSAvXlx3KiQvLA0KICAgICAgcmVQcm9wTmFtZSA9IC9bXi5bXF1dK3xcWyg/OigtP1xkKyg/OlwuXGQrKT8pfChbIiddKSgoPzooPyFcMilbXlxuXFxdfFxcLikqPylcMilcXS9nOw0KDQogIC8qKg0KICAgKiBVc2VkIHRvIG1hdGNoIGBSZWdFeHBgIFtzcGVjaWFsIGNoYXJhY3RlcnNdKGh0dHA6Ly93d3cucmVndWxhci1leHByZXNzaW9ucy5pbmZvL2NoYXJhY3RlcnMuaHRtbCNzcGVjaWFsKS4NCiAgICogSW4gYWRkaXRpb24gdG8gc3BlY2lhbCBjaGFyYWN0ZXJzIHRoZSBmb3J3YXJkIHNsYXNoIGlzIGVzY2FwZWQgdG8gYWxsb3cgZm9yDQogICAqIGVhc2llciBgZXZhbGAgdXNlIGFuZCBgRnVuY3Rpb25gIGNvbXBpbGF0aW9uLg0KICAgKi8NCiAgdmFyIHJlUmVnRXhwQ2hhcnMgPSAvWy4qKz9eJHt9KCl8W1xdXC9cXF0vZywNCiAgICAgIHJlSGFzUmVnRXhwQ2hhcnMgPSBSZWdFeHAocmVSZWdFeHBDaGFycy5zb3VyY2UpOw0KDQogIC8qKiBVc2VkIHRvIG1hdGNoIFtjb21iaW5pbmcgZGlhY3JpdGljYWwgbWFya3NdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NvbWJpbmluZ19EaWFjcml0aWNhbF9NYXJrcykuICovDQogIHZhciByZUNvbWJvTWFyayA9IC9bXHUwMzAwLVx1MDM2Zlx1ZmUyMC1cdWZlMjNdL2c7DQoNCiAgLyoqIFVzZWQgdG8gbWF0Y2ggYmFja3NsYXNoZXMgaW4gcHJvcGVydHkgcGF0aHMuICovDQogIHZhciByZUVzY2FwZUNoYXIgPSAvXFwoXFwpPy9nOw0KDQogIC8qKiBVc2VkIHRvIG1hdGNoIFtFUyB0ZW1wbGF0ZSBkZWxpbWl0ZXJzXShodHRwczovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtdGVtcGxhdGUtbGl0ZXJhbC1sZXhpY2FsLWNvbXBvbmVudHMpLiAqLw0KICB2YXIgcmVFc1RlbXBsYXRlID0gL1wkXHsoW15cXH1dKig/OlxcLlteXFx9XSopKilcfS9nOw0KDQogIC8qKiBVc2VkIHRvIG1hdGNoIGBSZWdFeHBgIGZsYWdzIGZyb20gdGhlaXIgY29lcmNlZCBzdHJpbmcgdmFsdWVzLiAqLw0KICB2YXIgcmVGbGFncyA9IC9cdyokLzsNCg0KICAvKiogVXNlZCB0byBkZXRlY3QgaGV4YWRlY2ltYWwgc3RyaW5nIHZhbHVlcy4gKi8NCiAgdmFyIHJlSGFzSGV4UHJlZml4ID0gL14wW3hYXS87DQoNCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IGhvc3QgY29uc3RydWN0b3JzIChTYWZhcmkgPiA1KS4gKi8NCiAgdmFyIHJlSXNIb3N0Q3RvciA9IC9eXFtvYmplY3QgLis/Q29uc3RydWN0b3JcXSQvOw0KDQogIC8qKiBVc2VkIHRvIGRldGVjdCB1bnNpZ25lZCBpbnRlZ2VyIHZhbHVlcy4gKi8NCiAgdmFyIHJlSXNVaW50ID0gL15cZCskLzsNCg0KICAvKiogVXNlZCB0byBtYXRjaCBsYXRpbi0xIHN1cHBsZW1lbnRhcnkgbGV0dGVycyAoZXhjbHVkaW5nIG1hdGhlbWF0aWNhbCBvcGVyYXRvcnMpLiAqLw0KICB2YXIgcmVMYXRpbjEgPSAvW1x4YzAtXHhkNlx4ZDgtXHhkZVx4ZGYtXHhmNlx4ZjgtXHhmZl0vZzsNCg0KICAvKiogVXNlZCB0byBlbnN1cmUgY2FwdHVyaW5nIG9yZGVyIG9mIHRlbXBsYXRlIGRlbGltaXRlcnMuICovDQogIHZhciByZU5vTWF0Y2ggPSAvKCReKS87DQoNCiAgLyoqIFVzZWQgdG8gbWF0Y2ggdW5lc2NhcGVkIGNoYXJhY3RlcnMgaW4gY29tcGlsZWQgc3RyaW5nIGxpdGVyYWxzLiAqLw0KICB2YXIgcmVVbmVzY2FwZWRTdHJpbmcgPSAvWydcblxyXHUyMDI4XHUyMDI5XFxdL2c7DQoNCiAgLyoqIFVzZWQgdG8gbWF0Y2ggd29yZHMgdG8gY3JlYXRlIGNvbXBvdW5kIHdvcmRzLiAqLw0KICB2YXIgcmVXb3JkcyA9IChmdW5jdGlvbigpIHsNCiAgICB2YXIgdXBwZXIgPSAnW0EtWlxceGMwLVxceGQ2XFx4ZDgtXFx4ZGVdJywNCiAgICAgICAgbG93ZXIgPSAnW2EtelxceGRmLVxceGY2XFx4ZjgtXFx4ZmZdKyc7DQoNCiAgICByZXR1cm4gUmVnRXhwKHVwcGVyICsgJysoPz0nICsgdXBwZXIgKyBsb3dlciArICcpfCcgKyB1cHBlciArICc/JyArIGxvd2VyICsgJ3wnICsgdXBwZXIgKyAnK3xbMC05XSsnLCAnZycpOw0KICB9KCkpOw0KDQogIC8qKiBVc2VkIHRvIGRldGVjdCBhbmQgdGVzdCBmb3Igd2hpdGVzcGFjZS4gKi8NCiAgdmFyIHdoaXRlc3BhY2UgPSAoDQogICAgLy8gQmFzaWMgd2hpdGVzcGFjZSBjaGFyYWN0ZXJzLg0KICAgICcgXHRceDBiXGZceGEwXHVmZWZmJyArDQoNCiAgICAvLyBMaW5lIHRlcm1pbmF0b3JzLg0KICAgICdcblxyXHUyMDI4XHUyMDI5JyArDQoNCiAgICAvLyBVbmljb2RlIGNhdGVnb3J5ICJacyIgc3BhY2Ugc2VwYXJhdG9ycy4NCiAgICAnXHUxNjgwXHUxODBlXHUyMDAwXHUyMDAxXHUyMDAyXHUyMDAzXHUyMDA0XHUyMDA1XHUyMDA2XHUyMDA3XHUyMDA4XHUyMDA5XHUyMDBhXHUyMDJmXHUyMDVmXHUzMDAwJw0KICApOw0KDQogIC8qKiBVc2VkIHRvIGFzc2lnbiBkZWZhdWx0IGBjb250ZXh0YCBvYmplY3QgcHJvcGVydGllcy4gKi8NCiAgdmFyIGNvbnRleHRQcm9wcyA9IFsNCiAgICAnQXJyYXknLCAnQXJyYXlCdWZmZXInLCAnRGF0ZScsICdFcnJvcicsICdGbG9hdDMyQXJyYXknLCAnRmxvYXQ2NEFycmF5JywNCiAgICAnRnVuY3Rpb24nLCAnSW50OEFycmF5JywgJ0ludDE2QXJyYXknLCAnSW50MzJBcnJheScsICdNYXRoJywgJ051bWJlcicsDQogICAgJ09iamVjdCcsICdSZWdFeHAnLCAnU2V0JywgJ1N0cmluZycsICdfJywgJ2NsZWFyVGltZW91dCcsICdkb2N1bWVudCcsDQogICAgJ2lzRmluaXRlJywgJ3BhcnNlRmxvYXQnLCAncGFyc2VJbnQnLCAnc2V0VGltZW91dCcsICdUeXBlRXJyb3InLCAnVWludDhBcnJheScsDQogICAgJ1VpbnQ4Q2xhbXBlZEFycmF5JywgJ1VpbnQxNkFycmF5JywgJ1VpbnQzMkFycmF5JywgJ1dlYWtNYXAnLCAnd2luZG93Jw0KICBdOw0KDQogIC8qKiBVc2VkIHRvIG1ha2UgdGVtcGxhdGUgc291cmNlVVJMcyBlYXNpZXIgdG8gaWRlbnRpZnkuICovDQogIHZhciB0ZW1wbGF0ZUNvdW50ZXIgPSAtMTsNCg0KICAvKiogVXNlZCB0byBpZGVudGlmeSBgdG9TdHJpbmdUYWdgIHZhbHVlcyBvZiB0eXBlZCBhcnJheXMuICovDQogIHZhciB0eXBlZEFycmF5VGFncyA9IHt9Ow0KICB0eXBlZEFycmF5VGFnc1tmbG9hdDMyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Zsb2F0NjRUYWddID0NCiAgdHlwZWRBcnJheVRhZ3NbaW50OFRhZ10gPSB0eXBlZEFycmF5VGFnc1tpbnQxNlRhZ10gPQ0KICB0eXBlZEFycmF5VGFnc1tpbnQzMlRhZ10gPSB0eXBlZEFycmF5VGFnc1t1aW50OFRhZ10gPQ0KICB0eXBlZEFycmF5VGFnc1t1aW50OENsYW1wZWRUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDE2VGFnXSA9DQogIHR5cGVkQXJyYXlUYWdzW3VpbnQzMlRhZ10gPSB0cnVlOw0KICB0eXBlZEFycmF5VGFnc1thcmdzVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2FycmF5VGFnXSA9DQogIHR5cGVkQXJyYXlUYWdzW2FycmF5QnVmZmVyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Jvb2xUYWddID0NCiAgdHlwZWRBcnJheVRhZ3NbZGF0ZVRhZ10gPSB0eXBlZEFycmF5VGFnc1tlcnJvclRhZ10gPQ0KICB0eXBlZEFycmF5VGFnc1tmdW5jVGFnXSA9IHR5cGVkQXJyYXlUYWdzW21hcFRhZ10gPQ0KICB0eXBlZEFycmF5VGFnc1tudW1iZXJUYWddID0gdHlwZWRBcnJheVRhZ3Nbb2JqZWN0VGFnXSA9DQogIHR5cGVkQXJyYXlUYWdzW3JlZ2V4cFRhZ10gPSB0eXBlZEFycmF5VGFnc1tzZXRUYWddID0NCiAgdHlwZWRBcnJheVRhZ3Nbc3RyaW5nVGFnXSA9IHR5cGVkQXJyYXlUYWdzW3dlYWtNYXBUYWddID0gZmFsc2U7DQoNCiAgLyoqIFVzZWQgdG8gaWRlbnRpZnkgYHRvU3RyaW5nVGFnYCB2YWx1ZXMgc3VwcG9ydGVkIGJ5IGBfLmNsb25lYC4gKi8NCiAgdmFyIGNsb25lYWJsZVRhZ3MgPSB7fTsNCiAgY2xvbmVhYmxlVGFnc1thcmdzVGFnXSA9IGNsb25lYWJsZVRhZ3NbYXJyYXlUYWddID0NCiAgY2xvbmVhYmxlVGFnc1thcnJheUJ1ZmZlclRhZ10gPSBjbG9uZWFibGVUYWdzW2Jvb2xUYWddID0NCiAgY2xvbmVhYmxlVGFnc1tkYXRlVGFnXSA9IGNsb25lYWJsZVRhZ3NbZmxvYXQzMlRhZ10gPQ0KICBjbG9uZWFibGVUYWdzW2Zsb2F0NjRUYWddID0gY2xvbmVhYmxlVGFnc1tpbnQ4VGFnXSA9DQogIGNsb25lYWJsZVRhZ3NbaW50MTZUYWddID0gY2xvbmVhYmxlVGFnc1tpbnQzMlRhZ10gPQ0KICBjbG9uZWFibGVUYWdzW251bWJlclRhZ10gPSBjbG9uZWFibGVUYWdzW29iamVjdFRhZ10gPQ0KICBjbG9uZWFibGVUYWdzW3JlZ2V4cFRhZ10gPSBjbG9uZWFibGVUYWdzW3N0cmluZ1RhZ10gPQ0KICBjbG9uZWFibGVUYWdzW3VpbnQ4VGFnXSA9IGNsb25lYWJsZVRhZ3NbdWludDhDbGFtcGVkVGFnXSA9DQogIGNsb25lYWJsZVRhZ3NbdWludDE2VGFnXSA9IGNsb25lYWJsZVRhZ3NbdWludDMyVGFnXSA9IHRydWU7DQogIGNsb25lYWJsZVRhZ3NbZXJyb3JUYWddID0gY2xvbmVhYmxlVGFnc1tmdW5jVGFnXSA9DQogIGNsb25lYWJsZVRhZ3NbbWFwVGFnXSA9IGNsb25lYWJsZVRhZ3Nbc2V0VGFnXSA9DQogIGNsb25lYWJsZVRhZ3Nbd2Vha01hcFRhZ10gPSBmYWxzZTsNCg0KICAvKiogVXNlZCBhcyBhbiBpbnRlcm5hbCBgXy5kZWJvdW5jZWAgb3B0aW9ucyBvYmplY3QgYnkgYF8udGhyb3R0bGVgLiAqLw0KICB2YXIgZGVib3VuY2VPcHRpb25zID0gew0KICAgICdsZWFkaW5nJzogZmFsc2UsDQogICAgJ21heFdhaXQnOiAwLA0KICAgICd0cmFpbGluZyc6IGZhbHNlDQogIH07DQoNCiAgLyoqIFVzZWQgdG8gbWFwIGxhdGluLTEgc3VwcGxlbWVudGFyeSBsZXR0ZXJzIHRvIGJhc2ljIGxhdGluIGxldHRlcnMuICovDQogIHZhciBkZWJ1cnJlZExldHRlcnMgPSB7DQogICAgJ1x4YzAnOiAnQScsICAnXHhjMSc6ICdBJywgJ1x4YzInOiAnQScsICdceGMzJzogJ0EnLCAnXHhjNCc6ICdBJywgJ1x4YzUnOiAnQScsDQogICAgJ1x4ZTAnOiAnYScsICAnXHhlMSc6ICdhJywgJ1x4ZTInOiAnYScsICdceGUzJzogJ2EnLCAnXHhlNCc6ICdhJywgJ1x4ZTUnOiAnYScsDQogICAgJ1x4YzcnOiAnQycsICAnXHhlNyc6ICdjJywNCiAgICAnXHhkMCc6ICdEJywgICdceGYwJzogJ2QnLA0KICAgICdceGM4JzogJ0UnLCAgJ1x4YzknOiAnRScsICdceGNhJzogJ0UnLCAnXHhjYic6ICdFJywNCiAgICAnXHhlOCc6ICdlJywgICdceGU5JzogJ2UnLCAnXHhlYSc6ICdlJywgJ1x4ZWInOiAnZScsDQogICAgJ1x4Y0MnOiAnSScsICAnXHhjZCc6ICdJJywgJ1x4Y2UnOiAnSScsICdceGNmJzogJ0knLA0KICAgICdceGVDJzogJ2knLCAgJ1x4ZWQnOiAnaScsICdceGVlJzogJ2knLCAnXHhlZic6ICdpJywNCiAgICAnXHhkMSc6ICdOJywgICdceGYxJzogJ24nLA0KICAgICdceGQyJzogJ08nLCAgJ1x4ZDMnOiAnTycsICdceGQ0JzogJ08nLCAnXHhkNSc6ICdPJywgJ1x4ZDYnOiAnTycsICdceGQ4JzogJ08nLA0KICAgICdceGYyJzogJ28nLCAgJ1x4ZjMnOiAnbycsICdceGY0JzogJ28nLCAnXHhmNSc6ICdvJywgJ1x4ZjYnOiAnbycsICdceGY4JzogJ28nLA0KICAgICdceGQ5JzogJ1UnLCAgJ1x4ZGEnOiAnVScsICdceGRiJzogJ1UnLCAnXHhkYyc6ICdVJywNCiAgICAnXHhmOSc6ICd1JywgICdceGZhJzogJ3UnLCAnXHhmYic6ICd1JywgJ1x4ZmMnOiAndScsDQogICAgJ1x4ZGQnOiAnWScsICAnXHhmZCc6ICd5JywgJ1x4ZmYnOiAneScsDQogICAgJ1x4YzYnOiAnQWUnLCAnXHhlNic6ICdhZScsDQogICAgJ1x4ZGUnOiAnVGgnLCAnXHhmZSc6ICd0aCcsDQogICAgJ1x4ZGYnOiAnc3MnDQogIH07DQoNCiAgLyoqIFVzZWQgdG8gbWFwIGNoYXJhY3RlcnMgdG8gSFRNTCBlbnRpdGllcy4gKi8NCiAgdmFyIGh0bWxFc2NhcGVzID0gew0KICAgICcmJzogJyZhbXA7JywNCiAgICAnPCc6ICcmbHQ7JywNCiAgICAnPic6ICcmZ3Q7JywNCiAgICAnIic6ICcmcXVvdDsnLA0KICAgICInIjogJyYjMzk7JywNCiAgICAnYCc6ICcmIzk2OycNCiAgfTsNCg0KICAvKiogVXNlZCB0byBtYXAgSFRNTCBlbnRpdGllcyB0byBjaGFyYWN0ZXJzLiAqLw0KICB2YXIgaHRtbFVuZXNjYXBlcyA9IHsNCiAgICAnJmFtcDsnOiAnJicsDQogICAgJyZsdDsnOiAnPCcsDQogICAgJyZndDsnOiAnPicsDQogICAgJyZxdW90Oyc6ICciJywNCiAgICAnJiMzOTsnOiAiJyIsDQogICAgJyYjOTY7JzogJ2AnDQogIH07DQoNCiAgLyoqIFVzZWQgdG8gZGV0ZXJtaW5lIGlmIHZhbHVlcyBhcmUgb2YgdGhlIGxhbmd1YWdlIHR5cGUgYE9iamVjdGAuICovDQogIHZhciBvYmplY3RUeXBlcyA9IHsNCiAgICAnZnVuY3Rpb24nOiB0cnVlLA0KICAgICdvYmplY3QnOiB0cnVlDQogIH07DQoNCiAgLyoqIFVzZWQgdG8gZXNjYXBlIGNoYXJhY3RlcnMgZm9yIGluY2x1c2lvbiBpbiBjb21waWxlZCBzdHJpbmcgbGl0ZXJhbHMuICovDQogIHZhciBzdHJpbmdFc2NhcGVzID0gew0KICAgICdcXCc6ICdcXCcsDQogICAgIiciOiAiJyIsDQogICAgJ1xuJzogJ24nLA0KICAgICdccic6ICdyJywNCiAgICAnXHUyMDI4JzogJ3UyMDI4JywNCiAgICAnXHUyMDI5JzogJ3UyMDI5Jw0KICB9Ow0KDQogIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgZXhwb3J0c2AuICovDQogIHZhciBmcmVlRXhwb3J0cyA9IG9iamVjdFR5cGVzW3R5cGVvZiBleHBvcnRzXSAmJiBleHBvcnRzICYmICFleHBvcnRzLm5vZGVUeXBlICYmIGV4cG9ydHM7DQoNCiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBtb2R1bGVgLiAqLw0KICB2YXIgZnJlZU1vZHVsZSA9IG9iamVjdFR5cGVzW3R5cGVvZiBtb2R1bGVdICYmIG1vZHVsZSAmJiAhbW9kdWxlLm5vZGVUeXBlICYmIG1vZHVsZTsNCg0KICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYGdsb2JhbGAgZnJvbSBOb2RlLmpzLiAqLw0KICB2YXIgZnJlZUdsb2JhbCA9IGZyZWVFeHBvcnRzICYmIGZyZWVNb2R1bGUgJiYgdHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwgJiYgZ2xvYmFsLk9iamVjdCAmJiBnbG9iYWw7DQoNCiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBzZWxmYC4gKi8NCiAgdmFyIGZyZWVTZWxmID0gb2JqZWN0VHlwZXNbdHlwZW9mIHNlbGZdICYmIHNlbGYgJiYgc2VsZi5PYmplY3QgJiYgc2VsZjsNCg0KICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYHdpbmRvd2AuICovDQogIHZhciBmcmVlV2luZG93ID0gb2JqZWN0VHlwZXNbdHlwZW9mIHdpbmRvd10gJiYgd2luZG93ICYmIHdpbmRvdy5PYmplY3QgJiYgd2luZG93Ow0KDQogIC8qKiBEZXRlY3QgdGhlIHBvcHVsYXIgQ29tbW9uSlMgZXh0ZW5zaW9uIGBtb2R1bGUuZXhwb3J0c2AuICovDQogIHZhciBtb2R1bGVFeHBvcnRzID0gZnJlZU1vZHVsZSAmJiBmcmVlTW9kdWxlLmV4cG9ydHMgPT09IGZyZWVFeHBvcnRzICYmIGZyZWVFeHBvcnRzOw0KDQogIC8qKg0KICAgKiBVc2VkIGFzIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0Lg0KICAgKg0KICAgKiBUaGUgYHRoaXNgIHZhbHVlIGlzIHVzZWQgaWYgaXQncyB0aGUgZ2xvYmFsIG9iamVjdCB0byBhdm9pZCBHcmVhc2Vtb25rZXkncw0KICAgKiByZXN0cmljdGVkIGB3aW5kb3dgIG9iamVjdCwgb3RoZXJ3aXNlIHRoZSBgd2luZG93YCBvYmplY3QgaXMgdXNlZC4NCiAgICovDQogIHZhciByb290ID0gZnJlZUdsb2JhbCB8fCAoKGZyZWVXaW5kb3cgIT09ICh0aGlzICYmIHRoaXMud2luZG93KSkgJiYgZnJlZVdpbmRvdykgfHwgZnJlZVNlbGYgfHwgdGhpczsNCg0KICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KICAvKioNCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYGNvbXBhcmVBc2NlbmRpbmdgIHdoaWNoIGNvbXBhcmVzIHZhbHVlcyBhbmQNCiAgICogc29ydHMgdGhlbSBpbiBhc2NlbmRpbmcgb3JkZXIgd2l0aG91dCBndWFyYW50ZWVpbmcgYSBzdGFibGUgc29ydC4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS4NCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4NCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgc29ydCBvcmRlciBpbmRpY2F0b3IgZm9yIGB2YWx1ZWAuDQogICAqLw0KICBmdW5jdGlvbiBiYXNlQ29tcGFyZUFzY2VuZGluZyh2YWx1ZSwgb3RoZXIpIHsNCiAgICBpZiAodmFsdWUgIT09IG90aGVyKSB7DQogICAgICB2YXIgdmFsSXNOdWxsID0gdmFsdWUgPT09IG51bGwsDQogICAgICAgICAgdmFsSXNVbmRlZiA9IHZhbHVlID09PSB1bmRlZmluZWQsDQogICAgICAgICAgdmFsSXNSZWZsZXhpdmUgPSB2YWx1ZSA9PT0gdmFsdWU7DQoNCiAgICAgIHZhciBvdGhJc051bGwgPSBvdGhlciA9PT0gbnVsbCwNCiAgICAgICAgICBvdGhJc1VuZGVmID0gb3RoZXIgPT09IHVuZGVmaW5lZCwNCiAgICAgICAgICBvdGhJc1JlZmxleGl2ZSA9IG90aGVyID09PSBvdGhlcjsNCg0KICAgICAgaWYgKCh2YWx1ZSA+IG90aGVyICYmICFvdGhJc051bGwpIHx8ICF2YWxJc1JlZmxleGl2ZSB8fA0KICAgICAgICAgICh2YWxJc051bGwgJiYgIW90aElzVW5kZWYgJiYgb3RoSXNSZWZsZXhpdmUpIHx8DQogICAgICAgICAgKHZhbElzVW5kZWYgJiYgb3RoSXNSZWZsZXhpdmUpKSB7DQogICAgICAgIHJldHVybiAxOw0KICAgICAgfQ0KICAgICAgaWYgKCh2YWx1ZSA8IG90aGVyICYmICF2YWxJc051bGwpIHx8ICFvdGhJc1JlZmxleGl2ZSB8fA0KICAgICAgICAgIChvdGhJc051bGwgJiYgIXZhbElzVW5kZWYgJiYgdmFsSXNSZWZsZXhpdmUpIHx8DQogICAgICAgICAgKG90aElzVW5kZWYgJiYgdmFsSXNSZWZsZXhpdmUpKSB7DQogICAgICAgIHJldHVybiAtMTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIDA7DQogIH0NCg0KICAvKioNCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZmluZEluZGV4YCBhbmQgYF8uZmluZExhc3RJbmRleGAgd2l0aG91dA0KICAgKiBzdXBwb3J0IGZvciBjYWxsYmFjayBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHNlYXJjaC4NCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2Zyb21SaWdodF0gU3BlY2lmeSBpdGVyYXRpbmcgZnJvbSByaWdodCB0byBsZWZ0Lg0KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLg0KICAgKi8NCiAgZnVuY3Rpb24gYmFzZUZpbmRJbmRleChhcnJheSwgcHJlZGljYXRlLCBmcm9tUmlnaHQpIHsNCiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLA0KICAgICAgICBpbmRleCA9IGZyb21SaWdodCA/IGxlbmd0aCA6IC0xOw0KDQogICAgd2hpbGUgKChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkpIHsNCiAgICAgIGlmIChwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSB7DQogICAgICAgIHJldHVybiBpbmRleDsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIC0xOw0KICB9DQoNCiAgLyoqDQogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmluZGV4T2ZgIHdpdGhvdXQgc3VwcG9ydCBmb3IgYmluYXJ5IHNlYXJjaGVzLg0KICAgKg0KICAgKiBAcHJpdmF0ZQ0KICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gc2VhcmNoLg0KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLg0KICAgKiBAcGFyYW0ge251bWJlcn0gZnJvbUluZGV4IFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS4NCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4NCiAgICovDQogIGZ1bmN0aW9uIGJhc2VJbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7DQogICAgaWYgKHZhbHVlICE9PSB2YWx1ZSkgew0KICAgICAgcmV0dXJuIGluZGV4T2ZOYU4oYXJyYXksIGZyb21JbmRleCk7DQogICAgfQ0KICAgIHZhciBpbmRleCA9IGZyb21JbmRleCAtIDEsDQogICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsNCg0KICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICBpZiAoYXJyYXlbaW5kZXhdID09PSB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gaW5kZXg7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiAtMTsNCiAgfQ0KDQogIC8qKg0KICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc0Z1bmN0aW9uYCB3aXRob3V0IHN1cHBvcnQgZm9yIGVudmlyb25tZW50cw0KICAgKiB3aXRoIGluY29ycmVjdCBgdHlwZW9mYCByZXN1bHRzLg0KICAgKg0KICAgKiBAcHJpdmF0ZQ0KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgY29ycmVjdGx5IGNsYXNzaWZpZWQsIGVsc2UgYGZhbHNlYC4NCiAgICovDQogIGZ1bmN0aW9uIGJhc2VJc0Z1bmN0aW9uKHZhbHVlKSB7DQogICAgLy8gQXZvaWQgYSBDaGFrcmEgSklUIGJ1ZyBpbiBjb21wYXRpYmlsaXR5IG1vZGVzIG9mIElFIDExLg0KICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vamFzaGtlbmFzL3VuZGVyc2NvcmUvaXNzdWVzLzE2MjEgZm9yIG1vcmUgZGV0YWlscy4NCiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdmdW5jdGlvbicgfHwgZmFsc2U7DQogIH0NCg0KICAvKioNCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHN0cmluZyBpZiBpdCdzIG5vdCBvbmUuIEFuIGVtcHR5IHN0cmluZyBpcyByZXR1cm5lZA0KICAgKiBmb3IgYG51bGxgIG9yIGB1bmRlZmluZWRgIHZhbHVlcy4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcHJvY2Vzcy4NCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgc3RyaW5nLg0KICAgKi8NCiAgZnVuY3Rpb24gYmFzZVRvU3RyaW5nKHZhbHVlKSB7DQogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJykgew0KICAgICAgcmV0dXJuIHZhbHVlOw0KICAgIH0NCiAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICcnIDogKHZhbHVlICsgJycpOw0KICB9DQoNCiAgLyoqDQogICAqIFVzZWQgYnkgYF8udHJpbWAgYW5kIGBfLnRyaW1MZWZ0YCB0byBnZXQgdGhlIGluZGV4IG9mIHRoZSBmaXJzdCBjaGFyYWN0ZXINCiAgICogb2YgYHN0cmluZ2AgdGhhdCBpcyBub3QgZm91bmQgaW4gYGNoYXJzYC4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGluc3BlY3QuDQogICAqIEBwYXJhbSB7c3RyaW5nfSBjaGFycyBUaGUgY2hhcmFjdGVycyB0byBmaW5kLg0KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZmlyc3QgY2hhcmFjdGVyIG5vdCBmb3VuZCBpbiBgY2hhcnNgLg0KICAgKi8NCiAgZnVuY3Rpb24gY2hhcnNMZWZ0SW5kZXgoc3RyaW5nLCBjaGFycykgew0KICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICBsZW5ndGggPSBzdHJpbmcubGVuZ3RoOw0KDQogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGggJiYgY2hhcnMuaW5kZXhPZihzdHJpbmcuY2hhckF0KGluZGV4KSkgPiAtMSkge30NCiAgICByZXR1cm4gaW5kZXg7DQogIH0NCg0KICAvKioNCiAgICogVXNlZCBieSBgXy50cmltYCBhbmQgYF8udHJpbVJpZ2h0YCB0byBnZXQgdGhlIGluZGV4IG9mIHRoZSBsYXN0IGNoYXJhY3Rlcg0KICAgKiBvZiBgc3RyaW5nYCB0aGF0IGlzIG5vdCBmb3VuZCBpbiBgY2hhcnNgLg0KICAgKg0KICAgKiBAcHJpdmF0ZQ0KICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gaW5zcGVjdC4NCiAgICogQHBhcmFtIHtzdHJpbmd9IGNoYXJzIFRoZSBjaGFyYWN0ZXJzIHRvIGZpbmQuDQogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBsYXN0IGNoYXJhY3RlciBub3QgZm91bmQgaW4gYGNoYXJzYC4NCiAgICovDQogIGZ1bmN0aW9uIGNoYXJzUmlnaHRJbmRleChzdHJpbmcsIGNoYXJzKSB7DQogICAgdmFyIGluZGV4ID0gc3RyaW5nLmxlbmd0aDsNCg0KICAgIHdoaWxlIChpbmRleC0tICYmIGNoYXJzLmluZGV4T2Yoc3RyaW5nLmNoYXJBdChpbmRleCkpID4gLTEpIHt9DQogICAgcmV0dXJuIGluZGV4Ow0KICB9DQoNCiAgLyoqDQogICAqIFVzZWQgYnkgYF8uc29ydEJ5YCB0byBjb21wYXJlIHRyYW5zZm9ybWVkIGVsZW1lbnRzIG9mIGEgY29sbGVjdGlvbiBhbmQgc3RhYmxlDQogICAqIHNvcnQgdGhlbSBpbiBhc2NlbmRpbmcgb3JkZXIuDQogICAqDQogICAqIEBwcml2YXRlDQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBjb21wYXJlIHRvIGBvdGhlcmAuDQogICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlciBUaGUgb2JqZWN0IHRvIGNvbXBhcmUgdG8gYG9iamVjdGAuDQogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHNvcnQgb3JkZXIgaW5kaWNhdG9yIGZvciBgb2JqZWN0YC4NCiAgICovDQogIGZ1bmN0aW9uIGNvbXBhcmVBc2NlbmRpbmcob2JqZWN0LCBvdGhlcikgew0KICAgIHJldHVybiBiYXNlQ29tcGFyZUFzY2VuZGluZyhvYmplY3QuY3JpdGVyaWEsIG90aGVyLmNyaXRlcmlhKSB8fCAob2JqZWN0LmluZGV4IC0gb3RoZXIuaW5kZXgpOw0KICB9DQoNCiAgLyoqDQogICAqIFVzZWQgYnkgYF8uc29ydEJ5T3JkZXJgIHRvIGNvbXBhcmUgbXVsdGlwbGUgcHJvcGVydGllcyBvZiBlYWNoIGVsZW1lbnQNCiAgICogaW4gYSBjb2xsZWN0aW9uIGFuZCBzdGFibGUgc29ydCB0aGVtIGluIHRoZSBmb2xsb3dpbmcgb3JkZXI6DQogICAqDQogICAqIElmIGBvcmRlcnNgIGlzIHVuc3BlY2lmaWVkLCBzb3J0IGluIGFzY2VuZGluZyBvcmRlciBmb3IgYWxsIHByb3BlcnRpZXMuDQogICAqIE90aGVyd2lzZSwgZm9yIGVhY2ggcHJvcGVydHksIHNvcnQgaW4gYXNjZW5kaW5nIG9yZGVyIGlmIGl0cyBjb3JyZXNwb25kaW5nIHZhbHVlIGluDQogICAqIG9yZGVycyBpcyB0cnVlLCBhbmQgZGVzY2VuZGluZyBvcmRlciBpZiBmYWxzZS4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGNvbXBhcmUgdG8gYG90aGVyYC4NCiAgICogQHBhcmFtIHtPYmplY3R9IG90aGVyIFRoZSBvYmplY3QgdG8gY29tcGFyZSB0byBgb2JqZWN0YC4NCiAgICogQHBhcmFtIHtib29sZWFuW119IG9yZGVycyBUaGUgb3JkZXIgdG8gc29ydCBieSBmb3IgZWFjaCBwcm9wZXJ0eS4NCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgc29ydCBvcmRlciBpbmRpY2F0b3IgZm9yIGBvYmplY3RgLg0KICAgKi8NCiAgZnVuY3Rpb24gY29tcGFyZU11bHRpcGxlKG9iamVjdCwgb3RoZXIsIG9yZGVycykgew0KICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICBvYmpDcml0ZXJpYSA9IG9iamVjdC5jcml0ZXJpYSwNCiAgICAgICAgb3RoQ3JpdGVyaWEgPSBvdGhlci5jcml0ZXJpYSwNCiAgICAgICAgbGVuZ3RoID0gb2JqQ3JpdGVyaWEubGVuZ3RoLA0KICAgICAgICBvcmRlcnNMZW5ndGggPSBvcmRlcnMubGVuZ3RoOw0KDQogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgIHZhciByZXN1bHQgPSBiYXNlQ29tcGFyZUFzY2VuZGluZyhvYmpDcml0ZXJpYVtpbmRleF0sIG90aENyaXRlcmlhW2luZGV4XSk7DQogICAgICBpZiAocmVzdWx0KSB7DQogICAgICAgIGlmIChpbmRleCA+PSBvcmRlcnNMZW5ndGgpIHsNCiAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQgKiAob3JkZXJzW2luZGV4XSA/IDEgOiAtMSk7DQogICAgICB9DQogICAgfQ0KICAgIC8vIEZpeGVzIGFuIGBBcnJheSNzb3J0YCBidWcgaW4gdGhlIEpTIGVuZ2luZSBlbWJlZGRlZCBpbiBBZG9iZSBhcHBsaWNhdGlvbnMNCiAgICAvLyB0aGF0IGNhdXNlcyBpdCwgdW5kZXIgY2VydGFpbiBjaXJjdW1zdGFuY2VzLCB0byBwcm92aWRlIHRoZSBzYW1lIHZhbHVlIGZvcg0KICAgIC8vIGBvYmplY3RgIGFuZCBgb3RoZXJgLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2phc2hrZW5hcy91bmRlcnNjb3JlL3B1bGwvMTI0Nw0KICAgIC8vIGZvciBtb3JlIGRldGFpbHMuDQogICAgLy8NCiAgICAvLyBUaGlzIGFsc28gZW5zdXJlcyBhIHN0YWJsZSBzb3J0IGluIFY4IGFuZCBvdGhlciBlbmdpbmVzLg0KICAgIC8vIFNlZSBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9OTAgZm9yIG1vcmUgZGV0YWlscy4NCiAgICByZXR1cm4gb2JqZWN0LmluZGV4IC0gb3RoZXIuaW5kZXg7DQogIH0NCg0KICAvKioNCiAgICogVXNlZCBieSBgXy5kZWJ1cnJgIHRvIGNvbnZlcnQgbGF0aW4tMSBzdXBwbGVtZW50YXJ5IGxldHRlcnMgdG8gYmFzaWMgbGF0aW4gbGV0dGVycy4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHtzdHJpbmd9IGxldHRlciBUaGUgbWF0Y2hlZCBsZXR0ZXIgdG8gZGVidXJyLg0KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBkZWJ1cnJlZCBsZXR0ZXIuDQogICAqLw0KICBmdW5jdGlvbiBkZWJ1cnJMZXR0ZXIobGV0dGVyKSB7DQogICAgcmV0dXJuIGRlYnVycmVkTGV0dGVyc1tsZXR0ZXJdOw0KICB9DQoNCiAgLyoqDQogICAqIFVzZWQgYnkgYF8uZXNjYXBlYCB0byBjb252ZXJ0IGNoYXJhY3RlcnMgdG8gSFRNTCBlbnRpdGllcy4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHtzdHJpbmd9IGNociBUaGUgbWF0Y2hlZCBjaGFyYWN0ZXIgdG8gZXNjYXBlLg0KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBlc2NhcGVkIGNoYXJhY3Rlci4NCiAgICovDQogIGZ1bmN0aW9uIGVzY2FwZUh0bWxDaGFyKGNocikgew0KICAgIHJldHVybiBodG1sRXNjYXBlc1tjaHJdOw0KICB9DQoNCiAgLyoqDQogICAqIFVzZWQgYnkgYF8udGVtcGxhdGVgIHRvIGVzY2FwZSBjaGFyYWN0ZXJzIGZvciBpbmNsdXNpb24gaW4gY29tcGlsZWQNCiAgICogc3RyaW5nIGxpdGVyYWxzLg0KICAgKg0KICAgKiBAcHJpdmF0ZQ0KICAgKiBAcGFyYW0ge3N0cmluZ30gY2hyIFRoZSBtYXRjaGVkIGNoYXJhY3RlciB0byBlc2NhcGUuDQogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGVzY2FwZWQgY2hhcmFjdGVyLg0KICAgKi8NCiAgZnVuY3Rpb24gZXNjYXBlU3RyaW5nQ2hhcihjaHIpIHsNCiAgICByZXR1cm4gJ1xcJyArIHN0cmluZ0VzY2FwZXNbY2hyXTsNCiAgfQ0KDQogIC8qKg0KICAgKiBHZXRzIHRoZSBpbmRleCBhdCB3aGljaCB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgTmFOYCBpcyBmb3VuZCBpbiBgYXJyYXlgLg0KICAgKg0KICAgKiBAcHJpdmF0ZQ0KICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gc2VhcmNoLg0KICAgKiBAcGFyYW0ge251bWJlcn0gZnJvbUluZGV4IFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS4NCiAgICogQHBhcmFtIHtib29sZWFufSBbZnJvbVJpZ2h0XSBTcGVjaWZ5IGl0ZXJhdGluZyBmcm9tIHJpZ2h0IHRvIGxlZnQuDQogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIGBOYU5gLCBlbHNlIGAtMWAuDQogICAqLw0KICBmdW5jdGlvbiBpbmRleE9mTmFOKGFycmF5LCBmcm9tSW5kZXgsIGZyb21SaWdodCkgew0KICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGgsDQogICAgICAgIGluZGV4ID0gZnJvbUluZGV4ICsgKGZyb21SaWdodCA/IDAgOiAtMSk7DQoNCiAgICB3aGlsZSAoKGZyb21SaWdodCA/IGluZGV4LS0gOiArK2luZGV4IDwgbGVuZ3RoKSkgew0KICAgICAgdmFyIG90aGVyID0gYXJyYXlbaW5kZXhdOw0KICAgICAgaWYgKG90aGVyICE9PSBvdGhlcikgew0KICAgICAgICByZXR1cm4gaW5kZXg7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiAtMTsNCiAgfQ0KDQogIC8qKg0KICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZS4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLCBlbHNlIGBmYWxzZWAuDQogICAqLw0KICBmdW5jdGlvbiBpc09iamVjdExpa2UodmFsdWUpIHsNCiAgICByZXR1cm4gISF2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCc7DQogIH0NCg0KICAvKioNCiAgICogVXNlZCBieSBgdHJpbW1lZExlZnRJbmRleGAgYW5kIGB0cmltbWVkUmlnaHRJbmRleGAgdG8gZGV0ZXJtaW5lIGlmIGENCiAgICogY2hhcmFjdGVyIGNvZGUgaXMgd2hpdGVzcGFjZS4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHtudW1iZXJ9IGNoYXJDb2RlIFRoZSBjaGFyYWN0ZXIgY29kZSB0byBpbnNwZWN0Lg0KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYGNoYXJDb2RlYCBpcyB3aGl0ZXNwYWNlLCBlbHNlIGBmYWxzZWAuDQogICAqLw0KICBmdW5jdGlvbiBpc1NwYWNlKGNoYXJDb2RlKSB7DQogICAgcmV0dXJuICgoY2hhckNvZGUgPD0gMTYwICYmIChjaGFyQ29kZSA+PSA5ICYmIGNoYXJDb2RlIDw9IDEzKSB8fCBjaGFyQ29kZSA9PSAzMiB8fCBjaGFyQ29kZSA9PSAxNjApIHx8IGNoYXJDb2RlID09IDU3NjAgfHwgY2hhckNvZGUgPT0gNjE1OCB8fA0KICAgICAgKGNoYXJDb2RlID49IDgxOTIgJiYgKGNoYXJDb2RlIDw9IDgyMDIgfHwgY2hhckNvZGUgPT0gODIzMiB8fCBjaGFyQ29kZSA9PSA4MjMzIHx8IGNoYXJDb2RlID09IDgyMzkgfHwgY2hhckNvZGUgPT0gODI4NyB8fCBjaGFyQ29kZSA9PSAxMjI4OCB8fCBjaGFyQ29kZSA9PSA2NTI3OSkpKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBSZXBsYWNlcyBhbGwgYHBsYWNlaG9sZGVyYCBlbGVtZW50cyBpbiBgYXJyYXlgIHdpdGggYW4gaW50ZXJuYWwgcGxhY2Vob2xkZXINCiAgICogYW5kIHJldHVybnMgYW4gYXJyYXkgb2YgdGhlaXIgaW5kZXhlcy4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS4NCiAgICogQHBhcmFtIHsqfSBwbGFjZWhvbGRlciBUaGUgcGxhY2Vob2xkZXIgdG8gcmVwbGFjZS4NCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgcGxhY2Vob2xkZXIgaW5kZXhlcy4NCiAgICovDQogIGZ1bmN0aW9uIHJlcGxhY2VIb2xkZXJzKGFycmF5LCBwbGFjZWhvbGRlcikgew0KICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsDQogICAgICAgIHJlc0luZGV4ID0gLTEsDQogICAgICAgIHJlc3VsdCA9IFtdOw0KDQogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgIGlmIChhcnJheVtpbmRleF0gPT09IHBsYWNlaG9sZGVyKSB7DQogICAgICAgIGFycmF5W2luZGV4XSA9IFBMQUNFSE9MREVSOw0KICAgICAgICByZXN1bHRbKytyZXNJbmRleF0gPSBpbmRleDsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiBgXy51bmlxYCBvcHRpbWl6ZWQgZm9yIHNvcnRlZCBhcnJheXMgd2l0aG91dCBzdXBwb3J0DQogICAqIGZvciBjYWxsYmFjayBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuDQogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZHVwbGljYXRlLXZhbHVlLWZyZWUgYXJyYXkuDQogICAqLw0KICBmdW5jdGlvbiBzb3J0ZWRVbmlxKGFycmF5LCBpdGVyYXRlZSkgew0KICAgIHZhciBzZWVuLA0KICAgICAgICBpbmRleCA9IC0xLA0KICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsDQogICAgICAgIHJlc0luZGV4ID0gLTEsDQogICAgICAgIHJlc3VsdCA9IFtdOw0KDQogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XSwNCiAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID8gaXRlcmF0ZWUodmFsdWUsIGluZGV4LCBhcnJheSkgOiB2YWx1ZTsNCg0KICAgICAgaWYgKCFpbmRleCB8fCBzZWVuICE9PSBjb21wdXRlZCkgew0KICAgICAgICBzZWVuID0gY29tcHV0ZWQ7DQogICAgICAgIHJlc3VsdFsrK3Jlc0luZGV4XSA9IHZhbHVlOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgLyoqDQogICAqIFVzZWQgYnkgYF8udHJpbWAgYW5kIGBfLnRyaW1MZWZ0YCB0byBnZXQgdGhlIGluZGV4IG9mIHRoZSBmaXJzdCBub24td2hpdGVzcGFjZQ0KICAgKiBjaGFyYWN0ZXIgb2YgYHN0cmluZ2AuDQogICAqDQogICAqIEBwcml2YXRlDQogICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBpbnNwZWN0Lg0KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZmlyc3Qgbm9uLXdoaXRlc3BhY2UgY2hhcmFjdGVyLg0KICAgKi8NCiAgZnVuY3Rpb24gdHJpbW1lZExlZnRJbmRleChzdHJpbmcpIHsNCiAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aDsNCg0KICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoICYmIGlzU3BhY2Uoc3RyaW5nLmNoYXJDb2RlQXQoaW5kZXgpKSkge30NCiAgICByZXR1cm4gaW5kZXg7DQogIH0NCg0KICAvKioNCiAgICogVXNlZCBieSBgXy50cmltYCBhbmQgYF8udHJpbVJpZ2h0YCB0byBnZXQgdGhlIGluZGV4IG9mIHRoZSBsYXN0IG5vbi13aGl0ZXNwYWNlDQogICAqIGNoYXJhY3RlciBvZiBgc3RyaW5nYC4NCiAgICoNCiAgICogQHByaXZhdGUNCiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGluc3BlY3QuDQogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBsYXN0IG5vbi13aGl0ZXNwYWNlIGNoYXJhY3Rlci4NCiAgICovDQogIGZ1bmN0aW9uIHRyaW1tZWRSaWdodEluZGV4KHN0cmluZykgew0KICAgIHZhciBpbmRleCA9IHN0cmluZy5sZW5ndGg7DQoNCiAgICB3aGlsZSAoaW5kZXgtLSAmJiBpc1NwYWNlKHN0cmluZy5jaGFyQ29kZUF0KGluZGV4KSkpIHt9DQogICAgcmV0dXJuIGluZGV4Ow0KICB9DQoNCiAgLyoqDQogICAqIFVzZWQgYnkgYF8udW5lc2NhcGVgIHRvIGNvbnZlcnQgSFRNTCBlbnRpdGllcyB0byBjaGFyYWN0ZXJzLg0KICAgKg0KICAgKiBAcHJpdmF0ZQ0KICAgKiBAcGFyYW0ge3N0cmluZ30gY2hyIFRoZSBtYXRjaGVkIGNoYXJhY3RlciB0byB1bmVzY2FwZS4NCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdW5lc2NhcGVkIGNoYXJhY3Rlci4NCiAgICovDQogIGZ1bmN0aW9uIHVuZXNjYXBlSHRtbENoYXIoY2hyKSB7DQogICAgcmV0dXJuIGh0bWxVbmVzY2FwZXNbY2hyXTsNCiAgfQ0KDQogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQogIC8qKg0KICAgKiBDcmVhdGUgYSBuZXcgcHJpc3RpbmUgYGxvZGFzaGAgZnVuY3Rpb24gdXNpbmcgdGhlIGdpdmVuIGBjb250ZXh0YCBvYmplY3QuDQogICAqDQogICAqIEBzdGF0aWMNCiAgICogQG1lbWJlck9mIF8NCiAgICogQGNhdGVnb3J5IFV0aWxpdHkNCiAgICogQHBhcmFtIHtPYmplY3R9IFtjb250ZXh0PXJvb3RdIFRoZSBjb250ZXh0IG9iamVjdC4NCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIGEgbmV3IGBsb2Rhc2hgIGZ1bmN0aW9uLg0KICAgKiBAZXhhbXBsZQ0KICAgKg0KICAgKiBfLm1peGluKHsgJ2Zvbyc6IF8uY29uc3RhbnQoJ2ZvbycpIH0pOw0KICAgKg0KICAgKiB2YXIgbG9kYXNoID0gXy5ydW5JbkNvbnRleHQoKTsNCiAgICogbG9kYXNoLm1peGluKHsgJ2Jhcic6IGxvZGFzaC5jb25zdGFudCgnYmFyJykgfSk7DQogICAqDQogICAqIF8uaXNGdW5jdGlvbihfLmZvbyk7DQogICAqIC8vID0+IHRydWUNCiAgICogXy5pc0Z1bmN0aW9uKF8uYmFyKTsNCiAgICogLy8gPT4gZmFsc2UNCiAgICoNCiAgICogbG9kYXNoLmlzRnVuY3Rpb24obG9kYXNoLmZvbyk7DQogICAqIC8vID0+IGZhbHNlDQogICAqIGxvZGFzaC5pc0Z1bmN0aW9uKGxvZGFzaC5iYXIpOw0KICAgKiAvLyA9PiB0cnVlDQogICAqDQogICAqIC8vIHVzaW5nIGBjb250ZXh0YCB0byBtb2NrIGBEYXRlI2dldFRpbWVgIHVzZSBpbiBgXy5ub3dgDQogICAqIHZhciBtb2NrID0gXy5ydW5JbkNvbnRleHQoew0KICAgKiAgICdEYXRlJzogZnVuY3Rpb24oKSB7DQogICAqICAgICByZXR1cm4geyAnZ2V0VGltZSc6IGdldFRpbWVNb2NrIH07DQogICAqICAgfQ0KICAgKiB9KTsNCiAgICoNCiAgICogLy8gb3IgY3JlYXRpbmcgYSBzdXBlZC11cCBgZGVmZXJgIGluIE5vZGUuanMNCiAgICogdmFyIGRlZmVyID0gXy5ydW5JbkNvbnRleHQoeyAnc2V0VGltZW91dCc6IHNldEltbWVkaWF0ZSB9KS5kZWZlcjsNCiAgICovDQogIGZ1bmN0aW9uIHJ1bkluQ29udGV4dChjb250ZXh0KSB7DQogICAgLy8gQXZvaWQgaXNzdWVzIHdpdGggc29tZSBFUzMgZW52aXJvbm1lbnRzIHRoYXQgYXR0ZW1wdCB0byB1c2UgdmFsdWVzLCBuYW1lZA0KICAgIC8vIGFmdGVyIGJ1aWx0LWluIGNvbnN0cnVjdG9ycyBsaWtlIGBPYmplY3RgLCBmb3IgdGhlIGNyZWF0aW9uIG9mIGxpdGVyYWxzLg0KICAgIC8vIEVTNSBjbGVhcnMgdGhpcyB1cCBieSBzdGF0aW5nIHRoYXQgbGl0ZXJhbHMgbXVzdCB1c2UgYnVpbHQtaW4gY29uc3RydWN0b3JzLg0KICAgIC8vIFNlZSBodHRwczovL2VzNS5naXRodWIuaW8vI3gxMS4xLjUgZm9yIG1vcmUgZGV0YWlscy4NCiAgICBjb250ZXh0ID0gY29udGV4dCA/IF8uZGVmYXVsdHMocm9vdC5PYmplY3QoKSwgY29udGV4dCwgXy5waWNrKHJvb3QsIGNvbnRleHRQcm9wcykpIDogcm9vdDsNCg0KICAgIC8qKiBOYXRpdmUgY29uc3RydWN0b3IgcmVmZXJlbmNlcy4gKi8NCiAgICB2YXIgQXJyYXkgPSBjb250ZXh0LkFycmF5LA0KICAgICAgICBEYXRlID0gY29udGV4dC5EYXRlLA0KICAgICAgICBFcnJvciA9IGNvbnRleHQuRXJyb3IsDQogICAgICAgIEZ1bmN0aW9uID0gY29udGV4dC5GdW5jdGlvbiwNCiAgICAgICAgTWF0aCA9IGNvbnRleHQuTWF0aCwNCiAgICAgICAgTnVtYmVyID0gY29udGV4dC5OdW1iZXIsDQogICAgICAgIE9iamVjdCA9IGNvbnRleHQuT2JqZWN0LA0KICAgICAgICBSZWdFeHAgPSBjb250ZXh0LlJlZ0V4cCwNCiAgICAgICAgU3RyaW5nID0gY29udGV4dC5TdHJpbmcsDQogICAgICAgIFR5cGVFcnJvciA9IGNvbnRleHQuVHlwZUVycm9yOw0KDQogICAgLyoqIFVzZWQgZm9yIG5hdGl2ZSBtZXRob2QgcmVmZXJlbmNlcy4gKi8NCiAgICB2YXIgYXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwNCiAgICAgICAgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlLA0KICAgICAgICBzdHJpbmdQcm90byA9IFN0cmluZy5wcm90b3R5cGU7DQoNCiAgICAvKiogVXNlZCB0byBkZXRlY3QgRE9NIHN1cHBvcnQuICovDQogICAgdmFyIGRvY3VtZW50ID0gKGRvY3VtZW50ID0gY29udGV4dC53aW5kb3cpID8gZG9jdW1lbnQuZG9jdW1lbnQgOiBudWxsOw0KDQogICAgLyoqIFVzZWQgdG8gcmVzb2x2ZSB0aGUgZGVjb21waWxlZCBzb3VyY2Ugb2YgZnVuY3Rpb25zLiAqLw0KICAgIHZhciBmblRvU3RyaW5nID0gRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nOw0KDQogICAgLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovDQogICAgdmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7DQoNCiAgICAvKiogVXNlZCB0byBnZW5lcmF0ZSB1bmlxdWUgSURzLiAqLw0KICAgIHZhciBpZENvdW50ZXIgPSAwOw0KDQogICAgLyoqDQogICAgICogVXNlZCB0byByZXNvbHZlIHRoZSBbYHRvU3RyaW5nVGFnYF0oaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcpDQogICAgICogb2YgdmFsdWVzLg0KICAgICAqLw0KICAgIHZhciBvYmpUb1N0cmluZyA9IG9iamVjdFByb3RvLnRvU3RyaW5nOw0KDQogICAgLyoqIFVzZWQgdG8gcmVzdG9yZSB0aGUgb3JpZ2luYWwgYF9gIHJlZmVyZW5jZSBpbiBgXy5ub0NvbmZsaWN0YC4gKi8NCiAgICB2YXIgb2xkRGFzaCA9IGNvbnRleHQuXzsNCg0KICAgIC8qKiBVc2VkIHRvIGRldGVjdCBpZiBhIG1ldGhvZCBpcyBuYXRpdmUuICovDQogICAgdmFyIHJlSXNOYXRpdmUgPSBSZWdFeHAoJ14nICsNCiAgICAgIGVzY2FwZVJlZ0V4cChmblRvU3RyaW5nLmNhbGwoaGFzT3duUHJvcGVydHkpKQ0KICAgICAgLnJlcGxhY2UoL2hhc093blByb3BlcnR5fChmdW5jdGlvbikuKj8oPz1cXFwoKXwgZm9yIC4rPyg/PVxcXF0pL2csICckMS4qPycpICsgJyQnDQogICAgKTsNCg0KICAgIC8qKiBOYXRpdmUgbWV0aG9kIHJlZmVyZW5jZXMuICovDQogICAgdmFyIEFycmF5QnVmZmVyID0gZ2V0TmF0aXZlKGNvbnRleHQsICdBcnJheUJ1ZmZlcicpLA0KICAgICAgICBidWZmZXJTbGljZSA9IGdldE5hdGl2ZShBcnJheUJ1ZmZlciAmJiBuZXcgQXJyYXlCdWZmZXIoMCksICdzbGljZScpLA0KICAgICAgICBjZWlsID0gTWF0aC5jZWlsLA0KICAgICAgICBjbGVhclRpbWVvdXQgPSBjb250ZXh0LmNsZWFyVGltZW91dCwNCiAgICAgICAgZmxvb3IgPSBNYXRoLmZsb29yLA0KICAgICAgICBnZXRQcm90b3R5cGVPZiA9IGdldE5hdGl2ZShPYmplY3QsICdnZXRQcm90b3R5cGVPZicpLA0KICAgICAgICBwYXJzZUZsb2F0ID0gY29udGV4dC5wYXJzZUZsb2F0LA0KICAgICAgICBwdXNoID0gYXJyYXlQcm90by5wdXNoLA0KICAgICAgICBTZXQgPSBnZXROYXRpdmUoY29udGV4dCwgJ1NldCcpLA0KICAgICAgICBzZXRUaW1lb3V0ID0gY29udGV4dC5zZXRUaW1lb3V0LA0KICAgICAgICBzcGxpY2UgPSBhcnJheVByb3RvLnNwbGljZSwNCiAgICAgICAgVWludDhBcnJheSA9IGdldE5hdGl2ZShjb250ZXh0LCAnVWludDhBcnJheScpLA0KICAgICAgICBXZWFrTWFwID0gZ2V0TmF0aXZlKGNvbnRleHQsICdXZWFrTWFwJyk7DQoNCiAgICAvKiogVXNlZCB0byBjbG9uZSBhcnJheSBidWZmZXJzLiAqLw0KICAgIHZhciBGbG9hdDY0QXJyYXkgPSAoZnVuY3Rpb24oKSB7DQogICAgICAvLyBTYWZhcmkgNSBlcnJvcnMgd2hlbiB1c2luZyBhbiBhcnJheSBidWZmZXIgdG8gaW5pdGlhbGl6ZSBhIHR5cGVkIGFycmF5DQogICAgICAvLyB3aGVyZSB0aGUgYXJyYXkgYnVmZmVyJ3MgYGJ5dGVMZW5ndGhgIGlzIG5vdCBhIG11bHRpcGxlIG9mIHRoZSB0eXBlZA0KICAgICAgLy8gYXJyYXkncyBgQllURVNfUEVSX0VMRU1FTlRgLg0KICAgICAgdHJ5IHsNCiAgICAgICAgdmFyIGZ1bmMgPSBnZXROYXRpdmUoY29udGV4dCwgJ0Zsb2F0NjRBcnJheScpLA0KICAgICAgICAgICAgcmVzdWx0ID0gbmV3IGZ1bmMobmV3IEFycmF5QnVmZmVyKDEwKSwgMCwgMSkgJiYgZnVuYzsNCiAgICAgIH0gY2F0Y2goZSkge30NCiAgICAgIHJldHVybiByZXN1bHQgfHwgbnVsbDsNCiAgICB9KCkpOw0KDQogICAgLyogTmF0aXZlIG1ldGhvZCByZWZlcmVuY2VzIGZvciB0aG9zZSB3aXRoIHRoZSBzYW1lIG5hbWUgYXMgb3RoZXIgYGxvZGFzaGAgbWV0aG9kcy4gKi8NCiAgICB2YXIgbmF0aXZlQ3JlYXRlID0gZ2V0TmF0aXZlKE9iamVjdCwgJ2NyZWF0ZScpLA0KICAgICAgICBuYXRpdmVJc0FycmF5ID0gZ2V0TmF0aXZlKEFycmF5LCAnaXNBcnJheScpLA0KICAgICAgICBuYXRpdmVJc0Zpbml0ZSA9IGNvbnRleHQuaXNGaW5pdGUsDQogICAgICAgIG5hdGl2ZUtleXMgPSBnZXROYXRpdmUoT2JqZWN0LCAna2V5cycpLA0KICAgICAgICBuYXRpdmVNYXggPSBNYXRoLm1heCwNCiAgICAgICAgbmF0aXZlTWluID0gTWF0aC5taW4sDQogICAgICAgIG5hdGl2ZU5vdyA9IGdldE5hdGl2ZShEYXRlLCAnbm93JyksDQogICAgICAgIG5hdGl2ZU51bUlzRmluaXRlID0gZ2V0TmF0aXZlKE51bWJlciwgJ2lzRmluaXRlJyksDQogICAgICAgIG5hdGl2ZVBhcnNlSW50ID0gY29udGV4dC5wYXJzZUludCwNCiAgICAgICAgbmF0aXZlUmFuZG9tID0gTWF0aC5yYW5kb207DQoNCiAgICAvKiogVXNlZCBhcyByZWZlcmVuY2VzIGZvciBgLUluZmluaXR5YCBhbmQgYEluZmluaXR5YC4gKi8NCiAgICB2YXIgTkVHQVRJVkVfSU5GSU5JVFkgPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksDQogICAgICAgIFBPU0lUSVZFX0lORklOSVRZID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZOw0KDQogICAgLyoqIFVzZWQgYXMgcmVmZXJlbmNlcyBmb3IgdGhlIG1heGltdW0gbGVuZ3RoIGFuZCBpbmRleCBvZiBhbiBhcnJheS4gKi8NCiAgICB2YXIgTUFYX0FSUkFZX0xFTkdUSCA9IDQyOTQ5NjcyOTUsDQogICAgICAgIE1BWF9BUlJBWV9JTkRFWCA9IE1BWF9BUlJBWV9MRU5HVEggLSAxLA0KICAgICAgICBIQUxGX01BWF9BUlJBWV9MRU5HVEggPSBNQVhfQVJSQVlfTEVOR1RIID4+PiAxOw0KDQogICAgLyoqIFVzZWQgYXMgdGhlIHNpemUsIGluIGJ5dGVzLCBvZiBlYWNoIGBGbG9hdDY0QXJyYXlgIGVsZW1lbnQuICovDQogICAgdmFyIEZMT0FUNjRfQllURVNfUEVSX0VMRU1FTlQgPSBGbG9hdDY0QXJyYXkgPyBGbG9hdDY0QXJyYXkuQllURVNfUEVSX0VMRU1FTlQgOiAwOw0KDQogICAgLyoqDQogICAgICogVXNlZCBhcyB0aGUgW21heGltdW0gbGVuZ3RoXShodHRwczovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtbnVtYmVyLm1heF9zYWZlX2ludGVnZXIpDQogICAgICogb2YgYW4gYXJyYXktbGlrZSB2YWx1ZS4NCiAgICAgKi8NCiAgICB2YXIgTUFYX1NBRkVfSU5URUdFUiA9IDkwMDcxOTkyNTQ3NDA5OTE7DQoNCiAgICAvKiogVXNlZCB0byBzdG9yZSBmdW5jdGlvbiBtZXRhZGF0YS4gKi8NCiAgICB2YXIgbWV0YU1hcCA9IFdlYWtNYXAgJiYgbmV3IFdlYWtNYXA7DQoNCiAgICAvKiogVXNlZCB0byBsb29rdXAgdW5taW5pZmllZCBmdW5jdGlvbiBuYW1lcy4gKi8NCiAgICB2YXIgcmVhbE5hbWVzID0ge307DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgYGxvZGFzaGAgb2JqZWN0IHdoaWNoIHdyYXBzIGB2YWx1ZWAgdG8gZW5hYmxlIGltcGxpY2l0IGNoYWluaW5nLg0KICAgICAqIE1ldGhvZHMgdGhhdCBvcGVyYXRlIG9uIGFuZCByZXR1cm4gYXJyYXlzLCBjb2xsZWN0aW9ucywgYW5kIGZ1bmN0aW9ucyBjYW4NCiAgICAgKiBiZSBjaGFpbmVkIHRvZ2V0aGVyLiBNZXRob2RzIHRoYXQgcmV0dXJuIGEgYm9vbGVhbiBvciBzaW5nbGUgdmFsdWUgd2lsbA0KICAgICAqIGF1dG9tYXRpY2FsbHkgZW5kIHRoZSBjaGFpbiByZXR1cm5pbmcgdGhlIHVud3JhcHBlZCB2YWx1ZS4gRXhwbGljaXQgY2hhaW5pbmcNCiAgICAgKiBtYXkgYmUgZW5hYmxlZCB1c2luZyBgXy5jaGFpbmAuIFRoZSBleGVjdXRpb24gb2YgY2hhaW5lZCBtZXRob2RzIGlzIGxhenksDQogICAgICogdGhhdCBpcywgZXhlY3V0aW9uIGlzIGRlZmVycmVkIHVudGlsIGBfI3ZhbHVlYCBpcyBpbXBsaWNpdGx5IG9yIGV4cGxpY2l0bHkNCiAgICAgKiBjYWxsZWQuDQogICAgICoNCiAgICAgKiBMYXp5IGV2YWx1YXRpb24gYWxsb3dzIHNldmVyYWwgbWV0aG9kcyB0byBzdXBwb3J0IHNob3J0Y3V0IGZ1c2lvbi4gU2hvcnRjdXQNCiAgICAgKiBmdXNpb24gaXMgYW4gb3B0aW1pemF0aW9uIHRoYXQgbWVyZ2VzIGl0ZXJhdGVlcyB0byBhdm9pZCBjcmVhdGluZyBpbnRlcm1lZGlhdGUNCiAgICAgKiBhcnJheXMgYW5kIHJlZHVjZSB0aGUgbnVtYmVyIG9mIGl0ZXJhdGVlIGV4ZWN1dGlvbnMuDQogICAgICoNCiAgICAgKiBDaGFpbmluZyBpcyBzdXBwb3J0ZWQgaW4gY3VzdG9tIGJ1aWxkcyBhcyBsb25nIGFzIHRoZSBgXyN2YWx1ZWAgbWV0aG9kIGlzDQogICAgICogZGlyZWN0bHkgb3IgaW5kaXJlY3RseSBpbmNsdWRlZCBpbiB0aGUgYnVpbGQuDQogICAgICoNCiAgICAgKiBJbiBhZGRpdGlvbiB0byBsb2Rhc2ggbWV0aG9kcywgd3JhcHBlcnMgaGF2ZSBgQXJyYXlgIGFuZCBgU3RyaW5nYCBtZXRob2RzLg0KICAgICAqDQogICAgICogVGhlIHdyYXBwZXIgYEFycmF5YCBtZXRob2RzIGFyZToNCiAgICAgKiBgY29uY2F0YCwgYGpvaW5gLCBgcG9wYCwgYHB1c2hgLCBgcmV2ZXJzZWAsIGBzaGlmdGAsIGBzbGljZWAsIGBzb3J0YCwNCiAgICAgKiBgc3BsaWNlYCwgYW5kIGB1bnNoaWZ0YA0KICAgICAqDQogICAgICogVGhlIHdyYXBwZXIgYFN0cmluZ2AgbWV0aG9kcyBhcmU6DQogICAgICogYHJlcGxhY2VgIGFuZCBgc3BsaXRgDQogICAgICoNCiAgICAgKiBUaGUgd3JhcHBlciBtZXRob2RzIHRoYXQgc3VwcG9ydCBzaG9ydGN1dCBmdXNpb24gYXJlOg0KICAgICAqIGBjb21wYWN0YCwgYGRyb3BgLCBgZHJvcFJpZ2h0YCwgYGRyb3BSaWdodFdoaWxlYCwgYGRyb3BXaGlsZWAsIGBmaWx0ZXJgLA0KICAgICAqIGBmaXJzdGAsIGBpbml0aWFsYCwgYGxhc3RgLCBgbWFwYCwgYHBsdWNrYCwgYHJlamVjdGAsIGByZXN0YCwgYHJldmVyc2VgLA0KICAgICAqIGBzbGljZWAsIGB0YWtlYCwgYHRha2VSaWdodGAsIGB0YWtlUmlnaHRXaGlsZWAsIGB0YWtlV2hpbGVgLCBgdG9BcnJheWAsDQogICAgICogYW5kIGB3aGVyZWANCiAgICAgKg0KICAgICAqIFRoZSBjaGFpbmFibGUgd3JhcHBlciBtZXRob2RzIGFyZToNCiAgICAgKiBgYWZ0ZXJgLCBgYXJ5YCwgYGFzc2lnbmAsIGBhdGAsIGBiZWZvcmVgLCBgYmluZGAsIGBiaW5kQWxsYCwgYGJpbmRLZXlgLA0KICAgICAqIGBjYWxsYmFja2AsIGBjaGFpbmAsIGBjaHVua2AsIGBjb21taXRgLCBgY29tcGFjdGAsIGBjb25jYXRgLCBgY29uc3RhbnRgLA0KICAgICAqIGBjb3VudEJ5YCwgYGNyZWF0ZWAsIGBjdXJyeWAsIGBkZWJvdW5jZWAsIGBkZWZhdWx0c2AsIGBkZWZlcmAsIGBkZWxheWAsDQogICAgICogYGRpZmZlcmVuY2VgLCBgZHJvcGAsIGBkcm9wUmlnaHRgLCBgZHJvcFJpZ2h0V2hpbGVgLCBgZHJvcFdoaWxlYCwgYGZpbGxgLA0KICAgICAqIGBmaWx0ZXJgLCBgZmxhdHRlbmAsIGBmbGF0dGVuRGVlcGAsIGBmbG93YCwgYGZsb3dSaWdodGAsIGBmb3JFYWNoYCwNCiAgICAgKiBgZm9yRWFjaFJpZ2h0YCwgYGZvckluYCwgYGZvckluUmlnaHRgLCBgZm9yT3duYCwgYGZvck93blJpZ2h0YCwgYGZ1bmN0aW9uc2AsDQogICAgICogYGdyb3VwQnlgLCBgaW5kZXhCeWAsIGBpbml0aWFsYCwgYGludGVyc2VjdGlvbmAsIGBpbnZlcnRgLCBgaW52b2tlYCwgYGtleXNgLA0KICAgICAqIGBrZXlzSW5gLCBgbWFwYCwgYG1hcEtleXNgLCBgbWFwVmFsdWVzYCwgYG1hdGNoZXNgLCBgbWF0Y2hlc1Byb3BlcnR5YCwNCiAgICAgKiBgbWVtb2l6ZWAsIGBtZXJnZWAsIGBtZXRob2RgLCBgbWV0aG9kT2ZgLCBgbWl4aW5gLCBgbmVnYXRlYCwgYG9taXRgLCBgb25jZWAsDQogICAgICogYHBhaXJzYCwgYHBhcnRpYWxgLCBgcGFydGlhbFJpZ2h0YCwgYHBhcnRpdGlvbmAsIGBwaWNrYCwgYHBsYW50YCwgYHBsdWNrYCwNCiAgICAgKiBgcHJvcGVydHlgLCBgcHJvcGVydHlPZmAsIGBwdWxsYCwgYHB1bGxBdGAsIGBwdXNoYCwgYHJhbmdlYCwgYHJlYXJnYCwNCiAgICAgKiBgcmVqZWN0YCwgYHJlbW92ZWAsIGByZXN0YCwgYHJlc3RQYXJhbWAsIGByZXZlcnNlYCwgYHNldGAsIGBzaHVmZmxlYCwNCiAgICAgKiBgc2xpY2VgLCBgc29ydGAsIGBzb3J0QnlgLCBgc29ydEJ5QWxsYCwgYHNvcnRCeU9yZGVyYCwgYHNwbGljZWAsIGBzcHJlYWRgLA0KICAgICAqIGB0YWtlYCwgYHRha2VSaWdodGAsIGB0YWtlUmlnaHRXaGlsZWAsIGB0YWtlV2hpbGVgLCBgdGFwYCwgYHRocm90dGxlYCwNCiAgICAgKiBgdGhydWAsIGB0aW1lc2AsIGB0b0FycmF5YCwgYHRvUGxhaW5PYmplY3RgLCBgdHJhbnNmb3JtYCwgYHVuaW9uYCwgYHVuaXFgLA0KICAgICAqIGB1bnNoaWZ0YCwgYHVuemlwYCwgYHVuemlwV2l0aGAsIGB2YWx1ZXNgLCBgdmFsdWVzSW5gLCBgd2hlcmVgLCBgd2l0aG91dGAsDQogICAgICogYHdyYXBgLCBgeG9yYCwgYHppcGAsIGB6aXBPYmplY3RgLCBgemlwV2l0aGANCiAgICAgKg0KICAgICAqIFRoZSB3cmFwcGVyIG1ldGhvZHMgdGhhdCBhcmUgKipub3QqKiBjaGFpbmFibGUgYnkgZGVmYXVsdCBhcmU6DQogICAgICogYGFkZGAsIGBhdHRlbXB0YCwgYGNhbWVsQ2FzZWAsIGBjYXBpdGFsaXplYCwgYGNsb25lYCwgYGNsb25lRGVlcGAsIGBkZWJ1cnJgLA0KICAgICAqIGBlbmRzV2l0aGAsIGBlc2NhcGVgLCBgZXNjYXBlUmVnRXhwYCwgYGV2ZXJ5YCwgYGZpbmRgLCBgZmluZEluZGV4YCwgYGZpbmRLZXlgLA0KICAgICAqIGBmaW5kTGFzdGAsIGBmaW5kTGFzdEluZGV4YCwgYGZpbmRMYXN0S2V5YCwgYGZpbmRXaGVyZWAsIGBmaXJzdGAsIGBnZXRgLA0KICAgICAqIGBndGAsIGBndGVgLCBgaGFzYCwgYGlkZW50aXR5YCwgYGluY2x1ZGVzYCwgYGluZGV4T2ZgLCBgaW5SYW5nZWAsIGBpc0FyZ3VtZW50c2AsDQogICAgICogYGlzQXJyYXlgLCBgaXNCb29sZWFuYCwgYGlzRGF0ZWAsIGBpc0VsZW1lbnRgLCBgaXNFbXB0eWAsIGBpc0VxdWFsYCwgYGlzRXJyb3JgLA0KICAgICAqIGBpc0Zpbml0ZWAgYGlzRnVuY3Rpb25gLCBgaXNNYXRjaGAsIGBpc05hdGl2ZWAsIGBpc05hTmAsIGBpc051bGxgLCBgaXNOdW1iZXJgLA0KICAgICAqIGBpc09iamVjdGAsIGBpc1BsYWluT2JqZWN0YCwgYGlzUmVnRXhwYCwgYGlzU3RyaW5nYCwgYGlzVW5kZWZpbmVkYCwNCiAgICAgKiBgaXNUeXBlZEFycmF5YCwgYGpvaW5gLCBga2ViYWJDYXNlYCwgYGxhc3RgLCBgbGFzdEluZGV4T2ZgLCBgbHRgLCBgbHRlYCwNCiAgICAgKiBgbWF4YCwgYG1pbmAsIGBub0NvbmZsaWN0YCwgYG5vb3BgLCBgbm93YCwgYHBhZGAsIGBwYWRMZWZ0YCwgYHBhZFJpZ2h0YCwNCiAgICAgKiBgcGFyc2VJbnRgLCBgcG9wYCwgYHJhbmRvbWAsIGByZWR1Y2VgLCBgcmVkdWNlUmlnaHRgLCBgcmVwZWF0YCwgYHJlc3VsdGAsDQogICAgICogYHJ1bkluQ29udGV4dGAsIGBzaGlmdGAsIGBzaXplYCwgYHNuYWtlQ2FzZWAsIGBzb21lYCwgYHNvcnRlZEluZGV4YCwNCiAgICAgKiBgc29ydGVkTGFzdEluZGV4YCwgYHN0YXJ0Q2FzZWAsIGBzdGFydHNXaXRoYCwgYHN1bWAsIGB0ZW1wbGF0ZWAsIGB0cmltYCwNCiAgICAgKiBgdHJpbUxlZnRgLCBgdHJpbVJpZ2h0YCwgYHRydW5jYCwgYHVuZXNjYXBlYCwgYHVuaXF1ZUlkYCwgYHZhbHVlYCwgYW5kIGB3b3Jkc2ANCiAgICAgKg0KICAgICAqIFRoZSB3cmFwcGVyIG1ldGhvZCBgc2FtcGxlYCB3aWxsIHJldHVybiBhIHdyYXBwZWQgdmFsdWUgd2hlbiBgbmAgaXMgcHJvdmlkZWQsDQogICAgICogb3RoZXJ3aXNlIGFuIHVud3JhcHBlZCB2YWx1ZSBpcyByZXR1cm5lZC4NCiAgICAgKg0KICAgICAqIEBuYW1lIF8NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKiBAY2F0ZWdvcnkgQ2hhaW4NCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byB3cmFwIGluIGEgYGxvZGFzaGAgaW5zdGFuY2UuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IGBsb2Rhc2hgIHdyYXBwZXIgaW5zdGFuY2UuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciB3cmFwcGVkID0gXyhbMSwgMiwgM10pOw0KICAgICAqDQogICAgICogLy8gcmV0dXJucyBhbiB1bndyYXBwZWQgdmFsdWUNCiAgICAgKiB3cmFwcGVkLnJlZHVjZShmdW5jdGlvbih0b3RhbCwgbikgew0KICAgICAqICAgcmV0dXJuIHRvdGFsICsgbjsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiA2DQogICAgICoNCiAgICAgKiAvLyByZXR1cm5zIGEgd3JhcHBlZCB2YWx1ZQ0KICAgICAqIHZhciBzcXVhcmVzID0gd3JhcHBlZC5tYXAoZnVuY3Rpb24obikgew0KICAgICAqICAgcmV0dXJuIG4gKiBuOw0KICAgICAqIH0pOw0KICAgICAqDQogICAgICogXy5pc0FycmF5KHNxdWFyZXMpOw0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICoNCiAgICAgKiBfLmlzQXJyYXkoc3F1YXJlcy52YWx1ZSgpKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICovDQogICAgZnVuY3Rpb24gbG9kYXNoKHZhbHVlKSB7DQogICAgICBpZiAoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiAhaXNBcnJheSh2YWx1ZSkgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIExhenlXcmFwcGVyKSkgew0KICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBMb2Rhc2hXcmFwcGVyKSB7DQogICAgICAgICAgcmV0dXJuIHZhbHVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCAnX19jaGFpbl9fJykgJiYgaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgJ19fd3JhcHBlZF9fJykpIHsNCiAgICAgICAgICByZXR1cm4gd3JhcHBlckNsb25lKHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIG5ldyBMb2Rhc2hXcmFwcGVyKHZhbHVlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgZnVuY3Rpb24gd2hvc2UgcHJvdG90eXBlIGFsbCBjaGFpbmluZyB3cmFwcGVycyBpbmhlcml0IGZyb20uDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VMb2Rhc2goKSB7DQogICAgICAvLyBObyBvcGVyYXRpb24gcGVyZm9ybWVkLg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGNvbnN0cnVjdG9yIGZvciBjcmVhdGluZyBgbG9kYXNoYCB3cmFwcGVyIG9iamVjdHMuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHdyYXAuDQogICAgICogQHBhcmFtIHtib29sZWFufSBbY2hhaW5BbGxdIEVuYWJsZSBjaGFpbmluZyBmb3IgYWxsIHdyYXBwZXIgbWV0aG9kcy4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbYWN0aW9ucz1bXV0gQWN0aW9ucyB0byBwZWZvcm0gdG8gcmVzb2x2ZSB0aGUgdW53cmFwcGVkIHZhbHVlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIExvZGFzaFdyYXBwZXIodmFsdWUsIGNoYWluQWxsLCBhY3Rpb25zKSB7DQogICAgICB0aGlzLl9fd3JhcHBlZF9fID0gdmFsdWU7DQogICAgICB0aGlzLl9fYWN0aW9uc19fID0gYWN0aW9ucyB8fCBbXTsNCiAgICAgIHRoaXMuX19jaGFpbl9fID0gISFjaGFpbkFsbDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBbiBvYmplY3QgZW52aXJvbm1lbnQgZmVhdHVyZSBmbGFncy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEB0eXBlIE9iamVjdA0KICAgICAqLw0KICAgIHZhciBzdXBwb3J0ID0gbG9kYXNoLnN1cHBvcnQgPSB7fTsNCg0KICAgIChmdW5jdGlvbih4KSB7DQogICAgICB2YXIgQ3RvciA9IGZ1bmN0aW9uKCkgeyB0aGlzLnggPSB4OyB9LA0KICAgICAgICAgIG9iamVjdCA9IHsgJzAnOiB4LCAnbGVuZ3RoJzogeCB9LA0KICAgICAgICAgIHByb3BzID0gW107DQoNCiAgICAgIEN0b3IucHJvdG90eXBlID0geyAndmFsdWVPZic6IHgsICd5JzogeCB9Ow0KICAgICAgZm9yICh2YXIga2V5IGluIG5ldyBDdG9yKSB7IHByb3BzLnB1c2goa2V5KTsgfQ0KDQogICAgICAvKioNCiAgICAgICAqIERldGVjdCBpZiB0aGUgRE9NIGlzIHN1cHBvcnRlZC4NCiAgICAgICAqDQogICAgICAgKiBAbWVtYmVyT2YgXy5zdXBwb3J0DQogICAgICAgKiBAdHlwZSBib29sZWFuDQogICAgICAgKi8NCiAgICAgIHRyeSB7DQogICAgICAgIHN1cHBvcnQuZG9tID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLm5vZGVUeXBlID09PSAxMTsNCiAgICAgIH0gY2F0Y2goZSkgew0KICAgICAgICBzdXBwb3J0LmRvbSA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0oMSwgMCkpOw0KDQogICAgLyoqDQogICAgICogQnkgZGVmYXVsdCwgdGhlIHRlbXBsYXRlIGRlbGltaXRlcnMgdXNlZCBieSBsb2Rhc2ggYXJlIGxpa2UgdGhvc2UgaW4NCiAgICAgKiBlbWJlZGRlZCBSdWJ5IChFUkIpLiBDaGFuZ2UgdGhlIGZvbGxvd2luZyB0ZW1wbGF0ZSBzZXR0aW5ncyB0byB1c2UNCiAgICAgKiBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQHR5cGUgT2JqZWN0DQogICAgICovDQogICAgbG9kYXNoLnRlbXBsYXRlU2V0dGluZ3MgPSB7DQoNCiAgICAgIC8qKg0KICAgICAgICogVXNlZCB0byBkZXRlY3QgYGRhdGFgIHByb3BlcnR5IHZhbHVlcyB0byBiZSBIVE1MLWVzY2FwZWQuDQogICAgICAgKg0KICAgICAgICogQG1lbWJlck9mIF8udGVtcGxhdGVTZXR0aW5ncw0KICAgICAgICogQHR5cGUgUmVnRXhwDQogICAgICAgKi8NCiAgICAgICdlc2NhcGUnOiByZUVzY2FwZSwNCg0KICAgICAgLyoqDQogICAgICAgKiBVc2VkIHRvIGRldGVjdCBjb2RlIHRvIGJlIGV2YWx1YXRlZC4NCiAgICAgICAqDQogICAgICAgKiBAbWVtYmVyT2YgXy50ZW1wbGF0ZVNldHRpbmdzDQogICAgICAgKiBAdHlwZSBSZWdFeHANCiAgICAgICAqLw0KICAgICAgJ2V2YWx1YXRlJzogcmVFdmFsdWF0ZSwNCg0KICAgICAgLyoqDQogICAgICAgKiBVc2VkIHRvIGRldGVjdCBgZGF0YWAgcHJvcGVydHkgdmFsdWVzIHRvIGluamVjdC4NCiAgICAgICAqDQogICAgICAgKiBAbWVtYmVyT2YgXy50ZW1wbGF0ZVNldHRpbmdzDQogICAgICAgKiBAdHlwZSBSZWdFeHANCiAgICAgICAqLw0KICAgICAgJ2ludGVycG9sYXRlJzogcmVJbnRlcnBvbGF0ZSwNCg0KICAgICAgLyoqDQogICAgICAgKiBVc2VkIHRvIHJlZmVyZW5jZSB0aGUgZGF0YSBvYmplY3QgaW4gdGhlIHRlbXBsYXRlIHRleHQuDQogICAgICAgKg0KICAgICAgICogQG1lbWJlck9mIF8udGVtcGxhdGVTZXR0aW5ncw0KICAgICAgICogQHR5cGUgc3RyaW5nDQogICAgICAgKi8NCiAgICAgICd2YXJpYWJsZSc6ICcnLA0KDQogICAgICAvKioNCiAgICAgICAqIFVzZWQgdG8gaW1wb3J0IHZhcmlhYmxlcyBpbnRvIHRoZSBjb21waWxlZCB0ZW1wbGF0ZS4NCiAgICAgICAqDQogICAgICAgKiBAbWVtYmVyT2YgXy50ZW1wbGF0ZVNldHRpbmdzDQogICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAqLw0KICAgICAgJ2ltcG9ydHMnOiB7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEEgcmVmZXJlbmNlIHRvIHRoZSBgbG9kYXNoYCBmdW5jdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlck9mIF8udGVtcGxhdGVTZXR0aW5ncy5pbXBvcnRzDQogICAgICAgICAqIEB0eXBlIEZ1bmN0aW9uDQogICAgICAgICAqLw0KICAgICAgICAnXyc6IGxvZGFzaA0KICAgICAgfQ0KICAgIH07DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgbGF6eSB3cmFwcGVyIG9iamVjdCB3aGljaCB3cmFwcyBgdmFsdWVgIHRvIGVuYWJsZSBsYXp5IGV2YWx1YXRpb24uDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHdyYXAuDQogICAgICovDQogICAgZnVuY3Rpb24gTGF6eVdyYXBwZXIodmFsdWUpIHsNCiAgICAgIHRoaXMuX193cmFwcGVkX18gPSB2YWx1ZTsNCiAgICAgIHRoaXMuX19hY3Rpb25zX18gPSBudWxsOw0KICAgICAgdGhpcy5fX2Rpcl9fID0gMTsNCiAgICAgIHRoaXMuX19kcm9wQ291bnRfXyA9IDA7DQogICAgICB0aGlzLl9fZmlsdGVyZWRfXyA9IGZhbHNlOw0KICAgICAgdGhpcy5fX2l0ZXJhdGVlc19fID0gbnVsbDsNCiAgICAgIHRoaXMuX190YWtlQ291bnRfXyA9IFBPU0lUSVZFX0lORklOSVRZOw0KICAgICAgdGhpcy5fX3ZpZXdzX18gPSBudWxsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBjbG9uZSBvZiB0aGUgbGF6eSB3cmFwcGVyIG9iamVjdC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQG5hbWUgY2xvbmUNCiAgICAgKiBAbWVtYmVyT2YgTGF6eVdyYXBwZXINCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgYExhenlXcmFwcGVyYCBvYmplY3QuDQogICAgICovDQogICAgZnVuY3Rpb24gbGF6eUNsb25lKCkgew0KICAgICAgdmFyIGFjdGlvbnMgPSB0aGlzLl9fYWN0aW9uc19fLA0KICAgICAgICAgIGl0ZXJhdGVlcyA9IHRoaXMuX19pdGVyYXRlZXNfXywNCiAgICAgICAgICB2aWV3cyA9IHRoaXMuX192aWV3c19fLA0KICAgICAgICAgIHJlc3VsdCA9IG5ldyBMYXp5V3JhcHBlcih0aGlzLl9fd3JhcHBlZF9fKTsNCg0KICAgICAgcmVzdWx0Ll9fYWN0aW9uc19fID0gYWN0aW9ucyA/IGFycmF5Q29weShhY3Rpb25zKSA6IG51bGw7DQogICAgICByZXN1bHQuX19kaXJfXyA9IHRoaXMuX19kaXJfXzsNCiAgICAgIHJlc3VsdC5fX2ZpbHRlcmVkX18gPSB0aGlzLl9fZmlsdGVyZWRfXzsNCiAgICAgIHJlc3VsdC5fX2l0ZXJhdGVlc19fID0gaXRlcmF0ZWVzID8gYXJyYXlDb3B5KGl0ZXJhdGVlcykgOiBudWxsOw0KICAgICAgcmVzdWx0Ll9fdGFrZUNvdW50X18gPSB0aGlzLl9fdGFrZUNvdW50X187DQogICAgICByZXN1bHQuX192aWV3c19fID0gdmlld3MgPyBhcnJheUNvcHkodmlld3MpIDogbnVsbDsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV2ZXJzZXMgdGhlIGRpcmVjdGlvbiBvZiBsYXp5IGl0ZXJhdGlvbi4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQG5hbWUgcmV2ZXJzZQ0KICAgICAqIEBtZW1iZXJPZiBMYXp5V3JhcHBlcg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyByZXZlcnNlZCBgTGF6eVdyYXBwZXJgIG9iamVjdC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBsYXp5UmV2ZXJzZSgpIHsNCiAgICAgIGlmICh0aGlzLl9fZmlsdGVyZWRfXykgew0KICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IExhenlXcmFwcGVyKHRoaXMpOw0KICAgICAgICByZXN1bHQuX19kaXJfXyA9IC0xOw0KICAgICAgICByZXN1bHQuX19maWx0ZXJlZF9fID0gdHJ1ZTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJlc3VsdCA9IHRoaXMuY2xvbmUoKTsNCiAgICAgICAgcmVzdWx0Ll9fZGlyX18gKj0gLTE7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEV4dHJhY3RzIHRoZSB1bndyYXBwZWQgdmFsdWUgZnJvbSBpdHMgbGF6eSB3cmFwcGVyLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAbmFtZSB2YWx1ZQ0KICAgICAqIEBtZW1iZXJPZiBMYXp5V3JhcHBlcg0KICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSB1bndyYXBwZWQgdmFsdWUuDQogICAgICovDQogICAgZnVuY3Rpb24gbGF6eVZhbHVlKCkgew0KICAgICAgdmFyIGFycmF5ID0gdGhpcy5fX3dyYXBwZWRfXy52YWx1ZSgpOw0KICAgICAgaWYgKCFpc0FycmF5KGFycmF5KSkgew0KICAgICAgICByZXR1cm4gYmFzZVdyYXBwZXJWYWx1ZShhcnJheSwgdGhpcy5fX2FjdGlvbnNfXyk7DQogICAgICB9DQogICAgICB2YXIgZGlyID0gdGhpcy5fX2Rpcl9fLA0KICAgICAgICAgIGlzUmlnaHQgPSBkaXIgPCAwLA0KICAgICAgICAgIHZpZXcgPSBnZXRWaWV3KDAsIGFycmF5Lmxlbmd0aCwgdGhpcy5fX3ZpZXdzX18pLA0KICAgICAgICAgIHN0YXJ0ID0gdmlldy5zdGFydCwNCiAgICAgICAgICBlbmQgPSB2aWV3LmVuZCwNCiAgICAgICAgICBsZW5ndGggPSBlbmQgLSBzdGFydCwNCiAgICAgICAgICBpbmRleCA9IGlzUmlnaHQgPyBlbmQgOiAoc3RhcnQgLSAxKSwNCiAgICAgICAgICB0YWtlQ291bnQgPSBuYXRpdmVNaW4obGVuZ3RoLCB0aGlzLl9fdGFrZUNvdW50X18pLA0KICAgICAgICAgIGl0ZXJhdGVlcyA9IHRoaXMuX19pdGVyYXRlZXNfXywNCiAgICAgICAgICBpdGVyTGVuZ3RoID0gaXRlcmF0ZWVzID8gaXRlcmF0ZWVzLmxlbmd0aCA6IDAsDQogICAgICAgICAgcmVzSW5kZXggPSAwLA0KICAgICAgICAgIHJlc3VsdCA9IFtdOw0KDQogICAgICBvdXRlcjoNCiAgICAgIHdoaWxlIChsZW5ndGgtLSAmJiByZXNJbmRleCA8IHRha2VDb3VudCkgew0KICAgICAgICBpbmRleCArPSBkaXI7DQoNCiAgICAgICAgdmFyIGl0ZXJJbmRleCA9IC0xLA0KICAgICAgICAgICAgdmFsdWUgPSBhcnJheVtpbmRleF07DQoNCiAgICAgICAgd2hpbGUgKCsraXRlckluZGV4IDwgaXRlckxlbmd0aCkgew0KICAgICAgICAgIHZhciBkYXRhID0gaXRlcmF0ZWVzW2l0ZXJJbmRleF0sDQogICAgICAgICAgICAgIGl0ZXJhdGVlID0gZGF0YS5pdGVyYXRlZSwNCiAgICAgICAgICAgICAgdHlwZSA9IGRhdGEudHlwZTsNCg0KICAgICAgICAgIGlmICh0eXBlID09IExBWllfRFJPUF9XSElMRV9GTEFHKSB7DQogICAgICAgICAgICBpZiAoZGF0YS5kb25lICYmIChpc1JpZ2h0ID8gKGluZGV4ID4gZGF0YS5pbmRleCkgOiAoaW5kZXggPCBkYXRhLmluZGV4KSkpIHsNCiAgICAgICAgICAgICAgZGF0YS5jb3VudCA9IDA7DQogICAgICAgICAgICAgIGRhdGEuZG9uZSA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGF0YS5pbmRleCA9IGluZGV4Ow0KICAgICAgICAgICAgaWYgKCFkYXRhLmRvbmUpIHsNCiAgICAgICAgICAgICAgdmFyIGxpbWl0ID0gZGF0YS5saW1pdDsNCiAgICAgICAgICAgICAgaWYgKCEoZGF0YS5kb25lID0gbGltaXQgPiAtMSA/IChkYXRhLmNvdW50KysgPj0gbGltaXQpIDogIWl0ZXJhdGVlKHZhbHVlKSkpIHsNCiAgICAgICAgICAgICAgICBjb250aW51ZSBvdXRlcjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB2YXIgY29tcHV0ZWQgPSBpdGVyYXRlZSh2YWx1ZSk7DQogICAgICAgICAgICBpZiAodHlwZSA9PSBMQVpZX01BUF9GTEFHKSB7DQogICAgICAgICAgICAgIHZhbHVlID0gY29tcHV0ZWQ7DQogICAgICAgICAgICB9IGVsc2UgaWYgKCFjb21wdXRlZCkgew0KICAgICAgICAgICAgICBpZiAodHlwZSA9PSBMQVpZX0ZJTFRFUl9GTEFHKSB7DQogICAgICAgICAgICAgICAgY29udGludWUgb3V0ZXI7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmVzdWx0W3Jlc0luZGV4KytdID0gdmFsdWU7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBjYWNoZSBvYmplY3QgdG8gc3RvcmUga2V5L3ZhbHVlIHBhaXJzLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAc3RhdGljDQogICAgICogQG5hbWUgQ2FjaGUNCiAgICAgKiBAbWVtYmVyT2YgXy5tZW1vaXplDQogICAgICovDQogICAgZnVuY3Rpb24gTWFwQ2FjaGUoKSB7DQogICAgICB0aGlzLl9fZGF0YV9fID0ge307DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIGNhY2hlLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAbmFtZSBkZWxldGUNCiAgICAgKiBAbWVtYmVyT2YgXy5tZW1vaXplLkNhY2hlDQogICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byByZW1vdmUuDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBlbnRyeSB3YXMgcmVtb3ZlZCBzdWNjZXNzZnVsbHksIGVsc2UgYGZhbHNlYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBtYXBEZWxldGUoa2V5KSB7DQogICAgICByZXR1cm4gdGhpcy5oYXMoa2V5KSAmJiBkZWxldGUgdGhpcy5fX2RhdGFfX1trZXldOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldHMgdGhlIGNhY2hlZCB2YWx1ZSBmb3IgYGtleWAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBuYW1lIGdldA0KICAgICAqIEBtZW1iZXJPZiBfLm1lbW9pemUuQ2FjaGUNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgY2FjaGVkIHZhbHVlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG1hcEdldChrZXkpIHsNCiAgICAgIHJldHVybiBrZXkgPT0gJ19fcHJvdG9fXycgPyB1bmRlZmluZWQgOiB0aGlzLl9fZGF0YV9fW2tleV07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGEgY2FjaGVkIHZhbHVlIGZvciBga2V5YCBleGlzdHMuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBuYW1lIGhhcw0KICAgICAqIEBtZW1iZXJPZiBfLm1lbW9pemUuQ2FjaGUNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbiBlbnRyeSBmb3IgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuDQogICAgICovDQogICAgZnVuY3Rpb24gbWFwSGFzKGtleSkgew0KICAgICAgcmV0dXJuIGtleSAhPSAnX19wcm90b19fJyAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuX19kYXRhX18sIGtleSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2V0cyBgdmFsdWVgIHRvIGBrZXlgIG9mIHRoZSBjYWNoZS4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQG5hbWUgc2V0DQogICAgICogQG1lbWJlck9mIF8ubWVtb2l6ZS5DYWNoZQ0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gY2FjaGUuDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2FjaGUuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY2FjaGUgb2JqZWN0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG1hcFNldChrZXksIHZhbHVlKSB7DQogICAgICBpZiAoa2V5ICE9ICdfX3Byb3RvX18nKSB7DQogICAgICAgIHRoaXMuX19kYXRhX19ba2V5XSA9IHZhbHVlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQogICAgLyoqDQogICAgICoNCiAgICAgKiBDcmVhdGVzIGEgY2FjaGUgb2JqZWN0IHRvIHN0b3JlIHVuaXF1ZSB2YWx1ZXMuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFt2YWx1ZXNdIFRoZSB2YWx1ZXMgdG8gY2FjaGUuDQogICAgICovDQogICAgZnVuY3Rpb24gU2V0Q2FjaGUodmFsdWVzKSB7DQogICAgICB2YXIgbGVuZ3RoID0gdmFsdWVzID8gdmFsdWVzLmxlbmd0aCA6IDA7DQoNCiAgICAgIHRoaXMuZGF0YSA9IHsgJ2hhc2gnOiBuYXRpdmVDcmVhdGUobnVsbCksICdzZXQnOiBuZXcgU2V0IH07DQogICAgICB3aGlsZSAobGVuZ3RoLS0pIHsNCiAgICAgICAgdGhpcy5wdXNoKHZhbHVlc1tsZW5ndGhdKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBpbiBgY2FjaGVgIG1pbWlja2luZyB0aGUgcmV0dXJuIHNpZ25hdHVyZSBvZg0KICAgICAqIGBfLmluZGV4T2ZgIGJ5IHJldHVybmluZyBgMGAgaWYgdGhlIHZhbHVlIGlzIGZvdW5kLCBlbHNlIGAtMWAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjYWNoZSBUaGUgY2FjaGUgdG8gc2VhcmNoLg0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuDQogICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyBgMGAgaWYgYHZhbHVlYCBpcyBmb3VuZCwgZWxzZSBgLTFgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNhY2hlSW5kZXhPZihjYWNoZSwgdmFsdWUpIHsNCiAgICAgIHZhciBkYXRhID0gY2FjaGUuZGF0YSwNCiAgICAgICAgICByZXN1bHQgPSAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnIHx8IGlzT2JqZWN0KHZhbHVlKSkgPyBkYXRhLnNldC5oYXModmFsdWUpIDogZGF0YS5oYXNoW3ZhbHVlXTsNCg0KICAgICAgcmV0dXJuIHJlc3VsdCA/IDAgOiAtMTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBZGRzIGB2YWx1ZWAgdG8gdGhlIGNhY2hlLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAbmFtZSBwdXNoDQogICAgICogQG1lbWJlck9mIFNldENhY2hlDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2FjaGUuDQogICAgICovDQogICAgZnVuY3Rpb24gY2FjaGVQdXNoKHZhbHVlKSB7DQogICAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsNCiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHwgaXNPYmplY3QodmFsdWUpKSB7DQogICAgICAgIGRhdGEuc2V0LmFkZCh2YWx1ZSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkYXRhLmhhc2hbdmFsdWVdID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvKioNCiAgICAgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiBgc291cmNlYCB0byBgYXJyYXlgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBzb3VyY2UgVGhlIGFycmF5IHRvIGNvcHkgdmFsdWVzIGZyb20uDQogICAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5PVtdXSBUaGUgYXJyYXkgdG8gY29weSB2YWx1ZXMgdG8uDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuDQogICAgICovDQogICAgZnVuY3Rpb24gYXJyYXlDb3B5KHNvdXJjZSwgYXJyYXkpIHsNCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IHNvdXJjZS5sZW5ndGg7DQoNCiAgICAgIGFycmF5IHx8IChhcnJheSA9IEFycmF5KGxlbmd0aCkpOw0KICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgYXJyYXlbaW5kZXhdID0gc291cmNlW2luZGV4XTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBhcnJheTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uZm9yRWFjaGAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGNhbGxiYWNrDQogICAgICogc2hvcnRoYW5kcyBhbmQgYHRoaXNgIGJpbmRpbmcuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhcnJheUVhY2goYXJyYXksIGl0ZXJhdGVlKSB7DQogICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGg7DQoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIGlmIChpdGVyYXRlZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSkgPT09IGZhbHNlKSB7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiBhcnJheTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uZm9yRWFjaFJpZ2h0YCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3INCiAgICAgKiBjYWxsYmFjayBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGFycmF5RWFjaFJpZ2h0KGFycmF5LCBpdGVyYXRlZSkgew0KICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsNCg0KICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7DQogICAgICAgIGlmIChpdGVyYXRlZShhcnJheVtsZW5ndGhdLCBsZW5ndGgsIGFycmF5KSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIGFycmF5Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5ldmVyeWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGNhbGxiYWNrDQogICAgICogc2hvcnRoYW5kcyBhbmQgYHRoaXNgIGJpbmRpbmcuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFsbCBlbGVtZW50cyBwYXNzIHRoZSBwcmVkaWNhdGUgY2hlY2ssDQogICAgICogIGVsc2UgYGZhbHNlYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhcnJheUV2ZXJ5KGFycmF5LCBwcmVkaWNhdGUpIHsNCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsNCg0KICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgaWYgKCFwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSB7DQogICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VFeHRyZW11bWAgZm9yIGFycmF5cyB3aGljaCBpbnZva2VzIGBpdGVyYXRlZWANCiAgICAgKiB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNvbXBhcmF0b3IgVGhlIGZ1bmN0aW9uIHVzZWQgdG8gY29tcGFyZSB2YWx1ZXMuDQogICAgICogQHBhcmFtIHsqfSBleFZhbHVlIFRoZSBpbml0aWFsIGV4dHJlbXVtIHZhbHVlLg0KICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBleHRyZW11bSB2YWx1ZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhcnJheUV4dHJlbXVtKGFycmF5LCBpdGVyYXRlZSwgY29tcGFyYXRvciwgZXhWYWx1ZSkgew0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLA0KICAgICAgICAgIGNvbXB1dGVkID0gZXhWYWx1ZSwNCiAgICAgICAgICByZXN1bHQgPSBjb21wdXRlZDsNCg0KICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdLA0KICAgICAgICAgICAgY3VycmVudCA9ICtpdGVyYXRlZSh2YWx1ZSk7DQoNCiAgICAgICAgaWYgKGNvbXBhcmF0b3IoY3VycmVudCwgY29tcHV0ZWQpKSB7DQogICAgICAgICAgY29tcHV0ZWQgPSBjdXJyZW50Ow0KICAgICAgICAgIHJlc3VsdCA9IHZhbHVlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5maWx0ZXJgIGZvciBhcnJheXMgd2l0aG91dCBzdXBwb3J0IGZvciBjYWxsYmFjaw0KICAgICAqIHNob3J0aGFuZHMgYW5kIGB0aGlzYCBiaW5kaW5nLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZpbHRlcmVkIGFycmF5Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGFycmF5RmlsdGVyKGFycmF5LCBwcmVkaWNhdGUpIHsNCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwNCiAgICAgICAgICByZXNJbmRleCA9IC0xLA0KICAgICAgICAgIHJlc3VsdCA9IFtdOw0KDQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07DQogICAgICAgIGlmIChwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBhcnJheSkpIHsNCiAgICAgICAgICByZXN1bHRbKytyZXNJbmRleF0gPSB2YWx1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8ubWFwYCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3IgY2FsbGJhY2sNCiAgICAgKiBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IG1hcHBlZCBhcnJheS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhcnJheU1hcChhcnJheSwgaXRlcmF0ZWUpIHsNCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwNCiAgICAgICAgICByZXN1bHQgPSBBcnJheShsZW5ndGgpOw0KDQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8ucmVkdWNlYCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3IgY2FsbGJhY2sNCiAgICAgKiBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW2FjY3VtdWxhdG9yXSBUaGUgaW5pdGlhbCB2YWx1ZS4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpbml0RnJvbUFycmF5XSBTcGVjaWZ5IHVzaW5nIHRoZSBmaXJzdCBlbGVtZW50IG9mIGBhcnJheWANCiAgICAgKiAgYXMgdGhlIGluaXRpYWwgdmFsdWUuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGFjY3VtdWxhdGVkIHZhbHVlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGFycmF5UmVkdWNlKGFycmF5LCBpdGVyYXRlZSwgYWNjdW11bGF0b3IsIGluaXRGcm9tQXJyYXkpIHsNCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsNCg0KICAgICAgaWYgKGluaXRGcm9tQXJyYXkgJiYgbGVuZ3RoKSB7DQogICAgICAgIGFjY3VtdWxhdG9yID0gYXJyYXlbKytpbmRleF07DQogICAgICB9DQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICBhY2N1bXVsYXRvciA9IGl0ZXJhdGVlKGFjY3VtdWxhdG9yLCBhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSk7DQogICAgICB9DQogICAgICByZXR1cm4gYWNjdW11bGF0b3I7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLnJlZHVjZVJpZ2h0YCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3INCiAgICAgKiBjYWxsYmFjayBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW2FjY3VtdWxhdG9yXSBUaGUgaW5pdGlhbCB2YWx1ZS4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpbml0RnJvbUFycmF5XSBTcGVjaWZ5IHVzaW5nIHRoZSBsYXN0IGVsZW1lbnQgb2YgYGFycmF5YA0KICAgICAqICBhcyB0aGUgaW5pdGlhbCB2YWx1ZS4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgYWNjdW11bGF0ZWQgdmFsdWUuDQogICAgICovDQogICAgZnVuY3Rpb24gYXJyYXlSZWR1Y2VSaWdodChhcnJheSwgaXRlcmF0ZWUsIGFjY3VtdWxhdG9yLCBpbml0RnJvbUFycmF5KSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOw0KICAgICAgaWYgKGluaXRGcm9tQXJyYXkgJiYgbGVuZ3RoKSB7DQogICAgICAgIGFjY3VtdWxhdG9yID0gYXJyYXlbLS1sZW5ndGhdOw0KICAgICAgfQ0KICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7DQogICAgICAgIGFjY3VtdWxhdG9yID0gaXRlcmF0ZWUoYWNjdW11bGF0b3IsIGFycmF5W2xlbmd0aF0sIGxlbmd0aCwgYXJyYXkpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5zb21lYCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3IgY2FsbGJhY2sNCiAgICAgKiBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW55IGVsZW1lbnQgcGFzc2VzIHRoZSBwcmVkaWNhdGUgY2hlY2ssDQogICAgICogIGVsc2UgYGZhbHNlYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhcnJheVNvbWUoYXJyYXksIHByZWRpY2F0ZSkgew0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOw0KDQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICBpZiAocHJlZGljYXRlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSkgew0KICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLnN1bWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlcy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBzdW0uDQogICAgICovDQogICAgZnVuY3Rpb24gYXJyYXlTdW0oYXJyYXkpIHsNCiAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGgsDQogICAgICAgICAgcmVzdWx0ID0gMDsNCg0KICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7DQogICAgICAgIHJlc3VsdCArPSArYXJyYXlbbGVuZ3RoXSB8fCAwOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBVc2VkIGJ5IGBfLmRlZmF1bHRzYCB0byBjdXN0b21pemUgaXRzIGBfLmFzc2lnbmAgdXNlLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0geyp9IG9iamVjdFZhbHVlIFRoZSBkZXN0aW5hdGlvbiBvYmplY3QgcHJvcGVydHkgdmFsdWUuDQogICAgICogQHBhcmFtIHsqfSBzb3VyY2VWYWx1ZSBUaGUgc291cmNlIG9iamVjdCBwcm9wZXJ0eSB2YWx1ZS4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgdmFsdWUgdG8gYXNzaWduIHRvIHRoZSBkZXN0aW5hdGlvbiBvYmplY3QuDQogICAgICovDQogICAgZnVuY3Rpb24gYXNzaWduRGVmYXVsdHMob2JqZWN0VmFsdWUsIHNvdXJjZVZhbHVlKSB7DQogICAgICByZXR1cm4gb2JqZWN0VmFsdWUgPT09IHVuZGVmaW5lZCA/IHNvdXJjZVZhbHVlIDogb2JqZWN0VmFsdWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVXNlZCBieSBgXy50ZW1wbGF0ZWAgdG8gY3VzdG9taXplIGl0cyBgXy5hc3NpZ25gIHVzZS4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGlzIGZ1bmN0aW9uIGlzIGxpa2UgYGFzc2lnbkRlZmF1bHRzYCBleGNlcHQgdGhhdCBpdCBpZ25vcmVzDQogICAgICogaW5oZXJpdGVkIHByb3BlcnR5IHZhbHVlcyB3aGVuIGNoZWNraW5nIGlmIGEgcHJvcGVydHkgaXMgYHVuZGVmaW5lZGAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7Kn0gb2JqZWN0VmFsdWUgVGhlIGRlc3RpbmF0aW9uIG9iamVjdCBwcm9wZXJ0eSB2YWx1ZS4NCiAgICAgKiBAcGFyYW0geyp9IHNvdXJjZVZhbHVlIFRoZSBzb3VyY2Ugb2JqZWN0IHByb3BlcnR5IHZhbHVlLg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBhc3NvY2lhdGVkIHdpdGggdGhlIG9iamVjdCBhbmQgc291cmNlIHZhbHVlcy4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHZhbHVlIHRvIGFzc2lnbiB0byB0aGUgZGVzdGluYXRpb24gb2JqZWN0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGFzc2lnbk93bkRlZmF1bHRzKG9iamVjdFZhbHVlLCBzb3VyY2VWYWx1ZSwga2V5LCBvYmplY3QpIHsNCiAgICAgIHJldHVybiAob2JqZWN0VmFsdWUgPT09IHVuZGVmaW5lZCB8fCAhaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkpDQogICAgICAgID8gc291cmNlVmFsdWUNCiAgICAgICAgOiBvYmplY3RWYWx1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uYXNzaWduYCBmb3IgY3VzdG9taXppbmcgYXNzaWduZWQgdmFsdWVzIHdpdGhvdXQNCiAgICAgKiBzdXBwb3J0IGZvciBhcmd1bWVudCBqdWdnbGluZywgbXVsdGlwbGUgc291cmNlcywgYW5kIGB0aGlzYCBiaW5kaW5nIGBjdXN0b21pemVyYA0KICAgICAqIGZ1bmN0aW9ucy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgZGVzdGluYXRpb24gb2JqZWN0Lg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIHNvdXJjZSBvYmplY3QuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY3VzdG9taXplciBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGFzc2lnbmVkIHZhbHVlcy4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGFzc2lnbldpdGgob2JqZWN0LCBzb3VyY2UsIGN1c3RvbWl6ZXIpIHsNCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIHByb3BzID0ga2V5cyhzb3VyY2UpLA0KICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aDsNCg0KICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgdmFyIGtleSA9IHByb3BzW2luZGV4XSwNCiAgICAgICAgICAgIHZhbHVlID0gb2JqZWN0W2tleV0sDQogICAgICAgICAgICByZXN1bHQgPSBjdXN0b21pemVyKHZhbHVlLCBzb3VyY2Vba2V5XSwga2V5LCBvYmplY3QsIHNvdXJjZSk7DQoNCiAgICAgICAgaWYgKChyZXN1bHQgPT09IHJlc3VsdCA/IChyZXN1bHQgIT09IHZhbHVlKSA6ICh2YWx1ZSA9PT0gdmFsdWUpKSB8fA0KICAgICAgICAgICAgKHZhbHVlID09PSB1bmRlZmluZWQgJiYgIShrZXkgaW4gb2JqZWN0KSkpIHsNCiAgICAgICAgICBvYmplY3Rba2V5XSA9IHJlc3VsdDsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIG9iamVjdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5hc3NpZ25gIHdpdGhvdXQgc3VwcG9ydCBmb3IgYXJndW1lbnQganVnZ2xpbmcsDQogICAgICogbXVsdGlwbGUgc291cmNlcywgYW5kIGBjdXN0b21pemVyYCBmdW5jdGlvbnMuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIGRlc3RpbmF0aW9uIG9iamVjdC4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBzb3VyY2Ugb2JqZWN0Lg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZUFzc2lnbihvYmplY3QsIHNvdXJjZSkgew0KICAgICAgcmV0dXJuIHNvdXJjZSA9PSBudWxsDQogICAgICAgID8gb2JqZWN0DQogICAgICAgIDogYmFzZUNvcHkoc291cmNlLCBrZXlzKHNvdXJjZSksIG9iamVjdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uYXRgIHdpdGhvdXQgc3VwcG9ydCBmb3Igc3RyaW5nIGNvbGxlY3Rpb25zDQogICAgICogYW5kIGluZGl2aWR1YWwga2V5IGFyZ3VtZW50cy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyW118c3RyaW5nW119IHByb3BzIFRoZSBwcm9wZXJ0eSBuYW1lcyBvciBpbmRleGVzIG9mIGVsZW1lbnRzIHRvIHBpY2suDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgcGlja2VkIGVsZW1lbnRzLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VBdChjb2xsZWN0aW9uLCBwcm9wcykgew0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgaXNOaWwgPSBjb2xsZWN0aW9uID09IG51bGwsDQogICAgICAgICAgaXNBcnIgPSAhaXNOaWwgJiYgaXNBcnJheUxpa2UoY29sbGVjdGlvbiksDQogICAgICAgICAgbGVuZ3RoID0gaXNBcnIgPyBjb2xsZWN0aW9uLmxlbmd0aCA6IDAsDQogICAgICAgICAgcHJvcHNMZW5ndGggPSBwcm9wcy5sZW5ndGgsDQogICAgICAgICAgcmVzdWx0ID0gQXJyYXkocHJvcHNMZW5ndGgpOw0KDQogICAgICB3aGlsZSgrK2luZGV4IDwgcHJvcHNMZW5ndGgpIHsNCiAgICAgICAgdmFyIGtleSA9IHByb3BzW2luZGV4XTsNCiAgICAgICAgaWYgKGlzQXJyKSB7DQogICAgICAgICAgcmVzdWx0W2luZGV4XSA9IGlzSW5kZXgoa2V5LCBsZW5ndGgpID8gY29sbGVjdGlvbltrZXldIDogdW5kZWZpbmVkOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdFtpbmRleF0gPSBpc05pbCA/IHVuZGVmaW5lZCA6IGNvbGxlY3Rpb25ba2V5XTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb3BpZXMgcHJvcGVydGllcyBvZiBgc291cmNlYCB0byBgb2JqZWN0YC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IHRvIGNvcHkgcHJvcGVydGllcyBmcm9tLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IHByb3BzIFRoZSBwcm9wZXJ0eSBuYW1lcyB0byBjb3B5Lg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0PXt9XSBUaGUgb2JqZWN0IHRvIGNvcHkgcHJvcGVydGllcyB0by4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VDb3B5KHNvdXJjZSwgcHJvcHMsIG9iamVjdCkgew0KICAgICAgb2JqZWN0IHx8IChvYmplY3QgPSB7fSk7DQoNCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aDsNCg0KICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgdmFyIGtleSA9IHByb3BzW2luZGV4XTsNCiAgICAgICAgb2JqZWN0W2tleV0gPSBzb3VyY2Vba2V5XTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBvYmplY3Q7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uY2FsbGJhY2tgIHdoaWNoIHN1cHBvcnRzIHNwZWNpZnlpbmcgdGhlDQogICAgICogbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBwcm92aWRlIHRvIGBmdW5jYC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHsqfSBbZnVuYz1fLmlkZW50aXR5XSBUaGUgdmFsdWUgdG8gY29udmVydCB0byBhIGNhbGxiYWNrLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgZnVuY2AuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFthcmdDb3VudF0gVGhlIG51bWJlciBvZiBhcmd1bWVudHMgdG8gcHJvdmlkZSB0byBgZnVuY2AuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBjYWxsYmFjay4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlQ2FsbGJhY2soZnVuYywgdGhpc0FyZywgYXJnQ291bnQpIHsNCiAgICAgIHZhciB0eXBlID0gdHlwZW9mIGZ1bmM7DQogICAgICBpZiAodHlwZSA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIHJldHVybiB0aGlzQXJnID09PSB1bmRlZmluZWQNCiAgICAgICAgICA/IGZ1bmMNCiAgICAgICAgICA6IGJpbmRDYWxsYmFjayhmdW5jLCB0aGlzQXJnLCBhcmdDb3VudCk7DQogICAgICB9DQogICAgICBpZiAoZnVuYyA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBpZGVudGl0eTsNCiAgICAgIH0NCiAgICAgIGlmICh0eXBlID09ICdvYmplY3QnKSB7DQogICAgICAgIHJldHVybiBiYXNlTWF0Y2hlcyhmdW5jKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiB0aGlzQXJnID09PSB1bmRlZmluZWQNCiAgICAgICAgPyBwcm9wZXJ0eShmdW5jKQ0KICAgICAgICA6IGJhc2VNYXRjaGVzUHJvcGVydHkoZnVuYywgdGhpc0FyZyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uY2xvbmVgIHdpdGhvdXQgc3VwcG9ydCBmb3IgYXJndW1lbnQganVnZ2xpbmcNCiAgICAgKiBhbmQgYHRoaXNgIGJpbmRpbmcgYGN1c3RvbWl6ZXJgIGZ1bmN0aW9ucy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjbG9uaW5nIHZhbHVlcy4NCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2tleV0gVGhlIGtleSBvZiBgdmFsdWVgLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IGB2YWx1ZWAgYmVsb25ncyB0by4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbc3RhY2tBPVtdXSBUcmFja3MgdHJhdmVyc2VkIHNvdXJjZSBvYmplY3RzLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtzdGFja0I9W11dIEFzc29jaWF0ZXMgY2xvbmVzIHdpdGggc291cmNlIGNvdW50ZXJwYXJ0cy4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgY2xvbmVkIHZhbHVlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VDbG9uZSh2YWx1ZSwgaXNEZWVwLCBjdXN0b21pemVyLCBrZXksIG9iamVjdCwgc3RhY2tBLCBzdGFja0IpIHsNCiAgICAgIHZhciByZXN1bHQ7DQogICAgICBpZiAoY3VzdG9taXplcikgew0KICAgICAgICByZXN1bHQgPSBvYmplY3QgPyBjdXN0b21pemVyKHZhbHVlLCBrZXksIG9iamVjdCkgOiBjdXN0b21pemVyKHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KICAgICAgaWYgKCFpc09iamVjdCh2YWx1ZSkpIHsNCiAgICAgICAgcmV0dXJuIHZhbHVlOw0KICAgICAgfQ0KICAgICAgdmFyIGlzQXJyID0gaXNBcnJheSh2YWx1ZSk7DQogICAgICBpZiAoaXNBcnIpIHsNCiAgICAgICAgcmVzdWx0ID0gaW5pdENsb25lQXJyYXkodmFsdWUpOw0KICAgICAgICBpZiAoIWlzRGVlcCkgew0KICAgICAgICAgIHJldHVybiBhcnJheUNvcHkodmFsdWUsIHJlc3VsdCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHZhciB0YWcgPSBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSwNCiAgICAgICAgICAgIGlzRnVuYyA9IHRhZyA9PSBmdW5jVGFnOw0KDQogICAgICAgIGlmICh0YWcgPT0gb2JqZWN0VGFnIHx8IHRhZyA9PSBhcmdzVGFnIHx8IChpc0Z1bmMgJiYgIW9iamVjdCkpIHsNCiAgICAgICAgICByZXN1bHQgPSBpbml0Q2xvbmVPYmplY3QoaXNGdW5jID8ge30gOiB2YWx1ZSk7DQogICAgICAgICAgaWYgKCFpc0RlZXApIHsNCiAgICAgICAgICAgIHJldHVybiBiYXNlQXNzaWduKHJlc3VsdCwgdmFsdWUpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gY2xvbmVhYmxlVGFnc1t0YWddDQogICAgICAgICAgICA/IGluaXRDbG9uZUJ5VGFnKHZhbHVlLCB0YWcsIGlzRGVlcCkNCiAgICAgICAgICAgIDogKG9iamVjdCA/IHZhbHVlIDoge30pOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvLyBDaGVjayBmb3IgY2lyY3VsYXIgcmVmZXJlbmNlcyBhbmQgcmV0dXJuIGNvcnJlc3BvbmRpbmcgY2xvbmUuDQogICAgICBzdGFja0EgfHwgKHN0YWNrQSA9IFtdKTsNCiAgICAgIHN0YWNrQiB8fCAoc3RhY2tCID0gW10pOw0KDQogICAgICB2YXIgbGVuZ3RoID0gc3RhY2tBLmxlbmd0aDsNCiAgICAgIHdoaWxlIChsZW5ndGgtLSkgew0KICAgICAgICBpZiAoc3RhY2tBW2xlbmd0aF0gPT0gdmFsdWUpIHsNCiAgICAgICAgICByZXR1cm4gc3RhY2tCW2xlbmd0aF07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8vIEFkZCB0aGUgc291cmNlIHZhbHVlIHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cyBhbmQgYXNzb2NpYXRlIGl0IHdpdGggaXRzIGNsb25lLg0KICAgICAgc3RhY2tBLnB1c2godmFsdWUpOw0KICAgICAgc3RhY2tCLnB1c2gocmVzdWx0KTsNCg0KICAgICAgLy8gUmVjdXJzaXZlbHkgcG9wdWxhdGUgY2xvbmUgKHN1c2NlcHRpYmxlIHRvIGNhbGwgc3RhY2sgbGltaXRzKS4NCiAgICAgIChpc0FyciA/IGFycmF5RWFjaCA6IGJhc2VGb3JPd24pKHZhbHVlLCBmdW5jdGlvbihzdWJWYWx1ZSwga2V5KSB7DQogICAgICAgIHJlc3VsdFtrZXldID0gYmFzZUNsb25lKHN1YlZhbHVlLCBpc0RlZXAsIGN1c3RvbWl6ZXIsIGtleSwgdmFsdWUsIHN0YWNrQSwgc3RhY2tCKTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5jcmVhdGVgIHdpdGhvdXQgc3VwcG9ydCBmb3IgYXNzaWduaW5nDQogICAgICogcHJvcGVydGllcyB0byB0aGUgY3JlYXRlZCBvYmplY3QuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwcm90b3R5cGUgVGhlIG9iamVjdCB0byBpbmhlcml0IGZyb20uDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IG9iamVjdC4NCiAgICAgKi8NCiAgICB2YXIgYmFzZUNyZWF0ZSA9IChmdW5jdGlvbigpIHsNCiAgICAgIGZ1bmN0aW9uIG9iamVjdCgpIHt9DQogICAgICByZXR1cm4gZnVuY3Rpb24ocHJvdG90eXBlKSB7DQogICAgICAgIGlmIChpc09iamVjdChwcm90b3R5cGUpKSB7DQogICAgICAgICAgb2JqZWN0LnByb3RvdHlwZSA9IHByb3RvdHlwZTsNCiAgICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IG9iamVjdDsNCiAgICAgICAgICBvYmplY3QucHJvdG90eXBlID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0IHx8IHt9Ow0KICAgICAgfTsNCiAgICB9KCkpOw0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZGVsYXlgIGFuZCBgXy5kZWZlcmAgd2hpY2ggYWNjZXB0cyBhbiBpbmRleA0KICAgICAqIG9mIHdoZXJlIHRvIHNsaWNlIHRoZSBhcmd1bWVudHMgdG8gcHJvdmlkZSB0byBgZnVuY2AuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGRlbGF5Lg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSB3YWl0IFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIGRlbGF5IGludm9jYXRpb24uDQogICAgICogQHBhcmFtIHtPYmplY3R9IGFyZ3MgVGhlIGFyZ3VtZW50cyBwcm92aWRlIHRvIGBmdW5jYC4NCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSB0aW1lciBpZC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlRGVsYXkoZnVuYywgd2FpdCwgYXJncykgew0KICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsNCiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGZ1bmMuYXBwbHkodW5kZWZpbmVkLCBhcmdzKTsgfSwgd2FpdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZGlmZmVyZW5jZWAgd2hpY2ggYWNjZXB0cyBhIHNpbmdsZSBhcnJheQ0KICAgICAqIG9mIHZhbHVlcyB0byBleGNsdWRlLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSB2YWx1ZXMgVGhlIHZhbHVlcyB0byBleGNsdWRlLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlRGlmZmVyZW5jZShhcnJheSwgdmFsdWVzKSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwLA0KICAgICAgICAgIHJlc3VsdCA9IFtdOw0KDQogICAgICBpZiAoIWxlbmd0aCkgew0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgaW5kZXhPZiA9IGdldEluZGV4T2YoKSwNCiAgICAgICAgICBpc0NvbW1vbiA9IGluZGV4T2YgPT0gYmFzZUluZGV4T2YsDQogICAgICAgICAgY2FjaGUgPSAoaXNDb21tb24gJiYgdmFsdWVzLmxlbmd0aCA+PSAyMDApID8gY3JlYXRlQ2FjaGUodmFsdWVzKSA6IG51bGwsDQogICAgICAgICAgdmFsdWVzTGVuZ3RoID0gdmFsdWVzLmxlbmd0aDsNCg0KICAgICAgaWYgKGNhY2hlKSB7DQogICAgICAgIGluZGV4T2YgPSBjYWNoZUluZGV4T2Y7DQogICAgICAgIGlzQ29tbW9uID0gZmFsc2U7DQogICAgICAgIHZhbHVlcyA9IGNhY2hlOw0KICAgICAgfQ0KICAgICAgb3V0ZXI6DQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07DQoNCiAgICAgICAgaWYgKGlzQ29tbW9uICYmIHZhbHVlID09PSB2YWx1ZSkgew0KICAgICAgICAgIHZhciB2YWx1ZXNJbmRleCA9IHZhbHVlc0xlbmd0aDsNCiAgICAgICAgICB3aGlsZSAodmFsdWVzSW5kZXgtLSkgew0KICAgICAgICAgICAgaWYgKHZhbHVlc1t2YWx1ZXNJbmRleF0gPT09IHZhbHVlKSB7DQogICAgICAgICAgICAgIGNvbnRpbnVlIG91dGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoaW5kZXhPZih2YWx1ZXMsIHZhbHVlLCAwKSA8IDApIHsNCiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZm9yRWFjaGAgd2l0aG91dCBzdXBwb3J0IGZvciBjYWxsYmFjaw0KICAgICAqIHNob3J0aGFuZHMgYW5kIGB0aGlzYCBiaW5kaW5nLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHJldHVybnMge0FycmF5fE9iamVjdHxzdHJpbmd9IFJldHVybnMgYGNvbGxlY3Rpb25gLg0KICAgICAqLw0KICAgIHZhciBiYXNlRWFjaCA9IGNyZWF0ZUJhc2VFYWNoKGJhc2VGb3JPd24pOw0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZm9yRWFjaFJpZ2h0YCB3aXRob3V0IHN1cHBvcnQgZm9yIGNhbGxiYWNrDQogICAgICogc2hvcnRoYW5kcyBhbmQgYHRoaXNgIGJpbmRpbmcuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl8T2JqZWN0fHN0cmluZ30gUmV0dXJucyBgY29sbGVjdGlvbmAuDQogICAgICovDQogICAgdmFyIGJhc2VFYWNoUmlnaHQgPSBjcmVhdGVCYXNlRWFjaChiYXNlRm9yT3duUmlnaHQsIHRydWUpOw0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZXZlcnlgIHdpdGhvdXQgc3VwcG9ydCBmb3IgY2FsbGJhY2sNCiAgICAgKiBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYWxsIGVsZW1lbnRzIHBhc3MgdGhlIHByZWRpY2F0ZSBjaGVjaywNCiAgICAgKiAgZWxzZSBgZmFsc2VgDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZUV2ZXJ5KGNvbGxlY3Rpb24sIHByZWRpY2F0ZSkgew0KICAgICAgdmFyIHJlc3VsdCA9IHRydWU7DQogICAgICBiYXNlRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHsNCiAgICAgICAgcmVzdWx0ID0gISFwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXRzIHRoZSBleHRyZW11bSB2YWx1ZSBvZiBgY29sbGVjdGlvbmAgaW52b2tpbmcgYGl0ZXJhdGVlYCBmb3IgZWFjaCB2YWx1ZQ0KICAgICAqIGluIGBjb2xsZWN0aW9uYCB0byBnZW5lcmF0ZSB0aGUgY3JpdGVyaW9uIGJ5IHdoaWNoIHRoZSB2YWx1ZSBpcyByYW5rZWQuDQogICAgICogVGhlIGBpdGVyYXRlZWAgaXMgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29tcGFyYXRvciBUaGUgZnVuY3Rpb24gdXNlZCB0byBjb21wYXJlIHZhbHVlcy4NCiAgICAgKiBAcGFyYW0geyp9IGV4VmFsdWUgVGhlIGluaXRpYWwgZXh0cmVtdW0gdmFsdWUuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGV4dHJlbXVtIHZhbHVlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VFeHRyZW11bShjb2xsZWN0aW9uLCBpdGVyYXRlZSwgY29tcGFyYXRvciwgZXhWYWx1ZSkgew0KICAgICAgdmFyIGNvbXB1dGVkID0gZXhWYWx1ZSwNCiAgICAgICAgICByZXN1bHQgPSBjb21wdXRlZDsNCg0KICAgICAgYmFzZUVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7DQogICAgICAgIHZhciBjdXJyZW50ID0gK2l0ZXJhdGVlKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7DQogICAgICAgIGlmIChjb21wYXJhdG9yKGN1cnJlbnQsIGNvbXB1dGVkKSB8fCAoY3VycmVudCA9PT0gZXhWYWx1ZSAmJiBjdXJyZW50ID09PSByZXN1bHQpKSB7DQogICAgICAgICAgY29tcHV0ZWQgPSBjdXJyZW50Ow0KICAgICAgICAgIHJlc3VsdCA9IHZhbHVlOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZmlsbGAgd2l0aG91dCBhbiBpdGVyYXRlZSBjYWxsIGd1YXJkLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gZmlsbC4NCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBmaWxsIGBhcnJheWAgd2l0aC4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2VuZD1hcnJheS5sZW5ndGhdIFRoZSBlbmQgcG9zaXRpb24uDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZUZpbGwoYXJyYXksIHZhbHVlLCBzdGFydCwgZW5kKSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOw0KDQogICAgICBzdGFydCA9IHN0YXJ0ID09IG51bGwgPyAwIDogKCtzdGFydCB8fCAwKTsNCiAgICAgIGlmIChzdGFydCA8IDApIHsNCiAgICAgICAgc3RhcnQgPSAtc3RhcnQgPiBsZW5ndGggPyAwIDogKGxlbmd0aCArIHN0YXJ0KTsNCiAgICAgIH0NCiAgICAgIGVuZCA9IChlbmQgPT09IHVuZGVmaW5lZCB8fCBlbmQgPiBsZW5ndGgpID8gbGVuZ3RoIDogKCtlbmQgfHwgMCk7DQogICAgICBpZiAoZW5kIDwgMCkgew0KICAgICAgICBlbmQgKz0gbGVuZ3RoOw0KICAgICAgfQ0KICAgICAgbGVuZ3RoID0gc3RhcnQgPiBlbmQgPyAwIDogKGVuZCA+Pj4gMCk7DQogICAgICBzdGFydCA+Pj49IDA7DQoNCiAgICAgIHdoaWxlIChzdGFydCA8IGxlbmd0aCkgew0KICAgICAgICBhcnJheVtzdGFydCsrXSA9IHZhbHVlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGFycmF5Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmZpbHRlcmAgd2l0aG91dCBzdXBwb3J0IGZvciBjYWxsYmFjaw0KICAgICAqIHNob3J0aGFuZHMgYW5kIGB0aGlzYCBiaW5kaW5nLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZpbHRlcmVkIGFycmF5Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VGaWx0ZXIoY29sbGVjdGlvbiwgcHJlZGljYXRlKSB7DQogICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICBiYXNlRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHsNCiAgICAgICAgaWYgKHByZWRpY2F0ZSh2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pKSB7DQogICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZmluZGAsIGBfLmZpbmRMYXN0YCwgYF8uZmluZEtleWAsIGFuZCBgXy5maW5kTGFzdEtleWAsDQogICAgICogd2l0aG91dCBzdXBwb3J0IGZvciBjYWxsYmFjayBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZywgd2hpY2ggaXRlcmF0ZXMNCiAgICAgKiBvdmVyIGBjb2xsZWN0aW9uYCB1c2luZyB0aGUgcHJvdmlkZWQgYGVhY2hGdW5jYC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIHNlYXJjaC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlYWNoRnVuYyBUaGUgZnVuY3Rpb24gdG8gaXRlcmF0ZSBvdmVyIGBjb2xsZWN0aW9uYC4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtyZXRLZXldIFNwZWNpZnkgcmV0dXJuaW5nIHRoZSBrZXkgb2YgdGhlIGZvdW5kIGVsZW1lbnQNCiAgICAgKiAgaW5zdGVhZCBvZiB0aGUgZWxlbWVudCBpdHNlbGYuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGZvdW5kIGVsZW1lbnQgb3IgaXRzIGtleSwgZWxzZSBgdW5kZWZpbmVkYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlRmluZChjb2xsZWN0aW9uLCBwcmVkaWNhdGUsIGVhY2hGdW5jLCByZXRLZXkpIHsNCiAgICAgIHZhciByZXN1bHQ7DQogICAgICBlYWNoRnVuYyhjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBjb2xsZWN0aW9uKSB7DQogICAgICAgIGlmIChwcmVkaWNhdGUodmFsdWUsIGtleSwgY29sbGVjdGlvbikpIHsNCiAgICAgICAgICByZXN1bHQgPSByZXRLZXkgPyBrZXkgOiB2YWx1ZTsNCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mbGF0dGVuYCB3aXRoIGFkZGVkIHN1cHBvcnQgZm9yIHJlc3RyaWN0aW5nDQogICAgICogZmxhdHRlbmluZyBhbmQgc3BlY2lmeWluZyB0aGUgc3RhcnQgaW5kZXguDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmbGF0dGVuLg0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRGVlcF0gU3BlY2lmeSBhIGRlZXAgZmxhdHRlbi4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc1N0cmljdF0gUmVzdHJpY3QgZmxhdHRlbmluZyB0byBhcnJheXMtbGlrZSBvYmplY3RzLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZsYXR0ZW5lZCBhcnJheS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlRmxhdHRlbihhcnJheSwgaXNEZWVwLCBpc1N0cmljdCkgew0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLA0KICAgICAgICAgIHJlc0luZGV4ID0gLTEsDQogICAgICAgICAgcmVzdWx0ID0gW107DQoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XTsNCiAgICAgICAgaWYgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgaXNBcnJheUxpa2UodmFsdWUpICYmDQogICAgICAgICAgICAoaXNTdHJpY3QgfHwgaXNBcnJheSh2YWx1ZSkgfHwgaXNBcmd1bWVudHModmFsdWUpKSkgew0KICAgICAgICAgIGlmIChpc0RlZXApIHsNCiAgICAgICAgICAgIC8vIFJlY3Vyc2l2ZWx5IGZsYXR0ZW4gYXJyYXlzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuDQogICAgICAgICAgICB2YWx1ZSA9IGJhc2VGbGF0dGVuKHZhbHVlLCBpc0RlZXAsIGlzU3RyaWN0KTsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIHZhbEluZGV4ID0gLTEsDQogICAgICAgICAgICAgIHZhbExlbmd0aCA9IHZhbHVlLmxlbmd0aDsNCg0KICAgICAgICAgIHdoaWxlICgrK3ZhbEluZGV4IDwgdmFsTGVuZ3RoKSB7DQogICAgICAgICAgICByZXN1bHRbKytyZXNJbmRleF0gPSB2YWx1ZVt2YWxJbmRleF07DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKCFpc1N0cmljdCkgew0KICAgICAgICAgIHJlc3VsdFsrK3Jlc0luZGV4XSA9IHZhbHVlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBiYXNlRm9ySW5gIGFuZCBgYmFzZUZvck93bmAgd2hpY2ggaXRlcmF0ZXMNCiAgICAgKiBvdmVyIGBvYmplY3RgIHByb3BlcnRpZXMgcmV0dXJuZWQgYnkgYGtleXNGdW5jYCBpbnZva2luZyBgaXRlcmF0ZWVgIGZvcg0KICAgICAqIGVhY2ggcHJvcGVydHkuIEl0ZXJhdGVlIGZ1bmN0aW9ucyBtYXkgZXhpdCBpdGVyYXRpb24gZWFybHkgYnkgZXhwbGljaXRseQ0KICAgICAqIHJldHVybmluZyBgZmFsc2VgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0ga2V5c0Z1bmMgVGhlIGZ1bmN0aW9uIHRvIGdldCB0aGUga2V5cyBvZiBgb2JqZWN0YC4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLg0KICAgICAqLw0KICAgIHZhciBiYXNlRm9yID0gY3JlYXRlQmFzZUZvcigpOw0KDQogICAgLyoqDQogICAgICogVGhpcyBmdW5jdGlvbiBpcyBsaWtlIGBiYXNlRm9yYCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIHByb3BlcnRpZXMNCiAgICAgKiBpbiB0aGUgb3Bwb3NpdGUgb3JkZXIuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBrZXlzRnVuYyBUaGUgZnVuY3Rpb24gdG8gZ2V0IHRoZSBrZXlzIG9mIGBvYmplY3RgLg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuDQogICAgICovDQogICAgdmFyIGJhc2VGb3JSaWdodCA9IGNyZWF0ZUJhc2VGb3IodHJ1ZSk7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mb3JJbmAgd2l0aG91dCBzdXBwb3J0IGZvciBjYWxsYmFjaw0KICAgICAqIHNob3J0aGFuZHMgYW5kIGB0aGlzYCBiaW5kaW5nLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlRm9ySW4ob2JqZWN0LCBpdGVyYXRlZSkgew0KICAgICAgcmV0dXJuIGJhc2VGb3Iob2JqZWN0LCBpdGVyYXRlZSwga2V5c0luKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mb3JPd25gIHdpdGhvdXQgc3VwcG9ydCBmb3IgY2FsbGJhY2sNCiAgICAgKiBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZUZvck93bihvYmplY3QsIGl0ZXJhdGVlKSB7DQogICAgICByZXR1cm4gYmFzZUZvcihvYmplY3QsIGl0ZXJhdGVlLCBrZXlzKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mb3JPd25SaWdodGAgd2l0aG91dCBzdXBwb3J0IGZvciBjYWxsYmFjaw0KICAgICAqIHNob3J0aGFuZHMgYW5kIGB0aGlzYCBiaW5kaW5nLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlRm9yT3duUmlnaHQob2JqZWN0LCBpdGVyYXRlZSkgew0KICAgICAgcmV0dXJuIGJhc2VGb3JSaWdodChvYmplY3QsIGl0ZXJhdGVlLCBrZXlzKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mdW5jdGlvbnNgIHdoaWNoIGNyZWF0ZXMgYW4gYXJyYXkgb2YNCiAgICAgKiBgb2JqZWN0YCBmdW5jdGlvbiBwcm9wZXJ0eSBuYW1lcyBmaWx0ZXJlZCBmcm9tIHRob3NlIHByb3ZpZGVkLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyBUaGUgcHJvcGVydHkgbmFtZXMgdG8gZmlsdGVyLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHByb3BlcnR5IG5hbWVzLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VGdW5jdGlvbnMob2JqZWN0LCBwcm9wcykgew0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoLA0KICAgICAgICAgIHJlc0luZGV4ID0gLTEsDQogICAgICAgICAgcmVzdWx0ID0gW107DQoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07DQogICAgICAgIGlmIChpc0Z1bmN0aW9uKG9iamVjdFtrZXldKSkgew0KICAgICAgICAgIHJlc3VsdFsrK3Jlc0luZGV4XSA9IGtleTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgZ2V0YCB3aXRob3V0IHN1cHBvcnQgZm9yIHN0cmluZyBwYXRocw0KICAgICAqIGFuZCBkZWZhdWx0IHZhbHVlcy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5Lg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC4NCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3BhdGhLZXldIFRoZSBrZXkgcmVwcmVzZW50YXRpb24gb2YgcGF0aC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmVzb2x2ZWQgdmFsdWUuDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZUdldChvYmplY3QsIHBhdGgsIHBhdGhLZXkpIHsNCiAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBpZiAocGF0aEtleSAhPT0gdW5kZWZpbmVkICYmIHBhdGhLZXkgaW4gdG9PYmplY3Qob2JqZWN0KSkgew0KICAgICAgICBwYXRoID0gW3BhdGhLZXldOw0KICAgICAgfQ0KICAgICAgdmFyIGluZGV4ID0gMCwNCiAgICAgICAgICBsZW5ndGggPSBwYXRoLmxlbmd0aDsNCg0KICAgICAgd2hpbGUgKG9iamVjdCAhPSBudWxsICYmIGluZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIG9iamVjdCA9IG9iamVjdFtwYXRoW2luZGV4KytdXTsNCiAgICAgIH0NCiAgICAgIHJldHVybiAoaW5kZXggJiYgaW5kZXggPT0gbGVuZ3RoKSA/IG9iamVjdCA6IHVuZGVmaW5lZDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc0VxdWFsYCB3aXRob3V0IHN1cHBvcnQgZm9yIGB0aGlzYCBiaW5kaW5nDQogICAgICogYGN1c3RvbWl6ZXJgIGZ1bmN0aW9ucy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS4NCiAgICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmluZyB2YWx1ZXMuDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNMb29zZV0gU3BlY2lmeSBwZXJmb3JtaW5nIHBhcnRpYWwgY29tcGFyaXNvbnMuDQogICAgICogQHBhcmFtIHtBcnJheX0gW3N0YWNrQV0gVHJhY2tzIHRyYXZlcnNlZCBgdmFsdWVgIG9iamVjdHMuDQogICAgICogQHBhcmFtIHtBcnJheX0gW3N0YWNrQl0gVHJhY2tzIHRyYXZlcnNlZCBgb3RoZXJgIG9iamVjdHMuDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSB2YWx1ZXMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlSXNFcXVhbCh2YWx1ZSwgb3RoZXIsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKSB7DQogICAgICBpZiAodmFsdWUgPT09IG90aGVyKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgICAgaWYgKHZhbHVlID09IG51bGwgfHwgb3RoZXIgPT0gbnVsbCB8fCAoIWlzT2JqZWN0KHZhbHVlKSAmJiAhaXNPYmplY3RMaWtlKG90aGVyKSkpIHsNCiAgICAgICAgcmV0dXJuIHZhbHVlICE9PSB2YWx1ZSAmJiBvdGhlciAhPT0gb3RoZXI7DQogICAgICB9DQogICAgICByZXR1cm4gYmFzZUlzRXF1YWxEZWVwKHZhbHVlLCBvdGhlciwgYmFzZUlzRXF1YWwsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsYCBmb3IgYXJyYXlzIGFuZCBvYmplY3RzIHdoaWNoIHBlcmZvcm1zDQogICAgICogZGVlcCBjb21wYXJpc29ucyBhbmQgdHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzIGVuYWJsaW5nIG9iamVjdHMgd2l0aCBjaXJjdWxhcg0KICAgICAqIHJlZmVyZW5jZXMgdG8gYmUgY29tcGFyZWQuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBjb21wYXJlLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlciBUaGUgb3RoZXIgb2JqZWN0IHRvIGNvbXBhcmUuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXF1YWxGdW5jIFRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZXF1aXZhbGVudHMgb2YgdmFsdWVzLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmluZyBvYmplY3RzLg0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzTG9vc2VdIFNwZWNpZnkgcGVyZm9ybWluZyBwYXJ0aWFsIGNvbXBhcmlzb25zLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtzdGFja0E9W11dIFRyYWNrcyB0cmF2ZXJzZWQgYHZhbHVlYCBvYmplY3RzLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtzdGFja0I9W11dIFRyYWNrcyB0cmF2ZXJzZWQgYG90aGVyYCBvYmplY3RzLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgb2JqZWN0cyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VJc0VxdWFsRGVlcChvYmplY3QsIG90aGVyLCBlcXVhbEZ1bmMsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKSB7DQogICAgICB2YXIgb2JqSXNBcnIgPSBpc0FycmF5KG9iamVjdCksDQogICAgICAgICAgb3RoSXNBcnIgPSBpc0FycmF5KG90aGVyKSwNCiAgICAgICAgICBvYmpUYWcgPSBhcnJheVRhZywNCiAgICAgICAgICBvdGhUYWcgPSBhcnJheVRhZzsNCg0KICAgICAgaWYgKCFvYmpJc0Fycikgew0KICAgICAgICBvYmpUYWcgPSBvYmpUb1N0cmluZy5jYWxsKG9iamVjdCk7DQogICAgICAgIGlmIChvYmpUYWcgPT0gYXJnc1RhZykgew0KICAgICAgICAgIG9ialRhZyA9IG9iamVjdFRhZzsNCiAgICAgICAgfSBlbHNlIGlmIChvYmpUYWcgIT0gb2JqZWN0VGFnKSB7DQogICAgICAgICAgb2JqSXNBcnIgPSBpc1R5cGVkQXJyYXkob2JqZWN0KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKCFvdGhJc0Fycikgew0KICAgICAgICBvdGhUYWcgPSBvYmpUb1N0cmluZy5jYWxsKG90aGVyKTsNCiAgICAgICAgaWYgKG90aFRhZyA9PSBhcmdzVGFnKSB7DQogICAgICAgICAgb3RoVGFnID0gb2JqZWN0VGFnOw0KICAgICAgICB9IGVsc2UgaWYgKG90aFRhZyAhPSBvYmplY3RUYWcpIHsNCiAgICAgICAgICBvdGhJc0FyciA9IGlzVHlwZWRBcnJheShvdGhlcik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHZhciBvYmpJc09iaiA9IG9ialRhZyA9PSBvYmplY3RUYWcsDQogICAgICAgICAgb3RoSXNPYmogPSBvdGhUYWcgPT0gb2JqZWN0VGFnLA0KICAgICAgICAgIGlzU2FtZVRhZyA9IG9ialRhZyA9PSBvdGhUYWc7DQoNCiAgICAgIGlmIChpc1NhbWVUYWcgJiYgIShvYmpJc0FyciB8fCBvYmpJc09iaikpIHsNCiAgICAgICAgcmV0dXJuIGVxdWFsQnlUYWcob2JqZWN0LCBvdGhlciwgb2JqVGFnKTsNCiAgICAgIH0NCiAgICAgIGlmICghaXNMb29zZSkgew0KICAgICAgICB2YXIgb2JqSXNXcmFwcGVkID0gb2JqSXNPYmogJiYgaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsICdfX3dyYXBwZWRfXycpLA0KICAgICAgICAgICAgb3RoSXNXcmFwcGVkID0gb3RoSXNPYmogJiYgaGFzT3duUHJvcGVydHkuY2FsbChvdGhlciwgJ19fd3JhcHBlZF9fJyk7DQoNCiAgICAgICAgaWYgKG9iaklzV3JhcHBlZCB8fCBvdGhJc1dyYXBwZWQpIHsNCiAgICAgICAgICByZXR1cm4gZXF1YWxGdW5jKG9iaklzV3JhcHBlZCA/IG9iamVjdC52YWx1ZSgpIDogb2JqZWN0LCBvdGhJc1dyYXBwZWQgPyBvdGhlci52YWx1ZSgpIDogb3RoZXIsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKCFpc1NhbWVUYWcpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgICAgLy8gQXNzdW1lIGN5Y2xpYyB2YWx1ZXMgYXJlIGVxdWFsLg0KICAgICAgLy8gRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gZGV0ZWN0aW5nIGNpcmN1bGFyIHJlZmVyZW5jZXMgc2VlIGh0dHBzOi8vZXM1LmdpdGh1Yi5pby8jSk8uDQogICAgICBzdGFja0EgfHwgKHN0YWNrQSA9IFtdKTsNCiAgICAgIHN0YWNrQiB8fCAoc3RhY2tCID0gW10pOw0KDQogICAgICB2YXIgbGVuZ3RoID0gc3RhY2tBLmxlbmd0aDsNCiAgICAgIHdoaWxlIChsZW5ndGgtLSkgew0KICAgICAgICBpZiAoc3RhY2tBW2xlbmd0aF0gPT0gb2JqZWN0KSB7DQogICAgICAgICAgcmV0dXJuIHN0YWNrQltsZW5ndGhdID09IG90aGVyOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvLyBBZGQgYG9iamVjdGAgYW5kIGBvdGhlcmAgdG8gdGhlIHN0YWNrIG9mIHRyYXZlcnNlZCBvYmplY3RzLg0KICAgICAgc3RhY2tBLnB1c2gob2JqZWN0KTsNCiAgICAgIHN0YWNrQi5wdXNoKG90aGVyKTsNCg0KICAgICAgdmFyIHJlc3VsdCA9IChvYmpJc0FyciA/IGVxdWFsQXJyYXlzIDogZXF1YWxPYmplY3RzKShvYmplY3QsIG90aGVyLCBlcXVhbEZ1bmMsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKTsNCg0KICAgICAgc3RhY2tBLnBvcCgpOw0KICAgICAgc3RhY2tCLnBvcCgpOw0KDQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzTWF0Y2hgIHdpdGhvdXQgc3VwcG9ydCBmb3IgY2FsbGJhY2sNCiAgICAgKiBzaG9ydGhhbmRzIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuDQogICAgICogQHBhcmFtIHtBcnJheX0gbWF0Y2hEYXRhIFRoZSBwcm9wZXJ5IG5hbWVzLCB2YWx1ZXMsIGFuZCBjb21wYXJlIGZsYWdzIHRvIG1hdGNoLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmluZyBvYmplY3RzLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgb2JqZWN0YCBpcyBhIG1hdGNoLCBlbHNlIGBmYWxzZWAuDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZUlzTWF0Y2gob2JqZWN0LCBtYXRjaERhdGEsIGN1c3RvbWl6ZXIpIHsNCiAgICAgIHZhciBpbmRleCA9IG1hdGNoRGF0YS5sZW5ndGgsDQogICAgICAgICAgbGVuZ3RoID0gaW5kZXgsDQogICAgICAgICAgbm9DdXN0b21pemVyID0gIWN1c3RvbWl6ZXI7DQoNCiAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gIWxlbmd0aDsNCiAgICAgIH0NCiAgICAgIG9iamVjdCA9IHRvT2JqZWN0KG9iamVjdCk7DQogICAgICB3aGlsZSAoaW5kZXgtLSkgew0KICAgICAgICB2YXIgZGF0YSA9IG1hdGNoRGF0YVtpbmRleF07DQogICAgICAgIGlmICgobm9DdXN0b21pemVyICYmIGRhdGFbMl0pDQogICAgICAgICAgICAgID8gZGF0YVsxXSAhPT0gb2JqZWN0W2RhdGFbMF1dDQogICAgICAgICAgICAgIDogIShkYXRhWzBdIGluIG9iamVjdCkNCiAgICAgICAgICAgICkgew0KICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgZGF0YSA9IG1hdGNoRGF0YVtpbmRleF07DQogICAgICAgIHZhciBrZXkgPSBkYXRhWzBdLA0KICAgICAgICAgICAgb2JqVmFsdWUgPSBvYmplY3Rba2V5XSwNCiAgICAgICAgICAgIHNyY1ZhbHVlID0gZGF0YVsxXTsNCg0KICAgICAgICBpZiAobm9DdXN0b21pemVyICYmIGRhdGFbMl0pIHsNCiAgICAgICAgICBpZiAob2JqVmFsdWUgPT09IHVuZGVmaW5lZCAmJiAhKGtleSBpbiBvYmplY3QpKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHZhciByZXN1bHQgPSBjdXN0b21pemVyID8gY3VzdG9taXplcihvYmpWYWx1ZSwgc3JjVmFsdWUsIGtleSkgOiB1bmRlZmluZWQ7DQogICAgICAgICAgaWYgKCEocmVzdWx0ID09PSB1bmRlZmluZWQgPyBiYXNlSXNFcXVhbChzcmNWYWx1ZSwgb2JqVmFsdWUsIGN1c3RvbWl6ZXIsIHRydWUpIDogcmVzdWx0KSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ubWFwYCB3aXRob3V0IHN1cHBvcnQgZm9yIGNhbGxiYWNrIHNob3J0aGFuZHMNCiAgICAgKiBhbmQgYHRoaXNgIGJpbmRpbmcuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBtYXBwZWQgYXJyYXkuDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZU1hcChjb2xsZWN0aW9uLCBpdGVyYXRlZSkgew0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgcmVzdWx0ID0gaXNBcnJheUxpa2UoY29sbGVjdGlvbikgPyBBcnJheShjb2xsZWN0aW9uLmxlbmd0aCkgOiBbXTsNCg0KICAgICAgYmFzZUVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGtleSwgY29sbGVjdGlvbikgew0KICAgICAgICByZXN1bHRbKytpbmRleF0gPSBpdGVyYXRlZSh2YWx1ZSwga2V5LCBjb2xsZWN0aW9uKTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5tYXRjaGVzYCB3aGljaCBkb2VzIG5vdCBjbG9uZSBgc291cmNlYC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHZhbHVlcyB0byBtYXRjaC4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlTWF0Y2hlcyhzb3VyY2UpIHsNCiAgICAgIHZhciBtYXRjaERhdGEgPSBnZXRNYXRjaERhdGEoc291cmNlKTsNCiAgICAgIGlmIChtYXRjaERhdGEubGVuZ3RoID09IDEgJiYgbWF0Y2hEYXRhWzBdWzJdKSB7DQogICAgICAgIHZhciBrZXkgPSBtYXRjaERhdGFbMF1bMF0sDQogICAgICAgICAgICB2YWx1ZSA9IG1hdGNoRGF0YVswXVsxXTsNCg0KICAgICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7DQogICAgICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBvYmplY3Rba2V5XSA9PT0gdmFsdWUgJiYgKHZhbHVlICE9PSB1bmRlZmluZWQgfHwgKGtleSBpbiB0b09iamVjdChvYmplY3QpKSk7DQogICAgICAgIH07DQogICAgICB9DQogICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7DQogICAgICAgIHJldHVybiBiYXNlSXNNYXRjaChvYmplY3QsIG1hdGNoRGF0YSk7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLm1hdGNoZXNQcm9wZXJ0eWAgd2hpY2ggZG9lcyBub3QgY2xvbmUgYHNyY1ZhbHVlYC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC4NCiAgICAgKiBAcGFyYW0geyp9IHNyY1ZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VNYXRjaGVzUHJvcGVydHkocGF0aCwgc3JjVmFsdWUpIHsNCiAgICAgIHZhciBpc0FyciA9IGlzQXJyYXkocGF0aCksDQogICAgICAgICAgaXNDb21tb24gPSBpc0tleShwYXRoKSAmJiBpc1N0cmljdENvbXBhcmFibGUoc3JjVmFsdWUpLA0KICAgICAgICAgIHBhdGhLZXkgPSAocGF0aCArICcnKTsNCg0KICAgICAgcGF0aCA9IHRvUGF0aChwYXRoKTsNCiAgICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHsNCiAgICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7DQogICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHZhciBrZXkgPSBwYXRoS2V5Ow0KICAgICAgICBvYmplY3QgPSB0b09iamVjdChvYmplY3QpOw0KICAgICAgICBpZiAoKGlzQXJyIHx8ICFpc0NvbW1vbikgJiYgIShrZXkgaW4gb2JqZWN0KSkgew0KICAgICAgICAgIG9iamVjdCA9IHBhdGgubGVuZ3RoID09IDEgPyBvYmplY3QgOiBiYXNlR2V0KG9iamVjdCwgYmFzZVNsaWNlKHBhdGgsIDAsIC0xKSk7DQogICAgICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgfQ0KICAgICAgICAgIGtleSA9IGxhc3QocGF0aCk7DQogICAgICAgICAgb2JqZWN0ID0gdG9PYmplY3Qob2JqZWN0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gb2JqZWN0W2tleV0gPT09IHNyY1ZhbHVlDQogICAgICAgICAgPyAoc3JjVmFsdWUgIT09IHVuZGVmaW5lZCB8fCAoa2V5IGluIG9iamVjdCkpDQogICAgICAgICAgOiBiYXNlSXNFcXVhbChzcmNWYWx1ZSwgb2JqZWN0W2tleV0sIHVuZGVmaW5lZCwgdHJ1ZSk7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLm1lcmdlYCB3aXRob3V0IHN1cHBvcnQgZm9yIGFyZ3VtZW50IGp1Z2dsaW5nLA0KICAgICAqIG11bHRpcGxlIHNvdXJjZXMsIGFuZCBgdGhpc2AgYmluZGluZyBgY3VzdG9taXplcmAgZnVuY3Rpb25zLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuDQogICAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgc291cmNlIG9iamVjdC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBtZXJnaW5nIHByb3BlcnRpZXMuDQogICAgICogQHBhcmFtIHtBcnJheX0gW3N0YWNrQT1bXV0gVHJhY2tzIHRyYXZlcnNlZCBzb3VyY2Ugb2JqZWN0cy4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbc3RhY2tCPVtdXSBBc3NvY2lhdGVzIHZhbHVlcyB3aXRoIHNvdXJjZSBjb3VudGVycGFydHMuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlTWVyZ2Uob2JqZWN0LCBzb3VyY2UsIGN1c3RvbWl6ZXIsIHN0YWNrQSwgc3RhY2tCKSB7DQogICAgICBpZiAoIWlzT2JqZWN0KG9iamVjdCkpIHsNCiAgICAgICAgcmV0dXJuIG9iamVjdDsNCiAgICAgIH0NCiAgICAgIHZhciBpc1NyY0FyciA9IGlzQXJyYXlMaWtlKHNvdXJjZSkgJiYgKGlzQXJyYXkoc291cmNlKSB8fCBpc1R5cGVkQXJyYXkoc291cmNlKSksDQogICAgICAgICAgcHJvcHMgPSBpc1NyY0FyciA/IG51bGwgOiBrZXlzKHNvdXJjZSk7DQoNCiAgICAgIGFycmF5RWFjaChwcm9wcyB8fCBzb3VyY2UsIGZ1bmN0aW9uKHNyY1ZhbHVlLCBrZXkpIHsNCiAgICAgICAgaWYgKHByb3BzKSB7DQogICAgICAgICAga2V5ID0gc3JjVmFsdWU7DQogICAgICAgICAgc3JjVmFsdWUgPSBzb3VyY2Vba2V5XTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNPYmplY3RMaWtlKHNyY1ZhbHVlKSkgew0KICAgICAgICAgIHN0YWNrQSB8fCAoc3RhY2tBID0gW10pOw0KICAgICAgICAgIHN0YWNrQiB8fCAoc3RhY2tCID0gW10pOw0KICAgICAgICAgIGJhc2VNZXJnZURlZXAob2JqZWN0LCBzb3VyY2UsIGtleSwgYmFzZU1lcmdlLCBjdXN0b21pemVyLCBzdGFja0EsIHN0YWNrQik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgdmFyIHZhbHVlID0gb2JqZWN0W2tleV0sDQogICAgICAgICAgICAgIHJlc3VsdCA9IGN1c3RvbWl6ZXIgPyBjdXN0b21pemVyKHZhbHVlLCBzcmNWYWx1ZSwga2V5LCBvYmplY3QsIHNvdXJjZSkgOiB1bmRlZmluZWQsDQogICAgICAgICAgICAgIGlzQ29tbW9uID0gcmVzdWx0ID09PSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICBpZiAoaXNDb21tb24pIHsNCiAgICAgICAgICAgIHJlc3VsdCA9IHNyY1ZhbHVlOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoKHJlc3VsdCAhPT0gdW5kZWZpbmVkIHx8IChpc1NyY0FyciAmJiAhKGtleSBpbiBvYmplY3QpKSkgJiYNCiAgICAgICAgICAgICAgKGlzQ29tbW9uIHx8IChyZXN1bHQgPT09IHJlc3VsdCA/IChyZXN1bHQgIT09IHZhbHVlKSA6ICh2YWx1ZSA9PT0gdmFsdWUpKSkpIHsNCiAgICAgICAgICAgIG9iamVjdFtrZXldID0gcmVzdWx0Ow0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgICByZXR1cm4gb2JqZWN0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZU1lcmdlYCBmb3IgYXJyYXlzIGFuZCBvYmplY3RzIHdoaWNoIHBlcmZvcm1zDQogICAgICogZGVlcCBtZXJnZXMgYW5kIHRyYWNrcyB0cmF2ZXJzZWQgb2JqZWN0cyBlbmFibGluZyBvYmplY3RzIHdpdGggY2lyY3VsYXINCiAgICAgKiByZWZlcmVuY2VzIHRvIGJlIG1lcmdlZC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgZGVzdGluYXRpb24gb2JqZWN0Lg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIHNvdXJjZSBvYmplY3QuDQogICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBtZXJnZS4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBtZXJnZUZ1bmMgVGhlIGZ1bmN0aW9uIHRvIG1lcmdlIHZhbHVlcy4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBtZXJnaW5nIHByb3BlcnRpZXMuDQogICAgICogQHBhcmFtIHtBcnJheX0gW3N0YWNrQT1bXV0gVHJhY2tzIHRyYXZlcnNlZCBzb3VyY2Ugb2JqZWN0cy4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbc3RhY2tCPVtdXSBBc3NvY2lhdGVzIHZhbHVlcyB3aXRoIHNvdXJjZSBjb3VudGVycGFydHMuDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBvYmplY3RzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZU1lcmdlRGVlcChvYmplY3QsIHNvdXJjZSwga2V5LCBtZXJnZUZ1bmMsIGN1c3RvbWl6ZXIsIHN0YWNrQSwgc3RhY2tCKSB7DQogICAgICB2YXIgbGVuZ3RoID0gc3RhY2tBLmxlbmd0aCwNCiAgICAgICAgICBzcmNWYWx1ZSA9IHNvdXJjZVtrZXldOw0KDQogICAgICB3aGlsZSAobGVuZ3RoLS0pIHsNCiAgICAgICAgaWYgKHN0YWNrQVtsZW5ndGhdID09IHNyY1ZhbHVlKSB7DQogICAgICAgICAgb2JqZWN0W2tleV0gPSBzdGFja0JbbGVuZ3RoXTsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHZhciB2YWx1ZSA9IG9iamVjdFtrZXldLA0KICAgICAgICAgIHJlc3VsdCA9IGN1c3RvbWl6ZXIgPyBjdXN0b21pemVyKHZhbHVlLCBzcmNWYWx1ZSwga2V5LCBvYmplY3QsIHNvdXJjZSkgOiB1bmRlZmluZWQsDQogICAgICAgICAgaXNDb21tb24gPSByZXN1bHQgPT09IHVuZGVmaW5lZDsNCg0KICAgICAgaWYgKGlzQ29tbW9uKSB7DQogICAgICAgIHJlc3VsdCA9IHNyY1ZhbHVlOw0KICAgICAgICBpZiAoaXNBcnJheUxpa2Uoc3JjVmFsdWUpICYmIChpc0FycmF5KHNyY1ZhbHVlKSB8fCBpc1R5cGVkQXJyYXkoc3JjVmFsdWUpKSkgew0KICAgICAgICAgIHJlc3VsdCA9IGlzQXJyYXkodmFsdWUpDQogICAgICAgICAgICA/IHZhbHVlDQogICAgICAgICAgICA6IChpc0FycmF5TGlrZSh2YWx1ZSkgPyBhcnJheUNvcHkodmFsdWUpIDogW10pOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGlzUGxhaW5PYmplY3Qoc3JjVmFsdWUpIHx8IGlzQXJndW1lbnRzKHNyY1ZhbHVlKSkgew0KICAgICAgICAgIHJlc3VsdCA9IGlzQXJndW1lbnRzKHZhbHVlKQ0KICAgICAgICAgICAgPyB0b1BsYWluT2JqZWN0KHZhbHVlKQ0KICAgICAgICAgICAgOiAoaXNQbGFpbk9iamVjdCh2YWx1ZSkgPyB2YWx1ZSA6IHt9KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICBpc0NvbW1vbiA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvLyBBZGQgdGhlIHNvdXJjZSB2YWx1ZSB0byB0aGUgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHMgYW5kIGFzc29jaWF0ZQ0KICAgICAgLy8gaXQgd2l0aCBpdHMgbWVyZ2VkIHZhbHVlLg0KICAgICAgc3RhY2tBLnB1c2goc3JjVmFsdWUpOw0KICAgICAgc3RhY2tCLnB1c2gocmVzdWx0KTsNCg0KICAgICAgaWYgKGlzQ29tbW9uKSB7DQogICAgICAgIC8vIFJlY3Vyc2l2ZWx5IG1lcmdlIG9iamVjdHMgYW5kIGFycmF5cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLg0KICAgICAgICBvYmplY3Rba2V5XSA9IG1lcmdlRnVuYyhyZXN1bHQsIHNyY1ZhbHVlLCBjdXN0b21pemVyLCBzdGFja0EsIHN0YWNrQik7DQogICAgICB9IGVsc2UgaWYgKHJlc3VsdCA9PT0gcmVzdWx0ID8gKHJlc3VsdCAhPT0gdmFsdWUpIDogKHZhbHVlID09PSB2YWx1ZSkpIHsNCiAgICAgICAgb2JqZWN0W2tleV0gPSByZXN1bHQ7DQogICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ucHJvcGVydHlgIHdpdGhvdXQgc3VwcG9ydCBmb3IgZGVlcCBwYXRocy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBwcm9wZXJ0eSB0byBnZXQuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZVByb3BlcnR5KGtleSkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkgew0KICAgICAgICByZXR1cm4gb2JqZWN0ID09IG51bGwgPyB1bmRlZmluZWQgOiBvYmplY3Rba2V5XTsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlUHJvcGVydHlgIHdoaWNoIHN1cHBvcnRzIGRlZXAgcGF0aHMuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIG9mIHRoZSBwcm9wZXJ0eSB0byBnZXQuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZVByb3BlcnR5RGVlcChwYXRoKSB7DQogICAgICB2YXIgcGF0aEtleSA9IChwYXRoICsgJycpOw0KICAgICAgcGF0aCA9IHRvUGF0aChwYXRoKTsNCiAgICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHsNCiAgICAgICAgcmV0dXJuIGJhc2VHZXQob2JqZWN0LCBwYXRoLCBwYXRoS2V5KTsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ucHVsbEF0YCB3aXRob3V0IHN1cHBvcnQgZm9yIGluZGl2aWR1YWwNCiAgICAgKiBpbmRleCBhcmd1bWVudHMgYW5kIGNhcHR1cmluZyB0aGUgcmVtb3ZlZCBlbGVtZW50cy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS4NCiAgICAgKiBAcGFyYW0ge251bWJlcltdfSBpbmRleGVzIFRoZSBpbmRleGVzIG9mIGVsZW1lbnRzIHRvIHJlbW92ZS4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlUHVsbEF0KGFycmF5LCBpbmRleGVzKSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBpbmRleGVzLmxlbmd0aCA6IDA7DQogICAgICB3aGlsZSAobGVuZ3RoLS0pIHsNCiAgICAgICAgdmFyIGluZGV4ID0gaW5kZXhlc1tsZW5ndGhdOw0KICAgICAgICBpZiAoaW5kZXggIT0gcHJldmlvdXMgJiYgaXNJbmRleChpbmRleCkpIHsNCiAgICAgICAgICB2YXIgcHJldmlvdXMgPSBpbmRleDsNCiAgICAgICAgICBzcGxpY2UuY2FsbChhcnJheSwgaW5kZXgsIDEpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gYXJyYXk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ucmFuZG9tYCB3aXRob3V0IHN1cHBvcnQgZm9yIGFyZ3VtZW50IGp1Z2dsaW5nDQogICAgICogYW5kIHJldHVybmluZyBmbG9hdGluZy1wb2ludCBudW1iZXJzLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbWluIFRoZSBtaW5pbXVtIHBvc3NpYmxlIHZhbHVlLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtYXggVGhlIG1heGltdW0gcG9zc2libGUgdmFsdWUuDQogICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgcmFuZG9tIG51bWJlci4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlUmFuZG9tKG1pbiwgbWF4KSB7DQogICAgICByZXR1cm4gbWluICsgZmxvb3IobmF0aXZlUmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnJlZHVjZWAgYW5kIGBfLnJlZHVjZVJpZ2h0YCB3aXRob3V0IHN1cHBvcnQNCiAgICAgKiBmb3IgY2FsbGJhY2sgc2hvcnRoYW5kcyBhbmQgYHRoaXNgIGJpbmRpbmcsIHdoaWNoIGl0ZXJhdGVzIG92ZXIgYGNvbGxlY3Rpb25gDQogICAgICogdXNpbmcgdGhlIHByb3ZpZGVkIGBlYWNoRnVuY2AuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IGFjY3VtdWxhdG9yIFRoZSBpbml0aWFsIHZhbHVlLg0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaW5pdEZyb21Db2xsZWN0aW9uIFNwZWNpZnkgdXNpbmcgdGhlIGZpcnN0IG9yIGxhc3QgZWxlbWVudA0KICAgICAqICBvZiBgY29sbGVjdGlvbmAgYXMgdGhlIGluaXRpYWwgdmFsdWUuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZWFjaEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGl0ZXJhdGUgb3ZlciBgY29sbGVjdGlvbmAuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGFjY3VtdWxhdGVkIHZhbHVlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VSZWR1Y2UoY29sbGVjdGlvbiwgaXRlcmF0ZWUsIGFjY3VtdWxhdG9yLCBpbml0RnJvbUNvbGxlY3Rpb24sIGVhY2hGdW5jKSB7DQogICAgICBlYWNoRnVuYyhjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHsNCiAgICAgICAgYWNjdW11bGF0b3IgPSBpbml0RnJvbUNvbGxlY3Rpb24NCiAgICAgICAgICA/IChpbml0RnJvbUNvbGxlY3Rpb24gPSBmYWxzZSwgdmFsdWUpDQogICAgICAgICAgOiBpdGVyYXRlZShhY2N1bXVsYXRvciwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBzZXREYXRhYCB3aXRob3V0IHN1cHBvcnQgZm9yIGhvdCBsb29wIGRldGVjdGlvbi4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYXNzb2NpYXRlIG1ldGFkYXRhIHdpdGguDQogICAgICogQHBhcmFtIHsqfSBkYXRhIFRoZSBtZXRhZGF0YS4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgYGZ1bmNgLg0KICAgICAqLw0KICAgIHZhciBiYXNlU2V0RGF0YSA9ICFtZXRhTWFwID8gaWRlbnRpdHkgOiBmdW5jdGlvbihmdW5jLCBkYXRhKSB7DQogICAgICBtZXRhTWFwLnNldChmdW5jLCBkYXRhKTsNCiAgICAgIHJldHVybiBmdW5jOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5zbGljZWAgd2l0aG91dCBhbiBpdGVyYXRlZSBjYWxsIGd1YXJkLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gc2xpY2UuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtzdGFydD0wXSBUaGUgc3RhcnQgcG9zaXRpb24uDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtlbmQ9YXJyYXkubGVuZ3RoXSBUaGUgZW5kIHBvc2l0aW9uLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlU2xpY2UoYXJyYXksIHN0YXJ0LCBlbmQpIHsNCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsNCg0KICAgICAgc3RhcnQgPSBzdGFydCA9PSBudWxsID8gMCA6ICgrc3RhcnQgfHwgMCk7DQogICAgICBpZiAoc3RhcnQgPCAwKSB7DQogICAgICAgIHN0YXJ0ID0gLXN0YXJ0ID4gbGVuZ3RoID8gMCA6IChsZW5ndGggKyBzdGFydCk7DQogICAgICB9DQogICAgICBlbmQgPSAoZW5kID09PSB1bmRlZmluZWQgfHwgZW5kID4gbGVuZ3RoKSA/IGxlbmd0aCA6ICgrZW5kIHx8IDApOw0KICAgICAgaWYgKGVuZCA8IDApIHsNCiAgICAgICAgZW5kICs9IGxlbmd0aDsNCiAgICAgIH0NCiAgICAgIGxlbmd0aCA9IHN0YXJ0ID4gZW5kID8gMCA6ICgoZW5kIC0gc3RhcnQpID4+PiAwKTsNCiAgICAgIHN0YXJ0ID4+Pj0gMDsNCg0KICAgICAgdmFyIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7DQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICByZXN1bHRbaW5kZXhdID0gYXJyYXlbaW5kZXggKyBzdGFydF07DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnNvbWVgIHdpdGhvdXQgc3VwcG9ydCBmb3IgY2FsbGJhY2sgc2hvcnRoYW5kcw0KICAgICAqIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW55IGVsZW1lbnQgcGFzc2VzIHRoZSBwcmVkaWNhdGUgY2hlY2ssDQogICAgICogIGVsc2UgYGZhbHNlYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlU29tZShjb2xsZWN0aW9uLCBwcmVkaWNhdGUpIHsNCiAgICAgIHZhciByZXN1bHQ7DQoNCiAgICAgIGJhc2VFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikgew0KICAgICAgICByZXN1bHQgPSBwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsNCiAgICAgICAgcmV0dXJuICFyZXN1bHQ7DQogICAgICB9KTsNCiAgICAgIHJldHVybiAhIXJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5zb3J0QnlgIHdoaWNoIHVzZXMgYGNvbXBhcmVyYCB0byBkZWZpbmUNCiAgICAgKiB0aGUgc29ydCBvcmRlciBvZiBgYXJyYXlgIGFuZCByZXBsYWNlcyBjcml0ZXJpYSBvYmplY3RzIHdpdGggdGhlaXINCiAgICAgKiBjb3JyZXNwb25kaW5nIHZhbHVlcy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHNvcnQuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29tcGFyZXIgVGhlIGZ1bmN0aW9uIHRvIGRlZmluZSBzb3J0IG9yZGVyLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VTb3J0QnkoYXJyYXksIGNvbXBhcmVyKSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOw0KDQogICAgICBhcnJheS5zb3J0KGNvbXBhcmVyKTsNCiAgICAgIHdoaWxlIChsZW5ndGgtLSkgew0KICAgICAgICBhcnJheVtsZW5ndGhdID0gYXJyYXlbbGVuZ3RoXS52YWx1ZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBhcnJheTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5zb3J0QnlPcmRlcmAgd2l0aG91dCBwYXJhbSBndWFyZHMuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbltdfE9iamVjdFtdfHN0cmluZ1tdfSBpdGVyYXRlZXMgVGhlIGl0ZXJhdGVlcyB0byBzb3J0IGJ5Lg0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbltdfSBvcmRlcnMgVGhlIHNvcnQgb3JkZXJzIG9mIGBpdGVyYXRlZXNgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IHNvcnRlZCBhcnJheS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlU29ydEJ5T3JkZXIoY29sbGVjdGlvbiwgaXRlcmF0ZWVzLCBvcmRlcnMpIHsNCiAgICAgIHZhciBjYWxsYmFjayA9IGdldENhbGxiYWNrKCksDQogICAgICAgICAgaW5kZXggPSAtMTsNCg0KICAgICAgaXRlcmF0ZWVzID0gYXJyYXlNYXAoaXRlcmF0ZWVzLCBmdW5jdGlvbihpdGVyYXRlZSkgeyByZXR1cm4gY2FsbGJhY2soaXRlcmF0ZWUpOyB9KTsNCg0KICAgICAgdmFyIHJlc3VsdCA9IGJhc2VNYXAoY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUpIHsNCiAgICAgICAgdmFyIGNyaXRlcmlhID0gYXJyYXlNYXAoaXRlcmF0ZWVzLCBmdW5jdGlvbihpdGVyYXRlZSkgeyByZXR1cm4gaXRlcmF0ZWUodmFsdWUpOyB9KTsNCiAgICAgICAgcmV0dXJuIHsgJ2NyaXRlcmlhJzogY3JpdGVyaWEsICdpbmRleCc6ICsraW5kZXgsICd2YWx1ZSc6IHZhbHVlIH07DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIGJhc2VTb3J0QnkocmVzdWx0LCBmdW5jdGlvbihvYmplY3QsIG90aGVyKSB7DQogICAgICAgIHJldHVybiBjb21wYXJlTXVsdGlwbGUob2JqZWN0LCBvdGhlciwgb3JkZXJzKTsNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnN1bWAgd2l0aG91dCBzdXBwb3J0IGZvciBjYWxsYmFjayBzaG9ydGhhbmRzDQogICAgICogYW5kIGB0aGlzYCBiaW5kaW5nLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgc3VtLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VTdW0oY29sbGVjdGlvbiwgaXRlcmF0ZWUpIHsNCiAgICAgIHZhciByZXN1bHQgPSAwOw0KICAgICAgYmFzZUVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7DQogICAgICAgIHJlc3VsdCArPSAraXRlcmF0ZWUodmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB8fCAwOw0KICAgICAgfSk7DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnVuaXFgIHdpdGhvdXQgc3VwcG9ydCBmb3IgY2FsbGJhY2sgc2hvcnRoYW5kcw0KICAgICAqIGFuZCBgdGhpc2AgYmluZGluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlXSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGR1cGxpY2F0ZS12YWx1ZS1mcmVlIGFycmF5Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VVbmlxKGFycmF5LCBpdGVyYXRlZSkgew0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgaW5kZXhPZiA9IGdldEluZGV4T2YoKSwNCiAgICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsDQogICAgICAgICAgaXNDb21tb24gPSBpbmRleE9mID09IGJhc2VJbmRleE9mLA0KICAgICAgICAgIGlzTGFyZ2UgPSBpc0NvbW1vbiAmJiBsZW5ndGggPj0gMjAwLA0KICAgICAgICAgIHNlZW4gPSBpc0xhcmdlID8gY3JlYXRlQ2FjaGUoKSA6IG51bGwsDQogICAgICAgICAgcmVzdWx0ID0gW107DQoNCiAgICAgIGlmIChzZWVuKSB7DQogICAgICAgIGluZGV4T2YgPSBjYWNoZUluZGV4T2Y7DQogICAgICAgIGlzQ29tbW9uID0gZmFsc2U7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpc0xhcmdlID0gZmFsc2U7DQogICAgICAgIHNlZW4gPSBpdGVyYXRlZSA/IFtdIDogcmVzdWx0Ow0KICAgICAgfQ0KICAgICAgb3V0ZXI6DQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF0sDQogICAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID8gaXRlcmF0ZWUodmFsdWUsIGluZGV4LCBhcnJheSkgOiB2YWx1ZTsNCg0KICAgICAgICBpZiAoaXNDb21tb24gJiYgdmFsdWUgPT09IHZhbHVlKSB7DQogICAgICAgICAgdmFyIHNlZW5JbmRleCA9IHNlZW4ubGVuZ3RoOw0KICAgICAgICAgIHdoaWxlIChzZWVuSW5kZXgtLSkgew0KICAgICAgICAgICAgaWYgKHNlZW5bc2VlbkluZGV4XSA9PT0gY29tcHV0ZWQpIHsNCiAgICAgICAgICAgICAgY29udGludWUgb3V0ZXI7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChpdGVyYXRlZSkgew0KICAgICAgICAgICAgc2Vlbi5wdXNoKGNvbXB1dGVkKTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGluZGV4T2Yoc2VlbiwgY29tcHV0ZWQsIDApIDwgMCkgew0KICAgICAgICAgIGlmIChpdGVyYXRlZSB8fCBpc0xhcmdlKSB7DQogICAgICAgICAgICBzZWVuLnB1c2goY29tcHV0ZWQpOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8udmFsdWVzYCBhbmQgYF8udmFsdWVzSW5gIHdoaWNoIGNyZWF0ZXMgYW4NCiAgICAgKiBhcnJheSBvZiBgb2JqZWN0YCBwcm9wZXJ0eSB2YWx1ZXMgY29ycmVzcG9uZGluZyB0byB0aGUgcHJvcGVydHkgbmFtZXMNCiAgICAgKiBvZiBgcHJvcHNgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuDQogICAgICogQHBhcmFtIHtBcnJheX0gcHJvcHMgVGhlIHByb3BlcnR5IG5hbWVzIHRvIGdldCB2YWx1ZXMgZm9yLg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IHZhbHVlcy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYXNlVmFsdWVzKG9iamVjdCwgcHJvcHMpIHsNCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aCwNCiAgICAgICAgICByZXN1bHQgPSBBcnJheShsZW5ndGgpOw0KDQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICByZXN1bHRbaW5kZXhdID0gb2JqZWN0W3Byb3BzW2luZGV4XV07DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmRyb3BSaWdodFdoaWxlYCwgYF8uZHJvcFdoaWxlYCwgYF8udGFrZVJpZ2h0V2hpbGVgLA0KICAgICAqIGFuZCBgXy50YWtlV2hpbGVgIHdpdGhvdXQgc3VwcG9ydCBmb3IgY2FsbGJhY2sgc2hvcnRoYW5kcyBhbmQgYHRoaXNgIGJpbmRpbmcuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0Ryb3BdIFNwZWNpZnkgZHJvcHBpbmcgZWxlbWVudHMgaW5zdGVhZCBvZiB0YWtpbmcgdGhlbS4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtmcm9tUmlnaHRdIFNwZWNpZnkgaXRlcmF0aW5nIGZyb20gcmlnaHQgdG8gbGVmdC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuDQogICAgICovDQogICAgZnVuY3Rpb24gYmFzZVdoaWxlKGFycmF5LCBwcmVkaWNhdGUsIGlzRHJvcCwgZnJvbVJpZ2h0KSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLA0KICAgICAgICAgIGluZGV4ID0gZnJvbVJpZ2h0ID8gbGVuZ3RoIDogLTE7DQoNCiAgICAgIHdoaWxlICgoZnJvbVJpZ2h0ID8gaW5kZXgtLSA6ICsraW5kZXggPCBsZW5ndGgpICYmIHByZWRpY2F0ZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSkpIHt9DQogICAgICByZXR1cm4gaXNEcm9wDQogICAgICAgID8gYmFzZVNsaWNlKGFycmF5LCAoZnJvbVJpZ2h0ID8gMCA6IGluZGV4KSwgKGZyb21SaWdodCA/IGluZGV4ICsgMSA6IGxlbmd0aCkpDQogICAgICAgIDogYmFzZVNsaWNlKGFycmF5LCAoZnJvbVJpZ2h0ID8gaW5kZXggKyAxIDogMCksIChmcm9tUmlnaHQgPyBsZW5ndGggOiBpbmRleCkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGB3cmFwcGVyVmFsdWVgIHdoaWNoIHJldHVybnMgdGhlIHJlc3VsdCBvZg0KICAgICAqIHBlcmZvcm1pbmcgYSBzZXF1ZW5jZSBvZiBhY3Rpb25zIG9uIHRoZSB1bndyYXBwZWQgYHZhbHVlYCwgd2hlcmUgZWFjaA0KICAgICAqIHN1Y2Nlc3NpdmUgYWN0aW9uIGlzIHN1cHBsaWVkIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIHByZXZpb3VzLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB1bndyYXBwZWQgdmFsdWUuDQogICAgICogQHBhcmFtIHtBcnJheX0gYWN0aW9ucyBBY3Rpb25zIHRvIHBlZm9ybSB0byByZXNvbHZlIHRoZSB1bndyYXBwZWQgdmFsdWUuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHJlc29sdmVkIHZhbHVlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJhc2VXcmFwcGVyVmFsdWUodmFsdWUsIGFjdGlvbnMpIHsNCiAgICAgIHZhciByZXN1bHQgPSB2YWx1ZTsNCiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBMYXp5V3JhcHBlcikgew0KICAgICAgICByZXN1bHQgPSByZXN1bHQudmFsdWUoKTsNCiAgICAgIH0NCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IGFjdGlvbnMubGVuZ3RoOw0KDQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICB2YXIgYXJncyA9IFtyZXN1bHRdLA0KICAgICAgICAgICAgYWN0aW9uID0gYWN0aW9uc1tpbmRleF07DQoNCiAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhY3Rpb24uYXJncyk7DQogICAgICAgIHJlc3VsdCA9IGFjdGlvbi5mdW5jLmFwcGx5KGFjdGlvbi50aGlzQXJnLCBhcmdzKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUGVyZm9ybXMgYSBiaW5hcnkgc2VhcmNoIG9mIGBhcnJheWAgdG8gZGV0ZXJtaW5lIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgDQogICAgICogc2hvdWxkIGJlIGluc2VydGVkIGludG8gYGFycmF5YCBpbiBvcmRlciB0byBtYWludGFpbiBpdHMgc29ydCBvcmRlci4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIHNvcnRlZCBhcnJheSB0byBpbnNwZWN0Lg0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGV2YWx1YXRlLg0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3JldEhpZ2hlc3RdIFNwZWNpZnkgcmV0dXJuaW5nIHRoZSBoaWdoZXN0IHF1YWxpZmllZCBpbmRleC4NCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgIHNob3VsZCBiZSBpbnNlcnRlZA0KICAgICAqICBpbnRvIGBhcnJheWAuDQogICAgICovDQogICAgZnVuY3Rpb24gYmluYXJ5SW5kZXgoYXJyYXksIHZhbHVlLCByZXRIaWdoZXN0KSB7DQogICAgICB2YXIgbG93ID0gMCwNCiAgICAgICAgICBoaWdoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiBsb3c7DQoNCiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgJiYgdmFsdWUgPT09IHZhbHVlICYmIGhpZ2ggPD0gSEFMRl9NQVhfQVJSQVlfTEVOR1RIKSB7DQogICAgICAgIHdoaWxlIChsb3cgPCBoaWdoKSB7DQogICAgICAgICAgdmFyIG1pZCA9IChsb3cgKyBoaWdoKSA+Pj4gMSwNCiAgICAgICAgICAgICAgY29tcHV0ZWQgPSBhcnJheVttaWRdOw0KDQogICAgICAgICAgaWYgKChyZXRIaWdoZXN0ID8gKGNvbXB1dGVkIDw9IHZhbHVlKSA6IChjb21wdXRlZCA8IHZhbHVlKSkgJiYgY29tcHV0ZWQgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGxvdyA9IG1pZCArIDE7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGhpZ2ggPSBtaWQ7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBoaWdoOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGJpbmFyeUluZGV4QnkoYXJyYXksIHZhbHVlLCBpZGVudGl0eSwgcmV0SGlnaGVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhpcyBmdW5jdGlvbiBpcyBsaWtlIGBiaW5hcnlJbmRleGAgZXhjZXB0IHRoYXQgaXQgaW52b2tlcyBgaXRlcmF0ZWVgIGZvcg0KICAgICAqIGB2YWx1ZWAgYW5kIGVhY2ggZWxlbWVudCBvZiBgYXJyYXlgIHRvIGNvbXB1dGUgdGhlaXIgc29ydCByYW5raW5nLiBUaGUNCiAgICAgKiBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OyAodmFsdWUpLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgc29ydGVkIGFycmF5IHRvIGluc3BlY3QuDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gZXZhbHVhdGUuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtyZXRIaWdoZXN0XSBTcGVjaWZ5IHJldHVybmluZyB0aGUgaGlnaGVzdCBxdWFsaWZpZWQgaW5kZXguDQogICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWQNCiAgICAgKiAgaW50byBgYXJyYXlgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJpbmFyeUluZGV4QnkoYXJyYXksIHZhbHVlLCBpdGVyYXRlZSwgcmV0SGlnaGVzdCkgew0KICAgICAgdmFsdWUgPSBpdGVyYXRlZSh2YWx1ZSk7DQoNCiAgICAgIHZhciBsb3cgPSAwLA0KICAgICAgICAgIGhpZ2ggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDAsDQogICAgICAgICAgdmFsSXNOYU4gPSB2YWx1ZSAhPT0gdmFsdWUsDQogICAgICAgICAgdmFsSXNOdWxsID0gdmFsdWUgPT09IG51bGwsDQogICAgICAgICAgdmFsSXNVbmRlZiA9IHZhbHVlID09PSB1bmRlZmluZWQ7DQoNCiAgICAgIHdoaWxlIChsb3cgPCBoaWdoKSB7DQogICAgICAgIHZhciBtaWQgPSBmbG9vcigobG93ICsgaGlnaCkgLyAyKSwNCiAgICAgICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUoYXJyYXlbbWlkXSksDQogICAgICAgICAgICBpc0RlZiA9IGNvbXB1dGVkICE9PSB1bmRlZmluZWQsDQogICAgICAgICAgICBpc1JlZmxleGl2ZSA9IGNvbXB1dGVkID09PSBjb21wdXRlZDsNCg0KICAgICAgICBpZiAodmFsSXNOYU4pIHsNCiAgICAgICAgICB2YXIgc2V0TG93ID0gaXNSZWZsZXhpdmUgfHwgcmV0SGlnaGVzdDsNCiAgICAgICAgfSBlbHNlIGlmICh2YWxJc051bGwpIHsNCiAgICAgICAgICBzZXRMb3cgPSBpc1JlZmxleGl2ZSAmJiBpc0RlZiAmJiAocmV0SGlnaGVzdCB8fCBjb21wdXRlZCAhPSBudWxsKTsNCiAgICAgICAgfSBlbHNlIGlmICh2YWxJc1VuZGVmKSB7DQogICAgICAgICAgc2V0TG93ID0gaXNSZWZsZXhpdmUgJiYgKHJldEhpZ2hlc3QgfHwgaXNEZWYpOw0KICAgICAgICB9IGVsc2UgaWYgKGNvbXB1dGVkID09IG51bGwpIHsNCiAgICAgICAgICBzZXRMb3cgPSBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzZXRMb3cgPSByZXRIaWdoZXN0ID8gKGNvbXB1dGVkIDw9IHZhbHVlKSA6IChjb21wdXRlZCA8IHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2V0TG93KSB7DQogICAgICAgICAgbG93ID0gbWlkICsgMTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBoaWdoID0gbWlkOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gbmF0aXZlTWluKGhpZ2gsIE1BWF9BUlJBWV9JTkRFWCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlQ2FsbGJhY2tgIHdoaWNoIG9ubHkgc3VwcG9ydHMgYHRoaXNgIGJpbmRpbmcNCiAgICAgKiBhbmQgc3BlY2lmeWluZyB0aGUgbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBwcm92aWRlIHRvIGBmdW5jYC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYmluZC4NCiAgICAgKiBAcGFyYW0geyp9IHRoaXNBcmcgVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBmdW5jYC4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2FyZ0NvdW50XSBUaGUgbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBwcm92aWRlIHRvIGBmdW5jYC4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIGNhbGxiYWNrLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJpbmRDYWxsYmFjayhmdW5jLCB0aGlzQXJnLCBhcmdDb3VudCkgew0KICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsNCiAgICAgICAgcmV0dXJuIGlkZW50aXR5Ow0KICAgICAgfQ0KICAgICAgaWYgKHRoaXNBcmcgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICByZXR1cm4gZnVuYzsNCiAgICAgIH0NCiAgICAgIHN3aXRjaCAoYXJnQ291bnQpIHsNCiAgICAgICAgY2FzZSAxOiByZXR1cm4gZnVuY3Rpb24odmFsdWUpIHsNCiAgICAgICAgICByZXR1cm4gZnVuYy5jYWxsKHRoaXNBcmcsIHZhbHVlKTsNCiAgICAgICAgfTsNCiAgICAgICAgY2FzZSAzOiByZXR1cm4gZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7DQogICAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCB2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pOw0KICAgICAgICB9Ow0KICAgICAgICBjYXNlIDQ6IHJldHVybiBmdW5jdGlvbihhY2N1bXVsYXRvciwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7DQogICAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCBhY2N1bXVsYXRvciwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsNCiAgICAgICAgfTsNCiAgICAgICAgY2FzZSA1OiByZXR1cm4gZnVuY3Rpb24odmFsdWUsIG90aGVyLCBrZXksIG9iamVjdCwgc291cmNlKSB7DQogICAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCB2YWx1ZSwgb3RoZXIsIGtleSwgb2JqZWN0LCBzb3VyY2UpOw0KICAgICAgICB9Ow0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzQXJnLCBhcmd1bWVudHMpOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgdGhlIGdpdmVuIGFycmF5IGJ1ZmZlci4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtBcnJheUJ1ZmZlcn0gYnVmZmVyIFRoZSBhcnJheSBidWZmZXIgdG8gY2xvbmUuDQogICAgICogQHJldHVybnMge0FycmF5QnVmZmVyfSBSZXR1cm5zIHRoZSBjbG9uZWQgYXJyYXkgYnVmZmVyLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJ1ZmZlckNsb25lKGJ1ZmZlcikgew0KICAgICAgcmV0dXJuIGJ1ZmZlclNsaWNlLmNhbGwoYnVmZmVyLCAwKTsNCiAgICB9DQogICAgaWYgKCFidWZmZXJTbGljZSkgew0KICAgICAgLy8gUGhhbnRvbUpTIGhhcyBgQXJyYXlCdWZmZXJgIGFuZCBgVWludDhBcnJheWAgYnV0IG5vdCBgRmxvYXQ2NEFycmF5YC4NCiAgICAgIGJ1ZmZlckNsb25lID0gIShBcnJheUJ1ZmZlciAmJiBVaW50OEFycmF5KSA/IGNvbnN0YW50KG51bGwpIDogZnVuY3Rpb24oYnVmZmVyKSB7DQogICAgICAgIHZhciBieXRlTGVuZ3RoID0gYnVmZmVyLmJ5dGVMZW5ndGgsDQogICAgICAgICAgICBmbG9hdExlbmd0aCA9IEZsb2F0NjRBcnJheSA/IGZsb29yKGJ5dGVMZW5ndGggLyBGTE9BVDY0X0JZVEVTX1BFUl9FTEVNRU5UKSA6IDAsDQogICAgICAgICAgICBvZmZzZXQgPSBmbG9hdExlbmd0aCAqIEZMT0FUNjRfQllURVNfUEVSX0VMRU1FTlQsDQogICAgICAgICAgICByZXN1bHQgPSBuZXcgQXJyYXlCdWZmZXIoYnl0ZUxlbmd0aCk7DQoNCiAgICAgICAgaWYgKGZsb2F0TGVuZ3RoKSB7DQogICAgICAgICAgdmFyIHZpZXcgPSBuZXcgRmxvYXQ2NEFycmF5KHJlc3VsdCwgMCwgZmxvYXRMZW5ndGgpOw0KICAgICAgICAgIHZpZXcuc2V0KG5ldyBGbG9hdDY0QXJyYXkoYnVmZmVyLCAwLCBmbG9hdExlbmd0aCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChieXRlTGVuZ3RoICE9IG9mZnNldCkgew0KICAgICAgICAgIHZpZXcgPSBuZXcgVWludDhBcnJheShyZXN1bHQsIG9mZnNldCk7DQogICAgICAgICAgdmlldy5zZXQobmV3IFVpbnQ4QXJyYXkoYnVmZmVyLCBvZmZzZXQpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IHRoYXQgaXMgdGhlIGNvbXBvc2l0aW9uIG9mIHBhcnRpYWxseSBhcHBsaWVkIGFyZ3VtZW50cywNCiAgICAgKiBwbGFjZWhvbGRlcnMsIGFuZCBwcm92aWRlZCBhcmd1bWVudHMgaW50byBhIHNpbmdsZSBhcnJheSBvZiBhcmd1bWVudHMuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBhcmdzIFRoZSBwcm92aWRlZCBhcmd1bWVudHMuDQogICAgICogQHBhcmFtIHtBcnJheX0gcGFydGlhbHMgVGhlIGFyZ3VtZW50cyB0byBwcmVwZW5kIHRvIHRob3NlIHByb3ZpZGVkLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGhvbGRlcnMgVGhlIGBwYXJ0aWFsc2AgcGxhY2Vob2xkZXIgaW5kZXhlcy4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjb21wb3NlZCBhcmd1bWVudHMuDQogICAgICovDQogICAgZnVuY3Rpb24gY29tcG9zZUFyZ3MoYXJncywgcGFydGlhbHMsIGhvbGRlcnMpIHsNCiAgICAgIHZhciBob2xkZXJzTGVuZ3RoID0gaG9sZGVycy5sZW5ndGgsDQogICAgICAgICAgYXJnc0luZGV4ID0gLTEsDQogICAgICAgICAgYXJnc0xlbmd0aCA9IG5hdGl2ZU1heChhcmdzLmxlbmd0aCAtIGhvbGRlcnNMZW5ndGgsIDApLA0KICAgICAgICAgIGxlZnRJbmRleCA9IC0xLA0KICAgICAgICAgIGxlZnRMZW5ndGggPSBwYXJ0aWFscy5sZW5ndGgsDQogICAgICAgICAgcmVzdWx0ID0gQXJyYXkoYXJnc0xlbmd0aCArIGxlZnRMZW5ndGgpOw0KDQogICAgICB3aGlsZSAoKytsZWZ0SW5kZXggPCBsZWZ0TGVuZ3RoKSB7DQogICAgICAgIHJlc3VsdFtsZWZ0SW5kZXhdID0gcGFydGlhbHNbbGVmdEluZGV4XTsNCiAgICAgIH0NCiAgICAgIHdoaWxlICgrK2FyZ3NJbmRleCA8IGhvbGRlcnNMZW5ndGgpIHsNCiAgICAgICAgcmVzdWx0W2hvbGRlcnNbYXJnc0luZGV4XV0gPSBhcmdzW2FyZ3NJbmRleF07DQogICAgICB9DQogICAgICB3aGlsZSAoYXJnc0xlbmd0aC0tKSB7DQogICAgICAgIHJlc3VsdFtsZWZ0SW5kZXgrK10gPSBhcmdzW2FyZ3NJbmRleCsrXTsNCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhpcyBmdW5jdGlvbiBpcyBsaWtlIGBjb21wb3NlQXJnc2AgZXhjZXB0IHRoYXQgdGhlIGFyZ3VtZW50cyBjb21wb3NpdGlvbg0KICAgICAqIGlzIHRhaWxvcmVkIGZvciBgXy5wYXJ0aWFsUmlnaHRgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gYXJncyBUaGUgcHJvdmlkZWQgYXJndW1lbnRzLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IHBhcnRpYWxzIFRoZSBhcmd1bWVudHMgdG8gYXBwZW5kIHRvIHRob3NlIHByb3ZpZGVkLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGhvbGRlcnMgVGhlIGBwYXJ0aWFsc2AgcGxhY2Vob2xkZXIgaW5kZXhlcy4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjb21wb3NlZCBhcmd1bWVudHMuDQogICAgICovDQogICAgZnVuY3Rpb24gY29tcG9zZUFyZ3NSaWdodChhcmdzLCBwYXJ0aWFscywgaG9sZGVycykgew0KICAgICAgdmFyIGhvbGRlcnNJbmRleCA9IC0xLA0KICAgICAgICAgIGhvbGRlcnNMZW5ndGggPSBob2xkZXJzLmxlbmd0aCwNCiAgICAgICAgICBhcmdzSW5kZXggPSAtMSwNCiAgICAgICAgICBhcmdzTGVuZ3RoID0gbmF0aXZlTWF4KGFyZ3MubGVuZ3RoIC0gaG9sZGVyc0xlbmd0aCwgMCksDQogICAgICAgICAgcmlnaHRJbmRleCA9IC0xLA0KICAgICAgICAgIHJpZ2h0TGVuZ3RoID0gcGFydGlhbHMubGVuZ3RoLA0KICAgICAgICAgIHJlc3VsdCA9IEFycmF5KGFyZ3NMZW5ndGggKyByaWdodExlbmd0aCk7DQoNCiAgICAgIHdoaWxlICgrK2FyZ3NJbmRleCA8IGFyZ3NMZW5ndGgpIHsNCiAgICAgICAgcmVzdWx0W2FyZ3NJbmRleF0gPSBhcmdzW2FyZ3NJbmRleF07DQogICAgICB9DQogICAgICB2YXIgb2Zmc2V0ID0gYXJnc0luZGV4Ow0KICAgICAgd2hpbGUgKCsrcmlnaHRJbmRleCA8IHJpZ2h0TGVuZ3RoKSB7DQogICAgICAgIHJlc3VsdFtvZmZzZXQgKyByaWdodEluZGV4XSA9IHBhcnRpYWxzW3JpZ2h0SW5kZXhdOw0KICAgICAgfQ0KICAgICAgd2hpbGUgKCsraG9sZGVyc0luZGV4IDwgaG9sZGVyc0xlbmd0aCkgew0KICAgICAgICByZXN1bHRbb2Zmc2V0ICsgaG9sZGVyc1tob2xkZXJzSW5kZXhdXSA9IGFyZ3NbYXJnc0luZGV4KytdOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBhZ2dyZWdhdGVzIGEgY29sbGVjdGlvbiwgY3JlYXRpbmcgYW4gYWNjdW11bGF0b3INCiAgICAgKiBvYmplY3QgY29tcG9zZWQgZnJvbSB0aGUgcmVzdWx0cyBvZiBydW5uaW5nIGVhY2ggZWxlbWVudCBpbiB0aGUgY29sbGVjdGlvbg0KICAgICAqIHRocm91Z2ggYW4gaXRlcmF0ZWUuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGNyZWF0ZSBgXy5jb3VudEJ5YCwgYF8uZ3JvdXBCeWAsIGBfLmluZGV4QnlgLA0KICAgICAqIGFuZCBgXy5wYXJ0aXRpb25gLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZXR0ZXIgVGhlIGZ1bmN0aW9uIHRvIHNldCBrZXlzIGFuZCB2YWx1ZXMgb2YgdGhlIGFjY3VtdWxhdG9yIG9iamVjdC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaW5pdGlhbGl6ZXJdIFRoZSBmdW5jdGlvbiB0byBpbml0aWFsaXplIHRoZSBhY2N1bXVsYXRvciBvYmplY3QuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgYWdncmVnYXRvciBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVBZ2dyZWdhdG9yKHNldHRlciwgaW5pdGlhbGl6ZXIpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbihjb2xsZWN0aW9uLCBpdGVyYXRlZSwgdGhpc0FyZykgew0KICAgICAgICB2YXIgcmVzdWx0ID0gaW5pdGlhbGl6ZXIgPyBpbml0aWFsaXplcigpIDoge307DQogICAgICAgIGl0ZXJhdGVlID0gZ2V0Q2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDMpOw0KDQogICAgICAgIGlmIChpc0FycmF5KGNvbGxlY3Rpb24pKSB7DQogICAgICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgICAgIGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoOw0KDQogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGNvbGxlY3Rpb25baW5kZXhdOw0KICAgICAgICAgICAgc2V0dGVyKHJlc3VsdCwgdmFsdWUsIGl0ZXJhdGVlKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbiksIGNvbGxlY3Rpb24pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBiYXNlRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBjb2xsZWN0aW9uKSB7DQogICAgICAgICAgICBzZXR0ZXIocmVzdWx0LCB2YWx1ZSwgaXRlcmF0ZWUodmFsdWUsIGtleSwgY29sbGVjdGlvbiksIGNvbGxlY3Rpb24pOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGFzc2lnbnMgcHJvcGVydGllcyBvZiBzb3VyY2Ugb2JqZWN0KHMpIHRvIGEgZ2l2ZW4NCiAgICAgKiBkZXN0aW5hdGlvbiBvYmplY3QuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGNyZWF0ZSBgXy5hc3NpZ25gLCBgXy5kZWZhdWx0c2AsIGFuZCBgXy5tZXJnZWAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGFzc2lnbmVyIFRoZSBmdW5jdGlvbiB0byBhc3NpZ24gdmFsdWVzLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGFzc2lnbmVyIGZ1bmN0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZUFzc2lnbmVyKGFzc2lnbmVyKSB7DQogICAgICByZXR1cm4gcmVzdFBhcmFtKGZ1bmN0aW9uKG9iamVjdCwgc291cmNlcykgew0KICAgICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICAgIGxlbmd0aCA9IG9iamVjdCA9PSBudWxsID8gMCA6IHNvdXJjZXMubGVuZ3RoLA0KICAgICAgICAgICAgY3VzdG9taXplciA9IGxlbmd0aCA+IDIgPyBzb3VyY2VzW2xlbmd0aCAtIDJdIDogdW5kZWZpbmVkLA0KICAgICAgICAgICAgZ3VhcmQgPSBsZW5ndGggPiAyID8gc291cmNlc1syXSA6IHVuZGVmaW5lZCwNCiAgICAgICAgICAgIHRoaXNBcmcgPSBsZW5ndGggPiAxID8gc291cmNlc1tsZW5ndGggLSAxXSA6IHVuZGVmaW5lZDsNCg0KICAgICAgICBpZiAodHlwZW9mIGN1c3RvbWl6ZXIgPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICAgIGN1c3RvbWl6ZXIgPSBiaW5kQ2FsbGJhY2soY3VzdG9taXplciwgdGhpc0FyZywgNSk7DQogICAgICAgICAgbGVuZ3RoIC09IDI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgY3VzdG9taXplciA9IHR5cGVvZiB0aGlzQXJnID09ICdmdW5jdGlvbicgPyB0aGlzQXJnIDogdW5kZWZpbmVkOw0KICAgICAgICAgIGxlbmd0aCAtPSAoY3VzdG9taXplciA/IDEgOiAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwoc291cmNlc1swXSwgc291cmNlc1sxXSwgZ3VhcmQpKSB7DQogICAgICAgICAgY3VzdG9taXplciA9IGxlbmd0aCA8IDMgPyB1bmRlZmluZWQgOiBjdXN0b21pemVyOw0KICAgICAgICAgIGxlbmd0aCA9IDE7DQogICAgICAgIH0NCiAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgICB2YXIgc291cmNlID0gc291cmNlc1tpbmRleF07DQogICAgICAgICAgaWYgKHNvdXJjZSkgew0KICAgICAgICAgICAgYXNzaWduZXIob2JqZWN0LCBzb3VyY2UsIGN1c3RvbWl6ZXIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gb2JqZWN0Ow0KICAgICAgfSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGBiYXNlRWFjaGAgb3IgYGJhc2VFYWNoUmlnaHRgIGZ1bmN0aW9uLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlYWNoRnVuYyBUaGUgZnVuY3Rpb24gdG8gaXRlcmF0ZSBvdmVyIGEgY29sbGVjdGlvbi4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtmcm9tUmlnaHRdIFNwZWNpZnkgaXRlcmF0aW5nIGZyb20gcmlnaHQgdG8gbGVmdC4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBiYXNlIGZ1bmN0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZUJhc2VFYWNoKGVhY2hGdW5jLCBmcm9tUmlnaHQpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbihjb2xsZWN0aW9uLCBpdGVyYXRlZSkgew0KICAgICAgICB2YXIgbGVuZ3RoID0gY29sbGVjdGlvbiA/IGdldExlbmd0aChjb2xsZWN0aW9uKSA6IDA7DQogICAgICAgIGlmICghaXNMZW5ndGgobGVuZ3RoKSkgew0KICAgICAgICAgIHJldHVybiBlYWNoRnVuYyhjb2xsZWN0aW9uLCBpdGVyYXRlZSk7DQogICAgICAgIH0NCiAgICAgICAgdmFyIGluZGV4ID0gZnJvbVJpZ2h0ID8gbGVuZ3RoIDogLTEsDQogICAgICAgICAgICBpdGVyYWJsZSA9IHRvT2JqZWN0KGNvbGxlY3Rpb24pOw0KDQogICAgICAgIHdoaWxlICgoZnJvbVJpZ2h0ID8gaW5kZXgtLSA6ICsraW5kZXggPCBsZW5ndGgpKSB7DQogICAgICAgICAgaWYgKGl0ZXJhdGVlKGl0ZXJhYmxlW2luZGV4XSwgaW5kZXgsIGl0ZXJhYmxlKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gY29sbGVjdGlvbjsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGJhc2UgZnVuY3Rpb24gZm9yIGBfLmZvckluYCBvciBgXy5mb3JJblJpZ2h0YC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtib29sZWFufSBbZnJvbVJpZ2h0XSBTcGVjaWZ5IGl0ZXJhdGluZyBmcm9tIHJpZ2h0IHRvIGxlZnQuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgYmFzZSBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVCYXNlRm9yKGZyb21SaWdodCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCwgaXRlcmF0ZWUsIGtleXNGdW5jKSB7DQogICAgICAgIHZhciBpdGVyYWJsZSA9IHRvT2JqZWN0KG9iamVjdCksDQogICAgICAgICAgICBwcm9wcyA9IGtleXNGdW5jKG9iamVjdCksDQogICAgICAgICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGgsDQogICAgICAgICAgICBpbmRleCA9IGZyb21SaWdodCA/IGxlbmd0aCA6IC0xOw0KDQogICAgICAgIHdoaWxlICgoZnJvbVJpZ2h0ID8gaW5kZXgtLSA6ICsraW5kZXggPCBsZW5ndGgpKSB7DQogICAgICAgICAgdmFyIGtleSA9IHByb3BzW2luZGV4XTsNCiAgICAgICAgICBpZiAoaXRlcmF0ZWUoaXRlcmFibGVba2V5XSwga2V5LCBpdGVyYWJsZSkgPT09IGZhbHNlKSB7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG9iamVjdDsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgd3JhcHMgYGZ1bmNgIGFuZCBpbnZva2VzIGl0IHdpdGggdGhlIGB0aGlzYA0KICAgICAqIGJpbmRpbmcgb2YgYHRoaXNBcmdgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBiaW5kLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgZnVuY2AuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgYm91bmQgZnVuY3Rpb24uDQogICAgICovDQogICAgZnVuY3Rpb24gY3JlYXRlQmluZFdyYXBwZXIoZnVuYywgdGhpc0FyZykgew0KICAgICAgdmFyIEN0b3IgPSBjcmVhdGVDdG9yV3JhcHBlcihmdW5jKTsNCg0KICAgICAgZnVuY3Rpb24gd3JhcHBlcigpIHsNCiAgICAgICAgdmFyIGZuID0gKHRoaXMgJiYgdGhpcyAhPT0gcm9vdCAmJiB0aGlzIGluc3RhbmNlb2Ygd3JhcHBlcikgPyBDdG9yIDogZnVuYzsNCiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoaXNBcmcsIGFyZ3VtZW50cyk7DQogICAgICB9DQogICAgICByZXR1cm4gd3JhcHBlcjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgYFNldGAgY2FjaGUgb2JqZWN0IHRvIG9wdGltaXplIGxpbmVhciBzZWFyY2hlcyBvZiBsYXJnZSBhcnJheXMuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFt2YWx1ZXNdIFRoZSB2YWx1ZXMgdG8gY2FjaGUuDQogICAgICogQHJldHVybnMge251bGx8T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgY2FjaGUgb2JqZWN0IGlmIGBTZXRgIGlzIHN1cHBvcnRlZCwgZWxzZSBgbnVsbGAuDQogICAgICovDQogICAgdmFyIGNyZWF0ZUNhY2hlID0gIShuYXRpdmVDcmVhdGUgJiYgU2V0KSA/IGNvbnN0YW50KG51bGwpIDogZnVuY3Rpb24odmFsdWVzKSB7DQogICAgICByZXR1cm4gbmV3IFNldENhY2hlKHZhbHVlcyk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHByb2R1Y2VzIGNvbXBvdW5kIHdvcmRzIG91dCBvZiB0aGUgd29yZHMgaW4gYQ0KICAgICAqIGdpdmVuIHN0cmluZy4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNvbWJpbmUgZWFjaCB3b3JkLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGNvbXBvdW5kZXIgZnVuY3Rpb24uDQogICAgICovDQogICAgZnVuY3Rpb24gY3JlYXRlQ29tcG91bmRlcihjYWxsYmFjaykgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKHN0cmluZykgew0KICAgICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICAgIGFycmF5ID0gd29yZHMoZGVidXJyKHN0cmluZykpLA0KICAgICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLA0KICAgICAgICAgICAgcmVzdWx0ID0gJyc7DQoNCiAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgICByZXN1bHQgPSBjYWxsYmFjayhyZXN1bHQsIGFycmF5W2luZGV4XSwgaW5kZXgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHByb2R1Y2VzIGFuIGluc3RhbmNlIG9mIGBDdG9yYCByZWdhcmRsZXNzIG9mDQogICAgICogd2hldGhlciBpdCB3YXMgaW52b2tlZCBhcyBwYXJ0IG9mIGEgYG5ld2AgZXhwcmVzc2lvbiBvciBieSBgY2FsbGAgb3IgYGFwcGx5YC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gQ3RvciBUaGUgY29uc3RydWN0b3IgdG8gd3JhcC4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyB3cmFwcGVkIGZ1bmN0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZUN0b3JXcmFwcGVyKEN0b3IpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICAgICAgLy8gVXNlIGEgYHN3aXRjaGAgc3RhdGVtZW50IHRvIHdvcmsgd2l0aCBjbGFzcyBjb25zdHJ1Y3RvcnMuDQogICAgICAgIC8vIFNlZSBodHRwczovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtZWNtYXNjcmlwdC1mdW5jdGlvbi1vYmplY3RzLWNhbGwtdGhpc2FyZ3VtZW50LWFyZ3VtZW50c2xpc3QNCiAgICAgICAgLy8gZm9yIG1vcmUgZGV0YWlscy4NCiAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7DQogICAgICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHsNCiAgICAgICAgICBjYXNlIDA6IHJldHVybiBuZXcgQ3RvcjsNCiAgICAgICAgICBjYXNlIDE6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdKTsNCiAgICAgICAgICBjYXNlIDI6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdKTsNCiAgICAgICAgICBjYXNlIDM6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTsNCiAgICAgICAgICBjYXNlIDQ6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdKTsNCiAgICAgICAgICBjYXNlIDU6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdLCBhcmdzWzRdKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgdGhpc0JpbmRpbmcgPSBiYXNlQ3JlYXRlKEN0b3IucHJvdG90eXBlKSwNCiAgICAgICAgICAgIHJlc3VsdCA9IEN0b3IuYXBwbHkodGhpc0JpbmRpbmcsIGFyZ3MpOw0KDQogICAgICAgIC8vIE1pbWljIHRoZSBjb25zdHJ1Y3RvcidzIGByZXR1cm5gIGJlaGF2aW9yLg0KICAgICAgICAvLyBTZWUgaHR0cHM6Ly9lczUuZ2l0aHViLmlvLyN4MTMuMi4yIGZvciBtb3JlIGRldGFpbHMuDQogICAgICAgIHJldHVybiBpc09iamVjdChyZXN1bHQpID8gcmVzdWx0IDogdGhpc0JpbmRpbmc7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBgXy5jdXJyeWAgb3IgYF8uY3VycnlSaWdodGAgZnVuY3Rpb24uDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gZmxhZyBUaGUgY3VycnkgYml0IGZsYWcuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgY3VycnkgZnVuY3Rpb24uDQogICAgICovDQogICAgZnVuY3Rpb24gY3JlYXRlQ3VycnkoZmxhZykgew0KICAgICAgZnVuY3Rpb24gY3VycnlGdW5jKGZ1bmMsIGFyaXR5LCBndWFyZCkgew0KICAgICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwoZnVuYywgYXJpdHksIGd1YXJkKSkgew0KICAgICAgICAgIGFyaXR5ID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcmVzdWx0ID0gY3JlYXRlV3JhcHBlcihmdW5jLCBmbGFnLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBhcml0eSk7DQogICAgICAgIHJlc3VsdC5wbGFjZWhvbGRlciA9IGN1cnJ5RnVuYy5wbGFjZWhvbGRlcjsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCiAgICAgIHJldHVybiBjdXJyeUZ1bmM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGBfLm1heGAgb3IgYF8ubWluYCBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29tcGFyYXRvciBUaGUgZnVuY3Rpb24gdXNlZCB0byBjb21wYXJlIHZhbHVlcy4NCiAgICAgKiBAcGFyYW0geyp9IGV4VmFsdWUgVGhlIGluaXRpYWwgZXh0cmVtdW0gdmFsdWUuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZXh0cmVtdW0gZnVuY3Rpb24uDQogICAgICovDQogICAgZnVuY3Rpb24gY3JlYXRlRXh0cmVtdW0oY29tcGFyYXRvciwgZXhWYWx1ZSkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCB0aGlzQXJnKSB7DQogICAgICAgIGlmICh0aGlzQXJnICYmIGlzSXRlcmF0ZWVDYWxsKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCB0aGlzQXJnKSkgew0KICAgICAgICAgIGl0ZXJhdGVlID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBpdGVyYXRlZSA9IGdldENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCAzKTsNCiAgICAgICAgaWYgKGl0ZXJhdGVlLmxlbmd0aCA9PSAxKSB7DQogICAgICAgICAgY29sbGVjdGlvbiA9IHRvSXRlcmFibGUoY29sbGVjdGlvbik7DQogICAgICAgICAgdmFyIHJlc3VsdCA9IGFycmF5RXh0cmVtdW0oY29sbGVjdGlvbiwgaXRlcmF0ZWUsIGNvbXBhcmF0b3IsIGV4VmFsdWUpOw0KICAgICAgICAgIGlmICghKGNvbGxlY3Rpb24ubGVuZ3RoICYmIHJlc3VsdCA9PT0gZXhWYWx1ZSkpIHsNCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBiYXNlRXh0cmVtdW0oY29sbGVjdGlvbiwgaXRlcmF0ZWUsIGNvbXBhcmF0b3IsIGV4VmFsdWUpOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgYF8uZmluZGAgb3IgYF8uZmluZExhc3RgIGZ1bmN0aW9uLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlYWNoRnVuYyBUaGUgZnVuY3Rpb24gdG8gaXRlcmF0ZSBvdmVyIGEgY29sbGVjdGlvbi4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtmcm9tUmlnaHRdIFNwZWNpZnkgaXRlcmF0aW5nIGZyb20gcmlnaHQgdG8gbGVmdC4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmaW5kIGZ1bmN0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZUZpbmQoZWFjaEZ1bmMsIGZyb21SaWdodCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKGNvbGxlY3Rpb24sIHByZWRpY2F0ZSwgdGhpc0FyZykgew0KICAgICAgICBwcmVkaWNhdGUgPSBnZXRDYWxsYmFjayhwcmVkaWNhdGUsIHRoaXNBcmcsIDMpOw0KICAgICAgICBpZiAoaXNBcnJheShjb2xsZWN0aW9uKSkgew0KICAgICAgICAgIHZhciBpbmRleCA9IGJhc2VGaW5kSW5kZXgoY29sbGVjdGlvbiwgcHJlZGljYXRlLCBmcm9tUmlnaHQpOw0KICAgICAgICAgIHJldHVybiBpbmRleCA+IC0xID8gY29sbGVjdGlvbltpbmRleF0gOiB1bmRlZmluZWQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGJhc2VGaW5kKGNvbGxlY3Rpb24sIHByZWRpY2F0ZSwgZWFjaEZ1bmMpOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgYF8uZmluZEluZGV4YCBvciBgXy5maW5kTGFzdEluZGV4YCBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtib29sZWFufSBbZnJvbVJpZ2h0XSBTcGVjaWZ5IGl0ZXJhdGluZyBmcm9tIHJpZ2h0IHRvIGxlZnQuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZmluZCBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVGaW5kSW5kZXgoZnJvbVJpZ2h0KSB7DQogICAgICByZXR1cm4gZnVuY3Rpb24oYXJyYXksIHByZWRpY2F0ZSwgdGhpc0FyZykgew0KICAgICAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7DQogICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIHByZWRpY2F0ZSA9IGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7DQogICAgICAgIHJldHVybiBiYXNlRmluZEluZGV4KGFycmF5LCBwcmVkaWNhdGUsIGZyb21SaWdodCk7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBgXy5maW5kS2V5YCBvciBgXy5maW5kTGFzdEtleWAgZnVuY3Rpb24uDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9iamVjdEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGl0ZXJhdGUgb3ZlciBhbiBvYmplY3QuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZmluZCBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVGaW5kS2V5KG9iamVjdEZ1bmMpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QsIHByZWRpY2F0ZSwgdGhpc0FyZykgew0KICAgICAgICBwcmVkaWNhdGUgPSBnZXRDYWxsYmFjayhwcmVkaWNhdGUsIHRoaXNBcmcsIDMpOw0KICAgICAgICByZXR1cm4gYmFzZUZpbmQob2JqZWN0LCBwcmVkaWNhdGUsIG9iamVjdEZ1bmMsIHRydWUpOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgYF8uZmxvd2Agb3IgYF8uZmxvd1JpZ2h0YCBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtib29sZWFufSBbZnJvbVJpZ2h0XSBTcGVjaWZ5IGl0ZXJhdGluZyBmcm9tIHJpZ2h0IHRvIGxlZnQuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZmxvdyBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVGbG93KGZyb21SaWdodCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgd3JhcHBlciwNCiAgICAgICAgICAgIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsDQogICAgICAgICAgICBpbmRleCA9IGZyb21SaWdodCA/IGxlbmd0aCA6IC0xLA0KICAgICAgICAgICAgbGVmdEluZGV4ID0gMCwNCiAgICAgICAgICAgIGZ1bmNzID0gQXJyYXkobGVuZ3RoKTsNCg0KICAgICAgICB3aGlsZSAoKGZyb21SaWdodCA/IGluZGV4LS0gOiArK2luZGV4IDwgbGVuZ3RoKSkgew0KICAgICAgICAgIHZhciBmdW5jID0gZnVuY3NbbGVmdEluZGV4KytdID0gYXJndW1lbnRzW2luZGV4XTsNCiAgICAgICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoIXdyYXBwZXIgJiYgTG9kYXNoV3JhcHBlci5wcm90b3R5cGUudGhydSAmJiBnZXRGdW5jTmFtZShmdW5jKSA9PSAnd3JhcHBlcicpIHsNCiAgICAgICAgICAgIHdyYXBwZXIgPSBuZXcgTG9kYXNoV3JhcHBlcihbXSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGluZGV4ID0gd3JhcHBlciA/IC0xIDogbGVuZ3RoOw0KICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICAgIGZ1bmMgPSBmdW5jc1tpbmRleF07DQoNCiAgICAgICAgICB2YXIgZnVuY05hbWUgPSBnZXRGdW5jTmFtZShmdW5jKSwNCiAgICAgICAgICAgICAgZGF0YSA9IGZ1bmNOYW1lID09ICd3cmFwcGVyJyA/IGdldERhdGEoZnVuYykgOiBudWxsOw0KDQogICAgICAgICAgaWYgKGRhdGEgJiYgaXNMYXppYWJsZShkYXRhWzBdKSAmJiBkYXRhWzFdID09IChBUllfRkxBRyB8IENVUlJZX0ZMQUcgfCBQQVJUSUFMX0ZMQUcgfCBSRUFSR19GTEFHKSAmJiAhZGF0YVs0XS5sZW5ndGggJiYgZGF0YVs5XSA9PSAxKSB7DQogICAgICAgICAgICB3cmFwcGVyID0gd3JhcHBlcltnZXRGdW5jTmFtZShkYXRhWzBdKV0uYXBwbHkod3JhcHBlciwgZGF0YVszXSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHdyYXBwZXIgPSAoZnVuYy5sZW5ndGggPT0gMSAmJiBpc0xhemlhYmxlKGZ1bmMpKSA/IHdyYXBwZXJbZnVuY05hbWVdKCkgOiB3cmFwcGVyLnRocnUoZnVuYyk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsNCiAgICAgICAgICBpZiAod3JhcHBlciAmJiBhcmdzLmxlbmd0aCA9PSAxICYmIGlzQXJyYXkoYXJnc1swXSkpIHsNCiAgICAgICAgICAgIHJldHVybiB3cmFwcGVyLnBsYW50KGFyZ3NbMF0pLnZhbHVlKCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHZhciBpbmRleCA9IDAsDQogICAgICAgICAgICAgIHJlc3VsdCA9IGxlbmd0aCA/IGZ1bmNzW2luZGV4XS5hcHBseSh0aGlzLCBhcmdzKSA6IGFyZ3NbMF07DQoNCiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICAgICAgcmVzdWx0ID0gZnVuY3NbaW5kZXhdLmNhbGwodGhpcywgcmVzdWx0KTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgfTsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIGZvciBgXy5mb3JFYWNoYCBvciBgXy5mb3JFYWNoUmlnaHRgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBhcnJheUZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGl0ZXJhdGUgb3ZlciBhbiBhcnJheS4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlYWNoRnVuYyBUaGUgZnVuY3Rpb24gdG8gaXRlcmF0ZSBvdmVyIGEgY29sbGVjdGlvbi4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBlYWNoIGZ1bmN0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZUZvckVhY2goYXJyYXlGdW5jLCBlYWNoRnVuYykgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCB0aGlzQXJnKSB7DQogICAgICAgIHJldHVybiAodHlwZW9mIGl0ZXJhdGVlID09ICdmdW5jdGlvbicgJiYgdGhpc0FyZyA9PT0gdW5kZWZpbmVkICYmIGlzQXJyYXkoY29sbGVjdGlvbikpDQogICAgICAgICAgPyBhcnJheUZ1bmMoY29sbGVjdGlvbiwgaXRlcmF0ZWUpDQogICAgICAgICAgOiBlYWNoRnVuYyhjb2xsZWN0aW9uLCBiaW5kQ2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDMpKTsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIGZvciBgXy5mb3JJbmAgb3IgYF8uZm9ySW5SaWdodGAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9iamVjdEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGl0ZXJhdGUgb3ZlciBhbiBvYmplY3QuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZWFjaCBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVGb3JJbihvYmplY3RGdW5jKSB7DQogICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0LCBpdGVyYXRlZSwgdGhpc0FyZykgew0KICAgICAgICBpZiAodHlwZW9mIGl0ZXJhdGVlICE9ICdmdW5jdGlvbicgfHwgdGhpc0FyZyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgaXRlcmF0ZWUgPSBiaW5kQ2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDMpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBvYmplY3RGdW5jKG9iamVjdCwgaXRlcmF0ZWUsIGtleXNJbik7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiBmb3IgYF8uZm9yT3duYCBvciBgXy5mb3JPd25SaWdodGAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9iamVjdEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGl0ZXJhdGUgb3ZlciBhbiBvYmplY3QuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZWFjaCBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVGb3JPd24ob2JqZWN0RnVuYykgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCwgaXRlcmF0ZWUsIHRoaXNBcmcpIHsNCiAgICAgICAgaWYgKHR5cGVvZiBpdGVyYXRlZSAhPSAnZnVuY3Rpb24nIHx8IHRoaXNBcmcgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIGl0ZXJhdGVlID0gYmluZENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCAzKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gb2JqZWN0RnVuYyhvYmplY3QsIGl0ZXJhdGVlKTsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIGZvciBgXy5tYXBLZXlzYCBvciBgXy5tYXBWYWx1ZXNgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc01hcEtleXNdIFNwZWNpZnkgbWFwcGluZyBrZXlzIGluc3RlYWQgb2YgdmFsdWVzLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IG1hcCBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVPYmplY3RNYXBwZXIoaXNNYXBLZXlzKSB7DQogICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0LCBpdGVyYXRlZSwgdGhpc0FyZykgew0KICAgICAgICB2YXIgcmVzdWx0ID0ge307DQogICAgICAgIGl0ZXJhdGVlID0gZ2V0Q2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDMpOw0KDQogICAgICAgIGJhc2VGb3JPd24ob2JqZWN0LCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmplY3QpIHsNCiAgICAgICAgICB2YXIgbWFwcGVkID0gaXRlcmF0ZWUodmFsdWUsIGtleSwgb2JqZWN0KTsNCiAgICAgICAgICBrZXkgPSBpc01hcEtleXMgPyBtYXBwZWQgOiBrZXk7DQogICAgICAgICAgdmFsdWUgPSBpc01hcEtleXMgPyB2YWx1ZSA6IG1hcHBlZDsNCiAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIGZvciBgXy5wYWRMZWZ0YCBvciBgXy5wYWRSaWdodGAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2Zyb21SaWdodF0gU3BlY2lmeSBwYWRkaW5nIGZyb20gdGhlIHJpZ2h0Lg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHBhZCBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVQYWREaXIoZnJvbVJpZ2h0KSB7DQogICAgICByZXR1cm4gZnVuY3Rpb24oc3RyaW5nLCBsZW5ndGgsIGNoYXJzKSB7DQogICAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOw0KICAgICAgICByZXR1cm4gKGZyb21SaWdodCA/IHN0cmluZyA6ICcnKSArIGNyZWF0ZVBhZGRpbmcoc3RyaW5nLCBsZW5ndGgsIGNoYXJzKSArIChmcm9tUmlnaHQgPyAnJyA6IHN0cmluZyk7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBgXy5wYXJ0aWFsYCBvciBgXy5wYXJ0aWFsUmlnaHRgIGZ1bmN0aW9uLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGZsYWcgVGhlIHBhcnRpYWwgYml0IGZsYWcuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgcGFydGlhbCBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVQYXJ0aWFsKGZsYWcpIHsNCiAgICAgIHZhciBwYXJ0aWFsRnVuYyA9IHJlc3RQYXJhbShmdW5jdGlvbihmdW5jLCBwYXJ0aWFscykgew0KICAgICAgICB2YXIgaG9sZGVycyA9IHJlcGxhY2VIb2xkZXJzKHBhcnRpYWxzLCBwYXJ0aWFsRnVuYy5wbGFjZWhvbGRlcik7DQogICAgICAgIHJldHVybiBjcmVhdGVXcmFwcGVyKGZ1bmMsIGZsYWcsIG51bGwsIHBhcnRpYWxzLCBob2xkZXJzKTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIHBhcnRpYWxGdW5jOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiBmb3IgYF8ucmVkdWNlYCBvciBgXy5yZWR1Y2VSaWdodGAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGFycmF5RnVuYyBUaGUgZnVuY3Rpb24gdG8gaXRlcmF0ZSBvdmVyIGFuIGFycmF5Lg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGVhY2hGdW5jIFRoZSBmdW5jdGlvbiB0byBpdGVyYXRlIG92ZXIgYSBjb2xsZWN0aW9uLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGVhY2ggZnVuY3Rpb24uDQogICAgICovDQogICAgZnVuY3Rpb24gY3JlYXRlUmVkdWNlKGFycmF5RnVuYywgZWFjaEZ1bmMpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbihjb2xsZWN0aW9uLCBpdGVyYXRlZSwgYWNjdW11bGF0b3IsIHRoaXNBcmcpIHsNCiAgICAgICAgdmFyIGluaXRGcm9tQXJyYXkgPSBhcmd1bWVudHMubGVuZ3RoIDwgMzsNCiAgICAgICAgcmV0dXJuICh0eXBlb2YgaXRlcmF0ZWUgPT0gJ2Z1bmN0aW9uJyAmJiB0aGlzQXJnID09PSB1bmRlZmluZWQgJiYgaXNBcnJheShjb2xsZWN0aW9uKSkNCiAgICAgICAgICA/IGFycmF5RnVuYyhjb2xsZWN0aW9uLCBpdGVyYXRlZSwgYWNjdW11bGF0b3IsIGluaXRGcm9tQXJyYXkpDQogICAgICAgICAgOiBiYXNlUmVkdWNlKGNvbGxlY3Rpb24sIGdldENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCA0KSwgYWNjdW11bGF0b3IsIGluaXRGcm9tQXJyYXksIGVhY2hGdW5jKTsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgd3JhcHMgYGZ1bmNgIGFuZCBpbnZva2VzIGl0IHdpdGggb3B0aW9uYWwgYHRoaXNgDQogICAgICogYmluZGluZyBvZiwgcGFydGlhbCBhcHBsaWNhdGlvbiwgYW5kIGN1cnJ5aW5nLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufHN0cmluZ30gZnVuYyBUaGUgZnVuY3Rpb24gb3IgbWV0aG9kIG5hbWUgdG8gcmVmZXJlbmNlLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBiaXRtYXNrIFRoZSBiaXRtYXNrIG9mIGZsYWdzLiBTZWUgYGNyZWF0ZVdyYXBwZXJgIGZvciBtb3JlIGRldGFpbHMuDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBmdW5jYC4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbcGFydGlhbHNdIFRoZSBhcmd1bWVudHMgdG8gcHJlcGVuZCB0byB0aG9zZSBwcm92aWRlZCB0byB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtob2xkZXJzXSBUaGUgYHBhcnRpYWxzYCBwbGFjZWhvbGRlciBpbmRleGVzLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtwYXJ0aWFsc1JpZ2h0XSBUaGUgYXJndW1lbnRzIHRvIGFwcGVuZCB0byB0aG9zZSBwcm92aWRlZCB0byB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtob2xkZXJzUmlnaHRdIFRoZSBgcGFydGlhbHNSaWdodGAgcGxhY2Vob2xkZXIgaW5kZXhlcy4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbYXJnUG9zXSBUaGUgYXJndW1lbnQgcG9zaXRpb25zIG9mIHRoZSBuZXcgZnVuY3Rpb24uDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFthcnldIFRoZSBhcml0eSBjYXAgb2YgYGZ1bmNgLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbYXJpdHldIFRoZSBhcml0eSBvZiBgZnVuY2AuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgd3JhcHBlZCBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVIeWJyaWRXcmFwcGVyKGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzLCBob2xkZXJzLCBwYXJ0aWFsc1JpZ2h0LCBob2xkZXJzUmlnaHQsIGFyZ1BvcywgYXJ5LCBhcml0eSkgew0KICAgICAgdmFyIGlzQXJ5ID0gYml0bWFzayAmIEFSWV9GTEFHLA0KICAgICAgICAgIGlzQmluZCA9IGJpdG1hc2sgJiBCSU5EX0ZMQUcsDQogICAgICAgICAgaXNCaW5kS2V5ID0gYml0bWFzayAmIEJJTkRfS0VZX0ZMQUcsDQogICAgICAgICAgaXNDdXJyeSA9IGJpdG1hc2sgJiBDVVJSWV9GTEFHLA0KICAgICAgICAgIGlzQ3VycnlCb3VuZCA9IGJpdG1hc2sgJiBDVVJSWV9CT1VORF9GTEFHLA0KICAgICAgICAgIGlzQ3VycnlSaWdodCA9IGJpdG1hc2sgJiBDVVJSWV9SSUdIVF9GTEFHLA0KICAgICAgICAgIEN0b3IgPSBpc0JpbmRLZXkgPyBudWxsIDogY3JlYXRlQ3RvcldyYXBwZXIoZnVuYyk7DQoNCiAgICAgIGZ1bmN0aW9uIHdyYXBwZXIoKSB7DQogICAgICAgIC8vIEF2b2lkIGBhcmd1bWVudHNgIG9iamVjdCB1c2UgZGlzcXVhbGlmeWluZyBvcHRpbWl6YXRpb25zIGJ5DQogICAgICAgIC8vIGNvbnZlcnRpbmcgaXQgdG8gYW4gYXJyYXkgYmVmb3JlIHByb3ZpZGluZyBpdCB0byBvdGhlciBmdW5jdGlvbnMuDQogICAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLA0KICAgICAgICAgICAgaW5kZXggPSBsZW5ndGgsDQogICAgICAgICAgICBhcmdzID0gQXJyYXkobGVuZ3RoKTsNCg0KICAgICAgICB3aGlsZSAoaW5kZXgtLSkgew0KICAgICAgICAgIGFyZ3NbaW5kZXhdID0gYXJndW1lbnRzW2luZGV4XTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFydGlhbHMpIHsNCiAgICAgICAgICBhcmdzID0gY29tcG9zZUFyZ3MoYXJncywgcGFydGlhbHMsIGhvbGRlcnMpOw0KICAgICAgICB9DQogICAgICAgIGlmIChwYXJ0aWFsc1JpZ2h0KSB7DQogICAgICAgICAgYXJncyA9IGNvbXBvc2VBcmdzUmlnaHQoYXJncywgcGFydGlhbHNSaWdodCwgaG9sZGVyc1JpZ2h0KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDdXJyeSB8fCBpc0N1cnJ5UmlnaHQpIHsNCiAgICAgICAgICB2YXIgcGxhY2Vob2xkZXIgPSB3cmFwcGVyLnBsYWNlaG9sZGVyLA0KICAgICAgICAgICAgICBhcmdzSG9sZGVycyA9IHJlcGxhY2VIb2xkZXJzKGFyZ3MsIHBsYWNlaG9sZGVyKTsNCg0KICAgICAgICAgIGxlbmd0aCAtPSBhcmdzSG9sZGVycy5sZW5ndGg7DQogICAgICAgICAgaWYgKGxlbmd0aCA8IGFyaXR5KSB7DQogICAgICAgICAgICB2YXIgbmV3QXJnUG9zID0gYXJnUG9zID8gYXJyYXlDb3B5KGFyZ1BvcykgOiBudWxsLA0KICAgICAgICAgICAgICAgIG5ld0FyaXR5ID0gbmF0aXZlTWF4KGFyaXR5IC0gbGVuZ3RoLCAwKSwNCiAgICAgICAgICAgICAgICBuZXdzSG9sZGVycyA9IGlzQ3VycnkgPyBhcmdzSG9sZGVycyA6IG51bGwsDQogICAgICAgICAgICAgICAgbmV3SG9sZGVyc1JpZ2h0ID0gaXNDdXJyeSA/IG51bGwgOiBhcmdzSG9sZGVycywNCiAgICAgICAgICAgICAgICBuZXdQYXJ0aWFscyA9IGlzQ3VycnkgPyBhcmdzIDogbnVsbCwNCiAgICAgICAgICAgICAgICBuZXdQYXJ0aWFsc1JpZ2h0ID0gaXNDdXJyeSA/IG51bGwgOiBhcmdzOw0KDQogICAgICAgICAgICBiaXRtYXNrIHw9IChpc0N1cnJ5ID8gUEFSVElBTF9GTEFHIDogUEFSVElBTF9SSUdIVF9GTEFHKTsNCiAgICAgICAgICAgIGJpdG1hc2sgJj0gfihpc0N1cnJ5ID8gUEFSVElBTF9SSUdIVF9GTEFHIDogUEFSVElBTF9GTEFHKTsNCg0KICAgICAgICAgICAgaWYgKCFpc0N1cnJ5Qm91bmQpIHsNCiAgICAgICAgICAgICAgYml0bWFzayAmPSB+KEJJTkRfRkxBRyB8IEJJTkRfS0VZX0ZMQUcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIG5ld0RhdGEgPSBbZnVuYywgYml0bWFzaywgdGhpc0FyZywgbmV3UGFydGlhbHMsIG5ld3NIb2xkZXJzLCBuZXdQYXJ0aWFsc1JpZ2h0LCBuZXdIb2xkZXJzUmlnaHQsIG5ld0FyZ1BvcywgYXJ5LCBuZXdBcml0eV0sDQogICAgICAgICAgICAgICAgcmVzdWx0ID0gY3JlYXRlSHlicmlkV3JhcHBlci5hcHBseSh1bmRlZmluZWQsIG5ld0RhdGEpOw0KDQogICAgICAgICAgICBpZiAoaXNMYXppYWJsZShmdW5jKSkgew0KICAgICAgICAgICAgICBzZXREYXRhKHJlc3VsdCwgbmV3RGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXN1bHQucGxhY2Vob2xkZXIgPSBwbGFjZWhvbGRlcjsNCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHZhciB0aGlzQmluZGluZyA9IGlzQmluZCA/IHRoaXNBcmcgOiB0aGlzLA0KICAgICAgICAgICAgZm4gPSBpc0JpbmRLZXkgPyB0aGlzQmluZGluZ1tmdW5jXSA6IGZ1bmM7DQoNCiAgICAgICAgaWYgKGFyZ1Bvcykgew0KICAgICAgICAgIGFyZ3MgPSByZW9yZGVyKGFyZ3MsIGFyZ1Bvcyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQXJ5ICYmIGFyeSA8IGFyZ3MubGVuZ3RoKSB7DQogICAgICAgICAgYXJncy5sZW5ndGggPSBhcnk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoaXMgJiYgdGhpcyAhPT0gcm9vdCAmJiB0aGlzIGluc3RhbmNlb2Ygd3JhcHBlcikgew0KICAgICAgICAgIGZuID0gQ3RvciB8fCBjcmVhdGVDdG9yV3JhcHBlcihmdW5jKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhpc0JpbmRpbmcsIGFyZ3MpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHdyYXBwZXI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyB0aGUgcGFkZGluZyByZXF1aXJlZCBmb3IgYHN0cmluZ2AgYmFzZWQgb24gdGhlIGdpdmVuIGBsZW5ndGhgLg0KICAgICAqIFRoZSBgY2hhcnNgIHN0cmluZyBpcyB0cnVuY2F0ZWQgaWYgdGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzIGV4Y2VlZHMgYGxlbmd0aGAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBjcmVhdGUgcGFkZGluZyBmb3IuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGg9MF0gVGhlIHBhZGRpbmcgbGVuZ3RoLg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbY2hhcnM9JyAnXSBUaGUgc3RyaW5nIHVzZWQgYXMgcGFkZGluZy4NCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBwYWQgZm9yIGBzdHJpbmdgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZVBhZGRpbmcoc3RyaW5nLCBsZW5ndGgsIGNoYXJzKSB7DQogICAgICB2YXIgc3RyTGVuZ3RoID0gc3RyaW5nLmxlbmd0aDsNCiAgICAgIGxlbmd0aCA9ICtsZW5ndGg7DQoNCiAgICAgIGlmIChzdHJMZW5ndGggPj0gbGVuZ3RoIHx8ICFuYXRpdmVJc0Zpbml0ZShsZW5ndGgpKSB7DQogICAgICAgIHJldHVybiAnJzsNCiAgICAgIH0NCiAgICAgIHZhciBwYWRMZW5ndGggPSBsZW5ndGggLSBzdHJMZW5ndGg7DQogICAgICBjaGFycyA9IGNoYXJzID09IG51bGwgPyAnICcgOiAoY2hhcnMgKyAnJyk7DQogICAgICByZXR1cm4gcmVwZWF0KGNoYXJzLCBjZWlsKHBhZExlbmd0aCAvIGNoYXJzLmxlbmd0aCkpLnNsaWNlKDAsIHBhZExlbmd0aCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgd3JhcHMgYGZ1bmNgIGFuZCBpbnZva2VzIGl0IHdpdGggdGhlIG9wdGlvbmFsIGB0aGlzYA0KICAgICAqIGJpbmRpbmcgb2YgYHRoaXNBcmdgIGFuZCB0aGUgYHBhcnRpYWxzYCBwcmVwZW5kZWQgdG8gdGhvc2UgcHJvdmlkZWQgdG8NCiAgICAgKiB0aGUgd3JhcHBlci4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gcGFydGlhbGx5IGFwcGx5IGFyZ3VtZW50cyB0by4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBvZiBmbGFncy4gU2VlIGBjcmVhdGVXcmFwcGVyYCBmb3IgbW9yZSBkZXRhaWxzLg0KICAgICAqIEBwYXJhbSB7Kn0gdGhpc0FyZyBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGZ1bmNgLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IHBhcnRpYWxzIFRoZSBhcmd1bWVudHMgdG8gcHJlcGVuZCB0byB0aG9zZSBwcm92aWRlZCB0byB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGJvdW5kIGZ1bmN0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZVBhcnRpYWxXcmFwcGVyKGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzKSB7DQogICAgICB2YXIgaXNCaW5kID0gYml0bWFzayAmIEJJTkRfRkxBRywNCiAgICAgICAgICBDdG9yID0gY3JlYXRlQ3RvcldyYXBwZXIoZnVuYyk7DQoNCiAgICAgIGZ1bmN0aW9uIHdyYXBwZXIoKSB7DQogICAgICAgIC8vIEF2b2lkIGBhcmd1bWVudHNgIG9iamVjdCB1c2UgZGlzcXVhbGlmeWluZyBvcHRpbWl6YXRpb25zIGJ5DQogICAgICAgIC8vIGNvbnZlcnRpbmcgaXQgdG8gYW4gYXJyYXkgYmVmb3JlIHByb3ZpZGluZyBpdCBgZnVuY2AuDQogICAgICAgIHZhciBhcmdzSW5kZXggPSAtMSwNCiAgICAgICAgICAgIGFyZ3NMZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLA0KICAgICAgICAgICAgbGVmdEluZGV4ID0gLTEsDQogICAgICAgICAgICBsZWZ0TGVuZ3RoID0gcGFydGlhbHMubGVuZ3RoLA0KICAgICAgICAgICAgYXJncyA9IEFycmF5KGFyZ3NMZW5ndGggKyBsZWZ0TGVuZ3RoKTsNCg0KICAgICAgICB3aGlsZSAoKytsZWZ0SW5kZXggPCBsZWZ0TGVuZ3RoKSB7DQogICAgICAgICAgYXJnc1tsZWZ0SW5kZXhdID0gcGFydGlhbHNbbGVmdEluZGV4XTsNCiAgICAgICAgfQ0KICAgICAgICB3aGlsZSAoYXJnc0xlbmd0aC0tKSB7DQogICAgICAgICAgYXJnc1tsZWZ0SW5kZXgrK10gPSBhcmd1bWVudHNbKythcmdzSW5kZXhdOw0KICAgICAgICB9DQogICAgICAgIHZhciBmbiA9ICh0aGlzICYmIHRoaXMgIT09IHJvb3QgJiYgdGhpcyBpbnN0YW5jZW9mIHdyYXBwZXIpID8gQ3RvciA6IGZ1bmM7DQogICAgICAgIHJldHVybiBmbi5hcHBseShpc0JpbmQgPyB0aGlzQXJnIDogdGhpcywgYXJncyk7DQogICAgICB9DQogICAgICByZXR1cm4gd3JhcHBlcjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgYF8uc29ydGVkSW5kZXhgIG9yIGBfLnNvcnRlZExhc3RJbmRleGAgZnVuY3Rpb24uDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3JldEhpZ2hlc3RdIFNwZWNpZnkgcmV0dXJuaW5nIHRoZSBoaWdoZXN0IHF1YWxpZmllZCBpbmRleC4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBpbmRleCBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVTb3J0ZWRJbmRleChyZXRIaWdoZXN0KSB7DQogICAgICByZXR1cm4gZnVuY3Rpb24oYXJyYXksIHZhbHVlLCBpdGVyYXRlZSwgdGhpc0FyZykgew0KICAgICAgICB2YXIgY2FsbGJhY2sgPSBnZXRDYWxsYmFjayhpdGVyYXRlZSk7DQogICAgICAgIHJldHVybiAoaXRlcmF0ZWUgPT0gbnVsbCAmJiBjYWxsYmFjayA9PT0gYmFzZUNhbGxiYWNrKQ0KICAgICAgICAgID8gYmluYXJ5SW5kZXgoYXJyYXksIHZhbHVlLCByZXRIaWdoZXN0KQ0KICAgICAgICAgIDogYmluYXJ5SW5kZXhCeShhcnJheSwgdmFsdWUsIGNhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCAxKSwgcmV0SGlnaGVzdCk7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGVpdGhlciBjdXJyaWVzIG9yIGludm9rZXMgYGZ1bmNgIHdpdGggb3B0aW9uYWwNCiAgICAgKiBgdGhpc2AgYmluZGluZyBhbmQgcGFydGlhbGx5IGFwcGxpZWQgYXJndW1lbnRzLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufHN0cmluZ30gZnVuYyBUaGUgZnVuY3Rpb24gb3IgbWV0aG9kIG5hbWUgdG8gcmVmZXJlbmNlLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBiaXRtYXNrIFRoZSBiaXRtYXNrIG9mIGZsYWdzLg0KICAgICAqICBUaGUgYml0bWFzayBtYXkgYmUgY29tcG9zZWQgb2YgdGhlIGZvbGxvd2luZyBmbGFnczoNCiAgICAgKiAgICAgMSAtIGBfLmJpbmRgDQogICAgICogICAgIDIgLSBgXy5iaW5kS2V5YA0KICAgICAqICAgICA0IC0gYF8uY3VycnlgIG9yIGBfLmN1cnJ5UmlnaHRgIG9mIGEgYm91bmQgZnVuY3Rpb24NCiAgICAgKiAgICAgOCAtIGBfLmN1cnJ5YA0KICAgICAqICAgIDE2IC0gYF8uY3VycnlSaWdodGANCiAgICAgKiAgICAzMiAtIGBfLnBhcnRpYWxgDQogICAgICogICAgNjQgLSBgXy5wYXJ0aWFsUmlnaHRgDQogICAgICogICAxMjggLSBgXy5yZWFyZ2ANCiAgICAgKiAgIDI1NiAtIGBfLmFyeWANCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGZ1bmNgLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtwYXJ0aWFsc10gVGhlIGFyZ3VtZW50cyB0byBiZSBwYXJ0aWFsbHkgYXBwbGllZC4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbaG9sZGVyc10gVGhlIGBwYXJ0aWFsc2AgcGxhY2Vob2xkZXIgaW5kZXhlcy4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbYXJnUG9zXSBUaGUgYXJndW1lbnQgcG9zaXRpb25zIG9mIHRoZSBuZXcgZnVuY3Rpb24uDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFthcnldIFRoZSBhcml0eSBjYXAgb2YgYGZ1bmNgLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbYXJpdHldIFRoZSBhcml0eSBvZiBgZnVuY2AuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgd3JhcHBlZCBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGVXcmFwcGVyKGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzLCBob2xkZXJzLCBhcmdQb3MsIGFyeSwgYXJpdHkpIHsNCiAgICAgIHZhciBpc0JpbmRLZXkgPSBiaXRtYXNrICYgQklORF9LRVlfRkxBRzsNCiAgICAgIGlmICghaXNCaW5kS2V5ICYmIHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsNCiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOw0KICAgICAgfQ0KICAgICAgdmFyIGxlbmd0aCA9IHBhcnRpYWxzID8gcGFydGlhbHMubGVuZ3RoIDogMDsNCiAgICAgIGlmICghbGVuZ3RoKSB7DQogICAgICAgIGJpdG1hc2sgJj0gfihQQVJUSUFMX0ZMQUcgfCBQQVJUSUFMX1JJR0hUX0ZMQUcpOw0KICAgICAgICBwYXJ0aWFscyA9IGhvbGRlcnMgPSBudWxsOw0KICAgICAgfQ0KICAgICAgbGVuZ3RoIC09IChob2xkZXJzID8gaG9sZGVycy5sZW5ndGggOiAwKTsNCiAgICAgIGlmIChiaXRtYXNrICYgUEFSVElBTF9SSUdIVF9GTEFHKSB7DQogICAgICAgIHZhciBwYXJ0aWFsc1JpZ2h0ID0gcGFydGlhbHMsDQogICAgICAgICAgICBob2xkZXJzUmlnaHQgPSBob2xkZXJzOw0KDQogICAgICAgIHBhcnRpYWxzID0gaG9sZGVycyA9IG51bGw7DQogICAgICB9DQogICAgICB2YXIgZGF0YSA9IGlzQmluZEtleSA/IG51bGwgOiBnZXREYXRhKGZ1bmMpLA0KICAgICAgICAgIG5ld0RhdGEgPSBbZnVuYywgYml0bWFzaywgdGhpc0FyZywgcGFydGlhbHMsIGhvbGRlcnMsIHBhcnRpYWxzUmlnaHQsIGhvbGRlcnNSaWdodCwgYXJnUG9zLCBhcnksIGFyaXR5XTsNCg0KICAgICAgaWYgKGRhdGEpIHsNCiAgICAgICAgbWVyZ2VEYXRhKG5ld0RhdGEsIGRhdGEpOw0KICAgICAgICBiaXRtYXNrID0gbmV3RGF0YVsxXTsNCiAgICAgICAgYXJpdHkgPSBuZXdEYXRhWzldOw0KICAgICAgfQ0KICAgICAgbmV3RGF0YVs5XSA9IGFyaXR5ID09IG51bGwNCiAgICAgICAgPyAoaXNCaW5kS2V5ID8gMCA6IGZ1bmMubGVuZ3RoKQ0KICAgICAgICA6IChuYXRpdmVNYXgoYXJpdHkgLSBsZW5ndGgsIDApIHx8IDApOw0KDQogICAgICBpZiAoYml0bWFzayA9PSBCSU5EX0ZMQUcpIHsNCiAgICAgICAgdmFyIHJlc3VsdCA9IGNyZWF0ZUJpbmRXcmFwcGVyKG5ld0RhdGFbMF0sIG5ld0RhdGFbMl0pOw0KICAgICAgfSBlbHNlIGlmICgoYml0bWFzayA9PSBQQVJUSUFMX0ZMQUcgfHwgYml0bWFzayA9PSAoQklORF9GTEFHIHwgUEFSVElBTF9GTEFHKSkgJiYgIW5ld0RhdGFbNF0ubGVuZ3RoKSB7DQogICAgICAgIHJlc3VsdCA9IGNyZWF0ZVBhcnRpYWxXcmFwcGVyLmFwcGx5KHVuZGVmaW5lZCwgbmV3RGF0YSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXN1bHQgPSBjcmVhdGVIeWJyaWRXcmFwcGVyLmFwcGx5KHVuZGVmaW5lZCwgbmV3RGF0YSk7DQogICAgICB9DQogICAgICB2YXIgc2V0dGVyID0gZGF0YSA/IGJhc2VTZXREYXRhIDogc2V0RGF0YTsNCiAgICAgIHJldHVybiBzZXR0ZXIocmVzdWx0LCBuZXdEYXRhKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsRGVlcGAgZm9yIGFycmF5cyB3aXRoIHN1cHBvcnQgZm9yDQogICAgICogcGFydGlhbCBkZWVwIGNvbXBhcmlzb25zLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY29tcGFyZS4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBvdGhlciBUaGUgb3RoZXIgYXJyYXkgdG8gY29tcGFyZS4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcXVhbEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGRldGVybWluZSBlcXVpdmFsZW50cyBvZiB2YWx1ZXMuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaW5nIGFycmF5cy4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0xvb3NlXSBTcGVjaWZ5IHBlcmZvcm1pbmcgcGFydGlhbCBjb21wYXJpc29ucy4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbc3RhY2tBXSBUcmFja3MgdHJhdmVyc2VkIGB2YWx1ZWAgb2JqZWN0cy4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbc3RhY2tCXSBUcmFja3MgdHJhdmVyc2VkIGBvdGhlcmAgb2JqZWN0cy4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGFycmF5cyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVxdWFsQXJyYXlzKGFycmF5LCBvdGhlciwgZXF1YWxGdW5jLCBjdXN0b21pemVyLCBpc0xvb3NlLCBzdGFja0EsIHN0YWNrQikgew0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgYXJyTGVuZ3RoID0gYXJyYXkubGVuZ3RoLA0KICAgICAgICAgIG90aExlbmd0aCA9IG90aGVyLmxlbmd0aDsNCg0KICAgICAgaWYgKGFyckxlbmd0aCAhPSBvdGhMZW5ndGggJiYgIShpc0xvb3NlICYmIG90aExlbmd0aCA+IGFyckxlbmd0aCkpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgICAgLy8gSWdub3JlIG5vbi1pbmRleCBwcm9wZXJ0aWVzLg0KICAgICAgd2hpbGUgKCsraW5kZXggPCBhcnJMZW5ndGgpIHsNCiAgICAgICAgdmFyIGFyclZhbHVlID0gYXJyYXlbaW5kZXhdLA0KICAgICAgICAgICAgb3RoVmFsdWUgPSBvdGhlcltpbmRleF0sDQogICAgICAgICAgICByZXN1bHQgPSBjdXN0b21pemVyID8gY3VzdG9taXplcihpc0xvb3NlID8gb3RoVmFsdWUgOiBhcnJWYWx1ZSwgaXNMb29zZSA/IGFyclZhbHVlIDogb3RoVmFsdWUsIGluZGV4KSA6IHVuZGVmaW5lZDsNCg0KICAgICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICBpZiAocmVzdWx0KSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIC8vIFJlY3Vyc2l2ZWx5IGNvbXBhcmUgYXJyYXlzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuDQogICAgICAgIGlmIChpc0xvb3NlKSB7DQogICAgICAgICAgaWYgKCFhcnJheVNvbWUob3RoZXIsIGZ1bmN0aW9uKG90aFZhbHVlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGFyclZhbHVlID09PSBvdGhWYWx1ZSB8fCBlcXVhbEZ1bmMoYXJyVmFsdWUsIG90aFZhbHVlLCBjdXN0b21pemVyLCBpc0xvb3NlLCBzdGFja0EsIHN0YWNrQik7DQogICAgICAgICAgICAgIH0pKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKCEoYXJyVmFsdWUgPT09IG90aFZhbHVlIHx8IGVxdWFsRnVuYyhhcnJWYWx1ZSwgb3RoVmFsdWUsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKSkpIHsNCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUlzRXF1YWxEZWVwYCBmb3IgY29tcGFyaW5nIG9iamVjdHMgb2YNCiAgICAgKiB0aGUgc2FtZSBgdG9TdHJpbmdUYWdgLg0KICAgICAqDQogICAgICogKipOb3RlOioqIFRoaXMgZnVuY3Rpb24gb25seSBzdXBwb3J0cyBjb21wYXJpbmcgdmFsdWVzIHdpdGggdGFncyBvZg0KICAgICAqIGBCb29sZWFuYCwgYERhdGVgLCBgRXJyb3JgLCBgTnVtYmVyYCwgYFJlZ0V4cGAsIG9yIGBTdHJpbmdgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWUgVGhlIG9iamVjdCB0byBjb21wYXJlLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlciBUaGUgb3RoZXIgb2JqZWN0IHRvIGNvbXBhcmUuDQogICAgICogQHBhcmFtIHtzdHJpbmd9IHRhZyBUaGUgYHRvU3RyaW5nVGFnYCBvZiB0aGUgb2JqZWN0cyB0byBjb21wYXJlLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgb2JqZWN0cyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVxdWFsQnlUYWcob2JqZWN0LCBvdGhlciwgdGFnKSB7DQogICAgICBzd2l0Y2ggKHRhZykgew0KICAgICAgICBjYXNlIGJvb2xUYWc6DQogICAgICAgIGNhc2UgZGF0ZVRhZzoNCiAgICAgICAgICAvLyBDb2VyY2UgZGF0ZXMgYW5kIGJvb2xlYW5zIHRvIG51bWJlcnMsIGRhdGVzIHRvIG1pbGxpc2Vjb25kcyBhbmQgYm9vbGVhbnMNCiAgICAgICAgICAvLyB0byBgMWAgb3IgYDBgIHRyZWF0aW5nIGludmFsaWQgZGF0ZXMgY29lcmNlZCB0byBgTmFOYCBhcyBub3QgZXF1YWwuDQogICAgICAgICAgcmV0dXJuICtvYmplY3QgPT0gK290aGVyOw0KDQogICAgICAgIGNhc2UgZXJyb3JUYWc6DQogICAgICAgICAgcmV0dXJuIG9iamVjdC5uYW1lID09IG90aGVyLm5hbWUgJiYgb2JqZWN0Lm1lc3NhZ2UgPT0gb3RoZXIubWVzc2FnZTsNCg0KICAgICAgICBjYXNlIG51bWJlclRhZzoNCiAgICAgICAgICAvLyBUcmVhdCBgTmFOYCB2cy4gYE5hTmAgYXMgZXF1YWwuDQogICAgICAgICAgcmV0dXJuIChvYmplY3QgIT0gK29iamVjdCkNCiAgICAgICAgICAgID8gb3RoZXIgIT0gK290aGVyDQogICAgICAgICAgICA6IG9iamVjdCA9PSArb3RoZXI7DQoNCiAgICAgICAgY2FzZSByZWdleHBUYWc6DQogICAgICAgIGNhc2Ugc3RyaW5nVGFnOg0KICAgICAgICAgIC8vIENvZXJjZSByZWdleGVzIHRvIHN0cmluZ3MgYW5kIHRyZWF0IHN0cmluZ3MgcHJpbWl0aXZlcyBhbmQgc3RyaW5nDQogICAgICAgICAgLy8gb2JqZWN0cyBhcyBlcXVhbC4gU2VlIGh0dHBzOi8vZXM1LmdpdGh1Yi5pby8jeDE1LjEwLjYuNCBmb3IgbW9yZSBkZXRhaWxzLg0KICAgICAgICAgIHJldHVybiBvYmplY3QgPT0gKG90aGVyICsgJycpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUlzRXF1YWxEZWVwYCBmb3Igb2JqZWN0cyB3aXRoIHN1cHBvcnQgZm9yDQogICAgICogcGFydGlhbCBkZWVwIGNvbXBhcmlzb25zLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY29tcGFyZS4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3RoZXIgVGhlIG90aGVyIG9iamVjdCB0byBjb21wYXJlLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGVxdWFsRnVuYyBUaGUgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGVxdWl2YWxlbnRzIG9mIHZhbHVlcy4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjb21wYXJpbmcgdmFsdWVzLg0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzTG9vc2VdIFNwZWNpZnkgcGVyZm9ybWluZyBwYXJ0aWFsIGNvbXBhcmlzb25zLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtzdGFja0FdIFRyYWNrcyB0cmF2ZXJzZWQgYHZhbHVlYCBvYmplY3RzLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtzdGFja0JdIFRyYWNrcyB0cmF2ZXJzZWQgYG90aGVyYCBvYmplY3RzLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgb2JqZWN0cyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVxdWFsT2JqZWN0cyhvYmplY3QsIG90aGVyLCBlcXVhbEZ1bmMsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKSB7DQogICAgICB2YXIgb2JqUHJvcHMgPSBrZXlzKG9iamVjdCksDQogICAgICAgICAgb2JqTGVuZ3RoID0gb2JqUHJvcHMubGVuZ3RoLA0KICAgICAgICAgIG90aFByb3BzID0ga2V5cyhvdGhlciksDQogICAgICAgICAgb3RoTGVuZ3RoID0gb3RoUHJvcHMubGVuZ3RoOw0KDQogICAgICBpZiAob2JqTGVuZ3RoICE9IG90aExlbmd0aCAmJiAhaXNMb29zZSkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgICB2YXIgaW5kZXggPSBvYmpMZW5ndGg7DQogICAgICB3aGlsZSAoaW5kZXgtLSkgew0KICAgICAgICB2YXIga2V5ID0gb2JqUHJvcHNbaW5kZXhdOw0KICAgICAgICBpZiAoIShpc0xvb3NlID8ga2V5IGluIG90aGVyIDogaGFzT3duUHJvcGVydHkuY2FsbChvdGhlciwga2V5KSkpIHsNCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHZhciBza2lwQ3RvciA9IGlzTG9vc2U7DQogICAgICB3aGlsZSAoKytpbmRleCA8IG9iakxlbmd0aCkgew0KICAgICAgICBrZXkgPSBvYmpQcm9wc1tpbmRleF07DQogICAgICAgIHZhciBvYmpWYWx1ZSA9IG9iamVjdFtrZXldLA0KICAgICAgICAgICAgb3RoVmFsdWUgPSBvdGhlcltrZXldLA0KICAgICAgICAgICAgcmVzdWx0ID0gY3VzdG9taXplciA/IGN1c3RvbWl6ZXIoaXNMb29zZSA/IG90aFZhbHVlIDogb2JqVmFsdWUsIGlzTG9vc2U/IG9ialZhbHVlIDogb3RoVmFsdWUsIGtleSkgOiB1bmRlZmluZWQ7DQoNCiAgICAgICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuDQogICAgICAgIGlmICghKHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gZXF1YWxGdW5jKG9ialZhbHVlLCBvdGhWYWx1ZSwgY3VzdG9taXplciwgaXNMb29zZSwgc3RhY2tBLCBzdGFja0IpIDogcmVzdWx0KSkgew0KICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBza2lwQ3RvciB8fCAoc2tpcEN0b3IgPSBrZXkgPT0gJ2NvbnN0cnVjdG9yJyk7DQogICAgICB9DQogICAgICBpZiAoIXNraXBDdG9yKSB7DQogICAgICAgIHZhciBvYmpDdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yLA0KICAgICAgICAgICAgb3RoQ3RvciA9IG90aGVyLmNvbnN0cnVjdG9yOw0KDQogICAgICAgIC8vIE5vbiBgT2JqZWN0YCBvYmplY3QgaW5zdGFuY2VzIHdpdGggZGlmZmVyZW50IGNvbnN0cnVjdG9ycyBhcmUgbm90IGVxdWFsLg0KICAgICAgICBpZiAob2JqQ3RvciAhPSBvdGhDdG9yICYmDQogICAgICAgICAgICAoJ2NvbnN0cnVjdG9yJyBpbiBvYmplY3QgJiYgJ2NvbnN0cnVjdG9yJyBpbiBvdGhlcikgJiYNCiAgICAgICAgICAgICEodHlwZW9mIG9iakN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBvYmpDdG9yIGluc3RhbmNlb2Ygb2JqQ3RvciAmJg0KICAgICAgICAgICAgICB0eXBlb2Ygb3RoQ3RvciA9PSAnZnVuY3Rpb24nICYmIG90aEN0b3IgaW5zdGFuY2VvZiBvdGhDdG9yKSkgew0KICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0cyB0aGUgYXBwcm9wcmlhdGUgImNhbGxiYWNrIiBmdW5jdGlvbi4gSWYgdGhlIGBfLmNhbGxiYWNrYCBtZXRob2QgaXMNCiAgICAgKiBjdXN0b21pemVkIHRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgY3VzdG9tIG1ldGhvZCwgb3RoZXJ3aXNlIGl0IHJldHVybnMNCiAgICAgKiB0aGUgYGJhc2VDYWxsYmFja2AgZnVuY3Rpb24uIElmIGFyZ3VtZW50cyBhcmUgcHJvdmlkZWQgdGhlIGNob3NlbiBmdW5jdGlvbg0KICAgICAqIGlzIGludm9rZWQgd2l0aCB0aGVtIGFuZCBpdHMgcmVzdWx0IGlzIHJldHVybmVkLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIGNob3NlbiBmdW5jdGlvbiBvciBpdHMgcmVzdWx0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGdldENhbGxiYWNrKGZ1bmMsIHRoaXNBcmcsIGFyZ0NvdW50KSB7DQogICAgICB2YXIgcmVzdWx0ID0gbG9kYXNoLmNhbGxiYWNrIHx8IGNhbGxiYWNrOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ID09PSBjYWxsYmFjayA/IGJhc2VDYWxsYmFjayA6IHJlc3VsdDsNCiAgICAgIHJldHVybiBhcmdDb3VudCA/IHJlc3VsdChmdW5jLCB0aGlzQXJnLCBhcmdDb3VudCkgOiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0cyBtZXRhZGF0YSBmb3IgYGZ1bmNgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBxdWVyeS4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbWV0YWRhdGEgZm9yIGBmdW5jYC4NCiAgICAgKi8NCiAgICB2YXIgZ2V0RGF0YSA9ICFtZXRhTWFwID8gbm9vcCA6IGZ1bmN0aW9uKGZ1bmMpIHsNCiAgICAgIHJldHVybiBtZXRhTWFwLmdldChmdW5jKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogR2V0cyB0aGUgbmFtZSBvZiBgZnVuY2AuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHF1ZXJ5Lg0KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGZ1bmN0aW9uIG5hbWUuDQogICAgICovDQogICAgZnVuY3Rpb24gZ2V0RnVuY05hbWUoZnVuYykgew0KICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMubmFtZSwNCiAgICAgICAgICBhcnJheSA9IHJlYWxOYW1lc1tyZXN1bHRdLA0KICAgICAgICAgIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMDsNCg0KICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7DQogICAgICAgIHZhciBkYXRhID0gYXJyYXlbbGVuZ3RoXSwNCiAgICAgICAgICAgIG90aGVyRnVuYyA9IGRhdGEuZnVuYzsNCiAgICAgICAgaWYgKG90aGVyRnVuYyA9PSBudWxsIHx8IG90aGVyRnVuYyA9PSBmdW5jKSB7DQogICAgICAgICAgcmV0dXJuIGRhdGEubmFtZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXRzIHRoZSBhcHByb3ByaWF0ZSAiaW5kZXhPZiIgZnVuY3Rpb24uIElmIHRoZSBgXy5pbmRleE9mYCBtZXRob2QgaXMNCiAgICAgKiBjdXN0b21pemVkIHRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgY3VzdG9tIG1ldGhvZCwgb3RoZXJ3aXNlIGl0IHJldHVybnMNCiAgICAgKiB0aGUgYGJhc2VJbmRleE9mYCBmdW5jdGlvbi4gSWYgYXJndW1lbnRzIGFyZSBwcm92aWRlZCB0aGUgY2hvc2VuIGZ1bmN0aW9uDQogICAgICogaXMgaW52b2tlZCB3aXRoIHRoZW0gYW5kIGl0cyByZXN1bHQgaXMgcmV0dXJuZWQuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbnxudW1iZXJ9IFJldHVybnMgdGhlIGNob3NlbiBmdW5jdGlvbiBvciBpdHMgcmVzdWx0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGdldEluZGV4T2YoY29sbGVjdGlvbiwgdGFyZ2V0LCBmcm9tSW5kZXgpIHsNCiAgICAgIHZhciByZXN1bHQgPSBsb2Rhc2guaW5kZXhPZiB8fCBpbmRleE9mOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ID09PSBpbmRleE9mID8gYmFzZUluZGV4T2YgOiByZXN1bHQ7DQogICAgICByZXR1cm4gY29sbGVjdGlvbiA/IHJlc3VsdChjb2xsZWN0aW9uLCB0YXJnZXQsIGZyb21JbmRleCkgOiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0cyB0aGUgImxlbmd0aCIgcHJvcGVydHkgdmFsdWUgb2YgYG9iamVjdGAuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGF2b2lkIGEgW0pJVCBidWddKGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0xNDI3OTIpDQogICAgICogdGhhdCBhZmZlY3RzIFNhZmFyaSBvbiBhdCBsZWFzdCBpT1MgOC4xLTguMyBBUk02NC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5Lg0KICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSAibGVuZ3RoIiB2YWx1ZS4NCiAgICAgKi8NCiAgICB2YXIgZ2V0TGVuZ3RoID0gYmFzZVByb3BlcnR5KCdsZW5ndGgnKTsNCg0KICAgIC8qKg0KICAgICAqIEdldHMgdGhlIHByb3BlcnkgbmFtZXMsIHZhbHVlcywgYW5kIGNvbXBhcmUgZmxhZ3Mgb2YgYG9iamVjdGAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG1hdGNoIGRhdGEgb2YgYG9iamVjdGAuDQogICAgICovDQogICAgZnVuY3Rpb24gZ2V0TWF0Y2hEYXRhKG9iamVjdCkgew0KICAgICAgdmFyIHJlc3VsdCA9IHBhaXJzKG9iamVjdCksDQogICAgICAgICAgbGVuZ3RoID0gcmVzdWx0Lmxlbmd0aDsNCg0KICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7DQogICAgICAgIHJlc3VsdFtsZW5ndGhdWzJdID0gaXNTdHJpY3RDb21wYXJhYmxlKHJlc3VsdFtsZW5ndGhdWzFdKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0cyB0aGUgbmF0aXZlIGZ1bmN0aW9uIGF0IGBrZXlgIG9mIGBvYmplY3RgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuDQogICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBtZXRob2QgdG8gZ2V0Lg0KICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBmdW5jdGlvbiBpZiBpdCdzIG5hdGl2ZSwgZWxzZSBgdW5kZWZpbmVkYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXROYXRpdmUob2JqZWN0LCBrZXkpIHsNCiAgICAgIHZhciB2YWx1ZSA9IG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogb2JqZWN0W2tleV07DQogICAgICByZXR1cm4gaXNOYXRpdmUodmFsdWUpID8gdmFsdWUgOiB1bmRlZmluZWQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0cyB0aGUgdmlldywgYXBwbHlpbmcgYW55IGB0cmFuc2Zvcm1zYCB0byB0aGUgYHN0YXJ0YCBhbmQgYGVuZGAgcG9zaXRpb25zLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgVGhlIHN0YXJ0IG9mIHRoZSB2aWV3Lg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBlbmQgVGhlIGVuZCBvZiB0aGUgdmlldy4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbdHJhbnNmb3Jtc10gVGhlIHRyYW5zZm9ybWF0aW9ucyB0byBhcHBseSB0byB0aGUgdmlldy4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBgc3RhcnRgIGFuZCBgZW5kYA0KICAgICAqICBwb3NpdGlvbnMgb2YgdGhlIHZpZXcuDQogICAgICovDQogICAgZnVuY3Rpb24gZ2V0VmlldyhzdGFydCwgZW5kLCB0cmFuc2Zvcm1zKSB7DQogICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICBsZW5ndGggPSB0cmFuc2Zvcm1zID8gdHJhbnNmb3Jtcy5sZW5ndGggOiAwOw0KDQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICB2YXIgZGF0YSA9IHRyYW5zZm9ybXNbaW5kZXhdLA0KICAgICAgICAgICAgc2l6ZSA9IGRhdGEuc2l6ZTsNCg0KICAgICAgICBzd2l0Y2ggKGRhdGEudHlwZSkgew0KICAgICAgICAgIGNhc2UgJ2Ryb3AnOiAgICAgIHN0YXJ0ICs9IHNpemU7IGJyZWFrOw0KICAgICAgICAgIGNhc2UgJ2Ryb3BSaWdodCc6IGVuZCAtPSBzaXplOyBicmVhazsNCiAgICAgICAgICBjYXNlICd0YWtlJzogICAgICBlbmQgPSBuYXRpdmVNaW4oZW5kLCBzdGFydCArIHNpemUpOyBicmVhazsNCiAgICAgICAgICBjYXNlICd0YWtlUmlnaHQnOiBzdGFydCA9IG5hdGl2ZU1heChzdGFydCwgZW5kIC0gc2l6ZSk7IGJyZWFrOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4geyAnc3RhcnQnOiBzdGFydCwgJ2VuZCc6IGVuZCB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGFuIGFycmF5IGNsb25lLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY2xvbmUuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBpbml0aWFsaXplZCBjbG9uZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpbml0Q2xvbmVBcnJheShhcnJheSkgew0KICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwNCiAgICAgICAgICByZXN1bHQgPSBuZXcgYXJyYXkuY29uc3RydWN0b3IobGVuZ3RoKTsNCg0KICAgICAgLy8gQWRkIGFycmF5IHByb3BlcnRpZXMgYXNzaWduZWQgYnkgYFJlZ0V4cCNleGVjYC4NCiAgICAgIGlmIChsZW5ndGggJiYgdHlwZW9mIGFycmF5WzBdID09ICdzdHJpbmcnICYmIGhhc093blByb3BlcnR5LmNhbGwoYXJyYXksICdpbmRleCcpKSB7DQogICAgICAgIHJlc3VsdC5pbmRleCA9IGFycmF5LmluZGV4Ow0KICAgICAgICByZXN1bHQuaW5wdXQgPSBhcnJheS5pbnB1dDsNCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgYW4gb2JqZWN0IGNsb25lLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY2xvbmUuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgaW5pdGlhbGl6ZWQgY2xvbmUuDQogICAgICovDQogICAgZnVuY3Rpb24gaW5pdENsb25lT2JqZWN0KG9iamVjdCkgew0KICAgICAgdmFyIEN0b3IgPSBvYmplY3QuY29uc3RydWN0b3I7DQogICAgICBpZiAoISh0eXBlb2YgQ3RvciA9PSAnZnVuY3Rpb24nICYmIEN0b3IgaW5zdGFuY2VvZiBDdG9yKSkgew0KICAgICAgICBDdG9yID0gT2JqZWN0Ow0KICAgICAgfQ0KICAgICAgcmV0dXJuIG5ldyBDdG9yOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGFuIG9iamVjdCBjbG9uZSBiYXNlZCBvbiBpdHMgYHRvU3RyaW5nVGFnYC4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGlzIGZ1bmN0aW9uIG9ubHkgc3VwcG9ydHMgY2xvbmluZyB2YWx1ZXMgd2l0aCB0YWdzIG9mDQogICAgICogYEJvb2xlYW5gLCBgRGF0ZWAsIGBFcnJvcmAsIGBOdW1iZXJgLCBgUmVnRXhwYCwgb3IgYFN0cmluZ2AuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBjbG9uZS4NCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdGFnIFRoZSBgdG9TdHJpbmdUYWdgIG9mIHRoZSBvYmplY3QgdG8gY2xvbmUuDQogICAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBpbml0aWFsaXplZCBjbG9uZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpbml0Q2xvbmVCeVRhZyhvYmplY3QsIHRhZywgaXNEZWVwKSB7DQogICAgICB2YXIgQ3RvciA9IG9iamVjdC5jb25zdHJ1Y3RvcjsNCiAgICAgIHN3aXRjaCAodGFnKSB7DQogICAgICAgIGNhc2UgYXJyYXlCdWZmZXJUYWc6DQogICAgICAgICAgcmV0dXJuIGJ1ZmZlckNsb25lKG9iamVjdCk7DQoNCiAgICAgICAgY2FzZSBib29sVGFnOg0KICAgICAgICBjYXNlIGRhdGVUYWc6DQogICAgICAgICAgcmV0dXJuIG5ldyBDdG9yKCtvYmplY3QpOw0KDQogICAgICAgIGNhc2UgZmxvYXQzMlRhZzogY2FzZSBmbG9hdDY0VGFnOg0KICAgICAgICBjYXNlIGludDhUYWc6IGNhc2UgaW50MTZUYWc6IGNhc2UgaW50MzJUYWc6DQogICAgICAgIGNhc2UgdWludDhUYWc6IGNhc2UgdWludDhDbGFtcGVkVGFnOiBjYXNlIHVpbnQxNlRhZzogY2FzZSB1aW50MzJUYWc6DQogICAgICAgICAgdmFyIGJ1ZmZlciA9IG9iamVjdC5idWZmZXI7DQogICAgICAgICAgcmV0dXJuIG5ldyBDdG9yKGlzRGVlcCA/IGJ1ZmZlckNsb25lKGJ1ZmZlcikgOiBidWZmZXIsIG9iamVjdC5ieXRlT2Zmc2V0LCBvYmplY3QubGVuZ3RoKTsNCg0KICAgICAgICBjYXNlIG51bWJlclRhZzoNCiAgICAgICAgY2FzZSBzdHJpbmdUYWc6DQogICAgICAgICAgcmV0dXJuIG5ldyBDdG9yKG9iamVjdCk7DQoNCiAgICAgICAgY2FzZSByZWdleHBUYWc6DQogICAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBDdG9yKG9iamVjdC5zb3VyY2UsIHJlRmxhZ3MuZXhlYyhvYmplY3QpKTsNCiAgICAgICAgICByZXN1bHQubGFzdEluZGV4ID0gb2JqZWN0Lmxhc3RJbmRleDsNCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW52b2tlcyB0aGUgbWV0aG9kIGF0IGBwYXRoYCBvbiBgb2JqZWN0YC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5Lg0KICAgICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIG9mIHRoZSBtZXRob2QgdG8gaW52b2tlLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFyZ3MgVGhlIGFyZ3VtZW50cyB0byBpbnZva2UgdGhlIG1ldGhvZCB3aXRoLg0KICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXN1bHQgb2YgdGhlIGludm9rZWQgbWV0aG9kLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGludm9rZVBhdGgob2JqZWN0LCBwYXRoLCBhcmdzKSB7DQogICAgICBpZiAob2JqZWN0ICE9IG51bGwgJiYgIWlzS2V5KHBhdGgsIG9iamVjdCkpIHsNCiAgICAgICAgcGF0aCA9IHRvUGF0aChwYXRoKTsNCiAgICAgICAgb2JqZWN0ID0gcGF0aC5sZW5ndGggPT0gMSA/IG9iamVjdCA6IGJhc2VHZXQob2JqZWN0LCBiYXNlU2xpY2UocGF0aCwgMCwgLTEpKTsNCiAgICAgICAgcGF0aCA9IGxhc3QocGF0aCk7DQogICAgICB9DQogICAgICB2YXIgZnVuYyA9IG9iamVjdCA9PSBudWxsID8gb2JqZWN0IDogb2JqZWN0W3BhdGhdOw0KICAgICAgcmV0dXJuIGZ1bmMgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IGZ1bmMuYXBwbHkob2JqZWN0LCBhcmdzKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhcnJheS1saWtlLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhcnJheS1saWtlLCBlbHNlIGBmYWxzZWAuDQogICAgICovDQogICAgZnVuY3Rpb24gaXNBcnJheUxpa2UodmFsdWUpIHsNCiAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIGlzTGVuZ3RoKGdldExlbmd0aCh2YWx1ZSkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgYXJyYXktbGlrZSBpbmRleC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGg9TUFYX1NBRkVfSU5URUdFUl0gVGhlIHVwcGVyIGJvdW5kcyBvZiBhIHZhbGlkIGluZGV4Lg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgaW5kZXgsIGVsc2UgYGZhbHNlYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc0luZGV4KHZhbHVlLCBsZW5ndGgpIHsNCiAgICAgIHZhbHVlID0gKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyB8fCByZUlzVWludC50ZXN0KHZhbHVlKSkgPyArdmFsdWUgOiAtMTsNCiAgICAgIGxlbmd0aCA9IGxlbmd0aCA9PSBudWxsID8gTUFYX1NBRkVfSU5URUdFUiA6IGxlbmd0aDsNCiAgICAgIHJldHVybiB2YWx1ZSA+IC0xICYmIHZhbHVlICUgMSA9PSAwICYmIHZhbHVlIDwgbGVuZ3RoOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiB0aGUgcHJvdmlkZWQgYXJndW1lbnRzIGFyZSBmcm9tIGFuIGl0ZXJhdGVlIGNhbGwuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHBvdGVudGlhbCBpdGVyYXRlZSB2YWx1ZSBhcmd1bWVudC4NCiAgICAgKiBAcGFyYW0geyp9IGluZGV4IFRoZSBwb3RlbnRpYWwgaXRlcmF0ZWUgaW5kZXggb3Iga2V5IGFyZ3VtZW50Lg0KICAgICAqIEBwYXJhbSB7Kn0gb2JqZWN0IFRoZSBwb3RlbnRpYWwgaXRlcmF0ZWUgb2JqZWN0IGFyZ3VtZW50Lg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYXJndW1lbnRzIGFyZSBmcm9tIGFuIGl0ZXJhdGVlIGNhbGwsIGVsc2UgYGZhbHNlYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc0l0ZXJhdGVlQ2FsbCh2YWx1ZSwgaW5kZXgsIG9iamVjdCkgew0KICAgICAgaWYgKCFpc09iamVjdChvYmplY3QpKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICAgIHZhciB0eXBlID0gdHlwZW9mIGluZGV4Ow0KICAgICAgaWYgKHR5cGUgPT0gJ251bWJlcicNCiAgICAgICAgICA/IChpc0FycmF5TGlrZShvYmplY3QpICYmIGlzSW5kZXgoaW5kZXgsIG9iamVjdC5sZW5ndGgpKQ0KICAgICAgICAgIDogKHR5cGUgPT0gJ3N0cmluZycgJiYgaW5kZXggaW4gb2JqZWN0KSkgew0KICAgICAgICB2YXIgb3RoZXIgPSBvYmplY3RbaW5kZXhdOw0KICAgICAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlID8gKHZhbHVlID09PSBvdGhlcikgOiAob3RoZXIgIT09IG90aGVyKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHByb3BlcnR5IG5hbWUgYW5kIG5vdCBhIHByb3BlcnR5IHBhdGguDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IHRvIHF1ZXJ5IGtleXMgb24uDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBwcm9wZXJ0eSBuYW1lLCBlbHNlIGBmYWxzZWAuDQogICAgICovDQogICAgZnVuY3Rpb24gaXNLZXkodmFsdWUsIG9iamVjdCkgew0KICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7DQogICAgICBpZiAoKHR5cGUgPT0gJ3N0cmluZycgJiYgcmVJc1BsYWluUHJvcC50ZXN0KHZhbHVlKSkgfHwgdHlwZSA9PSAnbnVtYmVyJykgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmIChpc0FycmF5KHZhbHVlKSkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgICB2YXIgcmVzdWx0ID0gIXJlSXNEZWVwUHJvcC50ZXN0KHZhbHVlKTsNCiAgICAgIHJldHVybiByZXN1bHQgfHwgKG9iamVjdCAhPSBudWxsICYmIHZhbHVlIGluIHRvT2JqZWN0KG9iamVjdCkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgZnVuY2AgaGFzIGEgbGF6eSBjb3VudGVycGFydC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2hlY2suDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBmdW5jYCBoYXMgYSBsYXp5IGNvdW50ZXJwYXJ0LCBlbHNlIGBmYWxzZWAuDQogICAgICovDQogICAgZnVuY3Rpb24gaXNMYXppYWJsZShmdW5jKSB7DQogICAgICB2YXIgZnVuY05hbWUgPSBnZXRGdW5jTmFtZShmdW5jKTsNCiAgICAgIGlmICghKGZ1bmNOYW1lIGluIExhenlXcmFwcGVyLnByb3RvdHlwZSkpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgICAgdmFyIG90aGVyID0gbG9kYXNoW2Z1bmNOYW1lXTsNCiAgICAgIGlmIChmdW5jID09PSBvdGhlcikgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIHZhciBkYXRhID0gZ2V0RGF0YShvdGhlcik7DQogICAgICByZXR1cm4gISFkYXRhICYmIGZ1bmMgPT09IGRhdGFbMF07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSB2YWxpZCBhcnJheS1saWtlIGxlbmd0aC4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGlzIGZ1bmN0aW9uIGlzIGJhc2VkIG9uIFtgVG9MZW5ndGhgXShodHRwczovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtdG9sZW5ndGgpLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGxlbmd0aCwgZWxzZSBgZmFsc2VgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzTGVuZ3RoKHZhbHVlKSB7DQogICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdudW1iZXInICYmIHZhbHVlID4gLTEgJiYgdmFsdWUgJSAxID09IDAgJiYgdmFsdWUgPD0gTUFYX1NBRkVfSU5URUdFUjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBzdWl0YWJsZSBmb3Igc3RyaWN0IGVxdWFsaXR5IGNvbXBhcmlzb25zLCBpLmUuIGA9PT1gLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpZiBzdWl0YWJsZSBmb3Igc3RyaWN0DQogICAgICogIGVxdWFsaXR5IGNvbXBhcmlzb25zLCBlbHNlIGBmYWxzZWAuDQogICAgICovDQogICAgZnVuY3Rpb24gaXNTdHJpY3RDb21wYXJhYmxlKHZhbHVlKSB7DQogICAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlICYmICFpc09iamVjdCh2YWx1ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTWVyZ2VzIHRoZSBmdW5jdGlvbiBtZXRhZGF0YSBvZiBgc291cmNlYCBpbnRvIGBkYXRhYC4NCiAgICAgKg0KICAgICAqIE1lcmdpbmcgbWV0YWRhdGEgcmVkdWNlcyB0aGUgbnVtYmVyIG9mIHdyYXBwZXJzIHJlcXVpcmVkIHRvIGludm9rZSBhIGZ1bmN0aW9uLg0KICAgICAqIFRoaXMgaXMgcG9zc2libGUgYmVjYXVzZSBtZXRob2RzIGxpa2UgYF8uYmluZGAsIGBfLmN1cnJ5YCwgYW5kIGBfLnBhcnRpYWxgDQogICAgICogbWF5IGJlIGFwcGxpZWQgcmVnYXJkbGVzcyBvZiBleGVjdXRpb24gb3JkZXIuIE1ldGhvZHMgbGlrZSBgXy5hcnlgIGFuZCBgXy5yZWFyZ2ANCiAgICAgKiBhdWdtZW50IGZ1bmN0aW9uIGFyZ3VtZW50cywgbWFraW5nIHRoZSBvcmRlciBpbiB3aGljaCB0aGV5IGFyZSBleGVjdXRlZCBpbXBvcnRhbnQsDQogICAgICogcHJldmVudGluZyB0aGUgbWVyZ2luZyBvZiBtZXRhZGF0YS4gSG93ZXZlciwgd2UgbWFrZSBhbiBleGNlcHRpb24gZm9yIGEgc2FmZQ0KICAgICAqIGNvbW1vbiBjYXNlIHdoZXJlIGN1cnJpZWQgZnVuY3Rpb25zIGhhdmUgYF8uYXJ5YCBhbmQgb3IgYF8ucmVhcmdgIGFwcGxpZWQuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGRhdGEgVGhlIGRlc3RpbmF0aW9uIG1ldGFkYXRhLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IHNvdXJjZSBUaGUgc291cmNlIG1ldGFkYXRhLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgZGF0YWAuDQogICAgICovDQogICAgZnVuY3Rpb24gbWVyZ2VEYXRhKGRhdGEsIHNvdXJjZSkgew0KICAgICAgdmFyIGJpdG1hc2sgPSBkYXRhWzFdLA0KICAgICAgICAgIHNyY0JpdG1hc2sgPSBzb3VyY2VbMV0sDQogICAgICAgICAgbmV3Qml0bWFzayA9IGJpdG1hc2sgfCBzcmNCaXRtYXNrLA0KICAgICAgICAgIGlzQ29tbW9uID0gbmV3Qml0bWFzayA8IEFSWV9GTEFHOw0KDQogICAgICB2YXIgaXNDb21ibyA9DQogICAgICAgIChzcmNCaXRtYXNrID09IEFSWV9GTEFHICYmIGJpdG1hc2sgPT0gQ1VSUllfRkxBRykgfHwNCiAgICAgICAgKHNyY0JpdG1hc2sgPT0gQVJZX0ZMQUcgJiYgYml0bWFzayA9PSBSRUFSR19GTEFHICYmIGRhdGFbN10ubGVuZ3RoIDw9IHNvdXJjZVs4XSkgfHwNCiAgICAgICAgKHNyY0JpdG1hc2sgPT0gKEFSWV9GTEFHIHwgUkVBUkdfRkxBRykgJiYgYml0bWFzayA9PSBDVVJSWV9GTEFHKTsNCg0KICAgICAgLy8gRXhpdCBlYXJseSBpZiBtZXRhZGF0YSBjYW4ndCBiZSBtZXJnZWQuDQogICAgICBpZiAoIShpc0NvbW1vbiB8fCBpc0NvbWJvKSkgew0KICAgICAgICByZXR1cm4gZGF0YTsNCiAgICAgIH0NCiAgICAgIC8vIFVzZSBzb3VyY2UgYHRoaXNBcmdgIGlmIGF2YWlsYWJsZS4NCiAgICAgIGlmIChzcmNCaXRtYXNrICYgQklORF9GTEFHKSB7DQogICAgICAgIGRhdGFbMl0gPSBzb3VyY2VbMl07DQogICAgICAgIC8vIFNldCB3aGVuIGN1cnJ5aW5nIGEgYm91bmQgZnVuY3Rpb24uDQogICAgICAgIG5ld0JpdG1hc2sgfD0gKGJpdG1hc2sgJiBCSU5EX0ZMQUcpID8gMCA6IENVUlJZX0JPVU5EX0ZMQUc7DQogICAgICB9DQogICAgICAvLyBDb21wb3NlIHBhcnRpYWwgYXJndW1lbnRzLg0KICAgICAgdmFyIHZhbHVlID0gc291cmNlWzNdOw0KICAgICAgaWYgKHZhbHVlKSB7DQogICAgICAgIHZhciBwYXJ0aWFscyA9IGRhdGFbM107DQogICAgICAgIGRhdGFbM10gPSBwYXJ0aWFscyA/IGNvbXBvc2VBcmdzKHBhcnRpYWxzLCB2YWx1ZSwgc291cmNlWzRdKSA6IGFycmF5Q29weSh2YWx1ZSk7DQogICAgICAgIGRhdGFbNF0gPSBwYXJ0aWFscyA/IHJlcGxhY2VIb2xkZXJzKGRhdGFbM10sIFBMQUNFSE9MREVSKSA6IGFycmF5Q29weShzb3VyY2VbNF0pOw0KICAgICAgfQ0KICAgICAgLy8gQ29tcG9zZSBwYXJ0aWFsIHJpZ2h0IGFyZ3VtZW50cy4NCiAgICAgIHZhbHVlID0gc291cmNlWzVdOw0KICAgICAgaWYgKHZhbHVlKSB7DQogICAgICAgIHBhcnRpYWxzID0gZGF0YVs1XTsNCiAgICAgICAgZGF0YVs1XSA9IHBhcnRpYWxzID8gY29tcG9zZUFyZ3NSaWdodChwYXJ0aWFscywgdmFsdWUsIHNvdXJjZVs2XSkgOiBhcnJheUNvcHkodmFsdWUpOw0KICAgICAgICBkYXRhWzZdID0gcGFydGlhbHMgPyByZXBsYWNlSG9sZGVycyhkYXRhWzVdLCBQTEFDRUhPTERFUikgOiBhcnJheUNvcHkoc291cmNlWzZdKTsNCiAgICAgIH0NCiAgICAgIC8vIFVzZSBzb3VyY2UgYGFyZ1Bvc2AgaWYgYXZhaWxhYmxlLg0KICAgICAgdmFsdWUgPSBzb3VyY2VbN107DQogICAgICBpZiAodmFsdWUpIHsNCiAgICAgICAgZGF0YVs3XSA9IGFycmF5Q29weSh2YWx1ZSk7DQogICAgICB9DQogICAgICAvLyBVc2Ugc291cmNlIGBhcnlgIGlmIGl0J3Mgc21hbGxlci4NCiAgICAgIGlmIChzcmNCaXRtYXNrICYgQVJZX0ZMQUcpIHsNCiAgICAgICAgZGF0YVs4XSA9IGRhdGFbOF0gPT0gbnVsbCA/IHNvdXJjZVs4XSA6IG5hdGl2ZU1pbihkYXRhWzhdLCBzb3VyY2VbOF0pOw0KICAgICAgfQ0KICAgICAgLy8gVXNlIHNvdXJjZSBgYXJpdHlgIGlmIG9uZSBpcyBub3QgcHJvdmlkZWQuDQogICAgICBpZiAoZGF0YVs5XSA9PSBudWxsKSB7DQogICAgICAgIGRhdGFbOV0gPSBzb3VyY2VbOV07DQogICAgICB9DQogICAgICAvLyBVc2Ugc291cmNlIGBmdW5jYCBhbmQgbWVyZ2UgYml0bWFza3MuDQogICAgICBkYXRhWzBdID0gc291cmNlWzBdOw0KICAgICAgZGF0YVsxXSA9IG5ld0JpdG1hc2s7DQoNCiAgICAgIHJldHVybiBkYXRhOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5waWNrYCB3aGljaCBwaWNrcyBgb2JqZWN0YCBwcm9wZXJ0aWVzIHNwZWNpZmllZA0KICAgICAqIGJ5IGBwcm9wc2AuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIHNvdXJjZSBvYmplY3QuDQogICAgICogQHBhcmFtIHtzdHJpbmdbXX0gcHJvcHMgVGhlIHByb3BlcnR5IG5hbWVzIHRvIHBpY2suDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IG9iamVjdC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBwaWNrQnlBcnJheShvYmplY3QsIHByb3BzKSB7DQogICAgICBvYmplY3QgPSB0b09iamVjdChvYmplY3QpOw0KDQogICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGgsDQogICAgICAgICAgcmVzdWx0ID0ge307DQoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07DQogICAgICAgIGlmIChrZXkgaW4gb2JqZWN0KSB7DQogICAgICAgICAgcmVzdWx0W2tleV0gPSBvYmplY3Rba2V5XTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8ucGlja2Agd2hpY2ggcGlja3MgYG9iamVjdGAgcHJvcGVydGllcyBgcHJlZGljYXRlYA0KICAgICAqIHJldHVybnMgdHJ1dGh5IGZvci4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgc291cmNlIG9iamVjdC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgb2JqZWN0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHBpY2tCeUNhbGxiYWNrKG9iamVjdCwgcHJlZGljYXRlKSB7DQogICAgICB2YXIgcmVzdWx0ID0ge307DQogICAgICBiYXNlRm9ySW4ob2JqZWN0LCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmplY3QpIHsNCiAgICAgICAgaWYgKHByZWRpY2F0ZSh2YWx1ZSwga2V5LCBvYmplY3QpKSB7DQogICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlb3JkZXIgYGFycmF5YCBhY2NvcmRpbmcgdG8gdGhlIHNwZWNpZmllZCBpbmRleGVzIHdoZXJlIHRoZSBlbGVtZW50IGF0DQogICAgICogdGhlIGZpcnN0IGluZGV4IGlzIGFzc2lnbmVkIGFzIHRoZSBmaXJzdCBlbGVtZW50LCB0aGUgZWxlbWVudCBhdA0KICAgICAqIHRoZSBzZWNvbmQgaW5kZXggaXMgYXNzaWduZWQgYXMgdGhlIHNlY29uZCBlbGVtZW50LCBhbmQgc28gb24uDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byByZW9yZGVyLg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGluZGV4ZXMgVGhlIGFycmFuZ2VkIGFycmF5IGluZGV4ZXMuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuDQogICAgICovDQogICAgZnVuY3Rpb24gcmVvcmRlcihhcnJheSwgaW5kZXhlcykgew0KICAgICAgdmFyIGFyckxlbmd0aCA9IGFycmF5Lmxlbmd0aCwNCiAgICAgICAgICBsZW5ndGggPSBuYXRpdmVNaW4oaW5kZXhlcy5sZW5ndGgsIGFyckxlbmd0aCksDQogICAgICAgICAgb2xkQXJyYXkgPSBhcnJheUNvcHkoYXJyYXkpOw0KDQogICAgICB3aGlsZSAobGVuZ3RoLS0pIHsNCiAgICAgICAgdmFyIGluZGV4ID0gaW5kZXhlc1tsZW5ndGhdOw0KICAgICAgICBhcnJheVtsZW5ndGhdID0gaXNJbmRleChpbmRleCwgYXJyTGVuZ3RoKSA/IG9sZEFycmF5W2luZGV4XSA6IHVuZGVmaW5lZDsNCiAgICAgIH0NCiAgICAgIHJldHVybiBhcnJheTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXRzIG1ldGFkYXRhIGZvciBgZnVuY2AuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogSWYgdGhpcyBmdW5jdGlvbiBiZWNvbWVzIGhvdCwgaS5lLiBpcyBpbnZva2VkIGEgbG90IGluIGEgc2hvcnQNCiAgICAgKiBwZXJpb2Qgb2YgdGltZSwgaXQgd2lsbCB0cmlwIGl0cyBicmVha2VyIGFuZCB0cmFuc2l0aW9uIHRvIGFuIGlkZW50aXR5IGZ1bmN0aW9uDQogICAgICogdG8gYXZvaWQgZ2FyYmFnZSBjb2xsZWN0aW9uIHBhdXNlcyBpbiBWOC4gU2VlIFtWOCBpc3N1ZSAyMDcwXShodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MjA3MCkNCiAgICAgKiBmb3IgbW9yZSBkZXRhaWxzLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBhc3NvY2lhdGUgbWV0YWRhdGEgd2l0aC4NCiAgICAgKiBAcGFyYW0geyp9IGRhdGEgVGhlIG1ldGFkYXRhLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyBgZnVuY2AuDQogICAgICovDQogICAgdmFyIHNldERhdGEgPSAoZnVuY3Rpb24oKSB7DQogICAgICB2YXIgY291bnQgPSAwLA0KICAgICAgICAgIGxhc3RDYWxsZWQgPSAwOw0KDQogICAgICByZXR1cm4gZnVuY3Rpb24oa2V5LCB2YWx1ZSkgew0KICAgICAgICB2YXIgc3RhbXAgPSBub3coKSwNCiAgICAgICAgICAgIHJlbWFpbmluZyA9IEhPVF9TUEFOIC0gKHN0YW1wIC0gbGFzdENhbGxlZCk7DQoNCiAgICAgICAgbGFzdENhbGxlZCA9IHN0YW1wOw0KICAgICAgICBpZiAocmVtYWluaW5nID4gMCkgew0KICAgICAgICAgIGlmICgrK2NvdW50ID49IEhPVF9DT1VOVCkgew0KICAgICAgICAgICAgcmV0dXJuIGtleTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgY291bnQgPSAwOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBiYXNlU2V0RGF0YShrZXksIHZhbHVlKTsNCiAgICAgIH07DQogICAgfSgpKTsNCg0KICAgIC8qKg0KICAgICAqIEEgZmFsbGJhY2sgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNQbGFpbk9iamVjdGAgd2hpY2ggY2hlY2tzIGlmIGB2YWx1ZWANCiAgICAgKiBpcyBhbiBvYmplY3QgY3JlYXRlZCBieSB0aGUgYE9iamVjdGAgY29uc3RydWN0b3Igb3IgaGFzIGEgYFtbUHJvdG90eXBlXV1gDQogICAgICogb2YgYG51bGxgLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHBsYWluIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNoaW1Jc1BsYWluT2JqZWN0KHZhbHVlKSB7DQogICAgICB2YXIgQ3RvciwNCiAgICAgICAgICBzdXBwb3J0ID0gbG9kYXNoLnN1cHBvcnQ7DQoNCiAgICAgIC8vIEV4aXQgZWFybHkgZm9yIG5vbiBgT2JqZWN0YCBvYmplY3RzLg0KICAgICAgaWYgKCEoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBvYmplY3RUYWcpIHx8DQogICAgICAgICAgKCFoYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCAnY29uc3RydWN0b3InKSAmJg0KICAgICAgICAgICAgKEN0b3IgPSB2YWx1ZS5jb25zdHJ1Y3RvciwgdHlwZW9mIEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiAhKEN0b3IgaW5zdGFuY2VvZiBDdG9yKSkpKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICAgIC8vIElFIDwgOSBpdGVyYXRlcyBpbmhlcml0ZWQgcHJvcGVydGllcyBiZWZvcmUgb3duIHByb3BlcnRpZXMuIElmIHRoZSBmaXJzdA0KICAgICAgLy8gaXRlcmF0ZWQgcHJvcGVydHkgaXMgYW4gb2JqZWN0J3Mgb3duIHByb3BlcnR5IHRoZW4gdGhlcmUgYXJlIG5vIGluaGVyaXRlZA0KICAgICAgLy8gZW51bWVyYWJsZSBwcm9wZXJ0aWVzLg0KICAgICAgdmFyIHJlc3VsdDsNCiAgICAgIC8vIEluIG1vc3QgZW52aXJvbm1lbnRzIGFuIG9iamVjdCdzIG93biBwcm9wZXJ0aWVzIGFyZSBpdGVyYXRlZCBiZWZvcmUNCiAgICAgIC8vIGl0cyBpbmhlcml0ZWQgcHJvcGVydGllcy4gSWYgdGhlIGxhc3QgaXRlcmF0ZWQgcHJvcGVydHkgaXMgYW4gb2JqZWN0J3MNCiAgICAgIC8vIG93biBwcm9wZXJ0eSB0aGVuIHRoZXJlIGFyZSBubyBpbmhlcml0ZWQgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLg0KICAgICAgYmFzZUZvckluKHZhbHVlLCBmdW5jdGlvbihzdWJWYWx1ZSwga2V5KSB7DQogICAgICAgIHJlc3VsdCA9IGtleTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gdW5kZWZpbmVkIHx8IGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIHJlc3VsdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQSBmYWxsYmFjayBpbXBsZW1lbnRhdGlvbiBvZiBgT2JqZWN0LmtleXNgIHdoaWNoIGNyZWF0ZXMgYW4gYXJyYXkgb2YgdGhlDQogICAgICogb3duIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgYG9iamVjdGAuDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNoaW1LZXlzKG9iamVjdCkgew0KICAgICAgdmFyIHByb3BzID0ga2V5c0luKG9iamVjdCksDQogICAgICAgICAgcHJvcHNMZW5ndGggPSBwcm9wcy5sZW5ndGgsDQogICAgICAgICAgbGVuZ3RoID0gcHJvcHNMZW5ndGggJiYgb2JqZWN0Lmxlbmd0aDsNCg0KICAgICAgdmFyIGFsbG93SW5kZXhlcyA9ICEhbGVuZ3RoICYmIGlzTGVuZ3RoKGxlbmd0aCkgJiYNCiAgICAgICAgKGlzQXJyYXkob2JqZWN0KSB8fCBpc0FyZ3VtZW50cyhvYmplY3QpKTsNCg0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgcmVzdWx0ID0gW107DQoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgcHJvcHNMZW5ndGgpIHsNCiAgICAgICAgdmFyIGtleSA9IHByb3BzW2luZGV4XTsNCiAgICAgICAgaWYgKChhbGxvd0luZGV4ZXMgJiYgaXNJbmRleChrZXksIGxlbmd0aCkpIHx8IGhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpKSB7DQogICAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGFuIGFycmF5LWxpa2Ugb2JqZWN0IGlmIGl0J3Mgbm90IG9uZS4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcHJvY2Vzcy4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl8T2JqZWN0fSBSZXR1cm5zIHRoZSBhcnJheS1saWtlIG9iamVjdC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0b0l0ZXJhYmxlKHZhbHVlKSB7DQogICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gW107DQogICAgICB9DQogICAgICBpZiAoIWlzQXJyYXlMaWtlKHZhbHVlKSkgew0KICAgICAgICByZXR1cm4gdmFsdWVzKHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBpc09iamVjdCh2YWx1ZSkgPyB2YWx1ZSA6IE9iamVjdCh2YWx1ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ29udmVydHMgYHZhbHVlYCB0byBhbiBvYmplY3QgaWYgaXQncyBub3Qgb25lLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBwcm9jZXNzLg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG9iamVjdC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0b09iamVjdCh2YWx1ZSkgew0KICAgICAgcmV0dXJuIGlzT2JqZWN0KHZhbHVlKSA/IHZhbHVlIDogT2JqZWN0KHZhbHVlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb252ZXJ0cyBgdmFsdWVgIHRvIHByb3BlcnR5IHBhdGggYXJyYXkgaWYgaXQncyBub3Qgb25lLg0KICAgICAqDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBwcm9jZXNzLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgcHJvcGVydHkgcGF0aCBhcnJheS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0b1BhdGgodmFsdWUpIHsNCiAgICAgIGlmIChpc0FycmF5KHZhbHVlKSkgew0KICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgICB9DQogICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICBiYXNlVG9TdHJpbmcodmFsdWUpLnJlcGxhY2UocmVQcm9wTmFtZSwgZnVuY3Rpb24obWF0Y2gsIG51bWJlciwgcXVvdGUsIHN0cmluZykgew0KICAgICAgICByZXN1bHQucHVzaChxdW90ZSA/IHN0cmluZy5yZXBsYWNlKHJlRXNjYXBlQ2hhciwgJyQxJykgOiAobnVtYmVyIHx8IG1hdGNoKSk7DQogICAgICB9KTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGNsb25lIG9mIGB3cmFwcGVyYC4NCiAgICAgKg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IHdyYXBwZXIgVGhlIHdyYXBwZXIgdG8gY2xvbmUuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY2xvbmVkIHdyYXBwZXIuDQogICAgICovDQogICAgZnVuY3Rpb24gd3JhcHBlckNsb25lKHdyYXBwZXIpIHsNCiAgICAgIHJldHVybiB3cmFwcGVyIGluc3RhbmNlb2YgTGF6eVdyYXBwZXINCiAgICAgICAgPyB3cmFwcGVyLmNsb25lKCkNCiAgICAgICAgOiBuZXcgTG9kYXNoV3JhcHBlcih3cmFwcGVyLl9fd3JhcHBlZF9fLCB3cmFwcGVyLl9fY2hhaW5fXywgYXJyYXlDb3B5KHdyYXBwZXIuX19hY3Rpb25zX18pKTsNCiAgICB9DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIGVsZW1lbnRzIHNwbGl0IGludG8gZ3JvdXBzIHRoZSBsZW5ndGggb2YgYHNpemVgLg0KICAgICAqIElmIGBjb2xsZWN0aW9uYCBjYW4ndCBiZSBzcGxpdCBldmVubHksIHRoZSBmaW5hbCBjaHVuayB3aWxsIGJlIHRoZSByZW1haW5pbmcNCiAgICAgKiBlbGVtZW50cy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBwcm9jZXNzLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc2l6ZT0xXSBUaGUgbGVuZ3RoIG9mIGVhY2ggY2h1bmsuDQogICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGEgY2FsbGJhY2sgZm9yIGZ1bmN0aW9ucyBsaWtlIGBfLm1hcGAuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgY29udGFpbmluZyBjaHVua3MuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uY2h1bmsoWydhJywgJ2InLCAnYycsICdkJ10sIDIpOw0KICAgICAqIC8vID0+IFtbJ2EnLCAnYiddLCBbJ2MnLCAnZCddXQ0KICAgICAqDQogICAgICogXy5jaHVuayhbJ2EnLCAnYicsICdjJywgJ2QnXSwgMyk7DQogICAgICogLy8gPT4gW1snYScsICdiJywgJ2MnXSwgWydkJ11dDQogICAgICovDQogICAgZnVuY3Rpb24gY2h1bmsoYXJyYXksIHNpemUsIGd1YXJkKSB7DQogICAgICBpZiAoZ3VhcmQgPyBpc0l0ZXJhdGVlQ2FsbChhcnJheSwgc2l6ZSwgZ3VhcmQpIDogc2l6ZSA9PSBudWxsKSB7DQogICAgICAgIHNpemUgPSAxOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2l6ZSA9IG5hdGl2ZU1heCgrc2l6ZSB8fCAxLCAxKTsNCiAgICAgIH0NCiAgICAgIHZhciBpbmRleCA9IDAsDQogICAgICAgICAgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwLA0KICAgICAgICAgIHJlc0luZGV4ID0gLTEsDQogICAgICAgICAgcmVzdWx0ID0gQXJyYXkoY2VpbChsZW5ndGggLyBzaXplKSk7DQoNCiAgICAgIHdoaWxlIChpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICByZXN1bHRbKytyZXNJbmRleF0gPSBiYXNlU2xpY2UoYXJyYXksIGluZGV4LCAoaW5kZXggKz0gc2l6ZSkpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IHdpdGggYWxsIGZhbHNleSB2YWx1ZXMgcmVtb3ZlZC4gVGhlIHZhbHVlcyBgZmFsc2VgLCBgbnVsbGAsDQogICAgICogYDBgLCBgIiJgLCBgdW5kZWZpbmVkYCwgYW5kIGBOYU5gIGFyZSBmYWxzZXkuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY29tcGFjdC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uY29tcGFjdChbMCwgMSwgZmFsc2UsIDIsICcnLCAzXSk7DQogICAgICogLy8gPT4gWzEsIDIsIDNdDQogICAgICovDQogICAgZnVuY3Rpb24gY29tcGFjdChhcnJheSkgew0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwLA0KICAgICAgICAgIHJlc0luZGV4ID0gLTEsDQogICAgICAgICAgcmVzdWx0ID0gW107DQoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XTsNCiAgICAgICAgaWYgKHZhbHVlKSB7DQogICAgICAgICAgcmVzdWx0WysrcmVzSW5kZXhdID0gdmFsdWU7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB1bmlxdWUgYGFycmF5YCB2YWx1ZXMgbm90IGluY2x1ZGVkIGluIHRoZSBvdGhlcg0KICAgICAqIHByb3ZpZGVkIGFycmF5cyB1c2luZyBbYFNhbWVWYWx1ZVplcm9gXShodHRwczovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtc2FtZXZhbHVlemVybykNCiAgICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4NCiAgICAgKiBAcGFyYW0gey4uLkFycmF5fSBbdmFsdWVzXSBUaGUgYXJyYXlzIG9mIHZhbHVlcyB0byBleGNsdWRlLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5kaWZmZXJlbmNlKFsxLCAyLCAzXSwgWzQsIDJdKTsNCiAgICAgKiAvLyA9PiBbMSwgM10NCiAgICAgKi8NCiAgICB2YXIgZGlmZmVyZW5jZSA9IHJlc3RQYXJhbShmdW5jdGlvbihhcnJheSwgdmFsdWVzKSB7DQogICAgICByZXR1cm4gaXNBcnJheUxpa2UoYXJyYXkpDQogICAgICAgID8gYmFzZURpZmZlcmVuY2UoYXJyYXksIGJhc2VGbGF0dGVuKHZhbHVlcywgZmFsc2UsIHRydWUpKQ0KICAgICAgICA6IFtdOw0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgd2l0aCBgbmAgZWxlbWVudHMgZHJvcHBlZCBmcm9tIHRoZSBiZWdpbm5pbmcuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtuPTFdIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gZHJvcC4NCiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYSBjYWxsYmFjayBmb3IgZnVuY3Rpb25zIGxpa2UgYF8ubWFwYC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uZHJvcChbMSwgMiwgM10pOw0KICAgICAqIC8vID0+IFsyLCAzXQ0KICAgICAqDQogICAgICogXy5kcm9wKFsxLCAyLCAzXSwgMik7DQogICAgICogLy8gPT4gWzNdDQogICAgICoNCiAgICAgKiBfLmRyb3AoWzEsIDIsIDNdLCA1KTsNCiAgICAgKiAvLyA9PiBbXQ0KICAgICAqDQogICAgICogXy5kcm9wKFsxLCAyLCAzXSwgMCk7DQogICAgICogLy8gPT4gWzEsIDIsIDNdDQogICAgICovDQogICAgZnVuY3Rpb24gZHJvcChhcnJheSwgbiwgZ3VhcmQpIHsNCiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7DQogICAgICBpZiAoIWxlbmd0aCkgew0KICAgICAgICByZXR1cm4gW107DQogICAgICB9DQogICAgICBpZiAoZ3VhcmQgPyBpc0l0ZXJhdGVlQ2FsbChhcnJheSwgbiwgZ3VhcmQpIDogbiA9PSBudWxsKSB7DQogICAgICAgIG4gPSAxOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgbiA8IDAgPyAwIDogbik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgd2l0aCBgbmAgZWxlbWVudHMgZHJvcHBlZCBmcm9tIHRoZSBlbmQuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtuPTFdIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gZHJvcC4NCiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYSBjYWxsYmFjayBmb3IgZnVuY3Rpb25zIGxpa2UgYF8ubWFwYC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uZHJvcFJpZ2h0KFsxLCAyLCAzXSk7DQogICAgICogLy8gPT4gWzEsIDJdDQogICAgICoNCiAgICAgKiBfLmRyb3BSaWdodChbMSwgMiwgM10sIDIpOw0KICAgICAqIC8vID0+IFsxXQ0KICAgICAqDQogICAgICogXy5kcm9wUmlnaHQoWzEsIDIsIDNdLCA1KTsNCiAgICAgKiAvLyA9PiBbXQ0KICAgICAqDQogICAgICogXy5kcm9wUmlnaHQoWzEsIDIsIDNdLCAwKTsNCiAgICAgKiAvLyA9PiBbMSwgMiwgM10NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBkcm9wUmlnaHQoYXJyYXksIG4sIGd1YXJkKSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOw0KICAgICAgaWYgKCFsZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgfQ0KICAgICAgaWYgKGd1YXJkID8gaXNJdGVyYXRlZUNhbGwoYXJyYXksIG4sIGd1YXJkKSA6IG4gPT0gbnVsbCkgew0KICAgICAgICBuID0gMTsNCiAgICAgIH0NCiAgICAgIG4gPSBsZW5ndGggLSAoK24gfHwgMCk7DQogICAgICByZXR1cm4gYmFzZVNsaWNlKGFycmF5LCAwLCBuIDwgMCA/IDAgOiBuKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCBleGNsdWRpbmcgZWxlbWVudHMgZHJvcHBlZCBmcm9tIHRoZSBlbmQuDQogICAgICogRWxlbWVudHMgYXJlIGRyb3BwZWQgdW50aWwgYHByZWRpY2F0ZWAgcmV0dXJucyBmYWxzZXkuIFRoZSBwcmVkaWNhdGUgaXMNCiAgICAgKiBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXgsIGFycmF5KS4NCiAgICAgKg0KICAgICAqIElmIGEgcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZCBmb3IgYHByZWRpY2F0ZWAgdGhlIGNyZWF0ZWQgYF8ucHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUgb2YgdGhlIGdpdmVuIGVsZW1lbnQuDQogICAgICoNCiAgICAgKiBJZiBhIHZhbHVlIGlzIGFsc28gcHJvdmlkZWQgZm9yIGB0aGlzQXJnYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzUHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSBhIG1hdGNoaW5nIHByb3BlcnR5DQogICAgICogdmFsdWUsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIElmIGFuIG9iamVjdCBpcyBwcm92aWRlZCBmb3IgYHByZWRpY2F0ZWAgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc2Agc3R5bGUNCiAgICAgKiBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBtYXRjaCB0aGUgcHJvcGVydGllcyBvZiB0aGUgZ2l2ZW4NCiAgICAgKiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxzdHJpbmd9IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQNCiAgICAgKiAgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYHByZWRpY2F0ZWAuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmRyb3BSaWdodFdoaWxlKFsxLCAyLCAzXSwgZnVuY3Rpb24obikgew0KICAgICAqICAgcmV0dXJuIG4gPiAxOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IFsxXQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gWw0KICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FjdGl2ZSc6IHRydWUgfSwNCiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgICdhY3RpdmUnOiBmYWxzZSB9LA0KICAgICAqICAgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IGZhbHNlIH0NCiAgICAgKiBdOw0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLm1hdGNoZXNgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ucGx1Y2soXy5kcm9wUmlnaHRXaGlsZSh1c2VycywgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IGZhbHNlIH0pLCAndXNlcicpOw0KICAgICAqIC8vID0+IFsnYmFybmV5JywgJ2ZyZWQnXQ0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLm1hdGNoZXNQcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5wbHVjayhfLmRyb3BSaWdodFdoaWxlKHVzZXJzLCAnYWN0aXZlJywgZmFsc2UpLCAndXNlcicpOw0KICAgICAqIC8vID0+IFsnYmFybmV5J10NCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5wcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5wbHVjayhfLmRyb3BSaWdodFdoaWxlKHVzZXJzLCAnYWN0aXZlJyksICd1c2VyJyk7DQogICAgICogLy8gPT4gWydiYXJuZXknLCAnZnJlZCcsICdwZWJibGVzJ10NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBkcm9wUmlnaHRXaGlsZShhcnJheSwgcHJlZGljYXRlLCB0aGlzQXJnKSB7DQogICAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkNCiAgICAgICAgPyBiYXNlV2hpbGUoYXJyYXksIGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyksIHRydWUsIHRydWUpDQogICAgICAgIDogW107DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgZXhjbHVkaW5nIGVsZW1lbnRzIGRyb3BwZWQgZnJvbSB0aGUgYmVnaW5uaW5nLg0KICAgICAqIEVsZW1lbnRzIGFyZSBkcm9wcGVkIHVudGlsIGBwcmVkaWNhdGVgIHJldHVybnMgZmFsc2V5LiBUaGUgcHJlZGljYXRlIGlzDQogICAgICogYm91bmQgdG8gYHRoaXNBcmdgIGFuZCBpbnZva2VkIHdpdGggdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGluZGV4LCBhcnJheSkuDQogICAgICoNCiAgICAgKiBJZiBhIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQgZm9yIGBwcmVkaWNhdGVgIHRoZSBjcmVhdGVkIGBfLnByb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlIG9mIHRoZSBnaXZlbiBlbGVtZW50Lg0KICAgICAqDQogICAgICogSWYgYSB2YWx1ZSBpcyBhbHNvIHByb3ZpZGVkIGZvciBgdGhpc0FyZ2AgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc1Byb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgYSBtYXRjaGluZyBwcm9wZXJ0eQ0KICAgICAqIHZhbHVlLCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBJZiBhbiBvYmplY3QgaXMgcHJvdmlkZWQgZm9yIGBwcmVkaWNhdGVgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNgIHN0eWxlDQogICAgICogY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSB0aGUgcHJvcGVydGllcyBvZiB0aGUgZ2l2ZW4NCiAgICAgKiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxzdHJpbmd9IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQNCiAgICAgKiAgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYHByZWRpY2F0ZWAuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmRyb3BXaGlsZShbMSwgMiwgM10sIGZ1bmN0aW9uKG4pIHsNCiAgICAgKiAgIHJldHVybiBuIDwgMzsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiBbM10NCiAgICAgKg0KICAgICAqIHZhciB1c2VycyA9IFsNCiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgICdhY3RpdmUnOiBmYWxzZSB9LA0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sDQogICAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogdHJ1ZSB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5tYXRjaGVzYCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLnBsdWNrKF8uZHJvcFdoaWxlKHVzZXJzLCB7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiBmYWxzZSB9KSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2ZyZWQnLCAncGViYmxlcyddDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLnBsdWNrKF8uZHJvcFdoaWxlKHVzZXJzLCAnYWN0aXZlJywgZmFsc2UpLCAndXNlcicpOw0KICAgICAqIC8vID0+IFsncGViYmxlcyddDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ucGx1Y2soXy5kcm9wV2hpbGUodXNlcnMsICdhY3RpdmUnKSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2Jhcm5leScsICdmcmVkJywgJ3BlYmJsZXMnXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGRyb3BXaGlsZShhcnJheSwgcHJlZGljYXRlLCB0aGlzQXJnKSB7DQogICAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkNCiAgICAgICAgPyBiYXNlV2hpbGUoYXJyYXksIGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyksIHRydWUpDQogICAgICAgIDogW107DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRmlsbHMgZWxlbWVudHMgb2YgYGFycmF5YCB3aXRoIGB2YWx1ZWAgZnJvbSBgc3RhcnRgIHVwIHRvLCBidXQgbm90DQogICAgICogaW5jbHVkaW5nLCBgZW5kYC4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBtdXRhdGVzIGBhcnJheWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gZmlsbC4NCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBmaWxsIGBhcnJheWAgd2l0aC4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2VuZD1hcnJheS5sZW5ndGhdIFRoZSBlbmQgcG9zaXRpb24uDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBhcnJheSA9IFsxLCAyLCAzXTsNCiAgICAgKg0KICAgICAqIF8uZmlsbChhcnJheSwgJ2EnKTsNCiAgICAgKiBjb25zb2xlLmxvZyhhcnJheSk7DQogICAgICogLy8gPT4gWydhJywgJ2EnLCAnYSddDQogICAgICoNCiAgICAgKiBfLmZpbGwoQXJyYXkoMyksIDIpOw0KICAgICAqIC8vID0+IFsyLCAyLCAyXQ0KICAgICAqDQogICAgICogXy5maWxsKFs0LCA2LCA4XSwgJyonLCAxLCAyKTsNCiAgICAgKiAvLyA9PiBbNCwgJyonLCA4XQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGZpbGwoYXJyYXksIHZhbHVlLCBzdGFydCwgZW5kKSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOw0KICAgICAgaWYgKCFsZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgfQ0KICAgICAgaWYgKHN0YXJ0ICYmIHR5cGVvZiBzdGFydCAhPSAnbnVtYmVyJyAmJiBpc0l0ZXJhdGVlQ2FsbChhcnJheSwgdmFsdWUsIHN0YXJ0KSkgew0KICAgICAgICBzdGFydCA9IDA7DQogICAgICAgIGVuZCA9IGxlbmd0aDsNCiAgICAgIH0NCiAgICAgIHJldHVybiBiYXNlRmlsbChhcnJheSwgdmFsdWUsIHN0YXJ0LCBlbmQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uZmluZGAgZXhjZXB0IHRoYXQgaXQgcmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGZpcnN0DQogICAgICogZWxlbWVudCBgcHJlZGljYXRlYCByZXR1cm5zIHRydXRoeSBmb3IgaW5zdGVhZCBvZiB0aGUgZWxlbWVudCBpdHNlbGYuDQogICAgICoNCiAgICAgKiBJZiBhIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQgZm9yIGBwcmVkaWNhdGVgIHRoZSBjcmVhdGVkIGBfLnByb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlIG9mIHRoZSBnaXZlbiBlbGVtZW50Lg0KICAgICAqDQogICAgICogSWYgYSB2YWx1ZSBpcyBhbHNvIHByb3ZpZGVkIGZvciBgdGhpc0FyZ2AgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc1Byb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgYSBtYXRjaGluZyBwcm9wZXJ0eQ0KICAgICAqIHZhbHVlLCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBJZiBhbiBvYmplY3QgaXMgcHJvdmlkZWQgZm9yIGBwcmVkaWNhdGVgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNgIHN0eWxlDQogICAgICogY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSB0aGUgcHJvcGVydGllcyBvZiB0aGUgZ2l2ZW4NCiAgICAgKiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzZWFyY2guDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkDQogICAgICogIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBwcmVkaWNhdGVgLg0KICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBmb3VuZCBlbGVtZW50LCBlbHNlIGAtMWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciB1c2VycyA9IFsNCiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgICdhY3RpdmUnOiBmYWxzZSB9LA0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sDQogICAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogdHJ1ZSB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIF8uZmluZEluZGV4KHVzZXJzLCBmdW5jdGlvbihjaHIpIHsNCiAgICAgKiAgIHJldHVybiBjaHIudXNlciA9PSAnYmFybmV5JzsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiAwDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc2AgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5maW5kSW5kZXgodXNlcnMsIHsgJ3VzZXInOiAnZnJlZCcsICdhY3RpdmUnOiBmYWxzZSB9KTsNCiAgICAgKiAvLyA9PiAxDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLmZpbmRJbmRleCh1c2VycywgJ2FjdGl2ZScsIGZhbHNlKTsNCiAgICAgKiAvLyA9PiAwDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8uZmluZEluZGV4KHVzZXJzLCAnYWN0aXZlJyk7DQogICAgICogLy8gPT4gMg0KICAgICAqLw0KICAgIHZhciBmaW5kSW5kZXggPSBjcmVhdGVGaW5kSW5kZXgoKTsNCg0KICAgIC8qKg0KICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uZmluZEluZGV4YCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIGVsZW1lbnRzDQogICAgICogb2YgYGNvbGxlY3Rpb25gIGZyb20gcmlnaHQgdG8gbGVmdC4NCiAgICAgKg0KICAgICAqIElmIGEgcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZCBmb3IgYHByZWRpY2F0ZWAgdGhlIGNyZWF0ZWQgYF8ucHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUgb2YgdGhlIGdpdmVuIGVsZW1lbnQuDQogICAgICoNCiAgICAgKiBJZiBhIHZhbHVlIGlzIGFsc28gcHJvdmlkZWQgZm9yIGB0aGlzQXJnYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzUHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSBhIG1hdGNoaW5nIHByb3BlcnR5DQogICAgICogdmFsdWUsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIElmIGFuIG9iamVjdCBpcyBwcm92aWRlZCBmb3IgYHByZWRpY2F0ZWAgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc2Agc3R5bGUNCiAgICAgKiBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBnaXZlbg0KICAgICAqIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEFycmF5DQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHNlYXJjaC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxzdHJpbmd9IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQNCiAgICAgKiAgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYHByZWRpY2F0ZWAuDQogICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGZvdW5kIGVsZW1lbnQsIGVsc2UgYC0xYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gWw0KICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FjdGl2ZSc6IHRydWUgfSwNCiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgICdhY3RpdmUnOiBmYWxzZSB9LA0KICAgICAqICAgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IGZhbHNlIH0NCiAgICAgKiBdOw0KICAgICAqDQogICAgICogXy5maW5kTGFzdEluZGV4KHVzZXJzLCBmdW5jdGlvbihjaHIpIHsNCiAgICAgKiAgIHJldHVybiBjaHIudXNlciA9PSAncGViYmxlcyc7DQogICAgICogfSk7DQogICAgICogLy8gPT4gMg0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLm1hdGNoZXNgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8uZmluZExhc3RJbmRleCh1c2VycywgeyAndXNlcic6ICdiYXJuZXknLCAnYWN0aXZlJzogdHJ1ZSB9KTsNCiAgICAgKiAvLyA9PiAwDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLmZpbmRMYXN0SW5kZXgodXNlcnMsICdhY3RpdmUnLCBmYWxzZSk7DQogICAgICogLy8gPT4gMg0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLnByb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLmZpbmRMYXN0SW5kZXgodXNlcnMsICdhY3RpdmUnKTsNCiAgICAgKiAvLyA9PiAwDQogICAgICovDQogICAgdmFyIGZpbmRMYXN0SW5kZXggPSBjcmVhdGVGaW5kSW5kZXgodHJ1ZSk7DQoNCiAgICAvKioNCiAgICAgKiBHZXRzIHRoZSBmaXJzdCBlbGVtZW50IG9mIGBhcnJheWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAYWxpYXMgaGVhZA0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZmlyc3QgZWxlbWVudCBvZiBgYXJyYXlgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmZpcnN0KFsxLCAyLCAzXSk7DQogICAgICogLy8gPT4gMQ0KICAgICAqDQogICAgICogXy5maXJzdChbXSk7DQogICAgICogLy8gPT4gdW5kZWZpbmVkDQogICAgICovDQogICAgZnVuY3Rpb24gZmlyc3QoYXJyYXkpIHsNCiAgICAgIHJldHVybiBhcnJheSA/IGFycmF5WzBdIDogdW5kZWZpbmVkOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZsYXR0ZW5zIGEgbmVzdGVkIGFycmF5LiBJZiBgaXNEZWVwYCBpcyBgdHJ1ZWAgdGhlIGFycmF5IGlzIHJlY3Vyc2l2ZWx5DQogICAgICogZmxhdHRlbmVkLCBvdGhlcndpc2UgaXQgaXMgb25seSBmbGF0dGVuZWQgYSBzaW5nbGUgbGV2ZWwuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gZmxhdHRlbi4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0RlZXBdIFNwZWNpZnkgYSBkZWVwIGZsYXR0ZW4uDQogICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGEgY2FsbGJhY2sgZm9yIGZ1bmN0aW9ucyBsaWtlIGBfLm1hcGAuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmxhdHRlbmVkIGFycmF5Lg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmZsYXR0ZW4oWzEsIFsyLCAzLCBbNF1dXSk7DQogICAgICogLy8gPT4gWzEsIDIsIDMsIFs0XV0NCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIGBpc0RlZXBgDQogICAgICogXy5mbGF0dGVuKFsxLCBbMiwgMywgWzRdXV0sIHRydWUpOw0KICAgICAqIC8vID0+IFsxLCAyLCAzLCA0XQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGZsYXR0ZW4oYXJyYXksIGlzRGVlcCwgZ3VhcmQpIHsNCiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7DQogICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwoYXJyYXksIGlzRGVlcCwgZ3VhcmQpKSB7DQogICAgICAgIGlzRGVlcCA9IGZhbHNlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGxlbmd0aCA/IGJhc2VGbGF0dGVuKGFycmF5LCBpc0RlZXApIDogW107DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVjdXJzaXZlbHkgZmxhdHRlbnMgYSBuZXN0ZWQgYXJyYXkuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcmVjdXJzaXZlbHkgZmxhdHRlbi4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBmbGF0dGVuZWQgYXJyYXkuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uZmxhdHRlbkRlZXAoWzEsIFsyLCAzLCBbNF1dXSk7DQogICAgICogLy8gPT4gWzEsIDIsIDMsIDRdDQogICAgICovDQogICAgZnVuY3Rpb24gZmxhdHRlbkRlZXAoYXJyYXkpIHsNCiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7DQogICAgICByZXR1cm4gbGVuZ3RoID8gYmFzZUZsYXR0ZW4oYXJyYXksIHRydWUpIDogW107DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0cyB0aGUgaW5kZXggYXQgd2hpY2ggdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYHZhbHVlYCBpcyBmb3VuZCBpbiBgYXJyYXlgDQogICAgICogdXNpbmcgW2BTYW1lVmFsdWVaZXJvYF0oaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLXNhbWV2YWx1ZXplcm8pDQogICAgICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLiBJZiBgZnJvbUluZGV4YCBpcyBuZWdhdGl2ZSwgaXQgaXMgdXNlZCBhcyB0aGUgb2Zmc2V0DQogICAgICogZnJvbSB0aGUgZW5kIG9mIGBhcnJheWAuIElmIGBhcnJheWAgaXMgc29ydGVkIHByb3ZpZGluZyBgdHJ1ZWAgZm9yIGBmcm9tSW5kZXhgDQogICAgICogcGVyZm9ybXMgYSBmYXN0ZXIgYmluYXJ5IHNlYXJjaC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzZWFyY2guDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW58bnVtYmVyfSBbZnJvbUluZGV4PTBdIFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbSBvciBgdHJ1ZWANCiAgICAgKiAgdG8gcGVyZm9ybSBhIGJpbmFyeSBzZWFyY2ggb24gYSBzb3J0ZWQgYXJyYXkuDQogICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pbmRleE9mKFsxLCAyLCAxLCAyXSwgMik7DQogICAgICogLy8gPT4gMQ0KICAgICAqDQogICAgICogLy8gdXNpbmcgYGZyb21JbmRleGANCiAgICAgKiBfLmluZGV4T2YoWzEsIDIsIDEsIDJdLCAyLCAyKTsNCiAgICAgKiAvLyA9PiAzDQogICAgICoNCiAgICAgKiAvLyBwZXJmb3JtaW5nIGEgYmluYXJ5IHNlYXJjaA0KICAgICAqIF8uaW5kZXhPZihbMSwgMSwgMiwgMl0sIDIsIHRydWUpOw0KICAgICAqIC8vID0+IDINCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOw0KICAgICAgaWYgKCFsZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgfQ0KICAgICAgaWYgKHR5cGVvZiBmcm9tSW5kZXggPT0gJ251bWJlcicpIHsNCiAgICAgICAgZnJvbUluZGV4ID0gZnJvbUluZGV4IDwgMCA/IG5hdGl2ZU1heChsZW5ndGggKyBmcm9tSW5kZXgsIDApIDogZnJvbUluZGV4Ow0KICAgICAgfSBlbHNlIGlmIChmcm9tSW5kZXgpIHsNCiAgICAgICAgdmFyIGluZGV4ID0gYmluYXJ5SW5kZXgoYXJyYXksIHZhbHVlKSwNCiAgICAgICAgICAgIG90aGVyID0gYXJyYXlbaW5kZXhdOw0KDQogICAgICAgIGlmICh2YWx1ZSA9PT0gdmFsdWUgPyAodmFsdWUgPT09IG90aGVyKSA6IChvdGhlciAhPT0gb3RoZXIpKSB7DQogICAgICAgICAgcmV0dXJuIGluZGV4Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiAtMTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBiYXNlSW5kZXhPZihhcnJheSwgdmFsdWUsIGZyb21JbmRleCB8fCAwKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXRzIGFsbCBidXQgdGhlIGxhc3QgZWxlbWVudCBvZiBgYXJyYXlgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEFycmF5DQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5Lg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pbml0aWFsKFsxLCAyLCAzXSk7DQogICAgICogLy8gPT4gWzEsIDJdDQogICAgICovDQogICAgZnVuY3Rpb24gaW5pdGlhbChhcnJheSkgew0KICAgICAgcmV0dXJuIGRyb3BSaWdodChhcnJheSwgMSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB1bmlxdWUgdmFsdWVzIHRoYXQgYXJlIGluY2x1ZGVkIGluIGFsbCBvZiB0aGUgcHJvdmlkZWQNCiAgICAgKiBhcnJheXMgdXNpbmcgW2BTYW1lVmFsdWVaZXJvYF0oaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLXNhbWV2YWx1ZXplcm8pDQogICAgICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEFycmF5DQogICAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0Lg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHNoYXJlZCB2YWx1ZXMuDQogICAgICogQGV4YW1wbGUNCiAgICAgKiBfLmludGVyc2VjdGlvbihbMSwgMl0sIFs0LCAyXSwgWzIsIDFdKTsNCiAgICAgKiAvLyA9PiBbMl0NCiAgICAgKi8NCiAgICB2YXIgaW50ZXJzZWN0aW9uID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGFycmF5cykgew0KICAgICAgdmFyIG90aExlbmd0aCA9IGFycmF5cy5sZW5ndGgsDQogICAgICAgICAgb3RoSW5kZXggPSBvdGhMZW5ndGgsDQogICAgICAgICAgY2FjaGVzID0gQXJyYXkobGVuZ3RoKSwNCiAgICAgICAgICBpbmRleE9mID0gZ2V0SW5kZXhPZigpLA0KICAgICAgICAgIGlzQ29tbW9uID0gaW5kZXhPZiA9PSBiYXNlSW5kZXhPZiwNCiAgICAgICAgICByZXN1bHQgPSBbXTsNCg0KICAgICAgd2hpbGUgKG90aEluZGV4LS0pIHsNCiAgICAgICAgdmFyIHZhbHVlID0gYXJyYXlzW290aEluZGV4XSA9IGlzQXJyYXlMaWtlKHZhbHVlID0gYXJyYXlzW290aEluZGV4XSkgPyB2YWx1ZSA6IFtdOw0KICAgICAgICBjYWNoZXNbb3RoSW5kZXhdID0gKGlzQ29tbW9uICYmIHZhbHVlLmxlbmd0aCA+PSAxMjApID8gY3JlYXRlQ2FjaGUob3RoSW5kZXggJiYgdmFsdWUpIDogbnVsbDsNCiAgICAgIH0NCiAgICAgIHZhciBhcnJheSA9IGFycmF5c1swXSwNCiAgICAgICAgICBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMCwNCiAgICAgICAgICBzZWVuID0gY2FjaGVzWzBdOw0KDQogICAgICBvdXRlcjoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIHZhbHVlID0gYXJyYXlbaW5kZXhdOw0KICAgICAgICBpZiAoKHNlZW4gPyBjYWNoZUluZGV4T2Yoc2VlbiwgdmFsdWUpIDogaW5kZXhPZihyZXN1bHQsIHZhbHVlLCAwKSkgPCAwKSB7DQogICAgICAgICAgdmFyIG90aEluZGV4ID0gb3RoTGVuZ3RoOw0KICAgICAgICAgIHdoaWxlICgtLW90aEluZGV4KSB7DQogICAgICAgICAgICB2YXIgY2FjaGUgPSBjYWNoZXNbb3RoSW5kZXhdOw0KICAgICAgICAgICAgaWYgKChjYWNoZSA/IGNhY2hlSW5kZXhPZihjYWNoZSwgdmFsdWUpIDogaW5kZXhPZihhcnJheXNbb3RoSW5kZXhdLCB2YWx1ZSwgMCkpIDwgMCkgew0KICAgICAgICAgICAgICBjb250aW51ZSBvdXRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKHNlZW4pIHsNCiAgICAgICAgICAgIHNlZW4ucHVzaCh2YWx1ZSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEdldHMgdGhlIGxhc3QgZWxlbWVudCBvZiBgYXJyYXlgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEFycmF5DQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5Lg0KICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBsYXN0IGVsZW1lbnQgb2YgYGFycmF5YC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5sYXN0KFsxLCAyLCAzXSk7DQogICAgICogLy8gPT4gMw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxhc3QoYXJyYXkpIHsNCiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7DQogICAgICByZXR1cm4gbGVuZ3RoID8gYXJyYXlbbGVuZ3RoIC0gMV0gOiB1bmRlZmluZWQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5pbmRleE9mYCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIGVsZW1lbnRzIG9mDQogICAgICogYGFycmF5YCBmcm9tIHJpZ2h0IHRvIGxlZnQuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gc2VhcmNoLg0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuDQogICAgICogQHBhcmFtIHtib29sZWFufG51bWJlcn0gW2Zyb21JbmRleD1hcnJheS5sZW5ndGgtMV0gVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tDQogICAgICogIG9yIGB0cnVlYCB0byBwZXJmb3JtIGEgYmluYXJ5IHNlYXJjaCBvbiBhIHNvcnRlZCBhcnJheS4NCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmxhc3RJbmRleE9mKFsxLCAyLCAxLCAyXSwgMik7DQogICAgICogLy8gPT4gMw0KICAgICAqDQogICAgICogLy8gdXNpbmcgYGZyb21JbmRleGANCiAgICAgKiBfLmxhc3RJbmRleE9mKFsxLCAyLCAxLCAyXSwgMiwgMik7DQogICAgICogLy8gPT4gMQ0KICAgICAqDQogICAgICogLy8gcGVyZm9ybWluZyBhIGJpbmFyeSBzZWFyY2gNCiAgICAgKiBfLmxhc3RJbmRleE9mKFsxLCAxLCAyLCAyXSwgMiwgdHJ1ZSk7DQogICAgICogLy8gPT4gMw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxhc3RJbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOw0KICAgICAgaWYgKCFsZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgfQ0KICAgICAgdmFyIGluZGV4ID0gbGVuZ3RoOw0KICAgICAgaWYgKHR5cGVvZiBmcm9tSW5kZXggPT0gJ251bWJlcicpIHsNCiAgICAgICAgaW5kZXggPSAoZnJvbUluZGV4IDwgMCA/IG5hdGl2ZU1heChsZW5ndGggKyBmcm9tSW5kZXgsIDApIDogbmF0aXZlTWluKGZyb21JbmRleCB8fCAwLCBsZW5ndGggLSAxKSkgKyAxOw0KICAgICAgfSBlbHNlIGlmIChmcm9tSW5kZXgpIHsNCiAgICAgICAgaW5kZXggPSBiaW5hcnlJbmRleChhcnJheSwgdmFsdWUsIHRydWUpIC0gMTsNCiAgICAgICAgdmFyIG90aGVyID0gYXJyYXlbaW5kZXhdOw0KICAgICAgICBpZiAodmFsdWUgPT09IHZhbHVlID8gKHZhbHVlID09PSBvdGhlcikgOiAob3RoZXIgIT09IG90aGVyKSkgew0KICAgICAgICAgIHJldHVybiBpbmRleDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gLTE7DQogICAgICB9DQogICAgICBpZiAodmFsdWUgIT09IHZhbHVlKSB7DQogICAgICAgIHJldHVybiBpbmRleE9mTmFOKGFycmF5LCBpbmRleCwgdHJ1ZSk7DQogICAgICB9DQogICAgICB3aGlsZSAoaW5kZXgtLSkgew0KICAgICAgICBpZiAoYXJyYXlbaW5kZXhdID09PSB2YWx1ZSkgew0KICAgICAgICAgIHJldHVybiBpbmRleDsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIC0xOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlbW92ZXMgYWxsIHByb3ZpZGVkIHZhbHVlcyBmcm9tIGBhcnJheWAgdXNpbmcNCiAgICAgKiBbYFNhbWVWYWx1ZVplcm9gXShodHRwczovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtc2FtZXZhbHVlemVybykNCiAgICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLndpdGhvdXRgLCB0aGlzIG1ldGhvZCBtdXRhdGVzIGBhcnJheWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5Lg0KICAgICAqIEBwYXJhbSB7Li4uKn0gW3ZhbHVlc10gVGhlIHZhbHVlcyB0byByZW1vdmUuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBhcnJheSA9IFsxLCAyLCAzLCAxLCAyLCAzXTsNCiAgICAgKg0KICAgICAqIF8ucHVsbChhcnJheSwgMiwgMyk7DQogICAgICogY29uc29sZS5sb2coYXJyYXkpOw0KICAgICAqIC8vID0+IFsxLCAxXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHB1bGwoKSB7DQogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cywNCiAgICAgICAgICBhcnJheSA9IGFyZ3NbMF07DQoNCiAgICAgIGlmICghKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkpIHsNCiAgICAgICAgcmV0dXJuIGFycmF5Ow0KICAgICAgfQ0KICAgICAgdmFyIGluZGV4ID0gMCwNCiAgICAgICAgICBpbmRleE9mID0gZ2V0SW5kZXhPZigpLA0KICAgICAgICAgIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOw0KDQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICB2YXIgZnJvbUluZGV4ID0gMCwNCiAgICAgICAgICAgIHZhbHVlID0gYXJnc1tpbmRleF07DQoNCiAgICAgICAgd2hpbGUgKChmcm9tSW5kZXggPSBpbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSkgPiAtMSkgew0KICAgICAgICAgIHNwbGljZS5jYWxsKGFycmF5LCBmcm9tSW5kZXgsIDEpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gYXJyYXk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlcyBlbGVtZW50cyBmcm9tIGBhcnJheWAgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gaW5kZXhlcyBhbmQgcmV0dXJucw0KICAgICAqIGFuIGFycmF5IG9mIHRoZSByZW1vdmVkIGVsZW1lbnRzLiBJbmRleGVzIG1heSBiZSBzcGVjaWZpZWQgYXMgYW4gYXJyYXkgb2YNCiAgICAgKiBpbmRleGVzIG9yIGFzIGluZGl2aWR1YWwgYXJndW1lbnRzLg0KICAgICAqDQogICAgICogKipOb3RlOioqIFVubGlrZSBgXy5hdGAsIHRoaXMgbWV0aG9kIG11dGF0ZXMgYGFycmF5YC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuDQogICAgICogQHBhcmFtIHsuLi4obnVtYmVyfG51bWJlcltdKX0gW2luZGV4ZXNdIFRoZSBpbmRleGVzIG9mIGVsZW1lbnRzIHRvIHJlbW92ZSwNCiAgICAgKiAgc3BlY2lmaWVkIGFzIGluZGl2aWR1YWwgaW5kZXhlcyBvciBhcnJheXMgb2YgaW5kZXhlcy4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiByZW1vdmVkIGVsZW1lbnRzLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgYXJyYXkgPSBbNSwgMTAsIDE1LCAyMF07DQogICAgICogdmFyIGV2ZW5zID0gXy5wdWxsQXQoYXJyYXksIDEsIDMpOw0KICAgICAqDQogICAgICogY29uc29sZS5sb2coYXJyYXkpOw0KICAgICAqIC8vID0+IFs1LCAxNV0NCiAgICAgKg0KICAgICAqIGNvbnNvbGUubG9nKGV2ZW5zKTsNCiAgICAgKiAvLyA9PiBbMTAsIDIwXQ0KICAgICAqLw0KICAgIHZhciBwdWxsQXQgPSByZXN0UGFyYW0oZnVuY3Rpb24oYXJyYXksIGluZGV4ZXMpIHsNCiAgICAgIGluZGV4ZXMgPSBiYXNlRmxhdHRlbihpbmRleGVzKTsNCg0KICAgICAgdmFyIHJlc3VsdCA9IGJhc2VBdChhcnJheSwgaW5kZXhlcyk7DQogICAgICBiYXNlUHVsbEF0KGFycmF5LCBpbmRleGVzLnNvcnQoYmFzZUNvbXBhcmVBc2NlbmRpbmcpKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBSZW1vdmVzIGFsbCBlbGVtZW50cyBmcm9tIGBhcnJheWAgdGhhdCBgcHJlZGljYXRlYCByZXR1cm5zIHRydXRoeSBmb3INCiAgICAgKiBhbmQgcmV0dXJucyBhbiBhcnJheSBvZiB0aGUgcmVtb3ZlZCBlbGVtZW50cy4gVGhlIHByZWRpY2F0ZSBpcyBib3VuZCB0bw0KICAgICAqIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleCwgYXJyYXkpLg0KICAgICAqDQogICAgICogSWYgYSBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGEgdmFsdWUgaXMgYWxzbyBwcm92aWRlZCBmb3IgYHRoaXNBcmdgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNQcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWF0Y2hpbmcgcHJvcGVydHkNCiAgICAgKiB2YWx1ZSwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzYCBzdHlsZQ0KICAgICAqIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGdpdmVuDQogICAgICogb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLmZpbHRlcmAsIHRoaXMgbWV0aG9kIG11dGF0ZXMgYGFycmF5YC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkDQogICAgICogIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBwcmVkaWNhdGVgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHJlbW92ZWQgZWxlbWVudHMuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBhcnJheSA9IFsxLCAyLCAzLCA0XTsNCiAgICAgKiB2YXIgZXZlbnMgPSBfLnJlbW92ZShhcnJheSwgZnVuY3Rpb24obikgew0KICAgICAqICAgcmV0dXJuIG4gJSAyID09IDA7DQogICAgICogfSk7DQogICAgICoNCiAgICAgKiBjb25zb2xlLmxvZyhhcnJheSk7DQogICAgICogLy8gPT4gWzEsIDNdDQogICAgICoNCiAgICAgKiBjb25zb2xlLmxvZyhldmVucyk7DQogICAgICogLy8gPT4gWzIsIDRdDQogICAgICovDQogICAgZnVuY3Rpb24gcmVtb3ZlKGFycmF5LCBwcmVkaWNhdGUsIHRoaXNBcmcpIHsNCiAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgIGlmICghKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkpIHsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGluZGV4ZXMgPSBbXSwNCiAgICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGg7DQoNCiAgICAgIHByZWRpY2F0ZSA9IGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7DQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07DQogICAgICAgIGlmIChwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBhcnJheSkpIHsNCiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7DQogICAgICAgICAgaW5kZXhlcy5wdXNoKGluZGV4KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgYmFzZVB1bGxBdChhcnJheSwgaW5kZXhlcyk7DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldHMgYWxsIGJ1dCB0aGUgZmlyc3QgZWxlbWVudCBvZiBgYXJyYXlgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGFsaWFzIHRhaWwNCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnJlc3QoWzEsIDIsIDNdKTsNCiAgICAgKiAvLyA9PiBbMiwgM10NCiAgICAgKi8NCiAgICBmdW5jdGlvbiByZXN0KGFycmF5KSB7DQogICAgICByZXR1cm4gZHJvcChhcnJheSwgMSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgZnJvbSBgc3RhcnRgIHVwIHRvLCBidXQgbm90IGluY2x1ZGluZywgYGVuZGAuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgdXNlZCBpbnN0ZWFkIG9mIGBBcnJheSNzbGljZWAgdG8gc3VwcG9ydCBub2RlDQogICAgICogbGlzdHMgaW4gSUUgPCA5IGFuZCB0byBlbnN1cmUgZGVuc2UgYXJyYXlzIGFyZSByZXR1cm5lZC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzbGljZS4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2VuZD1hcnJheS5sZW5ndGhdIFRoZSBlbmQgcG9zaXRpb24uDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNsaWNlKGFycmF5LCBzdGFydCwgZW5kKSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOw0KICAgICAgaWYgKCFsZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgfQ0KICAgICAgaWYgKGVuZCAmJiB0eXBlb2YgZW5kICE9ICdudW1iZXInICYmIGlzSXRlcmF0ZWVDYWxsKGFycmF5LCBzdGFydCwgZW5kKSkgew0KICAgICAgICBzdGFydCA9IDA7DQogICAgICAgIGVuZCA9IGxlbmd0aDsNCiAgICAgIH0NCiAgICAgIHJldHVybiBiYXNlU2xpY2UoYXJyYXksIHN0YXJ0LCBlbmQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFVzZXMgYSBiaW5hcnkgc2VhcmNoIHRvIGRldGVybWluZSB0aGUgbG93ZXN0IGluZGV4IGF0IHdoaWNoIGB2YWx1ZWAgc2hvdWxkDQogICAgICogYmUgaW5zZXJ0ZWQgaW50byBgYXJyYXlgIGluIG9yZGVyIHRvIG1haW50YWluIGl0cyBzb3J0IG9yZGVyLiBJZiBhbiBpdGVyYXRlZQ0KICAgICAqIGZ1bmN0aW9uIGlzIHByb3ZpZGVkIGl0IGlzIGludm9rZWQgZm9yIGB2YWx1ZWAgYW5kIGVhY2ggZWxlbWVudCBvZiBgYXJyYXlgDQogICAgICogdG8gY29tcHV0ZSB0aGVpciBzb3J0IHJhbmtpbmcuIFRoZSBpdGVyYXRlZSBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kDQogICAgICogaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDsgKHZhbHVlKS4NCiAgICAgKg0KICAgICAqIElmIGEgcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZCBmb3IgYGl0ZXJhdGVlYCB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGEgdmFsdWUgaXMgYWxzbyBwcm92aWRlZCBmb3IgYHRoaXNBcmdgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNQcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWF0Y2hpbmcgcHJvcGVydHkNCiAgICAgKiB2YWx1ZSwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBgaXRlcmF0ZWVgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNgIHN0eWxlDQogICAgICogY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSB0aGUgcHJvcGVydGllcyBvZiB0aGUgZ2l2ZW4NCiAgICAgKiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBzb3J0ZWQgYXJyYXkgdG8gaW5zcGVjdC4NCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBldmFsdWF0ZS4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxzdHJpbmd9IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZA0KICAgICAqICBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgaXRlcmF0ZWVgLg0KICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IGF0IHdoaWNoIGB2YWx1ZWAgc2hvdWxkIGJlIGluc2VydGVkDQogICAgICogIGludG8gYGFycmF5YC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5zb3J0ZWRJbmRleChbMzAsIDUwXSwgNDApOw0KICAgICAqIC8vID0+IDENCiAgICAgKg0KICAgICAqIF8uc29ydGVkSW5kZXgoWzQsIDQsIDUsIDVdLCA1KTsNCiAgICAgKiAvLyA9PiAyDQogICAgICoNCiAgICAgKiB2YXIgZGljdCA9IHsgJ2RhdGEnOiB7ICd0aGlydHknOiAzMCwgJ2ZvcnR5JzogNDAsICdmaWZ0eSc6IDUwIH0gfTsNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIGFuIGl0ZXJhdGVlIGZ1bmN0aW9uDQogICAgICogXy5zb3J0ZWRJbmRleChbJ3RoaXJ0eScsICdmaWZ0eSddLCAnZm9ydHknLCBmdW5jdGlvbih3b3JkKSB7DQogICAgICogICByZXR1cm4gdGhpcy5kYXRhW3dvcmRdOw0KICAgICAqIH0sIGRpY3QpOw0KICAgICAqIC8vID0+IDENCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5wcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5zb3J0ZWRJbmRleChbeyAneCc6IDMwIH0sIHsgJ3gnOiA1MCB9XSwgeyAneCc6IDQwIH0sICd4Jyk7DQogICAgICogLy8gPT4gMQ0KICAgICAqLw0KICAgIHZhciBzb3J0ZWRJbmRleCA9IGNyZWF0ZVNvcnRlZEluZGV4KCk7DQoNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnNvcnRlZEluZGV4YCBleGNlcHQgdGhhdCBpdCByZXR1cm5zIHRoZSBoaWdoZXN0DQogICAgICogaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWQgaW50byBgYXJyYXlgIGluIG9yZGVyIHRvDQogICAgICogbWFpbnRhaW4gaXRzIHNvcnQgb3JkZXIuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgc29ydGVkIGFycmF5IHRvIGluc3BlY3QuDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gZXZhbHVhdGUuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQNCiAgICAgKiAgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGl0ZXJhdGVlYC4NCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgIHNob3VsZCBiZSBpbnNlcnRlZA0KICAgICAqICBpbnRvIGBhcnJheWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uc29ydGVkTGFzdEluZGV4KFs0LCA0LCA1LCA1XSwgNSk7DQogICAgICogLy8gPT4gNA0KICAgICAqLw0KICAgIHZhciBzb3J0ZWRMYXN0SW5kZXggPSBjcmVhdGVTb3J0ZWRJbmRleCh0cnVlKTsNCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIHdpdGggYG5gIGVsZW1lbnRzIHRha2VuIGZyb20gdGhlIGJlZ2lubmluZy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byB0YWtlLg0KICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhIGNhbGxiYWNrIGZvciBmdW5jdGlvbnMgbGlrZSBgXy5tYXBgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy50YWtlKFsxLCAyLCAzXSk7DQogICAgICogLy8gPT4gWzFdDQogICAgICoNCiAgICAgKiBfLnRha2UoWzEsIDIsIDNdLCAyKTsNCiAgICAgKiAvLyA9PiBbMSwgMl0NCiAgICAgKg0KICAgICAqIF8udGFrZShbMSwgMiwgM10sIDUpOw0KICAgICAqIC8vID0+IFsxLCAyLCAzXQ0KICAgICAqDQogICAgICogXy50YWtlKFsxLCAyLCAzXSwgMCk7DQogICAgICogLy8gPT4gW10NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0YWtlKGFycmF5LCBuLCBndWFyZCkgew0KICAgICAgdmFyIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMDsNCiAgICAgIGlmICghbGVuZ3RoKSB7DQogICAgICAgIHJldHVybiBbXTsNCiAgICAgIH0NCiAgICAgIGlmIChndWFyZCA/IGlzSXRlcmF0ZWVDYWxsKGFycmF5LCBuLCBndWFyZCkgOiBuID09IG51bGwpIHsNCiAgICAgICAgbiA9IDE7DQogICAgICB9DQogICAgICByZXR1cm4gYmFzZVNsaWNlKGFycmF5LCAwLCBuIDwgMCA/IDAgOiBuKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCB3aXRoIGBuYCBlbGVtZW50cyB0YWtlbiBmcm9tIHRoZSBlbmQuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtuPTFdIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gdGFrZS4NCiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYSBjYWxsYmFjayBmb3IgZnVuY3Rpb25zIGxpa2UgYF8ubWFwYC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8udGFrZVJpZ2h0KFsxLCAyLCAzXSk7DQogICAgICogLy8gPT4gWzNdDQogICAgICoNCiAgICAgKiBfLnRha2VSaWdodChbMSwgMiwgM10sIDIpOw0KICAgICAqIC8vID0+IFsyLCAzXQ0KICAgICAqDQogICAgICogXy50YWtlUmlnaHQoWzEsIDIsIDNdLCA1KTsNCiAgICAgKiAvLyA9PiBbMSwgMiwgM10NCiAgICAgKg0KICAgICAqIF8udGFrZVJpZ2h0KFsxLCAyLCAzXSwgMCk7DQogICAgICogLy8gPT4gW10NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0YWtlUmlnaHQoYXJyYXksIG4sIGd1YXJkKSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOw0KICAgICAgaWYgKCFsZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgfQ0KICAgICAgaWYgKGd1YXJkID8gaXNJdGVyYXRlZUNhbGwoYXJyYXksIG4sIGd1YXJkKSA6IG4gPT0gbnVsbCkgew0KICAgICAgICBuID0gMTsNCiAgICAgIH0NCiAgICAgIG4gPSBsZW5ndGggLSAoK24gfHwgMCk7DQogICAgICByZXR1cm4gYmFzZVNsaWNlKGFycmF5LCBuIDwgMCA/IDAgOiBuKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCB3aXRoIGVsZW1lbnRzIHRha2VuIGZyb20gdGhlIGVuZC4gRWxlbWVudHMgYXJlDQogICAgICogdGFrZW4gdW50aWwgYHByZWRpY2F0ZWAgcmV0dXJucyBmYWxzZXkuIFRoZSBwcmVkaWNhdGUgaXMgYm91bmQgdG8gYHRoaXNBcmdgDQogICAgICogYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXgsIGFycmF5KS4NCiAgICAgKg0KICAgICAqIElmIGEgcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZCBmb3IgYHByZWRpY2F0ZWAgdGhlIGNyZWF0ZWQgYF8ucHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUgb2YgdGhlIGdpdmVuIGVsZW1lbnQuDQogICAgICoNCiAgICAgKiBJZiBhIHZhbHVlIGlzIGFsc28gcHJvdmlkZWQgZm9yIGB0aGlzQXJnYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzUHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSBhIG1hdGNoaW5nIHByb3BlcnR5DQogICAgICogdmFsdWUsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIElmIGFuIG9iamVjdCBpcyBwcm92aWRlZCBmb3IgYHByZWRpY2F0ZWAgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc2Agc3R5bGUNCiAgICAgKiBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBnaXZlbg0KICAgICAqIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEFycmF5DQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5Lg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb258T2JqZWN0fHN0cmluZ30gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZA0KICAgICAqICBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgcHJlZGljYXRlYC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8udGFrZVJpZ2h0V2hpbGUoWzEsIDIsIDNdLCBmdW5jdGlvbihuKSB7DQogICAgICogICByZXR1cm4gbiA+IDE7DQogICAgICogfSk7DQogICAgICogLy8gPT4gWzIsIDNdDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSBbDQogICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICAnYWN0aXZlJzogdHJ1ZSB9LA0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sDQogICAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogZmFsc2UgfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc2AgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5wbHVjayhfLnRha2VSaWdodFdoaWxlKHVzZXJzLCB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogZmFsc2UgfSksICd1c2VyJyk7DQogICAgICogLy8gPT4gWydwZWJibGVzJ10NCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ucGx1Y2soXy50YWtlUmlnaHRXaGlsZSh1c2VycywgJ2FjdGl2ZScsIGZhbHNlKSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2ZyZWQnLCAncGViYmxlcyddDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ucGx1Y2soXy50YWtlUmlnaHRXaGlsZSh1c2VycywgJ2FjdGl2ZScpLCAndXNlcicpOw0KICAgICAqIC8vID0+IFtdDQogICAgICovDQogICAgZnVuY3Rpb24gdGFrZVJpZ2h0V2hpbGUoYXJyYXksIHByZWRpY2F0ZSwgdGhpc0FyZykgew0KICAgICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpDQogICAgICAgID8gYmFzZVdoaWxlKGFycmF5LCBnZXRDYWxsYmFjayhwcmVkaWNhdGUsIHRoaXNBcmcsIDMpLCBmYWxzZSwgdHJ1ZSkNCiAgICAgICAgOiBbXTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCB3aXRoIGVsZW1lbnRzIHRha2VuIGZyb20gdGhlIGJlZ2lubmluZy4gRWxlbWVudHMNCiAgICAgKiBhcmUgdGFrZW4gdW50aWwgYHByZWRpY2F0ZWAgcmV0dXJucyBmYWxzZXkuIFRoZSBwcmVkaWNhdGUgaXMgYm91bmQgdG8NCiAgICAgKiBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXgsIGFycmF5KS4NCiAgICAgKg0KICAgICAqIElmIGEgcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZCBmb3IgYHByZWRpY2F0ZWAgdGhlIGNyZWF0ZWQgYF8ucHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUgb2YgdGhlIGdpdmVuIGVsZW1lbnQuDQogICAgICoNCiAgICAgKiBJZiBhIHZhbHVlIGlzIGFsc28gcHJvdmlkZWQgZm9yIGB0aGlzQXJnYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzUHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSBhIG1hdGNoaW5nIHByb3BlcnR5DQogICAgICogdmFsdWUsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIElmIGFuIG9iamVjdCBpcyBwcm92aWRlZCBmb3IgYHByZWRpY2F0ZWAgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc2Agc3R5bGUNCiAgICAgKiBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBnaXZlbg0KICAgICAqIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEFycmF5DQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5Lg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb258T2JqZWN0fHN0cmluZ30gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZA0KICAgICAqICBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgcHJlZGljYXRlYC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8udGFrZVdoaWxlKFsxLCAyLCAzXSwgZnVuY3Rpb24obikgew0KICAgICAqICAgcmV0dXJuIG4gPCAzOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IFsxLCAyXQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gWw0KICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FjdGl2ZSc6IGZhbHNlIH0sDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICAnYWN0aXZlJzogZmFsc2V9LA0KICAgICAqICAgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IHRydWUgfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc2AgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5wbHVjayhfLnRha2VXaGlsZSh1c2VycywgeyAndXNlcic6ICdiYXJuZXknLCAnYWN0aXZlJzogZmFsc2UgfSksICd1c2VyJyk7DQogICAgICogLy8gPT4gWydiYXJuZXknXQ0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLm1hdGNoZXNQcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5wbHVjayhfLnRha2VXaGlsZSh1c2VycywgJ2FjdGl2ZScsIGZhbHNlKSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2Jhcm5leScsICdmcmVkJ10NCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5wcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5wbHVjayhfLnRha2VXaGlsZSh1c2VycywgJ2FjdGl2ZScpLCAndXNlcicpOw0KICAgICAqIC8vID0+IFtdDQogICAgICovDQogICAgZnVuY3Rpb24gdGFrZVdoaWxlKGFycmF5LCBwcmVkaWNhdGUsIHRoaXNBcmcpIHsNCiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKQ0KICAgICAgICA/IGJhc2VXaGlsZShhcnJheSwgZ2V0Q2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAzKSkNCiAgICAgICAgOiBbXTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHVuaXF1ZSB2YWx1ZXMsIGluIG9yZGVyLCBmcm9tIGFsbCBvZiB0aGUgcHJvdmlkZWQgYXJyYXlzDQogICAgICogdXNpbmcgW2BTYW1lVmFsdWVaZXJvYF0oaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLXNhbWV2YWx1ZXplcm8pDQogICAgICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEFycmF5DQogICAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0Lg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGNvbWJpbmVkIHZhbHVlcy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy51bmlvbihbMSwgMl0sIFs0LCAyXSwgWzIsIDFdKTsNCiAgICAgKiAvLyA9PiBbMSwgMiwgNF0NCiAgICAgKi8NCiAgICB2YXIgdW5pb24gPSByZXN0UGFyYW0oZnVuY3Rpb24oYXJyYXlzKSB7DQogICAgICByZXR1cm4gYmFzZVVuaXEoYmFzZUZsYXR0ZW4oYXJyYXlzLCBmYWxzZSwgdHJ1ZSkpOw0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGR1cGxpY2F0ZS1mcmVlIHZlcnNpb24gb2YgYW4gYXJyYXksIHVzaW5nDQogICAgICogW2BTYW1lVmFsdWVaZXJvYF0oaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLXNhbWV2YWx1ZXplcm8pDQogICAgICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLCBpbiB3aGljaCBvbmx5IHRoZSBmaXJzdCBvY2N1cmVuY2Ugb2YgZWFjaCBlbGVtZW50DQogICAgICogaXMga2VwdC4gUHJvdmlkaW5nIGB0cnVlYCBmb3IgYGlzU29ydGVkYCBwZXJmb3JtcyBhIGZhc3RlciBzZWFyY2ggYWxnb3JpdGhtDQogICAgICogZm9yIHNvcnRlZCBhcnJheXMuIElmIGFuIGl0ZXJhdGVlIGZ1bmN0aW9uIGlzIHByb3ZpZGVkIGl0IGlzIGludm9rZWQgZm9yDQogICAgICogZWFjaCBlbGVtZW50IGluIHRoZSBhcnJheSB0byBnZW5lcmF0ZSB0aGUgY3JpdGVyaW9uIGJ5IHdoaWNoIHVuaXF1ZW5lc3MNCiAgICAgKiBpcyBjb21wdXRlZC4gVGhlIGBpdGVyYXRlZWAgaXMgYm91bmQgdG8gYHRoaXNBcmdgIGFuZCBpbnZva2VkIHdpdGggdGhyZWUNCiAgICAgKiBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXgsIGFycmF5KS4NCiAgICAgKg0KICAgICAqIElmIGEgcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZCBmb3IgYGl0ZXJhdGVlYCB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGEgdmFsdWUgaXMgYWxzbyBwcm92aWRlZCBmb3IgYHRoaXNBcmdgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNQcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWF0Y2hpbmcgcHJvcGVydHkNCiAgICAgKiB2YWx1ZSwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBgaXRlcmF0ZWVgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNgIHN0eWxlDQogICAgICogY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSB0aGUgcHJvcGVydGllcyBvZiB0aGUgZ2l2ZW4NCiAgICAgKiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBhbGlhcyB1bmlxdWUNCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc1NvcnRlZF0gU3BlY2lmeSB0aGUgYXJyYXkgaXMgc29ydGVkLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb258T2JqZWN0fHN0cmluZ30gW2l0ZXJhdGVlXSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgaXRlcmF0ZWVgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGR1cGxpY2F0ZS12YWx1ZS1mcmVlIGFycmF5Lg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnVuaXEoWzIsIDEsIDJdKTsNCiAgICAgKiAvLyA9PiBbMiwgMV0NCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIGBpc1NvcnRlZGANCiAgICAgKiBfLnVuaXEoWzEsIDEsIDJdLCB0cnVlKTsNCiAgICAgKiAvLyA9PiBbMSwgMl0NCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIGFuIGl0ZXJhdGVlIGZ1bmN0aW9uDQogICAgICogXy51bmlxKFsxLCAyLjUsIDEuNSwgMl0sIGZ1bmN0aW9uKG4pIHsNCiAgICAgKiAgIHJldHVybiB0aGlzLmZsb29yKG4pOw0KICAgICAqIH0sIE1hdGgpOw0KICAgICAqIC8vID0+IFsxLCAyLjVdDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8udW5pcShbeyAneCc6IDEgfSwgeyAneCc6IDIgfSwgeyAneCc6IDEgfV0sICd4Jyk7DQogICAgICogLy8gPT4gW3sgJ3gnOiAxIH0sIHsgJ3gnOiAyIH1dDQogICAgICovDQogICAgZnVuY3Rpb24gdW5pcShhcnJheSwgaXNTb3J0ZWQsIGl0ZXJhdGVlLCB0aGlzQXJnKSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOw0KICAgICAgaWYgKCFsZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgfQ0KICAgICAgaWYgKGlzU29ydGVkICE9IG51bGwgJiYgdHlwZW9mIGlzU29ydGVkICE9ICdib29sZWFuJykgew0KICAgICAgICB0aGlzQXJnID0gaXRlcmF0ZWU7DQogICAgICAgIGl0ZXJhdGVlID0gaXNJdGVyYXRlZUNhbGwoYXJyYXksIGlzU29ydGVkLCB0aGlzQXJnKSA/IG51bGwgOiBpc1NvcnRlZDsNCiAgICAgICAgaXNTb3J0ZWQgPSBmYWxzZTsNCiAgICAgIH0NCiAgICAgIHZhciBjYWxsYmFjayA9IGdldENhbGxiYWNrKCk7DQogICAgICBpZiAoIShpdGVyYXRlZSA9PSBudWxsICYmIGNhbGxiYWNrID09PSBiYXNlQ2FsbGJhY2spKSB7DQogICAgICAgIGl0ZXJhdGVlID0gY2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDMpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIChpc1NvcnRlZCAmJiBnZXRJbmRleE9mKCkgPT0gYmFzZUluZGV4T2YpDQogICAgICAgID8gc29ydGVkVW5pcShhcnJheSwgaXRlcmF0ZWUpDQogICAgICAgIDogYmFzZVVuaXEoYXJyYXksIGl0ZXJhdGVlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnppcGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBhbiBhcnJheSBvZiBncm91cGVkDQogICAgICogZWxlbWVudHMgYW5kIGNyZWF0ZXMgYW4gYXJyYXkgcmVncm91cGluZyB0aGUgZWxlbWVudHMgdG8gdGhlaXIgcHJlLXppcA0KICAgICAqIGNvbmZpZ3VyYXRpb24uDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQXJyYXkNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cyB0byBwcm9jZXNzLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHJlZ3JvdXBlZCBlbGVtZW50cy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIHppcHBlZCA9IF8uemlwKFsnZnJlZCcsICdiYXJuZXknXSwgWzMwLCA0MF0sIFt0cnVlLCBmYWxzZV0pOw0KICAgICAqIC8vID0+IFtbJ2ZyZWQnLCAzMCwgdHJ1ZV0sIFsnYmFybmV5JywgNDAsIGZhbHNlXV0NCiAgICAgKg0KICAgICAqIF8udW56aXAoemlwcGVkKTsNCiAgICAgKiAvLyA9PiBbWydmcmVkJywgJ2Jhcm5leSddLCBbMzAsIDQwXSwgW3RydWUsIGZhbHNlXV0NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB1bnppcChhcnJheSkgew0KICAgICAgaWYgKCEoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSkgew0KICAgICAgICByZXR1cm4gW107DQogICAgICB9DQogICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICBsZW5ndGggPSAwOw0KDQogICAgICBhcnJheSA9IGFycmF5RmlsdGVyKGFycmF5LCBmdW5jdGlvbihncm91cCkgew0KICAgICAgICBpZiAoaXNBcnJheUxpa2UoZ3JvdXApKSB7DQogICAgICAgICAgbGVuZ3RoID0gbmF0aXZlTWF4KGdyb3VwLmxlbmd0aCwgbGVuZ3RoKTsNCiAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgICB2YXIgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTsNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIHJlc3VsdFtpbmRleF0gPSBhcnJheU1hcChhcnJheSwgYmFzZVByb3BlcnR5KGluZGV4KSk7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udW56aXBgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYW4gaXRlcmF0ZWUgdG8gc3BlY2lmeQ0KICAgICAqIGhvdyByZWdyb3VwZWQgdmFsdWVzIHNob3VsZCBiZSBjb21iaW5lZC4gVGhlIGBpdGVyYXRlZWAgaXMgYm91bmQgdG8gYHRoaXNBcmdgDQogICAgICogYW5kIGludm9rZWQgd2l0aCBmb3VyIGFyZ3VtZW50czogKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaW5kZXgsIGdyb3VwKS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSBvZiBncm91cGVkIGVsZW1lbnRzIHRvIHByb2Nlc3MuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlXSBUaGUgZnVuY3Rpb24gdG8gY29tYmluZSByZWdyb3VwZWQgdmFsdWVzLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgaXRlcmF0ZWVgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHJlZ3JvdXBlZCBlbGVtZW50cy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIHppcHBlZCA9IF8uemlwKFsxLCAyXSwgWzEwLCAyMF0sIFsxMDAsIDIwMF0pOw0KICAgICAqIC8vID0+IFtbMSwgMTAsIDEwMF0sIFsyLCAyMCwgMjAwXV0NCiAgICAgKg0KICAgICAqIF8udW56aXBXaXRoKHppcHBlZCwgXy5hZGQpOw0KICAgICAqIC8vID0+IFszLCAzMCwgMzAwXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHVuemlwV2l0aChhcnJheSwgaXRlcmF0ZWUsIHRoaXNBcmcpIHsNCiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7DQogICAgICBpZiAoIWxlbmd0aCkgew0KICAgICAgICByZXR1cm4gW107DQogICAgICB9DQogICAgICB2YXIgcmVzdWx0ID0gdW56aXAoYXJyYXkpOw0KICAgICAgaWYgKGl0ZXJhdGVlID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCiAgICAgIGl0ZXJhdGVlID0gYmluZENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCA0KTsNCiAgICAgIHJldHVybiBhcnJheU1hcChyZXN1bHQsIGZ1bmN0aW9uKGdyb3VwKSB7DQogICAgICAgIHJldHVybiBhcnJheVJlZHVjZShncm91cCwgaXRlcmF0ZWUsIHVuZGVmaW5lZCwgdHJ1ZSk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IGV4Y2x1ZGluZyBhbGwgcHJvdmlkZWQgdmFsdWVzIHVzaW5nDQogICAgICogW2BTYW1lVmFsdWVaZXJvYF0oaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLXNhbWV2YWx1ZXplcm8pDQogICAgICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEFycmF5DQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGZpbHRlci4NCiAgICAgKiBAcGFyYW0gey4uLip9IFt2YWx1ZXNdIFRoZSB2YWx1ZXMgdG8gZXhjbHVkZS4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8ud2l0aG91dChbMSwgMiwgMSwgM10sIDEsIDIpOw0KICAgICAqIC8vID0+IFszXQ0KICAgICAqLw0KICAgIHZhciB3aXRob3V0ID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGFycmF5LCB2YWx1ZXMpIHsNCiAgICAgIHJldHVybiBpc0FycmF5TGlrZShhcnJheSkNCiAgICAgICAgPyBiYXNlRGlmZmVyZW5jZShhcnJheSwgdmFsdWVzKQ0KICAgICAgICA6IFtdOw0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB1bmlxdWUgdmFsdWVzIHRoYXQgaXMgdGhlIFtzeW1tZXRyaWMgZGlmZmVyZW5jZV0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU3ltbWV0cmljX2RpZmZlcmVuY2UpDQogICAgICogb2YgdGhlIHByb3ZpZGVkIGFycmF5cy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiB2YWx1ZXMuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8ueG9yKFsxLCAyXSwgWzQsIDJdKTsNCiAgICAgKiAvLyA9PiBbMSwgNF0NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB4b3IoKSB7DQogICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOw0KDQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICB2YXIgYXJyYXkgPSBhcmd1bWVudHNbaW5kZXhdOw0KICAgICAgICBpZiAoaXNBcnJheUxpa2UoYXJyYXkpKSB7DQogICAgICAgICAgdmFyIHJlc3VsdCA9IHJlc3VsdA0KICAgICAgICAgICAgPyBiYXNlRGlmZmVyZW5jZShyZXN1bHQsIGFycmF5KS5jb25jYXQoYmFzZURpZmZlcmVuY2UoYXJyYXksIHJlc3VsdCkpDQogICAgICAgICAgICA6IGFycmF5Ow0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0ID8gYmFzZVVuaXEocmVzdWx0KSA6IFtdOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cywgdGhlIGZpcnN0IG9mIHdoaWNoIGNvbnRhaW5zIHRoZSBmaXJzdA0KICAgICAqIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBhcnJheXMsIHRoZSBzZWNvbmQgb2Ygd2hpY2ggY29udGFpbnMgdGhlIHNlY29uZCBlbGVtZW50cw0KICAgICAqIG9mIHRoZSBnaXZlbiBhcnJheXMsIGFuZCBzbyBvbi4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gcHJvY2Vzcy4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBncm91cGVkIGVsZW1lbnRzLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnppcChbJ2ZyZWQnLCAnYmFybmV5J10sIFszMCwgNDBdLCBbdHJ1ZSwgZmFsc2VdKTsNCiAgICAgKiAvLyA9PiBbWydmcmVkJywgMzAsIHRydWVdLCBbJ2Jhcm5leScsIDQwLCBmYWxzZV1dDQogICAgICovDQogICAgdmFyIHppcCA9IHJlc3RQYXJhbSh1bnppcCk7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgaW52ZXJzZSBvZiBgXy5wYWlyc2A7IHRoaXMgbWV0aG9kIHJldHVybnMgYW4gb2JqZWN0IGNvbXBvc2VkIGZyb20gYXJyYXlzDQogICAgICogb2YgcHJvcGVydHkgbmFtZXMgYW5kIHZhbHVlcy4gUHJvdmlkZSBlaXRoZXIgYSBzaW5nbGUgdHdvIGRpbWVuc2lvbmFsIGFycmF5LA0KICAgICAqIGUuZy4gYFtba2V5MSwgdmFsdWUxXSwgW2tleTIsIHZhbHVlMl1dYCBvciB0d28gYXJyYXlzLCBvbmUgb2YgcHJvcGVydHkgbmFtZXMNCiAgICAgKiBhbmQgb25lIG9mIGNvcnJlc3BvbmRpbmcgdmFsdWVzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGFsaWFzIG9iamVjdA0KICAgICAqIEBjYXRlZ29yeSBBcnJheQ0KICAgICAqIEBwYXJhbSB7QXJyYXl9IHByb3BzIFRoZSBwcm9wZXJ0eSBuYW1lcy4NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbdmFsdWVzPVtdXSBUaGUgcHJvcGVydHkgdmFsdWVzLg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uemlwT2JqZWN0KFtbJ2ZyZWQnLCAzMF0sIFsnYmFybmV5JywgNDBdXSk7DQogICAgICogLy8gPT4geyAnZnJlZCc6IDMwLCAnYmFybmV5JzogNDAgfQ0KICAgICAqDQogICAgICogXy56aXBPYmplY3QoWydmcmVkJywgJ2Jhcm5leSddLCBbMzAsIDQwXSk7DQogICAgICogLy8gPT4geyAnZnJlZCc6IDMwLCAnYmFybmV5JzogNDAgfQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHppcE9iamVjdChwcm9wcywgdmFsdWVzKSB7DQogICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICBsZW5ndGggPSBwcm9wcyA/IHByb3BzLmxlbmd0aCA6IDAsDQogICAgICAgICAgcmVzdWx0ID0ge307DQoNCiAgICAgIGlmIChsZW5ndGggJiYgIXZhbHVlcyAmJiAhaXNBcnJheShwcm9wc1swXSkpIHsNCiAgICAgICAgdmFsdWVzID0gW107DQogICAgICB9DQogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgew0KICAgICAgICB2YXIga2V5ID0gcHJvcHNbaW5kZXhdOw0KICAgICAgICBpZiAodmFsdWVzKSB7DQogICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZXNbaW5kZXhdOw0KICAgICAgICB9IGVsc2UgaWYgKGtleSkgew0KICAgICAgICAgIHJlc3VsdFtrZXlbMF1dID0ga2V5WzFdOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uemlwYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGFuIGl0ZXJhdGVlIHRvIHNwZWNpZnkNCiAgICAgKiBob3cgZ3JvdXBlZCB2YWx1ZXMgc2hvdWxkIGJlIGNvbWJpbmVkLiBUaGUgYGl0ZXJhdGVlYCBpcyBib3VuZCB0byBgdGhpc0FyZ2ANCiAgICAgKiBhbmQgaW52b2tlZCB3aXRoIGZvdXIgYXJndW1lbnRzOiAoYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgZ3JvdXApLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEFycmF5DQogICAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBwcm9jZXNzLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZV0gVGhlIGZ1bmN0aW9uIHRvIGNvbWJpbmUgZ3JvdXBlZCB2YWx1ZXMuDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBpdGVyYXRlZWAuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy56aXBXaXRoKFsxLCAyXSwgWzEwLCAyMF0sIFsxMDAsIDIwMF0sIF8uYWRkKTsNCiAgICAgKiAvLyA9PiBbMTExLCAyMjJdDQogICAgICovDQogICAgdmFyIHppcFdpdGggPSByZXN0UGFyYW0oZnVuY3Rpb24oYXJyYXlzKSB7DQogICAgICB2YXIgbGVuZ3RoID0gYXJyYXlzLmxlbmd0aCwNCiAgICAgICAgICBpdGVyYXRlZSA9IGxlbmd0aCA+IDIgPyBhcnJheXNbbGVuZ3RoIC0gMl0gOiB1bmRlZmluZWQsDQogICAgICAgICAgdGhpc0FyZyA9IGxlbmd0aCA+IDEgPyBhcnJheXNbbGVuZ3RoIC0gMV0gOiB1bmRlZmluZWQ7DQoNCiAgICAgIGlmIChsZW5ndGggPiAyICYmIHR5cGVvZiBpdGVyYXRlZSA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGxlbmd0aCAtPSAyOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaXRlcmF0ZWUgPSAobGVuZ3RoID4gMSAmJiB0eXBlb2YgdGhpc0FyZyA9PSAnZnVuY3Rpb24nKSA/ICgtLWxlbmd0aCwgdGhpc0FyZykgOiB1bmRlZmluZWQ7DQogICAgICAgIHRoaXNBcmcgPSB1bmRlZmluZWQ7DQogICAgICB9DQogICAgICBhcnJheXMubGVuZ3RoID0gbGVuZ3RoOw0KICAgICAgcmV0dXJuIHVuemlwV2l0aChhcnJheXMsIGl0ZXJhdGVlLCB0aGlzQXJnKTsNCiAgICB9KTsNCg0KICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBgbG9kYXNoYCBvYmplY3QgdGhhdCB3cmFwcyBgdmFsdWVgIHdpdGggZXhwbGljaXQgbWV0aG9kDQogICAgICogY2hhaW5pbmcgZW5hYmxlZC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBDaGFpbg0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHdyYXAuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IGBsb2Rhc2hgIHdyYXBwZXIgaW5zdGFuY2UuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciB1c2VycyA9IFsNCiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgICdhZ2UnOiAzNiB9LA0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FnZSc6IDQwIH0sDQogICAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWdlJzogMSB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIHZhciB5b3VuZ2VzdCA9IF8uY2hhaW4odXNlcnMpDQogICAgICogICAuc29ydEJ5KCdhZ2UnKQ0KICAgICAqICAgLm1hcChmdW5jdGlvbihjaHIpIHsNCiAgICAgKiAgICAgcmV0dXJuIGNoci51c2VyICsgJyBpcyAnICsgY2hyLmFnZTsNCiAgICAgKiAgIH0pDQogICAgICogICAuZmlyc3QoKQ0KICAgICAqICAgLnZhbHVlKCk7DQogICAgICogLy8gPT4gJ3BlYmJsZXMgaXMgMScNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjaGFpbih2YWx1ZSkgew0KICAgICAgdmFyIHJlc3VsdCA9IGxvZGFzaCh2YWx1ZSk7DQogICAgICByZXN1bHQuX19jaGFpbl9fID0gdHJ1ZTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaW52b2tlcyBgaW50ZXJjZXB0b3JgIGFuZCByZXR1cm5zIGB2YWx1ZWAuIFRoZSBpbnRlcmNlcHRvciBpcw0KICAgICAqIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDsgKHZhbHVlKS4gVGhlIHB1cnBvc2Ugb2YNCiAgICAgKiB0aGlzIG1ldGhvZCBpcyB0byAidGFwIGludG8iIGEgbWV0aG9kIGNoYWluIGluIG9yZGVyIHRvIHBlcmZvcm0gb3BlcmF0aW9ucw0KICAgICAqIG9uIGludGVybWVkaWF0ZSByZXN1bHRzIHdpdGhpbiB0aGUgY2hhaW4uDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ2hhaW4NCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBwcm92aWRlIHRvIGBpbnRlcmNlcHRvcmAuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaW50ZXJjZXB0b3IgVGhlIGZ1bmN0aW9uIHRvIGludm9rZS4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGludGVyY2VwdG9yYC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyBgdmFsdWVgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfKFsxLCAyLCAzXSkNCiAgICAgKiAgLnRhcChmdW5jdGlvbihhcnJheSkgew0KICAgICAqICAgIGFycmF5LnBvcCgpOw0KICAgICAqICB9KQ0KICAgICAqICAucmV2ZXJzZSgpDQogICAgICogIC52YWx1ZSgpOw0KICAgICAqIC8vID0+IFsyLCAxXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRhcCh2YWx1ZSwgaW50ZXJjZXB0b3IsIHRoaXNBcmcpIHsNCiAgICAgIGludGVyY2VwdG9yLmNhbGwodGhpc0FyZywgdmFsdWUpOw0KICAgICAgcmV0dXJuIHZhbHVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udGFwYCBleGNlcHQgdGhhdCBpdCByZXR1cm5zIHRoZSByZXN1bHQgb2YgYGludGVyY2VwdG9yYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBDaGFpbg0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb3ZpZGUgdG8gYGludGVyY2VwdG9yYC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpbnRlcmNlcHRvciBUaGUgZnVuY3Rpb24gdG8gaW52b2tlLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgaW50ZXJjZXB0b3JgLg0KICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXN1bHQgb2YgYGludGVyY2VwdG9yYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXygnICBhYmMgICcpDQogICAgICogIC5jaGFpbigpDQogICAgICogIC50cmltKCkNCiAgICAgKiAgLnRocnUoZnVuY3Rpb24odmFsdWUpIHsNCiAgICAgKiAgICByZXR1cm4gW3ZhbHVlXTsNCiAgICAgKiAgfSkNCiAgICAgKiAgLnZhbHVlKCk7DQogICAgICogLy8gPT4gWydhYmMnXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRocnUodmFsdWUsIGludGVyY2VwdG9yLCB0aGlzQXJnKSB7DQogICAgICByZXR1cm4gaW50ZXJjZXB0b3IuY2FsbCh0aGlzQXJnLCB2YWx1ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRW5hYmxlcyBleHBsaWNpdCBtZXRob2QgY2hhaW5pbmcgb24gdGhlIHdyYXBwZXIgb2JqZWN0Lg0KICAgICAqDQogICAgICogQG5hbWUgY2hhaW4NCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBDaGFpbg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBgbG9kYXNoYCB3cmFwcGVyIGluc3RhbmNlLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSBbDQogICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICdhZ2UnOiAzNiB9LA0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAnYWdlJzogNDAgfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiAvLyB3aXRob3V0IGV4cGxpY2l0IGNoYWluaW5nDQogICAgICogXyh1c2VycykuZmlyc3QoKTsNCiAgICAgKiAvLyA9PiB7ICd1c2VyJzogJ2Jhcm5leScsICdhZ2UnOiAzNiB9DQogICAgICoNCiAgICAgKiAvLyB3aXRoIGV4cGxpY2l0IGNoYWluaW5nDQogICAgICogXyh1c2VycykuY2hhaW4oKQ0KICAgICAqICAgLmZpcnN0KCkNCiAgICAgKiAgIC5waWNrKCd1c2VyJykNCiAgICAgKiAgIC52YWx1ZSgpOw0KICAgICAqIC8vID0+IHsgJ3VzZXInOiAnYmFybmV5JyB9DQogICAgICovDQogICAgZnVuY3Rpb24gd3JhcHBlckNoYWluKCkgew0KICAgICAgcmV0dXJuIGNoYWluKHRoaXMpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEV4ZWN1dGVzIHRoZSBjaGFpbmVkIHNlcXVlbmNlIGFuZCByZXR1cm5zIHRoZSB3cmFwcGVkIHJlc3VsdC4NCiAgICAgKg0KICAgICAqIEBuYW1lIGNvbW1pdA0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IENoYWluDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IGBsb2Rhc2hgIHdyYXBwZXIgaW5zdGFuY2UuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBhcnJheSA9IFsxLCAyXTsNCiAgICAgKiB2YXIgd3JhcHBlciA9IF8oYXJyYXkpLnB1c2goMyk7DQogICAgICoNCiAgICAgKiBjb25zb2xlLmxvZyhhcnJheSk7DQogICAgICogLy8gPT4gWzEsIDJdDQogICAgICoNCiAgICAgKiB3cmFwcGVyID0gd3JhcHBlci5jb21taXQoKTsNCiAgICAgKiBjb25zb2xlLmxvZyhhcnJheSk7DQogICAgICogLy8gPT4gWzEsIDIsIDNdDQogICAgICoNCiAgICAgKiB3cmFwcGVyLmxhc3QoKTsNCiAgICAgKiAvLyA9PiAzDQogICAgICoNCiAgICAgKiBjb25zb2xlLmxvZyhhcnJheSk7DQogICAgICogLy8gPT4gWzEsIDIsIDNdDQogICAgICovDQogICAgZnVuY3Rpb24gd3JhcHBlckNvbW1pdCgpIHsNCiAgICAgIHJldHVybiBuZXcgTG9kYXNoV3JhcHBlcih0aGlzLnZhbHVlKCksIHRoaXMuX19jaGFpbl9fKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgdGhlIGNoYWluZWQgc2VxdWVuY2UgcGxhbnRpbmcgYHZhbHVlYCBhcyB0aGUgd3JhcHBlZCB2YWx1ZS4NCiAgICAgKg0KICAgICAqIEBuYW1lIHBsYW50DQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ2hhaW4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgYGxvZGFzaGAgd3JhcHBlciBpbnN0YW5jZS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIGFycmF5ID0gWzEsIDJdOw0KICAgICAqIHZhciB3cmFwcGVyID0gXyhhcnJheSkubWFwKGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICogICByZXR1cm4gTWF0aC5wb3codmFsdWUsIDIpOw0KICAgICAqIH0pOw0KICAgICAqDQogICAgICogdmFyIG90aGVyID0gWzMsIDRdOw0KICAgICAqIHZhciBvdGhlcldyYXBwZXIgPSB3cmFwcGVyLnBsYW50KG90aGVyKTsNCiAgICAgKg0KICAgICAqIG90aGVyV3JhcHBlci52YWx1ZSgpOw0KICAgICAqIC8vID0+IFs5LCAxNl0NCiAgICAgKg0KICAgICAqIHdyYXBwZXIudmFsdWUoKTsNCiAgICAgKiAvLyA9PiBbMSwgNF0NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB3cmFwcGVyUGxhbnQodmFsdWUpIHsNCiAgICAgIHZhciByZXN1bHQsDQogICAgICAgICAgcGFyZW50ID0gdGhpczsNCg0KICAgICAgd2hpbGUgKHBhcmVudCBpbnN0YW5jZW9mIGJhc2VMb2Rhc2gpIHsNCiAgICAgICAgdmFyIGNsb25lID0gd3JhcHBlckNsb25lKHBhcmVudCk7DQogICAgICAgIGlmIChyZXN1bHQpIHsNCiAgICAgICAgICBwcmV2aW91cy5fX3dyYXBwZWRfXyA9IGNsb25lOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdCA9IGNsb25lOw0KICAgICAgICB9DQogICAgICAgIHZhciBwcmV2aW91cyA9IGNsb25lOw0KICAgICAgICBwYXJlbnQgPSBwYXJlbnQuX193cmFwcGVkX187DQogICAgICB9DQogICAgICBwcmV2aW91cy5fX3dyYXBwZWRfXyA9IHZhbHVlOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXZlcnNlcyB0aGUgd3JhcHBlZCBhcnJheSBzbyB0aGUgZmlyc3QgZWxlbWVudCBiZWNvbWVzIHRoZSBsYXN0LCB0aGUNCiAgICAgKiBzZWNvbmQgZWxlbWVudCBiZWNvbWVzIHRoZSBzZWNvbmQgdG8gbGFzdCwgYW5kIHNvIG9uLg0KICAgICAqDQogICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIG11dGF0ZXMgdGhlIHdyYXBwZWQgYXJyYXkuDQogICAgICoNCiAgICAgKiBAbmFtZSByZXZlcnNlDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ2hhaW4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgcmV2ZXJzZWQgYGxvZGFzaGAgd3JhcHBlciBpbnN0YW5jZS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIGFycmF5ID0gWzEsIDIsIDNdOw0KICAgICAqDQogICAgICogXyhhcnJheSkucmV2ZXJzZSgpLnZhbHVlKCkNCiAgICAgKiAvLyA9PiBbMywgMiwgMV0NCiAgICAgKg0KICAgICAqIGNvbnNvbGUubG9nKGFycmF5KTsNCiAgICAgKiAvLyA9PiBbMywgMiwgMV0NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB3cmFwcGVyUmV2ZXJzZSgpIHsNCiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX193cmFwcGVkX187DQogICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBMYXp5V3JhcHBlcikgew0KICAgICAgICBpZiAodGhpcy5fX2FjdGlvbnNfXy5sZW5ndGgpIHsNCiAgICAgICAgICB2YWx1ZSA9IG5ldyBMYXp5V3JhcHBlcih0aGlzKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbmV3IExvZGFzaFdyYXBwZXIodmFsdWUucmV2ZXJzZSgpLCB0aGlzLl9fY2hhaW5fXyk7DQogICAgICB9DQogICAgICByZXR1cm4gdGhpcy50aHJ1KGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICAgIHJldHVybiB2YWx1ZS5yZXZlcnNlKCk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBQcm9kdWNlcyB0aGUgcmVzdWx0IG9mIGNvZXJjaW5nIHRoZSB1bndyYXBwZWQgdmFsdWUgdG8gYSBzdHJpbmcuDQogICAgICoNCiAgICAgKiBAbmFtZSB0b1N0cmluZw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IENoYWluDQogICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgY29lcmNlZCBzdHJpbmcgdmFsdWUuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8oWzEsIDIsIDNdKS50b1N0cmluZygpOw0KICAgICAqIC8vID0+ICcxLDIsMycNCiAgICAgKi8NCiAgICBmdW5jdGlvbiB3cmFwcGVyVG9TdHJpbmcoKSB7DQogICAgICByZXR1cm4gKHRoaXMudmFsdWUoKSArICcnKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBFeGVjdXRlcyB0aGUgY2hhaW5lZCBzZXF1ZW5jZSB0byBleHRyYWN0IHRoZSB1bndyYXBwZWQgdmFsdWUuDQogICAgICoNCiAgICAgKiBAbmFtZSB2YWx1ZQ0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGFsaWFzIHJ1biwgdG9KU09OLCB2YWx1ZU9mDQogICAgICogQGNhdGVnb3J5IENoYWluDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHJlc29sdmVkIHVud3JhcHBlZCB2YWx1ZS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXyhbMSwgMiwgM10pLnZhbHVlKCk7DQogICAgICogLy8gPT4gWzEsIDIsIDNdDQogICAgICovDQogICAgZnVuY3Rpb24gd3JhcHBlclZhbHVlKCkgew0KICAgICAgcmV0dXJuIGJhc2VXcmFwcGVyVmFsdWUodGhpcy5fX3dyYXBwZWRfXywgdGhpcy5fX2FjdGlvbnNfXyk7DQogICAgfQ0KDQogICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBlbGVtZW50cyBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBrZXlzLCBvciBpbmRleGVzLA0KICAgICAqIG9mIGBjb2xsZWN0aW9uYC4gS2V5cyBtYXkgYmUgc3BlY2lmaWVkIGFzIGluZGl2aWR1YWwgYXJndW1lbnRzIG9yIGFzIGFycmF5cw0KICAgICAqIG9mIGtleXMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHsuLi4obnVtYmVyfG51bWJlcltdfHN0cmluZ3xzdHJpbmdbXSl9IFtwcm9wc10gVGhlIHByb3BlcnR5IG5hbWVzDQogICAgICogIG9yIGluZGV4ZXMgb2YgZWxlbWVudHMgdG8gcGljaywgc3BlY2lmaWVkIGluZGl2aWR1YWxseSBvciBpbiBhcnJheXMuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgcGlja2VkIGVsZW1lbnRzLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmF0KFsnYScsICdiJywgJ2MnXSwgWzAsIDJdKTsNCiAgICAgKiAvLyA9PiBbJ2EnLCAnYyddDQogICAgICoNCiAgICAgKiBfLmF0KFsnYmFybmV5JywgJ2ZyZWQnLCAncGViYmxlcyddLCAwLCAyKTsNCiAgICAgKiAvLyA9PiBbJ2Jhcm5leScsICdwZWJibGVzJ10NCiAgICAgKi8NCiAgICB2YXIgYXQgPSByZXN0UGFyYW0oZnVuY3Rpb24oY29sbGVjdGlvbiwgcHJvcHMpIHsNCiAgICAgIHJldHVybiBiYXNlQXQoY29sbGVjdGlvbiwgYmFzZUZsYXR0ZW4ocHJvcHMpKTsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYW4gb2JqZWN0IGNvbXBvc2VkIG9mIGtleXMgZ2VuZXJhdGVkIGZyb20gdGhlIHJlc3VsdHMgb2YgcnVubmluZw0KICAgICAqIGVhY2ggZWxlbWVudCBvZiBgY29sbGVjdGlvbmAgdGhyb3VnaCBgaXRlcmF0ZWVgLiBUaGUgY29ycmVzcG9uZGluZyB2YWx1ZQ0KICAgICAqIG9mIGVhY2gga2V5IGlzIHRoZSBudW1iZXIgb2YgdGltZXMgdGhlIGtleSB3YXMgcmV0dXJuZWQgYnkgYGl0ZXJhdGVlYC4NCiAgICAgKiBUaGUgYGl0ZXJhdGVlYCBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM6DQogICAgICogKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLg0KICAgICAqDQogICAgICogSWYgYSBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkIGZvciBgaXRlcmF0ZWVgIHRoZSBjcmVhdGVkIGBfLnByb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlIG9mIHRoZSBnaXZlbiBlbGVtZW50Lg0KICAgICAqDQogICAgICogSWYgYSB2YWx1ZSBpcyBhbHNvIHByb3ZpZGVkIGZvciBgdGhpc0FyZ2AgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc1Byb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgYSBtYXRjaGluZyBwcm9wZXJ0eQ0KICAgICAqIHZhbHVlLCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBJZiBhbiBvYmplY3QgaXMgcHJvdmlkZWQgZm9yIGBpdGVyYXRlZWAgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc2Agc3R5bGUNCiAgICAgKiBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBnaXZlbg0KICAgICAqIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb24NCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb258T2JqZWN0fHN0cmluZ30gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkDQogICAgICogIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBpdGVyYXRlZWAuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY29tcG9zZWQgYWdncmVnYXRlIG9iamVjdC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5jb3VudEJ5KFs0LjMsIDYuMSwgNi40XSwgZnVuY3Rpb24obikgew0KICAgICAqICAgcmV0dXJuIE1hdGguZmxvb3Iobik7DQogICAgICogfSk7DQogICAgICogLy8gPT4geyAnNCc6IDEsICc2JzogMiB9DQogICAgICoNCiAgICAgKiBfLmNvdW50QnkoWzQuMywgNi4xLCA2LjRdLCBmdW5jdGlvbihuKSB7DQogICAgICogICByZXR1cm4gdGhpcy5mbG9vcihuKTsNCiAgICAgKiB9LCBNYXRoKTsNCiAgICAgKiAvLyA9PiB7ICc0JzogMSwgJzYnOiAyIH0NCiAgICAgKg0KICAgICAqIF8uY291bnRCeShbJ29uZScsICd0d28nLCAndGhyZWUnXSwgJ2xlbmd0aCcpOw0KICAgICAqIC8vID0+IHsgJzMnOiAyLCAnNSc6IDEgfQ0KICAgICAqLw0KICAgIHZhciBjb3VudEJ5ID0gY3JlYXRlQWdncmVnYXRvcihmdW5jdGlvbihyZXN1bHQsIHZhbHVlLCBrZXkpIHsNCiAgICAgIGhhc093blByb3BlcnR5LmNhbGwocmVzdWx0LCBrZXkpID8gKytyZXN1bHRba2V5XSA6IChyZXN1bHRba2V5XSA9IDEpOw0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGBwcmVkaWNhdGVgIHJldHVybnMgdHJ1dGh5IGZvciAqKmFsbCoqIGVsZW1lbnRzIG9mIGBjb2xsZWN0aW9uYC4NCiAgICAgKiBUaGUgcHJlZGljYXRlIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czoNCiAgICAgKiAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuDQogICAgICoNCiAgICAgKiBJZiBhIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQgZm9yIGBwcmVkaWNhdGVgIHRoZSBjcmVhdGVkIGBfLnByb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlIG9mIHRoZSBnaXZlbiBlbGVtZW50Lg0KICAgICAqDQogICAgICogSWYgYSB2YWx1ZSBpcyBhbHNvIHByb3ZpZGVkIGZvciBgdGhpc0FyZ2AgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc1Byb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgYSBtYXRjaGluZyBwcm9wZXJ0eQ0KICAgICAqIHZhbHVlLCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBJZiBhbiBvYmplY3QgaXMgcHJvdmlkZWQgZm9yIGBwcmVkaWNhdGVgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNgIHN0eWxlDQogICAgICogY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSB0aGUgcHJvcGVydGllcyBvZiB0aGUgZ2l2ZW4NCiAgICAgKiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBhbGlhcyBhbGwNCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkDQogICAgICogIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBwcmVkaWNhdGVgLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbGwgZWxlbWVudHMgcGFzcyB0aGUgcHJlZGljYXRlIGNoZWNrLA0KICAgICAqICBlbHNlIGBmYWxzZWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uZXZlcnkoW3RydWUsIDEsIG51bGwsICd5ZXMnXSwgQm9vbGVhbik7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKg0KICAgICAqIHZhciB1c2VycyA9IFsNCiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FjdGl2ZSc6IGZhbHNlIH0sDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhY3RpdmUnOiBmYWxzZSB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5tYXRjaGVzYCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLmV2ZXJ5KHVzZXJzLCB7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiBmYWxzZSB9KTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLm1hdGNoZXNQcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5ldmVyeSh1c2VycywgJ2FjdGl2ZScsIGZhbHNlKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8uZXZlcnkodXNlcnMsICdhY3RpdmUnKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGV2ZXJ5KGNvbGxlY3Rpb24sIHByZWRpY2F0ZSwgdGhpc0FyZykgew0KICAgICAgdmFyIGZ1bmMgPSBpc0FycmF5KGNvbGxlY3Rpb24pID8gYXJyYXlFdmVyeSA6IGJhc2VFdmVyeTsNCiAgICAgIGlmICh0aGlzQXJnICYmIGlzSXRlcmF0ZWVDYWxsKGNvbGxlY3Rpb24sIHByZWRpY2F0ZSwgdGhpc0FyZykpIHsNCiAgICAgICAgcHJlZGljYXRlID0gbnVsbDsNCiAgICAgIH0NCiAgICAgIGlmICh0eXBlb2YgcHJlZGljYXRlICE9ICdmdW5jdGlvbicgfHwgdGhpc0FyZyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHByZWRpY2F0ZSA9IGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7DQogICAgICB9DQogICAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBwcmVkaWNhdGUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEl0ZXJhdGVzIG92ZXIgZWxlbWVudHMgb2YgYGNvbGxlY3Rpb25gLCByZXR1cm5pbmcgYW4gYXJyYXkgb2YgYWxsIGVsZW1lbnRzDQogICAgICogYHByZWRpY2F0ZWAgcmV0dXJucyB0cnV0aHkgZm9yLiBUaGUgcHJlZGljYXRlIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQNCiAgICAgKiBpbnZva2VkIHdpdGggdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuDQogICAgICoNCiAgICAgKiBJZiBhIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQgZm9yIGBwcmVkaWNhdGVgIHRoZSBjcmVhdGVkIGBfLnByb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlIG9mIHRoZSBnaXZlbiBlbGVtZW50Lg0KICAgICAqDQogICAgICogSWYgYSB2YWx1ZSBpcyBhbHNvIHByb3ZpZGVkIGZvciBgdGhpc0FyZ2AgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc1Byb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgYSBtYXRjaGluZyBwcm9wZXJ0eQ0KICAgICAqIHZhbHVlLCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBJZiBhbiBvYmplY3QgaXMgcHJvdmlkZWQgZm9yIGBwcmVkaWNhdGVgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNgIHN0eWxlDQogICAgICogY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSB0aGUgcHJvcGVydGllcyBvZiB0aGUgZ2l2ZW4NCiAgICAgKiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBhbGlhcyBzZWxlY3QNCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkDQogICAgICogIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBwcmVkaWNhdGVgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZpbHRlcmVkIGFycmF5Lg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmZpbHRlcihbNCwgNSwgNl0sIGZ1bmN0aW9uKG4pIHsNCiAgICAgKiAgIHJldHVybiBuICUgMiA9PSAwOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IFs0LCA2XQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gWw0KICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH0sDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IGZhbHNlIH0NCiAgICAgKiBdOw0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLm1hdGNoZXNgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ucGx1Y2soXy5maWx0ZXIodXNlcnMsIHsgJ2FnZSc6IDM2LCAnYWN0aXZlJzogdHJ1ZSB9KSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2Jhcm5leSddDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLnBsdWNrKF8uZmlsdGVyKHVzZXJzLCAnYWN0aXZlJywgZmFsc2UpLCAndXNlcicpOw0KICAgICAqIC8vID0+IFsnZnJlZCddDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ucGx1Y2soXy5maWx0ZXIodXNlcnMsICdhY3RpdmUnKSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2Jhcm5leSddDQogICAgICovDQogICAgZnVuY3Rpb24gZmlsdGVyKGNvbGxlY3Rpb24sIHByZWRpY2F0ZSwgdGhpc0FyZykgew0KICAgICAgdmFyIGZ1bmMgPSBpc0FycmF5KGNvbGxlY3Rpb24pID8gYXJyYXlGaWx0ZXIgOiBiYXNlRmlsdGVyOw0KICAgICAgcHJlZGljYXRlID0gZ2V0Q2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAzKTsNCiAgICAgIHJldHVybiBmdW5jKGNvbGxlY3Rpb24sIHByZWRpY2F0ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSXRlcmF0ZXMgb3ZlciBlbGVtZW50cyBvZiBgY29sbGVjdGlvbmAsIHJldHVybmluZyB0aGUgZmlyc3QgZWxlbWVudA0KICAgICAqIGBwcmVkaWNhdGVgIHJldHVybnMgdHJ1dGh5IGZvci4gVGhlIHByZWRpY2F0ZSBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kDQogICAgICogaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLg0KICAgICAqDQogICAgICogSWYgYSBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGEgdmFsdWUgaXMgYWxzbyBwcm92aWRlZCBmb3IgYHRoaXNBcmdgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNQcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWF0Y2hpbmcgcHJvcGVydHkNCiAgICAgKiB2YWx1ZSwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzYCBzdHlsZQ0KICAgICAqIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGdpdmVuDQogICAgICogb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAYWxpYXMgZGV0ZWN0DQogICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb24NCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gc2VhcmNoLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb258T2JqZWN0fHN0cmluZ30gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZA0KICAgICAqICBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgcHJlZGljYXRlYC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbWF0Y2hlZCBlbGVtZW50LCBlbHNlIGB1bmRlZmluZWRgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSBbDQogICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH0sDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICAnYWdlJzogNDAsICdhY3RpdmUnOiBmYWxzZSB9LA0KICAgICAqICAgeyAndXNlcic6ICdwZWJibGVzJywgJ2FnZSc6IDEsICAnYWN0aXZlJzogdHJ1ZSB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIF8ucmVzdWx0KF8uZmluZCh1c2VycywgZnVuY3Rpb24oY2hyKSB7DQogICAgICogICByZXR1cm4gY2hyLmFnZSA8IDQwOw0KICAgICAqIH0pLCAndXNlcicpOw0KICAgICAqIC8vID0+ICdiYXJuZXknDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc2AgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5yZXN1bHQoXy5maW5kKHVzZXJzLCB7ICdhZ2UnOiAxLCAnYWN0aXZlJzogdHJ1ZSB9KSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiAncGViYmxlcycNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ucmVzdWx0KF8uZmluZCh1c2VycywgJ2FjdGl2ZScsIGZhbHNlKSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiAnZnJlZCcNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5wcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5yZXN1bHQoXy5maW5kKHVzZXJzLCAnYWN0aXZlJyksICd1c2VyJyk7DQogICAgICogLy8gPT4gJ2Jhcm5leScNCiAgICAgKi8NCiAgICB2YXIgZmluZCA9IGNyZWF0ZUZpbmQoYmFzZUVhY2gpOw0KDQogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5maW5kYCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIGVsZW1lbnRzIG9mDQogICAgICogYGNvbGxlY3Rpb25gIGZyb20gcmlnaHQgdG8gbGVmdC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIHNlYXJjaC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxzdHJpbmd9IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQNCiAgICAgKiAgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYHByZWRpY2F0ZWAuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIG1hdGNoZWQgZWxlbWVudCwgZWxzZSBgdW5kZWZpbmVkYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5maW5kTGFzdChbMSwgMiwgMywgNF0sIGZ1bmN0aW9uKG4pIHsNCiAgICAgKiAgIHJldHVybiBuICUgMiA9PSAxOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IDMNCiAgICAgKi8NCiAgICB2YXIgZmluZExhc3QgPSBjcmVhdGVGaW5kKGJhc2VFYWNoUmlnaHQsIHRydWUpOw0KDQogICAgLyoqDQogICAgICogUGVyZm9ybXMgYSBkZWVwIGNvbXBhcmlzb24gYmV0d2VlbiBlYWNoIGVsZW1lbnQgaW4gYGNvbGxlY3Rpb25gIGFuZCB0aGUNCiAgICAgKiBzb3VyY2Ugb2JqZWN0LCByZXR1cm5pbmcgdGhlIGZpcnN0IGVsZW1lbnQgdGhhdCBoYXMgZXF1aXZhbGVudCBwcm9wZXJ0eQ0KICAgICAqIHZhbHVlcy4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBzdXBwb3J0cyBjb21wYXJpbmcgYXJyYXlzLCBib29sZWFucywgYERhdGVgIG9iamVjdHMsDQogICAgICogbnVtYmVycywgYE9iamVjdGAgb2JqZWN0cywgcmVnZXhlcywgYW5kIHN0cmluZ3MuIE9iamVjdHMgYXJlIGNvbXBhcmVkIGJ5DQogICAgICogdGhlaXIgb3duLCBub3QgaW5oZXJpdGVkLCBlbnVtZXJhYmxlIHByb3BlcnRpZXMuIEZvciBjb21wYXJpbmcgYSBzaW5nbGUNCiAgICAgKiBvd24gb3IgaW5oZXJpdGVkIHByb3BlcnR5IHZhbHVlIHNlZSBgXy5tYXRjaGVzUHJvcGVydHlgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb24NCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gc2VhcmNoLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCBvZiBwcm9wZXJ0eSB2YWx1ZXMgdG8gbWF0Y2guDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIG1hdGNoZWQgZWxlbWVudCwgZWxzZSBgdW5kZWZpbmVkYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gWw0KICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH0sDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IGZhbHNlIH0NCiAgICAgKiBdOw0KICAgICAqDQogICAgICogXy5yZXN1bHQoXy5maW5kV2hlcmUodXNlcnMsIHsgJ2FnZSc6IDM2LCAnYWN0aXZlJzogdHJ1ZSB9KSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiAnYmFybmV5Jw0KICAgICAqDQogICAgICogXy5yZXN1bHQoXy5maW5kV2hlcmUodXNlcnMsIHsgJ2FnZSc6IDQwLCAnYWN0aXZlJzogZmFsc2UgfSksICd1c2VyJyk7DQogICAgICogLy8gPT4gJ2ZyZWQnDQogICAgICovDQogICAgZnVuY3Rpb24gZmluZFdoZXJlKGNvbGxlY3Rpb24sIHNvdXJjZSkgew0KICAgICAgcmV0dXJuIGZpbmQoY29sbGVjdGlvbiwgYmFzZU1hdGNoZXMoc291cmNlKSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSXRlcmF0ZXMgb3ZlciBlbGVtZW50cyBvZiBgY29sbGVjdGlvbmAgaW52b2tpbmcgYGl0ZXJhdGVlYCBmb3IgZWFjaCBlbGVtZW50Lg0KICAgICAqIFRoZSBgaXRlcmF0ZWVgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czoNCiAgICAgKiAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuIEl0ZXJhdGVlIGZ1bmN0aW9ucyBtYXkgZXhpdCBpdGVyYXRpb24gZWFybHkNCiAgICAgKiBieSBleHBsaWNpdGx5IHJldHVybmluZyBgZmFsc2VgLg0KICAgICAqDQogICAgICogKipOb3RlOioqIEFzIHdpdGggb3RoZXIgIkNvbGxlY3Rpb25zIiBtZXRob2RzLCBvYmplY3RzIHdpdGggYSAibGVuZ3RoIiBwcm9wZXJ0eQ0KICAgICAqIGFyZSBpdGVyYXRlZCBsaWtlIGFycmF5cy4gVG8gYXZvaWQgdGhpcyBiZWhhdmlvciBgXy5mb3JJbmAgb3IgYF8uZm9yT3duYA0KICAgICAqIG1heSBiZSB1c2VkIGZvciBvYmplY3QgaXRlcmF0aW9uLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGFsaWFzIGVhY2gNCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBpdGVyYXRlZWAuDQogICAgICogQHJldHVybnMge0FycmF5fE9iamVjdHxzdHJpbmd9IFJldHVybnMgYGNvbGxlY3Rpb25gLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfKFsxLCAyXSkuZm9yRWFjaChmdW5jdGlvbihuKSB7DQogICAgICogICBjb25zb2xlLmxvZyhuKTsNCiAgICAgKiB9KS52YWx1ZSgpOw0KICAgICAqIC8vID0+IGxvZ3MgZWFjaCB2YWx1ZSBmcm9tIGxlZnQgdG8gcmlnaHQgYW5kIHJldHVybnMgdGhlIGFycmF5DQogICAgICoNCiAgICAgKiBfLmZvckVhY2goeyAnYSc6IDEsICdiJzogMiB9LCBmdW5jdGlvbihuLCBrZXkpIHsNCiAgICAgKiAgIGNvbnNvbGUubG9nKG4sIGtleSk7DQogICAgICogfSk7DQogICAgICogLy8gPT4gbG9ncyBlYWNoIHZhbHVlLWtleSBwYWlyIGFuZCByZXR1cm5zIHRoZSBvYmplY3QgKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkNCiAgICAgKi8NCiAgICB2YXIgZm9yRWFjaCA9IGNyZWF0ZUZvckVhY2goYXJyYXlFYWNoLCBiYXNlRWFjaCk7DQoNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZvckVhY2hgIGV4Y2VwdCB0aGF0IGl0IGl0ZXJhdGVzIG92ZXIgZWxlbWVudHMgb2YNCiAgICAgKiBgY29sbGVjdGlvbmAgZnJvbSByaWdodCB0byBsZWZ0Lg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGFsaWFzIGVhY2hSaWdodA0KICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGl0ZXJhdGVlYC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl8T2JqZWN0fHN0cmluZ30gUmV0dXJucyBgY29sbGVjdGlvbmAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8oWzEsIDJdKS5mb3JFYWNoUmlnaHQoZnVuY3Rpb24obikgew0KICAgICAqICAgY29uc29sZS5sb2cobik7DQogICAgICogfSkudmFsdWUoKTsNCiAgICAgKiAvLyA9PiBsb2dzIGVhY2ggdmFsdWUgZnJvbSByaWdodCB0byBsZWZ0IGFuZCByZXR1cm5zIHRoZSBhcnJheQ0KICAgICAqLw0KICAgIHZhciBmb3JFYWNoUmlnaHQgPSBjcmVhdGVGb3JFYWNoKGFycmF5RWFjaFJpZ2h0LCBiYXNlRWFjaFJpZ2h0KTsNCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYW4gb2JqZWN0IGNvbXBvc2VkIG9mIGtleXMgZ2VuZXJhdGVkIGZyb20gdGhlIHJlc3VsdHMgb2YgcnVubmluZw0KICAgICAqIGVhY2ggZWxlbWVudCBvZiBgY29sbGVjdGlvbmAgdGhyb3VnaCBgaXRlcmF0ZWVgLiBUaGUgY29ycmVzcG9uZGluZyB2YWx1ZQ0KICAgICAqIG9mIGVhY2gga2V5IGlzIGFuIGFycmF5IG9mIHRoZSBlbGVtZW50cyByZXNwb25zaWJsZSBmb3IgZ2VuZXJhdGluZyB0aGUga2V5Lg0KICAgICAqIFRoZSBgaXRlcmF0ZWVgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czoNCiAgICAgKiAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuDQogICAgICoNCiAgICAgKiBJZiBhIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQgZm9yIGBpdGVyYXRlZWAgdGhlIGNyZWF0ZWQgYF8ucHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUgb2YgdGhlIGdpdmVuIGVsZW1lbnQuDQogICAgICoNCiAgICAgKiBJZiBhIHZhbHVlIGlzIGFsc28gcHJvdmlkZWQgZm9yIGB0aGlzQXJnYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzUHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSBhIG1hdGNoaW5nIHByb3BlcnR5DQogICAgICogdmFsdWUsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIElmIGFuIG9iamVjdCBpcyBwcm92aWRlZCBmb3IgYGl0ZXJhdGVlYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzYCBzdHlsZQ0KICAgICAqIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGdpdmVuDQogICAgICogb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQNCiAgICAgKiAgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGl0ZXJhdGVlYC4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjb21wb3NlZCBhZ2dyZWdhdGUgb2JqZWN0Lg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmdyb3VwQnkoWzQuMiwgNi4xLCA2LjRdLCBmdW5jdGlvbihuKSB7DQogICAgICogICByZXR1cm4gTWF0aC5mbG9vcihuKTsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiB7ICc0JzogWzQuMl0sICc2JzogWzYuMSwgNi40XSB9DQogICAgICoNCiAgICAgKiBfLmdyb3VwQnkoWzQuMiwgNi4xLCA2LjRdLCBmdW5jdGlvbihuKSB7DQogICAgICogICByZXR1cm4gdGhpcy5mbG9vcihuKTsNCiAgICAgKiB9LCBNYXRoKTsNCiAgICAgKiAvLyA9PiB7ICc0JzogWzQuMl0sICc2JzogWzYuMSwgNi40XSB9DQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8uZ3JvdXBCeShbJ29uZScsICd0d28nLCAndGhyZWUnXSwgJ2xlbmd0aCcpOw0KICAgICAqIC8vID0+IHsgJzMnOiBbJ29uZScsICd0d28nXSwgJzUnOiBbJ3RocmVlJ10gfQ0KICAgICAqLw0KICAgIHZhciBncm91cEJ5ID0gY3JlYXRlQWdncmVnYXRvcihmdW5jdGlvbihyZXN1bHQsIHZhbHVlLCBrZXkpIHsNCiAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc3VsdCwga2V5KSkgew0KICAgICAgICByZXN1bHRba2V5XS5wdXNoKHZhbHVlKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJlc3VsdFtrZXldID0gW3ZhbHVlXTsNCiAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGluIGBjb2xsZWN0aW9uYCB1c2luZw0KICAgICAqIFtgU2FtZVZhbHVlWmVyb2BdKGh0dHBzOi8vcGVvcGxlLm1vemlsbGEub3JnL35qb3JlbmRvcmZmL2VzNi1kcmFmdC5odG1sI3NlYy1zYW1ldmFsdWV6ZXJvKQ0KICAgICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy4gSWYgYGZyb21JbmRleGAgaXMgbmVnYXRpdmUsIGl0IGlzIHVzZWQgYXMgdGhlIG9mZnNldA0KICAgICAqIGZyb20gdGhlIGVuZCBvZiBgY29sbGVjdGlvbmAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAYWxpYXMgY29udGFpbnMsIGluY2x1ZGUNCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBzZWFyY2guDQogICAgICogQHBhcmFtIHsqfSB0YXJnZXQgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtmcm9tSW5kZXg9MF0gVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLg0KICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhIGNhbGxiYWNrIGZvciBmdW5jdGlvbnMgbGlrZSBgXy5yZWR1Y2VgLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhIG1hdGNoaW5nIGVsZW1lbnQgaXMgZm91bmQsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pbmNsdWRlcyhbMSwgMiwgM10sIDEpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaW5jbHVkZXMoWzEsIDIsIDNdLCAxLCAyKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqDQogICAgICogXy5pbmNsdWRlcyh7ICd1c2VyJzogJ2ZyZWQnLCAnYWdlJzogNDAgfSwgJ2ZyZWQnKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiBfLmluY2x1ZGVzKCdwZWJibGVzJywgJ2ViJyk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGluY2x1ZGVzKGNvbGxlY3Rpb24sIHRhcmdldCwgZnJvbUluZGV4LCBndWFyZCkgew0KICAgICAgdmFyIGxlbmd0aCA9IGNvbGxlY3Rpb24gPyBnZXRMZW5ndGgoY29sbGVjdGlvbikgOiAwOw0KICAgICAgaWYgKCFpc0xlbmd0aChsZW5ndGgpKSB7DQogICAgICAgIGNvbGxlY3Rpb24gPSB2YWx1ZXMoY29sbGVjdGlvbik7DQogICAgICAgIGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoOw0KICAgICAgfQ0KICAgICAgaWYgKCFsZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgICAgaWYgKHR5cGVvZiBmcm9tSW5kZXggIT0gJ251bWJlcicgfHwgKGd1YXJkICYmIGlzSXRlcmF0ZWVDYWxsKHRhcmdldCwgZnJvbUluZGV4LCBndWFyZCkpKSB7DQogICAgICAgIGZyb21JbmRleCA9IDA7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBmcm9tSW5kZXggPSBmcm9tSW5kZXggPCAwID8gbmF0aXZlTWF4KGxlbmd0aCArIGZyb21JbmRleCwgMCkgOiAoZnJvbUluZGV4IHx8IDApOw0KICAgICAgfQ0KICAgICAgcmV0dXJuICh0eXBlb2YgY29sbGVjdGlvbiA9PSAnc3RyaW5nJyB8fCAhaXNBcnJheShjb2xsZWN0aW9uKSAmJiBpc1N0cmluZyhjb2xsZWN0aW9uKSkNCiAgICAgICAgPyAoZnJvbUluZGV4IDwgbGVuZ3RoICYmIGNvbGxlY3Rpb24uaW5kZXhPZih0YXJnZXQsIGZyb21JbmRleCkgPiAtMSkNCiAgICAgICAgOiAoZ2V0SW5kZXhPZihjb2xsZWN0aW9uLCB0YXJnZXQsIGZyb21JbmRleCkgPiAtMSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBvYmplY3QgY29tcG9zZWQgb2Yga2V5cyBnZW5lcmF0ZWQgZnJvbSB0aGUgcmVzdWx0cyBvZiBydW5uaW5nDQogICAgICogZWFjaCBlbGVtZW50IG9mIGBjb2xsZWN0aW9uYCB0aHJvdWdoIGBpdGVyYXRlZWAuIFRoZSBjb3JyZXNwb25kaW5nIHZhbHVlDQogICAgICogb2YgZWFjaCBrZXkgaXMgdGhlIGxhc3QgZWxlbWVudCByZXNwb25zaWJsZSBmb3IgZ2VuZXJhdGluZyB0aGUga2V5LiBUaGUNCiAgICAgKiBpdGVyYXRlZSBmdW5jdGlvbiBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM6DQogICAgICogKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLg0KICAgICAqDQogICAgICogSWYgYSBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkIGZvciBgaXRlcmF0ZWVgIHRoZSBjcmVhdGVkIGBfLnByb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlIG9mIHRoZSBnaXZlbiBlbGVtZW50Lg0KICAgICAqDQogICAgICogSWYgYSB2YWx1ZSBpcyBhbHNvIHByb3ZpZGVkIGZvciBgdGhpc0FyZ2AgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc1Byb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgYSBtYXRjaGluZyBwcm9wZXJ0eQ0KICAgICAqIHZhbHVlLCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBJZiBhbiBvYmplY3QgaXMgcHJvdmlkZWQgZm9yIGBpdGVyYXRlZWAgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc2Agc3R5bGUNCiAgICAgKiBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBnaXZlbg0KICAgICAqIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb24NCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb258T2JqZWN0fHN0cmluZ30gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkDQogICAgICogIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBpdGVyYXRlZWAuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY29tcG9zZWQgYWdncmVnYXRlIG9iamVjdC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIGtleURhdGEgPSBbDQogICAgICogICB7ICdkaXInOiAnbGVmdCcsICdjb2RlJzogOTcgfSwNCiAgICAgKiAgIHsgJ2Rpcic6ICdyaWdodCcsICdjb2RlJzogMTAwIH0NCiAgICAgKiBdOw0KICAgICAqDQogICAgICogXy5pbmRleEJ5KGtleURhdGEsICdkaXInKTsNCiAgICAgKiAvLyA9PiB7ICdsZWZ0JzogeyAnZGlyJzogJ2xlZnQnLCAnY29kZSc6IDk3IH0sICdyaWdodCc6IHsgJ2Rpcic6ICdyaWdodCcsICdjb2RlJzogMTAwIH0gfQ0KICAgICAqDQogICAgICogXy5pbmRleEJ5KGtleURhdGEsIGZ1bmN0aW9uKG9iamVjdCkgew0KICAgICAqICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUob2JqZWN0LmNvZGUpOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IHsgJ2EnOiB7ICdkaXInOiAnbGVmdCcsICdjb2RlJzogOTcgfSwgJ2QnOiB7ICdkaXInOiAncmlnaHQnLCAnY29kZSc6IDEwMCB9IH0NCiAgICAgKg0KICAgICAqIF8uaW5kZXhCeShrZXlEYXRhLCBmdW5jdGlvbihvYmplY3QpIHsNCiAgICAgKiAgIHJldHVybiB0aGlzLmZyb21DaGFyQ29kZShvYmplY3QuY29kZSk7DQogICAgICogfSwgU3RyaW5nKTsNCiAgICAgKiAvLyA9PiB7ICdhJzogeyAnZGlyJzogJ2xlZnQnLCAnY29kZSc6IDk3IH0sICdkJzogeyAnZGlyJzogJ3JpZ2h0JywgJ2NvZGUnOiAxMDAgfSB9DQogICAgICovDQogICAgdmFyIGluZGV4QnkgPSBjcmVhdGVBZ2dyZWdhdG9yKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkgew0KICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEludm9rZXMgdGhlIG1ldGhvZCBhdCBgcGF0aGAgb2YgZWFjaCBlbGVtZW50IGluIGBjb2xsZWN0aW9uYCwgcmV0dXJuaW5nDQogICAgICogYW4gYXJyYXkgb2YgdGhlIHJlc3VsdHMgb2YgZWFjaCBpbnZva2VkIG1ldGhvZC4gQW55IGFkZGl0aW9uYWwgYXJndW1lbnRzDQogICAgICogYXJlIHByb3ZpZGVkIHRvIGVhY2ggaW52b2tlZCBtZXRob2QuIElmIGBtZXRob2ROYW1lYCBpcyBhIGZ1bmN0aW9uIGl0IGlzDQogICAgICogaW52b2tlZCBmb3IsIGFuZCBgdGhpc2AgYm91bmQgdG8sIGVhY2ggZWxlbWVudCBpbiBgY29sbGVjdGlvbmAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtBcnJheXxGdW5jdGlvbnxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIG1ldGhvZCB0byBpbnZva2Ugb3INCiAgICAgKiAgdGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0gey4uLip9IFthcmdzXSBUaGUgYXJndW1lbnRzIHRvIGludm9rZSB0aGUgbWV0aG9kIHdpdGguDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiByZXN1bHRzLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmludm9rZShbWzUsIDEsIDddLCBbMywgMiwgMV1dLCAnc29ydCcpOw0KICAgICAqIC8vID0+IFtbMSwgNSwgN10sIFsxLCAyLCAzXV0NCiAgICAgKg0KICAgICAqIF8uaW52b2tlKFsxMjMsIDQ1Nl0sIFN0cmluZy5wcm90b3R5cGUuc3BsaXQsICcnKTsNCiAgICAgKiAvLyA9PiBbWycxJywgJzInLCAnMyddLCBbJzQnLCAnNScsICc2J11dDQogICAgICovDQogICAgdmFyIGludm9rZSA9IHJlc3RQYXJhbShmdW5jdGlvbihjb2xsZWN0aW9uLCBwYXRoLCBhcmdzKSB7DQogICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICBpc0Z1bmMgPSB0eXBlb2YgcGF0aCA9PSAnZnVuY3Rpb24nLA0KICAgICAgICAgIGlzUHJvcCA9IGlzS2V5KHBhdGgpLA0KICAgICAgICAgIHJlc3VsdCA9IGlzQXJyYXlMaWtlKGNvbGxlY3Rpb24pID8gQXJyYXkoY29sbGVjdGlvbi5sZW5ndGgpIDogW107DQoNCiAgICAgIGJhc2VFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICAgIHZhciBmdW5jID0gaXNGdW5jID8gcGF0aCA6ICgoaXNQcm9wICYmIHZhbHVlICE9IG51bGwpID8gdmFsdWVbcGF0aF0gOiBudWxsKTsNCiAgICAgICAgcmVzdWx0WysraW5kZXhdID0gZnVuYyA/IGZ1bmMuYXBwbHkodmFsdWUsIGFyZ3MpIDogaW52b2tlUGF0aCh2YWx1ZSwgcGF0aCwgYXJncyk7DQogICAgICB9KTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHZhbHVlcyBieSBydW5uaW5nIGVhY2ggZWxlbWVudCBpbiBgY29sbGVjdGlvbmAgdGhyb3VnaA0KICAgICAqIGBpdGVyYXRlZWAuIFRoZSBgaXRlcmF0ZWVgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlDQogICAgICogYXJndW1lbnRzOiAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuDQogICAgICoNCiAgICAgKiBJZiBhIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQgZm9yIGBpdGVyYXRlZWAgdGhlIGNyZWF0ZWQgYF8ucHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUgb2YgdGhlIGdpdmVuIGVsZW1lbnQuDQogICAgICoNCiAgICAgKiBJZiBhIHZhbHVlIGlzIGFsc28gcHJvdmlkZWQgZm9yIGB0aGlzQXJnYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzUHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSBhIG1hdGNoaW5nIHByb3BlcnR5DQogICAgICogdmFsdWUsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIElmIGFuIG9iamVjdCBpcyBwcm92aWRlZCBmb3IgYGl0ZXJhdGVlYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzYCBzdHlsZQ0KICAgICAqIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGdpdmVuDQogICAgICogb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBNYW55IGxvZGFzaCBtZXRob2RzIGFyZSBndWFyZGVkIHRvIHdvcmsgYXMgaXRlcmF0ZWVzIGZvciBtZXRob2RzIGxpa2UNCiAgICAgKiBgXy5ldmVyeWAsIGBfLmZpbHRlcmAsIGBfLm1hcGAsIGBfLm1hcFZhbHVlc2AsIGBfLnJlamVjdGAsIGFuZCBgXy5zb21lYC4NCiAgICAgKg0KICAgICAqIFRoZSBndWFyZGVkIG1ldGhvZHMgYXJlOg0KICAgICAqIGBhcnlgLCBgY2FsbGJhY2tgLCBgY2h1bmtgLCBgY2xvbmVgLCBgY3JlYXRlYCwgYGN1cnJ5YCwgYGN1cnJ5UmlnaHRgLA0KICAgICAqIGBkcm9wYCwgYGRyb3BSaWdodGAsIGBldmVyeWAsIGBmaWxsYCwgYGZsYXR0ZW5gLCBgaW52ZXJ0YCwgYG1heGAsIGBtaW5gLA0KICAgICAqIGBwYXJzZUludGAsIGBzbGljZWAsIGBzb3J0QnlgLCBgdGFrZWAsIGB0YWtlUmlnaHRgLCBgdGVtcGxhdGVgLCBgdHJpbWAsDQogICAgICogYHRyaW1MZWZ0YCwgYHRyaW1SaWdodGAsIGB0cnVuY2AsIGByYW5kb21gLCBgcmFuZ2VgLCBgc2FtcGxlYCwgYHNvbWVgLA0KICAgICAqIGBzdW1gLCBgdW5pcWAsIGFuZCBgd29yZHNgDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAYWxpYXMgY29sbGVjdA0KICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxzdHJpbmd9IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZA0KICAgICAqICBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgaXRlcmF0ZWVgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IG1hcHBlZCBhcnJheS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogZnVuY3Rpb24gdGltZXNUaHJlZShuKSB7DQogICAgICogICByZXR1cm4gbiAqIDM7DQogICAgICogfQ0KICAgICAqDQogICAgICogXy5tYXAoWzEsIDJdLCB0aW1lc1RocmVlKTsNCiAgICAgKiAvLyA9PiBbMywgNl0NCiAgICAgKg0KICAgICAqIF8ubWFwKHsgJ2EnOiAxLCAnYic6IDIgfSwgdGltZXNUaHJlZSk7DQogICAgICogLy8gPT4gWzMsIDZdIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSBbDQogICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScgfSwNCiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcgfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ubWFwKHVzZXJzLCAndXNlcicpOw0KICAgICAqIC8vID0+IFsnYmFybmV5JywgJ2ZyZWQnXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG1hcChjb2xsZWN0aW9uLCBpdGVyYXRlZSwgdGhpc0FyZykgew0KICAgICAgdmFyIGZ1bmMgPSBpc0FycmF5KGNvbGxlY3Rpb24pID8gYXJyYXlNYXAgOiBiYXNlTWFwOw0KICAgICAgaXRlcmF0ZWUgPSBnZXRDYWxsYmFjayhpdGVyYXRlZSwgdGhpc0FyZywgMyk7DQogICAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBpdGVyYXRlZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBlbGVtZW50cyBzcGxpdCBpbnRvIHR3byBncm91cHMsIHRoZSBmaXJzdCBvZiB3aGljaA0KICAgICAqIGNvbnRhaW5zIGVsZW1lbnRzIGBwcmVkaWNhdGVgIHJldHVybnMgdHJ1dGh5IGZvciwgd2hpbGUgdGhlIHNlY29uZCBvZiB3aGljaA0KICAgICAqIGNvbnRhaW5zIGVsZW1lbnRzIGBwcmVkaWNhdGVgIHJldHVybnMgZmFsc2V5IGZvci4gVGhlIHByZWRpY2F0ZSBpcyBib3VuZA0KICAgICAqIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLg0KICAgICAqDQogICAgICogSWYgYSBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGEgdmFsdWUgaXMgYWxzbyBwcm92aWRlZCBmb3IgYHRoaXNBcmdgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNQcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWF0Y2hpbmcgcHJvcGVydHkNCiAgICAgKiB2YWx1ZSwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzYCBzdHlsZQ0KICAgICAqIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGdpdmVuDQogICAgICogb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkDQogICAgICogIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBwcmVkaWNhdGVgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5wYXJ0aXRpb24oWzEsIDIsIDNdLCBmdW5jdGlvbihuKSB7DQogICAgICogICByZXR1cm4gbiAlIDI7DQogICAgICogfSk7DQogICAgICogLy8gPT4gW1sxLCAzXSwgWzJdXQ0KICAgICAqDQogICAgICogXy5wYXJ0aXRpb24oWzEuMiwgMi4zLCAzLjRdLCBmdW5jdGlvbihuKSB7DQogICAgICogICByZXR1cm4gdGhpcy5mbG9vcihuKSAlIDI7DQogICAgICogfSwgTWF0aCk7DQogICAgICogLy8gPT4gW1sxLjIsIDMuNF0sIFsyLjNdXQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gWw0KICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FnZSc6IDM2LCAnYWN0aXZlJzogZmFsc2UgfSwNCiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IHRydWUgfSwNCiAgICAgKiAgIHsgJ3VzZXInOiAncGViYmxlcycsICdhZ2UnOiAxLCAgJ2FjdGl2ZSc6IGZhbHNlIH0NCiAgICAgKiBdOw0KICAgICAqDQogICAgICogdmFyIG1hcHBlciA9IGZ1bmN0aW9uKGFycmF5KSB7DQogICAgICogICByZXR1cm4gXy5wbHVjayhhcnJheSwgJ3VzZXInKTsNCiAgICAgKiB9Ow0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLm1hdGNoZXNgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ubWFwKF8ucGFydGl0aW9uKHVzZXJzLCB7ICdhZ2UnOiAxLCAnYWN0aXZlJzogZmFsc2UgfSksIG1hcHBlcik7DQogICAgICogLy8gPT4gW1sncGViYmxlcyddLCBbJ2Jhcm5leScsICdmcmVkJ11dDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLm1hcChfLnBhcnRpdGlvbih1c2VycywgJ2FjdGl2ZScsIGZhbHNlKSwgbWFwcGVyKTsNCiAgICAgKiAvLyA9PiBbWydiYXJuZXknLCAncGViYmxlcyddLCBbJ2ZyZWQnXV0NCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5wcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5tYXAoXy5wYXJ0aXRpb24odXNlcnMsICdhY3RpdmUnKSwgbWFwcGVyKTsNCiAgICAgKiAvLyA9PiBbWydmcmVkJ10sIFsnYmFybmV5JywgJ3BlYmJsZXMnXV0NCiAgICAgKi8NCiAgICB2YXIgcGFydGl0aW9uID0gY3JlYXRlQWdncmVnYXRvcihmdW5jdGlvbihyZXN1bHQsIHZhbHVlLCBrZXkpIHsNCiAgICAgIHJlc3VsdFtrZXkgPyAwIDogMV0ucHVzaCh2YWx1ZSk7DQogICAgfSwgZnVuY3Rpb24oKSB7IHJldHVybiBbW10sIFtdXTsgfSk7DQoNCiAgICAvKioNCiAgICAgKiBHZXRzIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiBgcGF0aGAgZnJvbSBhbGwgZWxlbWVudHMgaW4gYGNvbGxlY3Rpb25gLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb24NCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIG9mIHRoZSBwcm9wZXJ0eSB0byBwbHVjay4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlcy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gWw0KICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYgfSwNCiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgJ2FnZSc6IDQwIH0NCiAgICAgKiBdOw0KICAgICAqDQogICAgICogXy5wbHVjayh1c2VycywgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2Jhcm5leScsICdmcmVkJ10NCiAgICAgKg0KICAgICAqIHZhciB1c2VySW5kZXggPSBfLmluZGV4QnkodXNlcnMsICd1c2VyJyk7DQogICAgICogXy5wbHVjayh1c2VySW5kZXgsICdhZ2UnKTsNCiAgICAgKiAvLyA9PiBbMzYsIDQwXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHBsdWNrKGNvbGxlY3Rpb24sIHBhdGgpIHsNCiAgICAgIHJldHVybiBtYXAoY29sbGVjdGlvbiwgcHJvcGVydHkocGF0aCkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlZHVjZXMgYGNvbGxlY3Rpb25gIHRvIGEgdmFsdWUgd2hpY2ggaXMgdGhlIGFjY3VtdWxhdGVkIHJlc3VsdCBvZiBydW5uaW5nDQogICAgICogZWFjaCBlbGVtZW50IGluIGBjb2xsZWN0aW9uYCB0aHJvdWdoIGBpdGVyYXRlZWAsIHdoZXJlIGVhY2ggc3VjY2Vzc2l2ZQ0KICAgICAqIGludm9jYXRpb24gaXMgc3VwcGxpZWQgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgcHJldmlvdXMuIElmIGBhY2N1bXVsYXRvcmANCiAgICAgKiBpcyBub3QgcHJvdmlkZWQgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYGNvbGxlY3Rpb25gIGlzIHVzZWQgYXMgdGhlIGluaXRpYWwNCiAgICAgKiB2YWx1ZS4gVGhlIGBpdGVyYXRlZWAgaXMgYm91bmQgdG8gYHRoaXNBcmdgIGFuZCBpbnZva2VkIHdpdGggZm91ciBhcmd1bWVudHM6DQogICAgICogKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaW5kZXh8a2V5LCBjb2xsZWN0aW9uKS4NCiAgICAgKg0KICAgICAqIE1hbnkgbG9kYXNoIG1ldGhvZHMgYXJlIGd1YXJkZWQgdG8gd29yayBhcyBpdGVyYXRlZXMgZm9yIG1ldGhvZHMgbGlrZQ0KICAgICAqIGBfLnJlZHVjZWAsIGBfLnJlZHVjZVJpZ2h0YCwgYW5kIGBfLnRyYW5zZm9ybWAuDQogICAgICoNCiAgICAgKiBUaGUgZ3VhcmRlZCBtZXRob2RzIGFyZToNCiAgICAgKiBgYXNzaWduYCwgYGRlZmF1bHRzYCwgYGluY2x1ZGVzYCwgYG1lcmdlYCwgYHNvcnRCeUFsbGAsIGFuZCBgc29ydEJ5T3JkZXJgDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAYWxpYXMgZm9sZGwsIGluamVjdA0KICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFthY2N1bXVsYXRvcl0gVGhlIGluaXRpYWwgdmFsdWUuDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBpdGVyYXRlZWAuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGFjY3VtdWxhdGVkIHZhbHVlLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnJlZHVjZShbMSwgMl0sIGZ1bmN0aW9uKHRvdGFsLCBuKSB7DQogICAgICogICByZXR1cm4gdG90YWwgKyBuOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IDMNCiAgICAgKg0KICAgICAqIF8ucmVkdWNlKHsgJ2EnOiAxLCAnYic6IDIgfSwgZnVuY3Rpb24ocmVzdWx0LCBuLCBrZXkpIHsNCiAgICAgKiAgIHJlc3VsdFtrZXldID0gbiAqIDM7DQogICAgICogICByZXR1cm4gcmVzdWx0Ow0KICAgICAqIH0sIHt9KTsNCiAgICAgKiAvLyA9PiB7ICdhJzogMywgJ2InOiA2IH0gKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkNCiAgICAgKi8NCiAgICB2YXIgcmVkdWNlID0gY3JlYXRlUmVkdWNlKGFycmF5UmVkdWNlLCBiYXNlRWFjaCk7DQoNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnJlZHVjZWAgZXhjZXB0IHRoYXQgaXQgaXRlcmF0ZXMgb3ZlciBlbGVtZW50cyBvZg0KICAgICAqIGBjb2xsZWN0aW9uYCBmcm9tIHJpZ2h0IHRvIGxlZnQuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAYWxpYXMgZm9sZHINCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbYWNjdW11bGF0b3JdIFRoZSBpbml0aWFsIHZhbHVlLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgaXRlcmF0ZWVgLg0KICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBhY2N1bXVsYXRlZCB2YWx1ZS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIGFycmF5ID0gW1swLCAxXSwgWzIsIDNdLCBbNCwgNV1dOw0KICAgICAqDQogICAgICogXy5yZWR1Y2VSaWdodChhcnJheSwgZnVuY3Rpb24oZmxhdHRlbmVkLCBvdGhlcikgew0KICAgICAqICAgcmV0dXJuIGZsYXR0ZW5lZC5jb25jYXQob3RoZXIpOw0KICAgICAqIH0sIFtdKTsNCiAgICAgKiAvLyA9PiBbNCwgNSwgMiwgMywgMCwgMV0NCiAgICAgKi8NCiAgICB2YXIgcmVkdWNlUmlnaHQgPSBjcmVhdGVSZWR1Y2UoYXJyYXlSZWR1Y2VSaWdodCwgYmFzZUVhY2hSaWdodCk7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgb3Bwb3NpdGUgb2YgYF8uZmlsdGVyYDsgdGhpcyBtZXRob2QgcmV0dXJucyB0aGUgZWxlbWVudHMgb2YgYGNvbGxlY3Rpb25gDQogICAgICogdGhhdCBgcHJlZGljYXRlYCBkb2VzICoqbm90KiogcmV0dXJuIHRydXRoeSBmb3IuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkDQogICAgICogIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBwcmVkaWNhdGVgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZpbHRlcmVkIGFycmF5Lg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnJlamVjdChbMSwgMiwgMywgNF0sIGZ1bmN0aW9uKG4pIHsNCiAgICAgKiAgIHJldHVybiBuICUgMiA9PSAwOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IFsxLCAzXQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gWw0KICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYsICdhY3RpdmUnOiBmYWxzZSB9LA0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAnYWdlJzogNDAsICdhY3RpdmUnOiB0cnVlIH0NCiAgICAgKiBdOw0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLm1hdGNoZXNgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ucGx1Y2soXy5yZWplY3QodXNlcnMsIHsgJ2FnZSc6IDQwLCAnYWN0aXZlJzogdHJ1ZSB9KSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2Jhcm5leSddDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLnBsdWNrKF8ucmVqZWN0KHVzZXJzLCAnYWN0aXZlJywgZmFsc2UpLCAndXNlcicpOw0KICAgICAqIC8vID0+IFsnZnJlZCddDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ucGx1Y2soXy5yZWplY3QodXNlcnMsICdhY3RpdmUnKSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2Jhcm5leSddDQogICAgICovDQogICAgZnVuY3Rpb24gcmVqZWN0KGNvbGxlY3Rpb24sIHByZWRpY2F0ZSwgdGhpc0FyZykgew0KICAgICAgdmFyIGZ1bmMgPSBpc0FycmF5KGNvbGxlY3Rpb24pID8gYXJyYXlGaWx0ZXIgOiBiYXNlRmlsdGVyOw0KICAgICAgcHJlZGljYXRlID0gZ2V0Q2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAzKTsNCiAgICAgIHJldHVybiBmdW5jKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikgew0KICAgICAgICByZXR1cm4gIXByZWRpY2F0ZSh2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pOw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0cyBhIHJhbmRvbSBlbGVtZW50IG9yIGBuYCByYW5kb20gZWxlbWVudHMgZnJvbSBhIGNvbGxlY3Rpb24uDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBzYW1wbGUuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtuXSBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIHRvIHNhbXBsZS4NCiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYSBjYWxsYmFjayBmb3IgZnVuY3Rpb25zIGxpa2UgYF8ubWFwYC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmFuZG9tIHNhbXBsZShzKS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5zYW1wbGUoWzEsIDIsIDMsIDRdKTsNCiAgICAgKiAvLyA9PiAyDQogICAgICoNCiAgICAgKiBfLnNhbXBsZShbMSwgMiwgMywgNF0sIDIpOw0KICAgICAqIC8vID0+IFszLCAxXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNhbXBsZShjb2xsZWN0aW9uLCBuLCBndWFyZCkgew0KICAgICAgaWYgKGd1YXJkID8gaXNJdGVyYXRlZUNhbGwoY29sbGVjdGlvbiwgbiwgZ3VhcmQpIDogbiA9PSBudWxsKSB7DQogICAgICAgIGNvbGxlY3Rpb24gPSB0b0l0ZXJhYmxlKGNvbGxlY3Rpb24pOw0KICAgICAgICB2YXIgbGVuZ3RoID0gY29sbGVjdGlvbi5sZW5ndGg7DQogICAgICAgIHJldHVybiBsZW5ndGggPiAwID8gY29sbGVjdGlvbltiYXNlUmFuZG9tKDAsIGxlbmd0aCAtIDEpXSA6IHVuZGVmaW5lZDsNCiAgICAgIH0NCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIHJlc3VsdCA9IHRvQXJyYXkoY29sbGVjdGlvbiksDQogICAgICAgICAgbGVuZ3RoID0gcmVzdWx0Lmxlbmd0aCwNCiAgICAgICAgICBsYXN0SW5kZXggPSBsZW5ndGggLSAxOw0KDQogICAgICBuID0gbmF0aXZlTWluKG4gPCAwID8gMCA6ICgrbiB8fCAwKSwgbGVuZ3RoKTsNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbikgew0KICAgICAgICB2YXIgcmFuZCA9IGJhc2VSYW5kb20oaW5kZXgsIGxhc3RJbmRleCksDQogICAgICAgICAgICB2YWx1ZSA9IHJlc3VsdFtyYW5kXTsNCg0KICAgICAgICByZXN1bHRbcmFuZF0gPSByZXN1bHRbaW5kZXhdOw0KICAgICAgICByZXN1bHRbaW5kZXhdID0gdmFsdWU7DQogICAgICB9DQogICAgICByZXN1bHQubGVuZ3RoID0gbjsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBzaHVmZmxlZCB2YWx1ZXMsIHVzaW5nIGEgdmVyc2lvbiBvZiB0aGUNCiAgICAgKiBbRmlzaGVyLVlhdGVzIHNodWZmbGVdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0Zpc2hlci1ZYXRlc19zaHVmZmxlKS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIHNodWZmbGUuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgc2h1ZmZsZWQgYXJyYXkuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uc2h1ZmZsZShbMSwgMiwgMywgNF0pOw0KICAgICAqIC8vID0+IFs0LCAxLCAzLCAyXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNodWZmbGUoY29sbGVjdGlvbikgew0KICAgICAgcmV0dXJuIHNhbXBsZShjb2xsZWN0aW9uLCBQT1NJVElWRV9JTkZJTklUWSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0cyB0aGUgc2l6ZSBvZiBgY29sbGVjdGlvbmAgYnkgcmV0dXJuaW5nIGl0cyBsZW5ndGggZm9yIGFycmF5LWxpa2UNCiAgICAgKiB2YWx1ZXMgb3IgdGhlIG51bWJlciBvZiBvd24gZW51bWVyYWJsZSBwcm9wZXJ0aWVzIGZvciBvYmplY3RzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb24NCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaW5zcGVjdC4NCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBzaXplIG9mIGBjb2xsZWN0aW9uYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5zaXplKFsxLCAyLCAzXSk7DQogICAgICogLy8gPT4gMw0KICAgICAqDQogICAgICogXy5zaXplKHsgJ2EnOiAxLCAnYic6IDIgfSk7DQogICAgICogLy8gPT4gMg0KICAgICAqDQogICAgICogXy5zaXplKCdwZWJibGVzJyk7DQogICAgICogLy8gPT4gNw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNpemUoY29sbGVjdGlvbikgew0KICAgICAgdmFyIGxlbmd0aCA9IGNvbGxlY3Rpb24gPyBnZXRMZW5ndGgoY29sbGVjdGlvbikgOiAwOw0KICAgICAgcmV0dXJuIGlzTGVuZ3RoKGxlbmd0aCkgPyBsZW5ndGggOiBrZXlzKGNvbGxlY3Rpb24pLmxlbmd0aDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgYHByZWRpY2F0ZWAgcmV0dXJucyB0cnV0aHkgZm9yICoqYW55KiogZWxlbWVudCBvZiBgY29sbGVjdGlvbmAuDQogICAgICogVGhlIGZ1bmN0aW9uIHJldHVybnMgYXMgc29vbiBhcyBpdCBmaW5kcyBhIHBhc3NpbmcgdmFsdWUgYW5kIGRvZXMgbm90IGl0ZXJhdGUNCiAgICAgKiBvdmVyIHRoZSBlbnRpcmUgY29sbGVjdGlvbi4gVGhlIHByZWRpY2F0ZSBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQNCiAgICAgKiB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLg0KICAgICAqDQogICAgICogSWYgYSBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGEgdmFsdWUgaXMgYWxzbyBwcm92aWRlZCBmb3IgYHRoaXNBcmdgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNQcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWF0Y2hpbmcgcHJvcGVydHkNCiAgICAgKiB2YWx1ZSwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzYCBzdHlsZQ0KICAgICAqIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGdpdmVuDQogICAgICogb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAYWxpYXMgYW55DQogICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb24NCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb258T2JqZWN0fHN0cmluZ30gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZA0KICAgICAqICBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgcHJlZGljYXRlYC4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW55IGVsZW1lbnQgcGFzc2VzIHRoZSBwcmVkaWNhdGUgY2hlY2ssDQogICAgICogIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5zb21lKFtudWxsLCAwLCAneWVzJywgZmFsc2VdLCBCb29sZWFuKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSBbDQogICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiB0cnVlIH0sDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhY3RpdmUnOiBmYWxzZSB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5tYXRjaGVzYCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLnNvbWUodXNlcnMsIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FjdGl2ZSc6IGZhbHNlIH0pOw0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLnNvbWUodXNlcnMsICdhY3RpdmUnLCBmYWxzZSk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLnByb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLnNvbWUodXNlcnMsICdhY3RpdmUnKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICovDQogICAgZnVuY3Rpb24gc29tZShjb2xsZWN0aW9uLCBwcmVkaWNhdGUsIHRoaXNBcmcpIHsNCiAgICAgIHZhciBmdW5jID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IGFycmF5U29tZSA6IGJhc2VTb21lOw0KICAgICAgaWYgKHRoaXNBcmcgJiYgaXNJdGVyYXRlZUNhbGwoY29sbGVjdGlvbiwgcHJlZGljYXRlLCB0aGlzQXJnKSkgew0KICAgICAgICBwcmVkaWNhdGUgPSBudWxsOw0KICAgICAgfQ0KICAgICAgaWYgKHR5cGVvZiBwcmVkaWNhdGUgIT0gJ2Z1bmN0aW9uJyB8fCB0aGlzQXJnICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgcHJlZGljYXRlID0gZ2V0Q2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAzKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBmdW5jKGNvbGxlY3Rpb24sIHByZWRpY2F0ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBlbGVtZW50cywgc29ydGVkIGluIGFzY2VuZGluZyBvcmRlciBieSB0aGUgcmVzdWx0cyBvZg0KICAgICAqIHJ1bm5pbmcgZWFjaCBlbGVtZW50IGluIGEgY29sbGVjdGlvbiB0aHJvdWdoIGBpdGVyYXRlZWAuIFRoaXMgbWV0aG9kIHBlcmZvcm1zDQogICAgICogYSBzdGFibGUgc29ydCwgdGhhdCBpcywgaXQgcHJlc2VydmVzIHRoZSBvcmlnaW5hbCBzb3J0IG9yZGVyIG9mIGVxdWFsIGVsZW1lbnRzLg0KICAgICAqIFRoZSBgaXRlcmF0ZWVgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czoNCiAgICAgKiAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuDQogICAgICoNCiAgICAgKiBJZiBhIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQgZm9yIGBpdGVyYXRlZWAgdGhlIGNyZWF0ZWQgYF8ucHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUgb2YgdGhlIGdpdmVuIGVsZW1lbnQuDQogICAgICoNCiAgICAgKiBJZiBhIHZhbHVlIGlzIGFsc28gcHJvdmlkZWQgZm9yIGB0aGlzQXJnYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzUHJvcGVydHlgDQogICAgICogc3R5bGUgY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSBhIG1hdGNoaW5nIHByb3BlcnR5DQogICAgICogdmFsdWUsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIElmIGFuIG9iamVjdCBpcyBwcm92aWRlZCBmb3IgYGl0ZXJhdGVlYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzYCBzdHlsZQ0KICAgICAqIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGdpdmVuDQogICAgICogb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQNCiAgICAgKiAgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGl0ZXJhdGVlYC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBzb3J0ZWQgYXJyYXkuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uc29ydEJ5KFsxLCAyLCAzXSwgZnVuY3Rpb24obikgew0KICAgICAqICAgcmV0dXJuIE1hdGguc2luKG4pOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IFszLCAxLCAyXQ0KICAgICAqDQogICAgICogXy5zb3J0QnkoWzEsIDIsIDNdLCBmdW5jdGlvbihuKSB7DQogICAgICogICByZXR1cm4gdGhpcy5zaW4obik7DQogICAgICogfSwgTWF0aCk7DQogICAgICogLy8gPT4gWzMsIDEsIDJdDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSBbDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnIH0sDQogICAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnIH0sDQogICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScgfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8ucGx1Y2soXy5zb3J0QnkodXNlcnMsICd1c2VyJyksICd1c2VyJyk7DQogICAgICogLy8gPT4gWydiYXJuZXknLCAnZnJlZCcsICdwZWJibGVzJ10NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzb3J0QnkoY29sbGVjdGlvbiwgaXRlcmF0ZWUsIHRoaXNBcmcpIHsNCiAgICAgIGlmIChjb2xsZWN0aW9uID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgfQ0KICAgICAgaWYgKHRoaXNBcmcgJiYgaXNJdGVyYXRlZUNhbGwoY29sbGVjdGlvbiwgaXRlcmF0ZWUsIHRoaXNBcmcpKSB7DQogICAgICAgIGl0ZXJhdGVlID0gbnVsbDsNCiAgICAgIH0NCiAgICAgIHZhciBpbmRleCA9IC0xOw0KICAgICAgaXRlcmF0ZWUgPSBnZXRDYWxsYmFjayhpdGVyYXRlZSwgdGhpc0FyZywgMyk7DQoNCiAgICAgIHZhciByZXN1bHQgPSBiYXNlTWFwKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pIHsNCiAgICAgICAgcmV0dXJuIHsgJ2NyaXRlcmlhJzogaXRlcmF0ZWUodmFsdWUsIGtleSwgY29sbGVjdGlvbiksICdpbmRleCc6ICsraW5kZXgsICd2YWx1ZSc6IHZhbHVlIH07DQogICAgICB9KTsNCiAgICAgIHJldHVybiBiYXNlU29ydEJ5KHJlc3VsdCwgY29tcGFyZUFzY2VuZGluZyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5zb3J0QnlgIGV4Y2VwdCB0aGF0IGl0IGNhbiBzb3J0IGJ5IG11bHRpcGxlIGl0ZXJhdGVlcw0KICAgICAqIG9yIHByb3BlcnR5IG5hbWVzLg0KICAgICAqDQogICAgICogSWYgYSBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkIGZvciBhbiBpdGVyYXRlZSB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGFuIG9iamVjdCBpcyBwcm92aWRlZCBmb3IgYW4gaXRlcmF0ZWUgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc2Agc3R5bGUNCiAgICAgKiBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBnaXZlbg0KICAgICAqIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb24NCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7Li4uKEZ1bmN0aW9ufEZ1bmN0aW9uW118T2JqZWN0fE9iamVjdFtdfHN0cmluZ3xzdHJpbmdbXSl9IGl0ZXJhdGVlcw0KICAgICAqICBUaGUgaXRlcmF0ZWVzIHRvIHNvcnQgYnksIHNwZWNpZmllZCBhcyBpbmRpdmlkdWFsIHZhbHVlcyBvciBhcnJheXMgb2YgdmFsdWVzLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IHNvcnRlZCBhcnJheS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gWw0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAnYWdlJzogNDggfSwNCiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FnZSc6IDM2IH0sDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MiB9LA0KICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzQgfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiBfLm1hcChfLnNvcnRCeUFsbCh1c2VycywgWyd1c2VyJywgJ2FnZSddKSwgXy52YWx1ZXMpOw0KICAgICAqIC8vID0+IFtbJ2Jhcm5leScsIDM0XSwgWydiYXJuZXknLCAzNl0sIFsnZnJlZCcsIDQyXSwgWydmcmVkJywgNDhdXQ0KICAgICAqDQogICAgICogXy5tYXAoXy5zb3J0QnlBbGwodXNlcnMsICd1c2VyJywgZnVuY3Rpb24oY2hyKSB7DQogICAgICogICByZXR1cm4gTWF0aC5mbG9vcihjaHIuYWdlIC8gMTApOw0KICAgICAqIH0pLCBfLnZhbHVlcyk7DQogICAgICogLy8gPT4gW1snYmFybmV5JywgMzZdLCBbJ2Jhcm5leScsIDM0XSwgWydmcmVkJywgNDhdLCBbJ2ZyZWQnLCA0Ml1dDQogICAgICovDQogICAgdmFyIHNvcnRCeUFsbCA9IHJlc3RQYXJhbShmdW5jdGlvbihjb2xsZWN0aW9uLCBpdGVyYXRlZXMpIHsNCiAgICAgIGlmIChjb2xsZWN0aW9uID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgfQ0KICAgICAgdmFyIGd1YXJkID0gaXRlcmF0ZWVzWzJdOw0KICAgICAgaWYgKGd1YXJkICYmIGlzSXRlcmF0ZWVDYWxsKGl0ZXJhdGVlc1swXSwgaXRlcmF0ZWVzWzFdLCBndWFyZCkpIHsNCiAgICAgICAgaXRlcmF0ZWVzLmxlbmd0aCA9IDE7DQogICAgICB9DQogICAgICByZXR1cm4gYmFzZVNvcnRCeU9yZGVyKGNvbGxlY3Rpb24sIGJhc2VGbGF0dGVuKGl0ZXJhdGVlcyksIFtdKTsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uc29ydEJ5QWxsYCBleGNlcHQgdGhhdCBpdCBhbGxvd3Mgc3BlY2lmeWluZyB0aGUNCiAgICAgKiBzb3J0IG9yZGVycyBvZiB0aGUgaXRlcmF0ZWVzIHRvIHNvcnQgYnkuIEEgdHJ1dGh5IHZhbHVlIGluIGBvcmRlcnNgIHdpbGwNCiAgICAgKiBzb3J0IHRoZSBjb3JyZXNwb25kaW5nIHByb3BlcnR5IG5hbWUgaW4gYXNjZW5kaW5nIG9yZGVyIHdoaWxlIGEgZmFsc2V5DQogICAgICogdmFsdWUgd2lsbCBzb3J0IGl0IGluIGRlc2NlbmRpbmcgb3JkZXIuDQogICAgICoNCiAgICAgKiBJZiBhIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQgZm9yIGFuIGl0ZXJhdGVlIHRoZSBjcmVhdGVkIGBfLnByb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlIG9mIHRoZSBnaXZlbiBlbGVtZW50Lg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBhbiBpdGVyYXRlZSB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzYCBzdHlsZQ0KICAgICAqIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGdpdmVuDQogICAgICogb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbltdfE9iamVjdFtdfHN0cmluZ1tdfSBpdGVyYXRlZXMgVGhlIGl0ZXJhdGVlcyB0byBzb3J0IGJ5Lg0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbltdfSBvcmRlcnMgVGhlIHNvcnQgb3JkZXJzIG9mIGBpdGVyYXRlZXNgLg0KICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhIGNhbGxiYWNrIGZvciBmdW5jdGlvbnMgbGlrZSBgXy5yZWR1Y2VgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IHNvcnRlZCBhcnJheS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gWw0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAnYWdlJzogNDggfSwNCiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FnZSc6IDM0IH0sDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MiB9LA0KICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYgfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiAvLyBzb3J0IGJ5IGB1c2VyYCBpbiBhc2NlbmRpbmcgb3JkZXIgYW5kIGJ5IGBhZ2VgIGluIGRlc2NlbmRpbmcgb3JkZXINCiAgICAgKiBfLm1hcChfLnNvcnRCeU9yZGVyKHVzZXJzLCBbJ3VzZXInLCAnYWdlJ10sIFt0cnVlLCBmYWxzZV0pLCBfLnZhbHVlcyk7DQogICAgICogLy8gPT4gW1snYmFybmV5JywgMzZdLCBbJ2Jhcm5leScsIDM0XSwgWydmcmVkJywgNDhdLCBbJ2ZyZWQnLCA0Ml1dDQogICAgICovDQogICAgZnVuY3Rpb24gc29ydEJ5T3JkZXIoY29sbGVjdGlvbiwgaXRlcmF0ZWVzLCBvcmRlcnMsIGd1YXJkKSB7DQogICAgICBpZiAoY29sbGVjdGlvbiA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBbXTsNCiAgICAgIH0NCiAgICAgIGlmIChndWFyZCAmJiBpc0l0ZXJhdGVlQ2FsbChpdGVyYXRlZXMsIG9yZGVycywgZ3VhcmQpKSB7DQogICAgICAgIG9yZGVycyA9IG51bGw7DQogICAgICB9DQogICAgICBpZiAoIWlzQXJyYXkoaXRlcmF0ZWVzKSkgew0KICAgICAgICBpdGVyYXRlZXMgPSBpdGVyYXRlZXMgPT0gbnVsbCA/IFtdIDogW2l0ZXJhdGVlc107DQogICAgICB9DQogICAgICBpZiAoIWlzQXJyYXkob3JkZXJzKSkgew0KICAgICAgICBvcmRlcnMgPSBvcmRlcnMgPT0gbnVsbCA/IFtdIDogW29yZGVyc107DQogICAgICB9DQogICAgICByZXR1cm4gYmFzZVNvcnRCeU9yZGVyKGNvbGxlY3Rpb24sIGl0ZXJhdGVlcywgb3JkZXJzKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBQZXJmb3JtcyBhIGRlZXAgY29tcGFyaXNvbiBiZXR3ZWVuIGVhY2ggZWxlbWVudCBpbiBgY29sbGVjdGlvbmAgYW5kIHRoZQ0KICAgICAqIHNvdXJjZSBvYmplY3QsIHJldHVybmluZyBhbiBhcnJheSBvZiBhbGwgZWxlbWVudHMgdGhhdCBoYXZlIGVxdWl2YWxlbnQNCiAgICAgKiBwcm9wZXJ0eSB2YWx1ZXMuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2Qgc3VwcG9ydHMgY29tcGFyaW5nIGFycmF5cywgYm9vbGVhbnMsIGBEYXRlYCBvYmplY3RzLA0KICAgICAqIG51bWJlcnMsIGBPYmplY3RgIG9iamVjdHMsIHJlZ2V4ZXMsIGFuZCBzdHJpbmdzLiBPYmplY3RzIGFyZSBjb21wYXJlZCBieQ0KICAgICAqIHRoZWlyIG93biwgbm90IGluaGVyaXRlZCwgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLiBGb3IgY29tcGFyaW5nIGEgc2luZ2xlDQogICAgICogb3duIG9yIGluaGVyaXRlZCBwcm9wZXJ0eSB2YWx1ZSBzZWUgYF8ubWF0Y2hlc1Byb3BlcnR5YC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIHNlYXJjaC4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3Qgb2YgcHJvcGVydHkgdmFsdWVzIHRvIG1hdGNoLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZpbHRlcmVkIGFycmF5Lg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSBbDQogICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICdhZ2UnOiAzNiwgJ2FjdGl2ZSc6IGZhbHNlLCAncGV0cyc6IFsnaG9wcHknXSB9LA0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAnYWdlJzogNDAsICdhY3RpdmUnOiB0cnVlLCAncGV0cyc6IFsnYmFieSBwdXNzJywgJ2Rpbm8nXSB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIF8ucGx1Y2soXy53aGVyZSh1c2VycywgeyAnYWdlJzogMzYsICdhY3RpdmUnOiBmYWxzZSB9KSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2Jhcm5leSddDQogICAgICoNCiAgICAgKiBfLnBsdWNrKF8ud2hlcmUodXNlcnMsIHsgJ3BldHMnOiBbJ2Rpbm8nXSB9KSwgJ3VzZXInKTsNCiAgICAgKiAvLyA9PiBbJ2ZyZWQnXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHdoZXJlKGNvbGxlY3Rpb24sIHNvdXJjZSkgew0KICAgICAgcmV0dXJuIGZpbHRlcihjb2xsZWN0aW9uLCBiYXNlTWF0Y2hlcyhzb3VyY2UpKTsNCiAgICB9DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvKioNCiAgICAgKiBHZXRzIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRoYXQgaGF2ZSBlbGFwc2VkIHNpbmNlIHRoZSBVbml4IGVwb2NoDQogICAgICogKDEgSmFudWFyeSAxOTcwIDAwOjAwOjAwIFVUQykuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgRGF0ZQ0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmRlZmVyKGZ1bmN0aW9uKHN0YW1wKSB7DQogICAgICogICBjb25zb2xlLmxvZyhfLm5vdygpIC0gc3RhbXApOw0KICAgICAqIH0sIF8ubm93KCkpOw0KICAgICAqIC8vID0+IGxvZ3MgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgaXQgdG9vayBmb3IgdGhlIGRlZmVycmVkIGZ1bmN0aW9uIHRvIGJlIGludm9rZWQNCiAgICAgKi8NCiAgICB2YXIgbm93ID0gbmF0aXZlTm93IHx8IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgIH07DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvKioNCiAgICAgKiBUaGUgb3Bwb3NpdGUgb2YgYF8uYmVmb3JlYDsgdGhpcyBtZXRob2QgY3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcw0KICAgICAqIGBmdW5jYCBvbmNlIGl0IGlzIGNhbGxlZCBgbmAgb3IgbW9yZSB0aW1lcy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBGdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBuIFRoZSBudW1iZXIgb2YgY2FsbHMgYmVmb3JlIGBmdW5jYCBpcyBpbnZva2VkLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHJlc3RyaWN0Lg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHJlc3RyaWN0ZWQgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBzYXZlcyA9IFsncHJvZmlsZScsICdzZXR0aW5ncyddOw0KICAgICAqDQogICAgICogdmFyIGRvbmUgPSBfLmFmdGVyKHNhdmVzLmxlbmd0aCwgZnVuY3Rpb24oKSB7DQogICAgICogICBjb25zb2xlLmxvZygnZG9uZSBzYXZpbmchJyk7DQogICAgICogfSk7DQogICAgICoNCiAgICAgKiBfLmZvckVhY2goc2F2ZXMsIGZ1bmN0aW9uKHR5cGUpIHsNCiAgICAgKiAgIGFzeW5jU2F2ZSh7ICd0eXBlJzogdHlwZSwgJ2NvbXBsZXRlJzogZG9uZSB9KTsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiBsb2dzICdkb25lIHNhdmluZyEnIGFmdGVyIHRoZSB0d28gYXN5bmMgc2F2ZXMgaGF2ZSBjb21wbGV0ZWQNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhZnRlcihuLCBmdW5jKSB7DQogICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICBpZiAodHlwZW9mIG4gPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICAgIHZhciB0ZW1wID0gbjsNCiAgICAgICAgICBuID0gZnVuYzsNCiAgICAgICAgICBmdW5jID0gdGVtcDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIG4gPSBuYXRpdmVJc0Zpbml0ZShuID0gK24pID8gbiA6IDA7DQogICAgICByZXR1cm4gZnVuY3Rpb24oKSB7DQogICAgICAgIGlmICgtLW4gPCAxKSB7DQogICAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCiAgICAgICAgfQ0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBhY2NlcHRzIHVwIHRvIGBuYCBhcmd1bWVudHMgaWdub3JpbmcgYW55DQogICAgICogYWRkaXRpb25hbCBhcmd1bWVudHMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjYXAgYXJndW1lbnRzIGZvci4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW249ZnVuYy5sZW5ndGhdIFRoZSBhcml0eSBjYXAuDQogICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGEgY2FsbGJhY2sgZm9yIGZ1bmN0aW9ucyBsaWtlIGBfLm1hcGAuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8ubWFwKFsnNicsICc4JywgJzEwJ10sIF8uYXJ5KHBhcnNlSW50LCAxKSk7DQogICAgICogLy8gPT4gWzYsIDgsIDEwXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGFyeShmdW5jLCBuLCBndWFyZCkgew0KICAgICAgaWYgKGd1YXJkICYmIGlzSXRlcmF0ZWVDYWxsKGZ1bmMsIG4sIGd1YXJkKSkgew0KICAgICAgICBuID0gbnVsbDsNCiAgICAgIH0NCiAgICAgIG4gPSAoZnVuYyAmJiBuID09IG51bGwpID8gZnVuYy5sZW5ndGggOiBuYXRpdmVNYXgoK24gfHwgMCwgMCk7DQogICAgICByZXR1cm4gY3JlYXRlV3JhcHBlcihmdW5jLCBBUllfRkxBRywgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2AsIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIGFuZCBhcmd1bWVudHMNCiAgICAgKiBvZiB0aGUgY3JlYXRlZCBmdW5jdGlvbiwgd2hpbGUgaXQgaXMgY2FsbGVkIGxlc3MgdGhhbiBgbmAgdGltZXMuIFN1YnNlcXVlbnQNCiAgICAgKiBjYWxscyB0byB0aGUgY3JlYXRlZCBmdW5jdGlvbiByZXR1cm4gdGhlIHJlc3VsdCBvZiB0aGUgbGFzdCBgZnVuY2AgaW52b2NhdGlvbi4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBGdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBuIFRoZSBudW1iZXIgb2YgY2FsbHMgYXQgd2hpY2ggYGZ1bmNgIGlzIG5vIGxvbmdlciBpbnZva2VkLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHJlc3RyaWN0Lg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHJlc3RyaWN0ZWQgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIGpRdWVyeSgnI2FkZCcpLm9uKCdjbGljaycsIF8uYmVmb3JlKDUsIGFkZENvbnRhY3RUb0xpc3QpKTsNCiAgICAgKiAvLyA9PiBhbGxvd3MgYWRkaW5nIHVwIHRvIDQgY29udGFjdHMgdG8gdGhlIGxpc3QNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiZWZvcmUobiwgZnVuYykgew0KICAgICAgdmFyIHJlc3VsdDsNCiAgICAgIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGlmICh0eXBlb2YgbiA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgdmFyIHRlbXAgPSBuOw0KICAgICAgICAgIG4gPSBmdW5jOw0KICAgICAgICAgIGZ1bmMgPSB0ZW1wOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAoLS1uID4gMCkgew0KICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobiA8PSAxKSB7DQogICAgICAgICAgZnVuYyA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCB0aGUgYHRoaXNgIGJpbmRpbmcgb2YgYHRoaXNBcmdgDQogICAgICogYW5kIHByZXBlbmRzIGFueSBhZGRpdGlvbmFsIGBfLmJpbmRgIGFyZ3VtZW50cyB0byB0aG9zZSBwcm92aWRlZCB0byB0aGUNCiAgICAgKiBib3VuZCBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqIFRoZSBgXy5iaW5kLnBsYWNlaG9sZGVyYCB2YWx1ZSwgd2hpY2ggZGVmYXVsdHMgdG8gYF9gIGluIG1vbm9saXRoaWMgYnVpbGRzLA0KICAgICAqIG1heSBiZSB1c2VkIGFzIGEgcGxhY2Vob2xkZXIgZm9yIHBhcnRpYWxseSBhcHBsaWVkIGFyZ3VtZW50cy4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBVbmxpa2UgbmF0aXZlIGBGdW5jdGlvbiNiaW5kYCB0aGlzIG1ldGhvZCBkb2VzIG5vdCBzZXQgdGhlICJsZW5ndGgiDQogICAgICogcHJvcGVydHkgb2YgYm91bmQgZnVuY3Rpb25zLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYmluZC4NCiAgICAgKiBAcGFyYW0geyp9IHRoaXNBcmcgVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBmdW5jYC4NCiAgICAgKiBAcGFyYW0gey4uLip9IFtwYXJ0aWFsc10gVGhlIGFyZ3VtZW50cyB0byBiZSBwYXJ0aWFsbHkgYXBwbGllZC4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBib3VuZCBmdW5jdGlvbi4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIGdyZWV0ID0gZnVuY3Rpb24oZ3JlZXRpbmcsIHB1bmN0dWF0aW9uKSB7DQogICAgICogICByZXR1cm4gZ3JlZXRpbmcgKyAnICcgKyB0aGlzLnVzZXIgKyBwdW5jdHVhdGlvbjsNCiAgICAgKiB9Ow0KICAgICAqDQogICAgICogdmFyIG9iamVjdCA9IHsgJ3VzZXInOiAnZnJlZCcgfTsNCiAgICAgKg0KICAgICAqIHZhciBib3VuZCA9IF8uYmluZChncmVldCwgb2JqZWN0LCAnaGknKTsNCiAgICAgKiBib3VuZCgnIScpOw0KICAgICAqIC8vID0+ICdoaSBmcmVkIScNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHBsYWNlaG9sZGVycw0KICAgICAqIHZhciBib3VuZCA9IF8uYmluZChncmVldCwgb2JqZWN0LCBfLCAnIScpOw0KICAgICAqIGJvdW5kKCdoaScpOw0KICAgICAqIC8vID0+ICdoaSBmcmVkIScNCiAgICAgKi8NCiAgICB2YXIgYmluZCA9IHJlc3RQYXJhbShmdW5jdGlvbihmdW5jLCB0aGlzQXJnLCBwYXJ0aWFscykgew0KICAgICAgdmFyIGJpdG1hc2sgPSBCSU5EX0ZMQUc7DQogICAgICBpZiAocGFydGlhbHMubGVuZ3RoKSB7DQogICAgICAgIHZhciBob2xkZXJzID0gcmVwbGFjZUhvbGRlcnMocGFydGlhbHMsIGJpbmQucGxhY2Vob2xkZXIpOw0KICAgICAgICBiaXRtYXNrIHw9IFBBUlRJQUxfRkxBRzsNCiAgICAgIH0NCiAgICAgIHJldHVybiBjcmVhdGVXcmFwcGVyKGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzLCBob2xkZXJzKTsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEJpbmRzIG1ldGhvZHMgb2YgYW4gb2JqZWN0IHRvIHRoZSBvYmplY3QgaXRzZWxmLCBvdmVyd3JpdGluZyB0aGUgZXhpc3RpbmcNCiAgICAgKiBtZXRob2QuIE1ldGhvZCBuYW1lcyBtYXkgYmUgc3BlY2lmaWVkIGFzIGluZGl2aWR1YWwgYXJndW1lbnRzIG9yIGFzIGFycmF5cw0KICAgICAqIG9mIG1ldGhvZCBuYW1lcy4gSWYgbm8gbWV0aG9kIG5hbWVzIGFyZSBwcm92aWRlZCBhbGwgZW51bWVyYWJsZSBmdW5jdGlvbg0KICAgICAqIHByb3BlcnRpZXMsIG93biBhbmQgaW5oZXJpdGVkLCBvZiBgb2JqZWN0YCBhcmUgYm91bmQuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgZG9lcyBub3Qgc2V0IHRoZSAibGVuZ3RoIiBwcm9wZXJ0eSBvZiBib3VuZCBmdW5jdGlvbnMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gYmluZCBhbmQgYXNzaWduIHRoZSBib3VuZCBtZXRob2RzIHRvLg0KICAgICAqIEBwYXJhbSB7Li4uKHN0cmluZ3xzdHJpbmdbXSl9IFttZXRob2ROYW1lc10gVGhlIG9iamVjdCBtZXRob2QgbmFtZXMgdG8gYmluZCwNCiAgICAgKiAgc3BlY2lmaWVkIGFzIGluZGl2aWR1YWwgbWV0aG9kIG5hbWVzIG9yIGFycmF5cyBvZiBtZXRob2QgbmFtZXMuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIHZpZXcgPSB7DQogICAgICogICAnbGFiZWwnOiAnZG9jcycsDQogICAgICogICAnb25DbGljayc6IGZ1bmN0aW9uKCkgew0KICAgICAqICAgICBjb25zb2xlLmxvZygnY2xpY2tlZCAnICsgdGhpcy5sYWJlbCk7DQogICAgICogICB9DQogICAgICogfTsNCiAgICAgKg0KICAgICAqIF8uYmluZEFsbCh2aWV3KTsNCiAgICAgKiBqUXVlcnkoJyNkb2NzJykub24oJ2NsaWNrJywgdmlldy5vbkNsaWNrKTsNCiAgICAgKiAvLyA9PiBsb2dzICdjbGlja2VkIGRvY3MnIHdoZW4gdGhlIGVsZW1lbnQgaXMgY2xpY2tlZA0KICAgICAqLw0KICAgIHZhciBiaW5kQWxsID0gcmVzdFBhcmFtKGZ1bmN0aW9uKG9iamVjdCwgbWV0aG9kTmFtZXMpIHsNCiAgICAgIG1ldGhvZE5hbWVzID0gbWV0aG9kTmFtZXMubGVuZ3RoID8gYmFzZUZsYXR0ZW4obWV0aG9kTmFtZXMpIDogZnVuY3Rpb25zKG9iamVjdCk7DQoNCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IG1ldGhvZE5hbWVzLmxlbmd0aDsNCg0KICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgdmFyIGtleSA9IG1ldGhvZE5hbWVzW2luZGV4XTsNCiAgICAgICAgb2JqZWN0W2tleV0gPSBjcmVhdGVXcmFwcGVyKG9iamVjdFtrZXldLCBCSU5EX0ZMQUcsIG9iamVjdCk7DQogICAgICB9DQogICAgICByZXR1cm4gb2JqZWN0Ow0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyB0aGUgbWV0aG9kIGF0IGBvYmplY3Rba2V5XWAgYW5kIHByZXBlbmRzDQogICAgICogYW55IGFkZGl0aW9uYWwgYF8uYmluZEtleWAgYXJndW1lbnRzIHRvIHRob3NlIHByb3ZpZGVkIHRvIHRoZSBib3VuZCBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqIFRoaXMgbWV0aG9kIGRpZmZlcnMgZnJvbSBgXy5iaW5kYCBieSBhbGxvd2luZyBib3VuZCBmdW5jdGlvbnMgdG8gcmVmZXJlbmNlDQogICAgICogbWV0aG9kcyB0aGF0IG1heSBiZSByZWRlZmluZWQgb3IgZG9uJ3QgeWV0IGV4aXN0Lg0KICAgICAqIFNlZSBbUGV0ZXIgTWljaGF1eCdzIGFydGljbGVdKGh0dHA6Ly9wZXRlci5taWNoYXV4LmNhL2FydGljbGVzL2xhenktZnVuY3Rpb24tZGVmaW5pdGlvbi1wYXR0ZXJuKQ0KICAgICAqIGZvciBtb3JlIGRldGFpbHMuDQogICAgICoNCiAgICAgKiBUaGUgYF8uYmluZEtleS5wbGFjZWhvbGRlcmAgdmFsdWUsIHdoaWNoIGRlZmF1bHRzIHRvIGBfYCBpbiBtb25vbGl0aGljDQogICAgICogYnVpbGRzLCBtYXkgYmUgdXNlZCBhcyBhIHBsYWNlaG9sZGVyIGZvciBwYXJ0aWFsbHkgYXBwbGllZCBhcmd1bWVudHMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdGhlIG1ldGhvZCBiZWxvbmdzIHRvLg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgbWV0aG9kLg0KICAgICAqIEBwYXJhbSB7Li4uKn0gW3BhcnRpYWxzXSBUaGUgYXJndW1lbnRzIHRvIGJlIHBhcnRpYWxseSBhcHBsaWVkLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGJvdW5kIGZ1bmN0aW9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgb2JqZWN0ID0gew0KICAgICAqICAgJ3VzZXInOiAnZnJlZCcsDQogICAgICogICAnZ3JlZXQnOiBmdW5jdGlvbihncmVldGluZywgcHVuY3R1YXRpb24pIHsNCiAgICAgKiAgICAgcmV0dXJuIGdyZWV0aW5nICsgJyAnICsgdGhpcy51c2VyICsgcHVuY3R1YXRpb247DQogICAgICogICB9DQogICAgICogfTsNCiAgICAgKg0KICAgICAqIHZhciBib3VuZCA9IF8uYmluZEtleShvYmplY3QsICdncmVldCcsICdoaScpOw0KICAgICAqIGJvdW5kKCchJyk7DQogICAgICogLy8gPT4gJ2hpIGZyZWQhJw0KICAgICAqDQogICAgICogb2JqZWN0LmdyZWV0ID0gZnVuY3Rpb24oZ3JlZXRpbmcsIHB1bmN0dWF0aW9uKSB7DQogICAgICogICByZXR1cm4gZ3JlZXRpbmcgKyAneWEgJyArIHRoaXMudXNlciArIHB1bmN0dWF0aW9uOw0KICAgICAqIH07DQogICAgICoNCiAgICAgKiBib3VuZCgnIScpOw0KICAgICAqIC8vID0+ICdoaXlhIGZyZWQhJw0KICAgICAqDQogICAgICogLy8gdXNpbmcgcGxhY2Vob2xkZXJzDQogICAgICogdmFyIGJvdW5kID0gXy5iaW5kS2V5KG9iamVjdCwgJ2dyZWV0JywgXywgJyEnKTsNCiAgICAgKiBib3VuZCgnaGknKTsNCiAgICAgKiAvLyA9PiAnaGl5YSBmcmVkIScNCiAgICAgKi8NCiAgICB2YXIgYmluZEtleSA9IHJlc3RQYXJhbShmdW5jdGlvbihvYmplY3QsIGtleSwgcGFydGlhbHMpIHsNCiAgICAgIHZhciBiaXRtYXNrID0gQklORF9GTEFHIHwgQklORF9LRVlfRkxBRzsNCiAgICAgIGlmIChwYXJ0aWFscy5sZW5ndGgpIHsNCiAgICAgICAgdmFyIGhvbGRlcnMgPSByZXBsYWNlSG9sZGVycyhwYXJ0aWFscywgYmluZEtleS5wbGFjZWhvbGRlcik7DQogICAgICAgIGJpdG1hc2sgfD0gUEFSVElBTF9GTEFHOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGNyZWF0ZVdyYXBwZXIoa2V5LCBiaXRtYXNrLCBvYmplY3QsIHBhcnRpYWxzLCBob2xkZXJzKTsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGFjY2VwdHMgb25lIG9yIG1vcmUgYXJndW1lbnRzIG9mIGBmdW5jYCB0aGF0IHdoZW4NCiAgICAgKiBjYWxsZWQgZWl0aGVyIGludm9rZXMgYGZ1bmNgIHJldHVybmluZyBpdHMgcmVzdWx0LCBpZiBhbGwgYGZ1bmNgIGFyZ3VtZW50cw0KICAgICAqIGhhdmUgYmVlbiBwcm92aWRlZCwgb3IgcmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgYWNjZXB0cyBvbmUgb3IgbW9yZSBvZiB0aGUNCiAgICAgKiByZW1haW5pbmcgYGZ1bmNgIGFyZ3VtZW50cywgYW5kIHNvIG9uLiBUaGUgYXJpdHkgb2YgYGZ1bmNgIG1heSBiZSBzcGVjaWZpZWQNCiAgICAgKiBpZiBgZnVuYy5sZW5ndGhgIGlzIG5vdCBzdWZmaWNpZW50Lg0KICAgICAqDQogICAgICogVGhlIGBfLmN1cnJ5LnBsYWNlaG9sZGVyYCB2YWx1ZSwgd2hpY2ggZGVmYXVsdHMgdG8gYF9gIGluIG1vbm9saXRoaWMgYnVpbGRzLA0KICAgICAqIG1heSBiZSB1c2VkIGFzIGEgcGxhY2Vob2xkZXIgZm9yIHByb3ZpZGVkIGFyZ3VtZW50cy4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzZXQgdGhlICJsZW5ndGgiIHByb3BlcnR5IG9mIGN1cnJpZWQgZnVuY3Rpb25zLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY3VycnkuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFthcml0eT1mdW5jLmxlbmd0aF0gVGhlIGFyaXR5IG9mIGBmdW5jYC4NCiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYSBjYWxsYmFjayBmb3IgZnVuY3Rpb25zIGxpa2UgYF8ubWFwYC4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBjdXJyaWVkIGZ1bmN0aW9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgYWJjID0gZnVuY3Rpb24oYSwgYiwgYykgew0KICAgICAqICAgcmV0dXJuIFthLCBiLCBjXTsNCiAgICAgKiB9Ow0KICAgICAqDQogICAgICogdmFyIGN1cnJpZWQgPSBfLmN1cnJ5KGFiYyk7DQogICAgICoNCiAgICAgKiBjdXJyaWVkKDEpKDIpKDMpOw0KICAgICAqIC8vID0+IFsxLCAyLCAzXQ0KICAgICAqDQogICAgICogY3VycmllZCgxLCAyKSgzKTsNCiAgICAgKiAvLyA9PiBbMSwgMiwgM10NCiAgICAgKg0KICAgICAqIGN1cnJpZWQoMSwgMiwgMyk7DQogICAgICogLy8gPT4gWzEsIDIsIDNdDQogICAgICoNCiAgICAgKiAvLyB1c2luZyBwbGFjZWhvbGRlcnMNCiAgICAgKiBjdXJyaWVkKDEpKF8sIDMpKDIpOw0KICAgICAqIC8vID0+IFsxLCAyLCAzXQ0KICAgICAqLw0KICAgIHZhciBjdXJyeSA9IGNyZWF0ZUN1cnJ5KENVUlJZX0ZMQUcpOw0KDQogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5jdXJyeWAgZXhjZXB0IHRoYXQgYXJndW1lbnRzIGFyZSBhcHBsaWVkIHRvIGBmdW5jYA0KICAgICAqIGluIHRoZSBtYW5uZXIgb2YgYF8ucGFydGlhbFJpZ2h0YCBpbnN0ZWFkIG9mIGBfLnBhcnRpYWxgLg0KICAgICAqDQogICAgICogVGhlIGBfLmN1cnJ5UmlnaHQucGxhY2Vob2xkZXJgIHZhbHVlLCB3aGljaCBkZWZhdWx0cyB0byBgX2AgaW4gbW9ub2xpdGhpYw0KICAgICAqIGJ1aWxkcywgbWF5IGJlIHVzZWQgYXMgYSBwbGFjZWhvbGRlciBmb3IgcHJvdmlkZWQgYXJndW1lbnRzLg0KICAgICAqDQogICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGRvZXMgbm90IHNldCB0aGUgImxlbmd0aCIgcHJvcGVydHkgb2YgY3VycmllZCBmdW5jdGlvbnMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjdXJyeS4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2FyaXR5PWZ1bmMubGVuZ3RoXSBUaGUgYXJpdHkgb2YgYGZ1bmNgLg0KICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhIGNhbGxiYWNrIGZvciBmdW5jdGlvbnMgbGlrZSBgXy5tYXBgLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGN1cnJpZWQgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBhYmMgPSBmdW5jdGlvbihhLCBiLCBjKSB7DQogICAgICogICByZXR1cm4gW2EsIGIsIGNdOw0KICAgICAqIH07DQogICAgICoNCiAgICAgKiB2YXIgY3VycmllZCA9IF8uY3VycnlSaWdodChhYmMpOw0KICAgICAqDQogICAgICogY3VycmllZCgzKSgyKSgxKTsNCiAgICAgKiAvLyA9PiBbMSwgMiwgM10NCiAgICAgKg0KICAgICAqIGN1cnJpZWQoMiwgMykoMSk7DQogICAgICogLy8gPT4gWzEsIDIsIDNdDQogICAgICoNCiAgICAgKiBjdXJyaWVkKDEsIDIsIDMpOw0KICAgICAqIC8vID0+IFsxLCAyLCAzXQ0KICAgICAqDQogICAgICogLy8gdXNpbmcgcGxhY2Vob2xkZXJzDQogICAgICogY3VycmllZCgzKSgxLCBfKSgyKTsNCiAgICAgKiAvLyA9PiBbMSwgMiwgM10NCiAgICAgKi8NCiAgICB2YXIgY3VycnlSaWdodCA9IGNyZWF0ZUN1cnJ5KENVUlJZX1JJR0hUX0ZMQUcpOw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGRlYm91bmNlZCBmdW5jdGlvbiB0aGF0IGRlbGF5cyBpbnZva2luZyBgZnVuY2AgdW50aWwgYWZ0ZXIgYHdhaXRgDQogICAgICogbWlsbGlzZWNvbmRzIGhhdmUgZWxhcHNlZCBzaW5jZSB0aGUgbGFzdCB0aW1lIHRoZSBkZWJvdW5jZWQgZnVuY3Rpb24gd2FzDQogICAgICogaW52b2tlZC4gVGhlIGRlYm91bmNlZCBmdW5jdGlvbiBjb21lcyB3aXRoIGEgYGNhbmNlbGAgbWV0aG9kIHRvIGNhbmNlbA0KICAgICAqIGRlbGF5ZWQgaW52b2NhdGlvbnMuIFByb3ZpZGUgYW4gb3B0aW9ucyBvYmplY3QgdG8gaW5kaWNhdGUgdGhhdCBgZnVuY2ANCiAgICAgKiBzaG91bGQgYmUgaW52b2tlZCBvbiB0aGUgbGVhZGluZyBhbmQvb3IgdHJhaWxpbmcgZWRnZSBvZiB0aGUgYHdhaXRgIHRpbWVvdXQuDQogICAgICogU3Vic2VxdWVudCBjYWxscyB0byB0aGUgZGVib3VuY2VkIGZ1bmN0aW9uIHJldHVybiB0aGUgcmVzdWx0IG9mIHRoZSBsYXN0DQogICAgICogYGZ1bmNgIGludm9jYXRpb24uDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogSWYgYGxlYWRpbmdgIGFuZCBgdHJhaWxpbmdgIG9wdGlvbnMgYXJlIGB0cnVlYCwgYGZ1bmNgIGlzIGludm9rZWQNCiAgICAgKiBvbiB0aGUgdHJhaWxpbmcgZWRnZSBvZiB0aGUgdGltZW91dCBvbmx5IGlmIHRoZSB0aGUgZGVib3VuY2VkIGZ1bmN0aW9uIGlzDQogICAgICogaW52b2tlZCBtb3JlIHRoYW4gb25jZSBkdXJpbmcgdGhlIGB3YWl0YCB0aW1lb3V0Lg0KICAgICAqDQogICAgICogU2VlIFtEYXZpZCBDb3JiYWNobydzIGFydGljbGVdKGh0dHA6Ly9kcnVwYWxtb3Rpb24uY29tL2FydGljbGUvZGVib3VuY2UtYW5kLXRocm90dGxlLXZpc3VhbC1leHBsYW5hdGlvbikNCiAgICAgKiBmb3IgZGV0YWlscyBvdmVyIHRoZSBkaWZmZXJlbmNlcyBiZXR3ZWVuIGBfLmRlYm91bmNlYCBhbmQgYF8udGhyb3R0bGVgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gZGVib3VuY2UuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFt3YWl0PTBdIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIGRlbGF5Lg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gVGhlIG9wdGlvbnMgb2JqZWN0Lg0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMubGVhZGluZz1mYWxzZV0gU3BlY2lmeSBpbnZva2luZyBvbiB0aGUgbGVhZGluZw0KICAgICAqICBlZGdlIG9mIHRoZSB0aW1lb3V0Lg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5tYXhXYWl0XSBUaGUgbWF4aW11bSB0aW1lIGBmdW5jYCBpcyBhbGxvd2VkIHRvIGJlDQogICAgICogIGRlbGF5ZWQgYmVmb3JlIGl0IGlzIGludm9rZWQuDQogICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy50cmFpbGluZz10cnVlXSBTcGVjaWZ5IGludm9raW5nIG9uIHRoZSB0cmFpbGluZw0KICAgICAqICBlZGdlIG9mIHRoZSB0aW1lb3V0Lg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGRlYm91bmNlZCBmdW5jdGlvbi4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogLy8gYXZvaWQgY29zdGx5IGNhbGN1bGF0aW9ucyB3aGlsZSB0aGUgd2luZG93IHNpemUgaXMgaW4gZmx1eA0KICAgICAqIGpRdWVyeSh3aW5kb3cpLm9uKCdyZXNpemUnLCBfLmRlYm91bmNlKGNhbGN1bGF0ZUxheW91dCwgMTUwKSk7DQogICAgICoNCiAgICAgKiAvLyBpbnZva2UgYHNlbmRNYWlsYCB3aGVuIHRoZSBjbGljayBldmVudCBpcyBmaXJlZCwgZGVib3VuY2luZyBzdWJzZXF1ZW50IGNhbGxzDQogICAgICogalF1ZXJ5KCcjcG9zdGJveCcpLm9uKCdjbGljaycsIF8uZGVib3VuY2Uoc2VuZE1haWwsIDMwMCwgew0KICAgICAqICAgJ2xlYWRpbmcnOiB0cnVlLA0KICAgICAqICAgJ3RyYWlsaW5nJzogZmFsc2UNCiAgICAgKiB9KSk7DQogICAgICoNCiAgICAgKiAvLyBlbnN1cmUgYGJhdGNoTG9nYCBpcyBpbnZva2VkIG9uY2UgYWZ0ZXIgMSBzZWNvbmQgb2YgZGVib3VuY2VkIGNhbGxzDQogICAgICogdmFyIHNvdXJjZSA9IG5ldyBFdmVudFNvdXJjZSgnL3N0cmVhbScpOw0KICAgICAqIGpRdWVyeShzb3VyY2UpLm9uKCdtZXNzYWdlJywgXy5kZWJvdW5jZShiYXRjaExvZywgMjUwLCB7DQogICAgICogICAnbWF4V2FpdCc6IDEwMDANCiAgICAgKiB9KSk7DQogICAgICoNCiAgICAgKiAvLyBjYW5jZWwgYSBkZWJvdW5jZWQgY2FsbA0KICAgICAqIHZhciB0b2RvQ2hhbmdlcyA9IF8uZGVib3VuY2UoYmF0Y2hMb2csIDEwMDApOw0KICAgICAqIE9iamVjdC5vYnNlcnZlKG1vZGVscy50b2RvLCB0b2RvQ2hhbmdlcyk7DQogICAgICoNCiAgICAgKiBPYmplY3Qub2JzZXJ2ZShtb2RlbHMsIGZ1bmN0aW9uKGNoYW5nZXMpIHsNCiAgICAgKiAgIGlmIChfLmZpbmQoY2hhbmdlcywgeyAndXNlcic6ICd0b2RvJywgJ3R5cGUnOiAnZGVsZXRlJ30pKSB7DQogICAgICogICAgIHRvZG9DaGFuZ2VzLmNhbmNlbCgpOw0KICAgICAqICAgfQ0KICAgICAqIH0sIFsnZGVsZXRlJ10pOw0KICAgICAqDQogICAgICogLy8gLi4uYXQgc29tZSBwb2ludCBgbW9kZWxzLnRvZG9gIGlzIGNoYW5nZWQNCiAgICAgKiBtb2RlbHMudG9kby5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAqDQogICAgICogLy8gLi4uYmVmb3JlIDEgc2Vjb25kIGhhcyBwYXNzZWQgYG1vZGVscy50b2RvYCBpcyBkZWxldGVkDQogICAgICogLy8gd2hpY2ggY2FuY2VscyB0aGUgZGVib3VuY2VkIGB0b2RvQ2hhbmdlc2AgY2FsbA0KICAgICAqIGRlbGV0ZSBtb2RlbHMudG9kbzsNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jLCB3YWl0LCBvcHRpb25zKSB7DQogICAgICB2YXIgYXJncywNCiAgICAgICAgICBtYXhUaW1lb3V0SWQsDQogICAgICAgICAgcmVzdWx0LA0KICAgICAgICAgIHN0YW1wLA0KICAgICAgICAgIHRoaXNBcmcsDQogICAgICAgICAgdGltZW91dElkLA0KICAgICAgICAgIHRyYWlsaW5nQ2FsbCwNCiAgICAgICAgICBsYXN0Q2FsbGVkID0gMCwNCiAgICAgICAgICBtYXhXYWl0ID0gZmFsc2UsDQogICAgICAgICAgdHJhaWxpbmcgPSB0cnVlOw0KDQogICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7DQogICAgICB9DQogICAgICB3YWl0ID0gd2FpdCA8IDAgPyAwIDogKCt3YWl0IHx8IDApOw0KICAgICAgaWYgKG9wdGlvbnMgPT09IHRydWUpIHsNCiAgICAgICAgdmFyIGxlYWRpbmcgPSB0cnVlOw0KICAgICAgICB0cmFpbGluZyA9IGZhbHNlOw0KICAgICAgfSBlbHNlIGlmIChpc09iamVjdChvcHRpb25zKSkgew0KICAgICAgICBsZWFkaW5nID0gb3B0aW9ucy5sZWFkaW5nOw0KICAgICAgICBtYXhXYWl0ID0gJ21heFdhaXQnIGluIG9wdGlvbnMgJiYgbmF0aXZlTWF4KCtvcHRpb25zLm1heFdhaXQgfHwgMCwgd2FpdCk7DQogICAgICAgIHRyYWlsaW5nID0gJ3RyYWlsaW5nJyBpbiBvcHRpb25zID8gb3B0aW9ucy50cmFpbGluZyA6IHRyYWlsaW5nOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7DQogICAgICAgIGlmICh0aW1lb3V0SWQpIHsNCiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobWF4VGltZW91dElkKSB7DQogICAgICAgICAgY2xlYXJUaW1lb3V0KG1heFRpbWVvdXRJZCk7DQogICAgICAgIH0NCiAgICAgICAgbWF4VGltZW91dElkID0gdGltZW91dElkID0gdHJhaWxpbmdDYWxsID0gdW5kZWZpbmVkOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBkZWxheWVkKCkgew0KICAgICAgICB2YXIgcmVtYWluaW5nID0gd2FpdCAtIChub3coKSAtIHN0YW1wKTsNCiAgICAgICAgaWYgKHJlbWFpbmluZyA8PSAwIHx8IHJlbWFpbmluZyA+IHdhaXQpIHsNCiAgICAgICAgICBpZiAobWF4VGltZW91dElkKSB7DQogICAgICAgICAgICBjbGVhclRpbWVvdXQobWF4VGltZW91dElkKTsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIGlzQ2FsbGVkID0gdHJhaWxpbmdDYWxsOw0KICAgICAgICAgIG1heFRpbWVvdXRJZCA9IHRpbWVvdXRJZCA9IHRyYWlsaW5nQ2FsbCA9IHVuZGVmaW5lZDsNCiAgICAgICAgICBpZiAoaXNDYWxsZWQpIHsNCiAgICAgICAgICAgIGxhc3RDYWxsZWQgPSBub3coKTsNCiAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpc0FyZywgYXJncyk7DQogICAgICAgICAgICBpZiAoIXRpbWVvdXRJZCAmJiAhbWF4VGltZW91dElkKSB7DQogICAgICAgICAgICAgIGFyZ3MgPSB0aGlzQXJnID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGltZW91dElkID0gc2V0VGltZW91dChkZWxheWVkLCByZW1haW5pbmcpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG1heERlbGF5ZWQoKSB7DQogICAgICAgIGlmICh0aW1lb3V0SWQpIHsNCiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTsNCiAgICAgICAgfQ0KICAgICAgICBtYXhUaW1lb3V0SWQgPSB0aW1lb3V0SWQgPSB0cmFpbGluZ0NhbGwgPSB1bmRlZmluZWQ7DQogICAgICAgIGlmICh0cmFpbGluZyB8fCAobWF4V2FpdCAhPT0gd2FpdCkpIHsNCiAgICAgICAgICBsYXN0Q2FsbGVkID0gbm93KCk7DQogICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzQXJnLCBhcmdzKTsNCiAgICAgICAgICBpZiAoIXRpbWVvdXRJZCAmJiAhbWF4VGltZW91dElkKSB7DQogICAgICAgICAgICBhcmdzID0gdGhpc0FyZyA9IG51bGw7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGRlYm91bmNlZCgpIHsNCiAgICAgICAgYXJncyA9IGFyZ3VtZW50czsNCiAgICAgICAgc3RhbXAgPSBub3coKTsNCiAgICAgICAgdGhpc0FyZyA9IHRoaXM7DQogICAgICAgIHRyYWlsaW5nQ2FsbCA9IHRyYWlsaW5nICYmICh0aW1lb3V0SWQgfHwgIWxlYWRpbmcpOw0KDQogICAgICAgIGlmIChtYXhXYWl0ID09PSBmYWxzZSkgew0KICAgICAgICAgIHZhciBsZWFkaW5nQ2FsbCA9IGxlYWRpbmcgJiYgIXRpbWVvdXRJZDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAoIW1heFRpbWVvdXRJZCAmJiAhbGVhZGluZykgew0KICAgICAgICAgICAgbGFzdENhbGxlZCA9IHN0YW1wOw0KICAgICAgICAgIH0NCiAgICAgICAgICB2YXIgcmVtYWluaW5nID0gbWF4V2FpdCAtIChzdGFtcCAtIGxhc3RDYWxsZWQpLA0KICAgICAgICAgICAgICBpc0NhbGxlZCA9IHJlbWFpbmluZyA8PSAwIHx8IHJlbWFpbmluZyA+IG1heFdhaXQ7DQoNCiAgICAgICAgICBpZiAoaXNDYWxsZWQpIHsNCiAgICAgICAgICAgIGlmIChtYXhUaW1lb3V0SWQpIHsNCiAgICAgICAgICAgICAgbWF4VGltZW91dElkID0gY2xlYXJUaW1lb3V0KG1heFRpbWVvdXRJZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsYXN0Q2FsbGVkID0gc3RhbXA7DQogICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KHRoaXNBcmcsIGFyZ3MpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlIGlmICghbWF4VGltZW91dElkKSB7DQogICAgICAgICAgICBtYXhUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KG1heERlbGF5ZWQsIHJlbWFpbmluZyk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NhbGxlZCAmJiB0aW1lb3V0SWQpIHsNCiAgICAgICAgICB0aW1lb3V0SWQgPSBjbGVhclRpbWVvdXQodGltZW91dElkKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICghdGltZW91dElkICYmIHdhaXQgIT09IG1heFdhaXQpIHsNCiAgICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGRlbGF5ZWQsIHdhaXQpOw0KICAgICAgICB9DQogICAgICAgIGlmIChsZWFkaW5nQ2FsbCkgew0KICAgICAgICAgIGlzQ2FsbGVkID0gdHJ1ZTsNCiAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KHRoaXNBcmcsIGFyZ3MpOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NhbGxlZCAmJiAhdGltZW91dElkICYmICFtYXhUaW1lb3V0SWQpIHsNCiAgICAgICAgICBhcmdzID0gdGhpc0FyZyA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCiAgICAgIGRlYm91bmNlZC5jYW5jZWwgPSBjYW5jZWw7DQogICAgICByZXR1cm4gZGVib3VuY2VkOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIERlZmVycyBpbnZva2luZyB0aGUgYGZ1bmNgIHVudGlsIHRoZSBjdXJyZW50IGNhbGwgc3RhY2sgaGFzIGNsZWFyZWQuIEFueQ0KICAgICAqIGFkZGl0aW9uYWwgYXJndW1lbnRzIGFyZSBwcm92aWRlZCB0byBgZnVuY2Agd2hlbiBpdCBpcyBpbnZva2VkLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gZGVmZXIuDQogICAgICogQHBhcmFtIHsuLi4qfSBbYXJnc10gVGhlIGFyZ3VtZW50cyB0byBpbnZva2UgdGhlIGZ1bmN0aW9uIHdpdGguDQogICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgdGltZXIgaWQuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uZGVmZXIoZnVuY3Rpb24odGV4dCkgew0KICAgICAqICAgY29uc29sZS5sb2codGV4dCk7DQogICAgICogfSwgJ2RlZmVycmVkJyk7DQogICAgICogLy8gbG9ncyAnZGVmZXJyZWQnIGFmdGVyIG9uZSBvciBtb3JlIG1pbGxpc2Vjb25kcw0KICAgICAqLw0KICAgIHZhciBkZWZlciA9IHJlc3RQYXJhbShmdW5jdGlvbihmdW5jLCBhcmdzKSB7DQogICAgICByZXR1cm4gYmFzZURlbGF5KGZ1bmMsIDEsIGFyZ3MpOw0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogSW52b2tlcyBgZnVuY2AgYWZ0ZXIgYHdhaXRgIG1pbGxpc2Vjb25kcy4gQW55IGFkZGl0aW9uYWwgYXJndW1lbnRzIGFyZQ0KICAgICAqIHByb3ZpZGVkIHRvIGBmdW5jYCB3aGVuIGl0IGlzIGludm9rZWQuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBkZWxheS4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gd2FpdCBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byBkZWxheSBpbnZvY2F0aW9uLg0KICAgICAqIEBwYXJhbSB7Li4uKn0gW2FyZ3NdIFRoZSBhcmd1bWVudHMgdG8gaW52b2tlIHRoZSBmdW5jdGlvbiB3aXRoLg0KICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHRpbWVyIGlkLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmRlbGF5KGZ1bmN0aW9uKHRleHQpIHsNCiAgICAgKiAgIGNvbnNvbGUubG9nKHRleHQpOw0KICAgICAqIH0sIDEwMDAsICdsYXRlcicpOw0KICAgICAqIC8vID0+IGxvZ3MgJ2xhdGVyJyBhZnRlciBvbmUgc2Vjb25kDQogICAgICovDQogICAgdmFyIGRlbGF5ID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGFyZ3MpIHsNCiAgICAgIHJldHVybiBiYXNlRGVsYXkoZnVuYywgd2FpdCwgYXJncyk7DQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSByZXN1bHQgb2YgaW52b2tpbmcgdGhlIHByb3ZpZGVkDQogICAgICogZnVuY3Rpb25zIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIHRoZSBjcmVhdGVkIGZ1bmN0aW9uLCB3aGVyZSBlYWNoDQogICAgICogc3VjY2Vzc2l2ZSBpbnZvY2F0aW9uIGlzIHN1cHBsaWVkIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIHByZXZpb3VzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uDQogICAgICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gW2Z1bmNzXSBGdW5jdGlvbnMgdG8gaW52b2tlLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBmdW5jdGlvbiBzcXVhcmUobikgew0KICAgICAqICAgcmV0dXJuIG4gKiBuOw0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIHZhciBhZGRTcXVhcmUgPSBfLmZsb3coXy5hZGQsIHNxdWFyZSk7DQogICAgICogYWRkU3F1YXJlKDEsIDIpOw0KICAgICAqIC8vID0+IDkNCiAgICAgKi8NCiAgICB2YXIgZmxvdyA9IGNyZWF0ZUZsb3coKTsNCg0KICAgIC8qKg0KICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uZmxvd2AgZXhjZXB0IHRoYXQgaXQgY3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQNCiAgICAgKiBpbnZva2VzIHRoZSBwcm92aWRlZCBmdW5jdGlvbnMgZnJvbSByaWdodCB0byBsZWZ0Lg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGFsaWFzIGJhY2tmbG93LCBjb21wb3NlDQogICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uDQogICAgICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gW2Z1bmNzXSBGdW5jdGlvbnMgdG8gaW52b2tlLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBmdW5jdGlvbiBzcXVhcmUobikgew0KICAgICAqICAgcmV0dXJuIG4gKiBuOw0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIHZhciBhZGRTcXVhcmUgPSBfLmZsb3dSaWdodChzcXVhcmUsIF8uYWRkKTsNCiAgICAgKiBhZGRTcXVhcmUoMSwgMik7DQogICAgICogLy8gPT4gOQ0KICAgICAqLw0KICAgIHZhciBmbG93UmlnaHQgPSBjcmVhdGVGbG93KHRydWUpOw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgbWVtb2l6ZXMgdGhlIHJlc3VsdCBvZiBgZnVuY2AuIElmIGByZXNvbHZlcmAgaXMNCiAgICAgKiBwcm92aWRlZCBpdCBkZXRlcm1pbmVzIHRoZSBjYWNoZSBrZXkgZm9yIHN0b3JpbmcgdGhlIHJlc3VsdCBiYXNlZCBvbiB0aGUNCiAgICAgKiBhcmd1bWVudHMgcHJvdmlkZWQgdG8gdGhlIG1lbW9pemVkIGZ1bmN0aW9uLiBCeSBkZWZhdWx0LCB0aGUgZmlyc3QgYXJndW1lbnQNCiAgICAgKiBwcm92aWRlZCB0byB0aGUgbWVtb2l6ZWQgZnVuY3Rpb24gaXMgY29lcmNlZCB0byBhIHN0cmluZyBhbmQgdXNlZCBhcyB0aGUNCiAgICAgKiBjYWNoZSBrZXkuIFRoZSBgZnVuY2AgaXMgaW52b2tlZCB3aXRoIHRoZSBgdGhpc2AgYmluZGluZyBvZiB0aGUgbWVtb2l6ZWQNCiAgICAgKiBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGUgY2FjaGUgaXMgZXhwb3NlZCBhcyB0aGUgYGNhY2hlYCBwcm9wZXJ0eSBvbiB0aGUgbWVtb2l6ZWQNCiAgICAgKiBmdW5jdGlvbi4gSXRzIGNyZWF0aW9uIG1heSBiZSBjdXN0b21pemVkIGJ5IHJlcGxhY2luZyB0aGUgYF8ubWVtb2l6ZS5DYWNoZWANCiAgICAgKiBjb25zdHJ1Y3RvciB3aXRoIG9uZSB3aG9zZSBpbnN0YW5jZXMgaW1wbGVtZW50IHRoZSBbYE1hcGBdKGh0dHBzOi8vcGVvcGxlLm1vemlsbGEub3JnL35qb3JlbmRvcmZmL2VzNi1kcmFmdC5odG1sI3NlYy1wcm9wZXJ0aWVzLW9mLXRoZS1tYXAtcHJvdG90eXBlLW9iamVjdCkNCiAgICAgKiBtZXRob2QgaW50ZXJmYWNlIG9mIGBnZXRgLCBgaGFzYCwgYW5kIGBzZXRgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gaGF2ZSBpdHMgb3V0cHV0IG1lbW9pemVkLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtyZXNvbHZlcl0gVGhlIGZ1bmN0aW9uIHRvIHJlc29sdmUgdGhlIGNhY2hlIGtleS4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBtZW1vaXppbmcgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciB1cHBlckNhc2UgPSBfLm1lbW9pemUoZnVuY3Rpb24oc3RyaW5nKSB7DQogICAgICogICByZXR1cm4gc3RyaW5nLnRvVXBwZXJDYXNlKCk7DQogICAgICogfSk7DQogICAgICoNCiAgICAgKiB1cHBlckNhc2UoJ2ZyZWQnKTsNCiAgICAgKiAvLyA9PiAnRlJFRCcNCiAgICAgKg0KICAgICAqIC8vIG1vZGlmeWluZyB0aGUgcmVzdWx0IGNhY2hlDQogICAgICogdXBwZXJDYXNlLmNhY2hlLnNldCgnZnJlZCcsICdCQVJORVknKTsNCiAgICAgKiB1cHBlckNhc2UoJ2ZyZWQnKTsNCiAgICAgKiAvLyA9PiAnQkFSTkVZJw0KICAgICAqDQogICAgICogLy8gcmVwbGFjaW5nIGBfLm1lbW9pemUuQ2FjaGVgDQogICAgICogdmFyIG9iamVjdCA9IHsgJ3VzZXInOiAnZnJlZCcgfTsNCiAgICAgKiB2YXIgb3RoZXIgPSB7ICd1c2VyJzogJ2Jhcm5leScgfTsNCiAgICAgKiB2YXIgaWRlbnRpdHkgPSBfLm1lbW9pemUoXy5pZGVudGl0eSk7DQogICAgICoNCiAgICAgKiBpZGVudGl0eShvYmplY3QpOw0KICAgICAqIC8vID0+IHsgJ3VzZXInOiAnZnJlZCcgfQ0KICAgICAqIGlkZW50aXR5KG90aGVyKTsNCiAgICAgKiAvLyA9PiB7ICd1c2VyJzogJ2ZyZWQnIH0NCiAgICAgKg0KICAgICAqIF8ubWVtb2l6ZS5DYWNoZSA9IFdlYWtNYXA7DQogICAgICogdmFyIGlkZW50aXR5ID0gXy5tZW1vaXplKF8uaWRlbnRpdHkpOw0KICAgICAqDQogICAgICogaWRlbnRpdHkob2JqZWN0KTsNCiAgICAgKiAvLyA9PiB7ICd1c2VyJzogJ2ZyZWQnIH0NCiAgICAgKiBpZGVudGl0eShvdGhlcik7DQogICAgICogLy8gPT4geyAndXNlcic6ICdiYXJuZXknIH0NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBtZW1vaXplKGZ1bmMsIHJlc29sdmVyKSB7DQogICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJyB8fCAocmVzb2x2ZXIgJiYgdHlwZW9mIHJlc29sdmVyICE9ICdmdW5jdGlvbicpKSB7DQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTsNCiAgICAgIH0NCiAgICAgIHZhciBtZW1vaXplZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cywNCiAgICAgICAgICAgIGtleSA9IHJlc29sdmVyID8gcmVzb2x2ZXIuYXBwbHkodGhpcywgYXJncykgOiBhcmdzWzBdLA0KICAgICAgICAgICAgY2FjaGUgPSBtZW1vaXplZC5jYWNoZTsNCg0KICAgICAgICBpZiAoY2FjaGUuaGFzKGtleSkpIHsNCiAgICAgICAgICByZXR1cm4gY2FjaGUuZ2V0KGtleSk7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpcywgYXJncyk7DQogICAgICAgIG1lbW9pemVkLmNhY2hlID0gY2FjaGUuc2V0KGtleSwgcmVzdWx0KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH07DQogICAgICBtZW1vaXplZC5jYWNoZSA9IG5ldyBtZW1vaXplLkNhY2hlOw0KICAgICAgcmV0dXJuIG1lbW9pemVkOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IG5lZ2F0ZXMgdGhlIHJlc3VsdCBvZiB0aGUgcHJlZGljYXRlIGBmdW5jYC4gVGhlDQogICAgICogYGZ1bmNgIHByZWRpY2F0ZSBpcyBpbnZva2VkIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIGFuZCBhcmd1bWVudHMgb2YgdGhlDQogICAgICogY3JlYXRlZCBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBGdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgcHJlZGljYXRlIHRvIG5lZ2F0ZS4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogZnVuY3Rpb24gaXNFdmVuKG4pIHsNCiAgICAgKiAgIHJldHVybiBuICUgMiA9PSAwOw0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIF8uZmlsdGVyKFsxLCAyLCAzLCA0LCA1LCA2XSwgXy5uZWdhdGUoaXNFdmVuKSk7DQogICAgICogLy8gPT4gWzEsIDMsIDVdDQogICAgICovDQogICAgZnVuY3Rpb24gbmVnYXRlKHByZWRpY2F0ZSkgew0KICAgICAgaWYgKHR5cGVvZiBwcmVkaWNhdGUgIT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7DQogICAgICB9DQogICAgICByZXR1cm4gZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiAhcHJlZGljYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGlzIHJlc3RyaWN0ZWQgdG8gaW52b2tpbmcgYGZ1bmNgIG9uY2UuIFJlcGVhdCBjYWxscw0KICAgICAqIHRvIHRoZSBmdW5jdGlvbiByZXR1cm4gdGhlIHZhbHVlIG9mIHRoZSBmaXJzdCBjYWxsLiBUaGUgYGZ1bmNgIGlzIGludm9rZWQNCiAgICAgKiB3aXRoIHRoZSBgdGhpc2AgYmluZGluZyBhbmQgYXJndW1lbnRzIG9mIHRoZSBjcmVhdGVkIGZ1bmN0aW9uLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gcmVzdHJpY3QuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgcmVzdHJpY3RlZCBmdW5jdGlvbi4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIGluaXRpYWxpemUgPSBfLm9uY2UoY3JlYXRlQXBwbGljYXRpb24pOw0KICAgICAqIGluaXRpYWxpemUoKTsNCiAgICAgKiBpbml0aWFsaXplKCk7DQogICAgICogLy8gYGluaXRpYWxpemVgIGludm9rZXMgYGNyZWF0ZUFwcGxpY2F0aW9uYCBvbmNlDQogICAgICovDQogICAgZnVuY3Rpb24gb25jZShmdW5jKSB7DQogICAgICByZXR1cm4gYmVmb3JlKDIsIGZ1bmMpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggYHBhcnRpYWxgIGFyZ3VtZW50cyBwcmVwZW5kZWQNCiAgICAgKiB0byB0aG9zZSBwcm92aWRlZCB0byB0aGUgbmV3IGZ1bmN0aW9uLiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmJpbmRgIGV4Y2VwdA0KICAgICAqIGl0IGRvZXMgKipub3QqKiBhbHRlciB0aGUgYHRoaXNgIGJpbmRpbmcuDQogICAgICoNCiAgICAgKiBUaGUgYF8ucGFydGlhbC5wbGFjZWhvbGRlcmAgdmFsdWUsIHdoaWNoIGRlZmF1bHRzIHRvIGBfYCBpbiBtb25vbGl0aGljDQogICAgICogYnVpbGRzLCBtYXkgYmUgdXNlZCBhcyBhIHBsYWNlaG9sZGVyIGZvciBwYXJ0aWFsbHkgYXBwbGllZCBhcmd1bWVudHMuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgZG9lcyBub3Qgc2V0IHRoZSAibGVuZ3RoIiBwcm9wZXJ0eSBvZiBwYXJ0aWFsbHkNCiAgICAgKiBhcHBsaWVkIGZ1bmN0aW9ucy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBGdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHBhcnRpYWxseSBhcHBseSBhcmd1bWVudHMgdG8uDQogICAgICogQHBhcmFtIHsuLi4qfSBbcGFydGlhbHNdIFRoZSBhcmd1bWVudHMgdG8gYmUgcGFydGlhbGx5IGFwcGxpZWQuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgcGFydGlhbGx5IGFwcGxpZWQgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBncmVldCA9IGZ1bmN0aW9uKGdyZWV0aW5nLCBuYW1lKSB7DQogICAgICogICByZXR1cm4gZ3JlZXRpbmcgKyAnICcgKyBuYW1lOw0KICAgICAqIH07DQogICAgICoNCiAgICAgKiB2YXIgc2F5SGVsbG9UbyA9IF8ucGFydGlhbChncmVldCwgJ2hlbGxvJyk7DQogICAgICogc2F5SGVsbG9UbygnZnJlZCcpOw0KICAgICAqIC8vID0+ICdoZWxsbyBmcmVkJw0KICAgICAqDQogICAgICogLy8gdXNpbmcgcGxhY2Vob2xkZXJzDQogICAgICogdmFyIGdyZWV0RnJlZCA9IF8ucGFydGlhbChncmVldCwgXywgJ2ZyZWQnKTsNCiAgICAgKiBncmVldEZyZWQoJ2hpJyk7DQogICAgICogLy8gPT4gJ2hpIGZyZWQnDQogICAgICovDQogICAgdmFyIHBhcnRpYWwgPSBjcmVhdGVQYXJ0aWFsKFBBUlRJQUxfRkxBRyk7DQoNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnBhcnRpYWxgIGV4Y2VwdCB0aGF0IHBhcnRpYWxseSBhcHBsaWVkIGFyZ3VtZW50cw0KICAgICAqIGFyZSBhcHBlbmRlZCB0byB0aG9zZSBwcm92aWRlZCB0byB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqDQogICAgICogVGhlIGBfLnBhcnRpYWxSaWdodC5wbGFjZWhvbGRlcmAgdmFsdWUsIHdoaWNoIGRlZmF1bHRzIHRvIGBfYCBpbiBtb25vbGl0aGljDQogICAgICogYnVpbGRzLCBtYXkgYmUgdXNlZCBhcyBhIHBsYWNlaG9sZGVyIGZvciBwYXJ0aWFsbHkgYXBwbGllZCBhcmd1bWVudHMuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgZG9lcyBub3Qgc2V0IHRoZSAibGVuZ3RoIiBwcm9wZXJ0eSBvZiBwYXJ0aWFsbHkNCiAgICAgKiBhcHBsaWVkIGZ1bmN0aW9ucy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBGdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHBhcnRpYWxseSBhcHBseSBhcmd1bWVudHMgdG8uDQogICAgICogQHBhcmFtIHsuLi4qfSBbcGFydGlhbHNdIFRoZSBhcmd1bWVudHMgdG8gYmUgcGFydGlhbGx5IGFwcGxpZWQuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgcGFydGlhbGx5IGFwcGxpZWQgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBncmVldCA9IGZ1bmN0aW9uKGdyZWV0aW5nLCBuYW1lKSB7DQogICAgICogICByZXR1cm4gZ3JlZXRpbmcgKyAnICcgKyBuYW1lOw0KICAgICAqIH07DQogICAgICoNCiAgICAgKiB2YXIgZ3JlZXRGcmVkID0gXy5wYXJ0aWFsUmlnaHQoZ3JlZXQsICdmcmVkJyk7DQogICAgICogZ3JlZXRGcmVkKCdoaScpOw0KICAgICAqIC8vID0+ICdoaSBmcmVkJw0KICAgICAqDQogICAgICogLy8gdXNpbmcgcGxhY2Vob2xkZXJzDQogICAgICogdmFyIHNheUhlbGxvVG8gPSBfLnBhcnRpYWxSaWdodChncmVldCwgJ2hlbGxvJywgXyk7DQogICAgICogc2F5SGVsbG9UbygnZnJlZCcpOw0KICAgICAqIC8vID0+ICdoZWxsbyBmcmVkJw0KICAgICAqLw0KICAgIHZhciBwYXJ0aWFsUmlnaHQgPSBjcmVhdGVQYXJ0aWFsKFBBUlRJQUxfUklHSFRfRkxBRyk7DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBpbnZva2VzIGBmdW5jYCB3aXRoIGFyZ3VtZW50cyBhcnJhbmdlZCBhY2NvcmRpbmcNCiAgICAgKiB0byB0aGUgc3BlY2lmaWVkIGluZGV4ZXMgd2hlcmUgdGhlIGFyZ3VtZW50IHZhbHVlIGF0IHRoZSBmaXJzdCBpbmRleCBpcw0KICAgICAqIHByb3ZpZGVkIGFzIHRoZSBmaXJzdCBhcmd1bWVudCwgdGhlIGFyZ3VtZW50IHZhbHVlIGF0IHRoZSBzZWNvbmQgaW5kZXggaXMNCiAgICAgKiBwcm92aWRlZCBhcyB0aGUgc2Vjb25kIGFyZ3VtZW50LCBhbmQgc28gb24uDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byByZWFycmFuZ2UgYXJndW1lbnRzIGZvci4NCiAgICAgKiBAcGFyYW0gey4uLihudW1iZXJ8bnVtYmVyW10pfSBpbmRleGVzIFRoZSBhcnJhbmdlZCBhcmd1bWVudCBpbmRleGVzLA0KICAgICAqICBzcGVjaWZpZWQgYXMgaW5kaXZpZHVhbCBpbmRleGVzIG9yIGFycmF5cyBvZiBpbmRleGVzLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgcmVhcmdlZCA9IF8ucmVhcmcoZnVuY3Rpb24oYSwgYiwgYykgew0KICAgICAqICAgcmV0dXJuIFthLCBiLCBjXTsNCiAgICAgKiB9LCAyLCAwLCAxKTsNCiAgICAgKg0KICAgICAqIHJlYXJnZWQoJ2InLCAnYycsICdhJykNCiAgICAgKiAvLyA9PiBbJ2EnLCAnYicsICdjJ10NCiAgICAgKg0KICAgICAqIHZhciBtYXAgPSBfLnJlYXJnKF8ubWFwLCBbMSwgMF0pOw0KICAgICAqIG1hcChmdW5jdGlvbihuKSB7DQogICAgICogICByZXR1cm4gbiAqIDM7DQogICAgICogfSwgWzEsIDIsIDNdKTsNCiAgICAgKiAvLyA9PiBbMywgNiwgOV0NCiAgICAgKi8NCiAgICB2YXIgcmVhcmcgPSByZXN0UGFyYW0oZnVuY3Rpb24oZnVuYywgaW5kZXhlcykgew0KICAgICAgcmV0dXJuIGNyZWF0ZVdyYXBwZXIoZnVuYywgUkVBUkdfRkxBRywgbnVsbCwgbnVsbCwgbnVsbCwgYmFzZUZsYXR0ZW4oaW5kZXhlcykpOw0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCB0aGUgYHRoaXNgIGJpbmRpbmcgb2YgdGhlDQogICAgICogY3JlYXRlZCBmdW5jdGlvbiBhbmQgYXJndW1lbnRzIGZyb20gYHN0YXJ0YCBhbmQgYmV5b25kIHByb3ZpZGVkIGFzIGFuIGFycmF5Lg0KICAgICAqDQogICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGJhc2VkIG9uIHRoZSBbcmVzdCBwYXJhbWV0ZXJdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0Z1bmN0aW9ucy9yZXN0X3BhcmFtZXRlcnMpLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgYSByZXN0IHBhcmFtZXRlciB0by4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PWZ1bmMubGVuZ3RoLTFdIFRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgcmVzdCBwYXJhbWV0ZXIuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBzYXkgPSBfLnJlc3RQYXJhbShmdW5jdGlvbih3aGF0LCBuYW1lcykgew0KICAgICAqICAgcmV0dXJuIHdoYXQgKyAnICcgKyBfLmluaXRpYWwobmFtZXMpLmpvaW4oJywgJykgKw0KICAgICAqICAgICAoXy5zaXplKG5hbWVzKSA+IDEgPyAnLCAmICcgOiAnJykgKyBfLmxhc3QobmFtZXMpOw0KICAgICAqIH0pOw0KICAgICAqDQogICAgICogc2F5KCdoZWxsbycsICdmcmVkJywgJ2Jhcm5leScsICdwZWJibGVzJyk7DQogICAgICogLy8gPT4gJ2hlbGxvIGZyZWQsIGJhcm5leSwgJiBwZWJibGVzJw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlc3RQYXJhbShmdW5jLCBzdGFydCkgew0KICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsNCiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOw0KICAgICAgfQ0KICAgICAgc3RhcnQgPSBuYXRpdmVNYXgoc3RhcnQgPT09IHVuZGVmaW5lZCA/IChmdW5jLmxlbmd0aCAtIDEpIDogKCtzdGFydCB8fCAwKSwgMCk7DQogICAgICByZXR1cm4gZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgICAgICAgaW5kZXggPSAtMSwNCiAgICAgICAgICAgIGxlbmd0aCA9IG5hdGl2ZU1heChhcmdzLmxlbmd0aCAtIHN0YXJ0LCAwKSwNCiAgICAgICAgICAgIHJlc3QgPSBBcnJheShsZW5ndGgpOw0KDQogICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgICAgcmVzdFtpbmRleF0gPSBhcmdzW3N0YXJ0ICsgaW5kZXhdOw0KICAgICAgICB9DQogICAgICAgIHN3aXRjaCAoc3RhcnQpIHsNCiAgICAgICAgICBjYXNlIDA6IHJldHVybiBmdW5jLmNhbGwodGhpcywgcmVzdCk7DQogICAgICAgICAgY2FzZSAxOiByZXR1cm4gZnVuYy5jYWxsKHRoaXMsIGFyZ3NbMF0sIHJlc3QpOw0KICAgICAgICAgIGNhc2UgMjogcmV0dXJuIGZ1bmMuY2FsbCh0aGlzLCBhcmdzWzBdLCBhcmdzWzFdLCByZXN0KTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgb3RoZXJBcmdzID0gQXJyYXkoc3RhcnQgKyAxKTsNCiAgICAgICAgaW5kZXggPSAtMTsNCiAgICAgICAgd2hpbGUgKCsraW5kZXggPCBzdGFydCkgew0KICAgICAgICAgIG90aGVyQXJnc1tpbmRleF0gPSBhcmdzW2luZGV4XTsNCiAgICAgICAgfQ0KICAgICAgICBvdGhlckFyZ3Nbc3RhcnRdID0gcmVzdDsNCiAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgb3RoZXJBcmdzKTsNCiAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCB0aGUgYHRoaXNgIGJpbmRpbmcgb2YgdGhlIGNyZWF0ZWQNCiAgICAgKiBmdW5jdGlvbiBhbmQgYW4gYXJyYXkgb2YgYXJndW1lbnRzIG11Y2ggbGlrZSBbYEZ1bmN0aW9uI2FwcGx5YF0oaHR0cHM6Ly9lczUuZ2l0aHViLmlvLyN4MTUuMy40LjMpLg0KICAgICAqDQogICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGJhc2VkIG9uIHRoZSBbc3ByZWFkIG9wZXJhdG9yXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9PcGVyYXRvcnMvU3ByZWFkX29wZXJhdG9yKS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBGdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHNwcmVhZCBhcmd1bWVudHMgb3Zlci4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIHNheSA9IF8uc3ByZWFkKGZ1bmN0aW9uKHdobywgd2hhdCkgew0KICAgICAqICAgcmV0dXJuIHdobyArICcgc2F5cyAnICsgd2hhdDsNCiAgICAgKiB9KTsNCiAgICAgKg0KICAgICAqIHNheShbJ2ZyZWQnLCAnaGVsbG8nXSk7DQogICAgICogLy8gPT4gJ2ZyZWQgc2F5cyBoZWxsbycNCiAgICAgKg0KICAgICAqIC8vIHdpdGggYSBQcm9taXNlDQogICAgICogdmFyIG51bWJlcnMgPSBQcm9taXNlLmFsbChbDQogICAgICogICBQcm9taXNlLnJlc29sdmUoNDApLA0KICAgICAqICAgUHJvbWlzZS5yZXNvbHZlKDM2KQ0KICAgICAqIF0pOw0KICAgICAqDQogICAgICogbnVtYmVycy50aGVuKF8uc3ByZWFkKGZ1bmN0aW9uKHgsIHkpIHsNCiAgICAgKiAgIHJldHVybiB4ICsgeTsNCiAgICAgKiB9KSk7DQogICAgICogLy8gPT4gYSBQcm9taXNlIG9mIDc2DQogICAgICovDQogICAgZnVuY3Rpb24gc3ByZWFkKGZ1bmMpIHsNCiAgICAgIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7DQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBmdW5jdGlvbihhcnJheSkgew0KICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcnJheSk7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSB0aHJvdHRsZWQgZnVuY3Rpb24gdGhhdCBvbmx5IGludm9rZXMgYGZ1bmNgIGF0IG1vc3Qgb25jZSBwZXINCiAgICAgKiBldmVyeSBgd2FpdGAgbWlsbGlzZWNvbmRzLiBUaGUgdGhyb3R0bGVkIGZ1bmN0aW9uIGNvbWVzIHdpdGggYSBgY2FuY2VsYA0KICAgICAqIG1ldGhvZCB0byBjYW5jZWwgZGVsYXllZCBpbnZvY2F0aW9ucy4gUHJvdmlkZSBhbiBvcHRpb25zIG9iamVjdCB0byBpbmRpY2F0ZQ0KICAgICAqIHRoYXQgYGZ1bmNgIHNob3VsZCBiZSBpbnZva2VkIG9uIHRoZSBsZWFkaW5nIGFuZC9vciB0cmFpbGluZyBlZGdlIG9mIHRoZQ0KICAgICAqIGB3YWl0YCB0aW1lb3V0LiBTdWJzZXF1ZW50IGNhbGxzIHRvIHRoZSB0aHJvdHRsZWQgZnVuY3Rpb24gcmV0dXJuIHRoZQ0KICAgICAqIHJlc3VsdCBvZiB0aGUgbGFzdCBgZnVuY2AgY2FsbC4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBJZiBgbGVhZGluZ2AgYW5kIGB0cmFpbGluZ2Agb3B0aW9ucyBhcmUgYHRydWVgLCBgZnVuY2AgaXMgaW52b2tlZA0KICAgICAqIG9uIHRoZSB0cmFpbGluZyBlZGdlIG9mIHRoZSB0aW1lb3V0IG9ubHkgaWYgdGhlIHRoZSB0aHJvdHRsZWQgZnVuY3Rpb24gaXMNCiAgICAgKiBpbnZva2VkIG1vcmUgdGhhbiBvbmNlIGR1cmluZyB0aGUgYHdhaXRgIHRpbWVvdXQuDQogICAgICoNCiAgICAgKiBTZWUgW0RhdmlkIENvcmJhY2hvJ3MgYXJ0aWNsZV0oaHR0cDovL2RydXBhbG1vdGlvbi5jb20vYXJ0aWNsZS9kZWJvdW5jZS1hbmQtdGhyb3R0bGUtdmlzdWFsLWV4cGxhbmF0aW9uKQ0KICAgICAqIGZvciBkZXRhaWxzIG92ZXIgdGhlIGRpZmZlcmVuY2VzIGJldHdlZW4gYF8udGhyb3R0bGVgIGFuZCBgXy5kZWJvdW5jZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byB0aHJvdHRsZS4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3dhaXQ9MF0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gdGhyb3R0bGUgaW52b2NhdGlvbnMgdG8uDQogICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBUaGUgb3B0aW9ucyBvYmplY3QuDQogICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5sZWFkaW5nPXRydWVdIFNwZWNpZnkgaW52b2tpbmcgb24gdGhlIGxlYWRpbmcNCiAgICAgKiAgZWRnZSBvZiB0aGUgdGltZW91dC4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLnRyYWlsaW5nPXRydWVdIFNwZWNpZnkgaW52b2tpbmcgb24gdGhlIHRyYWlsaW5nDQogICAgICogIGVkZ2Ugb2YgdGhlIHRpbWVvdXQuDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgdGhyb3R0bGVkIGZ1bmN0aW9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiAvLyBhdm9pZCBleGNlc3NpdmVseSB1cGRhdGluZyB0aGUgcG9zaXRpb24gd2hpbGUgc2Nyb2xsaW5nDQogICAgICogalF1ZXJ5KHdpbmRvdykub24oJ3Njcm9sbCcsIF8udGhyb3R0bGUodXBkYXRlUG9zaXRpb24sIDEwMCkpOw0KICAgICAqDQogICAgICogLy8gaW52b2tlIGByZW5ld1Rva2VuYCB3aGVuIHRoZSBjbGljayBldmVudCBpcyBmaXJlZCwgYnV0IG5vdCBtb3JlIHRoYW4gb25jZSBldmVyeSA1IG1pbnV0ZXMNCiAgICAgKiBqUXVlcnkoJy5pbnRlcmFjdGl2ZScpLm9uKCdjbGljaycsIF8udGhyb3R0bGUocmVuZXdUb2tlbiwgMzAwMDAwLCB7DQogICAgICogICAndHJhaWxpbmcnOiBmYWxzZQ0KICAgICAqIH0pKTsNCiAgICAgKg0KICAgICAqIC8vIGNhbmNlbCBhIHRyYWlsaW5nIHRocm90dGxlZCBjYWxsDQogICAgICogalF1ZXJ5KHdpbmRvdykub24oJ3BvcHN0YXRlJywgdGhyb3R0bGVkLmNhbmNlbCk7DQogICAgICovDQogICAgZnVuY3Rpb24gdGhyb3R0bGUoZnVuYywgd2FpdCwgb3B0aW9ucykgew0KICAgICAgdmFyIGxlYWRpbmcgPSB0cnVlLA0KICAgICAgICAgIHRyYWlsaW5nID0gdHJ1ZTsNCg0KICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsNCiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOw0KICAgICAgfQ0KICAgICAgaWYgKG9wdGlvbnMgPT09IGZhbHNlKSB7DQogICAgICAgIGxlYWRpbmcgPSBmYWxzZTsNCiAgICAgIH0gZWxzZSBpZiAoaXNPYmplY3Qob3B0aW9ucykpIHsNCiAgICAgICAgbGVhZGluZyA9ICdsZWFkaW5nJyBpbiBvcHRpb25zID8gISFvcHRpb25zLmxlYWRpbmcgOiBsZWFkaW5nOw0KICAgICAgICB0cmFpbGluZyA9ICd0cmFpbGluZycgaW4gb3B0aW9ucyA/ICEhb3B0aW9ucy50cmFpbGluZyA6IHRyYWlsaW5nOw0KICAgICAgfQ0KICAgICAgZGVib3VuY2VPcHRpb25zLmxlYWRpbmcgPSBsZWFkaW5nOw0KICAgICAgZGVib3VuY2VPcHRpb25zLm1heFdhaXQgPSArd2FpdDsNCiAgICAgIGRlYm91bmNlT3B0aW9ucy50cmFpbGluZyA9IHRyYWlsaW5nOw0KICAgICAgcmV0dXJuIGRlYm91bmNlKGZ1bmMsIHdhaXQsIGRlYm91bmNlT3B0aW9ucyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcHJvdmlkZXMgYHZhbHVlYCB0byB0aGUgd3JhcHBlciBmdW5jdGlvbiBhcyBpdHMNCiAgICAgKiBmaXJzdCBhcmd1bWVudC4gQW55IGFkZGl0aW9uYWwgYXJndW1lbnRzIHByb3ZpZGVkIHRvIHRoZSBmdW5jdGlvbiBhcmUNCiAgICAgKiBhcHBlbmRlZCB0byB0aG9zZSBwcm92aWRlZCB0byB0aGUgd3JhcHBlciBmdW5jdGlvbi4gVGhlIHdyYXBwZXIgaXMgaW52b2tlZA0KICAgICAqIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIHRoZSBjcmVhdGVkIGZ1bmN0aW9uLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gd3JhcC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSB3cmFwcGVyIFRoZSB3cmFwcGVyIGZ1bmN0aW9uLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgcCA9IF8ud3JhcChfLmVzY2FwZSwgZnVuY3Rpb24oZnVuYywgdGV4dCkgew0KICAgICAqICAgcmV0dXJuICc8cD4nICsgZnVuYyh0ZXh0KSArICc8L3A+JzsNCiAgICAgKiB9KTsNCiAgICAgKg0KICAgICAqIHAoJ2ZyZWQsIGJhcm5leSwgJiBwZWJibGVzJyk7DQogICAgICogLy8gPT4gJzxwPmZyZWQsIGJhcm5leSwgJmFtcDsgcGViYmxlczwvcD4nDQogICAgICovDQogICAgZnVuY3Rpb24gd3JhcCh2YWx1ZSwgd3JhcHBlcikgew0KICAgICAgd3JhcHBlciA9IHdyYXBwZXIgPT0gbnVsbCA/IGlkZW50aXR5IDogd3JhcHBlcjsNCiAgICAgIHJldHVybiBjcmVhdGVXcmFwcGVyKHdyYXBwZXIsIFBBUlRJQUxfRkxBRywgbnVsbCwgW3ZhbHVlXSwgW10pOw0KICAgIH0NCg0KICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgdmFsdWVgLiBJZiBgaXNEZWVwYCBpcyBgdHJ1ZWAgbmVzdGVkIG9iamVjdHMgYXJlIGNsb25lZCwNCiAgICAgKiBvdGhlcndpc2UgdGhleSBhcmUgYXNzaWduZWQgYnkgcmVmZXJlbmNlLiBJZiBgY3VzdG9taXplcmAgaXMgcHJvdmlkZWQgaXQgaXMNCiAgICAgKiBpbnZva2VkIHRvIHByb2R1Y2UgdGhlIGNsb25lZCB2YWx1ZXMuIElmIGBjdXN0b21pemVyYCByZXR1cm5zIGB1bmRlZmluZWRgDQogICAgICogY2xvbmluZyBpcyBoYW5kbGVkIGJ5IHRoZSBtZXRob2QgaW5zdGVhZC4gVGhlIGBjdXN0b21pemVyYCBpcyBib3VuZCB0bw0KICAgICAqIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHR3byBhcmd1bWVudDsgKHZhbHVlIFssIGluZGV4fGtleSwgb2JqZWN0XSkuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgbG9vc2VseSBiYXNlZCBvbiB0aGUNCiAgICAgKiBbc3RydWN0dXJlZCBjbG9uZSBhbGdvcml0aG1dKGh0dHA6Ly93d3cudzMub3JnL1RSL2h0bWw1L2luZnJhc3RydWN0dXJlLmh0bWwjaW50ZXJuYWwtc3RydWN0dXJlZC1jbG9uaW5nLWFsZ29yaXRobSkuDQogICAgICogVGhlIGVudW1lcmFibGUgcHJvcGVydGllcyBvZiBgYXJndW1lbnRzYCBvYmplY3RzIGFuZCBvYmplY3RzIGNyZWF0ZWQgYnkNCiAgICAgKiBjb25zdHJ1Y3RvcnMgb3RoZXIgdGhhbiBgT2JqZWN0YCBhcmUgY2xvbmVkIHRvIHBsYWluIGBPYmplY3RgIG9iamVjdHMuIEFuDQogICAgICogZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkIGZvciB1bmNsb25lYWJsZSB2YWx1ZXMgc3VjaCBhcyBmdW5jdGlvbnMsIERPTSBub2RlcywNCiAgICAgKiBNYXBzLCBTZXRzLCBhbmQgV2Vha01hcHMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNsb25lLg0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRGVlcF0gU3BlY2lmeSBhIGRlZXAgY2xvbmUuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY2xvbmluZyB2YWx1ZXMuDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjdXN0b21pemVyYC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgY2xvbmVkIHZhbHVlLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSBbDQogICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScgfSwNCiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcgfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiB2YXIgc2hhbGxvdyA9IF8uY2xvbmUodXNlcnMpOw0KICAgICAqIHNoYWxsb3dbMF0gPT09IHVzZXJzWzBdOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIHZhciBkZWVwID0gXy5jbG9uZSh1c2VycywgdHJ1ZSk7DQogICAgICogZGVlcFswXSA9PT0gdXNlcnNbMF07DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIGEgY3VzdG9taXplciBjYWxsYmFjaw0KICAgICAqIHZhciBlbCA9IF8uY2xvbmUoZG9jdW1lbnQuYm9keSwgZnVuY3Rpb24odmFsdWUpIHsNCiAgICAgKiAgIGlmIChfLmlzRWxlbWVudCh2YWx1ZSkpIHsNCiAgICAgKiAgICAgcmV0dXJuIHZhbHVlLmNsb25lTm9kZShmYWxzZSk7DQogICAgICogICB9DQogICAgICogfSk7DQogICAgICoNCiAgICAgKiBlbCA9PT0gZG9jdW1lbnQuYm9keQ0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICogZWwubm9kZU5hbWUNCiAgICAgKiAvLyA9PiBCT0RZDQogICAgICogZWwuY2hpbGROb2Rlcy5sZW5ndGg7DQogICAgICogLy8gPT4gMA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNsb25lKHZhbHVlLCBpc0RlZXAsIGN1c3RvbWl6ZXIsIHRoaXNBcmcpIHsNCiAgICAgIGlmIChpc0RlZXAgJiYgdHlwZW9mIGlzRGVlcCAhPSAnYm9vbGVhbicgJiYgaXNJdGVyYXRlZUNhbGwodmFsdWUsIGlzRGVlcCwgY3VzdG9taXplcikpIHsNCiAgICAgICAgaXNEZWVwID0gZmFsc2U7DQogICAgICB9DQogICAgICBlbHNlIGlmICh0eXBlb2YgaXNEZWVwID09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgdGhpc0FyZyA9IGN1c3RvbWl6ZXI7DQogICAgICAgIGN1c3RvbWl6ZXIgPSBpc0RlZXA7DQogICAgICAgIGlzRGVlcCA9IGZhbHNlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicNCiAgICAgICAgPyBiYXNlQ2xvbmUodmFsdWUsIGlzRGVlcCwgYmluZENhbGxiYWNrKGN1c3RvbWl6ZXIsIHRoaXNBcmcsIDEpKQ0KICAgICAgICA6IGJhc2VDbG9uZSh2YWx1ZSwgaXNEZWVwKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgZGVlcCBjbG9uZSBvZiBgdmFsdWVgLiBJZiBgY3VzdG9taXplcmAgaXMgcHJvdmlkZWQgaXQgaXMgaW52b2tlZA0KICAgICAqIHRvIHByb2R1Y2UgdGhlIGNsb25lZCB2YWx1ZXMuIElmIGBjdXN0b21pemVyYCByZXR1cm5zIGB1bmRlZmluZWRgIGNsb25pbmcNCiAgICAgKiBpcyBoYW5kbGVkIGJ5IHRoZSBtZXRob2QgaW5zdGVhZC4gVGhlIGBjdXN0b21pemVyYCBpcyBib3VuZCB0byBgdGhpc0FyZ2ANCiAgICAgKiBhbmQgaW52b2tlZCB3aXRoIHR3byBhcmd1bWVudDsgKHZhbHVlIFssIGluZGV4fGtleSwgb2JqZWN0XSkuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgbG9vc2VseSBiYXNlZCBvbiB0aGUNCiAgICAgKiBbc3RydWN0dXJlZCBjbG9uZSBhbGdvcml0aG1dKGh0dHA6Ly93d3cudzMub3JnL1RSL2h0bWw1L2luZnJhc3RydWN0dXJlLmh0bWwjaW50ZXJuYWwtc3RydWN0dXJlZC1jbG9uaW5nLWFsZ29yaXRobSkuDQogICAgICogVGhlIGVudW1lcmFibGUgcHJvcGVydGllcyBvZiBgYXJndW1lbnRzYCBvYmplY3RzIGFuZCBvYmplY3RzIGNyZWF0ZWQgYnkNCiAgICAgKiBjb25zdHJ1Y3RvcnMgb3RoZXIgdGhhbiBgT2JqZWN0YCBhcmUgY2xvbmVkIHRvIHBsYWluIGBPYmplY3RgIG9iamVjdHMuIEFuDQogICAgICogZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkIGZvciB1bmNsb25lYWJsZSB2YWx1ZXMgc3VjaCBhcyBmdW5jdGlvbnMsIERPTSBub2RlcywNCiAgICAgKiBNYXBzLCBTZXRzLCBhbmQgV2Vha01hcHMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGRlZXAgY2xvbmUuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY2xvbmluZyB2YWx1ZXMuDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjdXN0b21pemVyYC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZGVlcCBjbG9uZWQgdmFsdWUuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciB1c2VycyA9IFsNCiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JyB9LA0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJyB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIHZhciBkZWVwID0gXy5jbG9uZURlZXAodXNlcnMpOw0KICAgICAqIGRlZXBbMF0gPT09IHVzZXJzWzBdOw0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICoNCiAgICAgKiAvLyB1c2luZyBhIGN1c3RvbWl6ZXIgY2FsbGJhY2sNCiAgICAgKiB2YXIgZWwgPSBfLmNsb25lRGVlcChkb2N1bWVudC5ib2R5LCBmdW5jdGlvbih2YWx1ZSkgew0KICAgICAqICAgaWYgKF8uaXNFbGVtZW50KHZhbHVlKSkgew0KICAgICAqICAgICByZXR1cm4gdmFsdWUuY2xvbmVOb2RlKHRydWUpOw0KICAgICAqICAgfQ0KICAgICAqIH0pOw0KICAgICAqDQogICAgICogZWwgPT09IGRvY3VtZW50LmJvZHkNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqIGVsLm5vZGVOYW1lDQogICAgICogLy8gPT4gQk9EWQ0KICAgICAqIGVsLmNoaWxkTm9kZXMubGVuZ3RoOw0KICAgICAqIC8vID0+IDIwDQogICAgICovDQogICAgZnVuY3Rpb24gY2xvbmVEZWVwKHZhbHVlLCBjdXN0b21pemVyLCB0aGlzQXJnKSB7DQogICAgICByZXR1cm4gdHlwZW9mIGN1c3RvbWl6ZXIgPT0gJ2Z1bmN0aW9uJw0KICAgICAgICA/IGJhc2VDbG9uZSh2YWx1ZSwgdHJ1ZSwgYmluZENhbGxiYWNrKGN1c3RvbWl6ZXIsIHRoaXNBcmcsIDEpKQ0KICAgICAgICA6IGJhc2VDbG9uZSh2YWx1ZSwgdHJ1ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgZ3JlYXRlciB0aGFuIGBvdGhlcmAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuDQogICAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBncmVhdGVyIHRoYW4gYG90aGVyYCwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmd0KDMsIDEpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uZ3QoMywgMyk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKg0KICAgICAqIF8uZ3QoMSwgMyk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBndCh2YWx1ZSwgb3RoZXIpIHsNCiAgICAgIHJldHVybiB2YWx1ZSA+IG90aGVyOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byBgb3RoZXJgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IExhbmcNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLg0KICAgICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIGBvdGhlcmAsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5ndGUoMywgMSk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5ndGUoMywgMyk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5ndGUoMSwgMyk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBndGUodmFsdWUsIG90aGVyKSB7DQogICAgICByZXR1cm4gdmFsdWUgPj0gb3RoZXI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhbiBgYXJndW1lbnRzYCBvYmplY3QuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGNvcnJlY3RseSBjbGFzc2lmaWVkLCBlbHNlIGBmYWxzZWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uaXNBcmd1bWVudHMoZnVuY3Rpb24oKSB7IHJldHVybiBhcmd1bWVudHM7IH0oKSk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5pc0FyZ3VtZW50cyhbMSwgMiwgM10pOw0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICovDQogICAgZnVuY3Rpb24gaXNBcmd1bWVudHModmFsdWUpIHsNCiAgICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGlzQXJyYXlMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBhcmdzVGFnOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYW4gYEFycmF5YCBvYmplY3QuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGNvcnJlY3RseSBjbGFzc2lmaWVkLCBlbHNlIGBmYWxzZWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uaXNBcnJheShbMSwgMiwgM10pOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNBcnJheShmdW5jdGlvbigpIHsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqLw0KICAgIHZhciBpc0FycmF5ID0gbmF0aXZlSXNBcnJheSB8fCBmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBhcnJheVRhZzsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGJvb2xlYW4gcHJpbWl0aXZlIG9yIG9iamVjdC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBMYW5nDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgY29ycmVjdGx5IGNsYXNzaWZpZWQsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pc0Jvb2xlYW4oZmFsc2UpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNCb29sZWFuKG51bGwpOw0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICovDQogICAgZnVuY3Rpb24gaXNCb29sZWFuKHZhbHVlKSB7DQogICAgICByZXR1cm4gdmFsdWUgPT09IHRydWUgfHwgdmFsdWUgPT09IGZhbHNlIHx8IChpc09iamVjdExpa2UodmFsdWUpICYmIG9ialRvU3RyaW5nLmNhbGwodmFsdWUpID09IGJvb2xUYWcpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgRGF0ZWAgb2JqZWN0Lg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IExhbmcNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBjb3JyZWN0bHkgY2xhc3NpZmllZCwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmlzRGF0ZShuZXcgRGF0ZSk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5pc0RhdGUoJ01vbiBBcHJpbCAyMyAyMDEyJyk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc0RhdGUodmFsdWUpIHsNCiAgICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIG9ialRvU3RyaW5nLmNhbGwodmFsdWUpID09IGRhdGVUYWc7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBET00gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBMYW5nDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBET00gZWxlbWVudCwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmlzRWxlbWVudChkb2N1bWVudC5ib2R5KTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiBfLmlzRWxlbWVudCgnPGJvZHk+Jyk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc0VsZW1lbnQodmFsdWUpIHsNCiAgICAgIHJldHVybiAhIXZhbHVlICYmIHZhbHVlLm5vZGVUeXBlID09PSAxICYmIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYNCiAgICAgICAgKG9ialRvU3RyaW5nLmNhbGwodmFsdWUpLmluZGV4T2YoJ0VsZW1lbnQnKSA+IC0xKTsNCiAgICB9DQogICAgLy8gRmFsbGJhY2sgZm9yIGVudmlyb25tZW50cyB3aXRob3V0IERPTSBzdXBwb3J0Lg0KICAgIGlmICghc3VwcG9ydC5kb20pIHsNCiAgICAgIGlzRWxlbWVudCA9IGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICAgIHJldHVybiAhIXZhbHVlICYmIHZhbHVlLm5vZGVUeXBlID09PSAxICYmIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgIWlzUGxhaW5PYmplY3QodmFsdWUpOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBlbXB0eS4gQSB2YWx1ZSBpcyBjb25zaWRlcmVkIGVtcHR5IHVubGVzcyBpdCBpcyBhbg0KICAgICAqIGBhcmd1bWVudHNgIG9iamVjdCwgYXJyYXksIHN0cmluZywgb3IgalF1ZXJ5LWxpa2UgY29sbGVjdGlvbiB3aXRoIGEgbGVuZ3RoDQogICAgICogZ3JlYXRlciB0aGFuIGAwYCBvciBhbiBvYmplY3Qgd2l0aCBvd24gZW51bWVyYWJsZSBwcm9wZXJ0aWVzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IExhbmcNCiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxzdHJpbmd9IHZhbHVlIFRoZSB2YWx1ZSB0byBpbnNwZWN0Lg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGVtcHR5LCBlbHNlIGBmYWxzZWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uaXNFbXB0eShudWxsKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiBfLmlzRW1wdHkodHJ1ZSk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5pc0VtcHR5KDEpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNFbXB0eShbMSwgMiwgM10pOw0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICoNCiAgICAgKiBfLmlzRW1wdHkoeyAnYSc6IDEgfSk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc0VtcHR5KHZhbHVlKSB7DQogICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmIChpc0FycmF5TGlrZSh2YWx1ZSkgJiYgKGlzQXJyYXkodmFsdWUpIHx8IGlzU3RyaW5nKHZhbHVlKSB8fCBpc0FyZ3VtZW50cyh2YWx1ZSkgfHwNCiAgICAgICAgICAoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBpc0Z1bmN0aW9uKHZhbHVlLnNwbGljZSkpKSkgew0KICAgICAgICByZXR1cm4gIXZhbHVlLmxlbmd0aDsNCiAgICAgIH0NCiAgICAgIHJldHVybiAha2V5cyh2YWx1ZSkubGVuZ3RoOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFBlcmZvcm1zIGEgZGVlcCBjb21wYXJpc29uIGJldHdlZW4gdHdvIHZhbHVlcyB0byBkZXRlcm1pbmUgaWYgdGhleSBhcmUNCiAgICAgKiBlcXVpdmFsZW50LiBJZiBgY3VzdG9taXplcmAgaXMgcHJvdmlkZWQgaXQgaXMgaW52b2tlZCB0byBjb21wYXJlIHZhbHVlcy4NCiAgICAgKiBJZiBgY3VzdG9taXplcmAgcmV0dXJucyBgdW5kZWZpbmVkYCBjb21wYXJpc29ucyBhcmUgaGFuZGxlZCBieSB0aGUgbWV0aG9kDQogICAgICogaW5zdGVhZC4gVGhlIGBjdXN0b21pemVyYCBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZQ0KICAgICAqIGFyZ3VtZW50czogKHZhbHVlLCBvdGhlciBbLCBpbmRleHxrZXldKS4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBzdXBwb3J0cyBjb21wYXJpbmcgYXJyYXlzLCBib29sZWFucywgYERhdGVgIG9iamVjdHMsDQogICAgICogbnVtYmVycywgYE9iamVjdGAgb2JqZWN0cywgcmVnZXhlcywgYW5kIHN0cmluZ3MuIE9iamVjdHMgYXJlIGNvbXBhcmVkIGJ5DQogICAgICogdGhlaXIgb3duLCBub3QgaW5oZXJpdGVkLCBlbnVtZXJhYmxlIHByb3BlcnRpZXMuIEZ1bmN0aW9ucyBhbmQgRE9NIG5vZGVzDQogICAgICogYXJlICoqbm90Kiogc3VwcG9ydGVkLiBQcm92aWRlIGEgY3VzdG9taXplciBmdW5jdGlvbiB0byBleHRlbmQgc3VwcG9ydA0KICAgICAqIGZvciBjb21wYXJpbmcgb3RoZXIgdmFsdWVzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGFsaWFzIGVxDQogICAgICogQGNhdGVnb3J5IExhbmcNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLg0KICAgICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgdmFsdWUgY29tcGFyaXNvbnMuDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjdXN0b21pemVyYC4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHZhbHVlcyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgb2JqZWN0ID0geyAndXNlcic6ICdmcmVkJyB9Ow0KICAgICAqIHZhciBvdGhlciA9IHsgJ3VzZXInOiAnZnJlZCcgfTsNCiAgICAgKg0KICAgICAqIG9iamVjdCA9PSBvdGhlcjsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqDQogICAgICogXy5pc0VxdWFsKG9iamVjdCwgb3RoZXIpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIGEgY3VzdG9taXplciBjYWxsYmFjaw0KICAgICAqIHZhciBhcnJheSA9IFsnaGVsbG8nLCAnZ29vZGJ5ZSddOw0KICAgICAqIHZhciBvdGhlciA9IFsnaGknLCAnZ29vZGJ5ZSddOw0KICAgICAqDQogICAgICogXy5pc0VxdWFsKGFycmF5LCBvdGhlciwgZnVuY3Rpb24odmFsdWUsIG90aGVyKSB7DQogICAgICogICBpZiAoXy5ldmVyeShbdmFsdWUsIG90aGVyXSwgUmVnRXhwLnByb3RvdHlwZS50ZXN0LCAvXmgoPzppfGVsbG8pJC8pKSB7DQogICAgICogICAgIHJldHVybiB0cnVlOw0KICAgICAqICAgfQ0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc0VxdWFsKHZhbHVlLCBvdGhlciwgY3VzdG9taXplciwgdGhpc0FyZykgew0KICAgICAgY3VzdG9taXplciA9IHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicgPyBiaW5kQ2FsbGJhY2soY3VzdG9taXplciwgdGhpc0FyZywgMykgOiB1bmRlZmluZWQ7DQogICAgICB2YXIgcmVzdWx0ID0gY3VzdG9taXplciA/IGN1c3RvbWl6ZXIodmFsdWUsIG90aGVyKSA6IHVuZGVmaW5lZDsNCiAgICAgIHJldHVybiAgcmVzdWx0ID09PSB1bmRlZmluZWQgPyBiYXNlSXNFcXVhbCh2YWx1ZSwgb3RoZXIsIGN1c3RvbWl6ZXIpIDogISFyZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYW4gYEVycm9yYCwgYEV2YWxFcnJvcmAsIGBSYW5nZUVycm9yYCwgYFJlZmVyZW5jZUVycm9yYCwNCiAgICAgKiBgU3ludGF4RXJyb3JgLCBgVHlwZUVycm9yYCwgb3IgYFVSSUVycm9yYCBvYmplY3QuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGVycm9yIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmlzRXJyb3IobmV3IEVycm9yKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiBfLmlzRXJyb3IoRXJyb3IpOw0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICovDQogICAgZnVuY3Rpb24gaXNFcnJvcih2YWx1ZSkgew0KICAgICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgdHlwZW9mIHZhbHVlLm1lc3NhZ2UgPT0gJ3N0cmluZycgJiYgb2JqVG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gZXJyb3JUYWc7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBmaW5pdGUgcHJpbWl0aXZlIG51bWJlci4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBiYXNlZCBvbiBbYE51bWJlci5pc0Zpbml0ZWBdKGh0dHBzOi8vcGVvcGxlLm1vemlsbGEub3JnL35qb3JlbmRvcmZmL2VzNi1kcmFmdC5odG1sI3NlYy1udW1iZXIuaXNmaW5pdGUpLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IExhbmcNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIGZpbml0ZSBudW1iZXIsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pc0Zpbml0ZSgxMCk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5pc0Zpbml0ZSgnMTAnKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqDQogICAgICogXy5pc0Zpbml0ZSh0cnVlKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqDQogICAgICogXy5pc0Zpbml0ZShPYmplY3QoMTApKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqDQogICAgICogXy5pc0Zpbml0ZShJbmZpbml0eSk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICB2YXIgaXNGaW5pdGUgPSBuYXRpdmVOdW1Jc0Zpbml0ZSB8fCBmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiBuYXRpdmVJc0Zpbml0ZSh2YWx1ZSk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgRnVuY3Rpb25gIG9iamVjdC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBMYW5nDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgY29ycmVjdGx5IGNsYXNzaWZpZWQsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pc0Z1bmN0aW9uKF8pOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNGdW5jdGlvbigvYWJjLyk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICB2YXIgaXNGdW5jdGlvbiA9ICEoYmFzZUlzRnVuY3Rpb24oL3gvKSB8fCAoVWludDhBcnJheSAmJiAhYmFzZUlzRnVuY3Rpb24oVWludDhBcnJheSkpKSA/IGJhc2VJc0Z1bmN0aW9uIDogZnVuY3Rpb24odmFsdWUpIHsNCiAgICAgIC8vIFRoZSB1c2Ugb2YgYE9iamVjdCN0b1N0cmluZ2AgYXZvaWRzIGlzc3VlcyB3aXRoIHRoZSBgdHlwZW9mYCBvcGVyYXRvcg0KICAgICAgLy8gaW4gb2xkZXIgdmVyc2lvbnMgb2YgQ2hyb21lIGFuZCBTYWZhcmkgd2hpY2ggcmV0dXJuICdmdW5jdGlvbicgZm9yIHJlZ2V4ZXMNCiAgICAgIC8vIGFuZCBTYWZhcmkgOCBlcXVpdmFsZW50cyB3aGljaCByZXR1cm4gJ29iamVjdCcgZm9yIHR5cGVkIGFycmF5IGNvbnN0cnVjdG9ycy4NCiAgICAgIHJldHVybiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBmdW5jVGFnOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyB0aGUgW2xhbmd1YWdlIHR5cGVdKGh0dHBzOi8vZXM1LmdpdGh1Yi5pby8jeDgpIG9mIGBPYmplY3RgLg0KICAgICAqIChlLmcuIGFycmF5cywgZnVuY3Rpb25zLCBvYmplY3RzLCByZWdleGVzLCBgbmV3IE51bWJlcigwKWAsIGFuZCBgbmV3IFN0cmluZygnJylgKQ0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IExhbmcNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pc09iamVjdCh7fSk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5pc09iamVjdChbMSwgMiwgM10pOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNPYmplY3QoMSk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc09iamVjdCh2YWx1ZSkgew0KICAgICAgLy8gQXZvaWQgYSBWOCBKSVQgYnVnIGluIENocm9tZSAxOS0yMC4NCiAgICAgIC8vIFNlZSBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MjI5MSBmb3IgbW9yZSBkZXRhaWxzLg0KICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7DQogICAgICByZXR1cm4gISF2YWx1ZSAmJiAodHlwZSA9PSAnb2JqZWN0JyB8fCB0eXBlID09ICdmdW5jdGlvbicpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFBlcmZvcm1zIGEgZGVlcCBjb21wYXJpc29uIGJldHdlZW4gYG9iamVjdGAgYW5kIGBzb3VyY2VgIHRvIGRldGVybWluZSBpZg0KICAgICAqIGBvYmplY3RgIGNvbnRhaW5zIGVxdWl2YWxlbnQgcHJvcGVydHkgdmFsdWVzLiBJZiBgY3VzdG9taXplcmAgaXMgcHJvdmlkZWQNCiAgICAgKiBpdCBpcyBpbnZva2VkIHRvIGNvbXBhcmUgdmFsdWVzLiBJZiBgY3VzdG9taXplcmAgcmV0dXJucyBgdW5kZWZpbmVkYA0KICAgICAqIGNvbXBhcmlzb25zIGFyZSBoYW5kbGVkIGJ5IHRoZSBtZXRob2QgaW5zdGVhZC4gVGhlIGBjdXN0b21pemVyYCBpcyBib3VuZA0KICAgICAqIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBvdGhlciwgaW5kZXh8a2V5KS4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBzdXBwb3J0cyBjb21wYXJpbmcgcHJvcGVydGllcyBvZiBhcnJheXMsIGJvb2xlYW5zLA0KICAgICAqIGBEYXRlYCBvYmplY3RzLCBudW1iZXJzLCBgT2JqZWN0YCBvYmplY3RzLCByZWdleGVzLCBhbmQgc3RyaW5ncy4gRnVuY3Rpb25zDQogICAgICogYW5kIERPTSBub2RlcyBhcmUgKipub3QqKiBzdXBwb3J0ZWQuIFByb3ZpZGUgYSBjdXN0b21pemVyIGZ1bmN0aW9uIHRvIGV4dGVuZA0KICAgICAqIHN1cHBvcnQgZm9yIGNvbXBhcmluZyBvdGhlciB2YWx1ZXMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnNwZWN0Lg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCBvZiBwcm9wZXJ0eSB2YWx1ZXMgdG8gbWF0Y2guDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgdmFsdWUgY29tcGFyaXNvbnMuDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjdXN0b21pemVyYC4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYG9iamVjdGAgaXMgYSBtYXRjaCwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgb2JqZWN0ID0geyAndXNlcic6ICdmcmVkJywgJ2FnZSc6IDQwIH07DQogICAgICoNCiAgICAgKiBfLmlzTWF0Y2gob2JqZWN0LCB7ICdhZ2UnOiA0MCB9KTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiBfLmlzTWF0Y2gob2JqZWN0LCB7ICdhZ2UnOiAzNiB9KTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqDQogICAgICogLy8gdXNpbmcgYSBjdXN0b21pemVyIGNhbGxiYWNrDQogICAgICogdmFyIG9iamVjdCA9IHsgJ2dyZWV0aW5nJzogJ2hlbGxvJyB9Ow0KICAgICAqIHZhciBzb3VyY2UgPSB7ICdncmVldGluZyc6ICdoaScgfTsNCiAgICAgKg0KICAgICAqIF8uaXNNYXRjaChvYmplY3QsIHNvdXJjZSwgZnVuY3Rpb24odmFsdWUsIG90aGVyKSB7DQogICAgICogICByZXR1cm4gXy5ldmVyeShbdmFsdWUsIG90aGVyXSwgUmVnRXhwLnByb3RvdHlwZS50ZXN0LCAvXmgoPzppfGVsbG8pJC8pIHx8IHVuZGVmaW5lZDsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICovDQogICAgZnVuY3Rpb24gaXNNYXRjaChvYmplY3QsIHNvdXJjZSwgY3VzdG9taXplciwgdGhpc0FyZykgew0KICAgICAgY3VzdG9taXplciA9IHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicgPyBiaW5kQ2FsbGJhY2soY3VzdG9taXplciwgdGhpc0FyZywgMykgOiB1bmRlZmluZWQ7DQogICAgICByZXR1cm4gYmFzZUlzTWF0Y2gob2JqZWN0LCBnZXRNYXRjaERhdGEoc291cmNlKSwgY3VzdG9taXplcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYE5hTmAuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgbm90IHRoZSBzYW1lIGFzIFtgaXNOYU5gXShodHRwczovL2VzNS5naXRodWIuaW8vI3gxNS4xLjIuNCkNCiAgICAgKiB3aGljaCByZXR1cm5zIGB0cnVlYCBmb3IgYHVuZGVmaW5lZGAgYW5kIG90aGVyIG5vbi1udW1lcmljIHZhbHVlcy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBMYW5nDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYE5hTmAsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pc05hTihOYU4pOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNOYU4obmV3IE51bWJlcihOYU4pKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiBpc05hTih1bmRlZmluZWQpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNOYU4odW5kZWZpbmVkKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzTmFOKHZhbHVlKSB7DQogICAgICAvLyBBbiBgTmFOYCBwcmltaXRpdmUgaXMgdGhlIG9ubHkgdmFsdWUgdGhhdCBpcyBub3QgZXF1YWwgdG8gaXRzZWxmLg0KICAgICAgLy8gUGVyZm9ybSB0aGUgYHRvU3RyaW5nVGFnYCBjaGVjayBmaXJzdCB0byBhdm9pZCBlcnJvcnMgd2l0aCBzb21lIGhvc3Qgb2JqZWN0cyBpbiBJRS4NCiAgICAgIHJldHVybiBpc051bWJlcih2YWx1ZSkgJiYgdmFsdWUgIT0gK3ZhbHVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgbmF0aXZlIGZ1bmN0aW9uLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IExhbmcNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG5hdGl2ZSBmdW5jdGlvbiwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmlzTmF0aXZlKEFycmF5LnByb3RvdHlwZS5wdXNoKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiBfLmlzTmF0aXZlKF8pOw0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICovDQogICAgZnVuY3Rpb24gaXNOYXRpdmUodmFsdWUpIHsNCiAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICAgIGlmIChvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBmdW5jVGFnKSB7DQogICAgICAgIHJldHVybiByZUlzTmF0aXZlLnRlc3QoZm5Ub1N0cmluZy5jYWxsKHZhbHVlKSk7DQogICAgICB9DQogICAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiByZUlzSG9zdEN0b3IudGVzdCh2YWx1ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYG51bGxgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IExhbmcNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBgbnVsbGAsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pc051bGwobnVsbCk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5pc051bGwodm9pZCAwKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzTnVsbCh2YWx1ZSkgew0KICAgICAgcmV0dXJuIHZhbHVlID09PSBudWxsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgTnVtYmVyYCBwcmltaXRpdmUgb3Igb2JqZWN0Lg0KICAgICAqDQogICAgICogKipOb3RlOioqIFRvIGV4Y2x1ZGUgYEluZmluaXR5YCwgYC1JbmZpbml0eWAsIGFuZCBgTmFOYCwgd2hpY2ggYXJlIGNsYXNzaWZpZWQNCiAgICAgKiBhcyBudW1iZXJzLCB1c2UgdGhlIGBfLmlzRmluaXRlYCBtZXRob2QuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGNvcnJlY3RseSBjbGFzc2lmaWVkLCBlbHNlIGBmYWxzZWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uaXNOdW1iZXIoOC40KTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiBfLmlzTnVtYmVyKE5hTik7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5pc051bWJlcignOC40Jyk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc051bWJlcih2YWx1ZSkgew0KICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyB8fCAoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBudW1iZXJUYWcpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgcGxhaW4gb2JqZWN0LCB0aGF0IGlzLCBhbiBvYmplY3QgY3JlYXRlZCBieSB0aGUNCiAgICAgKiBgT2JqZWN0YCBjb25zdHJ1Y3RvciBvciBvbmUgd2l0aCBhIGBbW1Byb3RvdHlwZV1dYCBvZiBgbnVsbGAuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgYXNzdW1lcyBvYmplY3RzIGNyZWF0ZWQgYnkgdGhlIGBPYmplY3RgIGNvbnN0cnVjdG9yDQogICAgICogaGF2ZSBubyBpbmhlcml0ZWQgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IExhbmcNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHBsYWluIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBmdW5jdGlvbiBGb28oKSB7DQogICAgICogICB0aGlzLmEgPSAxOw0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIF8uaXNQbGFpbk9iamVjdChuZXcgRm9vKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqDQogICAgICogXy5pc1BsYWluT2JqZWN0KFsxLCAyLCAzXSk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKg0KICAgICAqIF8uaXNQbGFpbk9iamVjdCh7ICd4JzogMCwgJ3knOiAwIH0pOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNQbGFpbk9iamVjdChPYmplY3QuY3JlYXRlKG51bGwpKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICovDQogICAgdmFyIGlzUGxhaW5PYmplY3QgPSAhZ2V0UHJvdG90eXBlT2YgPyBzaGltSXNQbGFpbk9iamVjdCA6IGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICBpZiAoISh2YWx1ZSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBvYmplY3RUYWcpKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICAgIHZhciB2YWx1ZU9mID0gZ2V0TmF0aXZlKHZhbHVlLCAndmFsdWVPZicpLA0KICAgICAgICAgIG9ialByb3RvID0gdmFsdWVPZiAmJiAob2JqUHJvdG8gPSBnZXRQcm90b3R5cGVPZih2YWx1ZU9mKSkgJiYgZ2V0UHJvdG90eXBlT2Yob2JqUHJvdG8pOw0KDQogICAgICByZXR1cm4gb2JqUHJvdG8NCiAgICAgICAgPyAodmFsdWUgPT0gb2JqUHJvdG8gfHwgZ2V0UHJvdG90eXBlT2YodmFsdWUpID09IG9ialByb3RvKQ0KICAgICAgICA6IHNoaW1Jc1BsYWluT2JqZWN0KHZhbHVlKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBSZWdFeHBgIG9iamVjdC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBMYW5nDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgY29ycmVjdGx5IGNsYXNzaWZpZWQsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pc1JlZ0V4cCgvYWJjLyk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5pc1JlZ0V4cCgnL2FiYy8nKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzUmVnRXhwKHZhbHVlKSB7DQogICAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSByZWdleHBUYWc7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBTdHJpbmdgIHByaW1pdGl2ZSBvciBvYmplY3QuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGNvcnJlY3RseSBjbGFzc2lmaWVkLCBlbHNlIGBmYWxzZWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uaXNTdHJpbmcoJ2FiYycpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNTdHJpbmcoMSk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc1N0cmluZyh2YWx1ZSkgew0KICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJyB8fCAoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBzdHJpbmdUYWcpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSB0eXBlZCBhcnJheS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBMYW5nDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgY29ycmVjdGx5IGNsYXNzaWZpZWQsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pc1R5cGVkQXJyYXkobmV3IFVpbnQ4QXJyYXkpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNUeXBlZEFycmF5KFtdKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzVHlwZWRBcnJheSh2YWx1ZSkgew0KICAgICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhIXR5cGVkQXJyYXlUYWdzW29ialRvU3RyaW5nLmNhbGwodmFsdWUpXTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBgdW5kZWZpbmVkYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBMYW5nDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYHVuZGVmaW5lZGAsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5pc1VuZGVmaW5lZCh2b2lkIDApOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaXNVbmRlZmluZWQobnVsbCk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc1VuZGVmaW5lZCh2YWx1ZSkgew0KICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGVzcyB0aGFuIGBvdGhlcmAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuDQogICAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBsZXNzIHRoYW4gYG90aGVyYCwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmx0KDEsIDMpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8ubHQoMywgMyk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKg0KICAgICAqIF8ubHQoMywgMSk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBsdCh2YWx1ZSwgb3RoZXIpIHsNCiAgICAgIHJldHVybiB2YWx1ZSA8IG90aGVyOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byBgb3RoZXJgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IExhbmcNCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLg0KICAgICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGBvdGhlcmAsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5sdGUoMSwgMyk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5sdGUoMywgMyk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5sdGUoMywgMSk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBsdGUodmFsdWUsIG90aGVyKSB7DQogICAgICByZXR1cm4gdmFsdWUgPD0gb3RoZXI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ29udmVydHMgYHZhbHVlYCB0byBhbiBhcnJheS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBMYW5nDQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBhcnJheS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogKGZ1bmN0aW9uKCkgew0KICAgICAqICAgcmV0dXJuIF8udG9BcnJheShhcmd1bWVudHMpLnNsaWNlKDEpOw0KICAgICAqIH0oMSwgMiwgMykpOw0KICAgICAqIC8vID0+IFsyLCAzXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRvQXJyYXkodmFsdWUpIHsNCiAgICAgIHZhciBsZW5ndGggPSB2YWx1ZSA/IGdldExlbmd0aCh2YWx1ZSkgOiAwOw0KICAgICAgaWYgKCFpc0xlbmd0aChsZW5ndGgpKSB7DQogICAgICAgIHJldHVybiB2YWx1ZXModmFsdWUpOw0KICAgICAgfQ0KICAgICAgaWYgKCFsZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGFycmF5Q29weSh2YWx1ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHBsYWluIG9iamVjdCBmbGF0dGVuaW5nIGluaGVyaXRlZCBlbnVtZXJhYmxlDQogICAgICogcHJvcGVydGllcyBvZiBgdmFsdWVgIHRvIG93biBwcm9wZXJ0aWVzIG9mIHRoZSBwbGFpbiBvYmplY3QuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTGFuZw0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY29udmVydGVkIHBsYWluIG9iamVjdC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogZnVuY3Rpb24gRm9vKCkgew0KICAgICAqICAgdGhpcy5iID0gMjsNCiAgICAgKiB9DQogICAgICoNCiAgICAgKiBGb28ucHJvdG90eXBlLmMgPSAzOw0KICAgICAqDQogICAgICogXy5hc3NpZ24oeyAnYSc6IDEgfSwgbmV3IEZvbyk7DQogICAgICogLy8gPT4geyAnYSc6IDEsICdiJzogMiB9DQogICAgICoNCiAgICAgKiBfLmFzc2lnbih7ICdhJzogMSB9LCBfLnRvUGxhaW5PYmplY3QobmV3IEZvbykpOw0KICAgICAqIC8vID0+IHsgJ2EnOiAxLCAnYic6IDIsICdjJzogMyB9DQogICAgICovDQogICAgZnVuY3Rpb24gdG9QbGFpbk9iamVjdCh2YWx1ZSkgew0KICAgICAgcmV0dXJuIGJhc2VDb3B5KHZhbHVlLCBrZXlzSW4odmFsdWUpKTsNCiAgICB9DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvKioNCiAgICAgKiBBc3NpZ25zIG93biBlbnVtZXJhYmxlIHByb3BlcnRpZXMgb2Ygc291cmNlIG9iamVjdChzKSB0byB0aGUgZGVzdGluYXRpb24NCiAgICAgKiBvYmplY3QuIFN1YnNlcXVlbnQgc291cmNlcyBvdmVyd3JpdGUgcHJvcGVydHkgYXNzaWdubWVudHMgb2YgcHJldmlvdXMgc291cmNlcy4NCiAgICAgKiBJZiBgY3VzdG9taXplcmAgaXMgcHJvdmlkZWQgaXQgaXMgaW52b2tlZCB0byBwcm9kdWNlIHRoZSBhc3NpZ25lZCB2YWx1ZXMuDQogICAgICogVGhlIGBjdXN0b21pemVyYCBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCBmaXZlIGFyZ3VtZW50czoNCiAgICAgKiAob2JqZWN0VmFsdWUsIHNvdXJjZVZhbHVlLCBrZXksIG9iamVjdCwgc291cmNlKS4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBtdXRhdGVzIGBvYmplY3RgIGFuZCBpcyBiYXNlZCBvbg0KICAgICAqIFtgT2JqZWN0LmFzc2lnbmBdKGh0dHBzOi8vcGVvcGxlLm1vemlsbGEub3JnL35qb3JlbmRvcmZmL2VzNi1kcmFmdC5odG1sI3NlYy1vYmplY3QuYXNzaWduKS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBhbGlhcyBleHRlbmQNCiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0DQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgZGVzdGluYXRpb24gb2JqZWN0Lg0KICAgICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBbc291cmNlc10gVGhlIHNvdXJjZSBvYmplY3RzLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGFzc2lnbmVkIHZhbHVlcy4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGN1c3RvbWl6ZXJgLg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uYXNzaWduKHsgJ3VzZXInOiAnYmFybmV5JyB9LCB7ICdhZ2UnOiA0MCB9LCB7ICd1c2VyJzogJ2ZyZWQnIH0pOw0KICAgICAqIC8vID0+IHsgJ3VzZXInOiAnZnJlZCcsICdhZ2UnOiA0MCB9DQogICAgICoNCiAgICAgKiAvLyB1c2luZyBhIGN1c3RvbWl6ZXIgY2FsbGJhY2sNCiAgICAgKiB2YXIgZGVmYXVsdHMgPSBfLnBhcnRpYWxSaWdodChfLmFzc2lnbiwgZnVuY3Rpb24odmFsdWUsIG90aGVyKSB7DQogICAgICogICByZXR1cm4gXy5pc1VuZGVmaW5lZCh2YWx1ZSkgPyBvdGhlciA6IHZhbHVlOw0KICAgICAqIH0pOw0KICAgICAqDQogICAgICogZGVmYXVsdHMoeyAndXNlcic6ICdiYXJuZXknIH0sIHsgJ2FnZSc6IDM2IH0sIHsgJ3VzZXInOiAnZnJlZCcgfSk7DQogICAgICogLy8gPT4geyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYgfQ0KICAgICAqLw0KICAgIHZhciBhc3NpZ24gPSBjcmVhdGVBc3NpZ25lcihmdW5jdGlvbihvYmplY3QsIHNvdXJjZSwgY3VzdG9taXplcikgew0KICAgICAgcmV0dXJuIGN1c3RvbWl6ZXINCiAgICAgICAgPyBhc3NpZ25XaXRoKG9iamVjdCwgc291cmNlLCBjdXN0b21pemVyKQ0KICAgICAgICA6IGJhc2VBc3NpZ24ob2JqZWN0LCBzb3VyY2UpOw0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBvYmplY3QgdGhhdCBpbmhlcml0cyBmcm9tIHRoZSBnaXZlbiBgcHJvdG90eXBlYCBvYmplY3QuIElmIGENCiAgICAgKiBgcHJvcGVydGllc2Agb2JqZWN0IGlzIHByb3ZpZGVkIGl0cyBvd24gZW51bWVyYWJsZSBwcm9wZXJ0aWVzIGFyZSBhc3NpZ25lZA0KICAgICAqIHRvIHRoZSBjcmVhdGVkIG9iamVjdC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBPYmplY3QNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gcHJvdG90eXBlIFRoZSBvYmplY3QgdG8gaW5oZXJpdCBmcm9tLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbcHJvcGVydGllc10gVGhlIHByb3BlcnRpZXMgdG8gYXNzaWduIHRvIHRoZSBvYmplY3QuDQogICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGEgY2FsbGJhY2sgZm9yIGZ1bmN0aW9ucyBsaWtlIGBfLm1hcGAuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IG9iamVjdC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogZnVuY3Rpb24gU2hhcGUoKSB7DQogICAgICogICB0aGlzLnggPSAwOw0KICAgICAqICAgdGhpcy55ID0gMDsNCiAgICAgKiB9DQogICAgICoNCiAgICAgKiBmdW5jdGlvbiBDaXJjbGUoKSB7DQogICAgICogICBTaGFwZS5jYWxsKHRoaXMpOw0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIENpcmNsZS5wcm90b3R5cGUgPSBfLmNyZWF0ZShTaGFwZS5wcm90b3R5cGUsIHsNCiAgICAgKiAgICdjb25zdHJ1Y3Rvcic6IENpcmNsZQ0KICAgICAqIH0pOw0KICAgICAqDQogICAgICogdmFyIGNpcmNsZSA9IG5ldyBDaXJjbGU7DQogICAgICogY2lyY2xlIGluc3RhbmNlb2YgQ2lyY2xlOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIGNpcmNsZSBpbnN0YW5jZW9mIFNoYXBlOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjcmVhdGUocHJvdG90eXBlLCBwcm9wZXJ0aWVzLCBndWFyZCkgew0KICAgICAgdmFyIHJlc3VsdCA9IGJhc2VDcmVhdGUocHJvdG90eXBlKTsNCiAgICAgIGlmIChndWFyZCAmJiBpc0l0ZXJhdGVlQ2FsbChwcm90b3R5cGUsIHByb3BlcnRpZXMsIGd1YXJkKSkgew0KICAgICAgICBwcm9wZXJ0aWVzID0gbnVsbDsNCiAgICAgIH0NCiAgICAgIHJldHVybiBwcm9wZXJ0aWVzID8gYmFzZUFzc2lnbihyZXN1bHQsIHByb3BlcnRpZXMpIDogcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFzc2lnbnMgb3duIGVudW1lcmFibGUgcHJvcGVydGllcyBvZiBzb3VyY2Ugb2JqZWN0KHMpIHRvIHRoZSBkZXN0aW5hdGlvbg0KICAgICAqIG9iamVjdCBmb3IgYWxsIGRlc3RpbmF0aW9uIHByb3BlcnRpZXMgdGhhdCByZXNvbHZlIHRvIGB1bmRlZmluZWRgLiBPbmNlIGENCiAgICAgKiBwcm9wZXJ0eSBpcyBzZXQsIGFkZGl0aW9uYWwgdmFsdWVzIG9mIHRoZSBzYW1lIHByb3BlcnR5IGFyZSBpZ25vcmVkLg0KICAgICAqDQogICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIG11dGF0ZXMgYG9iamVjdGAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0DQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgZGVzdGluYXRpb24gb2JqZWN0Lg0KICAgICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBbc291cmNlc10gVGhlIHNvdXJjZSBvYmplY3RzLg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uZGVmYXVsdHMoeyAndXNlcic6ICdiYXJuZXknIH0sIHsgJ2FnZSc6IDM2IH0sIHsgJ3VzZXInOiAnZnJlZCcgfSk7DQogICAgICogLy8gPT4geyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYgfQ0KICAgICAqLw0KICAgIHZhciBkZWZhdWx0cyA9IHJlc3RQYXJhbShmdW5jdGlvbihhcmdzKSB7DQogICAgICB2YXIgb2JqZWN0ID0gYXJnc1swXTsNCiAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gb2JqZWN0Ow0KICAgICAgfQ0KICAgICAgYXJncy5wdXNoKGFzc2lnbkRlZmF1bHRzKTsNCiAgICAgIHJldHVybiBhc3NpZ24uYXBwbHkodW5kZWZpbmVkLCBhcmdzKTsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uZmluZGAgZXhjZXB0IHRoYXQgaXQgcmV0dXJucyB0aGUga2V5IG9mIHRoZSBmaXJzdA0KICAgICAqIGVsZW1lbnQgYHByZWRpY2F0ZWAgcmV0dXJucyB0cnV0aHkgZm9yIGluc3RlYWQgb2YgdGhlIGVsZW1lbnQgaXRzZWxmLg0KICAgICAqDQogICAgICogSWYgYSBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGEgdmFsdWUgaXMgYWxzbyBwcm92aWRlZCBmb3IgYHRoaXNBcmdgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNQcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWF0Y2hpbmcgcHJvcGVydHkNCiAgICAgKiB2YWx1ZSwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzYCBzdHlsZQ0KICAgICAqIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGdpdmVuDQogICAgICogb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0DQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHNlYXJjaC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxzdHJpbmd9IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQNCiAgICAgKiAgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYHByZWRpY2F0ZWAuDQogICAgICogQHJldHVybnMge3N0cmluZ3x1bmRlZmluZWR9IFJldHVybnMgdGhlIGtleSBvZiB0aGUgbWF0Y2hlZCBlbGVtZW50LCBlbHNlIGB1bmRlZmluZWRgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSB7DQogICAgICogICAnYmFybmV5JzogIHsgJ2FnZSc6IDM2LCAnYWN0aXZlJzogdHJ1ZSB9LA0KICAgICAqICAgJ2ZyZWQnOiAgICB7ICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IGZhbHNlIH0sDQogICAgICogICAncGViYmxlcyc6IHsgJ2FnZSc6IDEsICAnYWN0aXZlJzogdHJ1ZSB9DQogICAgICogfTsNCiAgICAgKg0KICAgICAqIF8uZmluZEtleSh1c2VycywgZnVuY3Rpb24oY2hyKSB7DQogICAgICogICByZXR1cm4gY2hyLmFnZSA8IDQwOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+ICdiYXJuZXknIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc2AgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5maW5kS2V5KHVzZXJzLCB7ICdhZ2UnOiAxLCAnYWN0aXZlJzogdHJ1ZSB9KTsNCiAgICAgKiAvLyA9PiAncGViYmxlcycNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8uZmluZEtleSh1c2VycywgJ2FjdGl2ZScsIGZhbHNlKTsNCiAgICAgKiAvLyA9PiAnZnJlZCcNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5wcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5maW5kS2V5KHVzZXJzLCAnYWN0aXZlJyk7DQogICAgICogLy8gPT4gJ2Jhcm5leScNCiAgICAgKi8NCiAgICB2YXIgZmluZEtleSA9IGNyZWF0ZUZpbmRLZXkoYmFzZUZvck93bik7DQoNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZpbmRLZXlgIGV4Y2VwdCB0aGF0IGl0IGl0ZXJhdGVzIG92ZXIgZWxlbWVudHMgb2YNCiAgICAgKiBhIGNvbGxlY3Rpb24gaW4gdGhlIG9wcG9zaXRlIG9yZGVyLg0KICAgICAqDQogICAgICogSWYgYSBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGEgdmFsdWUgaXMgYWxzbyBwcm92aWRlZCBmb3IgYHRoaXNBcmdgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNQcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWF0Y2hpbmcgcHJvcGVydHkNCiAgICAgKiB2YWx1ZSwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBgcHJlZGljYXRlYCB0aGUgY3JlYXRlZCBgXy5tYXRjaGVzYCBzdHlsZQ0KICAgICAqIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGdpdmVuDQogICAgICogb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0DQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHNlYXJjaC4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxzdHJpbmd9IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQNCiAgICAgKiAgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYHByZWRpY2F0ZWAuDQogICAgICogQHJldHVybnMge3N0cmluZ3x1bmRlZmluZWR9IFJldHVybnMgdGhlIGtleSBvZiB0aGUgbWF0Y2hlZCBlbGVtZW50LCBlbHNlIGB1bmRlZmluZWRgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSB7DQogICAgICogICAnYmFybmV5JzogIHsgJ2FnZSc6IDM2LCAnYWN0aXZlJzogdHJ1ZSB9LA0KICAgICAqICAgJ2ZyZWQnOiAgICB7ICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IGZhbHNlIH0sDQogICAgICogICAncGViYmxlcyc6IHsgJ2FnZSc6IDEsICAnYWN0aXZlJzogdHJ1ZSB9DQogICAgICogfTsNCiAgICAgKg0KICAgICAqIF8uZmluZExhc3RLZXkodXNlcnMsIGZ1bmN0aW9uKGNocikgew0KICAgICAqICAgcmV0dXJuIGNoci5hZ2UgPCA0MDsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiByZXR1cm5zIGBwZWJibGVzYCBhc3N1bWluZyBgXy5maW5kS2V5YCByZXR1cm5zIGBiYXJuZXlgDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc2AgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5maW5kTGFzdEtleSh1c2VycywgeyAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH0pOw0KICAgICAqIC8vID0+ICdiYXJuZXknDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLmZpbmRMYXN0S2V5KHVzZXJzLCAnYWN0aXZlJywgZmFsc2UpOw0KICAgICAqIC8vID0+ICdmcmVkJw0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLnByb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLmZpbmRMYXN0S2V5KHVzZXJzLCAnYWN0aXZlJyk7DQogICAgICogLy8gPT4gJ3BlYmJsZXMnDQogICAgICovDQogICAgdmFyIGZpbmRMYXN0S2V5ID0gY3JlYXRlRmluZEtleShiYXNlRm9yT3duUmlnaHQpOw0KDQogICAgLyoqDQogICAgICogSXRlcmF0ZXMgb3ZlciBvd24gYW5kIGluaGVyaXRlZCBlbnVtZXJhYmxlIHByb3BlcnRpZXMgb2YgYW4gb2JqZWN0IGludm9raW5nDQogICAgICogYGl0ZXJhdGVlYCBmb3IgZWFjaCBwcm9wZXJ0eS4gVGhlIGBpdGVyYXRlZWAgaXMgYm91bmQgdG8gYHRoaXNBcmdgIGFuZCBpbnZva2VkDQogICAgICogd2l0aCB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwga2V5LCBvYmplY3QpLiBJdGVyYXRlZSBmdW5jdGlvbnMgbWF5IGV4aXQNCiAgICAgKiBpdGVyYXRpb24gZWFybHkgYnkgZXhwbGljaXRseSByZXR1cm5pbmcgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBPYmplY3QNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgaXRlcmF0ZWVgLg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIGZ1bmN0aW9uIEZvbygpIHsNCiAgICAgKiAgIHRoaXMuYSA9IDE7DQogICAgICogICB0aGlzLmIgPSAyOw0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIEZvby5wcm90b3R5cGUuYyA9IDM7DQogICAgICoNCiAgICAgKiBfLmZvckluKG5ldyBGb28sIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsNCiAgICAgKiAgIGNvbnNvbGUubG9nKGtleSk7DQogICAgICogfSk7DQogICAgICogLy8gPT4gbG9ncyAnYScsICdiJywgYW5kICdjJyAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKQ0KICAgICAqLw0KICAgIHZhciBmb3JJbiA9IGNyZWF0ZUZvckluKGJhc2VGb3IpOw0KDQogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5mb3JJbmAgZXhjZXB0IHRoYXQgaXQgaXRlcmF0ZXMgb3ZlciBwcm9wZXJ0aWVzIG9mDQogICAgICogYG9iamVjdGAgaW4gdGhlIG9wcG9zaXRlIG9yZGVyLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IE9iamVjdA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBpdGVyYXRlZWAuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogZnVuY3Rpb24gRm9vKCkgew0KICAgICAqICAgdGhpcy5hID0gMTsNCiAgICAgKiAgIHRoaXMuYiA9IDI7DQogICAgICogfQ0KICAgICAqDQogICAgICogRm9vLnByb3RvdHlwZS5jID0gMzsNCiAgICAgKg0KICAgICAqIF8uZm9ySW5SaWdodChuZXcgRm9vLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7DQogICAgICogICBjb25zb2xlLmxvZyhrZXkpOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IGxvZ3MgJ2MnLCAnYicsIGFuZCAnYScgYXNzdW1pbmcgYF8uZm9ySW4gYCBsb2dzICdhJywgJ2InLCBhbmQgJ2MnDQogICAgICovDQogICAgdmFyIGZvckluUmlnaHQgPSBjcmVhdGVGb3JJbihiYXNlRm9yUmlnaHQpOw0KDQogICAgLyoqDQogICAgICogSXRlcmF0ZXMgb3ZlciBvd24gZW51bWVyYWJsZSBwcm9wZXJ0aWVzIG9mIGFuIG9iamVjdCBpbnZva2luZyBgaXRlcmF0ZWVgDQogICAgICogZm9yIGVhY2ggcHJvcGVydHkuIFRoZSBgaXRlcmF0ZWVgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoDQogICAgICogdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGtleSwgb2JqZWN0KS4gSXRlcmF0ZWUgZnVuY3Rpb25zIG1heSBleGl0IGl0ZXJhdGlvbg0KICAgICAqIGVhcmx5IGJ5IGV4cGxpY2l0bHkgcmV0dXJuaW5nIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0DQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGl0ZXJhdGVlYC4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBmdW5jdGlvbiBGb28oKSB7DQogICAgICogICB0aGlzLmEgPSAxOw0KICAgICAqICAgdGhpcy5iID0gMjsNCiAgICAgKiB9DQogICAgICoNCiAgICAgKiBGb28ucHJvdG90eXBlLmMgPSAzOw0KICAgICAqDQogICAgICogXy5mb3JPd24obmV3IEZvbywgZnVuY3Rpb24odmFsdWUsIGtleSkgew0KICAgICAqICAgY29uc29sZS5sb2coa2V5KTsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiBsb2dzICdhJyBhbmQgJ2InIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpDQogICAgICovDQogICAgdmFyIGZvck93biA9IGNyZWF0ZUZvck93bihiYXNlRm9yT3duKTsNCg0KICAgIC8qKg0KICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uZm9yT3duYCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIHByb3BlcnRpZXMgb2YNCiAgICAgKiBgb2JqZWN0YCBpbiB0aGUgb3Bwb3NpdGUgb3JkZXIuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0DQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGl0ZXJhdGVlYC4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBmdW5jdGlvbiBGb28oKSB7DQogICAgICogICB0aGlzLmEgPSAxOw0KICAgICAqICAgdGhpcy5iID0gMjsNCiAgICAgKiB9DQogICAgICoNCiAgICAgKiBGb28ucHJvdG90eXBlLmMgPSAzOw0KICAgICAqDQogICAgICogXy5mb3JPd25SaWdodChuZXcgRm9vLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7DQogICAgICogICBjb25zb2xlLmxvZyhrZXkpOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IGxvZ3MgJ2InIGFuZCAnYScgYXNzdW1pbmcgYF8uZm9yT3duYCBsb2dzICdhJyBhbmQgJ2InDQogICAgICovDQogICAgdmFyIGZvck93blJpZ2h0ID0gY3JlYXRlRm9yT3duKGJhc2VGb3JPd25SaWdodCk7DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIGZ1bmN0aW9uIHByb3BlcnR5IG5hbWVzIGZyb20gYWxsIGVudW1lcmFibGUgcHJvcGVydGllcywNCiAgICAgKiBvd24gYW5kIGluaGVyaXRlZCwgb2YgYG9iamVjdGAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAYWxpYXMgbWV0aG9kcw0KICAgICAqIEBjYXRlZ29yeSBPYmplY3QNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5mdW5jdGlvbnMoXyk7DQogICAgICogLy8gPT4gWydhZnRlcicsICdhcnknLCAnYXNzaWduJywgLi4uXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGZ1bmN0aW9ucyhvYmplY3QpIHsNCiAgICAgIHJldHVybiBiYXNlRnVuY3Rpb25zKG9iamVjdCwga2V5c0luKG9iamVjdCkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldHMgdGhlIHByb3BlcnR5IHZhbHVlIGF0IGBwYXRoYCBvZiBgb2JqZWN0YC4gSWYgdGhlIHJlc29sdmVkIHZhbHVlIGlzDQogICAgICogYHVuZGVmaW5lZGAgdGhlIGBkZWZhdWx0VmFsdWVgIGlzIHVzZWQgaW4gaXRzIHBsYWNlLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IE9iamVjdA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4NCiAgICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0Lg0KICAgICAqIEBwYXJhbSB7Kn0gW2RlZmF1bHRWYWx1ZV0gVGhlIHZhbHVlIHJldHVybmVkIGlmIHRoZSByZXNvbHZlZCB2YWx1ZSBpcyBgdW5kZWZpbmVkYC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmVzb2x2ZWQgdmFsdWUuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBvYmplY3QgPSB7ICdhJzogW3sgJ2InOiB7ICdjJzogMyB9IH1dIH07DQogICAgICoNCiAgICAgKiBfLmdldChvYmplY3QsICdhWzBdLmIuYycpOw0KICAgICAqIC8vID0+IDMNCiAgICAgKg0KICAgICAqIF8uZ2V0KG9iamVjdCwgWydhJywgJzAnLCAnYicsICdjJ10pOw0KICAgICAqIC8vID0+IDMNCiAgICAgKg0KICAgICAqIF8uZ2V0KG9iamVjdCwgJ2EuYi5jJywgJ2RlZmF1bHQnKTsNCiAgICAgKiAvLyA9PiAnZGVmYXVsdCcNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXQob2JqZWN0LCBwYXRoLCBkZWZhdWx0VmFsdWUpIHsNCiAgICAgIHZhciByZXN1bHQgPSBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IGJhc2VHZXQob2JqZWN0LCB0b1BhdGgocGF0aCksIHBhdGggKyAnJyk7DQogICAgICByZXR1cm4gcmVzdWx0ID09PSB1bmRlZmluZWQgPyBkZWZhdWx0VmFsdWUgOiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGBwYXRoYCBpcyBhIGRpcmVjdCBwcm9wZXJ0eS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBPYmplY3QNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuDQogICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggdG8gY2hlY2suDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBwYXRoYCBpcyBhIGRpcmVjdCBwcm9wZXJ0eSwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IHsgJ2InOiB7ICdjJzogMyB9IH0gfTsNCiAgICAgKg0KICAgICAqIF8uaGFzKG9iamVjdCwgJ2EnKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiBfLmhhcyhvYmplY3QsICdhLmIuYycpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaGFzKG9iamVjdCwgWydhJywgJ2InLCAnYyddKTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICovDQogICAgZnVuY3Rpb24gaGFzKG9iamVjdCwgcGF0aCkgew0KICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICAgIHZhciByZXN1bHQgPSBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcGF0aCk7DQogICAgICBpZiAoIXJlc3VsdCAmJiAhaXNLZXkocGF0aCkpIHsNCiAgICAgICAgcGF0aCA9IHRvUGF0aChwYXRoKTsNCiAgICAgICAgb2JqZWN0ID0gcGF0aC5sZW5ndGggPT0gMSA/IG9iamVjdCA6IGJhc2VHZXQob2JqZWN0LCBiYXNlU2xpY2UocGF0aCwgMCwgLTEpKTsNCiAgICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7DQogICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHBhdGggPSBsYXN0KHBhdGgpOw0KICAgICAgICByZXN1bHQgPSBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcGF0aCk7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0IHx8IChpc0xlbmd0aChvYmplY3QubGVuZ3RoKSAmJiBpc0luZGV4KHBhdGgsIG9iamVjdC5sZW5ndGgpICYmDQogICAgICAgIChpc0FycmF5KG9iamVjdCkgfHwgaXNBcmd1bWVudHMob2JqZWN0KSkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYW4gb2JqZWN0IGNvbXBvc2VkIG9mIHRoZSBpbnZlcnRlZCBrZXlzIGFuZCB2YWx1ZXMgb2YgYG9iamVjdGAuDQogICAgICogSWYgYG9iamVjdGAgY29udGFpbnMgZHVwbGljYXRlIHZhbHVlcywgc3Vic2VxdWVudCB2YWx1ZXMgb3ZlcndyaXRlIHByb3BlcnR5DQogICAgICogYXNzaWdubWVudHMgb2YgcHJldmlvdXMgdmFsdWVzIHVubGVzcyBgbXVsdGlWYWx1ZWAgaXMgYHRydWVgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IE9iamVjdA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnZlcnQuDQogICAgICogQHBhcmFtIHtib29sZWFufSBbbXVsdGlWYWx1ZV0gQWxsb3cgbXVsdGlwbGUgdmFsdWVzIHBlciBrZXkuDQogICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGEgY2FsbGJhY2sgZm9yIGZ1bmN0aW9ucyBsaWtlIGBfLm1hcGAuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IGludmVydGVkIG9iamVjdC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxLCAnYic6IDIsICdjJzogMSB9Ow0KICAgICAqDQogICAgICogXy5pbnZlcnQob2JqZWN0KTsNCiAgICAgKiAvLyA9PiB7ICcxJzogJ2MnLCAnMic6ICdiJyB9DQogICAgICoNCiAgICAgKiAvLyB3aXRoIGBtdWx0aVZhbHVlYA0KICAgICAqIF8uaW52ZXJ0KG9iamVjdCwgdHJ1ZSk7DQogICAgICogLy8gPT4geyAnMSc6IFsnYScsICdjJ10sICcyJzogWydiJ10gfQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGludmVydChvYmplY3QsIG11bHRpVmFsdWUsIGd1YXJkKSB7DQogICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwob2JqZWN0LCBtdWx0aVZhbHVlLCBndWFyZCkpIHsNCiAgICAgICAgbXVsdGlWYWx1ZSA9IG51bGw7DQogICAgICB9DQogICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICBwcm9wcyA9IGtleXMob2JqZWN0KSwNCiAgICAgICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGgsDQogICAgICAgICAgcmVzdWx0ID0ge307DQoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF0sDQogICAgICAgICAgICB2YWx1ZSA9IG9iamVjdFtrZXldOw0KDQogICAgICAgIGlmIChtdWx0aVZhbHVlKSB7DQogICAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwocmVzdWx0LCB2YWx1ZSkpIHsNCiAgICAgICAgICAgIHJlc3VsdFt2YWx1ZV0ucHVzaChrZXkpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXN1bHRbdmFsdWVdID0gW2tleV07DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIHJlc3VsdFt2YWx1ZV0gPSBrZXk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgYG9iamVjdGAuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogTm9uLW9iamVjdCB2YWx1ZXMgYXJlIGNvZXJjZWQgdG8gb2JqZWN0cy4gU2VlIHRoZQ0KICAgICAqIFtFUyBzcGVjXShodHRwczovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtb2JqZWN0LmtleXMpDQogICAgICogZm9yIG1vcmUgZGV0YWlscy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBPYmplY3QNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogZnVuY3Rpb24gRm9vKCkgew0KICAgICAqICAgdGhpcy5hID0gMTsNCiAgICAgKiAgIHRoaXMuYiA9IDI7DQogICAgICogfQ0KICAgICAqDQogICAgICogRm9vLnByb3RvdHlwZS5jID0gMzsNCiAgICAgKg0KICAgICAqIF8ua2V5cyhuZXcgRm9vKTsNCiAgICAgKiAvLyA9PiBbJ2EnLCAnYiddIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpDQogICAgICoNCiAgICAgKiBfLmtleXMoJ2hpJyk7DQogICAgICogLy8gPT4gWycwJywgJzEnXQ0KICAgICAqLw0KICAgIHZhciBrZXlzID0gIW5hdGl2ZUtleXMgPyBzaGltS2V5cyA6IGZ1bmN0aW9uKG9iamVjdCkgew0KICAgICAgdmFyIEN0b3IgPSBvYmplY3QgPT0gbnVsbCA/IG51bGwgOiBvYmplY3QuY29uc3RydWN0b3I7DQogICAgICBpZiAoKHR5cGVvZiBDdG9yID09ICdmdW5jdGlvbicgJiYgQ3Rvci5wcm90b3R5cGUgPT09IG9iamVjdCkgfHwNCiAgICAgICAgICAodHlwZW9mIG9iamVjdCAhPSAnZnVuY3Rpb24nICYmIGlzQXJyYXlMaWtlKG9iamVjdCkpKSB7DQogICAgICAgIHJldHVybiBzaGltS2V5cyhvYmplY3QpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGlzT2JqZWN0KG9iamVjdCkgPyBuYXRpdmVLZXlzKG9iamVjdCkgOiBbXTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGFuZCBpbmhlcml0ZWQgZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBvZiBgb2JqZWN0YC4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBOb24tb2JqZWN0IHZhbHVlcyBhcmUgY29lcmNlZCB0byBvYmplY3RzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IE9iamVjdA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBmdW5jdGlvbiBGb28oKSB7DQogICAgICogICB0aGlzLmEgPSAxOw0KICAgICAqICAgdGhpcy5iID0gMjsNCiAgICAgKiB9DQogICAgICoNCiAgICAgKiBGb28ucHJvdG90eXBlLmMgPSAzOw0KICAgICAqDQogICAgICogXy5rZXlzSW4obmV3IEZvbyk7DQogICAgICogLy8gPT4gWydhJywgJ2InLCAnYyddIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpDQogICAgICovDQogICAgZnVuY3Rpb24ga2V5c0luKG9iamVjdCkgew0KICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBbXTsNCiAgICAgIH0NCiAgICAgIGlmICghaXNPYmplY3Qob2JqZWN0KSkgew0KICAgICAgICBvYmplY3QgPSBPYmplY3Qob2JqZWN0KTsNCiAgICAgIH0NCiAgICAgIHZhciBsZW5ndGggPSBvYmplY3QubGVuZ3RoOw0KICAgICAgbGVuZ3RoID0gKGxlbmd0aCAmJiBpc0xlbmd0aChsZW5ndGgpICYmDQogICAgICAgIChpc0FycmF5KG9iamVjdCkgfHwgaXNBcmd1bWVudHMob2JqZWN0KSkgJiYgbGVuZ3RoKSB8fCAwOw0KDQogICAgICB2YXIgQ3RvciA9IG9iamVjdC5jb25zdHJ1Y3RvciwNCiAgICAgICAgICBpbmRleCA9IC0xLA0KICAgICAgICAgIGlzUHJvdG8gPSB0eXBlb2YgQ3RvciA9PSAnZnVuY3Rpb24nICYmIEN0b3IucHJvdG90eXBlID09PSBvYmplY3QsDQogICAgICAgICAgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKSwNCiAgICAgICAgICBza2lwSW5kZXhlcyA9IGxlbmd0aCA+IDA7DQoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIHJlc3VsdFtpbmRleF0gPSAoaW5kZXggKyAnJyk7DQogICAgICB9DQogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7DQogICAgICAgIGlmICghKHNraXBJbmRleGVzICYmIGlzSW5kZXgoa2V5LCBsZW5ndGgpKSAmJg0KICAgICAgICAgICAgIShrZXkgPT0gJ2NvbnN0cnVjdG9yJyAmJiAoaXNQcm90byB8fCAhaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkpKSkgew0KICAgICAgICAgIHJlc3VsdC5wdXNoKGtleSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIG9wcG9zaXRlIG9mIGBfLm1hcFZhbHVlc2A7IHRoaXMgbWV0aG9kIGNyZWF0ZXMgYW4gb2JqZWN0IHdpdGggdGhlDQogICAgICogc2FtZSB2YWx1ZXMgYXMgYG9iamVjdGAgYW5kIGtleXMgZ2VuZXJhdGVkIGJ5IHJ1bm5pbmcgZWFjaCBvd24gZW51bWVyYWJsZQ0KICAgICAqIHByb3BlcnR5IG9mIGBvYmplY3RgIHRocm91Z2ggYGl0ZXJhdGVlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBPYmplY3QNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb258T2JqZWN0fHN0cmluZ30gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkDQogICAgICogIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBpdGVyYXRlZWAuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IG1hcHBlZCBvYmplY3QuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8ubWFwS2V5cyh7ICdhJzogMSwgJ2InOiAyIH0sIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsNCiAgICAgKiAgIHJldHVybiBrZXkgKyB2YWx1ZTsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiB7ICdhMSc6IDEsICdiMic6IDIgfQ0KICAgICAqLw0KICAgIHZhciBtYXBLZXlzID0gY3JlYXRlT2JqZWN0TWFwcGVyKHRydWUpOw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBvYmplY3Qgd2l0aCB0aGUgc2FtZSBrZXlzIGFzIGBvYmplY3RgIGFuZCB2YWx1ZXMgZ2VuZXJhdGVkIGJ5DQogICAgICogcnVubmluZyBlYWNoIG93biBlbnVtZXJhYmxlIHByb3BlcnR5IG9mIGBvYmplY3RgIHRocm91Z2ggYGl0ZXJhdGVlYC4gVGhlDQogICAgICogaXRlcmF0ZWUgZnVuY3Rpb24gaXMgYm91bmQgdG8gYHRoaXNBcmdgIGFuZCBpbnZva2VkIHdpdGggdGhyZWUgYXJndW1lbnRzOg0KICAgICAqICh2YWx1ZSwga2V5LCBvYmplY3QpLg0KICAgICAqDQogICAgICogSWYgYSBwcm9wZXJ0eSBuYW1lIGlzIHByb3ZpZGVkIGZvciBgaXRlcmF0ZWVgIHRoZSBjcmVhdGVkIGBfLnByb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlIG9mIHRoZSBnaXZlbiBlbGVtZW50Lg0KICAgICAqDQogICAgICogSWYgYSB2YWx1ZSBpcyBhbHNvIHByb3ZpZGVkIGZvciBgdGhpc0FyZ2AgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc1Byb3BlcnR5YA0KICAgICAqIHN0eWxlIGNhbGxiYWNrIHJldHVybnMgYHRydWVgIGZvciBlbGVtZW50cyB0aGF0IGhhdmUgYSBtYXRjaGluZyBwcm9wZXJ0eQ0KICAgICAqIHZhbHVlLCBlbHNlIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBJZiBhbiBvYmplY3QgaXMgcHJvdmlkZWQgZm9yIGBpdGVyYXRlZWAgdGhlIGNyZWF0ZWQgYF8ubWF0Y2hlc2Agc3R5bGUNCiAgICAgKiBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBnaXZlbg0KICAgICAqIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IE9iamVjdA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQNCiAgICAgKiAgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGl0ZXJhdGVlYC4NCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgbWFwcGVkIG9iamVjdC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5tYXBWYWx1ZXMoeyAnYSc6IDEsICdiJzogMiB9LCBmdW5jdGlvbihuKSB7DQogICAgICogICByZXR1cm4gbiAqIDM7DQogICAgICogfSk7DQogICAgICogLy8gPT4geyAnYSc6IDMsICdiJzogNiB9DQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSB7DQogICAgICogICAnZnJlZCc6ICAgIHsgJ3VzZXInOiAnZnJlZCcsICAgICdhZ2UnOiA0MCB9LA0KICAgICAqICAgJ3BlYmJsZXMnOiB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWdlJzogMSB9DQogICAgICogfTsNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5wcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5tYXBWYWx1ZXModXNlcnMsICdhZ2UnKTsNCiAgICAgKiAvLyA9PiB7ICdmcmVkJzogNDAsICdwZWJibGVzJzogMSB9IChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpDQogICAgICovDQogICAgdmFyIG1hcFZhbHVlcyA9IGNyZWF0ZU9iamVjdE1hcHBlcigpOw0KDQogICAgLyoqDQogICAgICogUmVjdXJzaXZlbHkgbWVyZ2VzIG93biBlbnVtZXJhYmxlIHByb3BlcnRpZXMgb2YgdGhlIHNvdXJjZSBvYmplY3QocyksIHRoYXQNCiAgICAgKiBkb24ndCByZXNvbHZlIHRvIGB1bmRlZmluZWRgIGludG8gdGhlIGRlc3RpbmF0aW9uIG9iamVjdC4gU3Vic2VxdWVudCBzb3VyY2VzDQogICAgICogb3ZlcndyaXRlIHByb3BlcnR5IGFzc2lnbm1lbnRzIG9mIHByZXZpb3VzIHNvdXJjZXMuIElmIGBjdXN0b21pemVyYCBpcw0KICAgICAqIHByb3ZpZGVkIGl0IGlzIGludm9rZWQgdG8gcHJvZHVjZSB0aGUgbWVyZ2VkIHZhbHVlcyBvZiB0aGUgZGVzdGluYXRpb24gYW5kDQogICAgICogc291cmNlIHByb3BlcnRpZXMuIElmIGBjdXN0b21pemVyYCByZXR1cm5zIGB1bmRlZmluZWRgIG1lcmdpbmcgaXMgaGFuZGxlZA0KICAgICAqIGJ5IHRoZSBtZXRob2QgaW5zdGVhZC4gVGhlIGBjdXN0b21pemVyYCBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQNCiAgICAgKiB3aXRoIGZpdmUgYXJndW1lbnRzOiAob2JqZWN0VmFsdWUsIHNvdXJjZVZhbHVlLCBrZXksIG9iamVjdCwgc291cmNlKS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBPYmplY3QNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuDQogICAgICogQHBhcmFtIHsuLi5PYmplY3R9IFtzb3VyY2VzXSBUaGUgc291cmNlIG9iamVjdHMuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgYXNzaWduZWQgdmFsdWVzLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY3VzdG9taXplcmAuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIHVzZXJzID0gew0KICAgICAqICAgJ2RhdGEnOiBbeyAndXNlcic6ICdiYXJuZXknIH0sIHsgJ3VzZXInOiAnZnJlZCcgfV0NCiAgICAgKiB9Ow0KICAgICAqDQogICAgICogdmFyIGFnZXMgPSB7DQogICAgICogICAnZGF0YSc6IFt7ICdhZ2UnOiAzNiB9LCB7ICdhZ2UnOiA0MCB9XQ0KICAgICAqIH07DQogICAgICoNCiAgICAgKiBfLm1lcmdlKHVzZXJzLCBhZ2VzKTsNCiAgICAgKiAvLyA9PiB7ICdkYXRhJzogW3sgJ3VzZXInOiAnYmFybmV5JywgJ2FnZSc6IDM2IH0sIHsgJ3VzZXInOiAnZnJlZCcsICdhZ2UnOiA0MCB9XSB9DQogICAgICoNCiAgICAgKiAvLyB1c2luZyBhIGN1c3RvbWl6ZXIgY2FsbGJhY2sNCiAgICAgKiB2YXIgb2JqZWN0ID0gew0KICAgICAqICAgJ2ZydWl0cyc6IFsnYXBwbGUnXSwNCiAgICAgKiAgICd2ZWdldGFibGVzJzogWydiZWV0J10NCiAgICAgKiB9Ow0KICAgICAqDQogICAgICogdmFyIG90aGVyID0gew0KICAgICAqICAgJ2ZydWl0cyc6IFsnYmFuYW5hJ10sDQogICAgICogICAndmVnZXRhYmxlcyc6IFsnY2Fycm90J10NCiAgICAgKiB9Ow0KICAgICAqDQogICAgICogXy5tZXJnZShvYmplY3QsIG90aGVyLCBmdW5jdGlvbihhLCBiKSB7DQogICAgICogICBpZiAoXy5pc0FycmF5KGEpKSB7DQogICAgICogICAgIHJldHVybiBhLmNvbmNhdChiKTsNCiAgICAgKiAgIH0NCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiB7ICdmcnVpdHMnOiBbJ2FwcGxlJywgJ2JhbmFuYSddLCAndmVnZXRhYmxlcyc6IFsnYmVldCcsICdjYXJyb3QnXSB9DQogICAgICovDQogICAgdmFyIG1lcmdlID0gY3JlYXRlQXNzaWduZXIoYmFzZU1lcmdlKTsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBvcHBvc2l0ZSBvZiBgXy5waWNrYDsgdGhpcyBtZXRob2QgY3JlYXRlcyBhbiBvYmplY3QgY29tcG9zZWQgb2YgdGhlDQogICAgICogb3duIGFuZCBpbmhlcml0ZWQgZW51bWVyYWJsZSBwcm9wZXJ0aWVzIG9mIGBvYmplY3RgIHRoYXQgYXJlIG5vdCBvbWl0dGVkLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IE9iamVjdA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIHNvdXJjZSBvYmplY3QuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnwuLi4oc3RyaW5nfHN0cmluZ1tdKX0gW3ByZWRpY2F0ZV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyDQogICAgICogIGl0ZXJhdGlvbiBvciBwcm9wZXJ0eSBuYW1lcyB0byBvbWl0LCBzcGVjaWZpZWQgYXMgaW5kaXZpZHVhbCBwcm9wZXJ0eQ0KICAgICAqICBuYW1lcyBvciBhcnJheXMgb2YgcHJvcGVydHkgbmFtZXMuDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBwcmVkaWNhdGVgLg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBvYmplY3QgPSB7ICd1c2VyJzogJ2ZyZWQnLCAnYWdlJzogNDAgfTsNCiAgICAgKg0KICAgICAqIF8ub21pdChvYmplY3QsICdhZ2UnKTsNCiAgICAgKiAvLyA9PiB7ICd1c2VyJzogJ2ZyZWQnIH0NCiAgICAgKg0KICAgICAqIF8ub21pdChvYmplY3QsIF8uaXNOdW1iZXIpOw0KICAgICAqIC8vID0+IHsgJ3VzZXInOiAnZnJlZCcgfQ0KICAgICAqLw0KICAgIHZhciBvbWl0ID0gcmVzdFBhcmFtKGZ1bmN0aW9uKG9iamVjdCwgcHJvcHMpIHsNCiAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4ge307DQogICAgICB9DQogICAgICBpZiAodHlwZW9mIHByb3BzWzBdICE9ICdmdW5jdGlvbicpIHsNCiAgICAgICAgdmFyIHByb3BzID0gYXJyYXlNYXAoYmFzZUZsYXR0ZW4ocHJvcHMpLCBTdHJpbmcpOw0KICAgICAgICByZXR1cm4gcGlja0J5QXJyYXkob2JqZWN0LCBiYXNlRGlmZmVyZW5jZShrZXlzSW4ob2JqZWN0KSwgcHJvcHMpKTsNCiAgICAgIH0NCiAgICAgIHZhciBwcmVkaWNhdGUgPSBiaW5kQ2FsbGJhY2socHJvcHNbMF0sIHByb3BzWzFdLCAzKTsNCiAgICAgIHJldHVybiBwaWNrQnlDYWxsYmFjayhvYmplY3QsIGZ1bmN0aW9uKHZhbHVlLCBrZXksIG9iamVjdCkgew0KICAgICAgICByZXR1cm4gIXByZWRpY2F0ZSh2YWx1ZSwga2V5LCBvYmplY3QpOw0KICAgICAgfSk7DQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgdHdvIGRpbWVuc2lvbmFsIGFycmF5IG9mIHRoZSBrZXktdmFsdWUgcGFpcnMgZm9yIGBvYmplY3RgLA0KICAgICAqIGUuZy4gYFtba2V5MSwgdmFsdWUxXSwgW2tleTIsIHZhbHVlMl1dYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBPYmplY3QNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2Yga2V5LXZhbHVlIHBhaXJzLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnBhaXJzKHsgJ2Jhcm5leSc6IDM2LCAnZnJlZCc6IDQwIH0pOw0KICAgICAqIC8vID0+IFtbJ2Jhcm5leScsIDM2XSwgWydmcmVkJywgNDBdXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHBhaXJzKG9iamVjdCkgew0KICAgICAgb2JqZWN0ID0gdG9PYmplY3Qob2JqZWN0KTsNCg0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgcHJvcHMgPSBrZXlzKG9iamVjdCksDQogICAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoLA0KICAgICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7DQoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07DQogICAgICAgIHJlc3VsdFtpbmRleF0gPSBba2V5LCBvYmplY3Rba2V5XV07DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYW4gb2JqZWN0IGNvbXBvc2VkIG9mIHRoZSBwaWNrZWQgYG9iamVjdGAgcHJvcGVydGllcy4gUHJvcGVydHkNCiAgICAgKiBuYW1lcyBtYXkgYmUgc3BlY2lmaWVkIGFzIGluZGl2aWR1YWwgYXJndW1lbnRzIG9yIGFzIGFycmF5cyBvZiBwcm9wZXJ0eQ0KICAgICAqIG5hbWVzLiBJZiBgcHJlZGljYXRlYCBpcyBwcm92aWRlZCBpdCBpcyBpbnZva2VkIGZvciBlYWNoIHByb3BlcnR5IG9mIGBvYmplY3RgDQogICAgICogcGlja2luZyB0aGUgcHJvcGVydGllcyBgcHJlZGljYXRlYCByZXR1cm5zIHRydXRoeSBmb3IuIFRoZSBwcmVkaWNhdGUgaXMNCiAgICAgKiBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwga2V5LCBvYmplY3QpLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IE9iamVjdA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIHNvdXJjZSBvYmplY3QuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnwuLi4oc3RyaW5nfHN0cmluZ1tdKX0gW3ByZWRpY2F0ZV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyDQogICAgICogIGl0ZXJhdGlvbiBvciBwcm9wZXJ0eSBuYW1lcyB0byBwaWNrLCBzcGVjaWZpZWQgYXMgaW5kaXZpZHVhbCBwcm9wZXJ0eQ0KICAgICAqICBuYW1lcyBvciBhcnJheXMgb2YgcHJvcGVydHkgbmFtZXMuDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBwcmVkaWNhdGVgLg0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBvYmplY3QgPSB7ICd1c2VyJzogJ2ZyZWQnLCAnYWdlJzogNDAgfTsNCiAgICAgKg0KICAgICAqIF8ucGljayhvYmplY3QsICd1c2VyJyk7DQogICAgICogLy8gPT4geyAndXNlcic6ICdmcmVkJyB9DQogICAgICoNCiAgICAgKiBfLnBpY2sob2JqZWN0LCBfLmlzU3RyaW5nKTsNCiAgICAgKiAvLyA9PiB7ICd1c2VyJzogJ2ZyZWQnIH0NCiAgICAgKi8NCiAgICB2YXIgcGljayA9IHJlc3RQYXJhbShmdW5jdGlvbihvYmplY3QsIHByb3BzKSB7DQogICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIHt9Ow0KICAgICAgfQ0KICAgICAgcmV0dXJuIHR5cGVvZiBwcm9wc1swXSA9PSAnZnVuY3Rpb24nDQogICAgICAgID8gcGlja0J5Q2FsbGJhY2sob2JqZWN0LCBiaW5kQ2FsbGJhY2socHJvcHNbMF0sIHByb3BzWzFdLCAzKSkNCiAgICAgICAgOiBwaWNrQnlBcnJheShvYmplY3QsIGJhc2VGbGF0dGVuKHByb3BzKSk7DQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmdldGAgZXhjZXB0IHRoYXQgaWYgdGhlIHJlc29sdmVkIHZhbHVlIGlzIGEgZnVuY3Rpb24NCiAgICAgKiBpdCBpcyBpbnZva2VkIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIGl0cyBwYXJlbnQgb2JqZWN0IGFuZCBpdHMgcmVzdWx0DQogICAgICogaXMgcmV0dXJuZWQuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0DQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5Lg0KICAgICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIG9mIHRoZSBwcm9wZXJ0eSB0byByZXNvbHZlLg0KICAgICAqIEBwYXJhbSB7Kn0gW2RlZmF1bHRWYWx1ZV0gVGhlIHZhbHVlIHJldHVybmVkIGlmIHRoZSByZXNvbHZlZCB2YWx1ZSBpcyBgdW5kZWZpbmVkYC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmVzb2x2ZWQgdmFsdWUuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBvYmplY3QgPSB7ICdhJzogW3sgJ2InOiB7ICdjMSc6IDMsICdjMic6IF8uY29uc3RhbnQoNCkgfSB9XSB9Ow0KICAgICAqDQogICAgICogXy5yZXN1bHQob2JqZWN0LCAnYVswXS5iLmMxJyk7DQogICAgICogLy8gPT4gMw0KICAgICAqDQogICAgICogXy5yZXN1bHQob2JqZWN0LCAnYVswXS5iLmMyJyk7DQogICAgICogLy8gPT4gNA0KICAgICAqDQogICAgICogXy5yZXN1bHQob2JqZWN0LCAnYS5iLmMnLCAnZGVmYXVsdCcpOw0KICAgICAqIC8vID0+ICdkZWZhdWx0Jw0KICAgICAqDQogICAgICogXy5yZXN1bHQob2JqZWN0LCAnYS5iLmMnLCBfLmNvbnN0YW50KCdkZWZhdWx0JykpOw0KICAgICAqIC8vID0+ICdkZWZhdWx0Jw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlc3VsdChvYmplY3QsIHBhdGgsIGRlZmF1bHRWYWx1ZSkgew0KICAgICAgdmFyIHJlc3VsdCA9IG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogb2JqZWN0W3BhdGhdOw0KICAgICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIGlmIChvYmplY3QgIT0gbnVsbCAmJiAhaXNLZXkocGF0aCwgb2JqZWN0KSkgew0KICAgICAgICAgIHBhdGggPSB0b1BhdGgocGF0aCk7DQogICAgICAgICAgb2JqZWN0ID0gcGF0aC5sZW5ndGggPT0gMSA/IG9iamVjdCA6IGJhc2VHZXQob2JqZWN0LCBiYXNlU2xpY2UocGF0aCwgMCwgLTEpKTsNCiAgICAgICAgICByZXN1bHQgPSBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtsYXN0KHBhdGgpXTsNCiAgICAgICAgfQ0KICAgICAgICByZXN1bHQgPSByZXN1bHQgPT09IHVuZGVmaW5lZCA/IGRlZmF1bHRWYWx1ZSA6IHJlc3VsdDsNCiAgICAgIH0NCiAgICAgIHJldHVybiBpc0Z1bmN0aW9uKHJlc3VsdCkgPyByZXN1bHQuY2FsbChvYmplY3QpIDogcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNldHMgdGhlIHByb3BlcnR5IHZhbHVlIG9mIGBwYXRoYCBvbiBgb2JqZWN0YC4gSWYgYSBwb3J0aW9uIG9mIGBwYXRoYA0KICAgICAqIGRvZXMgbm90IGV4aXN0IGl0IGlzIGNyZWF0ZWQuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0DQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGF1Z21lbnQuDQogICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIHNldC4NCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuDQogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiBbeyAnYic6IHsgJ2MnOiAzIH0gfV0gfTsNCiAgICAgKg0KICAgICAqIF8uc2V0KG9iamVjdCwgJ2FbMF0uYi5jJywgNCk7DQogICAgICogY29uc29sZS5sb2cob2JqZWN0LmFbMF0uYi5jKTsNCiAgICAgKiAvLyA9PiA0DQogICAgICoNCiAgICAgKiBfLnNldChvYmplY3QsICd4WzBdLnkueicsIDUpOw0KICAgICAqIGNvbnNvbGUubG9nKG9iamVjdC54WzBdLnkueik7DQogICAgICogLy8gPT4gNQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNldChvYmplY3QsIHBhdGgsIHZhbHVlKSB7DQogICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIG9iamVjdDsNCiAgICAgIH0NCiAgICAgIHZhciBwYXRoS2V5ID0gKHBhdGggKyAnJyk7DQogICAgICBwYXRoID0gKG9iamVjdFtwYXRoS2V5XSAhPSBudWxsIHx8IGlzS2V5KHBhdGgsIG9iamVjdCkpID8gW3BhdGhLZXldIDogdG9QYXRoKHBhdGgpOw0KDQogICAgICB2YXIgaW5kZXggPSAtMSwNCiAgICAgICAgICBsZW5ndGggPSBwYXRoLmxlbmd0aCwNCiAgICAgICAgICBsYXN0SW5kZXggPSBsZW5ndGggLSAxLA0KICAgICAgICAgIG5lc3RlZCA9IG9iamVjdDsNCg0KICAgICAgd2hpbGUgKG5lc3RlZCAhPSBudWxsICYmICsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgdmFyIGtleSA9IHBhdGhbaW5kZXhdOw0KICAgICAgICBpZiAoaXNPYmplY3QobmVzdGVkKSkgew0KICAgICAgICAgIGlmIChpbmRleCA9PSBsYXN0SW5kZXgpIHsNCiAgICAgICAgICAgIG5lc3RlZFtrZXldID0gdmFsdWU7DQogICAgICAgICAgfSBlbHNlIGlmIChuZXN0ZWRba2V5XSA9PSBudWxsKSB7DQogICAgICAgICAgICBuZXN0ZWRba2V5XSA9IGlzSW5kZXgocGF0aFtpbmRleCArIDFdKSA/IFtdIDoge307DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIG5lc3RlZCA9IG5lc3RlZFtrZXldOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIG9iamVjdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBbiBhbHRlcm5hdGl2ZSB0byBgXy5yZWR1Y2VgOyB0aGlzIG1ldGhvZCB0cmFuc2Zvcm1zIGBvYmplY3RgIHRvIGEgbmV3DQogICAgICogYGFjY3VtdWxhdG9yYCBvYmplY3Qgd2hpY2ggaXMgdGhlIHJlc3VsdCBvZiBydW5uaW5nIGVhY2ggb2YgaXRzIG93biBlbnVtZXJhYmxlDQogICAgICogcHJvcGVydGllcyB0aHJvdWdoIGBpdGVyYXRlZWAsIHdpdGggZWFjaCBpbnZvY2F0aW9uIHBvdGVudGlhbGx5IG11dGF0aW5nDQogICAgICogdGhlIGBhY2N1bXVsYXRvcmAgb2JqZWN0LiBUaGUgYGl0ZXJhdGVlYCBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQNCiAgICAgKiB3aXRoIGZvdXIgYXJndW1lbnRzOiAoYWNjdW11bGF0b3IsIHZhbHVlLCBrZXksIG9iamVjdCkuIEl0ZXJhdGVlIGZ1bmN0aW9ucw0KICAgICAqIG1heSBleGl0IGl0ZXJhdGlvbiBlYXJseSBieSBleHBsaWNpdGx5IHJldHVybmluZyBgZmFsc2VgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IE9iamVjdA0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbYWNjdW11bGF0b3JdIFRoZSBjdXN0b20gYWNjdW11bGF0b3IgdmFsdWUuDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBpdGVyYXRlZWAuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGFjY3VtdWxhdGVkIHZhbHVlLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnRyYW5zZm9ybShbMiwgMywgNF0sIGZ1bmN0aW9uKHJlc3VsdCwgbikgew0KICAgICAqICAgcmVzdWx0LnB1c2gobiAqPSBuKTsNCiAgICAgKiAgIHJldHVybiBuICUgMiA9PSAwOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IFs0LCA5XQ0KICAgICAqDQogICAgICogXy50cmFuc2Zvcm0oeyAnYSc6IDEsICdiJzogMiB9LCBmdW5jdGlvbihyZXN1bHQsIG4sIGtleSkgew0KICAgICAqICAgcmVzdWx0W2tleV0gPSBuICogMzsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiB7ICdhJzogMywgJ2InOiA2IH0NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2Zvcm0ob2JqZWN0LCBpdGVyYXRlZSwgYWNjdW11bGF0b3IsIHRoaXNBcmcpIHsNCiAgICAgIHZhciBpc0FyciA9IGlzQXJyYXkob2JqZWN0KSB8fCBpc1R5cGVkQXJyYXkob2JqZWN0KTsNCiAgICAgIGl0ZXJhdGVlID0gZ2V0Q2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDQpOw0KDQogICAgICBpZiAoYWNjdW11bGF0b3IgPT0gbnVsbCkgew0KICAgICAgICBpZiAoaXNBcnIgfHwgaXNPYmplY3Qob2JqZWN0KSkgew0KICAgICAgICAgIHZhciBDdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yOw0KICAgICAgICAgIGlmIChpc0Fycikgew0KICAgICAgICAgICAgYWNjdW11bGF0b3IgPSBpc0FycmF5KG9iamVjdCkgPyBuZXcgQ3RvciA6IFtdOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBhY2N1bXVsYXRvciA9IGJhc2VDcmVhdGUoaXNGdW5jdGlvbihDdG9yKSA/IEN0b3IucHJvdG90eXBlIDogbnVsbCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGFjY3VtdWxhdG9yID0ge307DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIChpc0FyciA/IGFycmF5RWFjaCA6IGJhc2VGb3JPd24pKG9iamVjdCwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBvYmplY3QpIHsNCiAgICAgICAgcmV0dXJuIGl0ZXJhdGVlKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaW5kZXgsIG9iamVjdCk7DQogICAgICB9KTsNCiAgICAgIHJldHVybiBhY2N1bXVsYXRvcjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSB2YWx1ZXMgb2YgYG9iamVjdGAuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogTm9uLW9iamVjdCB2YWx1ZXMgYXJlIGNvZXJjZWQgdG8gb2JqZWN0cy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBPYmplY3QNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuDQogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSB2YWx1ZXMuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIGZ1bmN0aW9uIEZvbygpIHsNCiAgICAgKiAgIHRoaXMuYSA9IDE7DQogICAgICogICB0aGlzLmIgPSAyOw0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIEZvby5wcm90b3R5cGUuYyA9IDM7DQogICAgICoNCiAgICAgKiBfLnZhbHVlcyhuZXcgRm9vKTsNCiAgICAgKiAvLyA9PiBbMSwgMl0gKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkNCiAgICAgKg0KICAgICAqIF8udmFsdWVzKCdoaScpOw0KICAgICAqIC8vID0+IFsnaCcsICdpJ10NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB2YWx1ZXMob2JqZWN0KSB7DQogICAgICByZXR1cm4gYmFzZVZhbHVlcyhvYmplY3QsIGtleXMob2JqZWN0KSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGFuZCBpbmhlcml0ZWQgZW51bWVyYWJsZSBwcm9wZXJ0eSB2YWx1ZXMNCiAgICAgKiBvZiBgb2JqZWN0YC4NCiAgICAgKg0KICAgICAqICoqTm90ZToqKiBOb24tb2JqZWN0IHZhbHVlcyBhcmUgY29lcmNlZCB0byBvYmplY3RzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IE9iamVjdA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IHZhbHVlcy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogZnVuY3Rpb24gRm9vKCkgew0KICAgICAqICAgdGhpcy5hID0gMTsNCiAgICAgKiAgIHRoaXMuYiA9IDI7DQogICAgICogfQ0KICAgICAqDQogICAgICogRm9vLnByb3RvdHlwZS5jID0gMzsNCiAgICAgKg0KICAgICAqIF8udmFsdWVzSW4obmV3IEZvbyk7DQogICAgICogLy8gPT4gWzEsIDIsIDNdIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpDQogICAgICovDQogICAgZnVuY3Rpb24gdmFsdWVzSW4ob2JqZWN0KSB7DQogICAgICByZXR1cm4gYmFzZVZhbHVlcyhvYmplY3QsIGtleXNJbihvYmplY3QpKTsNCiAgICB9DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgYG5gIGlzIGJldHdlZW4gYHN0YXJ0YCBhbmQgdXAgdG8gYnV0IG5vdCBpbmNsdWRpbmcsIGBlbmRgLiBJZg0KICAgICAqIGBlbmRgIGlzIG5vdCBzcGVjaWZpZWQgaXQgaXMgc2V0IHRvIGBzdGFydGAgd2l0aCBgc3RhcnRgIHRoZW4gc2V0IHRvIGAwYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBOdW1iZXINCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbiBUaGUgbnVtYmVyIHRvIGNoZWNrLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RhcnQ9MF0gVGhlIHN0YXJ0IG9mIHRoZSByYW5nZS4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gZW5kIFRoZSBlbmQgb2YgdGhlIHJhbmdlLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgbmAgaXMgaW4gdGhlIHJhbmdlLCBlbHNlIGBmYWxzZWAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uaW5SYW5nZSgzLCAyLCA0KTsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICoNCiAgICAgKiBfLmluUmFuZ2UoNCwgOCk7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqDQogICAgICogXy5pblJhbmdlKDQsIDIpOw0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICoNCiAgICAgKiBfLmluUmFuZ2UoMiwgMik7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKg0KICAgICAqIF8uaW5SYW5nZSgxLjIsIDIpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uaW5SYW5nZSg1LjIsIDQpOw0KICAgICAqIC8vID0+IGZhbHNlDQogICAgICovDQogICAgZnVuY3Rpb24gaW5SYW5nZSh2YWx1ZSwgc3RhcnQsIGVuZCkgew0KICAgICAgc3RhcnQgPSArc3RhcnQgfHwgMDsNCiAgICAgIGlmICh0eXBlb2YgZW5kID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICBlbmQgPSBzdGFydDsNCiAgICAgICAgc3RhcnQgPSAwOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZW5kID0gK2VuZCB8fCAwOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHZhbHVlID49IG5hdGl2ZU1pbihzdGFydCwgZW5kKSAmJiB2YWx1ZSA8IG5hdGl2ZU1heChzdGFydCwgZW5kKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBQcm9kdWNlcyBhIHJhbmRvbSBudW1iZXIgYmV0d2VlbiBgbWluYCBhbmQgYG1heGAgKGluY2x1c2l2ZSkuIElmIG9ubHkgb25lDQogICAgICogYXJndW1lbnQgaXMgcHJvdmlkZWQgYSBudW1iZXIgYmV0d2VlbiBgMGAgYW5kIHRoZSBnaXZlbiBudW1iZXIgaXMgcmV0dXJuZWQuDQogICAgICogSWYgYGZsb2F0aW5nYCBpcyBgdHJ1ZWAsIG9yIGVpdGhlciBgbWluYCBvciBgbWF4YCBhcmUgZmxvYXRzLCBhIGZsb2F0aW5nLXBvaW50DQogICAgICogbnVtYmVyIGlzIHJldHVybmVkIGluc3RlYWQgb2YgYW4gaW50ZWdlci4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBOdW1iZXINCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW21pbj0wXSBUaGUgbWluaW11bSBwb3NzaWJsZSB2YWx1ZS4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW21heD0xXSBUaGUgbWF4aW11bSBwb3NzaWJsZSB2YWx1ZS4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtmbG9hdGluZ10gU3BlY2lmeSByZXR1cm5pbmcgYSBmbG9hdGluZy1wb2ludCBudW1iZXIuDQogICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgcmFuZG9tIG51bWJlci4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5yYW5kb20oMCwgNSk7DQogICAgICogLy8gPT4gYW4gaW50ZWdlciBiZXR3ZWVuIDAgYW5kIDUNCiAgICAgKg0KICAgICAqIF8ucmFuZG9tKDUpOw0KICAgICAqIC8vID0+IGFsc28gYW4gaW50ZWdlciBiZXR3ZWVuIDAgYW5kIDUNCiAgICAgKg0KICAgICAqIF8ucmFuZG9tKDUsIHRydWUpOw0KICAgICAqIC8vID0+IGEgZmxvYXRpbmctcG9pbnQgbnVtYmVyIGJldHdlZW4gMCBhbmQgNQ0KICAgICAqDQogICAgICogXy5yYW5kb20oMS4yLCA1LjIpOw0KICAgICAqIC8vID0+IGEgZmxvYXRpbmctcG9pbnQgbnVtYmVyIGJldHdlZW4gMS4yIGFuZCA1LjINCiAgICAgKi8NCiAgICBmdW5jdGlvbiByYW5kb20obWluLCBtYXgsIGZsb2F0aW5nKSB7DQogICAgICBpZiAoZmxvYXRpbmcgJiYgaXNJdGVyYXRlZUNhbGwobWluLCBtYXgsIGZsb2F0aW5nKSkgew0KICAgICAgICBtYXggPSBmbG9hdGluZyA9IG51bGw7DQogICAgICB9DQogICAgICB2YXIgbm9NaW4gPSBtaW4gPT0gbnVsbCwNCiAgICAgICAgICBub01heCA9IG1heCA9PSBudWxsOw0KDQogICAgICBpZiAoZmxvYXRpbmcgPT0gbnVsbCkgew0KICAgICAgICBpZiAobm9NYXggJiYgdHlwZW9mIG1pbiA9PSAnYm9vbGVhbicpIHsNCiAgICAgICAgICBmbG9hdGluZyA9IG1pbjsNCiAgICAgICAgICBtaW4gPSAxOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHR5cGVvZiBtYXggPT0gJ2Jvb2xlYW4nKSB7DQogICAgICAgICAgZmxvYXRpbmcgPSBtYXg7DQogICAgICAgICAgbm9NYXggPSB0cnVlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBpZiAobm9NaW4gJiYgbm9NYXgpIHsNCiAgICAgICAgbWF4ID0gMTsNCiAgICAgICAgbm9NYXggPSBmYWxzZTsNCiAgICAgIH0NCiAgICAgIG1pbiA9ICttaW4gfHwgMDsNCiAgICAgIGlmIChub01heCkgew0KICAgICAgICBtYXggPSBtaW47DQogICAgICAgIG1pbiA9IDA7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBtYXggPSArbWF4IHx8IDA7DQogICAgICB9DQogICAgICBpZiAoZmxvYXRpbmcgfHwgbWluICUgMSB8fCBtYXggJSAxKSB7DQogICAgICAgIHZhciByYW5kID0gbmF0aXZlUmFuZG9tKCk7DQogICAgICAgIHJldHVybiBuYXRpdmVNaW4obWluICsgKHJhbmQgKiAobWF4IC0gbWluICsgcGFyc2VGbG9hdCgnMWUtJyArICgocmFuZCArICcnKS5sZW5ndGggLSAxKSkpKSwgbWF4KTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBiYXNlUmFuZG9tKG1pbiwgbWF4KTsNCiAgICB9DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvKioNCiAgICAgKiBDb252ZXJ0cyBgc3RyaW5nYCB0byBbY2FtZWwgY2FzZV0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ2FtZWxDYXNlKS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBTdHJpbmcNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBjb252ZXJ0Lg0KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNhbWVsIGNhc2VkIHN0cmluZy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5jYW1lbENhc2UoJ0ZvbyBCYXInKTsNCiAgICAgKiAvLyA9PiAnZm9vQmFyJw0KICAgICAqDQogICAgICogXy5jYW1lbENhc2UoJy0tZm9vLWJhcicpOw0KICAgICAqIC8vID0+ICdmb29CYXInDQogICAgICoNCiAgICAgKiBfLmNhbWVsQ2FzZSgnX19mb29fYmFyX18nKTsNCiAgICAgKiAvLyA9PiAnZm9vQmFyJw0KICAgICAqLw0KICAgIHZhciBjYW1lbENhc2UgPSBjcmVhdGVDb21wb3VuZGVyKGZ1bmN0aW9uKHJlc3VsdCwgd29yZCwgaW5kZXgpIHsNCiAgICAgIHdvcmQgPSB3b3JkLnRvTG93ZXJDYXNlKCk7DQogICAgICByZXR1cm4gcmVzdWx0ICsgKGluZGV4ID8gKHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpKSA6IHdvcmQpOw0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQ2FwaXRhbGl6ZXMgdGhlIGZpcnN0IGNoYXJhY3RlciBvZiBgc3RyaW5nYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBTdHJpbmcNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBjYXBpdGFsaXplLg0KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNhcGl0YWxpemVkIHN0cmluZy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5jYXBpdGFsaXplKCdmcmVkJyk7DQogICAgICogLy8gPT4gJ0ZyZWQnDQogICAgICovDQogICAgZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHJpbmcpIHsNCiAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOw0KICAgICAgcmV0dXJuIHN0cmluZyAmJiAoc3RyaW5nLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3RyaW5nLnNsaWNlKDEpKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBEZWJ1cnJzIGBzdHJpbmdgIGJ5IGNvbnZlcnRpbmcgW2xhdGluLTEgc3VwcGxlbWVudGFyeSBsZXR0ZXJzXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MYXRpbi0xX1N1cHBsZW1lbnRfKFVuaWNvZGVfYmxvY2spI0NoYXJhY3Rlcl90YWJsZSkNCiAgICAgKiB0byBiYXNpYyBsYXRpbiBsZXR0ZXJzIGFuZCByZW1vdmluZyBbY29tYmluaW5nIGRpYWNyaXRpY2FsIG1hcmtzXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Db21iaW5pbmdfRGlhY3JpdGljYWxfTWFya3MpLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFN0cmluZw0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIGRlYnVyci4NCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBkZWJ1cnJlZCBzdHJpbmcuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uZGVidXJyKCdkw6lqw6AgdnUnKTsNCiAgICAgKiAvLyA9PiAnZGVqYSB2dScNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBkZWJ1cnIoc3RyaW5nKSB7DQogICAgICBzdHJpbmcgPSBiYXNlVG9TdHJpbmcoc3RyaW5nKTsNCiAgICAgIHJldHVybiBzdHJpbmcgJiYgc3RyaW5nLnJlcGxhY2UocmVMYXRpbjEsIGRlYnVyckxldHRlcikucmVwbGFjZShyZUNvbWJvTWFyaywgJycpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgc3RyaW5nYCBlbmRzIHdpdGggdGhlIGdpdmVuIHRhcmdldCBzdHJpbmcuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gc2VhcmNoLg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbdGFyZ2V0XSBUaGUgc3RyaW5nIHRvIHNlYXJjaCBmb3IuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtwb3NpdGlvbj1zdHJpbmcubGVuZ3RoXSBUaGUgcG9zaXRpb24gdG8gc2VhcmNoIGZyb20uDQogICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBzdHJpbmdgIGVuZHMgd2l0aCBgdGFyZ2V0YCwgZWxzZSBgZmFsc2VgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLmVuZHNXaXRoKCdhYmMnLCAnYycpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uZW5kc1dpdGgoJ2FiYycsICdiJyk7DQogICAgICogLy8gPT4gZmFsc2UNCiAgICAgKg0KICAgICAqIF8uZW5kc1dpdGgoJ2FiYycsICdiJywgMik7DQogICAgICogLy8gPT4gdHJ1ZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVuZHNXaXRoKHN0cmluZywgdGFyZ2V0LCBwb3NpdGlvbikgew0KICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7DQogICAgICB0YXJnZXQgPSAodGFyZ2V0ICsgJycpOw0KDQogICAgICB2YXIgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aDsNCiAgICAgIHBvc2l0aW9uID0gcG9zaXRpb24gPT09IHVuZGVmaW5lZA0KICAgICAgICA/IGxlbmd0aA0KICAgICAgICA6IG5hdGl2ZU1pbihwb3NpdGlvbiA8IDAgPyAwIDogKCtwb3NpdGlvbiB8fCAwKSwgbGVuZ3RoKTsNCg0KICAgICAgcG9zaXRpb24gLT0gdGFyZ2V0Lmxlbmd0aDsNCiAgICAgIHJldHVybiBwb3NpdGlvbiA+PSAwICYmIHN0cmluZy5pbmRleE9mKHRhcmdldCwgcG9zaXRpb24pID09IHBvc2l0aW9uOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnRzIHRoZSBjaGFyYWN0ZXJzICImIiwgIjwiLCAiPiIsICciJywgIiciLCBhbmQgIlxgIiwgaW4gYHN0cmluZ2AgdG8NCiAgICAgKiB0aGVpciBjb3JyZXNwb25kaW5nIEhUTUwgZW50aXRpZXMuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogTm8gb3RoZXIgY2hhcmFjdGVycyBhcmUgZXNjYXBlZC4gVG8gZXNjYXBlIGFkZGl0aW9uYWwgY2hhcmFjdGVycw0KICAgICAqIHVzZSBhIHRoaXJkLXBhcnR5IGxpYnJhcnkgbGlrZSBbX2hlX10oaHR0cHM6Ly9tdGhzLmJlL2hlKS4NCiAgICAgKg0KICAgICAqIFRob3VnaCB0aGUgIj4iIGNoYXJhY3RlciBpcyBlc2NhcGVkIGZvciBzeW1tZXRyeSwgY2hhcmFjdGVycyBsaWtlDQogICAgICogIj4iIGFuZCAiLyIgZG9uJ3QgbmVlZCBlc2NhcGluZyBpbiBIVE1MIGFuZCBoYXZlIG5vIHNwZWNpYWwgbWVhbmluZw0KICAgICAqIHVubGVzcyB0aGV5J3JlIHBhcnQgb2YgYSB0YWcgb3IgdW5xdW90ZWQgYXR0cmlidXRlIHZhbHVlLg0KICAgICAqIFNlZSBbTWF0aGlhcyBCeW5lbnMncyBhcnRpY2xlXShodHRwczovL21hdGhpYXNieW5lbnMuYmUvbm90ZXMvYW1iaWd1b3VzLWFtcGVyc2FuZHMpDQogICAgICogKHVuZGVyICJzZW1pLXJlbGF0ZWQgZnVuIGZhY3QiKSBmb3IgbW9yZSBkZXRhaWxzLg0KICAgICAqDQogICAgICogQmFja3RpY2tzIGFyZSBlc2NhcGVkIGJlY2F1c2UgaW4gSW50ZXJuZXQgRXhwbG9yZXIgPCA5LCB0aGV5IGNhbiBicmVhayBvdXQNCiAgICAgKiBvZiBhdHRyaWJ1dGUgdmFsdWVzIG9yIEhUTUwgY29tbWVudHMuIFNlZSBbIzU5XShodHRwczovL2h0bWw1c2VjLm9yZy8jNTkpLA0KICAgICAqIFsjMTAyXShodHRwczovL2h0bWw1c2VjLm9yZy8jMTAyKSwgWyMxMDhdKGh0dHBzOi8vaHRtbDVzZWMub3JnLyMxMDgpLCBhbmQNCiAgICAgKiBbIzEzM10oaHR0cHM6Ly9odG1sNXNlYy5vcmcvIzEzMykgb2YgdGhlIFtIVE1MNSBTZWN1cml0eSBDaGVhdHNoZWV0XShodHRwczovL2h0bWw1c2VjLm9yZy8pDQogICAgICogZm9yIG1vcmUgZGV0YWlscy4NCiAgICAgKg0KICAgICAqIFdoZW4gd29ya2luZyB3aXRoIEhUTUwgeW91IHNob3VsZCBhbHdheXMgW3F1b3RlIGF0dHJpYnV0ZSB2YWx1ZXNdKGh0dHA6Ly93b25rby5jb20vcG9zdC9odG1sLWVzY2FwaW5nKQ0KICAgICAqIHRvIHJlZHVjZSBYU1MgdmVjdG9ycy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBTdHJpbmcNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBlc2NhcGUuDQogICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgZXNjYXBlZCBzdHJpbmcuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uZXNjYXBlKCdmcmVkLCBiYXJuZXksICYgcGViYmxlcycpOw0KICAgICAqIC8vID0+ICdmcmVkLCBiYXJuZXksICZhbXA7IHBlYmJsZXMnDQogICAgICovDQogICAgZnVuY3Rpb24gZXNjYXBlKHN0cmluZykgew0KICAgICAgLy8gUmVzZXQgYGxhc3RJbmRleGAgYmVjYXVzZSBpbiBJRSA8IDkgYFN0cmluZyNyZXBsYWNlYCBkb2VzIG5vdC4NCiAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOw0KICAgICAgcmV0dXJuIChzdHJpbmcgJiYgcmVIYXNVbmVzY2FwZWRIdG1sLnRlc3Qoc3RyaW5nKSkNCiAgICAgICAgPyBzdHJpbmcucmVwbGFjZShyZVVuZXNjYXBlZEh0bWwsIGVzY2FwZUh0bWxDaGFyKQ0KICAgICAgICA6IHN0cmluZzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBFc2NhcGVzIHRoZSBgUmVnRXhwYCBzcGVjaWFsIGNoYXJhY3RlcnMgIlwiLCAiLyIsICJeIiwgIiQiLCAiLiIsICJ8IiwgIj8iLA0KICAgICAqICIqIiwgIisiLCAiKCIsICIpIiwgIlsiLCAiXSIsICJ7IiBhbmQgIn0iIGluIGBzdHJpbmdgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFN0cmluZw0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIGVzY2FwZS4NCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBlc2NhcGVkIHN0cmluZy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5lc2NhcGVSZWdFeHAoJ1tsb2Rhc2hdKGh0dHBzOi8vbG9kYXNoLmNvbS8pJyk7DQogICAgICogLy8gPT4gJ1xbbG9kYXNoXF1cKGh0dHBzOlwvXC9sb2Rhc2hcLmNvbVwvXCknDQogICAgICovDQogICAgZnVuY3Rpb24gZXNjYXBlUmVnRXhwKHN0cmluZykgew0KICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7DQogICAgICByZXR1cm4gKHN0cmluZyAmJiByZUhhc1JlZ0V4cENoYXJzLnRlc3Qoc3RyaW5nKSkNCiAgICAgICAgPyBzdHJpbmcucmVwbGFjZShyZVJlZ0V4cENoYXJzLCAnXFwkJicpDQogICAgICAgIDogc3RyaW5nOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnRzIGBzdHJpbmdgIHRvIFtrZWJhYiBjYXNlXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MZXR0ZXJfY2FzZSNTcGVjaWFsX2Nhc2Vfc3R5bGVzKS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBTdHJpbmcNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBjb252ZXJ0Lg0KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGtlYmFiIGNhc2VkIHN0cmluZy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5rZWJhYkNhc2UoJ0ZvbyBCYXInKTsNCiAgICAgKiAvLyA9PiAnZm9vLWJhcicNCiAgICAgKg0KICAgICAqIF8ua2ViYWJDYXNlKCdmb29CYXInKTsNCiAgICAgKiAvLyA9PiAnZm9vLWJhcicNCiAgICAgKg0KICAgICAqIF8ua2ViYWJDYXNlKCdfX2Zvb19iYXJfXycpOw0KICAgICAqIC8vID0+ICdmb28tYmFyJw0KICAgICAqLw0KICAgIHZhciBrZWJhYkNhc2UgPSBjcmVhdGVDb21wb3VuZGVyKGZ1bmN0aW9uKHJlc3VsdCwgd29yZCwgaW5kZXgpIHsNCiAgICAgIHJldHVybiByZXN1bHQgKyAoaW5kZXggPyAnLScgOiAnJykgKyB3b3JkLnRvTG93ZXJDYXNlKCk7DQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBQYWRzIGBzdHJpbmdgIG9uIHRoZSBsZWZ0IGFuZCByaWdodCBzaWRlcyBpZiBpdCdzIHNob3J0ZXIgdGhhbiBgbGVuZ3RoYC4NCiAgICAgKiBQYWRkaW5nIGNoYXJhY3RlcnMgYXJlIHRydW5jYXRlZCBpZiB0aGV5IGNhbid0IGJlIGV2ZW5seSBkaXZpZGVkIGJ5IGBsZW5ndGhgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFN0cmluZw0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHBhZC4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2xlbmd0aD0wXSBUaGUgcGFkZGluZyBsZW5ndGguDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtjaGFycz0nICddIFRoZSBzdHJpbmcgdXNlZCBhcyBwYWRkaW5nLg0KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHBhZGRlZCBzdHJpbmcuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8ucGFkKCdhYmMnLCA4KTsNCiAgICAgKiAvLyA9PiAnICBhYmMgICAnDQogICAgICoNCiAgICAgKiBfLnBhZCgnYWJjJywgOCwgJ18tJyk7DQogICAgICogLy8gPT4gJ18tYWJjXy1fJw0KICAgICAqDQogICAgICogXy5wYWQoJ2FiYycsIDMpOw0KICAgICAqIC8vID0+ICdhYmMnDQogICAgICovDQogICAgZnVuY3Rpb24gcGFkKHN0cmluZywgbGVuZ3RoLCBjaGFycykgew0KICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7DQogICAgICBsZW5ndGggPSArbGVuZ3RoOw0KDQogICAgICB2YXIgc3RyTGVuZ3RoID0gc3RyaW5nLmxlbmd0aDsNCiAgICAgIGlmIChzdHJMZW5ndGggPj0gbGVuZ3RoIHx8ICFuYXRpdmVJc0Zpbml0ZShsZW5ndGgpKSB7DQogICAgICAgIHJldHVybiBzdHJpbmc7DQogICAgICB9DQogICAgICB2YXIgbWlkID0gKGxlbmd0aCAtIHN0ckxlbmd0aCkgLyAyLA0KICAgICAgICAgIGxlZnRMZW5ndGggPSBmbG9vcihtaWQpLA0KICAgICAgICAgIHJpZ2h0TGVuZ3RoID0gY2VpbChtaWQpOw0KDQogICAgICBjaGFycyA9IGNyZWF0ZVBhZGRpbmcoJycsIHJpZ2h0TGVuZ3RoLCBjaGFycyk7DQogICAgICByZXR1cm4gY2hhcnMuc2xpY2UoMCwgbGVmdExlbmd0aCkgKyBzdHJpbmcgKyBjaGFyczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBQYWRzIGBzdHJpbmdgIG9uIHRoZSBsZWZ0IHNpZGUgaWYgaXQncyBzaG9ydGVyIHRoYW4gYGxlbmd0aGAuIFBhZGRpbmcNCiAgICAgKiBjaGFyYWN0ZXJzIGFyZSB0cnVuY2F0ZWQgaWYgdGhleSBleGNlZWQgYGxlbmd0aGAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gcGFkLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbGVuZ3RoPTBdIFRoZSBwYWRkaW5nIGxlbmd0aC4NCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2NoYXJzPScgJ10gVGhlIHN0cmluZyB1c2VkIGFzIHBhZGRpbmcuDQogICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgcGFkZGVkIHN0cmluZy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5wYWRMZWZ0KCdhYmMnLCA2KTsNCiAgICAgKiAvLyA9PiAnICAgYWJjJw0KICAgICAqDQogICAgICogXy5wYWRMZWZ0KCdhYmMnLCA2LCAnXy0nKTsNCiAgICAgKiAvLyA9PiAnXy1fYWJjJw0KICAgICAqDQogICAgICogXy5wYWRMZWZ0KCdhYmMnLCAzKTsNCiAgICAgKiAvLyA9PiAnYWJjJw0KICAgICAqLw0KICAgIHZhciBwYWRMZWZ0ID0gY3JlYXRlUGFkRGlyKCk7DQoNCiAgICAvKioNCiAgICAgKiBQYWRzIGBzdHJpbmdgIG9uIHRoZSByaWdodCBzaWRlIGlmIGl0J3Mgc2hvcnRlciB0aGFuIGBsZW5ndGhgLiBQYWRkaW5nDQogICAgICogY2hhcmFjdGVycyBhcmUgdHJ1bmNhdGVkIGlmIHRoZXkgZXhjZWVkIGBsZW5ndGhgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFN0cmluZw0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHBhZC4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2xlbmd0aD0wXSBUaGUgcGFkZGluZyBsZW5ndGguDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtjaGFycz0nICddIFRoZSBzdHJpbmcgdXNlZCBhcyBwYWRkaW5nLg0KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHBhZGRlZCBzdHJpbmcuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8ucGFkUmlnaHQoJ2FiYycsIDYpOw0KICAgICAqIC8vID0+ICdhYmMgICAnDQogICAgICoNCiAgICAgKiBfLnBhZFJpZ2h0KCdhYmMnLCA2LCAnXy0nKTsNCiAgICAgKiAvLyA9PiAnYWJjXy1fJw0KICAgICAqDQogICAgICogXy5wYWRSaWdodCgnYWJjJywgMyk7DQogICAgICogLy8gPT4gJ2FiYycNCiAgICAgKi8NCiAgICB2YXIgcGFkUmlnaHQgPSBjcmVhdGVQYWREaXIodHJ1ZSk7DQoNCiAgICAvKioNCiAgICAgKiBDb252ZXJ0cyBgc3RyaW5nYCB0byBhbiBpbnRlZ2VyIG9mIHRoZSBzcGVjaWZpZWQgcmFkaXguIElmIGByYWRpeGAgaXMNCiAgICAgKiBgdW5kZWZpbmVkYCBvciBgMGAsIGEgYHJhZGl4YCBvZiBgMTBgIGlzIHVzZWQgdW5sZXNzIGB2YWx1ZWAgaXMgYSBoZXhhZGVjaW1hbCwNCiAgICAgKiBpbiB3aGljaCBjYXNlIGEgYHJhZGl4YCBvZiBgMTZgIGlzIHVzZWQuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgYWxpZ25zIHdpdGggdGhlIFtFUzUgaW1wbGVtZW50YXRpb25dKGh0dHBzOi8vZXM1LmdpdGh1Yi5pby8jRSkNCiAgICAgKiBvZiBgcGFyc2VJbnRgLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFN0cmluZw0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBjb252ZXJ0Lg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbcmFkaXhdIFRoZSByYWRpeCB0byBpbnRlcnByZXQgYHZhbHVlYCBieS4NCiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYSBjYWxsYmFjayBmb3IgZnVuY3Rpb25zIGxpa2UgYF8ubWFwYC4NCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgaW50ZWdlci4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5wYXJzZUludCgnMDgnKTsNCiAgICAgKiAvLyA9PiA4DQogICAgICoNCiAgICAgKiBfLm1hcChbJzYnLCAnMDgnLCAnMTAnXSwgXy5wYXJzZUludCk7DQogICAgICogLy8gPT4gWzYsIDgsIDEwXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZywgcmFkaXgsIGd1YXJkKSB7DQogICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwoc3RyaW5nLCByYWRpeCwgZ3VhcmQpKSB7DQogICAgICAgIHJhZGl4ID0gMDsNCiAgICAgIH0NCiAgICAgIHJldHVybiBuYXRpdmVQYXJzZUludChzdHJpbmcsIHJhZGl4KTsNCiAgICB9DQogICAgLy8gRmFsbGJhY2sgZm9yIGVudmlyb25tZW50cyB3aXRoIHByZS1FUzUgaW1wbGVtZW50YXRpb25zLg0KICAgIGlmIChuYXRpdmVQYXJzZUludCh3aGl0ZXNwYWNlICsgJzA4JykgIT0gOCkgew0KICAgICAgcGFyc2VJbnQgPSBmdW5jdGlvbihzdHJpbmcsIHJhZGl4LCBndWFyZCkgew0KICAgICAgICAvLyBGaXJlZm94IDwgMjEgYW5kIE9wZXJhIDwgMTUgZm9sbG93IEVTMyBmb3IgYHBhcnNlSW50YC4NCiAgICAgICAgLy8gQ2hyb21lIGZhaWxzIHRvIHRyaW0gbGVhZGluZyA8Qk9NPiB3aGl0ZXNwYWNlIGNoYXJhY3RlcnMuDQogICAgICAgIC8vIFNlZSBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzEwOSBmb3IgbW9yZSBkZXRhaWxzLg0KICAgICAgICBpZiAoZ3VhcmQgPyBpc0l0ZXJhdGVlQ2FsbChzdHJpbmcsIHJhZGl4LCBndWFyZCkgOiByYWRpeCA9PSBudWxsKSB7DQogICAgICAgICAgcmFkaXggPSAwOw0KICAgICAgICB9IGVsc2UgaWYgKHJhZGl4KSB7DQogICAgICAgICAgcmFkaXggPSArcmFkaXg7DQogICAgICAgIH0NCiAgICAgICAgc3RyaW5nID0gdHJpbShzdHJpbmcpOw0KICAgICAgICByZXR1cm4gbmF0aXZlUGFyc2VJbnQoc3RyaW5nLCByYWRpeCB8fCAocmVIYXNIZXhQcmVmaXgudGVzdChzdHJpbmcpID8gMTYgOiAxMCkpOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXBlYXRzIHRoZSBnaXZlbiBzdHJpbmcgYG5gIHRpbWVzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFN0cmluZw0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHJlcGVhdC4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW249MF0gVGhlIG51bWJlciBvZiB0aW1lcyB0byByZXBlYXQgdGhlIHN0cmluZy4NCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSByZXBlYXRlZCBzdHJpbmcuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8ucmVwZWF0KCcqJywgMyk7DQogICAgICogLy8gPT4gJyoqKicNCiAgICAgKg0KICAgICAqIF8ucmVwZWF0KCdhYmMnLCAyKTsNCiAgICAgKiAvLyA9PiAnYWJjYWJjJw0KICAgICAqDQogICAgICogXy5yZXBlYXQoJ2FiYycsIDApOw0KICAgICAqIC8vID0+ICcnDQogICAgICovDQogICAgZnVuY3Rpb24gcmVwZWF0KHN0cmluZywgbikgew0KICAgICAgdmFyIHJlc3VsdCA9ICcnOw0KICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7DQogICAgICBuID0gK247DQogICAgICBpZiAobiA8IDEgfHwgIXN0cmluZyB8fCAhbmF0aXZlSXNGaW5pdGUobikpIHsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCiAgICAgIC8vIExldmVyYWdlIHRoZSBleHBvbmVudGlhdGlvbiBieSBzcXVhcmluZyBhbGdvcml0aG0gZm9yIGEgZmFzdGVyIHJlcGVhdC4NCiAgICAgIC8vIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FeHBvbmVudGlhdGlvbl9ieV9zcXVhcmluZyBmb3IgbW9yZSBkZXRhaWxzLg0KICAgICAgZG8gew0KICAgICAgICBpZiAobiAlIDIpIHsNCiAgICAgICAgICByZXN1bHQgKz0gc3RyaW5nOw0KICAgICAgICB9DQogICAgICAgIG4gPSBmbG9vcihuIC8gMik7DQogICAgICAgIHN0cmluZyArPSBzdHJpbmc7DQogICAgICB9IHdoaWxlIChuKTsNCg0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb252ZXJ0cyBgc3RyaW5nYCB0byBbc25ha2UgY2FzZV0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU25ha2VfY2FzZSkuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gY29udmVydC4NCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBzbmFrZSBjYXNlZCBzdHJpbmcuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8uc25ha2VDYXNlKCdGb28gQmFyJyk7DQogICAgICogLy8gPT4gJ2Zvb19iYXInDQogICAgICoNCiAgICAgKiBfLnNuYWtlQ2FzZSgnZm9vQmFyJyk7DQogICAgICogLy8gPT4gJ2Zvb19iYXInDQogICAgICoNCiAgICAgKiBfLnNuYWtlQ2FzZSgnLS1mb28tYmFyJyk7DQogICAgICogLy8gPT4gJ2Zvb19iYXInDQogICAgICovDQogICAgdmFyIHNuYWtlQ2FzZSA9IGNyZWF0ZUNvbXBvdW5kZXIoZnVuY3Rpb24ocmVzdWx0LCB3b3JkLCBpbmRleCkgew0KICAgICAgcmV0dXJuIHJlc3VsdCArIChpbmRleCA/ICdfJyA6ICcnKSArIHdvcmQudG9Mb3dlckNhc2UoKTsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnRzIGBzdHJpbmdgIHRvIFtzdGFydCBjYXNlXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MZXR0ZXJfY2FzZSNTdHlsaXN0aWNfb3Jfc3BlY2lhbGlzZWRfdXNhZ2UpLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFN0cmluZw0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIGNvbnZlcnQuDQogICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgc3RhcnQgY2FzZWQgc3RyaW5nLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnN0YXJ0Q2FzZSgnLS1mb28tYmFyJyk7DQogICAgICogLy8gPT4gJ0ZvbyBCYXInDQogICAgICoNCiAgICAgKiBfLnN0YXJ0Q2FzZSgnZm9vQmFyJyk7DQogICAgICogLy8gPT4gJ0ZvbyBCYXInDQogICAgICoNCiAgICAgKiBfLnN0YXJ0Q2FzZSgnX19mb29fYmFyX18nKTsNCiAgICAgKiAvLyA9PiAnRm9vIEJhcicNCiAgICAgKi8NCiAgICB2YXIgc3RhcnRDYXNlID0gY3JlYXRlQ29tcG91bmRlcihmdW5jdGlvbihyZXN1bHQsIHdvcmQsIGluZGV4KSB7DQogICAgICByZXR1cm4gcmVzdWx0ICsgKGluZGV4ID8gJyAnIDogJycpICsgKHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpKTsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBgc3RyaW5nYCBzdGFydHMgd2l0aCB0aGUgZ2l2ZW4gdGFyZ2V0IHN0cmluZy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBTdHJpbmcNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBzZWFyY2guDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFt0YXJnZXRdIFRoZSBzdHJpbmcgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3Bvc2l0aW9uPTBdIFRoZSBwb3NpdGlvbiB0byBzZWFyY2ggZnJvbS4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHN0cmluZ2Agc3RhcnRzIHdpdGggYHRhcmdldGAsIGVsc2UgYGZhbHNlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5zdGFydHNXaXRoKCdhYmMnLCAnYScpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKg0KICAgICAqIF8uc3RhcnRzV2l0aCgnYWJjJywgJ2InKTsNCiAgICAgKiAvLyA9PiBmYWxzZQ0KICAgICAqDQogICAgICogXy5zdGFydHNXaXRoKCdhYmMnLCAnYicsIDEpOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdGFydHNXaXRoKHN0cmluZywgdGFyZ2V0LCBwb3NpdGlvbikgew0KICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7DQogICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uID09IG51bGwNCiAgICAgICAgPyAwDQogICAgICAgIDogbmF0aXZlTWluKHBvc2l0aW9uIDwgMCA/IDAgOiAoK3Bvc2l0aW9uIHx8IDApLCBzdHJpbmcubGVuZ3RoKTsNCg0KICAgICAgcmV0dXJuIHN0cmluZy5sYXN0SW5kZXhPZih0YXJnZXQsIHBvc2l0aW9uKSA9PSBwb3NpdGlvbjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgY29tcGlsZWQgdGVtcGxhdGUgZnVuY3Rpb24gdGhhdCBjYW4gaW50ZXJwb2xhdGUgZGF0YSBwcm9wZXJ0aWVzDQogICAgICogaW4gImludGVycG9sYXRlIiBkZWxpbWl0ZXJzLCBIVE1MLWVzY2FwZSBpbnRlcnBvbGF0ZWQgZGF0YSBwcm9wZXJ0aWVzIGluDQogICAgICogImVzY2FwZSIgZGVsaW1pdGVycywgYW5kIGV4ZWN1dGUgSmF2YVNjcmlwdCBpbiAiZXZhbHVhdGUiIGRlbGltaXRlcnMuIERhdGENCiAgICAgKiBwcm9wZXJ0aWVzIG1heSBiZSBhY2Nlc3NlZCBhcyBmcmVlIHZhcmlhYmxlcyBpbiB0aGUgdGVtcGxhdGUuIElmIGEgc2V0dGluZw0KICAgICAqIG9iamVjdCBpcyBwcm92aWRlZCBpdCB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgYF8udGVtcGxhdGVTZXR0aW5nc2AgdmFsdWVzLg0KICAgICAqDQogICAgICogKipOb3RlOioqIEluIHRoZSBkZXZlbG9wbWVudCBidWlsZCBgXy50ZW1wbGF0ZWAgdXRpbGl6ZXMNCiAgICAgKiBbc291cmNlVVJMc10oaHR0cDovL3d3dy5odG1sNXJvY2tzLmNvbS9lbi90dXRvcmlhbHMvZGV2ZWxvcGVydG9vbHMvc291cmNlbWFwcy8jdG9jLXNvdXJjZXVybCkNCiAgICAgKiBmb3IgZWFzaWVyIGRlYnVnZ2luZy4NCiAgICAgKg0KICAgICAqIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIHByZWNvbXBpbGluZyB0ZW1wbGF0ZXMgc2VlDQogICAgICogW2xvZGFzaCdzIGN1c3RvbSBidWlsZHMgZG9jdW1lbnRhdGlvbl0oaHR0cHM6Ly9sb2Rhc2guY29tL2N1c3RvbS1idWlsZHMpLg0KICAgICAqDQogICAgICogRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gQ2hyb21lIGV4dGVuc2lvbiBzYW5kYm94ZXMgc2VlDQogICAgICogW0Nocm9tZSdzIGV4dGVuc2lvbnMgZG9jdW1lbnRhdGlvbl0oaHR0cHM6Ly9kZXZlbG9wZXIuY2hyb21lLmNvbS9leHRlbnNpb25zL3NhbmRib3hpbmdFdmFsKS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBTdHJpbmcNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHRlbXBsYXRlIHN0cmluZy4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIFRoZSBvcHRpb25zIG9iamVjdC4NCiAgICAgKiBAcGFyYW0ge1JlZ0V4cH0gW29wdGlvbnMuZXNjYXBlXSBUaGUgSFRNTCAiZXNjYXBlIiBkZWxpbWl0ZXIuDQogICAgICogQHBhcmFtIHtSZWdFeHB9IFtvcHRpb25zLmV2YWx1YXRlXSBUaGUgImV2YWx1YXRlIiBkZWxpbWl0ZXIuDQogICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLmltcG9ydHNdIEFuIG9iamVjdCB0byBpbXBvcnQgaW50byB0aGUgdGVtcGxhdGUgYXMgZnJlZSB2YXJpYWJsZXMuDQogICAgICogQHBhcmFtIHtSZWdFeHB9IFtvcHRpb25zLmludGVycG9sYXRlXSBUaGUgImludGVycG9sYXRlIiBkZWxpbWl0ZXIuDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnNvdXJjZVVSTF0gVGhlIHNvdXJjZVVSTCBvZiB0aGUgdGVtcGxhdGUncyBjb21waWxlZCBzb3VyY2UuDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnZhcmlhYmxlXSBUaGUgZGF0YSBvYmplY3QgdmFyaWFibGUgbmFtZS4NCiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtvdGhlck9wdGlvbnNdIEVuYWJsZXMgdGhlIGxlZ2FjeSBgb3B0aW9uc2AgcGFyYW0gc2lnbmF0dXJlLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgY29tcGlsZWQgdGVtcGxhdGUgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSAiaW50ZXJwb2xhdGUiIGRlbGltaXRlciB0byBjcmVhdGUgYSBjb21waWxlZCB0ZW1wbGF0ZQ0KICAgICAqIHZhciBjb21waWxlZCA9IF8udGVtcGxhdGUoJ2hlbGxvIDwlPSB1c2VyICU+IScpOw0KICAgICAqIGNvbXBpbGVkKHsgJ3VzZXInOiAnZnJlZCcgfSk7DQogICAgICogLy8gPT4gJ2hlbGxvIGZyZWQhJw0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIEhUTUwgImVzY2FwZSIgZGVsaW1pdGVyIHRvIGVzY2FwZSBkYXRhIHByb3BlcnR5IHZhbHVlcw0KICAgICAqIHZhciBjb21waWxlZCA9IF8udGVtcGxhdGUoJzxiPjwlLSB2YWx1ZSAlPjwvYj4nKTsNCiAgICAgKiBjb21waWxlZCh7ICd2YWx1ZSc6ICc8c2NyaXB0PicgfSk7DQogICAgICogLy8gPT4gJzxiPiZsdDtzY3JpcHQmZ3Q7PC9iPicNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSAiZXZhbHVhdGUiIGRlbGltaXRlciB0byBleGVjdXRlIEphdmFTY3JpcHQgYW5kIGdlbmVyYXRlIEhUTUwNCiAgICAgKiB2YXIgY29tcGlsZWQgPSBfLnRlbXBsYXRlKCc8JSBfLmZvckVhY2godXNlcnMsIGZ1bmN0aW9uKHVzZXIpIHsgJT48bGk+PCUtIHVzZXIgJT48L2xpPjwlIH0pOyAlPicpOw0KICAgICAqIGNvbXBpbGVkKHsgJ3VzZXJzJzogWydmcmVkJywgJ2Jhcm5leSddIH0pOw0KICAgICAqIC8vID0+ICc8bGk+ZnJlZDwvbGk+PGxpPmJhcm5leTwvbGk+Jw0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGludGVybmFsIGBwcmludGAgZnVuY3Rpb24gaW4gImV2YWx1YXRlIiBkZWxpbWl0ZXJzDQogICAgICogdmFyIGNvbXBpbGVkID0gXy50ZW1wbGF0ZSgnPCUgcHJpbnQoImhlbGxvICIgKyB1c2VyKTsgJT4hJyk7DQogICAgICogY29tcGlsZWQoeyAndXNlcic6ICdiYXJuZXknIH0pOw0KICAgICAqIC8vID0+ICdoZWxsbyBiYXJuZXkhJw0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIEVTIGRlbGltaXRlciBhcyBhbiBhbHRlcm5hdGl2ZSB0byB0aGUgZGVmYXVsdCAiaW50ZXJwb2xhdGUiIGRlbGltaXRlcg0KICAgICAqIHZhciBjb21waWxlZCA9IF8udGVtcGxhdGUoJ2hlbGxvICR7IHVzZXIgfSEnKTsNCiAgICAgKiBjb21waWxlZCh7ICd1c2VyJzogJ3BlYmJsZXMnIH0pOw0KICAgICAqIC8vID0+ICdoZWxsbyBwZWJibGVzIScNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIGN1c3RvbSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzDQogICAgICogXy50ZW1wbGF0ZVNldHRpbmdzLmludGVycG9sYXRlID0gL3t7KFtcc1xTXSs/KX19L2c7DQogICAgICogdmFyIGNvbXBpbGVkID0gXy50ZW1wbGF0ZSgnaGVsbG8ge3sgdXNlciB9fSEnKTsNCiAgICAgKiBjb21waWxlZCh7ICd1c2VyJzogJ211c3RhY2hlJyB9KTsNCiAgICAgKiAvLyA9PiAnaGVsbG8gbXVzdGFjaGUhJw0KICAgICAqDQogICAgICogLy8gdXNpbmcgYmFja3NsYXNoZXMgdG8gdHJlYXQgZGVsaW1pdGVycyBhcyBwbGFpbiB0ZXh0DQogICAgICogdmFyIGNvbXBpbGVkID0gXy50ZW1wbGF0ZSgnPCU9ICJcXDwlLSB2YWx1ZSAlXFw+IiAlPicpOw0KICAgICAqIGNvbXBpbGVkKHsgJ3ZhbHVlJzogJ2lnbm9yZWQnIH0pOw0KICAgICAqIC8vID0+ICc8JS0gdmFsdWUgJT4nDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYGltcG9ydHNgIG9wdGlvbiB0byBpbXBvcnQgYGpRdWVyeWAgYXMgYGpxYA0KICAgICAqIHZhciB0ZXh0ID0gJzwlIGpxLmVhY2godXNlcnMsIGZ1bmN0aW9uKHVzZXIpIHsgJT48bGk+PCUtIHVzZXIgJT48L2xpPjwlIH0pOyAlPic7DQogICAgICogdmFyIGNvbXBpbGVkID0gXy50ZW1wbGF0ZSh0ZXh0LCB7ICdpbXBvcnRzJzogeyAnanEnOiBqUXVlcnkgfSB9KTsNCiAgICAgKiBjb21waWxlZCh7ICd1c2Vycyc6IFsnZnJlZCcsICdiYXJuZXknXSB9KTsNCiAgICAgKiAvLyA9PiAnPGxpPmZyZWQ8L2xpPjxsaT5iYXJuZXk8L2xpPicNCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgc291cmNlVVJMYCBvcHRpb24gdG8gc3BlY2lmeSBhIGN1c3RvbSBzb3VyY2VVUkwgZm9yIHRoZSB0ZW1wbGF0ZQ0KICAgICAqIHZhciBjb21waWxlZCA9IF8udGVtcGxhdGUoJ2hlbGxvIDwlPSB1c2VyICU+IScsIHsgJ3NvdXJjZVVSTCc6ICcvYmFzaWMvZ3JlZXRpbmcuanN0JyB9KTsNCiAgICAgKiBjb21waWxlZChkYXRhKTsNCiAgICAgKiAvLyA9PiBmaW5kIHRoZSBzb3VyY2Ugb2YgImdyZWV0aW5nLmpzdCIgdW5kZXIgdGhlIFNvdXJjZXMgdGFiIG9yIFJlc291cmNlcyBwYW5lbCBvZiB0aGUgd2ViIGluc3BlY3Rvcg0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGB2YXJpYWJsZWAgb3B0aW9uIHRvIGVuc3VyZSBhIHdpdGgtc3RhdGVtZW50IGlzbid0IHVzZWQgaW4gdGhlIGNvbXBpbGVkIHRlbXBsYXRlDQogICAgICogdmFyIGNvbXBpbGVkID0gXy50ZW1wbGF0ZSgnaGkgPCU9IGRhdGEudXNlciAlPiEnLCB7ICd2YXJpYWJsZSc6ICdkYXRhJyB9KTsNCiAgICAgKiBjb21waWxlZC5zb3VyY2U7DQogICAgICogLy8gPT4gZnVuY3Rpb24oZGF0YSkgew0KICAgICAqIC8vICAgdmFyIF9fdCwgX19wID0gJyc7DQogICAgICogLy8gICBfX3AgKz0gJ2hpICcgKyAoKF9fdCA9ICggZGF0YS51c2VyICkpID09IG51bGwgPyAnJyA6IF9fdCkgKyAnISc7DQogICAgICogLy8gICByZXR1cm4gX19wOw0KICAgICAqIC8vIH0NCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgc291cmNlYCBwcm9wZXJ0eSB0byBpbmxpbmUgY29tcGlsZWQgdGVtcGxhdGVzIGZvciBtZWFuaW5nZnVsDQogICAgICogLy8gbGluZSBudW1iZXJzIGluIGVycm9yIG1lc3NhZ2VzIGFuZCBhIHN0YWNrIHRyYWNlDQogICAgICogZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4oY3dkLCAnanN0LmpzJyksICdcDQogICAgICogICB2YXIgSlNUID0ge1wNCiAgICAgKiAgICAgIm1haW4iOiAnICsgXy50ZW1wbGF0ZShtYWluVGV4dCkuc291cmNlICsgJ1wNCiAgICAgKiAgIH07XA0KICAgICAqICcpOw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRlbXBsYXRlKHN0cmluZywgb3B0aW9ucywgb3RoZXJPcHRpb25zKSB7DQogICAgICAvLyBCYXNlZCBvbiBKb2huIFJlc2lnJ3MgYHRtcGxgIGltcGxlbWVudGF0aW9uIChodHRwOi8vZWpvaG4ub3JnL2Jsb2cvamF2YXNjcmlwdC1taWNyby10ZW1wbGF0aW5nLykNCiAgICAgIC8vIGFuZCBMYXVyYSBEb2t0b3JvdmEncyBkb1QuanMgKGh0dHBzOi8vZ2l0aHViLmNvbS9vbGFkby9kb1QpLg0KICAgICAgdmFyIHNldHRpbmdzID0gbG9kYXNoLnRlbXBsYXRlU2V0dGluZ3M7DQoNCiAgICAgIGlmIChvdGhlck9wdGlvbnMgJiYgaXNJdGVyYXRlZUNhbGwoc3RyaW5nLCBvcHRpb25zLCBvdGhlck9wdGlvbnMpKSB7DQogICAgICAgIG9wdGlvbnMgPSBvdGhlck9wdGlvbnMgPSBudWxsOw0KICAgICAgfQ0KICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7DQogICAgICBvcHRpb25zID0gYXNzaWduV2l0aChiYXNlQXNzaWduKHt9LCBvdGhlck9wdGlvbnMgfHwgb3B0aW9ucyksIHNldHRpbmdzLCBhc3NpZ25Pd25EZWZhdWx0cyk7DQoNCiAgICAgIHZhciBpbXBvcnRzID0gYXNzaWduV2l0aChiYXNlQXNzaWduKHt9LCBvcHRpb25zLmltcG9ydHMpLCBzZXR0aW5ncy5pbXBvcnRzLCBhc3NpZ25Pd25EZWZhdWx0cyksDQogICAgICAgICAgaW1wb3J0c0tleXMgPSBrZXlzKGltcG9ydHMpLA0KICAgICAgICAgIGltcG9ydHNWYWx1ZXMgPSBiYXNlVmFsdWVzKGltcG9ydHMsIGltcG9ydHNLZXlzKTsNCg0KICAgICAgdmFyIGlzRXNjYXBpbmcsDQogICAgICAgICAgaXNFdmFsdWF0aW5nLA0KICAgICAgICAgIGluZGV4ID0gMCwNCiAgICAgICAgICBpbnRlcnBvbGF0ZSA9IG9wdGlvbnMuaW50ZXJwb2xhdGUgfHwgcmVOb01hdGNoLA0KICAgICAgICAgIHNvdXJjZSA9ICJfX3AgKz0gJyI7DQoNCiAgICAgIC8vIENvbXBpbGUgdGhlIHJlZ2V4cCB0byBtYXRjaCBlYWNoIGRlbGltaXRlci4NCiAgICAgIHZhciByZURlbGltaXRlcnMgPSBSZWdFeHAoDQogICAgICAgIChvcHRpb25zLmVzY2FwZSB8fCByZU5vTWF0Y2gpLnNvdXJjZSArICd8JyArDQogICAgICAgIGludGVycG9sYXRlLnNvdXJjZSArICd8JyArDQogICAgICAgIChpbnRlcnBvbGF0ZSA9PT0gcmVJbnRlcnBvbGF0ZSA/IHJlRXNUZW1wbGF0ZSA6IHJlTm9NYXRjaCkuc291cmNlICsgJ3wnICsNCiAgICAgICAgKG9wdGlvbnMuZXZhbHVhdGUgfHwgcmVOb01hdGNoKS5zb3VyY2UgKyAnfCQnDQogICAgICAsICdnJyk7DQoNCiAgICAgIC8vIFVzZSBhIHNvdXJjZVVSTCBmb3IgZWFzaWVyIGRlYnVnZ2luZy4NCiAgICAgIHZhciBzb3VyY2VVUkwgPSAnLy8jIHNvdXJjZVVSTD0nICsNCiAgICAgICAgKCdzb3VyY2VVUkwnIGluIG9wdGlvbnMNCiAgICAgICAgICA/IG9wdGlvbnMuc291cmNlVVJMDQogICAgICAgICAgOiAoJ2xvZGFzaC50ZW1wbGF0ZVNvdXJjZXNbJyArICgrK3RlbXBsYXRlQ291bnRlcikgKyAnXScpDQogICAgICAgICkgKyAnXG4nOw0KDQogICAgICBzdHJpbmcucmVwbGFjZShyZURlbGltaXRlcnMsIGZ1bmN0aW9uKG1hdGNoLCBlc2NhcGVWYWx1ZSwgaW50ZXJwb2xhdGVWYWx1ZSwgZXNUZW1wbGF0ZVZhbHVlLCBldmFsdWF0ZVZhbHVlLCBvZmZzZXQpIHsNCiAgICAgICAgaW50ZXJwb2xhdGVWYWx1ZSB8fCAoaW50ZXJwb2xhdGVWYWx1ZSA9IGVzVGVtcGxhdGVWYWx1ZSk7DQoNCiAgICAgICAgLy8gRXNjYXBlIGNoYXJhY3RlcnMgdGhhdCBjYW4ndCBiZSBpbmNsdWRlZCBpbiBzdHJpbmcgbGl0ZXJhbHMuDQogICAgICAgIHNvdXJjZSArPSBzdHJpbmcuc2xpY2UoaW5kZXgsIG9mZnNldCkucmVwbGFjZShyZVVuZXNjYXBlZFN0cmluZywgZXNjYXBlU3RyaW5nQ2hhcik7DQoNCiAgICAgICAgLy8gUmVwbGFjZSBkZWxpbWl0ZXJzIHdpdGggc25pcHBldHMuDQogICAgICAgIGlmIChlc2NhcGVWYWx1ZSkgew0KICAgICAgICAgIGlzRXNjYXBpbmcgPSB0cnVlOw0KICAgICAgICAgIHNvdXJjZSArPSAiJyArXG5fX2UoIiArIGVzY2FwZVZhbHVlICsgIikgK1xuJyI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGV2YWx1YXRlVmFsdWUpIHsNCiAgICAgICAgICBpc0V2YWx1YXRpbmcgPSB0cnVlOw0KICAgICAgICAgIHNvdXJjZSArPSAiJztcbiIgKyBldmFsdWF0ZVZhbHVlICsgIjtcbl9fcCArPSAnIjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaW50ZXJwb2xhdGVWYWx1ZSkgew0KICAgICAgICAgIHNvdXJjZSArPSAiJyArXG4oKF9fdCA9ICgiICsgaW50ZXJwb2xhdGVWYWx1ZSArICIpKSA9PSBudWxsID8gJycgOiBfX3QpICtcbiciOw0KICAgICAgICB9DQogICAgICAgIGluZGV4ID0gb2Zmc2V0ICsgbWF0Y2gubGVuZ3RoOw0KDQogICAgICAgIC8vIFRoZSBKUyBlbmdpbmUgZW1iZWRkZWQgaW4gQWRvYmUgcHJvZHVjdHMgcmVxdWlyZXMgcmV0dXJuaW5nIHRoZSBgbWF0Y2hgDQogICAgICAgIC8vIHN0cmluZyBpbiBvcmRlciB0byBwcm9kdWNlIHRoZSBjb3JyZWN0IGBvZmZzZXRgIHZhbHVlLg0KICAgICAgICByZXR1cm4gbWF0Y2g7DQogICAgICB9KTsNCg0KICAgICAgc291cmNlICs9ICInO1xuIjsNCg0KICAgICAgLy8gSWYgYHZhcmlhYmxlYCBpcyBub3Qgc3BlY2lmaWVkIHdyYXAgYSB3aXRoLXN0YXRlbWVudCBhcm91bmQgdGhlIGdlbmVyYXRlZA0KICAgICAgLy8gY29kZSB0byBhZGQgdGhlIGRhdGEgb2JqZWN0IHRvIHRoZSB0b3Agb2YgdGhlIHNjb3BlIGNoYWluLg0KICAgICAgdmFyIHZhcmlhYmxlID0gb3B0aW9ucy52YXJpYWJsZTsNCiAgICAgIGlmICghdmFyaWFibGUpIHsNCiAgICAgICAgc291cmNlID0gJ3dpdGggKG9iaikge1xuJyArIHNvdXJjZSArICdcbn1cbic7DQogICAgICB9DQogICAgICAvLyBDbGVhbnVwIGNvZGUgYnkgc3RyaXBwaW5nIGVtcHR5IHN0cmluZ3MuDQogICAgICBzb3VyY2UgPSAoaXNFdmFsdWF0aW5nID8gc291cmNlLnJlcGxhY2UocmVFbXB0eVN0cmluZ0xlYWRpbmcsICcnKSA6IHNvdXJjZSkNCiAgICAgICAgLnJlcGxhY2UocmVFbXB0eVN0cmluZ01pZGRsZSwgJyQxJykNCiAgICAgICAgLnJlcGxhY2UocmVFbXB0eVN0cmluZ1RyYWlsaW5nLCAnJDE7Jyk7DQoNCiAgICAgIC8vIEZyYW1lIGNvZGUgYXMgdGhlIGZ1bmN0aW9uIGJvZHkuDQogICAgICBzb3VyY2UgPSAnZnVuY3Rpb24oJyArICh2YXJpYWJsZSB8fCAnb2JqJykgKyAnKSB7XG4nICsNCiAgICAgICAgKHZhcmlhYmxlDQogICAgICAgICAgPyAnJw0KICAgICAgICAgIDogJ29iaiB8fCAob2JqID0ge30pO1xuJw0KICAgICAgICApICsNCiAgICAgICAgInZhciBfX3QsIF9fcCA9ICcnIiArDQogICAgICAgIChpc0VzY2FwaW5nDQogICAgICAgICAgID8gJywgX19lID0gXy5lc2NhcGUnDQogICAgICAgICAgIDogJycNCiAgICAgICAgKSArDQogICAgICAgIChpc0V2YWx1YXRpbmcNCiAgICAgICAgICA/ICcsIF9faiA9IEFycmF5LnByb3RvdHlwZS5qb2luO1xuJyArDQogICAgICAgICAgICAiZnVuY3Rpb24gcHJpbnQoKSB7IF9fcCArPSBfX2ouY2FsbChhcmd1bWVudHMsICcnKSB9XG4iDQogICAgICAgICAgOiAnO1xuJw0KICAgICAgICApICsNCiAgICAgICAgc291cmNlICsNCiAgICAgICAgJ3JldHVybiBfX3Bcbn0nOw0KDQogICAgICB2YXIgcmVzdWx0ID0gYXR0ZW1wdChmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIEZ1bmN0aW9uKGltcG9ydHNLZXlzLCBzb3VyY2VVUkwgKyAncmV0dXJuICcgKyBzb3VyY2UpLmFwcGx5KHVuZGVmaW5lZCwgaW1wb3J0c1ZhbHVlcyk7DQogICAgICB9KTsNCg0KICAgICAgLy8gUHJvdmlkZSB0aGUgY29tcGlsZWQgZnVuY3Rpb24ncyBzb3VyY2UgYnkgaXRzIGB0b1N0cmluZ2AgbWV0aG9kIG9yDQogICAgICAvLyB0aGUgYHNvdXJjZWAgcHJvcGVydHkgYXMgYSBjb252ZW5pZW5jZSBmb3IgaW5saW5pbmcgY29tcGlsZWQgdGVtcGxhdGVzLg0KICAgICAgcmVzdWx0LnNvdXJjZSA9IHNvdXJjZTsNCiAgICAgIGlmIChpc0Vycm9yKHJlc3VsdCkpIHsNCiAgICAgICAgdGhyb3cgcmVzdWx0Ow0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZW1vdmVzIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHdoaXRlc3BhY2Ugb3Igc3BlY2lmaWVkIGNoYXJhY3RlcnMgZnJvbSBgc3RyaW5nYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBTdHJpbmcNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byB0cmltLg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbY2hhcnM9d2hpdGVzcGFjZV0gVGhlIGNoYXJhY3RlcnMgdG8gdHJpbS4NCiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYSBjYWxsYmFjayBmb3IgZnVuY3Rpb25zIGxpa2UgYF8ubWFwYC4NCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSB0cmltbWVkIHN0cmluZy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy50cmltKCcgIGFiYyAgJyk7DQogICAgICogLy8gPT4gJ2FiYycNCiAgICAgKg0KICAgICAqIF8udHJpbSgnLV8tYWJjLV8tJywgJ18tJyk7DQogICAgICogLy8gPT4gJ2FiYycNCiAgICAgKg0KICAgICAqIF8ubWFwKFsnICBmb28gICcsICcgIGJhciAgJ10sIF8udHJpbSk7DQogICAgICogLy8gPT4gWydmb28nLCAnYmFyJ10NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0cmltKHN0cmluZywgY2hhcnMsIGd1YXJkKSB7DQogICAgICB2YXIgdmFsdWUgPSBzdHJpbmc7DQogICAgICBzdHJpbmcgPSBiYXNlVG9TdHJpbmcoc3RyaW5nKTsNCiAgICAgIGlmICghc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJpbmc7DQogICAgICB9DQogICAgICBpZiAoZ3VhcmQgPyBpc0l0ZXJhdGVlQ2FsbCh2YWx1ZSwgY2hhcnMsIGd1YXJkKSA6IGNoYXJzID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIHN0cmluZy5zbGljZSh0cmltbWVkTGVmdEluZGV4KHN0cmluZyksIHRyaW1tZWRSaWdodEluZGV4KHN0cmluZykgKyAxKTsNCiAgICAgIH0NCiAgICAgIGNoYXJzID0gKGNoYXJzICsgJycpOw0KICAgICAgcmV0dXJuIHN0cmluZy5zbGljZShjaGFyc0xlZnRJbmRleChzdHJpbmcsIGNoYXJzKSwgY2hhcnNSaWdodEluZGV4KHN0cmluZywgY2hhcnMpICsgMSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlcyBsZWFkaW5nIHdoaXRlc3BhY2Ugb3Igc3BlY2lmaWVkIGNoYXJhY3RlcnMgZnJvbSBgc3RyaW5nYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBTdHJpbmcNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byB0cmltLg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbY2hhcnM9d2hpdGVzcGFjZV0gVGhlIGNoYXJhY3RlcnMgdG8gdHJpbS4NCiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYSBjYWxsYmFjayBmb3IgZnVuY3Rpb25zIGxpa2UgYF8ubWFwYC4NCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSB0cmltbWVkIHN0cmluZy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy50cmltTGVmdCgnICBhYmMgICcpOw0KICAgICAqIC8vID0+ICdhYmMgICcNCiAgICAgKg0KICAgICAqIF8udHJpbUxlZnQoJy1fLWFiYy1fLScsICdfLScpOw0KICAgICAqIC8vID0+ICdhYmMtXy0nDQogICAgICovDQogICAgZnVuY3Rpb24gdHJpbUxlZnQoc3RyaW5nLCBjaGFycywgZ3VhcmQpIHsNCiAgICAgIHZhciB2YWx1ZSA9IHN0cmluZzsNCiAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOw0KICAgICAgaWYgKCFzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIHN0cmluZzsNCiAgICAgIH0NCiAgICAgIGlmIChndWFyZCA/IGlzSXRlcmF0ZWVDYWxsKHZhbHVlLCBjaGFycywgZ3VhcmQpIDogY2hhcnMgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gc3RyaW5nLnNsaWNlKHRyaW1tZWRMZWZ0SW5kZXgoc3RyaW5nKSk7DQogICAgICB9DQogICAgICByZXR1cm4gc3RyaW5nLnNsaWNlKGNoYXJzTGVmdEluZGV4KHN0cmluZywgKGNoYXJzICsgJycpKSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlcyB0cmFpbGluZyB3aGl0ZXNwYWNlIG9yIHNwZWNpZmllZCBjaGFyYWN0ZXJzIGZyb20gYHN0cmluZ2AuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gdHJpbS4NCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2NoYXJzPXdoaXRlc3BhY2VdIFRoZSBjaGFyYWN0ZXJzIHRvIHRyaW0uDQogICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGEgY2FsbGJhY2sgZm9yIGZ1bmN0aW9ucyBsaWtlIGBfLm1hcGAuDQogICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdHJpbW1lZCBzdHJpbmcuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIF8udHJpbVJpZ2h0KCcgIGFiYyAgJyk7DQogICAgICogLy8gPT4gJyAgYWJjJw0KICAgICAqDQogICAgICogXy50cmltUmlnaHQoJy1fLWFiYy1fLScsICdfLScpOw0KICAgICAqIC8vID0+ICctXy1hYmMnDQogICAgICovDQogICAgZnVuY3Rpb24gdHJpbVJpZ2h0KHN0cmluZywgY2hhcnMsIGd1YXJkKSB7DQogICAgICB2YXIgdmFsdWUgPSBzdHJpbmc7DQogICAgICBzdHJpbmcgPSBiYXNlVG9TdHJpbmcoc3RyaW5nKTsNCiAgICAgIGlmICghc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJpbmc7DQogICAgICB9DQogICAgICBpZiAoZ3VhcmQgPyBpc0l0ZXJhdGVlQ2FsbCh2YWx1ZSwgY2hhcnMsIGd1YXJkKSA6IGNoYXJzID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIHN0cmluZy5zbGljZSgwLCB0cmltbWVkUmlnaHRJbmRleChzdHJpbmcpICsgMSk7DQogICAgICB9DQogICAgICByZXR1cm4gc3RyaW5nLnNsaWNlKDAsIGNoYXJzUmlnaHRJbmRleChzdHJpbmcsIChjaGFycyArICcnKSkgKyAxKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUcnVuY2F0ZXMgYHN0cmluZ2AgaWYgaXQncyBsb25nZXIgdGhhbiB0aGUgZ2l2ZW4gbWF4aW11bSBzdHJpbmcgbGVuZ3RoLg0KICAgICAqIFRoZSBsYXN0IGNoYXJhY3RlcnMgb2YgdGhlIHRydW5jYXRlZCBzdHJpbmcgYXJlIHJlcGxhY2VkIHdpdGggdGhlIG9taXNzaW9uDQogICAgICogc3RyaW5nIHdoaWNoIGRlZmF1bHRzIHRvICIuLi4iLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFN0cmluZw0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHRydW5jYXRlLg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fG51bWJlcn0gW29wdGlvbnNdIFRoZSBvcHRpb25zIG9iamVjdCBvciBtYXhpbXVtIHN0cmluZyBsZW5ndGguDQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLmxlbmd0aD0zMF0gVGhlIG1heGltdW0gc3RyaW5nIGxlbmd0aC4NCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMub21pc3Npb249Jy4uLiddIFRoZSBzdHJpbmcgdG8gaW5kaWNhdGUgdGV4dCBpcyBvbWl0dGVkLg0KICAgICAqIEBwYXJhbSB7UmVnRXhwfHN0cmluZ30gW29wdGlvbnMuc2VwYXJhdG9yXSBUaGUgc2VwYXJhdG9yIHBhdHRlcm4gdG8gdHJ1bmNhdGUgdG8uDQogICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGEgY2FsbGJhY2sgZm9yIGZ1bmN0aW9ucyBsaWtlIGBfLm1hcGAuDQogICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdHJ1bmNhdGVkIHN0cmluZy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy50cnVuYygnaGktZGlkZGx5LWhvIHRoZXJlLCBuZWlnaGJvcmlubycpOw0KICAgICAqIC8vID0+ICdoaS1kaWRkbHktaG8gdGhlcmUsIG5laWdoYm8uLi4nDQogICAgICoNCiAgICAgKiBfLnRydW5jKCdoaS1kaWRkbHktaG8gdGhlcmUsIG5laWdoYm9yaW5vJywgMjQpOw0KICAgICAqIC8vID0+ICdoaS1kaWRkbHktaG8gdGhlcmUsIG4uLi4nDQogICAgICoNCiAgICAgKiBfLnRydW5jKCdoaS1kaWRkbHktaG8gdGhlcmUsIG5laWdoYm9yaW5vJywgew0KICAgICAqICAgJ2xlbmd0aCc6IDI0LA0KICAgICAqICAgJ3NlcGFyYXRvcic6ICcgJw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+ICdoaS1kaWRkbHktaG8gdGhlcmUsLi4uJw0KICAgICAqDQogICAgICogXy50cnVuYygnaGktZGlkZGx5LWhvIHRoZXJlLCBuZWlnaGJvcmlubycsIHsNCiAgICAgKiAgICdsZW5ndGgnOiAyNCwNCiAgICAgKiAgICdzZXBhcmF0b3InOiAvLD8gKy8NCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiAnaGktZGlkZGx5LWhvIHRoZXJlLi4uJw0KICAgICAqDQogICAgICogXy50cnVuYygnaGktZGlkZGx5LWhvIHRoZXJlLCBuZWlnaGJvcmlubycsIHsNCiAgICAgKiAgICdvbWlzc2lvbic6ICcgWy4uLl0nDQogICAgICogfSk7DQogICAgICogLy8gPT4gJ2hpLWRpZGRseS1obyB0aGVyZSwgbmVpZyBbLi4uXScNCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0cnVuYyhzdHJpbmcsIG9wdGlvbnMsIGd1YXJkKSB7DQogICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwoc3RyaW5nLCBvcHRpb25zLCBndWFyZCkpIHsNCiAgICAgICAgb3B0aW9ucyA9IG51bGw7DQogICAgICB9DQogICAgICB2YXIgbGVuZ3RoID0gREVGQVVMVF9UUlVOQ19MRU5HVEgsDQogICAgICAgICAgb21pc3Npb24gPSBERUZBVUxUX1RSVU5DX09NSVNTSU9OOw0KDQogICAgICBpZiAob3B0aW9ucyAhPSBudWxsKSB7DQogICAgICAgIGlmIChpc09iamVjdChvcHRpb25zKSkgew0KICAgICAgICAgIHZhciBzZXBhcmF0b3IgPSAnc2VwYXJhdG9yJyBpbiBvcHRpb25zID8gb3B0aW9ucy5zZXBhcmF0b3IgOiBzZXBhcmF0b3I7DQogICAgICAgICAgbGVuZ3RoID0gJ2xlbmd0aCcgaW4gb3B0aW9ucyA/ICgrb3B0aW9ucy5sZW5ndGggfHwgMCkgOiBsZW5ndGg7DQogICAgICAgICAgb21pc3Npb24gPSAnb21pc3Npb24nIGluIG9wdGlvbnMgPyBiYXNlVG9TdHJpbmcob3B0aW9ucy5vbWlzc2lvbikgOiBvbWlzc2lvbjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBsZW5ndGggPSArb3B0aW9ucyB8fCAwOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBzdHJpbmcgPSBiYXNlVG9TdHJpbmcoc3RyaW5nKTsNCiAgICAgIGlmIChsZW5ndGggPj0gc3RyaW5nLmxlbmd0aCkgew0KICAgICAgICByZXR1cm4gc3RyaW5nOw0KICAgICAgfQ0KICAgICAgdmFyIGVuZCA9IGxlbmd0aCAtIG9taXNzaW9uLmxlbmd0aDsNCiAgICAgIGlmIChlbmQgPCAxKSB7DQogICAgICAgIHJldHVybiBvbWlzc2lvbjsNCiAgICAgIH0NCiAgICAgIHZhciByZXN1bHQgPSBzdHJpbmcuc2xpY2UoMCwgZW5kKTsNCiAgICAgIGlmIChzZXBhcmF0b3IgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gcmVzdWx0ICsgb21pc3Npb247DQogICAgICB9DQogICAgICBpZiAoaXNSZWdFeHAoc2VwYXJhdG9yKSkgew0KICAgICAgICBpZiAoc3RyaW5nLnNsaWNlKGVuZCkuc2VhcmNoKHNlcGFyYXRvcikpIHsNCiAgICAgICAgICB2YXIgbWF0Y2gsDQogICAgICAgICAgICAgIG5ld0VuZCwNCiAgICAgICAgICAgICAgc3Vic3RyaW5nID0gc3RyaW5nLnNsaWNlKDAsIGVuZCk7DQoNCiAgICAgICAgICBpZiAoIXNlcGFyYXRvci5nbG9iYWwpIHsNCiAgICAgICAgICAgIHNlcGFyYXRvciA9IFJlZ0V4cChzZXBhcmF0b3Iuc291cmNlLCAocmVGbGFncy5leGVjKHNlcGFyYXRvcikgfHwgJycpICsgJ2cnKTsNCiAgICAgICAgICB9DQogICAgICAgICAgc2VwYXJhdG9yLmxhc3RJbmRleCA9IDA7DQogICAgICAgICAgd2hpbGUgKChtYXRjaCA9IHNlcGFyYXRvci5leGVjKHN1YnN0cmluZykpKSB7DQogICAgICAgICAgICBuZXdFbmQgPSBtYXRjaC5pbmRleDsNCiAgICAgICAgICB9DQogICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnNsaWNlKDAsIG5ld0VuZCA9PSBudWxsID8gZW5kIDogbmV3RW5kKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmIChzdHJpbmcuaW5kZXhPZihzZXBhcmF0b3IsIGVuZCkgIT0gZW5kKSB7DQogICAgICAgIHZhciBpbmRleCA9IHJlc3VsdC5sYXN0SW5kZXhPZihzZXBhcmF0b3IpOw0KICAgICAgICBpZiAoaW5kZXggPiAtMSkgew0KICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5zbGljZSgwLCBpbmRleCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQgKyBvbWlzc2lvbjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgaW52ZXJzZSBvZiBgXy5lc2NhcGVgOyB0aGlzIG1ldGhvZCBjb252ZXJ0cyB0aGUgSFRNTCBlbnRpdGllcw0KICAgICAqIGAmYW1wO2AsIGAmbHQ7YCwgYCZndDtgLCBgJnF1b3Q7YCwgYCYjMzk7YCwgYW5kIGAmIzk2O2AgaW4gYHN0cmluZ2AgdG8gdGhlaXINCiAgICAgKiBjb3JyZXNwb25kaW5nIGNoYXJhY3RlcnMuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogTm8gb3RoZXIgSFRNTCBlbnRpdGllcyBhcmUgdW5lc2NhcGVkLiBUbyB1bmVzY2FwZSBhZGRpdGlvbmFsIEhUTUwNCiAgICAgKiBlbnRpdGllcyB1c2UgYSB0aGlyZC1wYXJ0eSBsaWJyYXJ5IGxpa2UgW19oZV9dKGh0dHBzOi8vbXRocy5iZS9oZSkuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gdW5lc2NhcGUuDQogICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdW5lc2NhcGVkIHN0cmluZy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy51bmVzY2FwZSgnZnJlZCwgYmFybmV5LCAmYW1wOyBwZWJibGVzJyk7DQogICAgICogLy8gPT4gJ2ZyZWQsIGJhcm5leSwgJiBwZWJibGVzJw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHVuZXNjYXBlKHN0cmluZykgew0KICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7DQogICAgICByZXR1cm4gKHN0cmluZyAmJiByZUhhc0VzY2FwZWRIdG1sLnRlc3Qoc3RyaW5nKSkNCiAgICAgICAgPyBzdHJpbmcucmVwbGFjZShyZUVzY2FwZWRIdG1sLCB1bmVzY2FwZUh0bWxDaGFyKQ0KICAgICAgICA6IHN0cmluZzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTcGxpdHMgYHN0cmluZ2AgaW50byBhbiBhcnJheSBvZiBpdHMgd29yZHMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nDQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gaW5zcGVjdC4NCiAgICAgKiBAcGFyYW0ge1JlZ0V4cHxzdHJpbmd9IFtwYXR0ZXJuXSBUaGUgcGF0dGVybiB0byBtYXRjaCB3b3Jkcy4NCiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYSBjYWxsYmFjayBmb3IgZnVuY3Rpb25zIGxpa2UgYF8ubWFwYC4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHdvcmRzIG9mIGBzdHJpbmdgLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLndvcmRzKCdmcmVkLCBiYXJuZXksICYgcGViYmxlcycpOw0KICAgICAqIC8vID0+IFsnZnJlZCcsICdiYXJuZXknLCAncGViYmxlcyddDQogICAgICoNCiAgICAgKiBfLndvcmRzKCdmcmVkLCBiYXJuZXksICYgcGViYmxlcycsIC9bXiwgXSsvZyk7DQogICAgICogLy8gPT4gWydmcmVkJywgJ2Jhcm5leScsICcmJywgJ3BlYmJsZXMnXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHdvcmRzKHN0cmluZywgcGF0dGVybiwgZ3VhcmQpIHsNCiAgICAgIGlmIChndWFyZCAmJiBpc0l0ZXJhdGVlQ2FsbChzdHJpbmcsIHBhdHRlcm4sIGd1YXJkKSkgew0KICAgICAgICBwYXR0ZXJuID0gbnVsbDsNCiAgICAgIH0NCiAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOw0KICAgICAgcmV0dXJuIHN0cmluZy5tYXRjaChwYXR0ZXJuIHx8IHJlV29yZHMpIHx8IFtdOw0KICAgIH0NCg0KICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KICAgIC8qKg0KICAgICAqIEF0dGVtcHRzIHRvIGludm9rZSBgZnVuY2AsIHJldHVybmluZyBlaXRoZXIgdGhlIHJlc3VsdCBvciB0aGUgY2F1Z2h0IGVycm9yDQogICAgICogb2JqZWN0LiBBbnkgYWRkaXRpb25hbCBhcmd1bWVudHMgYXJlIHByb3ZpZGVkIHRvIGBmdW5jYCB3aGVuIGl0IGlzIGludm9rZWQuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgVXRpbGl0eQ0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGF0dGVtcHQuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGBmdW5jYCByZXN1bHQgb3IgZXJyb3Igb2JqZWN0Lg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiAvLyBhdm9pZCB0aHJvd2luZyBlcnJvcnMgZm9yIGludmFsaWQgc2VsZWN0b3JzDQogICAgICogdmFyIGVsZW1lbnRzID0gXy5hdHRlbXB0KGZ1bmN0aW9uKHNlbGVjdG9yKSB7DQogICAgICogICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7DQogICAgICogfSwgJz5fPicpOw0KICAgICAqDQogICAgICogaWYgKF8uaXNFcnJvcihlbGVtZW50cykpIHsNCiAgICAgKiAgIGVsZW1lbnRzID0gW107DQogICAgICogfQ0KICAgICAqLw0KICAgIHZhciBhdHRlbXB0ID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGZ1bmMsIGFyZ3MpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIHJldHVybiBmdW5jLmFwcGx5KHVuZGVmaW5lZCwgYXJncyk7DQogICAgICB9IGNhdGNoKGUpIHsNCiAgICAgICAgcmV0dXJuIGlzRXJyb3IoZSkgPyBlIDogbmV3IEVycm9yKGUpOw0KICAgICAgfQ0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCB0aGUgYHRoaXNgIGJpbmRpbmcgb2YgYHRoaXNBcmdgDQogICAgICogYW5kIGFyZ3VtZW50cyBvZiB0aGUgY3JlYXRlZCBmdW5jdGlvbi4gSWYgYGZ1bmNgIGlzIGEgcHJvcGVydHkgbmFtZSB0aGUNCiAgICAgKiBjcmVhdGVkIGNhbGxiYWNrIHJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlIGZvciBhIGdpdmVuIGVsZW1lbnQuIElmIGBmdW5jYA0KICAgICAqIGlzIGFuIG9iamVjdCB0aGUgY3JlYXRlZCBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBjb250YWluDQogICAgICogdGhlIGVxdWl2YWxlbnQgb2JqZWN0IHByb3BlcnRpZXMsIG90aGVyd2lzZSBpdCByZXR1cm5zIGBmYWxzZWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAYWxpYXMgaXRlcmF0ZWUNCiAgICAgKiBAY2F0ZWdvcnkgVXRpbGl0eQ0KICAgICAqIEBwYXJhbSB7Kn0gW2Z1bmM9Xy5pZGVudGl0eV0gVGhlIHZhbHVlIHRvIGNvbnZlcnQgdG8gYSBjYWxsYmFjay4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGZ1bmNgLg0KICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhIGNhbGxiYWNrIGZvciBmdW5jdGlvbnMgbGlrZSBgXy5tYXBgLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgY2FsbGJhY2suDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciB1c2VycyA9IFsNCiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FnZSc6IDM2IH0sDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MCB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIC8vIHdyYXAgdG8gY3JlYXRlIGN1c3RvbSBjYWxsYmFjayBzaG9ydGhhbmRzDQogICAgICogXy5jYWxsYmFjayA9IF8ud3JhcChfLmNhbGxiYWNrLCBmdW5jdGlvbihjYWxsYmFjaywgZnVuYywgdGhpc0FyZykgew0KICAgICAqICAgdmFyIG1hdGNoID0gL14oLis/KV9fKFtnbF10KSguKykkLy5leGVjKGZ1bmMpOw0KICAgICAqICAgaWYgKCFtYXRjaCkgew0KICAgICAqICAgICByZXR1cm4gY2FsbGJhY2soZnVuYywgdGhpc0FyZyk7DQogICAgICogICB9DQogICAgICogICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7DQogICAgICogICAgIHJldHVybiBtYXRjaFsyXSA9PSAnZ3QnDQogICAgICogICAgICAgPyBvYmplY3RbbWF0Y2hbMV1dID4gbWF0Y2hbM10NCiAgICAgKiAgICAgICA6IG9iamVjdFttYXRjaFsxXV0gPCBtYXRjaFszXTsNCiAgICAgKiAgIH07DQogICAgICogfSk7DQogICAgICoNCiAgICAgKiBfLmZpbHRlcih1c2VycywgJ2FnZV9fZ3QzNicpOw0KICAgICAqIC8vID0+IFt7ICd1c2VyJzogJ2ZyZWQnLCAnYWdlJzogNDAgfV0NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjYWxsYmFjayhmdW5jLCB0aGlzQXJnLCBndWFyZCkgew0KICAgICAgaWYgKGd1YXJkICYmIGlzSXRlcmF0ZWVDYWxsKGZ1bmMsIHRoaXNBcmcsIGd1YXJkKSkgew0KICAgICAgICB0aGlzQXJnID0gbnVsbDsNCiAgICAgIH0NCiAgICAgIHJldHVybiBpc09iamVjdExpa2UoZnVuYykNCiAgICAgICAgPyBtYXRjaGVzKGZ1bmMpDQogICAgICAgIDogYmFzZUNhbGxiYWNrKGZ1bmMsIHRoaXNBcmcpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYHZhbHVlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBVdGlsaXR5DQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcmV0dXJuIGZyb20gdGhlIG5ldyBmdW5jdGlvbi4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIG9iamVjdCA9IHsgJ3VzZXInOiAnZnJlZCcgfTsNCiAgICAgKiB2YXIgZ2V0dGVyID0gXy5jb25zdGFudChvYmplY3QpOw0KICAgICAqDQogICAgICogZ2V0dGVyKCkgPT09IG9iamVjdDsNCiAgICAgKiAvLyA9PiB0cnVlDQogICAgICovDQogICAgZnVuY3Rpb24gY29uc3RhbnQodmFsdWUpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHZhbHVlOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCByZXR1cm5zIHRoZSBmaXJzdCBhcmd1bWVudCBwcm92aWRlZCB0byBpdC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBVdGlsaXR5DQogICAgICogQHBhcmFtIHsqfSB2YWx1ZSBBbnkgdmFsdWUuDQogICAgICogQHJldHVybnMgeyp9IFJldHVybnMgYHZhbHVlYC4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIG9iamVjdCA9IHsgJ3VzZXInOiAnZnJlZCcgfTsNCiAgICAgKg0KICAgICAqIF8uaWRlbnRpdHkob2JqZWN0KSA9PT0gb2JqZWN0Ow0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpZGVudGl0eSh2YWx1ZSkgew0KICAgICAgcmV0dXJuIHZhbHVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHBlcmZvcm1zIGEgZGVlcCBjb21wYXJpc29uIGJldHdlZW4gYSBnaXZlbiBvYmplY3QNCiAgICAgKiBhbmQgYHNvdXJjZWAsIHJldHVybmluZyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIG9iamVjdCBoYXMgZXF1aXZhbGVudCBwcm9wZXJ0eQ0KICAgICAqIHZhbHVlcywgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIHN1cHBvcnRzIGNvbXBhcmluZyBhcnJheXMsIGJvb2xlYW5zLCBgRGF0ZWAgb2JqZWN0cywNCiAgICAgKiBudW1iZXJzLCBgT2JqZWN0YCBvYmplY3RzLCByZWdleGVzLCBhbmQgc3RyaW5ncy4gT2JqZWN0cyBhcmUgY29tcGFyZWQgYnkNCiAgICAgKiB0aGVpciBvd24sIG5vdCBpbmhlcml0ZWQsIGVudW1lcmFibGUgcHJvcGVydGllcy4gRm9yIGNvbXBhcmluZyBhIHNpbmdsZQ0KICAgICAqIG93biBvciBpbmhlcml0ZWQgcHJvcGVydHkgdmFsdWUgc2VlIGBfLm1hdGNoZXNQcm9wZXJ0eWAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgVXRpbGl0eQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCBvZiBwcm9wZXJ0eSB2YWx1ZXMgdG8gbWF0Y2guDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciB1c2VycyA9IFsNCiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FnZSc6IDM2LCAnYWN0aXZlJzogdHJ1ZSB9LA0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAnYWdlJzogNDAsICdhY3RpdmUnOiBmYWxzZSB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIF8uZmlsdGVyKHVzZXJzLCBfLm1hdGNoZXMoeyAnYWdlJzogNDAsICdhY3RpdmUnOiBmYWxzZSB9KSk7DQogICAgICogLy8gPT4gW3sgJ3VzZXInOiAnZnJlZCcsICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IGZhbHNlIH1dDQogICAgICovDQogICAgZnVuY3Rpb24gbWF0Y2hlcyhzb3VyY2UpIHsNCiAgICAgIHJldHVybiBiYXNlTWF0Y2hlcyhiYXNlQ2xvbmUoc291cmNlLCB0cnVlKSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgY29tcGFyZXMgdGhlIHByb3BlcnR5IHZhbHVlIG9mIGBwYXRoYCBvbiBhIGdpdmVuDQogICAgICogb2JqZWN0IHRvIGB2YWx1ZWAuDQogICAgICoNCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2Qgc3VwcG9ydHMgY29tcGFyaW5nIGFycmF5cywgYm9vbGVhbnMsIGBEYXRlYCBvYmplY3RzLA0KICAgICAqIG51bWJlcnMsIGBPYmplY3RgIG9iamVjdHMsIHJlZ2V4ZXMsIGFuZCBzdHJpbmdzLiBPYmplY3RzIGFyZSBjb21wYXJlZCBieQ0KICAgICAqIHRoZWlyIG93biwgbm90IGluaGVyaXRlZCwgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFV0aWxpdHkNCiAgICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0Lg0KICAgICAqIEBwYXJhbSB7Kn0gc3JjVmFsdWUgVGhlIHZhbHVlIHRvIG1hdGNoLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSBbDQogICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScgfSwNCiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcgfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiBfLmZpbmQodXNlcnMsIF8ubWF0Y2hlc1Byb3BlcnR5KCd1c2VyJywgJ2ZyZWQnKSk7DQogICAgICogLy8gPT4geyAndXNlcic6ICdmcmVkJyB9DQogICAgICovDQogICAgZnVuY3Rpb24gbWF0Y2hlc1Byb3BlcnR5KHBhdGgsIHNyY1ZhbHVlKSB7DQogICAgICByZXR1cm4gYmFzZU1hdGNoZXNQcm9wZXJ0eShwYXRoLCBiYXNlQ2xvbmUoc3JjVmFsdWUsIHRydWUpKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBpbnZva2VzIHRoZSBtZXRob2QgYXQgYHBhdGhgIG9uIGEgZ2l2ZW4gb2JqZWN0Lg0KICAgICAqIEFueSBhZGRpdGlvbmFsIGFyZ3VtZW50cyBhcmUgcHJvdmlkZWQgdG8gdGhlIGludm9rZWQgbWV0aG9kLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFV0aWxpdHkNCiAgICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgbWV0aG9kIHRvIGludm9rZS4NCiAgICAgKiBAcGFyYW0gey4uLip9IFthcmdzXSBUaGUgYXJndW1lbnRzIHRvIGludm9rZSB0aGUgbWV0aG9kIHdpdGguDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBvYmplY3RzID0gWw0KICAgICAqICAgeyAnYSc6IHsgJ2InOiB7ICdjJzogXy5jb25zdGFudCgyKSB9IH0gfSwNCiAgICAgKiAgIHsgJ2EnOiB7ICdiJzogeyAnYyc6IF8uY29uc3RhbnQoMSkgfSB9IH0NCiAgICAgKiBdOw0KICAgICAqDQogICAgICogXy5tYXAob2JqZWN0cywgXy5tZXRob2QoJ2EuYi5jJykpOw0KICAgICAqIC8vID0+IFsyLCAxXQ0KICAgICAqDQogICAgICogXy5pbnZva2UoXy5zb3J0Qnkob2JqZWN0cywgXy5tZXRob2QoWydhJywgJ2InLCAnYyddKSksICdhLmIuYycpOw0KICAgICAqIC8vID0+IFsxLCAyXQ0KICAgICAqLw0KICAgIHZhciBtZXRob2QgPSByZXN0UGFyYW0oZnVuY3Rpb24ocGF0aCwgYXJncykgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkgew0KICAgICAgICByZXR1cm4gaW52b2tlUGF0aChvYmplY3QsIHBhdGgsIGFyZ3MpOw0KICAgICAgfTsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBvcHBvc2l0ZSBvZiBgXy5tZXRob2RgOyB0aGlzIG1ldGhvZCBjcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBpbnZva2VzDQogICAgICogdGhlIG1ldGhvZCBhdCBhIGdpdmVuIHBhdGggb24gYG9iamVjdGAuIEFueSBhZGRpdGlvbmFsIGFyZ3VtZW50cyBhcmUNCiAgICAgKiBwcm92aWRlZCB0byB0aGUgaW52b2tlZCBtZXRob2QuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgVXRpbGl0eQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4NCiAgICAgKiBAcGFyYW0gey4uLip9IFthcmdzXSBUaGUgYXJndW1lbnRzIHRvIGludm9rZSB0aGUgbWV0aG9kIHdpdGguDQogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBhcnJheSA9IF8udGltZXMoMywgXy5jb25zdGFudCksDQogICAgICogICAgIG9iamVjdCA9IHsgJ2EnOiBhcnJheSwgJ2InOiBhcnJheSwgJ2MnOiBhcnJheSB9Ow0KICAgICAqDQogICAgICogXy5tYXAoWydhWzJdJywgJ2NbMF0nXSwgXy5tZXRob2RPZihvYmplY3QpKTsNCiAgICAgKiAvLyA9PiBbMiwgMF0NCiAgICAgKg0KICAgICAqIF8ubWFwKFtbJ2EnLCAnMiddLCBbJ2MnLCAnMCddXSwgXy5tZXRob2RPZihvYmplY3QpKTsNCiAgICAgKiAvLyA9PiBbMiwgMF0NCiAgICAgKi8NCiAgICB2YXIgbWV0aG9kT2YgPSByZXN0UGFyYW0oZnVuY3Rpb24ob2JqZWN0LCBhcmdzKSB7DQogICAgICByZXR1cm4gZnVuY3Rpb24ocGF0aCkgew0KICAgICAgICByZXR1cm4gaW52b2tlUGF0aChvYmplY3QsIHBhdGgsIGFyZ3MpOw0KICAgICAgfTsNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEFkZHMgYWxsIG93biBlbnVtZXJhYmxlIGZ1bmN0aW9uIHByb3BlcnRpZXMgb2YgYSBzb3VyY2Ugb2JqZWN0IHRvIHRoZQ0KICAgICAqIGRlc3RpbmF0aW9uIG9iamVjdC4gSWYgYG9iamVjdGAgaXMgYSBmdW5jdGlvbiB0aGVuIG1ldGhvZHMgYXJlIGFkZGVkIHRvDQogICAgICogaXRzIHByb3RvdHlwZSBhcyB3ZWxsLg0KICAgICAqDQogICAgICogKipOb3RlOioqIFVzZSBgXy5ydW5JbkNvbnRleHRgIHRvIGNyZWF0ZSBhIHByaXN0aW5lIGBsb2Rhc2hgIGZ1bmN0aW9uIHRvDQogICAgICogYXZvaWQgY29uZmxpY3RzIGNhdXNlZCBieSBtb2RpZnlpbmcgdGhlIG9yaWdpbmFsLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFV0aWxpdHkNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdH0gW29iamVjdD1sb2Rhc2hdIFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuDQogICAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIGZ1bmN0aW9ucyB0byBhZGQuDQogICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBUaGUgb3B0aW9ucyBvYmplY3QuDQogICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5jaGFpbj10cnVlXSBTcGVjaWZ5IHdoZXRoZXIgdGhlIGZ1bmN0aW9ucyBhZGRlZA0KICAgICAqICBhcmUgY2hhaW5hYmxlLg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbnxPYmplY3R9IFJldHVybnMgYG9iamVjdGAuDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIGZ1bmN0aW9uIHZvd2VscyhzdHJpbmcpIHsNCiAgICAgKiAgIHJldHVybiBfLmZpbHRlcihzdHJpbmcsIGZ1bmN0aW9uKHYpIHsNCiAgICAgKiAgICAgcmV0dXJuIC9bYWVpb3VdL2kudGVzdCh2KTsNCiAgICAgKiAgIH0pOw0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIF8ubWl4aW4oeyAndm93ZWxzJzogdm93ZWxzIH0pOw0KICAgICAqIF8udm93ZWxzKCdmcmVkJyk7DQogICAgICogLy8gPT4gWydlJ10NCiAgICAgKg0KICAgICAqIF8oJ2ZyZWQnKS52b3dlbHMoKS52YWx1ZSgpOw0KICAgICAqIC8vID0+IFsnZSddDQogICAgICoNCiAgICAgKiBfLm1peGluKHsgJ3Zvd2Vscyc6IHZvd2VscyB9LCB7ICdjaGFpbic6IGZhbHNlIH0pOw0KICAgICAqIF8oJ2ZyZWQnKS52b3dlbHMoKTsNCiAgICAgKiAvLyA9PiBbJ2UnXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG1peGluKG9iamVjdCwgc291cmNlLCBvcHRpb25zKSB7DQogICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7DQogICAgICAgIHZhciBpc09iaiA9IGlzT2JqZWN0KHNvdXJjZSksDQogICAgICAgICAgICBwcm9wcyA9IGlzT2JqID8ga2V5cyhzb3VyY2UpIDogbnVsbCwNCiAgICAgICAgICAgIG1ldGhvZE5hbWVzID0gKHByb3BzICYmIHByb3BzLmxlbmd0aCkgPyBiYXNlRnVuY3Rpb25zKHNvdXJjZSwgcHJvcHMpIDogbnVsbDsNCg0KICAgICAgICBpZiAoIShtZXRob2ROYW1lcyA/IG1ldGhvZE5hbWVzLmxlbmd0aCA6IGlzT2JqKSkgew0KICAgICAgICAgIG1ldGhvZE5hbWVzID0gZmFsc2U7DQogICAgICAgICAgb3B0aW9ucyA9IHNvdXJjZTsNCiAgICAgICAgICBzb3VyY2UgPSBvYmplY3Q7DQogICAgICAgICAgb2JqZWN0ID0gdGhpczsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKCFtZXRob2ROYW1lcykgew0KICAgICAgICBtZXRob2ROYW1lcyA9IGJhc2VGdW5jdGlvbnMoc291cmNlLCBrZXlzKHNvdXJjZSkpOw0KICAgICAgfQ0KICAgICAgdmFyIGNoYWluID0gdHJ1ZSwNCiAgICAgICAgICBpbmRleCA9IC0xLA0KICAgICAgICAgIGlzRnVuYyA9IGlzRnVuY3Rpb24ob2JqZWN0KSwNCiAgICAgICAgICBsZW5ndGggPSBtZXRob2ROYW1lcy5sZW5ndGg7DQoNCiAgICAgIGlmIChvcHRpb25zID09PSBmYWxzZSkgew0KICAgICAgICBjaGFpbiA9IGZhbHNlOw0KICAgICAgfSBlbHNlIGlmIChpc09iamVjdChvcHRpb25zKSAmJiAnY2hhaW4nIGluIG9wdGlvbnMpIHsNCiAgICAgICAgY2hhaW4gPSBvcHRpb25zLmNoYWluOw0KICAgICAgfQ0KICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsNCiAgICAgICAgdmFyIG1ldGhvZE5hbWUgPSBtZXRob2ROYW1lc1tpbmRleF0sDQogICAgICAgICAgICBmdW5jID0gc291cmNlW21ldGhvZE5hbWVdOw0KDQogICAgICAgIG9iamVjdFttZXRob2ROYW1lXSA9IGZ1bmM7DQogICAgICAgIGlmIChpc0Z1bmMpIHsNCiAgICAgICAgICBvYmplY3QucHJvdG90eXBlW21ldGhvZE5hbWVdID0gKGZ1bmN0aW9uKGZ1bmMpIHsNCiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgdmFyIGNoYWluQWxsID0gdGhpcy5fX2NoYWluX187DQogICAgICAgICAgICAgIGlmIChjaGFpbiB8fCBjaGFpbkFsbCkgew0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBvYmplY3QodGhpcy5fX3dyYXBwZWRfXyksDQogICAgICAgICAgICAgICAgICAgIGFjdGlvbnMgPSByZXN1bHQuX19hY3Rpb25zX18gPSBhcnJheUNvcHkodGhpcy5fX2FjdGlvbnNfXyk7DQoNCiAgICAgICAgICAgICAgICBhY3Rpb25zLnB1c2goeyAnZnVuYyc6IGZ1bmMsICdhcmdzJzogYXJndW1lbnRzLCAndGhpc0FyZyc6IG9iamVjdCB9KTsNCiAgICAgICAgICAgICAgICByZXN1bHQuX19jaGFpbl9fID0gY2hhaW5BbGw7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB2YXIgYXJncyA9IFt0aGlzLnZhbHVlKCldOw0KICAgICAgICAgICAgICBwdXNoLmFwcGx5KGFyZ3MsIGFyZ3VtZW50cyk7DQogICAgICAgICAgICAgIHJldHVybiBmdW5jLmFwcGx5KG9iamVjdCwgYXJncyk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgIH0oZnVuYykpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gb2JqZWN0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldmVydHMgdGhlIGBfYCB2YXJpYWJsZSB0byBpdHMgcHJldmlvdXMgdmFsdWUgYW5kIHJldHVybnMgYSByZWZlcmVuY2UgdG8NCiAgICAgKiB0aGUgYGxvZGFzaGAgZnVuY3Rpb24uDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgVXRpbGl0eQ0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgYGxvZGFzaGAgZnVuY3Rpb24uDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBsb2Rhc2ggPSBfLm5vQ29uZmxpY3QoKTsNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBub0NvbmZsaWN0KCkgew0KICAgICAgY29udGV4dC5fID0gb2xkRGFzaDsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEEgbm8tb3BlcmF0aW9uIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBgdW5kZWZpbmVkYCByZWdhcmRsZXNzIG9mIHRoZQ0KICAgICAqIGFyZ3VtZW50cyBpdCByZWNlaXZlcy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBVdGlsaXR5DQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqIHZhciBvYmplY3QgPSB7ICd1c2VyJzogJ2ZyZWQnIH07DQogICAgICoNCiAgICAgKiBfLm5vb3Aob2JqZWN0KSA9PT0gdW5kZWZpbmVkOw0KICAgICAqIC8vID0+IHRydWUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBub29wKCkgew0KICAgICAgLy8gTm8gb3BlcmF0aW9uIHBlcmZvcm1lZC4NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBhdCBgcGF0aGAgb24gYQ0KICAgICAqIGdpdmVuIG9iamVjdC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBVdGlsaXR5DQogICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC4NCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIG9iamVjdHMgPSBbDQogICAgICogICB7ICdhJzogeyAnYic6IHsgJ2MnOiAyIH0gfSB9LA0KICAgICAqICAgeyAnYSc6IHsgJ2InOiB7ICdjJzogMSB9IH0gfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiBfLm1hcChvYmplY3RzLCBfLnByb3BlcnR5KCdhLmIuYycpKTsNCiAgICAgKiAvLyA9PiBbMiwgMV0NCiAgICAgKg0KICAgICAqIF8ucGx1Y2soXy5zb3J0Qnkob2JqZWN0cywgXy5wcm9wZXJ0eShbJ2EnLCAnYicsICdjJ10pKSwgJ2EuYi5jJyk7DQogICAgICogLy8gPT4gWzEsIDJdDQogICAgICovDQogICAgZnVuY3Rpb24gcHJvcGVydHkocGF0aCkgew0KICAgICAgcmV0dXJuIGlzS2V5KHBhdGgpID8gYmFzZVByb3BlcnR5KHBhdGgpIDogYmFzZVByb3BlcnR5RGVlcChwYXRoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgb3Bwb3NpdGUgb2YgYF8ucHJvcGVydHlgOyB0aGlzIG1ldGhvZCBjcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zDQogICAgICogdGhlIHByb3BlcnR5IHZhbHVlIGF0IGEgZ2l2ZW4gcGF0aCBvbiBgb2JqZWN0YC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBVdGlsaXR5DQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5Lg0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiB2YXIgYXJyYXkgPSBbMCwgMSwgMl0sDQogICAgICogICAgIG9iamVjdCA9IHsgJ2EnOiBhcnJheSwgJ2InOiBhcnJheSwgJ2MnOiBhcnJheSB9Ow0KICAgICAqDQogICAgICogXy5tYXAoWydhWzJdJywgJ2NbMF0nXSwgXy5wcm9wZXJ0eU9mKG9iamVjdCkpOw0KICAgICAqIC8vID0+IFsyLCAwXQ0KICAgICAqDQogICAgICogXy5tYXAoW1snYScsICcyJ10sIFsnYycsICcwJ11dLCBfLnByb3BlcnR5T2Yob2JqZWN0KSk7DQogICAgICogLy8gPT4gWzIsIDBdDQogICAgICovDQogICAgZnVuY3Rpb24gcHJvcGVydHlPZihvYmplY3QpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbihwYXRoKSB7DQogICAgICAgIHJldHVybiBiYXNlR2V0KG9iamVjdCwgdG9QYXRoKHBhdGgpLCBwYXRoICsgJycpOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIG51bWJlcnMgKHBvc2l0aXZlIGFuZC9vciBuZWdhdGl2ZSkgcHJvZ3Jlc3NpbmcgZnJvbQ0KICAgICAqIGBzdGFydGAgdXAgdG8sIGJ1dCBub3QgaW5jbHVkaW5nLCBgZW5kYC4gSWYgYGVuZGAgaXMgbm90IHNwZWNpZmllZCBpdCBpcw0KICAgICAqIHNldCB0byBgc3RhcnRgIHdpdGggYHN0YXJ0YCB0aGVuIHNldCB0byBgMGAuIElmIGBlbmRgIGlzIGxlc3MgdGhhbiBgc3RhcnRgDQogICAgICogYSB6ZXJvLWxlbmd0aCByYW5nZSBpcyBjcmVhdGVkIHVubGVzcyBhIG5lZ2F0aXZlIGBzdGVwYCBpcyBzcGVjaWZpZWQuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgVXRpbGl0eQ0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RhcnQ9MF0gVGhlIHN0YXJ0IG9mIHRoZSByYW5nZS4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gZW5kIFRoZSBlbmQgb2YgdGhlIHJhbmdlLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RlcD0xXSBUaGUgdmFsdWUgdG8gaW5jcmVtZW50IG9yIGRlY3JlbWVudCBieS4NCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBudW1iZXJzLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnJhbmdlKDQpOw0KICAgICAqIC8vID0+IFswLCAxLCAyLCAzXQ0KICAgICAqDQogICAgICogXy5yYW5nZSgxLCA1KTsNCiAgICAgKiAvLyA9PiBbMSwgMiwgMywgNF0NCiAgICAgKg0KICAgICAqIF8ucmFuZ2UoMCwgMjAsIDUpOw0KICAgICAqIC8vID0+IFswLCA1LCAxMCwgMTVdDQogICAgICoNCiAgICAgKiBfLnJhbmdlKDAsIC00LCAtMSk7DQogICAgICogLy8gPT4gWzAsIC0xLCAtMiwgLTNdDQogICAgICoNCiAgICAgKiBfLnJhbmdlKDEsIDQsIDApOw0KICAgICAqIC8vID0+IFsxLCAxLCAxXQ0KICAgICAqDQogICAgICogXy5yYW5nZSgwKTsNCiAgICAgKiAvLyA9PiBbXQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJhbmdlKHN0YXJ0LCBlbmQsIHN0ZXApIHsNCiAgICAgIGlmIChzdGVwICYmIGlzSXRlcmF0ZWVDYWxsKHN0YXJ0LCBlbmQsIHN0ZXApKSB7DQogICAgICAgIGVuZCA9IHN0ZXAgPSBudWxsOw0KICAgICAgfQ0KICAgICAgc3RhcnQgPSArc3RhcnQgfHwgMDsNCiAgICAgIHN0ZXAgPSBzdGVwID09IG51bGwgPyAxIDogKCtzdGVwIHx8IDApOw0KDQogICAgICBpZiAoZW5kID09IG51bGwpIHsNCiAgICAgICAgZW5kID0gc3RhcnQ7DQogICAgICAgIHN0YXJ0ID0gMDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGVuZCA9ICtlbmQgfHwgMDsNCiAgICAgIH0NCiAgICAgIC8vIFVzZSBgQXJyYXkobGVuZ3RoKWAgc28gZW5naW5lcyBsaWtlIENoYWtyYSBhbmQgVjggYXZvaWQgc2xvd2VyIG1vZGVzLg0KICAgICAgLy8gU2VlIGh0dHBzOi8veW91dHUuYmUvWEFxSXBHVThaWmsjdD0xN20yNXMgZm9yIG1vcmUgZGV0YWlscy4NCiAgICAgIHZhciBpbmRleCA9IC0xLA0KICAgICAgICAgIGxlbmd0aCA9IG5hdGl2ZU1heChjZWlsKChlbmQgLSBzdGFydCkgLyAoc3RlcCB8fCAxKSksIDApLA0KICAgICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7DQoNCiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7DQogICAgICAgIHJlc3VsdFtpbmRleF0gPSBzdGFydDsNCiAgICAgICAgc3RhcnQgKz0gc3RlcDsNCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW52b2tlcyB0aGUgaXRlcmF0ZWUgZnVuY3Rpb24gYG5gIHRpbWVzLCByZXR1cm5pbmcgYW4gYXJyYXkgb2YgdGhlIHJlc3VsdHMNCiAgICAgKiBvZiBlYWNoIGludm9jYXRpb24uIFRoZSBgaXRlcmF0ZWVgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoDQogICAgICogb25lIGFyZ3VtZW50OyAoaW5kZXgpLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IFV0aWxpdHkNCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbiBUaGUgbnVtYmVyIG9mIHRpbWVzIHRvIGludm9rZSBgaXRlcmF0ZWVgLg0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLg0KICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgaXRlcmF0ZWVgLg0KICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcmVzdWx0cy4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogdmFyIGRpY2VSb2xscyA9IF8udGltZXMoMywgXy5wYXJ0aWFsKF8ucmFuZG9tLCAxLCA2LCBmYWxzZSkpOw0KICAgICAqIC8vID0+IFszLCA2LCA0XQ0KICAgICAqDQogICAgICogXy50aW1lcygzLCBmdW5jdGlvbihuKSB7DQogICAgICogICBtYWdlLmNhc3RTcGVsbChuKTsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiBpbnZva2VzIGBtYWdlLmNhc3RTcGVsbChuKWAgdGhyZWUgdGltZXMgd2l0aCBgbmAgb2YgYDBgLCBgMWAsIGFuZCBgMmANCiAgICAgKg0KICAgICAqIF8udGltZXMoMywgZnVuY3Rpb24obikgew0KICAgICAqICAgdGhpcy5jYXN0KG4pOw0KICAgICAqIH0sIG1hZ2UpOw0KICAgICAqIC8vID0+IGFsc28gaW52b2tlcyBgbWFnZS5jYXN0U3BlbGwobilgIHRocmVlIHRpbWVzDQogICAgICovDQogICAgZnVuY3Rpb24gdGltZXMobiwgaXRlcmF0ZWUsIHRoaXNBcmcpIHsNCiAgICAgIG4gPSBmbG9vcihuKTsNCg0KICAgICAgLy8gRXhpdCBlYXJseSB0byBhdm9pZCBhIEpTQyBKSVQgYnVnIGluIFNhZmFyaSA4DQogICAgICAvLyB3aGVyZSBgQXJyYXkoMClgIGlzIHRyZWF0ZWQgYXMgYEFycmF5KDEpYC4NCiAgICAgIGlmIChuIDwgMSB8fCAhbmF0aXZlSXNGaW5pdGUobikpIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgfQ0KICAgICAgdmFyIGluZGV4ID0gLTEsDQogICAgICAgICAgcmVzdWx0ID0gQXJyYXkobmF0aXZlTWluKG4sIE1BWF9BUlJBWV9MRU5HVEgpKTsNCg0KICAgICAgaXRlcmF0ZWUgPSBiaW5kQ2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDEpOw0KICAgICAgd2hpbGUgKCsraW5kZXggPCBuKSB7DQogICAgICAgIGlmIChpbmRleCA8IE1BWF9BUlJBWV9MRU5HVEgpIHsNCiAgICAgICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoaW5kZXgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGl0ZXJhdGVlKGluZGV4KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZW5lcmF0ZXMgYSB1bmlxdWUgSUQuIElmIGBwcmVmaXhgIGlzIHByb3ZpZGVkIHRoZSBJRCBpcyBhcHBlbmRlZCB0byBpdC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBVdGlsaXR5DQogICAgICogQHBhcmFtIHtzdHJpbmd9IFtwcmVmaXhdIFRoZSB2YWx1ZSB0byBwcmVmaXggdGhlIElEIHdpdGguDQogICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdW5pcXVlIElELg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnVuaXF1ZUlkKCdjb250YWN0XycpOw0KICAgICAqIC8vID0+ICdjb250YWN0XzEwNCcNCiAgICAgKg0KICAgICAqIF8udW5pcXVlSWQoKTsNCiAgICAgKiAvLyA9PiAnMTA1Jw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHVuaXF1ZUlkKHByZWZpeCkgew0KICAgICAgdmFyIGlkID0gKytpZENvdW50ZXI7DQogICAgICByZXR1cm4gYmFzZVRvU3RyaW5nKHByZWZpeCkgKyBpZDsNCiAgICB9DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvKioNCiAgICAgKiBBZGRzIHR3byBudW1iZXJzLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQGNhdGVnb3J5IE1hdGgNCiAgICAgKiBAcGFyYW0ge251bWJlcn0gYXVnZW5kIFRoZSBmaXJzdCBudW1iZXIgdG8gYWRkLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBhZGRlbmQgVGhlIHNlY29uZCBudW1iZXIgdG8gYWRkLg0KICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHN1bS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5hZGQoNiwgNCk7DQogICAgICogLy8gPT4gMTANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhZGQoYXVnZW5kLCBhZGRlbmQpIHsNCiAgICAgIHJldHVybiAoK2F1Z2VuZCB8fCAwKSArICgrYWRkZW5kIHx8IDApOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldHMgdGhlIG1heGltdW0gdmFsdWUgb2YgYGNvbGxlY3Rpb25gLiBJZiBgY29sbGVjdGlvbmAgaXMgZW1wdHkgb3IgZmFsc2V5DQogICAgICogYC1JbmZpbml0eWAgaXMgcmV0dXJuZWQuIElmIGFuIGl0ZXJhdGVlIGZ1bmN0aW9uIGlzIHByb3ZpZGVkIGl0IGlzIGludm9rZWQNCiAgICAgKiBmb3IgZWFjaCB2YWx1ZSBpbiBgY29sbGVjdGlvbmAgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvbiBieSB3aGljaCB0aGUgdmFsdWUNCiAgICAgKiBpcyByYW5rZWQuIFRoZSBgaXRlcmF0ZWVgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlDQogICAgICogYXJndW1lbnRzOiAodmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKS4NCiAgICAgKg0KICAgICAqIElmIGEgcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZCBmb3IgYGl0ZXJhdGVlYCB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGEgdmFsdWUgaXMgYWxzbyBwcm92aWRlZCBmb3IgYHRoaXNBcmdgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNQcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWF0Y2hpbmcgcHJvcGVydHkNCiAgICAgKiB2YWx1ZSwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBgaXRlcmF0ZWVgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNgIHN0eWxlDQogICAgICogY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSB0aGUgcHJvcGVydGllcyBvZiB0aGUgZ2l2ZW4NCiAgICAgKiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBNYXRoDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxzdHJpbmd9IFtpdGVyYXRlZV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGl0ZXJhdGVlYC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbWF4aW11bSB2YWx1ZS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5tYXgoWzQsIDIsIDgsIDZdKTsNCiAgICAgKiAvLyA9PiA4DQogICAgICoNCiAgICAgKiBfLm1heChbXSk7DQogICAgICogLy8gPT4gLUluZmluaXR5DQogICAgICoNCiAgICAgKiB2YXIgdXNlcnMgPSBbDQogICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICdhZ2UnOiAzNiB9LA0KICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAnYWdlJzogNDAgfQ0KICAgICAqIF07DQogICAgICoNCiAgICAgKiBfLm1heCh1c2VycywgZnVuY3Rpb24oY2hyKSB7DQogICAgICogICByZXR1cm4gY2hyLmFnZTsNCiAgICAgKiB9KTsNCiAgICAgKiAvLyA9PiB7ICd1c2VyJzogJ2ZyZWQnLCAnYWdlJzogNDAgfQ0KICAgICAqDQogICAgICogLy8gdXNpbmcgdGhlIGBfLnByb3BlcnR5YCBjYWxsYmFjayBzaG9ydGhhbmQNCiAgICAgKiBfLm1heCh1c2VycywgJ2FnZScpOw0KICAgICAqIC8vID0+IHsgJ3VzZXInOiAnZnJlZCcsICdhZ2UnOiA0MCB9DQogICAgICovDQogICAgdmFyIG1heCA9IGNyZWF0ZUV4dHJlbXVtKGd0LCBORUdBVElWRV9JTkZJTklUWSk7DQoNCiAgICAvKioNCiAgICAgKiBHZXRzIHRoZSBtaW5pbXVtIHZhbHVlIG9mIGBjb2xsZWN0aW9uYC4gSWYgYGNvbGxlY3Rpb25gIGlzIGVtcHR5IG9yIGZhbHNleQ0KICAgICAqIGBJbmZpbml0eWAgaXMgcmV0dXJuZWQuIElmIGFuIGl0ZXJhdGVlIGZ1bmN0aW9uIGlzIHByb3ZpZGVkIGl0IGlzIGludm9rZWQNCiAgICAgKiBmb3IgZWFjaCB2YWx1ZSBpbiBgY29sbGVjdGlvbmAgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvbiBieSB3aGljaCB0aGUgdmFsdWUNCiAgICAgKiBpcyByYW5rZWQuIFRoZSBgaXRlcmF0ZWVgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlDQogICAgICogYXJndW1lbnRzOiAodmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKS4NCiAgICAgKg0KICAgICAqIElmIGEgcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZCBmb3IgYGl0ZXJhdGVlYCB0aGUgY3JlYXRlZCBgXy5wcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4NCiAgICAgKg0KICAgICAqIElmIGEgdmFsdWUgaXMgYWxzbyBwcm92aWRlZCBmb3IgYHRoaXNBcmdgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNQcm9wZXJ0eWANCiAgICAgKiBzdHlsZSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBmb3IgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWF0Y2hpbmcgcHJvcGVydHkNCiAgICAgKiB2YWx1ZSwgZWxzZSBgZmFsc2VgLg0KICAgICAqDQogICAgICogSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkIGZvciBgaXRlcmF0ZWVgIHRoZSBjcmVhdGVkIGBfLm1hdGNoZXNgIHN0eWxlDQogICAgICogY2FsbGJhY2sgcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgaGF2ZSB0aGUgcHJvcGVydGllcyBvZiB0aGUgZ2l2ZW4NCiAgICAgKiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKiBAbWVtYmVyT2YgXw0KICAgICAqIEBjYXRlZ29yeSBNYXRoDQogICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci4NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxzdHJpbmd9IFtpdGVyYXRlZV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGl0ZXJhdGVlYC4NCiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbWluaW11bSB2YWx1ZS4NCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogXy5taW4oWzQsIDIsIDgsIDZdKTsNCiAgICAgKiAvLyA9PiAyDQogICAgICoNCiAgICAgKiBfLm1pbihbXSk7DQogICAgICogLy8gPT4gSW5maW5pdHkNCiAgICAgKg0KICAgICAqIHZhciB1c2VycyA9IFsNCiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FnZSc6IDM2IH0sDQogICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MCB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIF8ubWluKHVzZXJzLCBmdW5jdGlvbihjaHIpIHsNCiAgICAgKiAgIHJldHVybiBjaHIuYWdlOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IHsgJ3VzZXInOiAnYmFybmV5JywgJ2FnZSc6IDM2IH0NCiAgICAgKg0KICAgICAqIC8vIHVzaW5nIHRoZSBgXy5wcm9wZXJ0eWAgY2FsbGJhY2sgc2hvcnRoYW5kDQogICAgICogXy5taW4odXNlcnMsICdhZ2UnKTsNCiAgICAgKiAvLyA9PiB7ICd1c2VyJzogJ2Jhcm5leScsICdhZ2UnOiAzNiB9DQogICAgICovDQogICAgdmFyIG1pbiA9IGNyZWF0ZUV4dHJlbXVtKGx0LCBQT1NJVElWRV9JTkZJTklUWSk7DQoNCiAgICAvKioNCiAgICAgKiBHZXRzIHRoZSBzdW0gb2YgdGhlIHZhbHVlcyBpbiBgY29sbGVjdGlvbmAuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICogQG1lbWJlck9mIF8NCiAgICAgKiBAY2F0ZWdvcnkgTWF0aA0KICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuDQogICAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8c3RyaW5nfSBbaXRlcmF0ZWVdIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uDQogICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBpdGVyYXRlZWAuDQogICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgc3VtLg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiBfLnN1bShbNCwgNl0pOw0KICAgICAqIC8vID0+IDEwDQogICAgICoNCiAgICAgKiBfLnN1bSh7ICdhJzogNCwgJ2InOiA2IH0pOw0KICAgICAqIC8vID0+IDEwDQogICAgICoNCiAgICAgKiB2YXIgb2JqZWN0cyA9IFsNCiAgICAgKiAgIHsgJ24nOiA0IH0sDQogICAgICogICB7ICduJzogNiB9DQogICAgICogXTsNCiAgICAgKg0KICAgICAqIF8uc3VtKG9iamVjdHMsIGZ1bmN0aW9uKG9iamVjdCkgew0KICAgICAqICAgcmV0dXJuIG9iamVjdC5uOw0KICAgICAqIH0pOw0KICAgICAqIC8vID0+IDEwDQogICAgICoNCiAgICAgKiAvLyB1c2luZyB0aGUgYF8ucHJvcGVydHlgIGNhbGxiYWNrIHNob3J0aGFuZA0KICAgICAqIF8uc3VtKG9iamVjdHMsICduJyk7DQogICAgICogLy8gPT4gMTANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdW0oY29sbGVjdGlvbiwgaXRlcmF0ZWUsIHRoaXNBcmcpIHsNCiAgICAgIGlmICh0aGlzQXJnICYmIGlzSXRlcmF0ZWVDYWxsKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCB0aGlzQXJnKSkgew0KICAgICAgICBpdGVyYXRlZSA9IG51bGw7DQogICAgICB9DQogICAgICB2YXIgY2FsbGJhY2sgPSBnZXRDYWxsYmFjaygpLA0KICAgICAgICAgIG5vSXRlcmF0ZWUgPSBpdGVyYXRlZSA9PSBudWxsOw0KDQogICAgICBpZiAoIShub0l0ZXJhdGVlICYmIGNhbGxiYWNrID09PSBiYXNlQ2FsbGJhY2spKSB7DQogICAgICAgIG5vSXRlcmF0ZWUgPSBmYWxzZTsNCiAgICAgICAgaXRlcmF0ZWUgPSBjYWxsYmFjayhpdGVyYXRlZSwgdGhpc0FyZywgMyk7DQogICAgICB9DQogICAgICByZXR1cm4gbm9JdGVyYXRlZQ0KICAgICAgICA/IGFycmF5U3VtKGlzQXJyYXkoY29sbGVjdGlvbikgPyBjb2xsZWN0aW9uIDogdG9JdGVyYWJsZShjb2xsZWN0aW9uKSkNCiAgICAgICAgOiBiYXNlU3VtKGNvbGxlY3Rpb24sIGl0ZXJhdGVlKTsNCiAgICB9DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgICAvLyBFbnN1cmUgd3JhcHBlcnMgYXJlIGluc3RhbmNlcyBvZiBgYmFzZUxvZGFzaGAuDQogICAgbG9kYXNoLnByb3RvdHlwZSA9IGJhc2VMb2Rhc2gucHJvdG90eXBlOw0KDQogICAgTG9kYXNoV3JhcHBlci5wcm90b3R5cGUgPSBiYXNlQ3JlYXRlKGJhc2VMb2Rhc2gucHJvdG90eXBlKTsNCiAgICBMb2Rhc2hXcmFwcGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IExvZGFzaFdyYXBwZXI7DQoNCiAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUgPSBiYXNlQ3JlYXRlKGJhc2VMb2Rhc2gucHJvdG90eXBlKTsNCiAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBMYXp5V3JhcHBlcjsNCg0KICAgIC8vIEFkZCBmdW5jdGlvbnMgdG8gdGhlIGBNYXBgIGNhY2hlLg0KICAgIE1hcENhY2hlLnByb3RvdHlwZVsnZGVsZXRlJ10gPSBtYXBEZWxldGU7DQogICAgTWFwQ2FjaGUucHJvdG90eXBlLmdldCA9IG1hcEdldDsNCiAgICBNYXBDYWNoZS5wcm90b3R5cGUuaGFzID0gbWFwSGFzOw0KICAgIE1hcENhY2hlLnByb3RvdHlwZS5zZXQgPSBtYXBTZXQ7DQoNCiAgICAvLyBBZGQgZnVuY3Rpb25zIHRvIHRoZSBgU2V0YCBjYWNoZS4NCiAgICBTZXRDYWNoZS5wcm90b3R5cGUucHVzaCA9IGNhY2hlUHVzaDsNCg0KICAgIC8vIEFzc2lnbiBjYWNoZSB0byBgXy5tZW1vaXplYC4NCiAgICBtZW1vaXplLkNhY2hlID0gTWFwQ2FjaGU7DQoNCiAgICAvLyBBZGQgZnVuY3Rpb25zIHRoYXQgcmV0dXJuIHdyYXBwZWQgdmFsdWVzIHdoZW4gY2hhaW5pbmcuDQogICAgbG9kYXNoLmFmdGVyID0gYWZ0ZXI7DQogICAgbG9kYXNoLmFyeSA9IGFyeTsNCiAgICBsb2Rhc2guYXNzaWduID0gYXNzaWduOw0KICAgIGxvZGFzaC5hdCA9IGF0Ow0KICAgIGxvZGFzaC5iZWZvcmUgPSBiZWZvcmU7DQogICAgbG9kYXNoLmJpbmQgPSBiaW5kOw0KICAgIGxvZGFzaC5iaW5kQWxsID0gYmluZEFsbDsNCiAgICBsb2Rhc2guYmluZEtleSA9IGJpbmRLZXk7DQogICAgbG9kYXNoLmNhbGxiYWNrID0gY2FsbGJhY2s7DQogICAgbG9kYXNoLmNoYWluID0gY2hhaW47DQogICAgbG9kYXNoLmNodW5rID0gY2h1bms7DQogICAgbG9kYXNoLmNvbXBhY3QgPSBjb21wYWN0Ow0KICAgIGxvZGFzaC5jb25zdGFudCA9IGNvbnN0YW50Ow0KICAgIGxvZGFzaC5jb3VudEJ5ID0gY291bnRCeTsNCiAgICBsb2Rhc2guY3JlYXRlID0gY3JlYXRlOw0KICAgIGxvZGFzaC5jdXJyeSA9IGN1cnJ5Ow0KICAgIGxvZGFzaC5jdXJyeVJpZ2h0ID0gY3VycnlSaWdodDsNCiAgICBsb2Rhc2guZGVib3VuY2UgPSBkZWJvdW5jZTsNCiAgICBsb2Rhc2guZGVmYXVsdHMgPSBkZWZhdWx0czsNCiAgICBsb2Rhc2guZGVmZXIgPSBkZWZlcjsNCiAgICBsb2Rhc2guZGVsYXkgPSBkZWxheTsNCiAgICBsb2Rhc2guZGlmZmVyZW5jZSA9IGRpZmZlcmVuY2U7DQogICAgbG9kYXNoLmRyb3AgPSBkcm9wOw0KICAgIGxvZGFzaC5kcm9wUmlnaHQgPSBkcm9wUmlnaHQ7DQogICAgbG9kYXNoLmRyb3BSaWdodFdoaWxlID0gZHJvcFJpZ2h0V2hpbGU7DQogICAgbG9kYXNoLmRyb3BXaGlsZSA9IGRyb3BXaGlsZTsNCiAgICBsb2Rhc2guZmlsbCA9IGZpbGw7DQogICAgbG9kYXNoLmZpbHRlciA9IGZpbHRlcjsNCiAgICBsb2Rhc2guZmxhdHRlbiA9IGZsYXR0ZW47DQogICAgbG9kYXNoLmZsYXR0ZW5EZWVwID0gZmxhdHRlbkRlZXA7DQogICAgbG9kYXNoLmZsb3cgPSBmbG93Ow0KICAgIGxvZGFzaC5mbG93UmlnaHQgPSBmbG93UmlnaHQ7DQogICAgbG9kYXNoLmZvckVhY2ggPSBmb3JFYWNoOw0KICAgIGxvZGFzaC5mb3JFYWNoUmlnaHQgPSBmb3JFYWNoUmlnaHQ7DQogICAgbG9kYXNoLmZvckluID0gZm9ySW47DQogICAgbG9kYXNoLmZvckluUmlnaHQgPSBmb3JJblJpZ2h0Ow0KICAgIGxvZGFzaC5mb3JPd24gPSBmb3JPd247DQogICAgbG9kYXNoLmZvck93blJpZ2h0ID0gZm9yT3duUmlnaHQ7DQogICAgbG9kYXNoLmZ1bmN0aW9ucyA9IGZ1bmN0aW9uczsNCiAgICBsb2Rhc2guZ3JvdXBCeSA9IGdyb3VwQnk7DQogICAgbG9kYXNoLmluZGV4QnkgPSBpbmRleEJ5Ow0KICAgIGxvZGFzaC5pbml0aWFsID0gaW5pdGlhbDsNCiAgICBsb2Rhc2guaW50ZXJzZWN0aW9uID0gaW50ZXJzZWN0aW9uOw0KICAgIGxvZGFzaC5pbnZlcnQgPSBpbnZlcnQ7DQogICAgbG9kYXNoLmludm9rZSA9IGludm9rZTsNCiAgICBsb2Rhc2gua2V5cyA9IGtleXM7DQogICAgbG9kYXNoLmtleXNJbiA9IGtleXNJbjsNCiAgICBsb2Rhc2gubWFwID0gbWFwOw0KICAgIGxvZGFzaC5tYXBLZXlzID0gbWFwS2V5czsNCiAgICBsb2Rhc2gubWFwVmFsdWVzID0gbWFwVmFsdWVzOw0KICAgIGxvZGFzaC5tYXRjaGVzID0gbWF0Y2hlczsNCiAgICBsb2Rhc2gubWF0Y2hlc1Byb3BlcnR5ID0gbWF0Y2hlc1Byb3BlcnR5Ow0KICAgIGxvZGFzaC5tZW1vaXplID0gbWVtb2l6ZTsNCiAgICBsb2Rhc2gubWVyZ2UgPSBtZXJnZTsNCiAgICBsb2Rhc2gubWV0aG9kID0gbWV0aG9kOw0KICAgIGxvZGFzaC5tZXRob2RPZiA9IG1ldGhvZE9mOw0KICAgIGxvZGFzaC5taXhpbiA9IG1peGluOw0KICAgIGxvZGFzaC5uZWdhdGUgPSBuZWdhdGU7DQogICAgbG9kYXNoLm9taXQgPSBvbWl0Ow0KICAgIGxvZGFzaC5vbmNlID0gb25jZTsNCiAgICBsb2Rhc2gucGFpcnMgPSBwYWlyczsNCiAgICBsb2Rhc2gucGFydGlhbCA9IHBhcnRpYWw7DQogICAgbG9kYXNoLnBhcnRpYWxSaWdodCA9IHBhcnRpYWxSaWdodDsNCiAgICBsb2Rhc2gucGFydGl0aW9uID0gcGFydGl0aW9uOw0KICAgIGxvZGFzaC5waWNrID0gcGljazsNCiAgICBsb2Rhc2gucGx1Y2sgPSBwbHVjazsNCiAgICBsb2Rhc2gucHJvcGVydHkgPSBwcm9wZXJ0eTsNCiAgICBsb2Rhc2gucHJvcGVydHlPZiA9IHByb3BlcnR5T2Y7DQogICAgbG9kYXNoLnB1bGwgPSBwdWxsOw0KICAgIGxvZGFzaC5wdWxsQXQgPSBwdWxsQXQ7DQogICAgbG9kYXNoLnJhbmdlID0gcmFuZ2U7DQogICAgbG9kYXNoLnJlYXJnID0gcmVhcmc7DQogICAgbG9kYXNoLnJlamVjdCA9IHJlamVjdDsNCiAgICBsb2Rhc2gucmVtb3ZlID0gcmVtb3ZlOw0KICAgIGxvZGFzaC5yZXN0ID0gcmVzdDsNCiAgICBsb2Rhc2gucmVzdFBhcmFtID0gcmVzdFBhcmFtOw0KICAgIGxvZGFzaC5zZXQgPSBzZXQ7DQogICAgbG9kYXNoLnNodWZmbGUgPSBzaHVmZmxlOw0KICAgIGxvZGFzaC5zbGljZSA9IHNsaWNlOw0KICAgIGxvZGFzaC5zb3J0QnkgPSBzb3J0Qnk7DQogICAgbG9kYXNoLnNvcnRCeUFsbCA9IHNvcnRCeUFsbDsNCiAgICBsb2Rhc2guc29ydEJ5T3JkZXIgPSBzb3J0QnlPcmRlcjsNCiAgICBsb2Rhc2guc3ByZWFkID0gc3ByZWFkOw0KICAgIGxvZGFzaC50YWtlID0gdGFrZTsNCiAgICBsb2Rhc2gudGFrZVJpZ2h0ID0gdGFrZVJpZ2h0Ow0KICAgIGxvZGFzaC50YWtlUmlnaHRXaGlsZSA9IHRha2VSaWdodFdoaWxlOw0KICAgIGxvZGFzaC50YWtlV2hpbGUgPSB0YWtlV2hpbGU7DQogICAgbG9kYXNoLnRhcCA9IHRhcDsNCiAgICBsb2Rhc2gudGhyb3R0bGUgPSB0aHJvdHRsZTsNCiAgICBsb2Rhc2gudGhydSA9IHRocnU7DQogICAgbG9kYXNoLnRpbWVzID0gdGltZXM7DQogICAgbG9kYXNoLnRvQXJyYXkgPSB0b0FycmF5Ow0KICAgIGxvZGFzaC50b1BsYWluT2JqZWN0ID0gdG9QbGFpbk9iamVjdDsNCiAgICBsb2Rhc2gudHJhbnNmb3JtID0gdHJhbnNmb3JtOw0KICAgIGxvZGFzaC51bmlvbiA9IHVuaW9uOw0KICAgIGxvZGFzaC51bmlxID0gdW5pcTsNCiAgICBsb2Rhc2gudW56aXAgPSB1bnppcDsNCiAgICBsb2Rhc2gudW56aXBXaXRoID0gdW56aXBXaXRoOw0KICAgIGxvZGFzaC52YWx1ZXMgPSB2YWx1ZXM7DQogICAgbG9kYXNoLnZhbHVlc0luID0gdmFsdWVzSW47DQogICAgbG9kYXNoLndoZXJlID0gd2hlcmU7DQogICAgbG9kYXNoLndpdGhvdXQgPSB3aXRob3V0Ow0KICAgIGxvZGFzaC53cmFwID0gd3JhcDsNCiAgICBsb2Rhc2gueG9yID0geG9yOw0KICAgIGxvZGFzaC56aXAgPSB6aXA7DQogICAgbG9kYXNoLnppcE9iamVjdCA9IHppcE9iamVjdDsNCiAgICBsb2Rhc2guemlwV2l0aCA9IHppcFdpdGg7DQoNCiAgICAvLyBBZGQgYWxpYXNlcy4NCiAgICBsb2Rhc2guYmFja2Zsb3cgPSBmbG93UmlnaHQ7DQogICAgbG9kYXNoLmNvbGxlY3QgPSBtYXA7DQogICAgbG9kYXNoLmNvbXBvc2UgPSBmbG93UmlnaHQ7DQogICAgbG9kYXNoLmVhY2ggPSBmb3JFYWNoOw0KICAgIGxvZGFzaC5lYWNoUmlnaHQgPSBmb3JFYWNoUmlnaHQ7DQogICAgbG9kYXNoLmV4dGVuZCA9IGFzc2lnbjsNCiAgICBsb2Rhc2guaXRlcmF0ZWUgPSBjYWxsYmFjazsNCiAgICBsb2Rhc2gubWV0aG9kcyA9IGZ1bmN0aW9uczsNCiAgICBsb2Rhc2gub2JqZWN0ID0gemlwT2JqZWN0Ow0KICAgIGxvZGFzaC5zZWxlY3QgPSBmaWx0ZXI7DQogICAgbG9kYXNoLnRhaWwgPSByZXN0Ow0KICAgIGxvZGFzaC51bmlxdWUgPSB1bmlxOw0KDQogICAgLy8gQWRkIGZ1bmN0aW9ucyB0byBgbG9kYXNoLnByb3RvdHlwZWAuDQogICAgbWl4aW4obG9kYXNoLCBsb2Rhc2gpOw0KDQogICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQogICAgLy8gQWRkIGZ1bmN0aW9ucyB0aGF0IHJldHVybiB1bndyYXBwZWQgdmFsdWVzIHdoZW4gY2hhaW5pbmcuDQogICAgbG9kYXNoLmFkZCA9IGFkZDsNCiAgICBsb2Rhc2guYXR0ZW1wdCA9IGF0dGVtcHQ7DQogICAgbG9kYXNoLmNhbWVsQ2FzZSA9IGNhbWVsQ2FzZTsNCiAgICBsb2Rhc2guY2FwaXRhbGl6ZSA9IGNhcGl0YWxpemU7DQogICAgbG9kYXNoLmNsb25lID0gY2xvbmU7DQogICAgbG9kYXNoLmNsb25lRGVlcCA9IGNsb25lRGVlcDsNCiAgICBsb2Rhc2guZGVidXJyID0gZGVidXJyOw0KICAgIGxvZGFzaC5lbmRzV2l0aCA9IGVuZHNXaXRoOw0KICAgIGxvZGFzaC5lc2NhcGUgPSBlc2NhcGU7DQogICAgbG9kYXNoLmVzY2FwZVJlZ0V4cCA9IGVzY2FwZVJlZ0V4cDsNCiAgICBsb2Rhc2guZXZlcnkgPSBldmVyeTsNCiAgICBsb2Rhc2guZmluZCA9IGZpbmQ7DQogICAgbG9kYXNoLmZpbmRJbmRleCA9IGZpbmRJbmRleDsNCiAgICBsb2Rhc2guZmluZEtleSA9IGZpbmRLZXk7DQogICAgbG9kYXNoLmZpbmRMYXN0ID0gZmluZExhc3Q7DQogICAgbG9kYXNoLmZpbmRMYXN0SW5kZXggPSBmaW5kTGFzdEluZGV4Ow0KICAgIGxvZGFzaC5maW5kTGFzdEtleSA9IGZpbmRMYXN0S2V5Ow0KICAgIGxvZGFzaC5maW5kV2hlcmUgPSBmaW5kV2hlcmU7DQogICAgbG9kYXNoLmZpcnN0ID0gZmlyc3Q7DQogICAgbG9kYXNoLmdldCA9IGdldDsNCiAgICBsb2Rhc2guZ3QgPSBndDsNCiAgICBsb2Rhc2guZ3RlID0gZ3RlOw0KICAgIGxvZGFzaC5oYXMgPSBoYXM7DQogICAgbG9kYXNoLmlkZW50aXR5ID0gaWRlbnRpdHk7DQogICAgbG9kYXNoLmluY2x1ZGVzID0gaW5jbHVkZXM7DQogICAgbG9kYXNoLmluZGV4T2YgPSBpbmRleE9mOw0KICAgIGxvZGFzaC5pblJhbmdlID0gaW5SYW5nZTsNCiAgICBsb2Rhc2guaXNBcmd1bWVudHMgPSBpc0FyZ3VtZW50czsNCiAgICBsb2Rhc2guaXNBcnJheSA9IGlzQXJyYXk7DQogICAgbG9kYXNoLmlzQm9vbGVhbiA9IGlzQm9vbGVhbjsNCiAgICBsb2Rhc2guaXNEYXRlID0gaXNEYXRlOw0KICAgIGxvZGFzaC5pc0VsZW1lbnQgPSBpc0VsZW1lbnQ7DQogICAgbG9kYXNoLmlzRW1wdHkgPSBpc0VtcHR5Ow0KICAgIGxvZGFzaC5pc0VxdWFsID0gaXNFcXVhbDsNCiAgICBsb2Rhc2guaXNFcnJvciA9IGlzRXJyb3I7DQogICAgbG9kYXNoLmlzRmluaXRlID0gaXNGaW5pdGU7DQogICAgbG9kYXNoLmlzRnVuY3Rpb24gPSBpc0Z1bmN0aW9uOw0KICAgIGxvZGFzaC5pc01hdGNoID0gaXNNYXRjaDsNCiAgICBsb2Rhc2guaXNOYU4gPSBpc05hTjsNCiAgICBsb2Rhc2guaXNOYXRpdmUgPSBpc05hdGl2ZTsNCiAgICBsb2Rhc2guaXNOdWxsID0gaXNOdWxsOw0KICAgIGxvZGFzaC5pc051bWJlciA9IGlzTnVtYmVyOw0KICAgIGxvZGFzaC5pc09iamVjdCA9IGlzT2JqZWN0Ow0KICAgIGxvZGFzaC5pc1BsYWluT2JqZWN0ID0gaXNQbGFpbk9iamVjdDsNCiAgICBsb2Rhc2guaXNSZWdFeHAgPSBpc1JlZ0V4cDsNCiAgICBsb2Rhc2guaXNTdHJpbmcgPSBpc1N0cmluZzsNCiAgICBsb2Rhc2guaXNUeXBlZEFycmF5ID0gaXNUeXBlZEFycmF5Ow0KICAgIGxvZGFzaC5pc1VuZGVmaW5lZCA9IGlzVW5kZWZpbmVkOw0KICAgIGxvZGFzaC5rZWJhYkNhc2UgPSBrZWJhYkNhc2U7DQogICAgbG9kYXNoLmxhc3QgPSBsYXN0Ow0KICAgIGxvZGFzaC5sYXN0SW5kZXhPZiA9IGxhc3RJbmRleE9mOw0KICAgIGxvZGFzaC5sdCA9IGx0Ow0KICAgIGxvZGFzaC5sdGUgPSBsdGU7DQogICAgbG9kYXNoLm1heCA9IG1heDsNCiAgICBsb2Rhc2gubWluID0gbWluOw0KICAgIGxvZGFzaC5ub0NvbmZsaWN0ID0gbm9Db25mbGljdDsNCiAgICBsb2Rhc2gubm9vcCA9IG5vb3A7DQogICAgbG9kYXNoLm5vdyA9IG5vdzsNCiAgICBsb2Rhc2gucGFkID0gcGFkOw0KICAgIGxvZGFzaC5wYWRMZWZ0ID0gcGFkTGVmdDsNCiAgICBsb2Rhc2gucGFkUmlnaHQgPSBwYWRSaWdodDsNCiAgICBsb2Rhc2gucGFyc2VJbnQgPSBwYXJzZUludDsNCiAgICBsb2Rhc2gucmFuZG9tID0gcmFuZG9tOw0KICAgIGxvZGFzaC5yZWR1Y2UgPSByZWR1Y2U7DQogICAgbG9kYXNoLnJlZHVjZVJpZ2h0ID0gcmVkdWNlUmlnaHQ7DQogICAgbG9kYXNoLnJlcGVhdCA9IHJlcGVhdDsNCiAgICBsb2Rhc2gucmVzdWx0ID0gcmVzdWx0Ow0KICAgIGxvZGFzaC5ydW5JbkNvbnRleHQgPSBydW5JbkNvbnRleHQ7DQogICAgbG9kYXNoLnNpemUgPSBzaXplOw0KICAgIGxvZGFzaC5zbmFrZUNhc2UgPSBzbmFrZUNhc2U7DQogICAgbG9kYXNoLnNvbWUgPSBzb21lOw0KICAgIGxvZGFzaC5zb3J0ZWRJbmRleCA9IHNvcnRlZEluZGV4Ow0KICAgIGxvZGFzaC5zb3J0ZWRMYXN0SW5kZXggPSBzb3J0ZWRMYXN0SW5kZXg7DQogICAgbG9kYXNoLnN0YXJ0Q2FzZSA9IHN0YXJ0Q2FzZTsNCiAgICBsb2Rhc2guc3RhcnRzV2l0aCA9IHN0YXJ0c1dpdGg7DQogICAgbG9kYXNoLnN1bSA9IHN1bTsNCiAgICBsb2Rhc2gudGVtcGxhdGUgPSB0ZW1wbGF0ZTsNCiAgICBsb2Rhc2gudHJpbSA9IHRyaW07DQogICAgbG9kYXNoLnRyaW1MZWZ0ID0gdHJpbUxlZnQ7DQogICAgbG9kYXNoLnRyaW1SaWdodCA9IHRyaW1SaWdodDsNCiAgICBsb2Rhc2gudHJ1bmMgPSB0cnVuYzsNCiAgICBsb2Rhc2gudW5lc2NhcGUgPSB1bmVzY2FwZTsNCiAgICBsb2Rhc2gudW5pcXVlSWQgPSB1bmlxdWVJZDsNCiAgICBsb2Rhc2gud29yZHMgPSB3b3JkczsNCg0KICAgIC8vIEFkZCBhbGlhc2VzLg0KICAgIGxvZGFzaC5hbGwgPSBldmVyeTsNCiAgICBsb2Rhc2guYW55ID0gc29tZTsNCiAgICBsb2Rhc2guY29udGFpbnMgPSBpbmNsdWRlczsNCiAgICBsb2Rhc2guZXEgPSBpc0VxdWFsOw0KICAgIGxvZGFzaC5kZXRlY3QgPSBmaW5kOw0KICAgIGxvZGFzaC5mb2xkbCA9IHJlZHVjZTsNCiAgICBsb2Rhc2guZm9sZHIgPSByZWR1Y2VSaWdodDsNCiAgICBsb2Rhc2guaGVhZCA9IGZpcnN0Ow0KICAgIGxvZGFzaC5pbmNsdWRlID0gaW5jbHVkZXM7DQogICAgbG9kYXNoLmluamVjdCA9IHJlZHVjZTsNCg0KICAgIG1peGluKGxvZGFzaCwgKGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIHNvdXJjZSA9IHt9Ow0KICAgICAgYmFzZUZvck93bihsb2Rhc2gsIGZ1bmN0aW9uKGZ1bmMsIG1ldGhvZE5hbWUpIHsNCiAgICAgICAgaWYgKCFsb2Rhc2gucHJvdG90eXBlW21ldGhvZE5hbWVdKSB7DQogICAgICAgICAgc291cmNlW21ldGhvZE5hbWVdID0gZnVuYzsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgICByZXR1cm4gc291cmNlOw0KICAgIH0oKSksIGZhbHNlKTsNCg0KICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KICAgIC8vIEFkZCBmdW5jdGlvbnMgY2FwYWJsZSBvZiByZXR1cm5pbmcgd3JhcHBlZCBhbmQgdW53cmFwcGVkIHZhbHVlcyB3aGVuIGNoYWluaW5nLg0KICAgIGxvZGFzaC5zYW1wbGUgPSBzYW1wbGU7DQoNCiAgICBsb2Rhc2gucHJvdG90eXBlLnNhbXBsZSA9IGZ1bmN0aW9uKG4pIHsNCiAgICAgIGlmICghdGhpcy5fX2NoYWluX18gJiYgbiA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBzYW1wbGUodGhpcy52YWx1ZSgpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiB0aGlzLnRocnUoZnVuY3Rpb24odmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIHNhbXBsZSh2YWx1ZSwgbik7DQogICAgICB9KTsNCiAgICB9Ow0KDQogICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQogICAgLyoqDQogICAgICogVGhlIHNlbWFudGljIHZlcnNpb24gbnVtYmVyLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqIEBtZW1iZXJPZiBfDQogICAgICogQHR5cGUgc3RyaW5nDQogICAgICovDQogICAgbG9kYXNoLlZFUlNJT04gPSBWRVJTSU9OOw0KDQogICAgLy8gQXNzaWduIGRlZmF1bHQgcGxhY2Vob2xkZXJzLg0KICAgIGFycmF5RWFjaChbJ2JpbmQnLCAnYmluZEtleScsICdjdXJyeScsICdjdXJyeVJpZ2h0JywgJ3BhcnRpYWwnLCAncGFydGlhbFJpZ2h0J10sIGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHsNCiAgICAgIGxvZGFzaFttZXRob2ROYW1lXS5wbGFjZWhvbGRlciA9IGxvZGFzaDsNCiAgICB9KTsNCg0KICAgIC8vIEFkZCBgTGF6eVdyYXBwZXJgIG1ldGhvZHMgdGhhdCBhY2NlcHQgYW4gYGl0ZXJhdGVlYCB2YWx1ZS4NCiAgICBhcnJheUVhY2goWydkcm9wV2hpbGUnLCAnZmlsdGVyJywgJ21hcCcsICd0YWtlV2hpbGUnXSwgZnVuY3Rpb24obWV0aG9kTmFtZSwgdHlwZSkgew0KICAgICAgdmFyIGlzRmlsdGVyID0gdHlwZSAhPSBMQVpZX01BUF9GTEFHLA0KICAgICAgICAgIGlzRHJvcFdoaWxlID0gdHlwZSA9PSBMQVpZX0RST1BfV0hJTEVfRkxBRzsNCg0KICAgICAgTGF6eVdyYXBwZXIucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oaXRlcmF0ZWUsIHRoaXNBcmcpIHsNCiAgICAgICAgdmFyIGZpbHRlcmVkID0gdGhpcy5fX2ZpbHRlcmVkX18sDQogICAgICAgICAgICByZXN1bHQgPSAoZmlsdGVyZWQgJiYgaXNEcm9wV2hpbGUpID8gbmV3IExhenlXcmFwcGVyKHRoaXMpIDogdGhpcy5jbG9uZSgpLA0KICAgICAgICAgICAgaXRlcmF0ZWVzID0gcmVzdWx0Ll9faXRlcmF0ZWVzX18gfHwgKHJlc3VsdC5fX2l0ZXJhdGVlc19fID0gW10pOw0KDQogICAgICAgIGl0ZXJhdGVlcy5wdXNoKHsNCiAgICAgICAgICAnZG9uZSc6IGZhbHNlLA0KICAgICAgICAgICdjb3VudCc6IDAsDQogICAgICAgICAgJ2luZGV4JzogMCwNCiAgICAgICAgICAnaXRlcmF0ZWUnOiBnZXRDYWxsYmFjayhpdGVyYXRlZSwgdGhpc0FyZywgMSksDQogICAgICAgICAgJ2xpbWl0JzogLTEsDQogICAgICAgICAgJ3R5cGUnOiB0eXBlDQogICAgICAgIH0pOw0KDQogICAgICAgIHJlc3VsdC5fX2ZpbHRlcmVkX18gPSBmaWx0ZXJlZCB8fCBpc0ZpbHRlcjsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH07DQogICAgfSk7DQoNCiAgICAvLyBBZGQgYExhenlXcmFwcGVyYCBtZXRob2RzIGZvciBgXy5kcm9wYCBhbmQgYF8udGFrZWAgdmFyaWFudHMuDQogICAgYXJyYXlFYWNoKFsnZHJvcCcsICd0YWtlJ10sIGZ1bmN0aW9uKG1ldGhvZE5hbWUsIGluZGV4KSB7DQogICAgICB2YXIgd2hpbGVOYW1lID0gbWV0aG9kTmFtZSArICdXaGlsZSc7DQoNCiAgICAgIExhenlXcmFwcGVyLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKG4pIHsNCiAgICAgICAgdmFyIGZpbHRlcmVkID0gdGhpcy5fX2ZpbHRlcmVkX18sDQogICAgICAgICAgICByZXN1bHQgPSAoZmlsdGVyZWQgJiYgIWluZGV4KSA/IHRoaXMuZHJvcFdoaWxlKCkgOiB0aGlzLmNsb25lKCk7DQoNCiAgICAgICAgbiA9IG4gPT0gbnVsbCA/IDEgOiBuYXRpdmVNYXgoZmxvb3IobikgfHwgMCwgMCk7DQogICAgICAgIGlmIChmaWx0ZXJlZCkgew0KICAgICAgICAgIGlmIChpbmRleCkgew0KICAgICAgICAgICAgcmVzdWx0Ll9fdGFrZUNvdW50X18gPSBuYXRpdmVNaW4ocmVzdWx0Ll9fdGFrZUNvdW50X18sIG4pOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBsYXN0KHJlc3VsdC5fX2l0ZXJhdGVlc19fKS5saW1pdCA9IG47DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHZhciB2aWV3cyA9IHJlc3VsdC5fX3ZpZXdzX18gfHwgKHJlc3VsdC5fX3ZpZXdzX18gPSBbXSk7DQogICAgICAgICAgdmlld3MucHVzaCh7ICdzaXplJzogbiwgJ3R5cGUnOiBtZXRob2ROYW1lICsgKHJlc3VsdC5fX2Rpcl9fIDwgMCA/ICdSaWdodCcgOiAnJykgfSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH07DQoNCiAgICAgIExhenlXcmFwcGVyLnByb3RvdHlwZVttZXRob2ROYW1lICsgJ1JpZ2h0J10gPSBmdW5jdGlvbihuKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJldmVyc2UoKVttZXRob2ROYW1lXShuKS5yZXZlcnNlKCk7DQogICAgICB9Ow0KDQogICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGVbbWV0aG9kTmFtZSArICdSaWdodFdoaWxlJ10gPSBmdW5jdGlvbihwcmVkaWNhdGUsIHRoaXNBcmcpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmV2ZXJzZSgpW3doaWxlTmFtZV0ocHJlZGljYXRlLCB0aGlzQXJnKS5yZXZlcnNlKCk7DQogICAgICB9Ow0KICAgIH0pOw0KDQogICAgLy8gQWRkIGBMYXp5V3JhcHBlcmAgbWV0aG9kcyBmb3IgYF8uZmlyc3RgIGFuZCBgXy5sYXN0YC4NCiAgICBhcnJheUVhY2goWydmaXJzdCcsICdsYXN0J10sIGZ1bmN0aW9uKG1ldGhvZE5hbWUsIGluZGV4KSB7DQogICAgICB2YXIgdGFrZU5hbWUgPSAndGFrZScgKyAoaW5kZXggPyAnUmlnaHQnIDogJycpOw0KDQogICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXNbdGFrZU5hbWVdKDEpLnZhbHVlKClbMF07DQogICAgICB9Ow0KICAgIH0pOw0KDQogICAgLy8gQWRkIGBMYXp5V3JhcHBlcmAgbWV0aG9kcyBmb3IgYF8uaW5pdGlhbGAgYW5kIGBfLnJlc3RgLg0KICAgIGFycmF5RWFjaChbJ2luaXRpYWwnLCAncmVzdCddLCBmdW5jdGlvbihtZXRob2ROYW1lLCBpbmRleCkgew0KICAgICAgdmFyIGRyb3BOYW1lID0gJ2Ryb3AnICsgKGluZGV4ID8gJycgOiAnUmlnaHQnKTsNCg0KICAgICAgTGF6eVdyYXBwZXIucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzW2Ryb3BOYW1lXSgxKTsNCiAgICAgIH07DQogICAgfSk7DQoNCiAgICAvLyBBZGQgYExhenlXcmFwcGVyYCBtZXRob2RzIGZvciBgXy5wbHVja2AgYW5kIGBfLndoZXJlYC4NCiAgICBhcnJheUVhY2goWydwbHVjaycsICd3aGVyZSddLCBmdW5jdGlvbihtZXRob2ROYW1lLCBpbmRleCkgew0KICAgICAgdmFyIG9wZXJhdGlvbk5hbWUgPSBpbmRleCA/ICdmaWx0ZXInIDogJ21hcCcsDQogICAgICAgICAgY3JlYXRlQ2FsbGJhY2sgPSBpbmRleCA/IGJhc2VNYXRjaGVzIDogcHJvcGVydHk7DQoNCiAgICAgIExhenlXcmFwcGVyLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICAgIHJldHVybiB0aGlzW29wZXJhdGlvbk5hbWVdKGNyZWF0ZUNhbGxiYWNrKHZhbHVlKSk7DQogICAgICB9Ow0KICAgIH0pOw0KDQogICAgTGF6eVdyYXBwZXIucHJvdG90eXBlLmNvbXBhY3QgPSBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB0aGlzLmZpbHRlcihpZGVudGl0eSk7DQogICAgfTsNCg0KICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS5yZWplY3QgPSBmdW5jdGlvbihwcmVkaWNhdGUsIHRoaXNBcmcpIHsNCiAgICAgIHByZWRpY2F0ZSA9IGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMSk7DQogICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24odmFsdWUpIHsNCiAgICAgICAgcmV0dXJuICFwcmVkaWNhdGUodmFsdWUpOw0KICAgICAgfSk7DQogICAgfTsNCg0KICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS5zbGljZSA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHsNCiAgICAgIHN0YXJ0ID0gc3RhcnQgPT0gbnVsbCA/IDAgOiAoK3N0YXJ0IHx8IDApOw0KDQogICAgICB2YXIgcmVzdWx0ID0gdGhpczsNCiAgICAgIGlmIChzdGFydCA8IDApIHsNCiAgICAgICAgcmVzdWx0ID0gdGhpcy50YWtlUmlnaHQoLXN0YXJ0KTsNCiAgICAgIH0gZWxzZSBpZiAoc3RhcnQpIHsNCiAgICAgICAgcmVzdWx0ID0gdGhpcy5kcm9wKHN0YXJ0KTsNCiAgICAgIH0NCiAgICAgIGlmIChlbmQgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICBlbmQgPSAoK2VuZCB8fCAwKTsNCiAgICAgICAgcmVzdWx0ID0gZW5kIDwgMCA/IHJlc3VsdC5kcm9wUmlnaHQoLWVuZCkgOiByZXN1bHQudGFrZShlbmQgLSBzdGFydCk7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH07DQoNCiAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUudG9BcnJheSA9IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIHRoaXMuZHJvcCgwKTsNCiAgICB9Ow0KDQogICAgLy8gQWRkIGBMYXp5V3JhcHBlcmAgbWV0aG9kcyB0byBgbG9kYXNoLnByb3RvdHlwZWAuDQogICAgYmFzZUZvck93bihMYXp5V3JhcHBlci5wcm90b3R5cGUsIGZ1bmN0aW9uKGZ1bmMsIG1ldGhvZE5hbWUpIHsNCiAgICAgIHZhciBsb2Rhc2hGdW5jID0gbG9kYXNoW21ldGhvZE5hbWVdOw0KICAgICAgaWYgKCFsb2Rhc2hGdW5jKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIHZhciBjaGVja0l0ZXJhdGVlID0gL14oPzpmaWx0ZXJ8bWFwfHJlamVjdCl8V2hpbGUkLy50ZXN0KG1ldGhvZE5hbWUpLA0KICAgICAgICAgIHJldFVud3JhcHBlZCA9IC9eKD86Zmlyc3R8bGFzdCkkLy50ZXN0KG1ldGhvZE5hbWUpOw0KDQogICAgICBsb2Rhc2gucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgICAgICAgY2hhaW5BbGwgPSB0aGlzLl9fY2hhaW5fXywNCiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5fX3dyYXBwZWRfXywNCiAgICAgICAgICAgIGlzSHlicmlkID0gISF0aGlzLl9fYWN0aW9uc19fLmxlbmd0aCwNCiAgICAgICAgICAgIGlzTGF6eSA9IHZhbHVlIGluc3RhbmNlb2YgTGF6eVdyYXBwZXIsDQogICAgICAgICAgICBpdGVyYXRlZSA9IGFyZ3NbMF0sDQogICAgICAgICAgICB1c2VMYXp5ID0gaXNMYXp5IHx8IGlzQXJyYXkodmFsdWUpOw0KDQogICAgICAgIGlmICh1c2VMYXp5ICYmIGNoZWNrSXRlcmF0ZWUgJiYgdHlwZW9mIGl0ZXJhdGVlID09ICdmdW5jdGlvbicgJiYgaXRlcmF0ZWUubGVuZ3RoICE9IDEpIHsNCiAgICAgICAgICAvLyBhdm9pZCBsYXp5IHVzZSBpZiB0aGUgaXRlcmF0ZWUgaGFzIGEgImxlbmd0aCIgdmFsdWUgb3RoZXIgdGhhbiBgMWANCiAgICAgICAgICBpc0xhenkgPSB1c2VMYXp5ID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgdmFyIG9ubHlMYXp5ID0gaXNMYXp5ICYmICFpc0h5YnJpZDsNCiAgICAgICAgaWYgKHJldFVud3JhcHBlZCAmJiAhY2hhaW5BbGwpIHsNCiAgICAgICAgICByZXR1cm4gb25seUxhenkNCiAgICAgICAgICAgID8gZnVuYy5jYWxsKHZhbHVlKQ0KICAgICAgICAgICAgOiBsb2Rhc2hGdW5jLmNhbGwobG9kYXNoLCB0aGlzLnZhbHVlKCkpOw0KICAgICAgICB9DQogICAgICAgIHZhciBpbnRlcmNlcHRvciA9IGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICAgICAgdmFyIG90aGVyQXJncyA9IFt2YWx1ZV07DQogICAgICAgICAgcHVzaC5hcHBseShvdGhlckFyZ3MsIGFyZ3MpOw0KICAgICAgICAgIHJldHVybiBsb2Rhc2hGdW5jLmFwcGx5KGxvZGFzaCwgb3RoZXJBcmdzKTsNCiAgICAgICAgfTsNCiAgICAgICAgaWYgKHVzZUxhenkpIHsNCiAgICAgICAgICB2YXIgd3JhcHBlciA9IG9ubHlMYXp5ID8gdmFsdWUgOiBuZXcgTGF6eVdyYXBwZXIodGhpcyksDQogICAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkod3JhcHBlciwgYXJncyk7DQoNCiAgICAgICAgICBpZiAoIXJldFVud3JhcHBlZCAmJiAoaXNIeWJyaWQgfHwgcmVzdWx0Ll9fYWN0aW9uc19fKSkgew0KICAgICAgICAgICAgdmFyIGFjdGlvbnMgPSByZXN1bHQuX19hY3Rpb25zX18gfHwgKHJlc3VsdC5fX2FjdGlvbnNfXyA9IFtdKTsNCiAgICAgICAgICAgIGFjdGlvbnMucHVzaCh7ICdmdW5jJzogdGhydSwgJ2FyZ3MnOiBbaW50ZXJjZXB0b3JdLCAndGhpc0FyZyc6IGxvZGFzaCB9KTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIG5ldyBMb2Rhc2hXcmFwcGVyKHJlc3VsdCwgY2hhaW5BbGwpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLnRocnUoaW50ZXJjZXB0b3IpOw0KICAgICAgfTsNCiAgICB9KTsNCg0KICAgIC8vIEFkZCBgQXJyYXlgIGFuZCBgU3RyaW5nYCBtZXRob2RzIHRvIGBsb2Rhc2gucHJvdG90eXBlYC4NCiAgICBhcnJheUVhY2goWydjb25jYXQnLCAnam9pbicsICdwb3AnLCAncHVzaCcsICdyZXBsYWNlJywgJ3NoaWZ0JywgJ3NvcnQnLCAnc3BsaWNlJywgJ3NwbGl0JywgJ3Vuc2hpZnQnXSwgZnVuY3Rpb24obWV0aG9kTmFtZSkgew0KICAgICAgdmFyIGZ1bmMgPSAoL14oPzpyZXBsYWNlfHNwbGl0KSQvLnRlc3QobWV0aG9kTmFtZSkgPyBzdHJpbmdQcm90byA6IGFycmF5UHJvdG8pW21ldGhvZE5hbWVdLA0KICAgICAgICAgIGNoYWluTmFtZSA9IC9eKD86cHVzaHxzb3J0fHVuc2hpZnQpJC8udGVzdChtZXRob2ROYW1lKSA/ICd0YXAnIDogJ3RocnUnLA0KICAgICAgICAgIHJldFVud3JhcHBlZCA9IC9eKD86am9pbnxwb3B8cmVwbGFjZXxzaGlmdCkkLy50ZXN0KG1ldGhvZE5hbWUpOw0KDQogICAgICBsb2Rhc2gucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzOw0KICAgICAgICBpZiAocmV0VW53cmFwcGVkICYmICF0aGlzLl9fY2hhaW5fXykgew0KICAgICAgICAgIHJldHVybiBmdW5jLmFwcGx5KHRoaXMudmFsdWUoKSwgYXJncyk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXNbY2hhaW5OYW1lXShmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgICAgIHJldHVybiBmdW5jLmFwcGx5KHZhbHVlLCBhcmdzKTsNCiAgICAgICAgfSk7DQogICAgICB9Ow0KICAgIH0pOw0KDQogICAgLy8gTWFwIG1pbmlmaWVkIGZ1bmN0aW9uIG5hbWVzIHRvIHRoZWlyIHJlYWwgbmFtZXMuDQogICAgYmFzZUZvck93bihMYXp5V3JhcHBlci5wcm90b3R5cGUsIGZ1bmN0aW9uKGZ1bmMsIG1ldGhvZE5hbWUpIHsNCiAgICAgIHZhciBsb2Rhc2hGdW5jID0gbG9kYXNoW21ldGhvZE5hbWVdOw0KICAgICAgaWYgKGxvZGFzaEZ1bmMpIHsNCiAgICAgICAgdmFyIGtleSA9IGxvZGFzaEZ1bmMubmFtZSwNCiAgICAgICAgICAgIG5hbWVzID0gcmVhbE5hbWVzW2tleV0gfHwgKHJlYWxOYW1lc1trZXldID0gW10pOw0KDQogICAgICAgIG5hbWVzLnB1c2goeyAnbmFtZSc6IG1ldGhvZE5hbWUsICdmdW5jJzogbG9kYXNoRnVuYyB9KTsNCiAgICAgIH0NCiAgICB9KTsNCg0KICAgIHJlYWxOYW1lc1tjcmVhdGVIeWJyaWRXcmFwcGVyKG51bGwsIEJJTkRfS0VZX0ZMQUcpLm5hbWVdID0gW3sgJ25hbWUnOiAnd3JhcHBlcicsICdmdW5jJzogbnVsbCB9XTsNCg0KICAgIC8vIEFkZCBmdW5jdGlvbnMgdG8gdGhlIGxhenkgd3JhcHBlci4NCiAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUuY2xvbmUgPSBsYXp5Q2xvbmU7DQogICAgTGF6eVdyYXBwZXIucHJvdG90eXBlLnJldmVyc2UgPSBsYXp5UmV2ZXJzZTsNCiAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUudmFsdWUgPSBsYXp5VmFsdWU7DQoNCiAgICAvLyBBZGQgY2hhaW5pbmcgZnVuY3Rpb25zIHRvIHRoZSBgbG9kYXNoYCB3cmFwcGVyLg0KICAgIGxvZGFzaC5wcm90b3R5cGUuY2hhaW4gPSB3cmFwcGVyQ2hhaW47DQogICAgbG9kYXNoLnByb3RvdHlwZS5jb21taXQgPSB3cmFwcGVyQ29tbWl0Ow0KICAgIGxvZGFzaC5wcm90b3R5cGUucGxhbnQgPSB3cmFwcGVyUGxhbnQ7DQogICAgbG9kYXNoLnByb3RvdHlwZS5yZXZlcnNlID0gd3JhcHBlclJldmVyc2U7DQogICAgbG9kYXNoLnByb3RvdHlwZS50b1N0cmluZyA9IHdyYXBwZXJUb1N0cmluZzsNCiAgICBsb2Rhc2gucHJvdG90eXBlLnJ1biA9IGxvZGFzaC5wcm90b3R5cGUudG9KU09OID0gbG9kYXNoLnByb3RvdHlwZS52YWx1ZU9mID0gbG9kYXNoLnByb3RvdHlwZS52YWx1ZSA9IHdyYXBwZXJWYWx1ZTsNCg0KICAgIC8vIEFkZCBmdW5jdGlvbiBhbGlhc2VzIHRvIHRoZSBgbG9kYXNoYCB3cmFwcGVyLg0KICAgIGxvZGFzaC5wcm90b3R5cGUuY29sbGVjdCA9IGxvZGFzaC5wcm90b3R5cGUubWFwOw0KICAgIGxvZGFzaC5wcm90b3R5cGUuaGVhZCA9IGxvZGFzaC5wcm90b3R5cGUuZmlyc3Q7DQogICAgbG9kYXNoLnByb3RvdHlwZS5zZWxlY3QgPSBsb2Rhc2gucHJvdG90eXBlLmZpbHRlcjsNCiAgICBsb2Rhc2gucHJvdG90eXBlLnRhaWwgPSBsb2Rhc2gucHJvdG90eXBlLnJlc3Q7DQoNCiAgICByZXR1cm4gbG9kYXNoOw0KICB9DQoNCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCiAgLy8gRXhwb3J0IGxvZGFzaC4NCiAgdmFyIF8gPSBydW5JbkNvbnRleHQoKTsNCg0KICAvLyBTb21lIEFNRCBidWlsZCBvcHRpbWl6ZXJzIGxpa2Ugci5qcyBjaGVjayBmb3IgY29uZGl0aW9uIHBhdHRlcm5zIGxpa2UgdGhlIGZvbGxvd2luZzoNCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgZGVmaW5lLmFtZCA9PSAnb2JqZWN0JyAmJiBkZWZpbmUuYW1kKSB7DQogICAgLy8gRXhwb3NlIGxvZGFzaCB0byB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGFuIEFNRCBsb2FkZXIgaXMgcHJlc2VudCB0byBhdm9pZA0KICAgIC8vIGVycm9ycyBpbiBjYXNlcyB3aGVyZSBsb2Rhc2ggaXMgbG9hZGVkIGJ5IGEgc2NyaXB0IHRhZyBhbmQgbm90IGludGVuZGVkDQogICAgLy8gYXMgYW4gQU1EIG1vZHVsZS4gU2VlIGh0dHA6Ly9yZXF1aXJlanMub3JnL2RvY3MvZXJyb3JzLmh0bWwjbWlzbWF0Y2ggZm9yDQogICAgLy8gbW9yZSBkZXRhaWxzLg0KICAgIHJvb3QuXyA9IF87DQoNCiAgICAvLyBEZWZpbmUgYXMgYW4gYW5vbnltb3VzIG1vZHVsZSBzbywgdGhyb3VnaCBwYXRoIG1hcHBpbmcsIGl0IGNhbiBiZQ0KICAgIC8vIHJlZmVyZW5jZWQgYXMgdGhlICJ1bmRlcnNjb3JlIiBtb2R1bGUuDQogICAgZGVmaW5lKGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIF87DQogICAgfSk7DQogIH0NCiAgLy8gQ2hlY2sgZm9yIGBleHBvcnRzYCBhZnRlciBgZGVmaW5lYCBpbiBjYXNlIGEgYnVpbGQgb3B0aW1pemVyIGFkZHMgYW4gYGV4cG9ydHNgIG9iamVjdC4NCiAgZWxzZSBpZiAoZnJlZUV4cG9ydHMgJiYgZnJlZU1vZHVsZSkgew0KICAgIC8vIEV4cG9ydCBmb3IgTm9kZS5qcyBvciBSaW5nb0pTLg0KICAgIGlmIChtb2R1bGVFeHBvcnRzKSB7DQogICAgICAoZnJlZU1vZHVsZS5leHBvcnRzID0gXykuXyA9IF87DQogICAgfQ0KICAgIC8vIEV4cG9ydCBmb3IgUmhpbm8gd2l0aCBDb21tb25KUyBzdXBwb3J0Lg0KICAgIGVsc2Ugew0KICAgICAgZnJlZUV4cG9ydHMuXyA9IF87DQogICAgfQ0KICB9DQogIGVsc2Ugew0KICAgIC8vIEV4cG9ydCBmb3IgYSBicm93c2VyIG9yIFJoaW5vLg0KICAgIHJvb3QuXyA9IF87DQogIH0NCn0uY2FsbCh0aGlzKSk7DQo=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="1029813046" offset="0" length="536" />
        <PacketInfo time="1029813046" offset="536" length="74927" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>